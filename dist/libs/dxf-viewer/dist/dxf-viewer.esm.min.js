/**
 * dxf-viewer v0.5.0 build Wed Sep 11 2024
 * https://dxf-viewer.github.io/dxf-viewer-examples/
 * Copyright 2024 dxf-viewer
 * @license UNLICENSED
 */
var jxe=Object.create,X0=Object.defineProperty,Xxe=Object.defineProperties,Yxe=Object.getOwnPropertyDescriptor,$xe=Object.getOwnPropertyDescriptors,Zxe=Object.getOwnPropertyNames,WU=Object.getOwnPropertySymbols,jU=Object.getPrototypeOf,XU=Object.prototype.hasOwnProperty,Kxe=Object.prototype.propertyIsEnumerable,Jxe=Reflect.get,Y0=Math.pow,g3=(e,t,n)=>t in e?X0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,oi=(e,t)=>{for(var n in t||(t={}))XU.call(t,n)&&g3(e,n,t[n]);if(WU)for(var n of WU(t))Kxe.call(t,n)&&g3(e,n,t[n]);return e},Ki=(e,t)=>Xxe(e,$xe(t)),v3=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)((function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')})),Qxe=(e,t)=>()=>(e&&(t=e(e=0)),t),Z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),YU=(e,t)=>{for(var n in t)X0(e,n,{get:t[n],enumerable:!0})},$U=(e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of Zxe(t))!XU.call(e,i)&&i!==n&&X0(e,i,{get:()=>t[i],enumerable:!(r=Yxe(t,i))||r.enumerable});return e},ca=(e,t,n)=>(n=null!=e?jxe(jU(e)):{},$U(!t&&e&&e.__esModule?n:X0(n,"default",{value:e,enumerable:!0}),e)),ebe=e=>$U(X0({},"__esModule",{value:!0}),e),li=(e,t,n)=>(g3(e,"symbol"!=typeof t?t+"":t,n),n),y3=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},re=(e,t,n)=>(y3(e,t,"read from private field"),n?n.call(e):t.get(e)),Ye=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},xt=(e,t,n,r)=>(y3(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),lE=(e,t,n,r)=>({set _(r){xt(e,t,r,n)},get _(){return re(e,t,r)}}),at=(e,t,n)=>(y3(e,t,"access private method"),n),ZU=(e,t,n)=>Jxe(jU(e),n,t),Et=(e,t,n)=>new Promise(((r,i)=>{var a=e=>{try{o(n.next(e))}catch(e){i(e)}},s=e=>{try{o(n.throw(e))}catch(e){i(e)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,s);o((n=n.apply(e,t)).next())})),QU={};function cE(e){return(cE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nbe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KU(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rbe(e,t,n){return t&&KU(e.prototype,t),n&&KU(e,n),e}function obe(e,t,n){var r=function(e){do{if(t(e))return e;e=e.replace(/-?[^-]*$/,"")}while(e);return null},i=function(){function i(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};nbe(this,i),this._locale=function(e){for(var t=JU(e),n=0;n<t.length;++n){var i=r(t[n]);if(i)return i}return r(sbe())}(n),this._select=t(this._locale),this._type=abe(a.type),this._nf=new e("en",a)}return rbe(i,[{key:"resolvedOptions",value:function(){var e=this._nf.resolvedOptions(),t=e.minimumIntegerDigits,r=e.minimumFractionDigits,i=e.maximumFractionDigits,a=e.minimumSignificantDigits,s=e.maximumSignificantDigits,o={locale:this._locale,minimumIntegerDigits:t,minimumFractionDigits:r,maximumFractionDigits:i,pluralCategories:n(this._locale,"ordinal"===this._type),type:this._type};return"number"==typeof a&&(o.minimumSignificantDigits=a,o.maximumSignificantDigits=s),o}},{key:"select",value:function(e){if(!(this instanceof i))throw new TypeError("select() called on incompatible ".concat(this));if("number"!=typeof e&&(e=Number(e)),!isFinite(e))return"other";var t=this._nf.format(Math.abs(e));return this._select(t,"ordinal"===this._type)}}],[{key:"supportedLocalesOf",value:function(e){return JU(e).filter(r)}}]),i}();return Object.defineProperty(i,"prototype",{writable:!1}),i}YU(QU,{default:()=>obe});var ibe,JU,sbe,abe,eH=Qxe((()=>{ibe=function(e){return e.split("-").every((function(e){return/[a-z0-9]+/i.test(e)}))},JU=function(e){if(!e)return[];Array.isArray(e)||(e=[e]);for(var t={},n=0;n<e.length;++n){var r=e[n];if(r&&"object"===cE(r)&&(r=String(r)),"string"!=typeof r){var i="Locales should be strings, ".concat(JSON.stringify(r)," isn't.");throw new TypeError(i)}if("*"!==r[0]){if(!ibe(r)){var a=JSON.stringify(r),s="The locale ".concat(a," is not a structurally valid BCP 47 language tag.");throw new RangeError(s)}t[r]=!0}}return Object.keys(t)},sbe=function(){return"undefined"!=typeof navigator&&navigator&&(navigator.userLanguage||navigator.language)||"en-US"},abe=function(e){if(!e)return"cardinal";if("cardinal"===e||"ordinal"===e)return e;throw new RangeError("Not a valid plural type: "+JSON.stringify(e))}})),rH=Z(((e,t)=>{"use strict";function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){var r=n.minimumIntegerDigits,i=n.minimumFractionDigits,a=n.maximumFractionDigits,s=n.minimumSignificantDigits,o=n.maximumSignificantDigits;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._minID="number"==typeof r?r:1,this._minFD="number"==typeof i?i:0,this._maxFD="number"==typeof a?a:Math.max(this._minFD,3),("number"==typeof s||"number"==typeof o)&&(this._minSD="number"==typeof s?s:1,this._maxSD="number"==typeof o?o:21)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"resolvedOptions",value:function(){var e={minimumIntegerDigits:this._minID,minimumFractionDigits:this._minFD,maximumFractionDigits:this._maxFD};return"number"==typeof this._minSD&&(e.minimumSignificantDigits=this._minSD,e.maximumSignificantDigits=this._maxSD),e}},{key:"format",value:function(e){if(this._minSD){for(var t=String(e),n=0,r=0;r<t.length;++r){var i=t[r];i>="0"&&i<="9"&&++n}return n<this._minSD?e.toPrecision(this._minSD):n>this._maxSD?e.toPrecision(this._maxSD):t}return this._minFD>0?e.toFixed(this._minFD):0===this._maxFD?e.toFixed(0):String(e)}}]),e}();t.exports=r})),hH=Z(((e,t)=>{"use strict";var n=(eH(),ebe(QU)),r=rH();function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=i(n),s=i(r);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h,u,c,d,p,f,m,g,v={exports:{}};h=v,c=function(e,t){return t?"other":1==e?"one":"other"},d=function(e,t){return t?"other":0==e||1==e?"one":"other"},p=function(e,t){return t?"other":e>=0&&e<=1?"one":"other"},f=function(e,t){var n=!String(e).split(".")[1];return t?"other":1==e&&n?"one":"other"},g=function(e,t){return t?"other":1==e?"one":2==e?"two":"other"},u={_in:m=function(e,t){return"other"},af:c,ak:d,am:p,an:c,ar:function(e,t){var n=String(e).split("."),r=Number(n[0])==e&&n[0].slice(-2);return t?"other":0==e?"zero":1==e?"one":2==e?"two":r>=3&&r<=10?"few":r>=11&&r<=99?"many":"other"},ars:function(e,t){var n=String(e).split("."),r=Number(n[0])==e&&n[0].slice(-2);return t?"other":0==e?"zero":1==e?"one":2==e?"two":r>=3&&r<=10?"few":r>=11&&r<=99?"many":"other"},as:function(e,t){return t?1==e||5==e||7==e||8==e||9==e||10==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},asa:c,ast:f,az:function(e,t){var n=String(e).split(".")[0],r=n.slice(-1),i=n.slice(-2),a=n.slice(-3);return t?1==r||2==r||5==r||7==r||8==r||20==i||50==i||70==i||80==i?"one":3==r||4==r||100==a||200==a||300==a||400==a||500==a||600==a||700==a||800==a||900==a?"few":0==n||6==r||40==i||60==i||90==i?"many":"other":1==e?"one":"other"},be:function(e,t){var n=String(e).split("."),r=Number(n[0])==e,i=r&&n[0].slice(-1),a=r&&n[0].slice(-2);return t?2!=i&&3!=i||12==a||13==a?"other":"few":1==i&&11!=a?"one":i>=2&&i<=4&&(a<12||a>14)?"few":r&&0==i||i>=5&&i<=9||a>=11&&a<=14?"many":"other"},bem:c,bez:c,bg:c,bho:d,bm:m,bn:function(e,t){return t?1==e||5==e||7==e||8==e||9==e||10==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},bo:m,br:function(e,t){var n=String(e).split("."),r=Number(n[0])==e,i=r&&n[0].slice(-1),a=r&&n[0].slice(-2),s=r&&n[0].slice(-6);return t?"other":1==i&&11!=a&&71!=a&&91!=a?"one":2==i&&12!=a&&72!=a&&92!=a?"two":(3==i||4==i||9==i)&&(a<10||a>19)&&(a<70||a>79)&&(a<90||a>99)?"few":0!=e&&r&&0==s?"many":"other"},brx:c,bs:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=r.slice(-2),l=i.slice(-1),h=i.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},ca:function(e,t){var n=!String(e).split(".")[1];return t?1==e||3==e?"one":2==e?"two":4==e?"few":"other":1==e&&n?"one":"other"},ce:c,ceb:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=i.slice(-1);return t?"other":a&&(1==r||2==r||3==r)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},cgg:c,chr:c,ckb:c,cs:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1];return t?"other":1==e&&i?"one":r>=2&&r<=4&&i?"few":i?"other":"many"},cy:function(e,t){return t?0==e||7==e||8==e||9==e?"zero":1==e?"one":2==e?"two":3==e||4==e?"few":5==e||6==e?"many":"other":0==e?"zero":1==e?"one":2==e?"two":3==e?"few":6==e?"many":"other"},da:function(e,t){var n=String(e).split("."),r=n[0],i=Number(n[0])==e;return t||1!=e&&(i||0!=r&&1!=r)?"other":"one"},de:f,doi:p,dsb:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-2),o=i.slice(-2);return t?"other":a&&1==s||1==o?"one":a&&2==s||2==o?"two":a&&(3==s||4==s)||3==o||4==o?"few":"other"},dv:c,dz:m,ee:c,el:c,en:function(e,t){var n=String(e).split("."),r=!n[1],i=Number(n[0])==e,a=i&&n[0].slice(-1),s=i&&n[0].slice(-2);return t?1==a&&11!=s?"one":2==a&&12!=s?"two":3==a&&13!=s?"few":"other":1==e&&r?"one":"other"},eo:c,es:c,et:f,eu:c,fa:p,ff:function(e,t){return t?"other":e>=0&&e<2?"one":"other"},fi:f,fil:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=i.slice(-1);return t?1==e?"one":"other":a&&(1==r||2==r||3==r)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},fo:c,fr:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=r.slice(-6);return t?1==e?"one":"other":e>=0&&e<2?"one":0!=r&&0==a&&i?"many":"other"},fur:c,fy:f,ga:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?1==e?"one":"other":1==e?"one":2==e?"two":r&&e>=3&&e<=6?"few":r&&e>=7&&e<=10?"many":"other"},gd:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?1==e||11==e?"one":2==e||12==e?"two":3==e||13==e?"few":"other":1==e||11==e?"one":2==e||12==e?"two":r&&e>=3&&e<=10||r&&e>=13&&e<=19?"few":"other"},gl:f,gsw:c,gu:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},guw:d,gv:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=r.slice(-1),s=r.slice(-2);return t?"other":i&&1==a?"one":i&&2==a?"two":!i||0!=s&&20!=s&&40!=s&&60!=s&&80!=s?i?"other":"many":"few"},ha:c,haw:c,he:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=Number(n[0])==e,s=a&&n[0].slice(-1);return t?"other":1==e&&i?"one":2==r&&i?"two":i&&(e<0||e>10)&&a&&0==s?"many":"other"},hi:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},hr:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=r.slice(-2),l=i.slice(-1),h=i.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},hsb:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-2),o=i.slice(-2);return t?"other":a&&1==s||1==o?"one":a&&2==s||2==o?"two":a&&(3==s||4==s)||3==o||4==o?"few":"other"},hu:function(e,t){return t?1==e||5==e?"one":"other":1==e?"one":"other"},hy:function(e,t){return t?1==e?"one":"other":e>=0&&e<2?"one":"other"},ia:f,id:m,ig:m,ii:m,io:f,is:function(e,t){var n=String(e).split("."),r=n[0],i=Number(n[0])==e,a=r.slice(-1),s=r.slice(-2);return t?"other":i&&1==a&&11!=s||!i?"one":"other"},it:function(e,t){var n=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&n?"one":"other"},iu:g,iw:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=Number(n[0])==e,s=a&&n[0].slice(-1);return t?"other":1==e&&i?"one":2==r&&i?"two":i&&(e<0||e>10)&&a&&0==s?"many":"other"},ja:m,jbo:m,jgo:c,ji:f,jmc:c,jv:m,jw:m,ka:function(e,t){var n=String(e).split(".")[0],r=n.slice(-2);return t?1==n?"one":0==n||r>=2&&r<=20||40==r||60==r||80==r?"many":"other":1==e?"one":"other"},kab:function(e,t){return t?"other":e>=0&&e<2?"one":"other"},kaj:c,kcg:c,kde:m,kea:m,kk:function(e,t){var n=String(e).split("."),r=Number(n[0])==e,i=r&&n[0].slice(-1);return t?6==i||9==i||r&&0==i&&0!=e?"many":"other":1==e?"one":"other"},kkj:c,kl:c,km:m,kn:p,ko:m,ks:c,ksb:c,ksh:function(e,t){return t?"other":0==e?"zero":1==e?"one":"other"},ku:c,kw:function(e,t){var n=String(e).split("."),r=Number(n[0])==e,i=r&&n[0].slice(-2),a=r&&n[0].slice(-3),s=r&&n[0].slice(-5),o=r&&n[0].slice(-6);return t?r&&e>=1&&e<=4||i>=1&&i<=4||i>=21&&i<=24||i>=41&&i<=44||i>=61&&i<=64||i>=81&&i<=84?"one":5==e||5==i?"many":"other":0==e?"zero":1==e?"one":2==i||22==i||42==i||62==i||82==i||r&&0==a&&(s>=1e3&&s<=2e4||4e4==s||6e4==s||8e4==s)||0!=e&&1e5==o?"two":3==i||23==i||43==i||63==i||83==i?"few":1==e||1!=i&&21!=i&&41!=i&&61!=i&&81!=i?"other":"many"},ky:c,lag:function(e,t){var n=String(e).split(".")[0];return t?"other":0==e?"zero":0!=n&&1!=n||0==e?"other":"one"},lb:c,lg:c,lij:function(e,t){var n=String(e).split("."),r=!n[1],i=Number(n[0])==e;return t?11==e||8==e||i&&e>=80&&e<=89||i&&e>=800&&e<=899?"many":"other":1==e&&r?"one":"other"},lkt:m,ln:d,lo:function(e,t){return t&&1==e?"one":"other"},lt:function(e,t){var n=String(e).split("."),r=n[1]||"",i=Number(n[0])==e,a=i&&n[0].slice(-1),s=i&&n[0].slice(-2);return t?"other":1==a&&(s<11||s>19)?"one":a>=2&&a<=9&&(s<11||s>19)?"few":0!=r?"many":"other"},lv:function(e,t){var n=String(e).split("."),r=n[1]||"",i=r.length,a=Number(n[0])==e,s=a&&n[0].slice(-1),o=a&&n[0].slice(-2),l=r.slice(-2),h=r.slice(-1);return t?"other":a&&0==s||o>=11&&o<=19||2==i&&l>=11&&l<=19?"zero":1==s&&11!=o||2==i&&1==h&&11!=l||2!=i&&1==h?"one":"other"},mas:c,mg:d,mgo:c,mk:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=r.slice(-2),l=i.slice(-1),h=i.slice(-2);return t?1==s&&11!=o?"one":2==s&&12!=o?"two":7!=s&&8!=s||17==o||18==o?"other":"many":a&&1==s&&11!=o||1==l&&11!=h?"one":"other"},ml:c,mn:c,mo:function(e,t){var n=String(e).split("."),r=!n[1],i=Number(n[0])==e&&n[0].slice(-2);return t?1==e?"one":"other":1==e&&r?"one":!r||0==e||i>=2&&i<=19?"few":"other"},mr:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":"other":1==e?"one":"other"},ms:function(e,t){return t&&1==e?"one":"other"},mt:function(e,t){var n=String(e).split("."),r=Number(n[0])==e&&n[0].slice(-2);return t?"other":1==e?"one":0==e||r>=2&&r<=10?"few":r>=11&&r<=19?"many":"other"},my:m,nah:c,naq:g,nb:c,nd:c,ne:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?r&&e>=1&&e<=4?"one":"other":1==e?"one":"other"},nl:f,nn:c,nnh:c,no:c,nqo:m,nr:c,nso:d,ny:c,nyn:c,om:c,or:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?1==e||5==e||r&&e>=7&&e<=9?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":1==e?"one":"other"},os:c,osa:m,pa:d,pap:c,pcm:p,pl:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=r.slice(-1),s=r.slice(-2);return t?"other":1==e&&i?"one":i&&a>=2&&a<=4&&(s<12||s>14)?"few":i&&1!=r&&(0==a||1==a)||i&&a>=5&&a<=9||i&&s>=12&&s<=14?"many":"other"},prg:function(e,t){var n=String(e).split("."),r=n[1]||"",i=r.length,a=Number(n[0])==e,s=a&&n[0].slice(-1),o=a&&n[0].slice(-2),l=r.slice(-2),h=r.slice(-1);return t?"other":a&&0==s||o>=11&&o<=19||2==i&&l>=11&&l<=19?"zero":1==s&&11!=o||2==i&&1==h&&11!=l||2!=i&&1==h?"one":"other"},ps:c,pt:function(e,t){var n=String(e).split(".")[0];return t?"other":0==n||1==n?"one":"other"},pt_PT:f,rm:c,ro:function(e,t){var n=String(e).split("."),r=!n[1],i=Number(n[0])==e&&n[0].slice(-2);return t?1==e?"one":"other":1==e&&r?"one":!r||0==e||i>=2&&i<=19?"few":"other"},rof:c,root:m,ru:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=r.slice(-1),s=r.slice(-2);return t?"other":i&&1==a&&11!=s?"one":i&&a>=2&&a<=4&&(s<12||s>14)?"few":i&&0==a||i&&a>=5&&a<=9||i&&s>=11&&s<=14?"many":"other"},rwk:c,sah:m,saq:c,sat:g,sc:function(e,t){var n=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&n?"one":"other"},scn:function(e,t){var n=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&n?"one":"other"},sd:c,sdh:c,se:g,seh:c,ses:m,sg:m,sh:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=r.slice(-2),l=i.slice(-1),h=i.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},shi:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?"other":e>=0&&e<=1?"one":r&&e>=2&&e<=10?"few":"other"},si:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"";return t?"other":0==e||1==e||0==r&&1==i?"one":"other"},sk:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1];return t?"other":1==e&&i?"one":r>=2&&r<=4&&i?"few":i?"other":"many"},sl:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=r.slice(-2);return t?"other":i&&1==a?"one":i&&2==a?"two":i&&(3==a||4==a)||!i?"few":"other"},sma:g,smi:g,smj:g,smn:g,sms:g,sn:c,so:c,sq:function(e,t){var n=String(e).split("."),r=Number(n[0])==e,i=r&&n[0].slice(-1),a=r&&n[0].slice(-2);return t?1==e?"one":4==i&&14!=a?"many":"other":1==e?"one":"other"},sr:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=r.slice(-2),l=i.slice(-1),h=i.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},ss:c,ssy:c,st:c,su:m,sv:function(e,t){var n=String(e).split("."),r=!n[1],i=Number(n[0])==e,a=i&&n[0].slice(-1),s=i&&n[0].slice(-2);return t?1!=a&&2!=a||11==s||12==s?"other":"one":1==e&&r?"one":"other"},sw:f,syr:c,ta:c,te:c,teo:c,th:m,ti:d,tig:c,tk:function(e,t){var n=String(e).split("."),r=Number(n[0])==e&&n[0].slice(-1);return t?6==r||9==r||10==e?"few":"other":1==e?"one":"other"},tl:function(e,t){var n=String(e).split("."),r=n[0],i=n[1]||"",a=!n[1],s=r.slice(-1),o=i.slice(-1);return t?1==e?"one":"other":a&&(1==r||2==r||3==r)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},tn:c,to:m,tr:c,ts:c,tzm:function(e,t){var n=String(e).split("."),r=Number(n[0])==e;return t?"other":0==e||1==e||r&&e>=11&&e<=99?"one":"other"},ug:c,uk:function(e,t){var n=String(e).split("."),r=n[0],i=!n[1],a=Number(n[0])==e,s=a&&n[0].slice(-1),o=a&&n[0].slice(-2),l=r.slice(-1),h=r.slice(-2);return t?3==s&&13!=o?"few":"other":i&&1==l&&11!=h?"one":i&&l>=2&&l<=4&&(h<12||h>14)?"few":i&&0==l||i&&l>=5&&l<=9||i&&h>=11&&h<=14?"many":"other"},ur:f,uz:c,ve:c,vi:function(e,t){return t&&1==e?"one":"other"},vo:c,vun:c,wa:d,wae:c,wo:m,xh:c,xog:c,yi:f,yo:m,yue:m,zh:m,zu:p},Object.defineProperty(u,"__esModule",{value:!0}),h.exports=u;var y=l(v.exports),x=Object.freeze(Object.assign(Object.create(null),v.exports,{default:y})),b={exports:{}};!function(e,t){var n,r="zero",i="one",a="two",s="few",o="many",l="other",h={cardinal:[i,l],ordinal:[l]},u={cardinal:[l],ordinal:[l]},c={cardinal:[i,s,o,l],ordinal:[l]},d={cardinal:[i,l],ordinal:[i,l]},p={cardinal:[i,a,l],ordinal:[l]};n={_in:u,af:h,ak:h,am:h,an:h,ar:{cardinal:[r,i,a,s,o,l],ordinal:[l]},ars:{cardinal:[r,i,a,s,o,l],ordinal:[l]},as:{cardinal:[i,l],ordinal:[i,a,s,o,l]},asa:h,ast:h,az:{cardinal:[i,l],ordinal:[i,s,o,l]},be:{cardinal:[i,s,o,l],ordinal:[s,l]},bem:h,bez:h,bg:h,bho:h,bm:u,bn:{cardinal:[i,l],ordinal:[i,a,s,o,l]},bo:u,br:{cardinal:[i,a,s,o,l],ordinal:[l]},brx:h,bs:{cardinal:[i,s,l],ordinal:[l]},ca:{cardinal:[i,l],ordinal:[i,a,s,l]},ce:h,ceb:h,cgg:h,chr:h,ckb:h,cs:c,cy:{cardinal:[r,i,a,s,o,l],ordinal:[r,i,a,s,o,l]},da:h,de:h,doi:h,dsb:{cardinal:[i,a,s,l],ordinal:[l]},dv:h,dz:u,ee:h,el:h,en:{cardinal:[i,l],ordinal:[i,a,s,l]},eo:h,es:h,et:h,eu:h,fa:h,ff:h,fi:h,fil:d,fo:h,fr:{cardinal:[i,o,l],ordinal:[i,l]},fur:h,fy:h,ga:{cardinal:[i,a,s,o,l],ordinal:[i,l]},gd:{cardinal:[i,a,s,l],ordinal:[i,a,s,l]},gl:h,gsw:h,gu:{cardinal:[i,l],ordinal:[i,a,s,o,l]},guw:h,gv:{cardinal:[i,a,s,o,l],ordinal:[l]},ha:h,haw:h,he:{cardinal:[i,a,o,l],ordinal:[l]},hi:{cardinal:[i,l],ordinal:[i,a,s,o,l]},hr:{cardinal:[i,s,l],ordinal:[l]},hsb:{cardinal:[i,a,s,l],ordinal:[l]},hu:d,hy:d,ia:h,id:u,ig:u,ii:u,io:h,is:h,it:{cardinal:[i,l],ordinal:[o,l]},iu:p,iw:{cardinal:[i,a,o,l],ordinal:[l]},ja:u,jbo:u,jgo:h,ji:h,jmc:h,jv:u,jw:u,ka:{cardinal:[i,l],ordinal:[i,o,l]},kab:h,kaj:h,kcg:h,kde:u,kea:u,kk:{cardinal:[i,l],ordinal:[o,l]},kkj:h,kl:h,km:u,kn:h,ko:u,ks:h,ksb:h,ksh:{cardinal:[r,i,l],ordinal:[l]},ku:h,kw:{cardinal:[r,i,a,s,o,l],ordinal:[i,o,l]},ky:h,lag:{cardinal:[r,i,l],ordinal:[l]},lb:h,lg:h,lij:{cardinal:[i,l],ordinal:[o,l]},lkt:u,ln:h,lo:{cardinal:[l],ordinal:[i,l]},lt:c,lv:{cardinal:[r,i,l],ordinal:[l]},mas:h,mg:h,mgo:h,mk:{cardinal:[i,l],ordinal:[i,a,o,l]},ml:h,mn:h,mo:{cardinal:[i,s,l],ordinal:[i,l]},mr:{cardinal:[i,l],ordinal:[i,a,s,l]},ms:{cardinal:[l],ordinal:[i,l]},mt:c,my:u,nah:h,naq:p,nb:h,nd:h,ne:d,nl:h,nn:h,nnh:h,no:h,nqo:u,nr:h,nso:h,ny:h,nyn:h,om:h,or:{cardinal:[i,l],ordinal:[i,a,s,o,l]},os:h,osa:u,pa:h,pap:h,pcm:h,pl:c,prg:{cardinal:[r,i,l],ordinal:[l]},ps:h,pt:h,pt_PT:h,rm:h,ro:{cardinal:[i,s,l],ordinal:[i,l]},rof:h,root:u,ru:c,rwk:h,sah:u,saq:h,sat:p,sc:{cardinal:[i,l],ordinal:[o,l]},scn:{cardinal:[i,l],ordinal:[o,l]},sd:h,sdh:h,se:p,seh:h,ses:u,sg:u,sh:{cardinal:[i,s,l],ordinal:[l]},shi:{cardinal:[i,s,l],ordinal:[l]},si:h,sk:c,sl:{cardinal:[i,a,s,l],ordinal:[l]},sma:p,smi:p,smj:p,smn:p,sms:p,sn:h,so:h,sq:{cardinal:[i,l],ordinal:[i,o,l]},sr:{cardinal:[i,s,l],ordinal:[l]},ss:h,ssy:h,st:h,su:u,sv:d,sw:h,syr:h,ta:h,te:h,teo:h,th:u,ti:h,tig:h,tk:{cardinal:[i,l],ordinal:[s,l]},tl:d,tn:h,to:u,tr:h,ts:h,tzm:h,ug:h,uk:{cardinal:[i,s,o,l],ordinal:[s,l]},ur:h,uz:h,ve:h,vi:{cardinal:[l],ordinal:[i,l]},vo:h,vun:h,wa:h,wae:h,wo:u,xh:h,xog:h,yi:h,yo:u,yue:u,zh:u,zu:h},Object.defineProperty(n,"__esModule",{value:!0}),e.exports=n}(b);var _=l(b.exports),w=Object.freeze(Object.assign(Object.create(null),b.exports,{default:_})),S=y||x,M=_||w,T="object"===("undefined"==typeof Intl?"undefined":o(Intl))&&Intl.NumberFormat||s.default,E=function(e){return"in"===e?"_in":"pt-PT"===e?"pt_PT":e},A=a.default(T,(function(e){return S[E(e)]}),(function(e,t){return M[E(e)][t?"ordinal":"cardinal"]}));t.exports=A})),pH=Z((e=>{"use strict";var t=hH();var n,r,i=(n=t)&&"object"==typeof n&&"default"in n?n:{default:n};"undefined"==typeof Intl?("undefined"!=typeof global?global.Intl={PluralRules:i.default}:"undefined"!=typeof window?window.Intl={PluralRules:i.default}:e.Intl={PluralRules:i.default},i.default.polyfill=!0):Intl.PluralRules?(r=["en","es","ru","zh"],Intl.PluralRules.supportedLocalesOf(r).length<r.length&&(Intl.PluralRules=i.default,i.default.polyfill=!0)):(Intl.PluralRules=i.default,i.default.polyfill=!0)})),rn=Z(((e,t)=>{"use strict";var n=function(e){return e&&e.Math===Math&&e};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof global&&global)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),kt=Z(((e,t)=>{"use strict";t.exports=function(e){try{return!!e()}catch(e){return!0}}})),An=Z(((e,t)=>{"use strict";var n=kt();t.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),gp=Z(((e,t)=>{"use strict";var n=kt();t.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),qn=Z(((e,t)=>{"use strict";var n=gp(),r=Function.prototype.call;t.exports=n?r.bind(r):function(){return r.apply(r,arguments)}})),Z0=Z((e=>{"use strict";var t={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,r=n&&!t.call({1:2},1);e.f=r?function(e){var t=n(this,e);return!!t&&t.enumerable}:t})),La=Z(((e,t)=>{"use strict";t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),Ut=Z(((e,t)=>{"use strict";var n=gp(),r=Function.prototype,i=r.call,a=n&&r.bind.bind(i,i);t.exports=n?a:function(e){return function(){return i.apply(e,arguments)}}})),Ms=Z(((e,t)=>{"use strict";var n=Ut(),r=n({}.toString),i=n("".slice);t.exports=function(e){return i(r(e),8,-1)}})),rf=Z(((e,t)=>{"use strict";var n=Ut(),r=kt(),i=Ms(),a=Object,s=n("".split);t.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===i(e)?s(e,""):a(e)}:a})),qs=Z(((e,t)=>{"use strict";t.exports=function(e){return null==e}})),Kr=Z(((e,t)=>{"use strict";var n=qs(),r=TypeError;t.exports=function(e){if(n(e))throw new r("Can't call method on "+e);return e}})),Vi=Z(((e,t)=>{"use strict";var n=rf(),r=Kr();t.exports=function(e){return n(r(e))}})),lr=Z(((e,t)=>{"use strict";var n="object"==typeof document&&document.all;t.exports=void 0===n&&void 0!==n?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}})),Kn=Z(((e,t)=>{"use strict";var n=lr();t.exports=function(e){return"object"==typeof e?null!==e:n(e)}})),Ur=Z(((e,t)=>{"use strict";var n=rn(),r=lr();t.exports=function(e,t){return arguments.length<2?function(e){return r(e)?e:void 0}(n[e]):n[e]&&n[e][t]}})),ua=Z(((e,t)=>{"use strict";var n=Ut();t.exports=n({}.isPrototypeOf)})),Dl=Z(((e,t)=>{"use strict";t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""})),Ol=Z(((e,t)=>{"use strict";var n,r,i=rn(),a=Dl(),s=i.process,o=i.Deno,l=s&&s.versions||o&&o.version,h=l&&l.v8;h&&(r=(n=h.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!r&&a&&((!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&((n=a.match(/Chrome\/(\d+)/))&&(r=+n[1]))),t.exports=r})),sf=Z(((e,t)=>{"use strict";var n=Ol(),r=kt(),i=rn().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!i(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))})),C3=Z(((e,t)=>{"use strict";var n=sf();t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),Lu=Z(((e,t)=>{"use strict";var n=Ur(),r=lr(),i=ua(),a=C3(),s=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return r(t)&&i(t.prototype,s(e))}})),ku=Z(((e,t)=>{"use strict";var n=String;t.exports=function(e){try{return n(e)}catch(e){return"Object"}}})),Jr=Z(((e,t)=>{"use strict";var n=lr(),r=ku(),i=TypeError;t.exports=function(e){if(n(e))return e;throw new i(r(e)+" is not a function")}})),Ll=Z(((e,t)=>{"use strict";var n=Jr(),r=qs();t.exports=function(e,t){var i=e[t];return r(i)?void 0:n(i)}})),D3=Z(((e,t)=>{"use strict";var n=qn(),r=lr(),i=Kn(),a=TypeError;t.exports=function(e,t){var s,o;if("string"===t&&r(s=e.toString)&&!i(o=n(s,e))||r(s=e.valueOf)&&!i(o=n(s,e))||"string"!==t&&r(s=e.toString)&&!i(o=n(s,e)))return o;throw new a("Can't convert object to primitive value")}})),ci=Z(((e,t)=>{"use strict";t.exports=!1})),dE=Z(((e,t)=>{"use strict";var n=rn(),r=Object.defineProperty;t.exports=function(e,t){try{r(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}})),pE=Z(((e,t)=>{"use strict";var n=rn(),r=dE(),i="__core-js_shared__",a=n[i]||r(i,{});t.exports=a})),af=Z(((e,t)=>{"use strict";var n=ci(),r=pE();(t.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.35.0",mode:n?"pure":"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Tr=Z(((e,t)=>{"use strict";var n=Kr(),r=Object;t.exports=function(e){return r(n(e))}})),pr=Z(((e,t)=>{"use strict";var n=Ut(),r=Tr(),i=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return i(r(e),t)}})),of=Z(((e,t)=>{"use strict";var n=Ut(),r=0,i=Math.random(),a=n(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++r+i,36)}})),rr=Z(((e,t)=>{"use strict";var n=rn(),r=af(),i=pr(),a=of(),s=sf(),o=C3(),l=n.Symbol,h=r("wks"),u=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return i(h,e)||(h[e]=s&&i(l,e)?l[e]:u("Symbol."+e)),h[e]}})),K0=Z(((e,t)=>{"use strict";var n=qn(),r=Kn(),i=Lu(),a=Ll(),s=D3(),o=rr(),l=TypeError,h=o("toPrimitive");t.exports=function(e,t){if(!r(e)||i(e))return e;var o,u=a(e,h);if(u){if(void 0===t&&(t="default"),o=n(u,e,t),!r(o)||i(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}})),kl=Z(((e,t)=>{"use strict";var n=K0(),r=Lu();t.exports=function(e){var t=n(e,"string");return r(t)?t:t+""}})),J0=Z(((e,t)=>{"use strict";var n=rn(),r=Kn(),i=n.document,a=r(i)&&r(i.createElement);t.exports=function(e){return a?i.createElement(e):{}}})),k3=Z(((e,t)=>{"use strict";var n=An(),r=kt(),i=J0();t.exports=!n&&!r((function(){return 7!==Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))})),As=Z((e=>{"use strict";var t=An(),n=qn(),r=Z0(),i=La(),a=Vi(),s=kl(),o=pr(),l=k3(),h=Object.getOwnPropertyDescriptor;e.f=t?h:function(e,t){if(e=a(e),t=s(t),l)try{return h(e,t)}catch(e){}if(o(e,t))return i(!n(r.f,e,t),e[t])}})),F3=Z(((e,t)=>{"use strict";var n=An(),r=kt();t.exports=n&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),Gn=Z(((e,t)=>{"use strict";var n=Kn(),r=String,i=TypeError;t.exports=function(e){if(n(e))return e;throw new i(r(e)+" is not an object")}})),Qr=Z((e=>{"use strict";var t=An(),n=k3(),r=F3(),i=Gn(),a=kl(),s=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",u="configurable",c="writable";e.f=t?r?function(e,t,n){if(i(e),t=a(t),i(n),"function"==typeof e&&"prototype"===t&&"value"in n&&c in n&&!n[c]){var r=l(e,t);r&&r[c]&&(e[t]=n.value,n={configurable:u in n?n[u]:r[u],enumerable:h in n?n[h]:r[h],writable:!1})}return o(e,t,n)}:o:function(e,t,r){if(i(e),t=a(t),i(r),n)try{return o(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new s("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),Cs=Z(((e,t)=>{"use strict";var n=An(),r=Qr(),i=La();t.exports=n?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}})),lf=Z(((e,t)=>{"use strict";var n=An(),r=pr(),i=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,s=r(i,"name"),o=s&&"something"===function(){}.name,l=s&&(!n||n&&a(i,"name").configurable);t.exports={EXISTS:s,PROPER:o,CONFIGURABLE:l}})),gE=Z(((e,t)=>{"use strict";var n=Ut(),r=lr(),i=pE(),a=n(Function.toString);r(i.inspectSource)||(i.inspectSource=function(e){return a(e)}),t.exports=i.inspectSource})),G3=Z(((e,t)=>{"use strict";var n=rn(),r=lr(),i=n.WeakMap;t.exports=r(i)&&/native code/.test(String(i))})),Q0=Z(((e,t)=>{"use strict";var n=af(),r=of(),i=n("keys");t.exports=function(e){return i[e]||(i[e]=r(e))}})),yp=Z(((e,t)=>{"use strict";t.exports={}})),Ii=Z(((e,t)=>{"use strict";var n,r,i,a,s,o=G3(),l=rn(),h=Kn(),u=Cs(),c=pr(),d=pE(),p=Q0(),f=yp(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||d.state?((a=d.state||(d.state=new v)).get=a.get,a.has=a.has,a.set=a.set,n=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},r=function(e){return a.get(e)||{}},i=function(e){return a.has(e)}):(f[s=p("state")]=!0,n=function(e,t){if(c(e,s))throw new g(m);return t.facade=e,u(e,s,t),t},r=function(e){return c(e,s)?e[s]:{}},i=function(e){return c(e,s)}),t.exports={set:n,get:r,has:i,enforce:function(e){return i(e)?r(e):n(e,{})},getterFor:function(e){return function(t){var n;if(!h(t)||(n=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}})),EE=Z(((e,t)=>{"use strict";var n=Ut(),r=kt(),i=lr(),a=pr(),s=An(),o=lf().CONFIGURABLE,l=gE(),h=Ii(),u=h.enforce,c=h.get,d=String,p=Object.defineProperty,f=n("".slice),m=n("".replace),g=n([].join),v=s&&!r((function(){return 8!==p((function(){}),"length",{value:8}).length})),y=String(String).split("String"),x=t.exports=function(e,t,n){"Symbol("===f(d(t),0,7)&&(t="["+m(d(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!a(e,"name")||o&&e.name!==t)&&(s?p(e,"name",{value:t,configurable:!0}):e.name=t),v&&n&&a(n,"arity")&&e.length!==n.arity&&p(e,"length",{value:n.arity});try{n&&a(n,"constructor")&&n.constructor?s&&p(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=u(e);return a(r,"source")||(r.source=g(y,"string"==typeof t?t:"")),e};Function.prototype.toString=x((function(){return i(this)&&c(this).source||l(this)}),"toString")})),Xr=Z(((e,t)=>{"use strict";var n=lr(),r=Qr(),i=EE(),a=dE();t.exports=function(e,t,s,o){o||(o={});var l=o.enumerable,h=void 0!==o.name?o.name:t;if(n(s)&&i(s,h,o),o.global)l?e[t]=s:a(t,s);else{try{o.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=s:r.f(e,t,{value:s,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return e}})),Z3=Z(((e,t)=>{"use strict";var n=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:n)(t)}})),gi=Z(((e,t)=>{"use strict";var n=Z3();t.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}})),Fl=Z(((e,t)=>{"use strict";var n=gi(),r=Math.max,i=Math.min;t.exports=function(e,t){var a=n(e);return a<0?r(a+t,0):i(a,t)}})),ha=Z(((e,t)=>{"use strict";var n=gi(),r=Math.min;t.exports=function(e){return e>0?r(n(e),9007199254740991):0}})),Rr=Z(((e,t)=>{"use strict";var n=ha();t.exports=function(e){return n(e.length)}})),xp=Z(((e,t)=>{"use strict";var n=Vi(),r=Fl(),i=Rr(),a=function(e){return function(t,a,s){var o,l=n(t),h=i(l),u=r(s,h);if(e&&a!=a){for(;h>u;)if((o=l[u++])!=o)return!0}else for(;h>u;u++)if((e||u in l)&&l[u]===a)return e||u||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),J3=Z(((e,t)=>{"use strict";var n=Ut(),r=pr(),i=Vi(),a=xp().indexOf,s=yp(),o=n([].push);t.exports=function(e,t){var n,l=i(e),h=0,u=[];for(n in l)!r(s,n)&&r(l,n)&&o(u,n);for(;t.length>h;)r(l,n=t[h++])&&(~a(u,n)||o(u,n));return u}})),_E=Z(((e,t)=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Fu=Z((e=>{"use strict";var t=J3(),n=_E().concat("length","prototype");e.f=Object.getOwnPropertyNames||function(e){return t(e,n)}})),tv=Z((e=>{"use strict";e.f=Object.getOwnPropertySymbols})),TE=Z(((e,t)=>{"use strict";var n=Ur(),r=Ut(),i=Fu(),a=tv(),s=Gn(),o=r([].concat);t.exports=n("Reflect","ownKeys")||function(e){var t=i.f(s(e)),n=a.f;return n?o(t,n(e)):t}})),bp=Z(((e,t)=>{"use strict";var n=pr(),r=TE(),i=As(),a=Qr();t.exports=function(e,t,s){for(var o=r(t),l=a.f,h=i.f,u=0;u<o.length;u++){var c=o[u];!n(e,c)&&(!s||!n(s,c))&&l(e,c,h(t,c))}}})),Ep=Z(((e,t)=>{"use strict";var n=kt(),r=lr(),i=/#|\.prototype\./,a=function(e,t){var i=o[s(e)];return i===h||i!==l&&(r(t)?n(t):!!t)},s=a.normalize=function(e){return String(e).replace(i,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",h=a.POLYFILL="P";t.exports=a})),Je=Z(((e,t)=>{"use strict";var n=rn(),r=As().f,i=Cs(),a=Xr(),s=dE(),o=bp(),l=Ep();t.exports=function(e,t){var h,u,c,d,p,f=e.target,m=e.global,g=e.stat;if(h=m?n:g?n[f]||s(f,{}):(n[f]||{}).prototype)for(u in t){if(d=t[u],e.dontCallGetSet?c=(p=r(h,u))&&p.value:c=h[u],!l(m?u:f+(g?".":"#")+u,e.forced)&&void 0!==c){if(typeof d==typeof c)continue;o(d,c)}(e.sham||c&&c.sham)&&i(d,"sham",!0),a(h,u,d,e)}}})),SE=Z(((e,t)=>{"use strict";var n={};n[rr()("toStringTag")]="z",t.exports="[object z]"===String(n)})),Zo=Z(((e,t)=>{"use strict";var n=SE(),r=lr(),i=Ms(),a=rr()("toStringTag"),s=Object,o="Arguments"===i(function(){return arguments}());t.exports=n?i:function(e){var t,n,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?n:o?i(t):"Object"===(l=i(t))&&r(t.callee)?"Arguments":l}})),Fn=Z(((e,t)=>{"use strict";var n=Zo(),r=String;t.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),_p=Z(((e,t)=>{"use strict";var n=J3(),r=_E();t.exports=Object.keys||function(e){return n(e,r)}})),ME=Z((e=>{"use strict";var t=An(),n=F3(),r=Qr(),i=Gn(),a=Vi(),s=_p();e.f=t&&!n?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),l=s(t),h=l.length,u=0;h>u;)r.f(e,n=l[u++],o[n]);return e}})),e2=Z(((e,t)=>{"use strict";var n=Ur();t.exports=n("document","documentElement")})),fa=Z(((e,t)=>{"use strict";var n,r=Gn(),i=ME(),a=_E(),s=yp(),o=e2(),l=J0(),h=Q0(),u="prototype",c="script",d=h("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&n?m(n):function(){var e,t=l("iframe"),n="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(n);for(var e=a.length;e--;)delete g[u][a[e]];return g()};s[d]=!0,t.exports=Object.create||function(e,t){var n;return null!==e?(p[u]=r(e),n=new p,p[u]=null,n[d]=e):n=g(),void 0===t?n:i.f(n,t)}})),ka=Z(((e,t)=>{"use strict";var n=Ut();t.exports=n([].slice)})),RE=Z(((e,t)=>{"use strict";var n=Ms(),r=Vi(),i=Fu().f,a=ka(),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return s&&"Window"===n(e)?function(e){try{return i(e)}catch(e){return a(s)}}(e):i(r(e))}})),Ji=Z(((e,t)=>{"use strict";var n=EE(),r=Qr();t.exports=function(e,t,i){return i.get&&n(i.get,t,{getter:!0}),i.set&&n(i.set,t,{setter:!0}),r.f(e,t,i)}})),i2=Z((e=>{"use strict";var t=rr();e.f=t})),PE=Z(((e,t)=>{"use strict";var n=rn();t.exports=n})),Gs=Z(((e,t)=>{"use strict";var n=PE(),r=pr(),i=i2(),a=Qr().f;t.exports=function(e){var t=n.Symbol||(n.Symbol={});r(t,e)||a(t,e,{value:i.f(e)})}})),s2=Z(((e,t)=>{"use strict";var n=qn(),r=Ur(),i=rr(),a=Xr();t.exports=function(){var e=r("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,o=i("toPrimitive");t&&!t[o]&&a(t,o,(function(e){return n(s,this)}),{arity:1})}})),Ws=Z(((e,t)=>{"use strict";var n=Qr().f,r=pr(),i=rr()("toStringTag");t.exports=function(e,t,a){e&&!a&&(e=e.prototype),e&&!r(e,i)&&n(e,i,{configurable:!0,value:t})}})),Cc=Z(((e,t)=>{"use strict";var n=Ms(),r=Ut();t.exports=function(e){if("Function"===n(e))return r(e)}})),uo=Z(((e,t)=>{"use strict";var n=Cc(),r=Jr(),i=gp(),a=n(n.bind);t.exports=function(e,t){return r(e),void 0===t?e:i?a(e,t):function(){return e.apply(t,arguments)}}})),Rc=Z(((e,t)=>{"use strict";var n=Ms();t.exports=Array.isArray||function(e){return"Array"===n(e)}})),uf=Z(((e,t)=>{"use strict";var n=Ut(),r=kt(),i=lr(),a=Zo(),s=Ur(),o=gE(),l=function(){},h=[],u=s("Reflect","construct"),c=/^\s*(?:class|function)\b/,d=n(c.exec),p=!c.test(l),f=function(e){if(!i(e))return!1;try{return u(l,h,e),!0}catch(e){return!1}},m=function(e){if(!i(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(c,o(e))}catch(e){return!0}};m.sham=!0,t.exports=!u||r((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?m:f})),VV=Z(((e,t)=>{"use strict";var n=Rc(),r=uf(),i=Kn(),a=rr()("species"),s=Array;t.exports=function(e){var t;return n(e)&&(t=e.constructor,r(t)&&(t===s||n(t.prototype))?t=void 0:i(t)&&(null===(t=t[a])&&(t=void 0))),void 0===t?s:t}})),Tp=Z(((e,t)=>{"use strict";var n=VV();t.exports=function(e,t){return new(n(e))(0===t?0:t)}})),Qi=Z(((e,t)=>{"use strict";var n=uo(),r=Ut(),i=rf(),a=Tr(),s=Rr(),o=Tp(),l=r([].push),h=function(e){var t=1===e,r=2===e,h=3===e,u=4===e,c=6===e,d=7===e,p=5===e||c;return function(f,m,g,v){for(var y,x,b=a(f),_=i(b),w=s(_),S=n(m,g),M=0,T=v||o,E=t?T(f,w):r||d?T(f,0):void 0;w>M;M++)if((p||M in _)&&(x=S(y=_[M],M,b),e))if(t)E[M]=x;else if(x)switch(e){case 3:return!0;case 5:return y;case 6:return M;case 2:l(E,y)}else switch(e){case 4:return!1;case 7:l(E,y)}return c?-1:h||u?u:E}};t.exports={forEach:h(0),map:h(1),filter:h(2),some:h(3),every:h(4),find:h(5),findIndex:h(6),filterReject:h(7)}})),o7=Z((()=>{"use strict";var e=Je(),t=rn(),n=qn(),r=Ut(),i=ci(),a=An(),s=sf(),o=kt(),l=pr(),h=ua(),u=Gn(),c=Vi(),d=kl(),p=Fn(),f=La(),m=fa(),g=_p(),v=Fu(),y=RE(),x=tv(),b=As(),_=Qr(),w=ME(),S=Z0(),M=Xr(),T=Ji(),E=af(),A=Q0(),C=yp(),P=of(),I=rr(),R=i2(),L=Gs(),O=s2(),D=Ws(),k=Ii(),N=Qi().forEach,F=A("hidden"),U="Symbol",B="prototype",z=k.set,H=k.getterFor(U),V=Object[B],j=t.Symbol,G=j&&j[B],W=t.RangeError,q=t.TypeError,X=t.QObject,Y=b.f,Z=_.f,J=y.f,K=S.f,Q=r([].push),$=E("symbols"),ee=E("op-symbols"),te=E("wks"),ne=!X||!X[B]||!X[B].findChild,re=function(e,t,n){var r=Y(V,t);r&&delete V[t],Z(e,t,n),r&&e!==V&&Z(V,t,r)},ie=a&&o((function(){return 7!==m(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a}))?re:Z,ae=function(e,t){var n=$[e]=m(G);return z(n,{type:U,tag:e,description:t}),a||(n.description=t),n},se=function(e,t,n){e===V&&se(ee,t,n),u(e);var r=d(t);return u(n),l($,r)?(n.enumerable?(l(e,F)&&e[F][r]&&(e[F][r]=!1),n=m(n,{enumerable:f(0,!1)})):(l(e,F)||Z(e,F,f(1,m(null))),e[F][r]=!0),ie(e,r,n)):Z(e,r,n)},oe=function(e,t){u(e);var r=c(t),i=g(r).concat(ce(r));return N(i,(function(t){(!a||n(le,r,t))&&se(e,t,r[t])})),e},le=function(e){var t=d(e),r=n(K,this,t);return!(this===V&&l($,t)&&!l(ee,t))&&(!(r||!l(this,t)||!l($,t)||l(this,F)&&this[F][t])||r)},he=function(e,t){var n=c(e),r=d(t);if(n!==V||!l($,r)||l(ee,r)){var i=Y(n,r);return i&&l($,r)&&!(l(n,F)&&n[F][r])&&(i.enumerable=!0),i}},ue=function(e){var t=J(c(e)),n=[];return N(t,(function(e){!l($,e)&&!l(C,e)&&Q(n,e)})),n},ce=function(e){var t=e===V,n=J(t?ee:c(e)),r=[];return N(n,(function(e){l($,e)&&(!t||l(V,e))&&Q(r,$[e])})),r};s||(M(G=(j=function(){if(h(G,this))throw new q("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?p(arguments[0]):void 0,r=P(e),i=function(e){var a=void 0===this?t:this;a===V&&n(i,ee,e),l(a,F)&&l(a[F],r)&&(a[F][r]=!1);var s=f(1,e);try{ie(a,r,s)}catch(e){if(!(e instanceof W))throw e;re(a,r,s)}};return a&&ne&&ie(V,r,{configurable:!0,set:i}),ae(r,e)})[B],"toString",(function(){return H(this).tag})),M(j,"withoutSetter",(function(e){return ae(P(e),e)})),S.f=le,_.f=se,w.f=oe,b.f=he,v.f=y.f=ue,x.f=ce,R.f=function(e){return ae(I(e),e)},a&&(T(G,"description",{configurable:!0,get:function(){return H(this).description}}),i||M(V,"propertyIsEnumerable",le,{unsafe:!0}))),e({global:!0,constructor:!0,wrap:!0,forced:!s,sham:!s},{Symbol:j}),N(g(te),(function(e){L(e)})),e({target:U,stat:!0,forced:!s},{useSetter:function(){ne=!0},useSimple:function(){ne=!1}}),e({target:"Object",stat:!0,forced:!s,sham:!a},{create:function(e,t){return void 0===t?m(e):oe(m(e),t)},defineProperty:se,defineProperties:oe,getOwnPropertyDescriptor:he}),e({target:"Object",stat:!0,forced:!s},{getOwnPropertyNames:ue}),O(),D(j,U),C[F]=!0})),x2=Z(((e,t)=>{"use strict";var n=sf();t.exports=n&&!!Symbol.for&&!!Symbol.keyFor})),u7=Z((()=>{"use strict";var e=Je(),t=Ur(),n=pr(),r=Fn(),i=af(),a=x2(),s=i("string-to-symbol-registry"),o=i("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{for:function(e){var i=r(e);if(n(s,i))return s[i];var a=t("Symbol")(i);return s[i]=a,o[a]=i,a}})})),f7=Z((()=>{"use strict";var e=Je(),t=pr(),n=Lu(),r=ku(),i=af(),a=x2(),s=i("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{keyFor:function(e){if(!n(e))throw new TypeError(r(e)+" is not a symbol");if(t(s,e))return s[e]}})})),Fa=Z(((e,t)=>{"use strict";var n=gp(),r=Function.prototype,i=r.apply,a=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(n?a.bind(i):function(){return a.apply(i,arguments)})})),E7=Z(((e,t)=>{"use strict";var n=Ut(),r=Rc(),i=lr(),a=Ms(),s=Fn(),o=n([].push);t.exports=function(e){if(i(e))return e;if(r(e)){for(var t=e.length,n=[],l=0;l<t;l++){var h=e[l];"string"==typeof h?o(n,h):("number"==typeof h||"Number"===a(h)||"String"===a(h))&&o(n,s(h))}var u=n.length,c=!0;return function(e,t){if(c)return c=!1,t;if(r(this))return t;for(var i=0;i<u;i++)if(n[i]===e)return t}}}})),E2=Z((()=>{"use strict";var e=Je(),t=Ur(),n=Fa(),r=qn(),i=Ut(),a=kt(),s=lr(),o=Lu(),l=ka(),h=E7(),u=sf(),c=String,d=t("JSON","stringify"),p=i(/./.exec),f=i("".charAt),m=i("".charCodeAt),g=i("".replace),v=i(1..toString),y=/[\uD800-\uDFFF]/g,x=/^[\uD800-\uDBFF]$/,b=/^[\uDC00-\uDFFF]$/,_=!u||a((function(){var e=t("Symbol")("stringify detection");return"[null]"!==d([e])||"{}"!==d({a:e})||"{}"!==d(Object(e))})),w=a((function(){return'"\\udf06\\ud834"'!==d("\udf06\ud834")||'"\\udead"'!==d("\udead")})),S=function(e,t){var i=l(arguments),a=h(t);if(s(a)||void 0!==e&&!o(e))return i[1]=function(e,t){if(s(a)&&(t=r(a,this,c(e),t)),!o(t))return t},n(d,null,i)},M=function(e,t,n){var r=f(n,t-1),i=f(n,t+1);return p(x,e)&&!p(b,i)||p(b,e)&&!p(x,r)?"\\u"+v(m(e,0),16):e};d&&e({target:"JSON",stat:!0,arity:3,forced:_||w},{stringify:function(e,t,r){var i=l(arguments),a=n(_?S:d,null,i);return w&&"string"==typeof a?g(a,y,M):a}})})),L7=Z((()=>{"use strict";var e=Je(),t=sf(),n=kt(),r=tv(),i=Tr();e({target:"Object",stat:!0,forced:!t||n((function(){r.f(1)}))},{getOwnPropertySymbols:function(e){var t=r.f;return t?t(i(e)):[]}})})),k7=Z((()=>{"use strict";o7(),u7(),f7(),E2(),L7()})),z7=Z((()=>{"use strict";var e,t,n,r,i,a,s,o,l=Je(),h=An(),u=rn(),c=Ut(),d=pr(),p=lr(),f=ua(),m=Fn(),g=Ji(),v=bp(),y=u.Symbol,x=y&&y.prototype;h&&p(y)&&(!("description"in x)||void 0!==y().description)&&(e={},v(t=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:m(arguments[0]),n=f(x,this)?new y(t):void 0===t?y():y(t);return""===t&&(e[n]=!0),n},y),t.prototype=x,x.constructor=t,n="Symbol(description detection)"===String(y("description detection")),r=c(x.valueOf),i=c(x.toString),a=/^Symbol\((.*)\)[^)]+$/,s=c("".replace),o=c("".slice),g(x,"description",{configurable:!0,get:function(){var t=r(this);if(d(e,t))return"";var l=i(t),h=n?o(l,7,-1):s(l,a,"$1");return""===h?void 0:h}}),l({global:!0,constructor:!0,forced:!0},{Symbol:t}))})),q7=Z((()=>{"use strict";Gs()("asyncIterator")})),G7=Z((()=>{"use strict";Gs()("hasInstance")})),W7=Z((()=>{"use strict";Gs()("isConcatSpreadable")})),j7=Z((()=>{"use strict";Gs()("iterator")})),X7=Z((()=>{"use strict";Gs()("match")})),Y7=Z((()=>{"use strict";Gs()("matchAll")})),$7=Z((()=>{"use strict";Gs()("replace")})),Z7=Z((()=>{"use strict";Gs()("search")})),K7=Z((()=>{"use strict";Gs()("species")})),J7=Z((()=>{"use strict";Gs()("split")})),Q7=Z((()=>{"use strict";var e=Gs(),t=s2();e("toPrimitive"),t()})),e9=Z((()=>{"use strict";var e=Ur(),t=Gs(),n=Ws();t("toStringTag"),n(e("Symbol"),"Symbol")})),t9=Z((()=>{"use strict";Gs()("unscopables")})),r9=Z(((e,t)=>{"use strict";var n=Ut(),r=Jr();t.exports=function(e,t,i){try{return n(r(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(e){}}})),T2=Z(((e,t)=>{"use strict";var n=Kn();t.exports=function(e){return n(e)||null===e}})),S2=Z(((e,t)=>{"use strict";var n=T2(),r=String,i=TypeError;t.exports=function(e){if(n(e))return e;throw new i("Can't set "+r(e)+" as a prototype")}})),Ko=Z(((e,t)=>{"use strict";var n=r9(),r=Gn(),i=S2();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,a={};try{(e=n(Object.prototype,"__proto__","set"))(a,[]),t=a instanceof Array}catch(e){}return function(n,a){return r(n),i(a),t?e(n,a):n.__proto__=a,n}}():void 0)})),w2=Z(((e,t)=>{"use strict";var n=Qr().f;t.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}})),Uu=Z(((e,t)=>{"use strict";var n=lr(),r=Kn(),i=Ko();t.exports=function(e,t,a){var s,o;return i&&n(s=t.constructor)&&s!==a&&r(o=s.prototype)&&o!==a.prototype&&i(e,o),e}})),Ap=Z(((e,t)=>{"use strict";var n=Fn();t.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}})),M2=Z(((e,t)=>{"use strict";var n=Kn(),r=Cs();t.exports=function(e,t){n(t)&&"cause"in t&&r(e,"cause",t.cause)}})),BE=Z(((e,t)=>{"use strict";var n=Ut(),r=Error,i=n("".replace),a=String(new r("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,o=s.test(a);t.exports=function(e,t){if(o&&"string"==typeof e&&!r.prepareStackTrace)for(;t--;)e=i(e,s,"");return e}})),A2=Z(((e,t)=>{"use strict";var n=kt(),r=La();t.exports=!n((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",r(1,7)),7!==e.stack)}))})),C2=Z(((e,t)=>{"use strict";var n=Cs(),r=BE(),i=A2(),a=Error.captureStackTrace;t.exports=function(e,t,s,o){i&&(a?a(e,t):n(e,"stack",r(s,o)))}})),R2=Z(((e,t)=>{"use strict";var n=Ur(),r=pr(),i=Cs(),a=ua(),s=Ko(),o=bp(),l=w2(),h=Uu(),u=Ap(),c=M2(),d=C2(),p=An(),f=ci();t.exports=function(e,t,m,g){var v="stackTraceLimit",y=g?2:1,x=e.split("."),b=x[x.length-1],_=n.apply(null,x);if(_){var w=_.prototype;if(!f&&r(w,"cause")&&delete w.cause,!m)return _;var S=n("Error"),M=t((function(e,t){var n=u(g?t:e,void 0),r=g?new _(e):new _;return void 0!==n&&i(r,"message",n),d(r,M,r.stack,2),this&&a(w,this)&&h(r,this,M),arguments.length>y&&c(r,arguments[y]),r}));if(M.prototype=w,"Error"!==b?s?s(M,S):o(M,S,{name:!0}):p&&v in _&&(l(M,_,v),l(M,_,"prepareStackTrace")),o(M,_),!f)try{w.name!==b&&i(w,"name",b),w.constructor=M}catch(e){}return M}}})),C9=Z((()=>{"use strict";var e=Je(),t=rn(),n=Fa(),r=R2(),i="WebAssembly",a=t[i],s=7!==new Error("e",{cause:7}).cause,o=function(t,n){var i={};i[t]=r(t,n,s),e({global:!0,constructor:!0,arity:1,forced:s},i)},l=function(t,n){if(a&&a[t]){var o={};o[t]=r(i+"."+t,n,s),e({target:i,stat:!0,constructor:!0,arity:1,forced:s},o)}};o("Error",(function(e){return function(t){return n(e,this,arguments)}})),o("EvalError",(function(e){return function(t){return n(e,this,arguments)}})),o("RangeError",(function(e){return function(t){return n(e,this,arguments)}})),o("ReferenceError",(function(e){return function(t){return n(e,this,arguments)}})),o("SyntaxError",(function(e){return function(t){return n(e,this,arguments)}})),o("TypeError",(function(e){return function(t){return n(e,this,arguments)}})),o("URIError",(function(e){return function(t){return n(e,this,arguments)}})),l("CompileError",(function(e){return function(t){return n(e,this,arguments)}})),l("LinkError",(function(e){return function(t){return n(e,this,arguments)}})),l("RuntimeError",(function(e){return function(t){return n(e,this,arguments)}}))})),D2=Z(((e,t)=>{"use strict";var n=An(),r=kt(),i=Gn(),a=Ap(),s=Error.prototype.toString,o=r((function(){if(n){var e=Object.create(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==s.call(e))return!0}return"2: 1"!==s.call({message:1,name:2})||"Error"!==s.call({})}));t.exports=o?function(){var e=i(this),t=a(e.name,"Error"),n=a(e.message);return t?n?t+": "+n:t:n}:s})),O9=Z((()=>{"use strict";var e=Xr(),t=D2(),n=Error.prototype;n.toString!==t&&e(n,"toString",t)})),VE=Z(((e,t)=>{"use strict";var n=kt();t.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Na=Z(((e,t)=>{"use strict";var n=pr(),r=lr(),i=Tr(),a=Q0(),s=VE(),o=a("IE_PROTO"),l=Object,h=l.prototype;t.exports=s?l.getPrototypeOf:function(e){var t=i(e);if(n(t,o))return t[o];var a=t.constructor;return r(a)&&t instanceof a?a.prototype:t instanceof l?h:null}})),Cp=Z(((e,t)=>{"use strict";t.exports={}})),zE=Z(((e,t)=>{"use strict";var n=rr(),r=Cp(),i=n("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}})),Rp=Z(((e,t)=>{"use strict";var n=Zo(),r=Ll(),i=qs(),a=Cp(),s=rr()("iterator");t.exports=function(e){if(!i(e))return r(e,s)||r(e,"@@iterator")||a[n(e)]}})),uv=Z(((e,t)=>{"use strict";var n=qn(),r=Jr(),i=Gn(),a=ku(),s=Rp(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?s(e):t;if(r(l))return i(n(l,e));throw new o(a(e)+" is not iterable")}})),L2=Z(((e,t)=>{"use strict";var n=qn(),r=Gn(),i=Ll();t.exports=function(e,t,a){var s,o;r(e);try{if(!(s=i(e,"return"))){if("throw"===t)throw a;return a}s=n(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw a;if(o)throw s;return r(s),a}})),Ba=Z(((e,t)=>{"use strict";var n=uo(),r=qn(),i=Gn(),a=ku(),s=zE(),o=Rr(),l=ua(),h=uv(),u=Rp(),c=L2(),d=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,y,x,b,_,w,S=m&&m.that,M=!(!m||!m.AS_ENTRIES),T=!(!m||!m.IS_RECORD),E=!(!m||!m.IS_ITERATOR),A=!(!m||!m.INTERRUPTED),C=n(t,S),P=function(e){return g&&c(g,"normal",e),new p(!0,e)},I=function(e){return M?(i(e),A?C(e[0],e[1],P):C(e[0],e[1])):A?C(e,P):C(e)};if(T)g=e.iterator;else if(E)g=e;else{if(!(v=u(e)))throw new d(a(e)+" is not iterable");if(s(v)){for(y=0,x=o(e);x>y;y++)if((b=I(e[y]))&&l(f,b))return b;return new p(!1)}g=h(e,v)}for(_=T?e.next:g.next;!(w=r(_,g)).done;){try{b=I(w.value)}catch(e){c(g,"throw",e)}if("object"==typeof b&&b&&l(f,b))return b}return new p(!1)}})),$9=Z((()=>{"use strict";var e=Je(),t=ua(),n=Na(),r=Ko(),i=bp(),a=fa(),s=Cs(),o=La(),l=M2(),h=C2(),u=Ba(),c=Ap(),d=rr()("toStringTag"),p=Error,f=[].push,m=function(e,i){var o,v=t(g,this);r?o=r(new p,v?n(this):g):(o=v?this:a(g),s(o,d,"Error")),void 0!==i&&s(o,"message",c(i)),h(o,m,o.stack,1),arguments.length>2&&l(o,arguments[2]);var y=[];return u(e,f,{that:y}),s(o,"errors",y),o};r?r(m,p):i(m,p,{name:!0});var g=m.prototype=a(p.prototype,{constructor:o(1,m),message:o(1,""),name:o(1,"AggregateError")});e({global:!0,constructor:!0,arity:2},{AggregateError:m})})),Z9=Z((()=>{"use strict";$9()})),ez=Z((()=>{"use strict";var e=Je(),t=Ur(),n=Fa(),r=kt(),i=R2(),a="AggregateError",s=t(a),o=!r((function(){return 1!==s([1]).errors[0]}))&&r((function(){return 7!==s([1],a,{cause:7}).cause}));e({global:!0,constructor:!0,arity:2,forced:o},{AggregateError:i(a,(function(e){return function(t,r){return n(e,this,arguments)}}),o,!0)})})),js=Z(((e,t)=>{"use strict";var n=rr(),r=fa(),i=Qr().f,a=n("unscopables"),s=Array.prototype;void 0===s[a]&&i(s,a,{configurable:!0,value:r(null)}),t.exports=function(e){s[a][e]=!0}})),nz=Z((()=>{"use strict";var e=Je(),t=Tr(),n=Rr(),r=gi(),i=js();e({target:"Array",proto:!0},{at:function(e){var i=t(this),a=n(i),s=r(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:i[o]}}),i("at")})),mf=Z(((e,t)=>{"use strict";var n=TypeError;t.exports=function(e){if(e>9007199254740991)throw n("Maximum allowed index exceeded");return e}})),Dc=Z(((e,t)=>{"use strict";var n=kl(),r=Qr(),i=La();t.exports=function(e,t,a){var s=n(t);s in e?r.f(e,s,i(0,a)):e[s]=a}})),Ip=Z(((e,t)=>{"use strict";var n=kt(),r=rr(),i=Ol(),a=r("species");t.exports=function(e){return i>=51||!n((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}})),cz=Z((()=>{"use strict";var e=Je(),t=kt(),n=Rc(),r=Kn(),i=Tr(),a=Rr(),s=mf(),o=Dc(),l=Tp(),h=Ip(),u=rr(),c=Ol(),d=u("isConcatSpreadable"),p=c>=51||!t((function(){var e=[];return e[d]=!1,e.concat()[0]!==e})),f=function(e){if(!r(e))return!1;var t=e[d];return void 0!==t?!!t:n(e)};e({target:"Array",proto:!0,arity:1,forced:!p||!h("concat")},{concat:function(e){var t,n,r,h,u,c=i(this),d=l(c,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(f(u=-1===t?c:arguments[t]))for(h=a(u),s(p+h),n=0;n<h;n++,p++)n in u&&o(d,p,u[n]);else s(p+1),o(d,p++,u);return d.length=p,d}})})),hv=Z(((e,t)=>{"use strict";var n=ku(),r=TypeError;t.exports=function(e,t){if(!delete e[t])throw new r("Cannot delete property "+n(t)+" of "+n(e))}})),z2=Z(((e,t)=>{"use strict";var n=Tr(),r=Fl(),i=Rr(),a=hv(),s=Math.min;t.exports=[].copyWithin||function(e,t){var o=n(this),l=i(o),h=r(e,l),u=r(t,l),c=arguments.length>2?arguments[2]:void 0,d=s((void 0===c?l:r(c,l))-u,l-h),p=1;for(u<h&&h<u+d&&(p=-1,u+=d-1,h+=d-1);d-- >0;)u in o?o[h]=o[u]:a(o,h),h+=p,u+=p;return o}})),dz=Z((()=>{"use strict";var e=Je(),t=z2(),n=js();e({target:"Array",proto:!0},{copyWithin:t}),n("copyWithin")})),Bl=Z(((e,t)=>{"use strict";var n=kt();t.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}})),mz=Z((()=>{"use strict";var e=Je(),t=Qi().every;e({target:"Array",proto:!0,forced:!Bl()("every")},{every:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),jE=Z(((e,t)=>{"use strict";var n=Tr(),r=Fl(),i=Rr();t.exports=function(e){for(var t=n(this),a=i(t),s=arguments.length,o=r(s>1?arguments[1]:void 0,a),l=s>2?arguments[2]:void 0,h=void 0===l?a:r(l,a);h>o;)t[o++]=e;return t}})),yz=Z((()=>{"use strict";var e=Je(),t=jE(),n=js();e({target:"Array",proto:!0},{fill:t}),n("fill")})),xz=Z((()=>{"use strict";var e=Je(),t=Qi().filter;e({target:"Array",proto:!0,forced:!Ip()("filter")},{filter:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),Ez=Z((()=>{"use strict";var e=Je(),t=Qi().find,n=js(),r="find",i=!0;r in[]&&Array(1)[r]((function(){i=!1})),e({target:"Array",proto:!0,forced:i},{find:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),n(r)})),Tz=Z((()=>{"use strict";var e=Je(),t=Qi().findIndex,n=js(),r="findIndex",i=!0;r in[]&&Array(1)[r]((function(){i=!1})),e({target:"Array",proto:!0,forced:i},{findIndex:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),n(r)})),fv=Z(((e,t)=>{"use strict";var n=uo(),r=rf(),i=Tr(),a=Rr(),s=function(e){var t=1===e;return function(s,o,l){for(var h,u=i(s),c=r(u),d=a(c),p=n(o,l);d-- >0;)if(p(h=c[d],d,u))switch(e){case 0:return h;case 1:return d}return t?-1:void 0}};t.exports={findLast:s(0),findLastIndex:s(1)}})),Mz=Z((()=>{"use strict";var e=Je(),t=fv().findLast,n=js();e({target:"Array",proto:!0},{findLast:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),n("findLast")})),Az=Z((()=>{"use strict";var e=Je(),t=fv().findLastIndex,n=js();e({target:"Array",proto:!0},{findLastIndex:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),n("findLastIndex")})),W2=Z(((e,t)=>{"use strict";var n=Rc(),r=Rr(),i=mf(),a=uo(),s=function(e,t,o,l,h,u,c,d){for(var p,f,m=h,g=0,v=!!c&&a(c,d);g<l;)g in o&&(p=v?v(o[g],g,t):o[g],u>0&&n(p)?(f=r(p),m=s(e,t,p,f,m,u-1)-1):(i(m+1),e[m]=p),m++),g++;return m};t.exports=s})),Pz=Z((()=>{"use strict";var e=Je(),t=W2(),n=Tr(),r=Rr(),i=gi(),a=Tp();e({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,s=n(this),o=r(s),l=a(s,0);return l.length=t(l,s,s,o,0,void 0===e?1:i(e)),l}})})),Iz=Z((()=>{"use strict";var e=Je(),t=W2(),n=Jr(),r=Tr(),i=Rr(),a=Tp();e({target:"Array",proto:!0},{flatMap:function(e){var s,o=r(this),l=i(o);return n(e),(s=a(o,0)).length=t(s,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),s}})})),j2=Z(((e,t)=>{"use strict";var n=Qi().forEach,r=Bl()("forEach");t.exports=r?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})),Lz=Z((()=>{"use strict";var e=Je(),t=j2();e({target:"Array",proto:!0,forced:[].forEach!==t},{forEach:t})})),Fz=Z(((e,t)=>{"use strict";var n=Gn(),r=L2();t.exports=function(e,t,i,a){try{return a?t(n(i)[0],i[1]):t(i)}catch(t){r(e,"throw",t)}}})),X2=Z(((e,t)=>{"use strict";var n=uo(),r=qn(),i=Tr(),a=Fz(),s=zE(),o=uf(),l=Rr(),h=Dc(),u=uv(),c=Rp(),d=Array;t.exports=function(e){var t=i(e),p=o(this),f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m;g&&(m=n(m,f>2?arguments[2]:void 0));var v,y,x,b,_,w,S=c(t),M=0;if(!S||this===d&&s(S))for(v=l(t),y=p?new this(v):d(v);v>M;M++)w=g?m(t[M],M):t[M],h(y,M,w);else for(_=(b=u(t,S)).next,y=p?new this:[];!(x=r(_,b)).done;M++)w=g?a(b,m,[x.value,M],!0):x.value,h(y,M,w);return y.length=M,y}})),dv=Z(((e,t)=>{"use strict";var n,r,i=rr()("iterator"),a=!1;try{n=0,(r={next:function(){return{done:!!n++}},return:function(){a=!0}})[i]=function(){return this},Array.from(r,(function(){throw 2}))}catch(e){}t.exports=function(e,t){try{if(!t&&!a)return!1}catch(e){return!1}var n=!1;try{var r={};r[i]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}})),Gz=Z((()=>{"use strict";var e=Je(),t=X2();e({target:"Array",stat:!0,forced:!dv()((function(e){Array.from(e)}))},{from:t})})),Wz=Z((()=>{"use strict";var e=Je(),t=xp().includes,n=kt(),r=js();e({target:"Array",proto:!0,forced:n((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Xz=Z((()=>{"use strict";var e=Je(),t=Cc(),n=xp().indexOf,r=Bl(),i=t([].indexOf),a=!!i&&1/i([1],1,-0)<0;e({target:"Array",proto:!0,forced:a||!r("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return a?i(this,e,t)||0:n(this,e,t)}})})),Yz=Z((()=>{"use strict";Je()({target:"Array",stat:!0},{isArray:Rc()})})),Q2=Z(((e,t)=>{"use strict";var n,r,i,a=kt(),s=lr(),o=Kn(),l=fa(),h=Na(),u=Xr(),c=rr(),d=ci(),p=c("iterator"),f=!1;[].keys&&("next"in(i=[].keys())?(r=h(h(i)))!==Object.prototype&&(n=r):f=!0),!o(n)||a((function(){var e={};return n[p].call(e)!==e}))?n={}:d&&(n=l(n)),s(n[p])||u(n,p,(function(){return this})),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:f}})),XE=Z(((e,t)=>{"use strict";var n=Q2().IteratorPrototype,r=fa(),i=La(),a=Ws(),s=Cp(),o=function(){return this};t.exports=function(e,t,l,h){var u=t+" Iterator";return e.prototype=r(n,{next:i(+!h,l)}),a(e,u,!1,!0),s[u]=o,e}})),ZE=Z(((e,t)=>{"use strict";var n=Je(),r=qn(),i=ci(),a=lf(),s=lr(),o=XE(),l=Na(),h=Ko(),u=Ws(),c=Cs(),d=Xr(),p=rr(),f=Cp(),m=Q2(),g=a.PROPER,v=a.CONFIGURABLE,y=m.IteratorPrototype,x=m.BUGGY_SAFARI_ITERATORS,b=p("iterator"),_="keys",w="values",S="entries",M=function(){return this};t.exports=function(e,t,a,p,m,T,E){o(a,t,p);var A,C,P,I=function(e){if(e===m&&k)return k;if(!x&&e&&e in O)return O[e];switch(e){case _:case w:case S:return function(){return new a(this,e)}}return function(){return new a(this)}},R=t+" Iterator",L=!1,O=e.prototype,D=O[b]||O["@@iterator"]||m&&O[m],k=!x&&D||I(m),N="Array"===t&&O.entries||D;if(N&&((A=l(N.call(new e)))!==Object.prototype&&A.next&&(!i&&l(A)!==y&&(h?h(A,y):s(A[b])||d(A,b,M)),u(A,R,!0,!0),i&&(f[R]=M))),g&&m===w&&D&&D.name!==w&&(!i&&v?c(O,"name",w):(L=!0,k=function(){return r(D,this)})),m)if(C={values:I(w),keys:T?k:I(_),entries:I(S)},E)for(P in C)(x||L||!(P in O))&&d(O,P,C[P]);else n({target:t,proto:!0,forced:x||L},C);return(!i||E)&&O[b]!==k&&d(O,b,k,{name:m}),f[t]=k,C}})),Dp=Z(((e,t)=>{"use strict";t.exports=function(e,t){return{value:e,done:t}}})),gv=Z(((e,t)=>{"use strict";var n=Vi(),r=js(),i=Cp(),a=Ii(),s=Qr().f,o=ZE(),l=Dp(),h=ci(),u=An(),c="Array Iterator",d=a.set,p=a.getterFor(c);t.exports=o(Array,"Array",(function(e,t){d(this,{type:c,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(n,!1);case"values":return l(t[n],!1)}return l([n,t[n]],!1)}),"values");var f=i.Arguments=i.Array;if(r("keys"),r("values"),r("entries"),!h&&u&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}})),mq=Z((()=>{"use strict";var e=Je(),t=Ut(),n=rf(),r=Vi(),i=Bl(),a=t([].join);e({target:"Array",proto:!0,forced:n!==Object||!i("join",",")},{join:function(e){return a(r(this),void 0===e?",":e)}})})),rP=Z(((e,t)=>{"use strict";var n=Fa(),r=Vi(),i=gi(),a=Rr(),s=Bl(),o=Math.min,l=[].lastIndexOf,h=!!l&&1/[1].lastIndexOf(1,-0)<0,u=s("lastIndexOf"),c=h||!u;t.exports=c?function(e){if(h)return n(l,this,arguments)||0;var t=r(this),s=a(t),u=s-1;for(arguments.length>1&&(u=o(u,i(arguments[1]))),u<0&&(u=s+u);u>=0;u--)if(u in t&&t[u]===e)return u||0;return-1}:l})),xq=Z((()=>{"use strict";var e=Je(),t=rP();e({target:"Array",proto:!0,forced:t!==[].lastIndexOf},{lastIndexOf:t})})),bq=Z((()=>{"use strict";var e=Je(),t=Qi().map;e({target:"Array",proto:!0,forced:!Ip()("map")},{map:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),_q=Z((()=>{"use strict";var e=Je(),t=kt(),n=uf(),r=Dc(),i=Array;e({target:"Array",stat:!0,forced:t((function(){function e(){}return!(i.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,a=new(n(this)?this:i)(t);t>e;)r(a,e,arguments[e++]);return a.length=t,a}})})),JE=Z(((e,t)=>{"use strict";var n=An(),r=Rc(),i=TypeError,a=Object.getOwnPropertyDescriptor,s=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();t.exports=s?function(e,t){if(r(e)&&!a(e,"length").writable)throw new i("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}})),Sq=Z((()=>{"use strict";var e=Je(),t=Tr(),n=Rr(),r=JE(),i=mf();e({target:"Array",proto:!0,arity:1,forced:kt()((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var a=t(this),s=n(a),o=arguments.length;i(s+o);for(var l=0;l<o;l++)a[s]=arguments[l],s++;return r(a,s),s}})})),vv=Z(((e,t)=>{"use strict";var n=Jr(),r=Tr(),i=rf(),a=Rr(),s=TypeError,o=function(e){return function(t,o,l,h){var u=r(t),c=i(u),d=a(u);n(o);var p=e?d-1:0,f=e?-1:1;if(l<2)for(;;){if(p in c){h=c[p],p+=f;break}if(p+=f,e?p<0:d<=p)throw new s("Reduce of empty array with no initial value")}for(;e?p>=0:d>p;p+=f)p in c&&(h=o(h,c[p],p,u));return h}};t.exports={left:o(!1),right:o(!0)}})),Lc=Z(((e,t)=>{"use strict";var n=rn(),r=Ms();t.exports="process"===r(n.process)})),Rq=Z((()=>{"use strict";var e=Je(),t=vv().left,n=Bl(),r=Ol();e({target:"Array",proto:!0,forced:!Lc()&&r>79&&r<83||!n("reduce")},{reduce:function(e){var n=arguments.length;return t(this,e,n,n>1?arguments[1]:void 0)}})})),Iq=Z((()=>{"use strict";var e=Je(),t=vv().right,n=Bl(),r=Ol();e({target:"Array",proto:!0,forced:!Lc()&&r>79&&r<83||!n("reduceRight")},{reduceRight:function(e){return t(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})})),Oq=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Rc(),r=t([].reverse),i=[1,2];e({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return n(this)&&(this.length=this.length),r(this)}})})),Fq=Z((()=>{"use strict";var e=Je(),t=Rc(),n=uf(),r=Kn(),i=Fl(),a=Rr(),s=Vi(),o=Dc(),l=rr(),h=Ip(),u=ka(),c=h("slice"),d=l("species"),p=Array,f=Math.max;e({target:"Array",proto:!0,forced:!c},{slice:function(e,l){var h,c,m,g=s(this),v=a(g),y=i(e,v),x=i(void 0===l?v:l,v);if(t(g)&&(h=g.constructor,n(h)&&(h===p||t(h.prototype))?h=void 0:r(h)&&(null===(h=h[d])&&(h=void 0)),h===p||void 0===h))return u(g,y,x);for(c=new(void 0===h?p:h)(f(x-y,0)),m=0;y<x;y++,m++)y in g&&o(c,m,g[y]);return c.length=m,c}})})),Nq=Z((()=>{"use strict";var e=Je(),t=Qi().some;e({target:"Array",proto:!0,forced:!Bl()("some")},{some:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),QE=Z(((e,t)=>{"use strict";var n=ka(),r=Math.floor,i=function(e,t){var a=e.length;if(a<8)for(var s,o,l=1;l<a;){for(o=l,s=e[l];o&&t(e[o-1],s)>0;)e[o]=e[--o];o!==l++&&(e[o]=s)}else for(var h=r(a/2),u=i(n(e,0,h),t),c=i(n(e,h),t),d=u.length,p=c.length,f=0,m=0;f<d||m<p;)e[f+m]=f<d&&m<p?t(u[f],c[m])<=0?u[f++]:c[m++]:f<d?u[f++]:c[m++];return e};t.exports=i})),aP=Z(((e,t)=>{"use strict";var n=Dl().match(/firefox\/(\d+)/i);t.exports=!!n&&+n[1]})),oP=Z(((e,t)=>{"use strict";var n=Dl();t.exports=/MSIE|Trident/.test(n)})),e_=Z(((e,t)=>{"use strict";var n=Dl().match(/AppleWebKit\/(\d+)\./);t.exports=!!n&&+n[1]})),Qq=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Jr(),r=Tr(),i=Rr(),a=hv(),s=Fn(),o=kt(),l=QE(),h=Bl(),u=aP(),c=oP(),d=Ol(),p=e_(),f=[],m=t(f.sort),g=t(f.push),v=o((function(){f.sort(void 0)})),y=o((function(){f.sort(null)})),x=h("sort"),b=!o((function(){if(d)return d<70;if(!(u&&u>3)){if(c)return!0;if(p)return p<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)f.push({k:t+r,v:n})}for(f.sort((function(e,t){return t.v-e.v})),r=0;r<f.length;r++)t=f[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));e({target:"Array",proto:!0,forced:v||!y||!x||!b},{sort:function(e){void 0!==e&&n(e);var t=r(this);if(b)return void 0===e?m(t):m(t,e);var o,h,u=[],c=i(t);for(h=0;h<c;h++)h in t&&g(u,t[h]);for(l(u,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:s(t)>s(n)?1:-1}}(e)),o=i(u),h=0;h<o;)t[h]=u[h++];for(;h<c;)a(t,h++);return t}})})),gf=Z(((e,t)=>{"use strict";var n=Ur(),r=Ji(),i=rr(),a=An(),s=i("species");t.exports=function(e){var t=n(e);a&&t&&!t[s]&&r(t,s,{configurable:!0,get:function(){return this}})}})),nG=Z((()=>{"use strict";gf()("Array")})),rG=Z((()=>{"use strict";var e=Je(),t=Tr(),n=Fl(),r=gi(),i=Rr(),a=JE(),s=mf(),o=Tp(),l=Dc(),h=hv(),u=Ip()("splice"),c=Math.max,d=Math.min;e({target:"Array",proto:!0,forced:!u},{splice:function(e,u){var p,f,m,g,v,y,x=t(this),b=i(x),_=n(e,b),w=arguments.length;for(0===w?p=f=0:1===w?(p=0,f=b-_):(p=w-2,f=d(c(r(u),0),b-_)),s(b+p-f),m=o(x,f),g=0;g<f;g++)(v=_+g)in x&&l(m,g,x[v]);if(m.length=f,p<f){for(g=_;g<b-f;g++)y=g+p,(v=g+f)in x?x[y]=x[v]:h(x,y);for(g=b;g>b-f+p;g--)h(x,g-1)}else if(p>f)for(g=b-f;g>_;g--)y=g+p-1,(v=g+f-1)in x?x[y]=x[v]:h(x,y);for(g=0;g<p;g++)x[g+_]=arguments[g+2];return a(x,b-f+p),m}})})),uP=Z(((e,t)=>{"use strict";var n=Rr();t.exports=function(e,t){for(var r=n(e),i=new t(r),a=0;a<r;a++)i[a]=e[r-a-1];return i}})),sG=Z((()=>{"use strict";var e=Je(),t=uP(),n=Vi(),r=js(),i=Array;e({target:"Array",proto:!0},{toReversed:function(){return t(n(this),i)}}),r("toReversed")})),yv=Z(((e,t)=>{"use strict";var n=Rr();t.exports=function(e,t,r){for(var i=0,a=arguments.length>2?r:n(t),s=new e(a);a>i;)s[i]=t[i++];return s}})),lG=Z(((e,t)=>{"use strict";var n=rn();t.exports=function(e,t){var r=n[e],i=r&&r.prototype;return i&&i[t]}})),cG=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Jr(),r=Vi(),i=yv(),a=lG(),s=js(),o=Array,l=t(a("Array","sort"));e({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&n(e);var t=r(this),a=i(o,t);return l(a,e)}}),s("toSorted")})),uG=Z((()=>{"use strict";var e=Je(),t=js(),n=mf(),r=Rr(),i=Fl(),a=Vi(),s=gi(),o=Array,l=Math.max,h=Math.min;e({target:"Array",proto:!0},{toSpliced:function(e,t){var u,c,d,p,f=a(this),m=r(f),g=i(e,m),v=arguments.length,y=0;for(0===v?u=c=0:1===v?(u=0,c=m-g):(u=v-2,c=h(l(s(t),0),m-g)),d=n(m+u-c),p=o(d);y<g;y++)p[y]=f[y];for(;y<g+u;y++)p[y]=arguments[y-g+2];for(;y<d;y++)p[y]=f[y+c-u];return p}}),t("toSpliced")})),hG=Z((()=>{"use strict";js()("flat")})),fG=Z((()=>{"use strict";js()("flatMap")})),dG=Z((()=>{"use strict";var e=Je(),t=Tr(),n=Rr(),r=JE(),i=hv(),a=mf();e({target:"Array",proto:!0,arity:1,forced:1!==[].unshift(0)||!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}()},{unshift:function(e){var s=t(this),o=n(s),l=arguments.length;if(l){a(o+l);for(var h=o;h--;){var u=h+l;h in s?s[u]=s[h]:i(s,u)}for(var c=0;c<l;c++)s[c]=arguments[c]}return r(s,o+l)}})})),hP=Z(((e,t)=>{"use strict";var n=Rr(),r=gi(),i=RangeError;t.exports=function(e,t,a,s){var o=n(e),l=r(a),h=l<0?o+l:l;if(h>=o||h<0)throw new i("Incorrect index");for(var u=new t(o),c=0;c<o;c++)u[c]=c===h?s:e[c];return u}})),mG=Z((()=>{"use strict";var e=Je(),t=hP(),n=Vi(),r=Array;e({target:"Array",proto:!0},{with:function(e,i){return t(n(this),r,e,i)}})})),t_=Z(((e,t)=>{"use strict";t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView})),Op=Z(((e,t)=>{"use strict";var n=Xr();t.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}})),Jo=Z(((e,t)=>{"use strict";var n=ua(),r=TypeError;t.exports=function(e,t){if(n(t,e))return e;throw new r("Incorrect invocation")}})),fP=Z(((e,t)=>{"use strict";var n=gi(),r=ha(),i=RangeError;t.exports=function(e){if(void 0===e)return 0;var t=n(e),a=r(t);if(t!==a)throw new i("Wrong length or index");return a}})),n_=Z(((e,t)=>{"use strict";t.exports=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1}})),SG=Z(((e,t)=>{"use strict";var n=n_(),r=Math.abs,i=2220446049250313e-31,a=1/i;t.exports=function(e,t,s,o){var l=+e,h=r(l),u=n(l);if(h<o)return u*function(e){return e+a-a}(h/o/t)*o*t;var c=(1+t/i)*h,d=c-(c-h);return d>s||d!=d?u*(1/0):u*d}})),dP=Z(((e,t)=>{"use strict";var n=SG();t.exports=Math.fround||function(e){return n(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}})),AG=Z(((e,t)=>{"use strict";var n=Array,r=Math.abs,i=Math.pow,a=Math.floor,s=Math.log,o=Math.LN2;t.exports={pack:function(e,t,l){var h,u,c,d=n(l),p=8*l-t-1,f=(1<<p)-1,m=f>>1,g=23===t?i(2,-24)-i(2,-77):0,v=e<0||0===e&&1/e<0?1:0,y=0;for((e=r(e))!=e||e===1/0?(u=e!=e?1:0,h=f):(h=a(s(e)/o),e*(c=i(2,-h))<1&&(h--,c*=2),(e+=h+m>=1?g/c:g*i(2,1-m))*c>=2&&(h++,c/=2),h+m>=f?(u=0,h=f):h+m>=1?(u=(e*c-1)*i(2,t),h+=m):(u=e*i(2,m-1)*i(2,t),h=0));t>=8;)d[y++]=255&u,u/=256,t-=8;for(h=h<<t|u,p+=t;p>0;)d[y++]=255&h,h/=256,p-=8;return d[--y]|=128*v,d},unpack:function(e,t){var n,r=e.length,a=8*r-t-1,s=(1<<a)-1,o=s>>1,l=a-7,h=r-1,u=e[h--],c=127&u;for(u>>=7;l>0;)c=256*c+e[h--],l-=8;for(n=c&(1<<-l)-1,c>>=-l,l+=t;l>0;)n=256*n+e[h--],l-=8;if(0===c)c=1-o;else{if(c===s)return n?NaN:u?-1/0:1/0;n+=i(2,t),c-=o}return(u?-1:1)*n*i(2,c-t)}}})),Ev=Z(((e,t)=>{"use strict";var n,r,i,a=rn(),s=Ut(),o=An(),l=t_(),h=lf(),u=Cs(),c=Ji(),d=Op(),p=kt(),f=Jo(),m=gi(),g=ha(),v=fP(),y=dP(),x=AG(),b=Na(),_=Ko(),w=jE(),S=ka(),M=Uu(),T=bp(),E=Ws(),A=Ii(),C=h.PROPER,P=h.CONFIGURABLE,I="ArrayBuffer",R="DataView",L="prototype",O="Wrong index",D=A.getterFor(I),k=A.getterFor(R),N=A.set,F=a[I],U=F,B=U&&U[L],z=a[R],H=z&&z[L],V=Object.prototype,j=a.Array,G=a.RangeError,W=s(w),q=s([].reverse),X=x.pack,Y=x.unpack,Z=function(e){return[255&e]},J=function(e){return[255&e,e>>8&255]},K=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Q=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},$=function(e){return X(y(e),23,4)},ee=function(e){return X(e,52,8)},te=function(e,t,n){c(e[L],t,{configurable:!0,get:function(){return n(this)[t]}})},ne=function(e,t,n,r){var i=k(e),a=v(n),s=!!r;if(a+t>i.byteLength)throw new G(O);var o=i.bytes,l=a+i.byteOffset,h=S(o,l,l+t);return s?h:q(h)},re=function(e,t,n,r,i,a){var s=k(e),o=v(n),l=r(+i),h=!!a;if(o+t>s.byteLength)throw new G(O);for(var u=s.bytes,c=o+s.byteOffset,d=0;d<t;d++)u[c+d]=l[h?d:t-d-1]};l?(n=C&&F.name!==I,p((function(){F(1)}))&&p((function(){new F(-1)}))&&!p((function(){return new F,new F(1.5),new F(NaN),1!==F.length||n&&!P}))?n&&P&&u(F,"name",I):((U=function(e){return f(this,B),M(new F(v(e)),this,U)})[L]=B,B.constructor=U,T(U,F)),_&&b(H)!==V&&_(H,V),r=new z(new U(2)),i=s(H.setInt8),r.setInt8(0,2147483648),r.setInt8(1,2147483649),(r.getInt8(0)||!r.getInt8(1))&&d(H,{setInt8:function(e,t){i(this,e,t<<24>>24)},setUint8:function(e,t){i(this,e,t<<24>>24)}},{unsafe:!0})):(B=(U=function(e){f(this,B);var t=v(e);N(this,{type:I,bytes:W(j(t),0),byteLength:t}),o||(this.byteLength=t,this.detached=!1)})[L],H=(z=function(e,t,n){f(this,H),f(e,B);var r=D(e),i=r.byteLength,a=m(t);if(a<0||a>i)throw new G("Wrong offset");if(a+(n=void 0===n?i-a:g(n))>i)throw new G("Wrong length");N(this,{type:R,buffer:e,byteLength:n,byteOffset:a,bytes:r.bytes}),o||(this.buffer=e,this.byteLength=n,this.byteOffset=a)})[L],o&&(te(U,"byteLength",D),te(z,"buffer",k),te(z,"byteLength",k),te(z,"byteOffset",k)),d(H,{getInt8:function(e){return ne(this,1,e)[0]<<24>>24},getUint8:function(e){return ne(this,1,e)[0]},getInt16:function(e){var t=ne(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=ne(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return Q(ne(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return Q(ne(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return Y(ne(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return Y(ne(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){re(this,1,e,Z,t)},setUint8:function(e,t){re(this,1,e,Z,t)},setInt16:function(e,t){re(this,2,e,J,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){re(this,2,e,J,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){re(this,4,e,K,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){re(this,4,e,K,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){re(this,4,e,$,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){re(this,8,e,ee,t,arguments.length>2&&arguments[2])}})),E(U,I),E(z,R),t.exports={ArrayBuffer:U,DataView:z}})),jG=Z((()=>{"use strict";var e=Je(),t=rn(),n=Ev(),r=gf(),i="ArrayBuffer",a=n[i];e({global:!0,constructor:!0,forced:t[i]!==a},{ArrayBuffer:a}),r(i)})),Jn=Z(((e,t)=>{"use strict";var n,r,i,a=t_(),s=An(),o=rn(),l=lr(),h=Kn(),u=pr(),c=Zo(),d=ku(),p=Cs(),f=Xr(),m=Ji(),g=ua(),v=Na(),y=Ko(),x=rr(),b=of(),_=Ii(),w=_.enforce,S=_.get,M=o.Int8Array,T=M&&M.prototype,E=o.Uint8ClampedArray,A=E&&E.prototype,C=M&&v(M),P=T&&v(T),I=Object.prototype,R=o.TypeError,L=x("toStringTag"),O=b("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",k=a&&!!y&&"Opera"!==c(o.opera),N=!1,F={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},B=function(e){var t=v(e);if(h(t)){var n=S(t);return n&&u(n,D)?n[D]:B(t)}},z=function(e){if(!h(e))return!1;var t=c(e);return u(F,t)||u(U,t)};for(n in F)(i=(r=o[n])&&r.prototype)?w(i)[D]=r:k=!1;for(n in U)(i=(r=o[n])&&r.prototype)&&(w(i)[D]=r);if((!k||!l(C)||C===Function.prototype)&&(C=function(){throw new R("Incorrect invocation")},k))for(n in F)o[n]&&y(o[n],C);if((!k||!P||P===I)&&(P=C.prototype,k))for(n in F)o[n]&&y(o[n].prototype,P);if(k&&v(A)!==P&&y(A,P),s&&!u(P,L))for(n in N=!0,m(P,L,{configurable:!0,get:function(){return h(this)?this[O]:void 0}}),F)o[n]&&p(o[n],O,n);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:N&&O,aTypedArray:function(e){if(z(e))return e;throw new R("Target is not a typed array")},aTypedArrayConstructor:function(e){if(l(e)&&(!y||g(C,e)))return e;throw new R(d(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(s){if(n)for(var i in F){var a=o[i];if(a&&u(a.prototype,e))try{delete a.prototype[e]}catch(n){try{a.prototype[e]=t}catch(e){}}}(!P[e]||n)&&f(P,e,n?t:k&&T[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(s){if(y){if(n)for(r in F)if((i=o[r])&&u(i,e))try{delete i[e]}catch(e){}if(C[e]&&!n)return;try{return f(C,e,n?t:k&&C[e]||t)}catch(e){}}for(r in F)(i=o[r])&&(!i[e]||n)&&f(i,e,t)}},getTypedArrayConstructor:B,isView:function(e){if(!h(e))return!1;var t=c(e);return"DataView"===t||u(F,t)||u(U,t)},isTypedArray:z,TypedArray:C,TypedArrayPrototype:P}})),iW=Z((()=>{"use strict";var e=Je(),t=Jn();e({target:"ArrayBuffer",stat:!0,forced:!t.NATIVE_ARRAY_BUFFER_VIEWS},{isView:t.isView})})),d_=Z(((e,t)=>{"use strict";var n=uf(),r=ku(),i=TypeError;t.exports=function(e){if(n(e))return e;throw new i(r(e)+" is not a constructor")}})),yf=Z(((e,t)=>{"use strict";var n=Gn(),r=d_(),i=qs(),a=rr()("species");t.exports=function(e,t){var s,o=n(e).constructor;return void 0===o||i(s=n(o)[a])?t:r(s)}})),dW=Z((()=>{"use strict";var e=Je(),t=Cc(),n=kt(),r=Ev(),i=Gn(),a=Fl(),s=ha(),o=yf(),l=r.ArrayBuffer,h=r.DataView,u=h.prototype,c=t(l.prototype.slice),d=t(u.getUint8),p=t(u.setUint8);e({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:n((function(){return!new l(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(c&&void 0===t)return c(i(this),e);for(var n=i(this).byteLength,r=a(e,n),u=a(void 0===t?n:t,n),f=new(o(this,l))(s(u-r)),m=new h(this),g=new h(f),v=0;r<u;)p(g,v++,d(m,r++));return f}})})),pW=Z((()=>{"use strict";var e=Je(),t=Ev();e({global:!0,constructor:!0,forced:!t_()},{DataView:t.DataView})})),mW=Z((()=>{"use strict";pW()})),gW=Z((()=>{"use strict";var e=Je(),t=Ut(),n=kt()((function(){return 120!==new Date(16e11).getYear()})),r=t(Date.prototype.getFullYear);e({target:"Date",proto:!0,forced:n},{getYear:function(){return r(this)-1900}})})),yW=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Date,r=t(n.prototype.getTime);e({target:"Date",stat:!0},{now:function(){return r(new n)}})})),EW=Z((()=>{"use strict";var e=Je(),t=Ut(),n=gi(),r=Date.prototype,i=t(r.getTime),a=t(r.setFullYear);e({target:"Date",proto:!0},{setYear:function(e){i(this);var t=n(e);return a(this,t>=0&&t<=99?t+1900:t)}})})),_W=Z((()=>{"use strict";Je()({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})})),_v=Z(((e,t)=>{"use strict";var n=gi(),r=Fn(),i=Kr(),a=RangeError;t.exports=function(e){var t=r(i(this)),s="",o=n(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(s+=t);return s}})),p_=Z(((e,t)=>{"use strict";var n=Ut(),r=ha(),i=Fn(),a=_v(),s=Kr(),o=n(a),l=n("".slice),h=Math.ceil,u=function(e){return function(t,n,a){var u,c,d=i(s(t)),p=r(n),f=d.length,m=void 0===a?" ":i(a);return p<=f||""===m?d:((c=o(m,h((u=p-f)/m.length))).length>u&&(c=l(c,0,u)),e?d+c:c+d)}};t.exports={start:u(!1),end:u(!0)}})),PW=Z(((e,t)=>{"use strict";var n=Ut(),r=kt(),i=p_().start,a=RangeError,s=isFinite,o=Math.abs,l=Date.prototype,h=l.toISOString,u=n(l.getTime),c=n(l.getUTCDate),d=n(l.getUTCFullYear),p=n(l.getUTCHours),f=n(l.getUTCMilliseconds),m=n(l.getUTCMinutes),g=n(l.getUTCMonth),v=n(l.getUTCSeconds);t.exports=r((function(){return"0385-07-25T07:06:39.999Z"!==h.call(new Date(-50000000000001))}))||!r((function(){h.call(new Date(NaN))}))?function(){if(!s(u(this)))throw new a("Invalid time value");var e=this,t=d(e),n=f(e),r=t<0?"-":t>9999?"+":"";return r+i(o(t),r?6:4,0)+"-"+i(g(e)+1,2,0)+"-"+i(c(e),2,0)+"T"+i(p(e),2,0)+":"+i(m(e),2,0)+":"+i(v(e),2,0)+"."+i(n,3,0)+"Z"}:h})),DW=Z((()=>{"use strict";var e=Je(),t=PW();e({target:"Date",proto:!0,forced:Date.prototype.toISOString!==t},{toISOString:t})})),OW=Z((()=>{"use strict";var e=Je(),t=kt(),n=Tr(),r=K0();e({target:"Date",proto:!0,arity:1,forced:t((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(e){var t=n(this),i=r(t,"number");return"number"!=typeof i||isFinite(i)?t.toISOString():null}})})),kW=Z(((e,t)=>{"use strict";var n=Gn(),r=D3(),i=TypeError;t.exports=function(e){if(n(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw new i("Incorrect hint");return r(this,e)}})),BW=Z((()=>{"use strict";var e=pr(),t=Xr(),n=kW(),r=rr()("toPrimitive"),i=Date.prototype;e(i,r)||t(i,r,n)})),zW=Z((()=>{"use strict";var e=Ut(),t=Xr(),n=Date.prototype,r="Invalid Date",i="toString",a=e(n[i]),s=e(n.getTime);String(new Date(NaN))!==r&&t(n,i,(function(){var e=s(this);return e==e?a(this):r}))})),GW=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Fn(),r=t("".charAt),i=t("".charCodeAt),a=t(/./.exec),s=t(1..toString),o=t("".toUpperCase),l=/[\w*+\-./@]/,h=function(e,t){for(var n=s(e,16);n.length<t;)n="0"+n;return n};e({global:!0},{escape:function(e){for(var t,s,u=n(e),c="",d=u.length,p=0;p<d;)t=r(u,p++),a(l,t)?c+=t:c+=(s=i(t,0))<256?"%"+h(s,2):"%u"+o(h(s,4));return c}})})),LP=Z(((e,t)=>{"use strict";var n=Ut(),r=Jr(),i=Kn(),a=pr(),s=ka(),o=gp(),l=Function,h=n([].concat),u=n([].join),c={};t.exports=o?l.bind:function(e){var t=r(this),n=t.prototype,o=s(arguments,1),d=function(){var n=h(o,s(arguments));return this instanceof d?function(e,t,n){if(!a(c,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";c[t]=l("C,a","return new C("+u(r,",")+")")}return c[t](e,n)}(t,n.length,n):t.apply(e,n)};return i(n)&&(d.prototype=n),d}})),ZW=Z((()=>{"use strict";var e=Je(),t=LP();e({target:"Function",proto:!0,forced:Function.bind!==t},{bind:t})})),QW=Z((()=>{"use strict";var e=lr(),t=Kn(),n=Qr(),r=ua(),i=rr(),a=EE(),s=i("hasInstance"),o=Function.prototype;s in o||n.f(o,s,{value:a((function(n){if(!e(this)||!t(n))return!1;var i=this.prototype;return t(i)?r(i,n):n instanceof this}),s)})})),rj=Z((()=>{"use strict";var e=An(),t=lf().EXISTS,n=Ut(),r=Ji(),i=Function.prototype,a=n(i.toString),s=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,o=n(s.exec);e&&!t&&r(i,"name",{configurable:!0,get:function(){try{return o(s,a(this))[1]}catch(e){return""}}})})),ij=Z((()=>{"use strict";var e=Je(),t=rn();e({global:!0,forced:t.globalThis!==t},{globalThis:t})})),sj=Z((()=>{"use strict";var e=rn();Ws()(e.JSON,"JSON",!0)})),m_=Z(((e,t)=>{"use strict";var n=kt();t.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))})),v_=Z(((e,t)=>{"use strict";var n=kt(),r=Kn(),i=Ms(),a=m_(),s=Object.isExtensible,o=n((function(){s(1)}));t.exports=o||a?function(e){return!(!r(e)||a&&"ArrayBuffer"===i(e))&&(!s||s(e))}:s})),bf=Z(((e,t)=>{"use strict";var n=kt();t.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))})),ju=Z(((e,t)=>{"use strict";var n=Je(),r=Ut(),i=yp(),a=Kn(),s=pr(),o=Qr().f,l=Fu(),h=RE(),u=v_(),c=of(),d=bf(),p=!1,f=c("meta"),m=0,g=function(e){o(e,f,{value:{objectID:"O"+m++,weakData:{}}})},v=t.exports={enable:function(){v.enable=function(){},p=!0;var e=l.f,t=r([].splice),i={};i[f]=1,e(i).length&&(l.f=function(n){for(var r=e(n),i=0,a=r.length;i<a;i++)if(r[i]===f){t(r,i,1);break}return r},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:h.f}))},fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,f)){if(!u(e))return"F";if(!t)return"E";g(e)}return e[f].objectID},getWeakData:function(e,t){if(!s(e,f)){if(!u(e))return!0;if(!t)return!1;g(e)}return e[f].weakData},onFreeze:function(e){return d&&p&&u(e)&&!s(e,f)&&g(e),e}};i[f]=!0})),Sv=Z(((e,t)=>{"use strict";var n=Je(),r=rn(),i=Ut(),a=Ep(),s=Xr(),o=ju(),l=Ba(),h=Jo(),u=lr(),c=qs(),d=Kn(),p=kt(),f=dv(),m=Ws(),g=Uu();t.exports=function(e,t,v){var y=-1!==e.indexOf("Map"),x=-1!==e.indexOf("Weak"),b=y?"set":"add",_=r[e],w=_&&_.prototype,S=_,M={},T=function(e){var t=i(w[e]);s(w,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(x&&!d(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return x&&!d(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(x&&!d(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(a(e,!u(_)||!(x||w.forEach&&!p((function(){(new _).entries().next()})))))S=v.getConstructor(t,e,y,b),o.enable();else if(a(e,!0)){var E=new S,A=E[b](x?{}:-0,1)!==E,C=p((function(){E.has(1)})),P=f((function(e){new _(e)})),I=!x&&p((function(){for(var e=new _,t=5;t--;)e[b](t,t);return!e.has(-0)}));P||((S=t((function(e,t){h(e,w);var n=g(new _,e,S);return c(t)||l(t,n[b],{that:n,AS_ENTRIES:y}),n}))).prototype=w,w.constructor=S),(C||I)&&(T("delete"),T("has"),y&&T("get")),(I||A)&&T(b),x&&w.clear&&delete w.clear}return M[e]=S,n({global:!0,constructor:!0,forced:S!==_},M),m(S,e),x||v.setStrong(S,e,y),S}})),qP=Z(((e,t)=>{"use strict";var n=fa(),r=Ji(),i=Op(),a=uo(),s=Jo(),o=qs(),l=Ba(),h=ZE(),u=Dp(),c=gf(),d=An(),p=ju().fastKey,f=Ii(),m=f.set,g=f.getterFor;t.exports={getConstructor:function(e,t,h,u){var c=e((function(e,r){s(e,f),m(e,{type:t,index:n(null),first:void 0,last:void 0,size:0}),d||(e.size=0),o(r)||l(r,e[u],{that:e,AS_ENTRIES:h})})),f=c.prototype,v=g(t),y=function(e,t,n){var r,i,a=v(e),s=x(e,t);return s?s.value=n:(a.last=s={index:i=p(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),d?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},x=function(e,t){var n,r=v(e),i=p(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key===t)return n};return i(f,{clear:function(){for(var e=v(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=void 0),t=t.next;e.first=e.last=void 0,e.index=n(null),d?e.size=0:this.size=0},delete:function(e){var t=this,n=v(t),r=x(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first===r&&(n.first=i),n.last===r&&(n.last=a),d?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=v(this),r=a(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!x(this,e)}}),i(f,h?{get:function(e){var t=x(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),d&&r(f,"size",{configurable:!0,get:function(){return v(this).size}}),c},setStrong:function(e,t,n){var r=t+" Iterator",i=g(t),a=g(r);h(e,t,(function(e,t){m(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?u("keys"===t?n.key:"values"===t?n.value:[n.key,n.value],!1):(e.target=void 0,u(void 0,!0))}),n?"entries":"values",!n,!0),c(t)}}})),Ej=Z((()=>{"use strict";Sv()("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),qP())})),_j=Z((()=>{"use strict";Ej()})),GP=Z(((e,t)=>{"use strict";var n=Ut(),r=Map.prototype;t.exports={Map:Map,set:n(r.set),get:n(r.get),has:n(r.has),remove:n(r.delete),proto:r}})),Sj=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Jr(),r=Kr(),i=Ba(),a=GP(),s=ci(),o=a.Map,l=a.has,h=a.get,u=a.set,c=t([].push);e({target:"Map",stat:!0,forced:s},{groupBy:function(e,t){r(e),n(t);var a=new o,s=0;return i(e,(function(e){var n=t(e,s++);l(a,n)?c(h(a,n),e):u(a,n,[e])})),a}})})),WP=Z(((e,t)=>{"use strict";var n=Math.log;t.exports=Math.log1p||function(e){var t=+e;return t>-1e-8&&t<1e-8?t-t*t/2:n(1+t)}})),Aj=Z((()=>{"use strict";var e=Je(),t=WP(),n=Math.acosh,r=Math.log,i=Math.sqrt,a=Math.LN2;e({target:"Math",stat:!0,forced:!n||710!==Math.floor(n(Number.MAX_VALUE))||n(1/0)!==1/0},{acosh:function(e){var n=+e;return n<1?NaN:n>94906265.62425156?r(n)+a:t(n-1+i(n-1)*i(n+1))}})})),Pj=Z((()=>{"use strict";var e=Je(),t=Math.asinh,n=Math.log,r=Math.sqrt;e({target:"Math",stat:!0,forced:!(t&&1/t(0)>0)},{asinh:function e(t){var i=+t;return isFinite(i)&&0!==i?i<0?-e(-i):n(i+r(i*i+1)):i}})})),Dj=Z((()=>{"use strict";var e=Je(),t=Math.atanh,n=Math.log;e({target:"Math",stat:!0,forced:!(t&&1/t(-0)<0)},{atanh:function(e){var t=+e;return 0===t?t:n((1+t)/(1-t))/2}})})),Oj=Z((()=>{"use strict";var e=Je(),t=n_(),n=Math.abs,r=Math.pow;e({target:"Math",stat:!0},{cbrt:function(e){var i=+e;return t(i)*r(n(i),1/3)}})})),Lj=Z((()=>{"use strict";var e=Je(),t=Math.floor,n=Math.log,r=Math.LOG2E;e({target:"Math",stat:!0},{clz32:function(e){var i=e>>>0;return i?31-t(n(i+.5)*r):32}})})),Cv=Z(((e,t)=>{"use strict";var n=Math.expm1,r=Math.exp;t.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!==n(-2e-17)?function(e){var t=+e;return 0===t?t:t>-1e-6&&t<1e-6?t+t*t/2:r(t)-1}:n})),Nj=Z((()=>{"use strict";var e=Je(),t=Cv(),n=Math.cosh,r=Math.abs,i=Math.E;e({target:"Math",stat:!0,forced:!n||n(710)===1/0},{cosh:function(e){var n=t(r(e)-1)+1;return(n+1/(n*i*i))*(i/2)}})})),Uj=Z((()=>{"use strict";var e=Je(),t=Cv();e({target:"Math",stat:!0,forced:t!==Math.expm1},{expm1:t})})),Hj=Z((()=>{"use strict";Je()({target:"Math",stat:!0},{fround:dP()})})),zj=Z((()=>{"use strict";var e=Je(),t=Math.hypot,n=Math.abs,r=Math.sqrt;e({target:"Math",stat:!0,arity:2,forced:!!t&&t(1/0,NaN)!==1/0},{hypot:function(e,t){for(var i,a,s=0,o=0,l=arguments.length,h=0;o<l;)h<(i=n(arguments[o++]))?(s=s*(a=h/i)*a+1,h=i):i>0?s+=(a=i/h)*a:s+=i;return h===1/0?1/0:h*r(s)}})})),Gj=Z((()=>{"use strict";var e=Je(),t=kt(),n=Math.imul;e({target:"Math",stat:!0,forced:t((function(){return-5!==n(4294967295,5)||2!==n.length}))},{imul:function(e,t){var n=65535,r=+e,i=+t,a=n&r,s=n&i;return 0|a*s+((n&r>>>16)*s+a*(n&i>>>16)<<16>>>0)}})})),YP=Z(((e,t)=>{"use strict";var n=Math.log,r=Math.LOG10E;t.exports=Math.log10||function(e){return n(e)*r}})),jj=Z((()=>{"use strict";Je()({target:"Math",stat:!0},{log10:YP()})})),Xj=Z((()=>{"use strict";Je()({target:"Math",stat:!0},{log1p:WP()})})),Yj=Z((()=>{"use strict";var e=Je(),t=Math.log,n=Math.LN2;e({target:"Math",stat:!0},{log2:function(e){return t(e)/n}})})),$j=Z((()=>{"use strict";Je()({target:"Math",stat:!0},{sign:n_()})})),Jj=Z((()=>{"use strict";var e=Je(),t=kt(),n=Cv(),r=Math.abs,i=Math.exp,a=Math.E;e({target:"Math",stat:!0,forced:t((function(){return-2e-17!==Math.sinh(-2e-17)}))},{sinh:function(e){var t=+e;return r(t)<1?(n(t)-n(-t))/2:(i(t-1)-i(-t-1))*(a/2)}})})),tX=Z((()=>{"use strict";var e=Je(),t=Cv(),n=Math.exp;e({target:"Math",stat:!0},{tanh:function(e){var r=+e,i=t(r),a=t(-r);return i===1/0?1:a===1/0?-1:(i-a)/(n(r)+n(-r))}})})),nX=Z((()=>{"use strict";Ws()(Math,"Math",!0)})),rX=Z((()=>{"use strict";Je()({target:"Math",stat:!0},{trunc:Z3()})})),Rv=Z(((e,t)=>{"use strict";var n=Ut();t.exports=n(1..valueOf)})),Pv=Z(((e,t)=>{"use strict";t.exports="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"})),Ef=Z(((e,t)=>{"use strict";var n=Ut(),r=Kr(),i=Fn(),a=Pv(),s=n("".replace),o=RegExp("^["+a+"]+"),l=RegExp("(^|[^"+a+"])["+a+"]+$"),h=function(e){return function(t){var n=i(r(t));return 1&e&&(n=s(n,o,"")),2&e&&(n=s(n,l,"$1")),n}};t.exports={start:h(1),end:h(2),trim:h(3)}})),pX=Z((()=>{"use strict";var e=Je(),t=ci(),n=An(),r=rn(),i=PE(),a=Ut(),s=Ep(),o=pr(),l=Uu(),h=ua(),u=Lu(),c=K0(),d=kt(),p=Fu().f,f=As().f,m=Qr().f,g=Rv(),v=Ef().trim,y="Number",x=r[y],b=i[y],_=x.prototype,w=r.TypeError,S=a("".slice),M=a("".charCodeAt),T=function(e){var t,n,r,i,a,s,o,l,h=c(e,"number");if(u(h))throw new w("Cannot convert a Symbol value to a number");if("string"==typeof h&&h.length>2)if(h=v(h),43===(t=M(h,0))||45===t){if(88===(n=M(h,2))||120===n)return NaN}else if(48===t){switch(M(h,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+h}for(s=(a=S(h,2)).length,o=0;o<s;o++)if((l=M(a,o))<48||l>i)return NaN;return parseInt(a,r)}return+h},E=s(y,!x(" 0o1")||!x("0b1")||x("+0x1")),A=function(e){var t,n=arguments.length<1?0:x(function(e){var t=c(e,"number");return"bigint"==typeof t?t:T(t)}(e));return h(_,t=this)&&d((function(){g(t)}))?l(Object(n),this,A):n};A.prototype=_,E&&!t&&(_.constructor=A),e({global:!0,constructor:!0,wrap:!0,forced:E},{Number:A});var C=function(e,t){for(var r,i=n?p(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),a=0;i.length>a;a++)o(t,r=i[a])&&!o(e,r)&&m(e,r,f(t,r))};t&&b&&C(i[y],b),(E||t)&&C(i[y],x)})),mX=Z((()=>{"use strict";Je()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})})),vX=Z(((e,t)=>{"use strict";var n=rn().isFinite;t.exports=Number.isFinite||function(e){return"number"==typeof e&&n(e)}})),yX=Z((()=>{"use strict";Je()({target:"Number",stat:!0},{isFinite:vX()})})),T_=Z(((e,t)=>{"use strict";var n=Kn(),r=Math.floor;t.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&r(e)===e}})),bX=Z((()=>{"use strict";Je()({target:"Number",stat:!0},{isInteger:T_()})})),EX=Z((()=>{"use strict";Je()({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})})),_X=Z((()=>{"use strict";var e=Je(),t=T_(),n=Math.abs;e({target:"Number",stat:!0},{isSafeInteger:function(e){return t(e)&&n(e)<=9007199254740991}})})),TX=Z((()=>{"use strict";Je()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})})),SX=Z((()=>{"use strict";Je()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})})),tI=Z(((e,t)=>{"use strict";var n=rn(),r=kt(),i=Ut(),a=Fn(),s=Ef().trim,o=Pv(),l=i("".charAt),h=n.parseFloat,u=n.Symbol,c=u&&u.iterator,d=1/h(o+"-0")!=-1/0||c&&!r((function(){h(Object(c))}));t.exports=d?function(e){var t=s(a(e)),n=h(t);return 0===n&&"-"===l(t,0)?-0:n}:h})),PX=Z((()=>{"use strict";var e=Je(),t=tI();e({target:"Number",stat:!0,forced:Number.parseFloat!==t},{parseFloat:t})})),nI=Z(((e,t)=>{"use strict";var n=rn(),r=kt(),i=Ut(),a=Fn(),s=Ef().trim,o=Pv(),l=n.parseInt,h=n.Symbol,u=h&&h.iterator,c=/^[+-]?0x/i,d=i(c.exec),p=8!==l(o+"08")||22!==l(o+"0x16")||u&&!r((function(){l(Object(u))}));t.exports=p?function(e,t){var n=s(a(e));return l(n,t>>>0||(d(c,n)?16:10))}:l})),BX=Z((()=>{"use strict";var e=Je(),t=nI();e({target:"Number",stat:!0,forced:Number.parseInt!==t},{parseInt:t})})),qX=Z((()=>{"use strict";var e=Je(),t=Ut(),n=gi(),r=Rv(),i=_v(),a=YP(),s=kt(),o=RangeError,l=String,h=isFinite,u=Math.abs,c=Math.floor,d=Math.pow,p=Math.round,f=t(1..toExponential),m=t(i),g=t("".slice),v="-6.9000e-11"===f(-69e-12,4)&&"1.25e+0"===f(1.255,2)&&"1.235e+4"===f(12345,3)&&"3e+1"===f(25,0);e({target:"Number",proto:!0,forced:!v||!(s((function(){f(1,1/0)}))&&s((function(){f(1,-1/0)})))||!!s((function(){f(1/0,1/0),f(NaN,1/0)}))},{toExponential:function(e){var t=r(this);if(void 0===e)return f(t);var i=n(e);if(!h(t))return String(t);if(i<0||i>20)throw new o("Incorrect fraction digits");if(v)return f(t,i);var s="",y="",x=0,b="",_="";if(t<0&&(s="-",t=-t),0===t)x=0,y=m("0",i+1);else{var w=a(t);x=c(w);var S=0,M=d(10,x-i);2*t>=(2*(S=p(t/M))+1)*M&&(S+=1),S>=d(10,i+1)&&(S/=10,x+=1),y=l(S)}return 0!==i&&(y=g(y,0,1)+"."+g(y,1)),0===x?(b="+",_="0"):(b=x>0?"+":"-",_=l(u(x))),s+(y+="e"+b+_)}})})),$X=Z((()=>{"use strict";var e=Je(),t=Ut(),n=gi(),r=Rv(),i=_v(),a=kt(),s=RangeError,o=String,l=Math.floor,h=t(i),u=t("".slice),c=t(1..toFixed),d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)},p=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=l(i/1e7)},f=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=l(r/t),r=r%t*1e7},m=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=o(e[t]);n=""===n?r:n+h("0",7-r.length)+r}return n};e({target:"Number",proto:!0,forced:a((function(){return"0.000"!==c(8e-5,3)||"1"!==c(.9,0)||"1.25"!==c(1.255,2)||"1000000000000000128"!==c(0xde0b6b3a7640080,0)}))||!a((function(){c({})}))},{toFixed:function(e){var t,i,a,l,c=r(this),g=n(e),v=[0,0,0,0,0,0],y="",x="0";if(g<0||g>20)throw new s("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return o(c);if(c<0&&(y="-",c=-c),c>1e-21)if(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(c*d(2,69,1))-69,i=t<0?c*d(2,-t,1):c/d(2,t,1),i*=4503599627370496,(t=52-t)>0){for(p(v,0,i),a=g;a>=7;)p(v,1e7,0),a-=7;for(p(v,d(10,a,1),0),a=t-1;a>=23;)f(v,1<<23),a-=23;f(v,1<<a),p(v,1,1),f(v,2),x=m(v)}else p(v,0,i),p(v,1<<-t,0),x=m(v)+h("0",g);return g>0?x=y+((l=x.length)<=g?"0."+h("0",g-l)+x:u(x,0,l-g)+"."+u(x,l-g)):x=y+x,x}})})),JX=Z((()=>{"use strict";var e=Je(),t=Ut(),n=kt(),r=Rv(),i=t(1..toPrecision);e({target:"Number",proto:!0,forced:n((function(){return"1"!==i(1,void 0)}))||!n((function(){i({})}))},{toPrecision:function(e){return void 0===e?i(r(this)):i(r(this),e)}})})),cI=Z(((e,t)=>{"use strict";var n=An(),r=Ut(),i=qn(),a=kt(),s=_p(),o=tv(),l=Z0(),h=Tr(),u=rf(),c=Object.assign,d=Object.defineProperty,p=r([].concat);t.exports=!c||a((function(){if(n&&1!==c({b:1},c(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!==c({},e)[r]||s(c({},t)).join("")!==i}))?function(e,t){for(var r=h(e),a=arguments.length,c=1,d=o.f,f=l.f;a>c;)for(var m,g=u(arguments[c++]),v=d?p(s(g),d(g)):s(g),y=v.length,x=0;y>x;)m=v[x++],(!n||i(f,g,m))&&(r[m]=g[m]);return r}:c})),rY=Z((()=>{"use strict";var e=Je(),t=cI();e({target:"Object",stat:!0,arity:2,forced:Object.assign!==t},{assign:t})})),iY=Z((()=>{"use strict";Je()({target:"Object",stat:!0,sham:!An()},{create:fa()})})),Lv=Z(((e,t)=>{"use strict";var n=ci(),r=rn(),i=kt(),a=e_();t.exports=n||!i((function(){if(!(a&&a<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete r[e]}}))})),oY=Z((()=>{"use strict";var e=Je(),t=An(),n=Lv(),r=Jr(),i=Tr(),a=Qr();t&&e({target:"Object",proto:!0,forced:n},{__defineGetter__:function(e,t){a.f(i(this),e,{get:r(t),enumerable:!0,configurable:!0})}})})),cY=Z((()=>{"use strict";var e=Je(),t=An(),n=ME().f;e({target:"Object",stat:!0,forced:Object.defineProperties!==n,sham:!t},{defineProperties:n})})),hY=Z((()=>{"use strict";var e=Je(),t=An(),n=Qr().f;e({target:"Object",stat:!0,forced:Object.defineProperty!==n,sham:!t},{defineProperty:n})})),fY=Z((()=>{"use strict";var e=Je(),t=An(),n=Lv(),r=Jr(),i=Tr(),a=Qr();t&&e({target:"Object",proto:!0,forced:n},{__defineSetter__:function(e,t){a.f(i(this),e,{set:r(t),enumerable:!0,configurable:!0})}})})),uI=Z(((e,t)=>{"use strict";var n=An(),r=kt(),i=Ut(),a=Na(),s=_p(),o=Vi(),l=i(Z0().f),h=i([].push),u=n&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,i=o(t),c=s(i),d=u&&null===a(i),p=c.length,f=0,m=[];p>f;)r=c[f++],(!n||(d?r in i:l(i,r)))&&h(m,e?[r,i[r]]:i[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),yY=Z((()=>{"use strict";var e=Je(),t=uI().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),xY=Z((()=>{"use strict";var e=Je(),t=bf(),n=kt(),r=Kn(),i=ju().onFreeze,a=Object.freeze;e({target:"Object",stat:!0,forced:n((function(){a(1)})),sham:!t},{freeze:function(e){return a&&r(e)?a(i(e)):e}})})),bY=Z((()=>{"use strict";var e=Je(),t=Ba(),n=Dc();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){n(r,e,t)}),{AS_ENTRIES:!0}),r}})})),TY=Z((()=>{"use strict";var e=Je(),t=kt(),n=Vi(),r=As().f,i=An();e({target:"Object",stat:!0,forced:!i||t((function(){r(1)})),sham:!i},{getOwnPropertyDescriptor:function(e,t){return r(n(e),t)}})})),SY=Z((()=>{"use strict";var e=Je(),t=An(),n=TE(),r=Vi(),i=As(),a=Dc();e({target:"Object",stat:!0,sham:!t},{getOwnPropertyDescriptors:function(e){for(var t,s,o=r(e),l=i.f,h=n(o),u={},c=0;h.length>c;)void 0!==(s=l(o,t=h[c++]))&&a(u,t,s);return u}})})),wY=Z((()=>{"use strict";var e=Je(),t=kt(),n=RE().f;e({target:"Object",stat:!0,forced:t((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:n})})),AY=Z((()=>{"use strict";var e=Je(),t=kt(),n=Tr(),r=Na(),i=VE();e({target:"Object",stat:!0,forced:t((function(){r(1)})),sham:!i},{getPrototypeOf:function(e){return r(n(e))}})})),CY=Z((()=>{"use strict";var e=Je(),t=Ur(),n=Ut(),r=Jr(),i=Kr(),a=kl(),s=Ba(),o=t("Object","create"),l=n([].push);e({target:"Object",stat:!0},{groupBy:function(e,t){i(e),r(t);var n=o(null),h=0;return s(e,(function(e){var r=a(t(e,h++));r in n?l(n[r],e):n[r]=[e]})),n}})})),RY=Z((()=>{"use strict";Je()({target:"Object",stat:!0},{hasOwn:pr()})})),fI=Z(((e,t)=>{"use strict";t.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),IY=Z((()=>{"use strict";Je()({target:"Object",stat:!0},{is:fI()})})),OY=Z((()=>{"use strict";var e=Je(),t=v_();e({target:"Object",stat:!0,forced:Object.isExtensible!==t},{isExtensible:t})})),kY=Z((()=>{"use strict";var e=Je(),t=kt(),n=Kn(),r=Ms(),i=m_(),a=Object.isFrozen;e({target:"Object",stat:!0,forced:i||t((function(){a(1)}))},{isFrozen:function(e){return!(n(e)&&(!i||"ArrayBuffer"!==r(e)))||!!a&&a(e)}})})),NY=Z((()=>{"use strict";var e=Je(),t=kt(),n=Kn(),r=Ms(),i=m_(),a=Object.isSealed;e({target:"Object",stat:!0,forced:i||t((function(){a(1)}))},{isSealed:function(e){return!(n(e)&&(!i||"ArrayBuffer"!==r(e)))||!!a&&a(e)}})})),UY=Z((()=>{"use strict";var e=Je(),t=Tr(),n=_p();e({target:"Object",stat:!0,forced:kt()((function(){n(1)}))},{keys:function(e){return n(t(e))}})})),HY=Z((()=>{"use strict";var e=Je(),t=An(),n=Lv(),r=Tr(),i=kl(),a=Na(),s=As().f;t&&e({target:"Object",proto:!0,forced:n},{__lookupGetter__:function(e){var t,n=r(this),o=i(e);do{if(t=s(n,o))return t.get}while(n=a(n))}})})),VY=Z((()=>{"use strict";var e=Je(),t=An(),n=Lv(),r=Tr(),i=kl(),a=Na(),s=As().f;t&&e({target:"Object",proto:!0,forced:n},{__lookupSetter__:function(e){var t,n=r(this),o=i(e);do{if(t=s(n,o))return t.set}while(n=a(n))}})})),zY=Z((()=>{"use strict";var e=Je(),t=Kn(),n=ju().onFreeze,r=bf(),i=kt(),a=Object.preventExtensions;e({target:"Object",stat:!0,forced:i((function(){a(1)})),sham:!r},{preventExtensions:function(e){return a&&t(e)?a(n(e)):e}})})),XY=Z((()=>{"use strict";var e=An(),t=Ji(),n=Kn(),r=T2(),i=Tr(),a=Kr(),s=Object.getPrototypeOf,o=Object.setPrototypeOf,l=Object.prototype,h="__proto__";if(e&&s&&o&&!(h in l))try{t(l,h,{configurable:!0,get:function(){return s(i(this))},set:function(e){var t=a(this);r(e)&&n(t)&&o(t,e)}})}catch(e){}})),YY=Z((()=>{"use strict";var e=Je(),t=Kn(),n=ju().onFreeze,r=bf(),i=kt(),a=Object.seal;e({target:"Object",stat:!0,forced:i((function(){a(1)})),sham:!r},{seal:function(e){return a&&t(e)?a(n(e)):e}})})),$Y=Z((()=>{"use strict";Je()({target:"Object",stat:!0},{setPrototypeOf:Ko()})})),KY=Z(((e,t)=>{"use strict";var n=SE(),r=Zo();t.exports=n?{}.toString:function(){return"[object "+r(this)+"]"}})),JY=Z((()=>{"use strict";var e=SE(),t=Xr(),n=KY();e||t(Object.prototype,"toString",n,{unsafe:!0})})),QY=Z((()=>{"use strict";var e=Je(),t=uI().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),t$=Z((()=>{"use strict";var e=Je(),t=tI();e({global:!0,forced:parseFloat!==t},{parseFloat:t})})),r$=Z((()=>{"use strict";var e=Je(),t=nI();e({global:!0,forced:parseInt!==t},{parseInt:t})})),fo=Z(((e,t)=>{"use strict";var n=TypeError;t.exports=function(e,t){if(e<t)throw new n("Not enough arguments");return e}})),vI=Z(((e,t)=>{"use strict";var n=Dl();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)})),Nv=Z(((e,t)=>{"use strict";var n,r,i,a,s=rn(),o=Fa(),l=uo(),h=lr(),u=pr(),c=kt(),d=e2(),p=ka(),f=J0(),m=fo(),g=vI(),v=Lc(),y=s.setImmediate,x=s.clearImmediate,b=s.process,_=s.Dispatch,w=s.Function,S=s.MessageChannel,M=s.String,T=0,E={},A="onreadystatechange";c((function(){n=s.location}));var C=function(e){if(u(E,e)){var t=E[e];delete E[e],t()}},P=function(e){return function(){C(e)}},I=function(e){C(e.data)},R=function(e){s.postMessage(M(e),n.protocol+"//"+n.host)};(!y||!x)&&(y=function(e){m(arguments.length,1);var t=h(e)?e:w(e),n=p(arguments,1);return E[++T]=function(){o(t,void 0,n)},r(T),T},x=function(e){delete E[e]},v?r=function(e){b.nextTick(P(e))}:_&&_.now?r=function(e){_.now(P(e))}:S&&!g?(a=(i=new S).port2,i.port1.onmessage=I,r=l(a.postMessage,a)):s.addEventListener&&h(s.postMessage)&&!s.importScripts&&n&&"file:"!==n.protocol&&!c(R)?(r=R,s.addEventListener("message",I,!1)):r=A in f("script")?function(e){d.appendChild(f("script"))[A]=function(){d.removeChild(this),C(e)}}:function(e){setTimeout(P(e),0)}),t.exports={set:y,clear:x}})),MI=Z(((e,t)=>{"use strict";var n=rn(),r=An(),i=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return n[e];var t=i(n,e);return t&&t.value}})),AI=Z(((e,t)=>{"use strict";var n=function(){this.head=null,this.tail=null};n.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=n})),b$=Z(((e,t)=>{"use strict";var n=Dl();t.exports=/ipad|iphone|ipod/i.test(n)&&"undefined"!=typeof Pebble})),_$=Z(((e,t)=>{"use strict";var n=Dl();t.exports=/web0s(?!.*chrome)/i.test(n)})),OI=Z(((e,t)=>{"use strict";var n,r,i,a,s,o,l,h=rn(),u=MI(),c=uo(),d=Nv().set,p=AI(),f=vI(),m=b$(),g=_$(),v=Lc(),y=h.MutationObserver||h.WebKitMutationObserver,x=h.document,b=h.process,_=h.Promise,w=u("queueMicrotask");w||(o=new p,l=function(){var e,t;for(v&&(e=b.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&n(),e}e&&e.enter()},f||v||g||!y||!x?!m&&_&&_.resolve?((a=_.resolve(void 0)).constructor=_,s=c(a.then,a),n=function(){s(l)}):v?n=function(){b.nextTick(l)}:(d=c(d,h),n=function(){d(l)}):(r=!0,i=x.createTextNode(""),new y(l).observe(i,{characterData:!0}),n=function(){i.data=r=!r}),w=function(e){o.head||n(),o.add(e)}),t.exports=w})),P$=Z(((e,t)=>{"use strict";t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}})),Wp=Z(((e,t)=>{"use strict";t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),Tf=Z(((e,t)=>{"use strict";var n=rn();t.exports=n.Promise})),C_=Z(((e,t)=>{"use strict";t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version})),LI=Z(((e,t)=>{"use strict";var n=C_(),r=Lc();t.exports=!n&&!r&&"object"==typeof window&&"object"==typeof document})),jp=Z(((e,t)=>{"use strict";var n=rn(),r=Tf(),i=lr(),a=Ep(),s=gE(),o=rr(),l=LI(),h=C_(),u=ci(),c=Ol(),d=r&&r.prototype,p=o("species"),f=!1,m=i(n.PromiseRejectionEvent),g=a("Promise",(function(){var e=s(r),t=e!==String(r);if(!t&&66===c||u&&(!d.catch||!d.finally))return!0;if(!c||c<51||!/native code/.test(e)){var n=new r((function(e){e(1)})),i=function(e){e((function(){}),(function(){}))};if((n.constructor={})[p]=i,!(f=n.then((function(){}))instanceof i))return!0}return!t&&(l||h)&&!m}));t.exports={CONSTRUCTOR:g,REJECTION_EVENT:m,SUBCLASSING:f}})),Hc=Z(((e,t)=>{"use strict";var n=Jr(),r=TypeError,i=function(e){var t,i;this.promise=new e((function(e,n){if(void 0!==t||void 0!==i)throw new r("Bad Promise constructor");t=e,i=n})),this.resolve=n(t),this.reject=n(i)};t.exports.f=function(e){return new i(e)}})),iZ=Z((()=>{"use strict";var e,t,n,r=Je(),i=ci(),a=Lc(),s=rn(),o=qn(),l=Xr(),h=Ko(),u=Ws(),c=gf(),d=Jr(),p=lr(),f=Kn(),m=Jo(),g=yf(),v=Nv().set,y=OI(),x=P$(),b=Wp(),_=AI(),w=Ii(),S=Tf(),M=jp(),T=Hc(),E="Promise",A=M.CONSTRUCTOR,C=M.REJECTION_EVENT,P=M.SUBCLASSING,I=w.getterFor(E),R=w.set,L=S&&S.prototype,O=S,D=L,k=s.TypeError,N=s.document,F=s.process,U=T.f,B=U,z=!!(N&&N.createEvent&&s.dispatchEvent),H="unhandledrejection",V=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},j=function(e,t){var n,r,i,a=t.value,s=1===t.state,l=s?e.ok:e.fail,h=e.resolve,u=e.reject,c=e.domain;try{l?(s||(2===t.rejection&&Y(t),t.rejection=1),!0===l?n=a:(c&&c.enter(),n=l(a),c&&(c.exit(),i=!0)),n===e.promise?u(new k("Promise-chain cycle")):(r=V(n))?o(r,n,h,u):h(n)):u(a)}catch(e){c&&!i&&c.exit(),u(e)}},G=function(e,t){e.notified||(e.notified=!0,y((function(){for(var n,r=e.reactions;n=r.get();)j(n,e);e.notified=!1,t&&!e.rejection&&q(e)})))},W=function(e,t,n){var r,i;z?((r=N.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),s.dispatchEvent(r)):r={promise:t,reason:n},!C&&(i=s["on"+e])?i(r):e===H&&x("Unhandled promise rejection",n)},q=function(e){o(v,s,(function(){var t,n=e.facade,r=e.value;if(X(e)&&(t=b((function(){a?F.emit("unhandledRejection",r,n):W(H,n,r)})),e.rejection=a||X(e)?2:1,t.error))throw t.value}))},X=function(e){return 1!==e.rejection&&!e.parent},Y=function(e){o(v,s,(function(){var t=e.facade;a?F.emit("rejectionHandled",t):W("rejectionhandled",t,e.value)}))},Z=function(e,t,n){return function(r){e(t,r,n)}},J=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,G(e,!0))},K=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new k("Promise can't be resolved itself");var r=V(t);r?y((function(){var n={done:!1};try{o(r,t,Z(K,n,e),Z(J,n,e))}catch(t){J(n,t,e)}})):(e.value=t,e.state=1,G(e,!1))}catch(t){J({done:!1},t,e)}}};if(A&&(D=(O=function(t){m(this,D),d(t),o(e,this);var n=I(this);try{t(Z(K,n),Z(J,n))}catch(e){J(n,e)}}).prototype,(e=function(e){R(this,{type:E,done:!1,notified:!1,parent:!1,reactions:new _,rejection:!1,state:0,value:void 0})}).prototype=l(D,"then",(function(e,t){var n=I(this),r=U(g(this,O));return n.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=a?F.domain:void 0,0===n.state?n.reactions.add(r):y((function(){j(r,n)})),r.promise})),t=function(){var t=new e,n=I(t);this.promise=t,this.resolve=Z(K,n),this.reject=Z(J,n)},T.f=U=function(e){return e===O||undefined===e?new t(e):B(e)},!i&&p(S)&&L!==Object.prototype)){n=L.then,P||l(L,"then",(function(e,t){var r=this;return new O((function(e,t){o(n,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete L.constructor}catch(e){}h&&h(L,D)}r({global:!0,constructor:!0,wrap:!0,forced:A},{Promise:O}),u(O,E,!1,!0),c(E)})),Vv=Z(((e,t)=>{"use strict";var n=Tf(),r=dv(),i=jp().CONSTRUCTOR;t.exports=i||!r((function(e){n.all(e).then(void 0,(function(){}))}))})),aZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Jr(),r=Hc(),i=Wp(),a=Ba();e({target:"Promise",stat:!0,forced:Vv()},{all:function(e){var s=this,o=r.f(s),l=o.resolve,h=o.reject,u=i((function(){var r=n(s.resolve),i=[],o=0,u=1;a(e,(function(e){var n=o++,a=!1;u++,t(r,s,e).then((function(e){a||(a=!0,i[n]=e,--u||l(i))}),h)})),--u||l(i)}));return u.error&&h(u.value),o.promise}})})),lZ=Z((()=>{"use strict";var e,t=Je(),n=ci(),r=jp().CONSTRUCTOR,i=Tf(),a=Ur(),s=lr(),o=Xr(),l=i&&i.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!n&&s(i)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),cZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Jr(),r=Hc(),i=Wp(),a=Ba();e({target:"Promise",stat:!0,forced:Vv()},{race:function(e){var s=this,o=r.f(s),l=o.reject,h=i((function(){var r=n(s.resolve);a(e,(function(e){t(r,s,e).then(o.resolve,l)}))}));return h.error&&l(h.value),o.promise}})})),uZ=Z((()=>{"use strict";var e=Je(),t=Hc();e({target:"Promise",stat:!0,forced:jp().CONSTRUCTOR},{reject:function(e){var n=t.f(this);return(0,n.reject)(e),n.promise}})})),XI=Z(((e,t)=>{"use strict";var n=Gn(),r=Kn(),i=Hc();t.exports=function(e,t){if(n(e),r(t)&&t.constructor===e)return t;var a=i.f(e);return(0,a.resolve)(t),a.promise}})),pZ=Z((()=>{"use strict";var e=Je(),t=Ur(),n=ci(),r=Tf(),i=jp().CONSTRUCTOR,a=XI(),s=t("Promise"),o=n&&!i;e({target:"Promise",stat:!0,forced:n||i},{resolve:function(e){return a(o&&this===s?r:this,e)}})})),mZ=Z((()=>{"use strict";iZ(),aZ(),lZ(),cZ(),uZ(),pZ()})),gZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Jr(),r=Hc(),i=Wp(),a=Ba();e({target:"Promise",stat:!0,forced:Vv()},{allSettled:function(e){var s=this,o=r.f(s),l=o.resolve,h=o.reject,u=i((function(){var r=n(s.resolve),i=[],o=0,h=1;a(e,(function(e){var n=o++,a=!1;h++,t(r,s,e).then((function(e){a||(a=!0,i[n]={status:"fulfilled",value:e},--h||l(i))}),(function(e){a||(a=!0,i[n]={status:"rejected",reason:e},--h||l(i))}))})),--h||l(i)}));return u.error&&h(u.value),o.promise}})})),yZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Jr(),r=Ur(),i=Hc(),a=Wp(),s=Ba(),o=Vv(),l="No one promise resolved";e({target:"Promise",stat:!0,forced:o},{any:function(e){var o=this,h=r("AggregateError"),u=i.f(o),c=u.resolve,d=u.reject,p=a((function(){var r=n(o.resolve),i=[],a=0,u=1,p=!1;s(e,(function(e){var n=a++,s=!1;u++,t(r,o,e).then((function(e){s||p||(p=!0,c(e))}),(function(e){s||p||(s=!0,i[n]=e,--u||d(new h(i,l)))}))})),--u||d(new h(i,l))}));return p.error&&d(p.value),u.promise}})})),_Z=Z((()=>{"use strict";var e,t=Je(),n=ci(),r=Tf(),i=kt(),a=Ur(),s=lr(),o=yf(),l=XI(),h=Xr(),u=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&i((function(){u.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),n=s(e);return this.then(n?function(n){return l(t,e()).then((function(){return n}))}:e,n?function(n){return l(t,e()).then((function(){throw n}))}:e)}}),!n&&s(r)&&(e=a("Promise").prototype.finally,u.finally!==e&&h(u,"finally",e,{unsafe:!0}))})),TZ=Z((()=>{"use strict";var e=Je(),t=Hc();e({target:"Promise",stat:!0},{withResolvers:function(){var e=t.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})})),SZ=Z((()=>{"use strict";var e=Je(),t=Fa(),n=Jr(),r=Gn();e({target:"Reflect",stat:!0,forced:!kt()((function(){Reflect.apply((function(){}))}))},{apply:function(e,i,a){return t(n(e),i,r(a))}})})),IZ=Z((()=>{"use strict";var e=Je(),t=Ur(),n=Fa(),r=LP(),i=d_(),a=Gn(),s=Kn(),o=fa(),l=kt(),h=t("Reflect","construct"),u=Object.prototype,c=[].push,d=l((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),p=!l((function(){h((function(){}))})),f=d||p;e({target:"Reflect",stat:!0,forced:f,sham:f},{construct:function(e,t){i(e),a(t);var l=arguments.length<3?e:i(arguments[2]);if(p&&!d)return h(e,t,l);if(e===l){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var f=[null];return n(c,f,t),new(n(r,e,f))}var m=l.prototype,g=o(s(m)?m:u),v=n(e,g,t);return s(v)?v:g}})})),LZ=Z((()=>{"use strict";var e=Je(),t=An(),n=Gn(),r=kl(),i=Qr();e({target:"Reflect",stat:!0,forced:kt()((function(){Reflect.defineProperty(i.f({},1,{value:1}),1,{value:2})})),sham:!t},{defineProperty:function(e,t,a){n(e);var s=r(t);n(a);try{return i.f(e,s,a),!0}catch(e){return!1}}})})),kZ=Z((()=>{"use strict";var e=Je(),t=Gn(),n=As().f;e({target:"Reflect",stat:!0},{deleteProperty:function(e,r){var i=n(t(e),r);return!(i&&!i.configurable)&&delete e[r]}})})),JI=Z(((e,t)=>{"use strict";var n=pr();t.exports=function(e){return void 0!==e&&(n(e,"value")||n(e,"writable"))}})),UZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Kn(),r=Gn(),i=JI(),a=As(),s=Na();e({target:"Reflect",stat:!0},{get:function e(o,l){var h,u,c=arguments.length<3?o:arguments[2];return r(o)===c?o[l]:(h=a.f(o,l))?i(h)?h.value:void 0===h.get?void 0:t(h.get,c):n(u=s(o))?e(u,l,c):void 0}})})),HZ=Z((()=>{"use strict";var e=Je(),t=An(),n=Gn(),r=As();e({target:"Reflect",stat:!0,sham:!t},{getOwnPropertyDescriptor:function(e,t){return r.f(n(e),t)}})})),VZ=Z((()=>{"use strict";var e=Je(),t=Gn(),n=Na();e({target:"Reflect",stat:!0,sham:!VE()},{getPrototypeOf:function(e){return n(t(e))}})})),zZ=Z((()=>{"use strict";Je()({target:"Reflect",stat:!0},{has:function(e,t){return t in e}})})),qZ=Z((()=>{"use strict";var e=Je(),t=Gn(),n=v_();e({target:"Reflect",stat:!0},{isExtensible:function(e){return t(e),n(e)}})})),GZ=Z((()=>{"use strict";Je()({target:"Reflect",stat:!0},{ownKeys:TE()})})),WZ=Z((()=>{"use strict";var e=Je(),t=Ur(),n=Gn();e({target:"Reflect",stat:!0,sham:!bf()},{preventExtensions:function(e){n(e);try{var r=t("Object","preventExtensions");return r&&r(e),!0}catch(e){return!1}}})})),ZZ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Gn(),r=Kn(),i=JI(),a=kt(),s=Qr(),o=As(),l=Na(),h=La();e({target:"Reflect",stat:!0,forced:a((function(){var e=function(){},t=s.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(a,u,c){var d,p,f,m=arguments.length<4?a:arguments[3],g=o.f(n(a),u);if(!g){if(r(p=l(a)))return e(p,u,c,m);g=h(0)}if(i(g)){if(!1===g.writable||!r(m))return!1;if(d=o.f(m,u)){if(d.get||d.set||!1===d.writable)return!1;d.value=c,s.f(m,u,d)}else s.f(m,u,h(0,c))}else{if(void 0===(f=g.set))return!1;t(f,m,c)}return!0}})})),JZ=Z((()=>{"use strict";var e=Je(),t=Gn(),n=S2(),r=Ko();r&&e({target:"Reflect",stat:!0},{setPrototypeOf:function(e,i){t(e),n(i);try{return r(e,i),!0}catch(e){return!1}}})})),QZ=Z((()=>{"use strict";var e=Je(),t=rn(),n=Ws();e({global:!0},{Reflect:{}}),n(t.Reflect,"Reflect",!0)})),Kp=Z(((e,t)=>{"use strict";var n=Kn(),r=Ms(),i=rr()("match");t.exports=function(e){var t;return n(e)&&(void 0!==(t=e[i])?!!t:"RegExp"===r(e))}})),F_=Z(((e,t)=>{"use strict";var n=Gn();t.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Jp=Z(((e,t)=>{"use strict";var n=qn(),r=pr(),i=ua(),a=F_(),s=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||r(e,"flags")||!i(s,e)?t:n(a,e)}})),zv=Z(((e,t)=>{"use strict";var n=kt(),r=rn().RegExp,i=n((function(){var e=r("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),a=i||n((function(){return!r("a","y").sticky})),s=i||n((function(){var e=r("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));t.exports={BROKEN_CARET:s,MISSED_STICKY:a,UNSUPPORTED_Y:i}})),N_=Z(((e,t)=>{"use strict";var n=kt(),r=rn().RegExp;t.exports=n((function(){var e=r(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))})),rD=Z(((e,t)=>{"use strict";var n=kt(),r=rn().RegExp;t.exports=n((function(){var e=r("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))})),mK=Z((()=>{"use strict";var e,t,n,r=An(),i=rn(),a=Ut(),s=Ep(),o=Uu(),l=Cs(),h=fa(),u=Fu().f,c=ua(),d=Kp(),p=Fn(),f=Jp(),m=zv(),g=w2(),v=Xr(),y=kt(),x=pr(),b=Ii().enforce,_=gf(),w=rr(),S=N_(),M=rD(),T=w("match"),E=i.RegExp,A=E.prototype,C=i.SyntaxError,P=a(A.exec),I=a("".charAt),R=a("".replace),L=a("".indexOf),O=a("".slice),D=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,k=/a/g,N=/a/g,F=new E(k)!==k,U=m.MISSED_STICKY,B=m.UNSUPPORTED_Y,z=r&&(!F||U||S||M||y((function(){return N[T]=!1,E(k)!==k||E(N)===N||"/a/i"!==String(E(k,"i"))})));if(s("RegExp",z)){for(e=function(t,n){var r,i,a,s,u,m,g=c(A,this),v=d(t),y=void 0===n,_=[],w=t;if(!g&&v&&y&&t.constructor===e)return t;if((v||c(A,t))&&(t=t.source,y&&(n=f(w))),t=void 0===t?"":p(t),n=void 0===n?"":p(n),w=t,S&&"dotAll"in k&&((i=!!n&&L(n,"s")>-1)&&(n=R(n,/s/g,""))),r=n,U&&"sticky"in k&&((a=!!n&&L(n,"y")>-1)&&B&&(n=R(n,/y/g,""))),M&&(s=function(e){for(var t,n=e.length,r=0,i="",a=[],s=h(null),o=!1,l=!1,u=0,c="";r<=n;r++){if("\\"===(t=I(e,r)))t+=I(e,++r);else if("]"===t)o=!1;else if(!o)switch(!0){case"["===t:o=!0;break;case"("===t:P(D,O(e,r+1))&&(r+=2,l=!0),i+=t,u++;continue;case">"===t&&l:if(""===c||x(s,c))throw new C("Invalid capture group name");s[c]=!0,a[a.length]=[c,u],l=!1,c="";continue}l?c+=t:i+=t}return[i,a]}(t),t=s[0],_=s[1]),u=o(E(t,n),g?this:A,e),(i||a||_.length)&&(m=b(u),i&&(m.dotAll=!0,m.raw=e(function(e){for(var t,n=e.length,r=0,i="",a=!1;r<=n;r++)"\\"!==(t=I(e,r))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+I(e,++r);return i}(t),r)),a&&(m.sticky=!0),_.length&&(m.groups=_)),t!==w)try{l(u,"source",""===w?"(?:)":w)}catch(e){}return u},t=u(E),n=0;t.length>n;)g(e,E,t[n++]);A.constructor=e,e.prototype=A,v(i,"RegExp",e,{constructor:!0})}_("RegExp")})),vK=Z((()=>{"use strict";var e=An(),t=N_(),n=Ms(),r=Ji(),i=Ii().get,a=RegExp.prototype,s=TypeError;e&&t&&r(a,"dotAll",{configurable:!0,get:function(){if(this!==a){if("RegExp"===n(this))return!!i(this).dotAll;throw new s("Incompatible receiver, RegExp required")}}})})),Gv=Z(((e,t)=>{"use strict";var n,r,i=qn(),a=Ut(),s=Fn(),o=F_(),l=zv(),h=af(),u=fa(),c=Ii().get,d=N_(),p=rD(),f=h("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,g=m,v=a("".charAt),y=a("".indexOf),x=a("".replace),b=a("".slice),_=(r=/b*/g,i(m,n=/a/,"a"),i(m,r,"a"),0!==n.lastIndex||0!==r.lastIndex),w=l.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(_||S||w||d||p)&&(g=function(e){var t,n,r,a,l,h,d,p=this,M=c(p),T=s(e),E=M.raw;if(E)return E.lastIndex=p.lastIndex,t=i(g,E,T),p.lastIndex=E.lastIndex,t;var A=M.groups,C=w&&p.sticky,P=i(o,p),I=p.source,R=0,L=T;if(C&&(P=x(P,"y",""),-1===y(P,"g")&&(P+="g"),L=b(T,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==v(T,p.lastIndex-1))&&(I="(?: "+I+")",L=" "+L,R++),n=new RegExp("^(?:"+I+")",P)),S&&(n=new RegExp("^"+I+"$(?!\\s)",P)),_&&(r=p.lastIndex),a=i(m,C?n:p,L),C?a?(a.input=b(a.input,R),a[0]=b(a[0],R),a.index=p.lastIndex,p.lastIndex+=a[0].length):p.lastIndex=0:_&&a&&(p.lastIndex=p.global?a.index+a[0].length:r),S&&a&&a.length>1&&i(f,a[0],n,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&A)for(a.groups=h=u(null),l=0;l<A.length;l++)h[(d=A[l])[0]]=a[d[1]];return a}),t.exports=g})),V_=Z((()=>{"use strict";var e=Je(),t=Gv();e({target:"RegExp",proto:!0,forced:/./.exec!==t},{exec:t})})),TK=Z((()=>{"use strict";var e=rn(),t=An(),n=Ji(),r=F_(),i=kt(),a=e.RegExp,s=a.prototype;t&&i((function(){var e=!0;try{a(".","d")}catch(t){e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(e,r){Object.defineProperty(t,e,{get:function(){return n+=r,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var l in e&&(o.hasIndices="d"),o)i(l,o[l]);return Object.getOwnPropertyDescriptor(s,"flags").get.call(t)!==r||n!==r}))&&n(s,"flags",{configurable:!0,get:r})})),wK=Z((()=>{"use strict";var e=An(),t=zv().MISSED_STICKY,n=Ms(),r=Ji(),i=Ii().get,a=RegExp.prototype,s=TypeError;e&&t&&r(a,"sticky",{configurable:!0,get:function(){if(this!==a){if("RegExp"===n(this))return!!i(this).sticky;throw new s("Incompatible receiver, RegExp required")}}})})),CK=Z((()=>{"use strict";V_();var e,t,n=Je(),r=qn(),i=lr(),a=Gn(),s=Fn(),o=(e=!1,(t=/[ac]/).exec=function(){return e=!0,/./.exec.apply(this,arguments)},!0===t.test("abc")&&e),l=/./.test;n({target:"RegExp",proto:!0,forced:!o},{test:function(e){var t=a(this),n=s(e),o=t.exec;if(!i(o))return r(l,t,n);var h=r(o,t,n);return null!==h&&(a(h),!0)}})})),DK=Z((()=>{"use strict";var e=lf().PROPER,t=Xr(),n=Gn(),r=Fn(),i=kt(),a=Jp(),s="toString",o=RegExp.prototype,l=o[s],h=i((function(){return"/a/b"!==l.call({source:"a",flags:"b"})})),u=e&&l.name!==s;(h||u)&&t(o,s,(function(){var e=n(this);return"/"+r(e.source)+"/"+r(a(e))}),{unsafe:!0})})),OK=Z((()=>{"use strict";Sv()("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),qP())})),LK=Z((()=>{"use strict";OK()})),kK=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Kr(),r=gi(),i=Fn(),a=kt(),s=t("".charAt);e({target:"String",proto:!0,forced:a((function(){return"\ud842"!=="ð ®·".at(-2)}))},{at:function(e){var t=i(n(this)),a=t.length,o=r(e),l=o>=0?o:a+o;return l<0||l>=a?void 0:s(t,l)}})})),Wv=Z(((e,t)=>{"use strict";var n=Ut(),r=gi(),i=Fn(),a=Kr(),s=n("".charAt),o=n("".charCodeAt),l=n("".slice),h=function(e){return function(t,n){var h,u,c=i(a(t)),d=r(n),p=c.length;return d<0||d>=p?e?"":void 0:(h=o(c,d))<55296||h>56319||d+1===p||(u=o(c,d+1))<56320||u>57343?e?s(c,d):h:e?l(c,d,d+2):u-56320+(h-55296<<10)+65536}};t.exports={codeAt:h(!1),charAt:h(!0)}})),UK=Z((()=>{"use strict";var e=Je(),t=Wv().codeAt;e({target:"String",proto:!0},{codePointAt:function(e){return t(this,e)}})})),z_=Z(((e,t)=>{"use strict";var n=Kp(),r=TypeError;t.exports=function(e){if(n(e))throw new r("The method doesn't accept regular expressions");return e}})),q_=Z(((e,t)=>{"use strict";var n=rr()("match");t.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}})),GK=Z((()=>{"use strict";var e,t=Je(),n=Cc(),r=As().f,i=ha(),a=Fn(),s=z_(),o=Kr(),l=q_(),h=ci(),u=n("".slice),c=Math.min,d=l("endsWith");t({target:"String",proto:!0,forced:!!(h||d||(e=r(String.prototype,"endsWith"),!e||e.writable))&&!d},{endsWith:function(e){var t=a(o(this));s(e);var n=arguments.length>1?arguments[1]:void 0,r=t.length,l=void 0===n?r:c(i(n),r),h=a(e);return u(t,l-h.length,l)===h}})})),XK=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Fl(),r=RangeError,i=String.fromCharCode,a=String.fromCodePoint,s=t([].join);e({target:"String",stat:!0,arity:1,forced:!!a&&1!==a.length},{fromCodePoint:function(e){for(var t,a=[],o=arguments.length,l=0;o>l;){if(t=+arguments[l++],n(t,1114111)!==t)throw new r(t+" is not a valid code point");a[l]=t<65536?i(t):i(55296+((t-=65536)>>10),t%1024+56320)}return s(a,"")}})})),$K=Z((()=>{"use strict";var e=Je(),t=Ut(),n=z_(),r=Kr(),i=Fn(),a=q_(),s=t("".indexOf);e({target:"String",proto:!0,forced:!a("includes")},{includes:function(e){return!!~s(i(r(this)),i(n(e)),arguments.length>1?arguments[1]:void 0)}})})),KK=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Kr(),r=Fn(),i=t("".charCodeAt);e({target:"String",proto:!0},{isWellFormed:function(){for(var e=r(n(this)),t=e.length,a=0;a<t;a++){var s=i(e,a);if(55296==(63488&s)&&(s>=56320||++a>=t||56320!=(64512&i(e,a))))return!1}return!0}})})),pD=Z((()=>{"use strict";var e=Wv().charAt,t=Fn(),n=Ii(),r=ZE(),i=Dp(),a="String Iterator",s=n.set,o=n.getterFor(a);r(String,"String",(function(e){s(this,{type:a,string:t(e),index:0})}),(function(){var t,n=o(this),r=n.string,a=n.index;return a>=r.length?i(void 0,!0):(t=e(r,a),n.index+=t.length,i(t,!1))}))})),jv=Z(((e,t)=>{"use strict";V_();var n=Cc(),r=Xr(),i=Gv(),a=kt(),s=rr(),o=Cs(),l=s("species"),h=RegExp.prototype;t.exports=function(e,t,u,c){var d=s(e),p=!a((function(){var t={};return t[d]=function(){return 7},7!==""[e](t)})),f=p&&!a((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[l]=function(){return n},n.flags="",n[d]=/./[d]),n.exec=function(){return t=!0,null},n[d](""),!t}));if(!p||!f||u){var m=n(/./[d]),g=t(d,""[e],(function(e,t,r,a,s){var o=n(e),l=t.exec;return l===i||l===h.exec?p&&!s?{done:!0,value:m(t,r,a)}:{done:!0,value:o(r,t,a)}:{done:!1}}));r(String.prototype,e,g[0]),r(h,d,g[1])}c&&o(h[d],"sham",!0)}})),Xv=Z(((e,t)=>{"use strict";var n=Wv().charAt;t.exports=function(e,t,r){return t+(r?n(e,t).length:1)}})),tm=Z(((e,t)=>{"use strict";var n=qn(),r=Gn(),i=lr(),a=Ms(),s=Gv(),o=TypeError;t.exports=function(e,t){var l=e.exec;if(i(l)){var h=n(l,e,t);return null!==h&&r(h),h}if("RegExp"===a(e))return n(s,e,t);throw new o("RegExp#exec called on incompatible receiver")}})),uJ=Z((()=>{"use strict";var e=qn(),t=jv(),n=Gn(),r=qs(),i=ha(),a=Fn(),s=Kr(),o=Ll(),l=Xv(),h=tm();t("match",(function(t,u,c){return[function(n){var i=s(this),l=r(n)?void 0:o(n,t);return l?e(l,n,i):new RegExp(n)[t](a(i))},function(e){var t=n(this),r=a(e),s=c(u,t,r);if(s.done)return s.value;if(!t.global)return h(t,r);var o=t.unicode;t.lastIndex=0;for(var d,p=[],f=0;null!==(d=h(t,r));){var m=a(d[0]);p[f]=m,""===m&&(t.lastIndex=l(r,i(t.lastIndex),o)),f++}return 0===f?null:p}]}))})),bJ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Cc(),r=XE(),i=Dp(),a=Kr(),s=ha(),o=Fn(),l=Gn(),h=qs(),u=Ms(),c=Kp(),d=Jp(),p=Ll(),f=Xr(),m=kt(),g=rr(),v=yf(),y=Xv(),x=tm(),b=Ii(),_=ci(),w=g("matchAll"),S="RegExp String",M=S+" Iterator",T=b.set,E=b.getterFor(M),A=RegExp.prototype,C=TypeError,P=n("".indexOf),I=n("".matchAll),R=!!I&&!m((function(){I("a",/./)})),L=r((function(e,t,n,r){T(this,{type:M,regexp:e,string:t,global:n,unicode:r,done:!1})}),S,(function(){var e=E(this);if(e.done)return i(void 0,!0);var t=e.regexp,n=e.string,r=x(t,n);return null===r?(e.done=!0,i(void 0,!0)):e.global?(""===o(r[0])&&(t.lastIndex=y(n,s(t.lastIndex),e.unicode)),i(r,!1)):(e.done=!0,i(r,!1))})),O=function(e){var t,n,r,i=l(this),a=o(e),h=v(i,RegExp),u=o(d(i));return t=new h(h===RegExp?i.source:i,u),n=!!~P(u,"g"),r=!!~P(u,"u"),t.lastIndex=s(i.lastIndex),new L(t,a,n,r)};e({target:"String",proto:!0,forced:R},{matchAll:function(e){var n,r,i,s,l=a(this);if(h(e)){if(R)return I(l,e)}else{if(c(e)&&(n=o(a(d(e))),!~P(n,"g")))throw new C("`.matchAll` does not allow non-global regexes");if(R)return I(l,e);if(void 0===(i=p(e,w))&&_&&"RegExp"===u(e)&&(i=O),i)return t(i,e,l)}return r=o(l),s=new RegExp(e,"g"),_?t(O,s,r):s[w](r)}}),_||w in A||f(A,w,O)})),ED=Z(((e,t)=>{"use strict";var n=Dl();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)})),_J=Z((()=>{"use strict";var e=Je(),t=p_().end;e({target:"String",proto:!0,forced:ED()},{padEnd:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),TJ=Z((()=>{"use strict";var e=Je(),t=p_().start;e({target:"String",proto:!0,forced:ED()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),AJ=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Vi(),r=Tr(),i=Fn(),a=Rr(),s=t([].push),o=t([].join);e({target:"String",stat:!0},{raw:function(e){var t=n(r(e).raw),l=a(t);if(!l)return"";for(var h=arguments.length,u=[],c=0;;){if(s(u,i(t[c++])),c===l)return o(u,"");c<h&&s(u,i(arguments[c]))}}})})),CJ=Z((()=>{"use strict";Je()({target:"String",proto:!0},{repeat:_v()})})),wD=Z(((e,t)=>{"use strict";var n=Ut(),r=Tr(),i=Math.floor,a=n("".charAt),s=n("".replace),o=n("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,h=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,n,u,c,d){var p=n+e.length,f=u.length,m=h;return void 0!==c&&(c=r(c),m=l),s(d,m,(function(r,s){var l;switch(a(s,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,n);case"'":return o(t,p);case"<":l=c[o(s,1,-1)];break;default:var h=+s;if(0===h)return r;if(h>f){var d=i(h/10);return 0===d?r:d<=f?void 0===u[d-1]?a(s,1):u[d-1]+a(s,1):r}l=u[h-1]}return void 0===l?"":l}))}})),LJ=Z((()=>{"use strict";var e=Fa(),t=qn(),n=Ut(),r=jv(),i=kt(),a=Gn(),s=lr(),o=qs(),l=gi(),h=ha(),u=Fn(),c=Kr(),d=Xv(),p=Ll(),f=wD(),m=tm(),g=rr()("replace"),v=Math.max,y=Math.min,x=n([].concat),b=n([].push),_=n("".indexOf),w=n("".slice),S=function(e){return void 0===e?e:String(e)},M="$0"==="a".replace(/./,"$0"),T=!!/./[g]&&""===/./[g]("a","$0");r("replace",(function(n,r,i){var M=T?"$":"$0";return[function(e,n){var i=c(this),a=o(e)?void 0:p(e,g);return a?t(a,e,i,n):t(r,u(i),e,n)},function(t,n){var o=a(this),c=u(t);if("string"==typeof n&&-1===_(n,M)&&-1===_(n,"$<")){var p=i(r,o,c,n);if(p.done)return p.value}var g=s(n);g||(n=u(n));var T,E=o.global;E&&(T=o.unicode,o.lastIndex=0);for(var A,C=[];null!==(A=m(o,c))&&(b(C,A),E);){""===u(A[0])&&(o.lastIndex=d(c,h(o.lastIndex),T))}for(var P="",I=0,R=0;R<C.length;R++){for(var L,O=u((A=C[R])[0]),D=v(y(l(A.index),c.length),0),k=[],N=1;N<A.length;N++)b(k,S(A[N]));var F=A.groups;if(g){var U=x([O],k,D,c);void 0!==F&&b(U,F),L=u(e(n,void 0,U))}else L=f(O,c,D,k,F,n);D>=I&&(P+=w(c,I,D)+L,I=D+O.length)}return P+w(c,I)}]}),!!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!M||T)})),UJ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Ut(),r=Kr(),i=lr(),a=qs(),s=Kp(),o=Fn(),l=Ll(),h=Jp(),u=wD(),c=rr(),d=ci(),p=c("replace"),f=TypeError,m=n("".indexOf),g=n("".replace),v=n("".slice),y=Math.max,x=function(e,t,n){return n>e.length?-1:""===t?n:m(e,t,n)};e({target:"String",proto:!0},{replaceAll:function(e,n){var c,b,_,w,S,M,T,E,A,C=r(this),P=0,I=0,R="";if(!a(e)){if((c=s(e))&&(b=o(r(h(e))),!~m(b,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(_=l(e,p))return t(_,e,C,n);if(d&&c)return g(o(C),e,n)}for(w=o(C),S=o(e),(M=i(n))||(n=o(n)),T=S.length,E=y(1,T),P=x(w,S,0);-1!==P;)A=M?o(n(S,P,w)):u(S,w,P,[],void 0,n),R+=v(w,I,P)+A,I=P+T,P=x(w,S,P+E);return I<w.length&&(R+=v(w,I)),R}})})),zJ=Z((()=>{"use strict";var e=qn(),t=jv(),n=Gn(),r=qs(),i=Kr(),a=fI(),s=Fn(),o=Ll(),l=tm();t("search",(function(t,h,u){return[function(n){var a=i(this),l=r(n)?void 0:o(n,t);return l?e(l,n,a):new RegExp(n)[t](s(a))},function(e){var t=n(this),r=s(e),i=u(h,t,r);if(i.done)return i.value;var o=t.lastIndex;a(o,0)||(t.lastIndex=0);var c=l(t,r);return a(t.lastIndex,o)||(t.lastIndex=o),null===c?-1:c.index}]}))})),YJ=Z((()=>{"use strict";var e=Fa(),t=qn(),n=Ut(),r=jv(),i=Gn(),a=qs(),s=Kp(),o=Kr(),l=yf(),h=Xv(),u=ha(),c=Fn(),d=Ll(),p=ka(),f=tm(),m=Gv(),g=zv(),v=kt(),y=g.UNSUPPORTED_Y,x=4294967295,b=Math.min,_=[].push,w=n(/./.exec),S=n(_),M=n("".slice);r("split",(function(n,r,g){var v;return v="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(n,i){var a=c(o(this)),l=void 0===i?x:i>>>0;if(0===l)return[];if(void 0===n)return[a];if(!s(n))return t(r,a,n,l);for(var h,u,d,f=[],g=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),v=0,y=new RegExp(n.source,g+"g");(h=t(m,y,a))&&!((u=y.lastIndex)>v&&(S(f,M(a,v,h.index)),h.length>1&&h.index<a.length&&e(_,f,p(h,1)),d=h[0].length,v=u,f.length>=l));)y.lastIndex===h.index&&y.lastIndex++;return v===a.length?(d||!w(y,""))&&S(f,""):S(f,M(a,v)),f.length>l?p(f,0,l):f}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t(r,this,e,n)}:r,[function(e,r){var i=o(this),s=a(e)?void 0:d(e,n);return s?t(s,e,i,r):t(v,c(i),e,r)},function(e,t){var n=i(this),a=c(e),s=g(v,n,a,t,v!==r);if(s.done)return s.value;var o=l(n,RegExp),d=n.unicode,p=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(y?"g":"y"),m=new o(y?"^(?:"+n.source+")":n,p),_=void 0===t?x:t>>>0;if(0===_)return[];if(0===a.length)return null===f(m,a)?[a]:[];for(var w=0,T=0,E=[];T<a.length;){m.lastIndex=y?0:T;var A,C=f(m,y?M(a,T):a);if(null===C||(A=b(u(m.lastIndex+(y?T:0)),a.length))===w)T=h(a,T,d);else{if(S(E,M(a,w,T)),E.length===_)return E;for(var P=1;P<=C.length-1;P++)if(S(E,C[P]),E.length===_)return E;T=w=A}}return S(E,M(a,w)),E}]}),!!v((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),y)})),KJ=Z((()=>{"use strict";var e,t=Je(),n=Cc(),r=As().f,i=ha(),a=Fn(),s=z_(),o=Kr(),l=q_(),h=ci(),u=n("".slice),c=Math.min,d=l("startsWith");t({target:"String",proto:!0,forced:!!(h||d||(e=r(String.prototype,"startsWith"),!e||e.writable))&&!d},{startsWith:function(e){var t=a(o(this));s(e);var n=i(c(arguments.length>1?arguments[1]:void 0,t.length)),r=a(e);return u(t,n,n+r.length)===r}})})),QJ=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Kr(),r=gi(),i=Fn(),a=t("".slice),s=Math.max,o=Math.min;e({target:"String",proto:!0,forced:!"".substr||"b"!=="ab".substr(-1)},{substr:function(e,t){var l,h,u=i(n(this)),c=u.length,d=r(e);return d===1/0&&(d=0),d<0&&(d=s(c+d,0)),(l=void 0===t?c:r(t))<=0||l===1/0?"":d>=(h=o(d+l,c))?"":a(u,d,h)}})})),rQ=Z((()=>{"use strict";var e=Je(),t=qn(),n=Ut(),r=Kr(),i=Fn(),a=kt(),s=Array,o=n("".charAt),l=n("".charCodeAt),h=n([].join),u="".toWellFormed,c=u&&a((function(){return"1"!==t(u,1)}));e({target:"String",proto:!0,forced:c},{toWellFormed:function(){var e=i(r(this));if(c)return t(u,e);for(var n=e.length,a=s(n),d=0;d<n;d++){var p=l(e,d);55296!=(63488&p)?a[d]=o(e,d):p>=56320||d+1>=n||56320!=(64512&l(e,d+1))?a[d]="ï¿½":(a[d]=o(e,d),a[++d]=o(e,d))}return h(a,"")}})})),Y_=Z(((e,t)=>{"use strict";var n=lf().PROPER,r=kt(),i=Pv();t.exports=function(e){return r((function(){return!!i[e]()||"âÂá "!=="âÂá "[e]()||n&&i[e].name!==e}))}})),oQ=Z((()=>{"use strict";var e=Je(),t=Ef().trim;e({target:"String",proto:!0,forced:Y_()("trim")},{trim:function(){return t(this)}})})),LD=Z(((e,t)=>{"use strict";var n=Ef().end,r=Y_();t.exports=r("trimEnd")?function(){return n(this)}:"".trimEnd})),uQ=Z((()=>{"use strict";var e=Je(),t=LD();e({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==t},{trimRight:t})})),fQ=Z((()=>{"use strict";uQ();var e=Je(),t=LD();e({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==t},{trimEnd:t})})),kD=Z(((e,t)=>{"use strict";var n=Ef().start,r=Y_();t.exports=r("trimStart")?function(){return n(this)}:"".trimStart})),mQ=Z((()=>{"use strict";var e=Je(),t=kD();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),vQ=Z((()=>{"use strict";mQ();var e=Je(),t=kD();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),ma=Z(((e,t)=>{"use strict";var n=Ut(),r=Kr(),i=Fn(),a=/"/g,s=n("".replace);t.exports=function(e,t,n,o){var l=i(r(e)),h="<"+t;return""!==n&&(h+=" "+n+'="'+s(i(o),a,"&quot;")+'"'),h+">"+l+"</"+t+">"}})),ga=Z(((e,t)=>{"use strict";var n=kt();t.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}})),EQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("anchor")},{anchor:function(e){return t(this,"a","name",e)}})})),_Q=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("big")},{big:function(){return t(this,"big","","")}})})),TQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("blink")},{blink:function(){return t(this,"blink","","")}})})),SQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("bold")},{bold:function(){return t(this,"b","","")}})})),wQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("fixed")},{fixed:function(){return t(this,"tt","","")}})})),MQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("fontcolor")},{fontcolor:function(e){return t(this,"font","color",e)}})})),AQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("fontsize")},{fontsize:function(e){return t(this,"font","size",e)}})})),CQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("italics")},{italics:function(){return t(this,"i","","")}})})),RQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("link")},{link:function(e){return t(this,"a","href",e)}})})),PQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("small")},{small:function(){return t(this,"small","","")}})})),IQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("strike")},{strike:function(){return t(this,"strike","","")}})})),DQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("sub")},{sub:function(){return t(this,"sub","","")}})})),OQ=Z((()=>{"use strict";var e=Je(),t=ma();e({target:"String",proto:!0,forced:ga()("sup")},{sup:function(){return t(this,"sup","","")}})})),$_=Z(((e,t)=>{"use strict";var n=rn(),r=kt(),i=dv(),a=Jn().NATIVE_ARRAY_BUFFER_VIEWS,s=n.ArrayBuffer,o=n.Int8Array;t.exports=!a||!r((function(){o(1)}))||!r((function(){new o(-1)}))||!i((function(e){new o,new o(null),new o(1.5),new o(e)}),!0)||r((function(){return 1!==new o(new s(2),1,void 0).length}))})),NQ=Z(((e,t)=>{"use strict";var n=gi(),r=RangeError;t.exports=function(e){var t=n(e);if(t<0)throw new r("The argument can't be less than 0");return t}})),ND=Z(((e,t)=>{"use strict";var n=NQ(),r=RangeError;t.exports=function(e,t){var i=n(e);if(i%t)throw new r("Wrong offset");return i}})),HQ=Z(((e,t)=>{"use strict";var n=Math.round;t.exports=function(e){var t=n(e);return t<0?0:t>255?255:255&t}})),BD=Z(((e,t)=>{"use strict";var n=Zo();t.exports=function(e){var t=n(e);return"BigInt64Array"===t||"BigUint64Array"===t}})),Z_=Z(((e,t)=>{"use strict";var n=K0(),r=TypeError;t.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw new r("Can't convert number to bigint");return BigInt(t)}})),UD=Z(((e,t)=>{"use strict";var n=uo(),r=qn(),i=d_(),a=Tr(),s=Rr(),o=uv(),l=Rp(),h=zE(),u=BD(),c=Jn().aTypedArrayConstructor,d=Z_();t.exports=function(e){var t,p,f,m,g,v,y,x,b=i(this),_=a(e),w=arguments.length,S=w>1?arguments[1]:void 0,M=void 0!==S,T=l(_);if(T&&!h(T))for(x=(y=o(_,T)).next,_=[];!(v=r(x,y)).done;)_.push(v.value);for(M&&w>2&&(S=n(S,arguments[2])),p=s(_),f=new(c(b))(p),m=u(f),t=0;p>t;t++)g=M?S(_[t],t):_[t],f[t]=m?d(g):+g;return f}})),zl=Z(((e,t)=>{"use strict";var n=Je(),r=rn(),i=qn(),a=An(),s=$_(),o=Jn(),l=Ev(),h=Jo(),u=La(),c=Cs(),d=T_(),p=ha(),f=fP(),m=ND(),g=HQ(),v=kl(),y=pr(),x=Zo(),b=Kn(),_=Lu(),w=fa(),S=ua(),M=Ko(),T=Fu().f,E=UD(),A=Qi().forEach,C=gf(),P=Ji(),I=Qr(),R=As(),L=yv(),O=Ii(),D=Uu(),k=O.get,N=O.set,F=O.enforce,U=I.f,B=R.f,z=r.RangeError,H=l.ArrayBuffer,V=H.prototype,j=l.DataView,G=o.NATIVE_ARRAY_BUFFER_VIEWS,W=o.TYPED_ARRAY_TAG,q=o.TypedArray,X=o.TypedArrayPrototype,Y=o.isTypedArray,Z="BYTES_PER_ELEMENT",J="Wrong length",K=function(e,t){P(e,t,{configurable:!0,get:function(){return k(this)[t]}})},Q=function(e){var t;return S(V,e)||"ArrayBuffer"===(t=x(e))||"SharedArrayBuffer"===t},$=function(e,t){return Y(e)&&!_(t)&&t in e&&d(+t)&&t>=0},ee=function(e,t){return t=v(t),$(e,t)?u(2,e[t]):B(e,t)},te=function(e,t,n){return t=v(t),!($(e,t)&&b(n)&&y(n,"value"))||y(n,"get")||y(n,"set")||n.configurable||y(n,"writable")&&!n.writable||y(n,"enumerable")&&!n.enumerable?U(e,t,n):(e[t]=n.value,e)};a?(G||(R.f=ee,I.f=te,K(X,"buffer"),K(X,"byteOffset"),K(X,"byteLength"),K(X,"length")),n({target:"Object",stat:!0,forced:!G},{getOwnPropertyDescriptor:ee,defineProperty:te}),t.exports=function(e,t,a){var o=e.match(/\d+/)[0]/8,l=e+(a?"Clamped":"")+"Array",u="get"+e,d="set"+e,v=r[l],y=v,x=y&&y.prototype,_={},S=function(e,t){U(e,t,{get:function(){return function(e,t){var n=k(e);return n.view[u](t*o+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var r=k(e);r.view[d](t*o+r.byteOffset,a?g(n):n,!0)}(this,t,e)},enumerable:!0})};G?s&&(y=t((function(e,t,n,r){return h(e,x),D(b(t)?Q(t)?void 0!==r?new v(t,m(n,o),r):void 0!==n?new v(t,m(n,o)):new v(t):Y(t)?L(y,t):i(E,y,t):new v(f(t)),e,y)})),M&&M(y,q),A(T(v),(function(e){e in y||c(y,e,v[e])})),y.prototype=x):(y=t((function(e,t,n,r){h(e,x);var a,s,l,u=0,c=0;if(b(t)){if(!Q(t))return Y(t)?L(y,t):i(E,y,t);a=t,c=m(n,o);var d=t.byteLength;if(void 0===r){if(d%o)throw new z(J);if((s=d-c)<0)throw new z(J)}else if((s=p(r)*o)+c>d)throw new z(J);l=s/o}else l=f(t),a=new H(s=l*o);for(N(e,{buffer:a,byteOffset:c,byteLength:s,length:l,view:new j(a)});u<l;)S(e,u++)})),M&&M(y,q),x=y.prototype=w(X)),x.constructor!==y&&c(x,"constructor",y),F(x).TypedArrayConstructor=y,W&&c(x,W,l);var P=y!==v;_[l]=y,n({global:!0,constructor:!0,forced:P,sham:!G},_),Z in y||c(y,Z,o),Z in x||c(x,Z,o),C(l)}):t.exports=function(){}})),cee=Z((()=>{"use strict";zl()("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),uee=Z((()=>{"use strict";zl()("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),hee=Z((()=>{"use strict";zl()("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),fee=Z((()=>{"use strict";zl()("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),dee=Z((()=>{"use strict";zl()("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),pee=Z((()=>{"use strict";zl()("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),mee=Z((()=>{"use strict";zl()("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0)})),gee=Z((()=>{"use strict";zl()("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),vee=Z((()=>{"use strict";zl()("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))})),xee=Z((()=>{"use strict";var e=Jn(),t=Rr(),n=gi(),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("at",(function(e){var i=r(this),a=t(i),s=n(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:i[o]}))})),Eee=Z((()=>{"use strict";var e=Ut(),t=Jn(),n=e(z2()),r=t.aTypedArray;(0,t.exportTypedArrayMethod)("copyWithin",(function(e,t){return n(r(this),e,t,arguments.length>2?arguments[2]:void 0)}))})),Tee=Z((()=>{"use strict";var e=Jn(),t=Qi().every,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("every",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),wee=Z((()=>{"use strict";var e=Jn(),t=jE(),n=Z_(),r=Zo(),i=qn(),a=Ut(),s=kt(),o=e.aTypedArray,l=e.exportTypedArrayMethod,h=a("".slice);l("fill",(function(e){var a=arguments.length;o(this);var s="Big"===h(r(this),0,3)?n(e):+e;return i(t,this,s,a>1?arguments[1]:void 0,a>2?arguments[2]:void 0)}),s((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})))})),t1=Z(((e,t)=>{"use strict";var n=Jn(),r=yf(),i=n.aTypedArrayConstructor,a=n.getTypedArrayConstructor;t.exports=function(e){return i(r(e,a(e)))}})),Ree=Z(((e,t)=>{"use strict";var n=yv(),r=t1();t.exports=function(e,t){return n(r(e),t)}})),Iee=Z((()=>{"use strict";var e=Jn(),t=Qi().filter,n=Ree(),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("filter",(function(e){var i=t(r(this),e,arguments.length>1?arguments[1]:void 0);return n(this,i)}))})),Oee=Z((()=>{"use strict";var e=Jn(),t=Qi().find,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("find",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),kee=Z((()=>{"use strict";var e=Jn(),t=Qi().findIndex,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("findIndex",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),Nee=Z((()=>{"use strict";var e=Jn(),t=fv().findLast,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("findLast",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),Uee=Z((()=>{"use strict";var e=Jn(),t=fv().findLastIndex,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("findLastIndex",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),Vee=Z((()=>{"use strict";var e=Jn(),t=Qi().forEach,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("forEach",(function(e){t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),zee=Z((()=>{"use strict";var e=$_();(0,Jn().exportTypedArrayStaticMethod)("from",UD(),e)})),Gee=Z((()=>{"use strict";var e=Jn(),t=xp().includes,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("includes",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),jee=Z((()=>{"use strict";var e=Jn(),t=xp().indexOf,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("indexOf",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),Kee=Z((()=>{"use strict";var e=rn(),t=kt(),n=Ut(),r=Jn(),i=gv(),a=rr()("iterator"),s=e.Uint8Array,o=n(i.values),l=n(i.keys),h=n(i.entries),u=r.aTypedArray,c=r.exportTypedArrayMethod,d=s&&s.prototype,p=!t((function(){d[a].call([1])})),f=!!d&&d.values&&d[a]===d.values&&"values"===d.values.name,m=function(){return o(u(this))};c("entries",(function(){return h(u(this))}),p),c("keys",(function(){return l(u(this))}),p),c("values",m,p||!f,{name:"values"}),c(a,m,p||!f,{name:"values"})})),Qee=Z((()=>{"use strict";var e=Jn(),t=Ut(),n=e.aTypedArray,r=e.exportTypedArrayMethod,i=t([].join);r("join",(function(e){return i(n(this),e)}))})),tte=Z((()=>{"use strict";var e=Jn(),t=Fa(),n=rP(),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("lastIndexOf",(function(e){var i=arguments.length;return t(n,r(this),i>1?[e,arguments[1]]:[e])}))})),rte=Z((()=>{"use strict";var e=Jn(),t=Qi().map,n=t1(),r=e.aTypedArray;(0,e.exportTypedArrayMethod)("map",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(n(e))(t)}))}))})),ste=Z((()=>{"use strict";var e=Jn(),t=$_(),n=e.aTypedArrayConstructor;(0,e.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,r=new(n(this))(t);t>e;)r[e]=arguments[e++];return r}),t)})),ote=Z((()=>{"use strict";var e=Jn(),t=vv().left,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("reduce",(function(e){var r=arguments.length;return t(n(this),e,r,r>1?arguments[1]:void 0)}))})),cte=Z((()=>{"use strict";var e=Jn(),t=vv().right,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("reduceRight",(function(e){var r=arguments.length;return t(n(this),e,r,r>1?arguments[1]:void 0)}))})),hte=Z((()=>{"use strict";var e=Jn(),t=e.aTypedArray,n=e.exportTypedArrayMethod,r=Math.floor;n("reverse",(function(){for(var e,n=this,i=t(n).length,a=r(i/2),s=0;s<a;)e=n[s],n[s++]=n[--i],n[i]=e;return n}))})),vte=Z((()=>{"use strict";var e=rn(),t=qn(),n=Jn(),r=Rr(),i=ND(),a=Tr(),s=kt(),o=e.RangeError,l=e.Int8Array,h=l&&l.prototype,u=h&&h.set,c=n.aTypedArray,d=n.exportTypedArrayMethod,p=!s((function(){var e=new Uint8ClampedArray(2);return t(u,e,{length:1,0:3},1),3!==e[1]})),f=p&&n.NATIVE_ARRAY_BUFFER_VIEWS&&s((function(){var e=new l(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));d("set",(function(e){c(this);var n=i(arguments.length>1?arguments[1]:void 0,1),s=a(e);if(p)return t(u,this,s,n);var l=this.length,h=r(s),d=0;if(h+n>l)throw new o("Wrong length");for(;d<h;)this[n+d]=s[d++]}),!p||f)})),xte=Z((()=>{"use strict";var e=Jn(),t=t1(),n=kt(),r=ka(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("slice",(function(e,n){for(var a=r(i(this),e,n),s=t(this),o=0,l=a.length,h=new s(l);l>o;)h[o]=a[o++];return h}),n((function(){new Int8Array(1).slice()})))})),Ete=Z((()=>{"use strict";var e=Jn(),t=Qi().some,n=e.aTypedArray;(0,e.exportTypedArrayMethod)("some",(function(e){return t(n(this),e,arguments.length>1?arguments[1]:void 0)}))})),Ate=Z((()=>{"use strict";var e=rn(),t=Cc(),n=kt(),r=Jr(),i=QE(),a=Jn(),s=aP(),o=oP(),l=Ol(),h=e_(),u=a.aTypedArray,c=a.exportTypedArrayMethod,d=e.Uint16Array,p=d&&t(d.prototype.sort),f=!(!p||n((function(){p(new d(2),null)}))&&n((function(){p(new d(2),{})}))),m=!!p&&!n((function(){if(l)return l<74;if(s)return s<67;if(o)return!0;if(h)return h<602;var e,t,n=new d(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(p(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));c("sort",(function(e){return void 0!==e&&r(e),m?p(this,e):i(u(this),(t=e,function(e,n){return void 0!==t?+t(e,n)||0:n!=n?-1:e!=e?1:0===e&&0===n?1/e>0&&1/n<0?1:-1:e>n}));var t}),!m||f)})),Pte=Z((()=>{"use strict";var e=Jn(),t=ha(),n=Fl(),r=t1(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("subarray",(function(e,a){var s=i(this),o=s.length,l=n(e,o);return new(r(s))(s.buffer,s.byteOffset+l*s.BYTES_PER_ELEMENT,t((void 0===a?o:n(a,o))-l))}))})),kte=Z((()=>{"use strict";var e=rn(),t=Fa(),n=Jn(),r=kt(),i=ka(),a=e.Int8Array,s=n.aTypedArray,o=n.exportTypedArrayMethod,l=[].toLocaleString,h=!!a&&r((function(){l.call(new a(1))}));o("toLocaleString",(function(){return t(l,h?i(s(this)):s(this),i(arguments))}),r((function(){return[1,2].toLocaleString()!==new a([1,2]).toLocaleString()}))||!r((function(){a.prototype.toLocaleString.call([1,2])})))})),Fte=Z((()=>{"use strict";var e=uP(),t=Jn(),n=t.aTypedArray,r=t.exportTypedArrayMethod,i=t.getTypedArrayConstructor;r("toReversed",(function(){return e(n(this),i(this))}))})),Nte=Z((()=>{"use strict";var e=Jn(),t=Ut(),n=Jr(),r=yv(),i=e.aTypedArray,a=e.getTypedArrayConstructor,s=e.exportTypedArrayMethod,o=t(e.TypedArrayPrototype.sort);s("toSorted",(function(e){void 0!==e&&n(e);var t=i(this),s=r(a(t),t);return o(s,e)}))})),Ute=Z((()=>{"use strict";var e=Jn().exportTypedArrayMethod,t=kt(),n=rn(),r=Ut(),i=n.Uint8Array,a=i&&i.prototype||{},s=[].toString,o=r([].join);t((function(){s.call({})}))&&(s=function(){return o(this)});var l=a.toString!==s;e("toString",s,l)})),Hte=Z((()=>{"use strict";var e=hP(),t=Jn(),n=BD(),r=gi(),i=Z_(),a=t.aTypedArray,s=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("with",(function(t,o){var l=a(this),h=r(t),u=n(l)?i(o):+o;return e(l,s(l),h,u)}),!!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}())})),Wte=Z((()=>{"use strict";var e=Je(),t=Ut(),n=Fn(),r=String.fromCharCode,i=t("".charAt),a=t(/./.exec),s=t("".slice),o=/^[\da-f]{2}$/i,l=/^[\da-f]{4}$/i;e({global:!0},{unescape:function(e){for(var t,h,u=n(e),c="",d=u.length,p=0;p<d;){if("%"===(t=i(u,p++)))if("u"===i(u,p)){if(h=s(u,p+1,p+5),a(l,h)){c+=r(parseInt(h,16)),p+=5;continue}}else if(h=s(u,p,p+2),a(o,h)){c+=r(parseInt(h,16)),p+=2;continue}c+=t}return c}})})),lO=Z(((e,t)=>{"use strict";var n=Ut(),r=Op(),i=ju().getWeakData,a=Jo(),s=Gn(),o=qs(),l=Kn(),h=Ba(),u=Qi(),c=pr(),d=Ii(),p=d.set,f=d.getterFor,m=u.find,g=u.findIndex,v=n([].splice),y=0,x=function(e){return e.frozen||(e.frozen=new b)},b=function(){this.entries=[]},_=function(e,t){return m(e.entries,(function(e){return e[0]===t}))};b.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var n=_(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=g(this.entries,(function(t){return t[0]===e}));return~t&&v(this.entries,t,1),!!~t}},t.exports={getConstructor:function(e,t,n,u){var d=e((function(e,r){a(e,m),p(e,{type:t,id:y++,frozen:void 0}),o(r)||h(r,e[u],{that:e,AS_ENTRIES:n})})),m=d.prototype,g=f(t),v=function(e,t,n){var r=g(e),a=i(s(t),!0);return!0===a?x(r).set(t,n):a[r.id]=n,e};return r(m,{delete:function(e){var t=g(this);if(!l(e))return!1;var n=i(e);return!0===n?x(t).delete(e):n&&c(n,t.id)&&delete n[t.id]},has:function(e){var t=g(this);if(!l(e))return!1;var n=i(e);return!0===n?x(t).has(e):n&&c(n,t.id)}}),r(m,n?{get:function(e){var t=g(this);if(l(e)){var n=i(e);return!0===n?x(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),d}}})),sne=Z((()=>{"use strict";var e,t,n,r,i=bf(),a=rn(),s=Ut(),o=Op(),l=ju(),h=Sv(),u=lO(),c=Kn(),d=Ii().enforce,p=kt(),f=G3(),m=Object,g=Array.isArray,v=m.isExtensible,y=m.isFrozen,x=m.isSealed,b=m.freeze,_=m.seal,w=!a.ActiveXObject&&"ActiveXObject"in a,S=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},M=h("WeakMap",S,u),T=M.prototype,E=s(T.set);f&&(w?(e=u.getConstructor(S,"WeakMap",!0),l.enable(),t=s(T.delete),n=s(T.has),r=s(T.get),o(T,{delete:function(n){if(c(n)&&!v(n)){var r=d(this);return r.frozen||(r.frozen=new e),t(this,n)||r.frozen.delete(n)}return t(this,n)},has:function(t){if(c(t)&&!v(t)){var r=d(this);return r.frozen||(r.frozen=new e),n(this,t)||r.frozen.has(t)}return n(this,t)},get:function(t){if(c(t)&&!v(t)){var i=d(this);return i.frozen||(i.frozen=new e),n(this,t)?r(this,t):i.frozen.get(t)}return r(this,t)},set:function(t,r){if(c(t)&&!v(t)){var i=d(this);i.frozen||(i.frozen=new e),n(this,t)?E(this,t,r):i.frozen.set(t,r)}else E(this,t,r);return this}})):i&&p((function(){var e=b([]);return E(new M,e,1),!y(e)}))&&o(T,{set:function(e,t){var n;return g(e)&&(y(e)?n=b:x(e)&&(n=_)),E(this,e,t),n&&n(e),this}}))})),ane=Z((()=>{"use strict";sne()})),one=Z((()=>{"use strict";Sv()("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),lO())})),lne=Z((()=>{"use strict";one()})),hO=Z(((e,t)=>{"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n+"+/",i=n+"-_",a=function(e){for(var t={},n=0;n<64;n++)t[e.charAt(n)]=n;return t};t.exports={i2c:r,c2i:a(r),i2cUrl:i,c2iUrl:a(i)}})),bne=Z((()=>{"use strict";var e=Je(),t=rn(),n=Ur(),r=Ut(),i=qn(),a=kt(),s=Fn(),o=fo(),l=hO().c2i,h=/[^\d+/a-z]/i,u=/[\t\n\f\r ]+/g,c=/[=]{1,2}$/,d=n("atob"),p=String.fromCharCode,f=r("".charAt),m=r("".replace),g=r(h.exec),v=!!d&&!a((function(){return"hi"!==d("aGk=")})),y=v&&a((function(){return""!==d(" ")})),x=v&&!a((function(){d("a")})),b=v&&!a((function(){d()})),_=v&&1!==d.length;e({global:!0,bind:!0,enumerable:!0,forced:!v||y||x||b||_},{atob:function(e){if(o(arguments.length,1),v&&!y&&!x)return i(d,t,e);var r,a,b,_=m(s(e),u,""),w="",S=0,M=0;if(_.length%4==0&&(_=m(_,c,"")),(r=_.length)%4==1||g(h,_))throw new(n("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;S<r;)a=f(_,S++),b=M%4?64*b+l[a]:l[a],M++%4&&(w+=p(255&b>>(-2*M&6)));return w}})})),wne=Z((()=>{"use strict";var e=Je(),t=rn(),n=Ur(),r=Ut(),i=qn(),a=kt(),s=Fn(),o=fo(),l=hO().i2c,h=n("btoa"),u=r("".charAt),c=r("".charCodeAt),d=!!h&&!a((function(){return"aGk="!==h("hi")})),p=d&&!a((function(){h()})),f=d&&a((function(){return"bnVsbA=="!==h(null)})),m=d&&1!==h.length;e({global:!0,bind:!0,enumerable:!0,forced:!d||p||f||m},{btoa:function(e){if(o(arguments.length,1),d)return i(h,t,s(e));for(var r,a,p=s(e),f="",m=0,g=l;u(p,m)||(g="=",m%1);){if((a=c(p,m+=3/4))>255)throw new(n("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");f+=u(g,63&(r=r<<8|a)>>8-m%1*8)}return f}})})),pO=Z(((e,t)=>{"use strict";t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),gO=Z(((e,t)=>{"use strict";var n=J0()("span").classList,r=n&&n.constructor&&n.constructor.prototype;t.exports=r===Object.prototype?void 0:r})),Dne=Z((()=>{"use strict";var e,t=rn(),n=pO(),r=gO(),i=j2(),a=Cs(),s=function(e){if(e&&e.forEach!==i)try{a(e,"forEach",i)}catch(t){e.forEach=i}};for(e in n)n[e]&&s(t[e]&&t[e].prototype);s(r)})),Nne=Z((()=>{"use strict";var e,t=rn(),n=pO(),r=gO(),i=gv(),a=Cs(),s=Ws(),o=rr()("iterator"),l=i.values,h=function(e,t){if(e){if(e[o]!==l)try{a(e,o,l)}catch(t){e[o]=l}if(s(e,t,!0),n[t])for(var r in i)if(e[r]!==i[r])try{a(e,r,i[r])}catch(t){e[r]=i[r]}}};for(e in n)h(t[e]&&t[e].prototype,e);h(r,"DOMTokenList")})),bO=Z(((e,t)=>{"use strict";var n=Lc();t.exports=function(e){try{if(n)return Function('return require("'+e+'")')()}catch(e){}}})),EO=Z(((e,t)=>{"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}})),Zne=Z((()=>{"use strict";var e=Je(),t=bO(),n=Ur(),r=kt(),i=fa(),a=La(),s=Qr().f,o=Xr(),l=Ji(),h=pr(),u=Jo(),c=Gn(),d=D2(),p=Ap(),f=EO(),m=BE(),g=Ii(),v=An(),y=ci(),x="DOMException",b="DATA_CLONE_ERR",_=n("Error"),w=n(x)||function(){try{(new(n("MessageChannel")||t("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(e){if(e.name===b&&25===e.code)return e.constructor}}(),S=w&&w.prototype,M=_.prototype,T=g.set,E=g.getterFor(x),A="stack"in new _(x),C=function(e){return h(f,e)&&f[e].m?f[e].c:0},P=function(){u(this,I);var e=arguments.length,t=p(e<1?void 0:arguments[0]),n=p(e<2?void 0:arguments[1],"Error"),r=C(n);if(T(this,{type:x,name:n,message:t,code:r}),v||(this.name=n,this.message=t,this.code=r),A){var i=new _(t);i.name=x,s(this,"stack",a(1,m(i.stack,1)))}},I=P.prototype=i(M),R=function(e){return{enumerable:!0,configurable:!0,get:e}},L=function(e){return R((function(){return E(this)[e]}))};v&&(l(I,"code",L("code")),l(I,"message",L("message")),l(I,"name",L("name"))),s(I,"constructor",a(1,P));var O=r((function(){return!(new w instanceof _)})),D=O||r((function(){return M.toString!==d||"2: 1"!==String(new w(1,2))})),k=O||r((function(){return 25!==new w(1,"DataCloneError").code})),N=O||25!==w[b]||25!==S[b],F=y?D||k||N:O;e({global:!0,constructor:!0,forced:F},{DOMException:F?P:w});var U,B,z,H,V=n(x),j=V.prototype;for(H in D&&(y||w===V)&&o(j,"toString",d),k&&v&&w===V&&l(j,"code",R((function(){return C(c(this).name)}))),f)h(f,H)&&(B=(U=f[H]).s,z=a(6,U.c),h(V,B)||s(V,B,z),h(j,B)||s(j,B,z))})),rre=Z((()=>{"use strict";var e=Je(),t=rn(),n=Ur(),r=La(),i=Qr().f,a=pr(),s=Jo(),o=Uu(),l=Ap(),h=EO(),u=BE(),c=An(),d=ci(),p="DOMException",f=n("Error"),m=n(p),g=function(){s(this,v);var e=arguments.length,t=l(e<1?void 0:arguments[0]),n=l(e<2?void 0:arguments[1],"Error"),a=new m(t,n),h=new f(t);return h.name=p,i(a,"stack",r(1,u(h.stack,1))),o(a,this,g),a},v=g.prototype=m.prototype,y="stack"in new f(p),x="stack"in new m(1,2),b=m&&c&&Object.getOwnPropertyDescriptor(t,p),_=!(!b||b.writable&&b.configurable),w=y&&!_&&!x;e({global:!0,constructor:!0,forced:d||w},{DOMException:w?g:m});var S,M,T,E=n(p),A=E.prototype;if(A.constructor!==E)for(T in d||i(A,"constructor",r(1,E)),h)a(h,T)&&(a(E,M=(S=h[T]).s)||i(E,M,r(6,S.c)))})),sre=Z((()=>{"use strict";var e=Ur(),t="DOMException";Ws()(e(t),t)})),ore=Z((()=>{"use strict";var e=Je(),t=rn(),n=Nv().clear;e({global:!0,bind:!0,enumerable:!0,forced:t.clearImmediate!==n},{clearImmediate:n})})),cre=Z(((e,t)=>{"use strict";t.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version})),TT=Z(((e,t)=>{"use strict";var n,r=rn(),i=Fa(),a=lr(),s=cre(),o=Dl(),l=ka(),h=fo(),u=r.Function,c=/MSIE .\./.test(o)||s&&((n=r.Bun.version.split(".")).length<3||"0"===n[0]&&(n[1]<3||"3"===n[1]&&"0"===n[2]));t.exports=function(e,t){var n=t?2:1;return c?function(r,s){var o=h(arguments.length,1)>n,c=a(r)?r:u(r),d=o?l(arguments,n):[],p=o?function(){i(c,this,d)}:c;return t?e(p,s):e(p)}:e}})),mre=Z((()=>{"use strict";var e=Je(),t=rn(),n=Nv().set,r=TT(),i=t.setImmediate?r(n,!1):n;e({global:!0,bind:!0,enumerable:!0,forced:t.setImmediate!==i},{setImmediate:i})})),gre=Z((()=>{"use strict";ore(),mre()})),vre=Z((()=>{"use strict";var e=Je(),t=OI(),n=Jr(),r=fo();e({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){r(arguments.length,1),t(n(e))}})})),xre=Z((()=>{"use strict";var e,t=Je(),n=rn(),r=Ji(),i=An(),a=TypeError,s=Object.defineProperty,o=n.self!==n;try{i?(e=Object.getOwnPropertyDescriptor(n,"self"),(o||!e||!e.get||!e.enumerable)&&r(n,"self",{get:function(){return n},set:function(e){if(this!==n)throw new a("Illegal invocation");s(n,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})):t({global:!0,simple:!0,forced:o},{self:n})}catch(e){}})),VO=Z(((e,t)=>{"use strict";var n=Ut(),r=Set.prototype;t.exports={Set:Set,add:n(r.add),has:n(r.has),remove:n(r.delete),proto:r}})),_re=Z(((e,t)=>{"use strict";var n=qn();t.exports=function(e,t,r){for(var i,a,s=r?e:e.iterator,o=e.next;!(i=n(o,s)).done;)if(void 0!==(a=t(i.value)))return a}})),Cre=Z(((e,t)=>{"use strict";var n=Ut(),r=_re(),i=VO(),a=i.Set,s=i.proto,o=n(s.forEach),l=n(s.keys),h=l(new a).next;t.exports=function(e,t,n){return n?r({iterator:l(e),next:h},t):o(e,t)}})),qO=Z(((e,t)=>{"use strict";var n=rn(),r=kt(),i=Ol(),a=LI(),s=C_(),o=Lc(),l=n.structuredClone;t.exports=!!l&&!r((function(){if(s&&i>92||o&&i>94||a&&i>97)return!1;var e=new ArrayBuffer(8),t=l(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))})),Lre=Z(((e,t)=>{"use strict";var n,r,i,a,s=rn(),o=bO(),l=qO(),h=s.structuredClone,u=s.ArrayBuffer,c=s.MessageChannel,d=!1;if(l)d=function(e){h(e,{transfer:[e]})};else if(u)try{c||(n=o("worker_threads"))&&(c=n.MessageChannel),c&&(r=new c,i=new u(2),a=function(e){r.port1.postMessage(null,[e])},2===i.byteLength&&(a(i),0===i.byteLength&&(d=a)))}catch(e){}t.exports=d})),Wre=Z((()=>{"use strict";var e,t=ci(),n=Je(),r=rn(),i=Ur(),a=Ut(),s=kt(),o=of(),l=lr(),h=uf(),u=qs(),c=Kn(),d=Lu(),p=Ba(),f=Gn(),m=Zo(),g=pr(),v=Dc(),y=Cs(),x=Rr(),b=fo(),_=Jp(),w=GP(),S=VO(),M=Cre(),T=Lre(),E=A2(),A=qO(),C=r.Object,P=r.Array,I=r.Date,R=r.Error,L=r.TypeError,O=r.PerformanceMark,D=i("DOMException"),k=w.Map,N=w.has,F=w.get,U=w.set,B=S.Set,z=S.add,H=S.has,V=i("Object","keys"),j=a([].push),G=a((!0).valueOf),W=a(1..valueOf),q=a("".valueOf),X=a(I.prototype.getTime),Y=o("structuredClone"),Z="DataCloneError",J="Transferring",K=function(e){return!s((function(){var t=new r.Set([7]),n=e(t),i=e(C(7));return n===t||!n.has(7)||!c(i)||7!=+i}))&&e},Q=function(e,t){return!s((function(){var n=new t,r=e({a:n,b:n});return!(r&&r.a===r.b&&r.a instanceof t&&r.a.stack===n.stack)}))},$=r.structuredClone,ee=t||!Q($,R)||!Q($,D)||(e=$,!!s((function(){var t=e(new r.AggregateError([1],Y,{cause:3}));return"AggregateError"!==t.name||1!==t.errors[0]||t.message!==Y||3!==t.cause}))),te=!$&&K((function(e){return new O(Y,{detail:e}).detail})),ne=K($)||te,re=function(e){throw new D("Uncloneable type: "+e,Z)},ie=function(e,t){throw new D((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",Z)},ae=function(e,t){return ne||ie(t),ne(e)},se=function(e,t,n){if(N(t,e))return F(t,e);var i,a,s,o,h,u;if("SharedArrayBuffer"===(n||m(e)))i=ne?ne(e):e;else{var c=r.DataView;!c&&!l(e.slice)&&ie("ArrayBuffer");try{if(l(e.slice)&&!e.resizable)i=e.slice(0);else for((a=e.byteLength,s="maxByteLength"in e?{maxByteLength:e.maxByteLength}:void 0,i=new ArrayBuffer(a,s),o=new c(e),h=new c(i),u=0);u<a;u++)h.setUint8(u,o.getUint8(u))}catch(e){throw new D("ArrayBuffer is detached",Z)}}return U(t,e,i),i},oe=function(e,t){if(d(e)&&re("Symbol"),!c(e))return e;if(t){if(N(t,e))return F(t,e)}else t=new k;var n,a,s,o,h,u,p,f,b=m(e);switch(b){case"Array":s=P(x(e));break;case"Object":s={};break;case"Map":s=new k;break;case"Set":s=new B;break;case"RegExp":s=new RegExp(e.source,_(e));break;case"Error":switch(a=e.name){case"AggregateError":s=new(i(a))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":s=new(i(a));break;case"CompileError":case"LinkError":case"RuntimeError":s=new(i("WebAssembly",a));break;default:s=new R}break;case"DOMException":s=new D(e.message,e.name);break;case"ArrayBuffer":case"SharedArrayBuffer":s=se(e,t,b);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":u="DataView"===b?e.byteLength:e.length,s=function(e,t,n,i,a){var s=r[t];return c(s)||ie(t),new s(se(e.buffer,a),n,i)}(e,b,e.byteOffset,u,t);break;case"DOMQuad":try{s=new DOMQuad(oe(e.p1,t),oe(e.p2,t),oe(e.p3,t),oe(e.p4,t))}catch(t){s=ae(e,b)}break;case"File":if(ne)try{s=ne(e),m(s)!==b&&(s=void 0)}catch(e){}if(!s)try{s=new File([e],e.name,e)}catch(e){}s||ie(b);break;case"FileList":if(o=function(){var e;try{e=new r.DataTransfer}catch(t){try{e=new r.ClipboardEvent("").clipboardData}catch(e){}}return e&&e.items&&e.files?e:null}(),o){for(h=0,u=x(e);h<u;h++)o.items.add(oe(e[h],t));s=o.files}else s=ae(e,b);break;case"ImageData":try{s=new ImageData(oe(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(t){s=ae(e,b)}break;default:if(ne)s=ne(e);else switch(b){case"BigInt":s=C(e.valueOf());break;case"Boolean":s=C(G(e));break;case"Number":s=C(W(e));break;case"String":s=C(q(e));break;case"Date":s=new I(X(e));break;case"Blob":try{s=e.slice(0,e.size,e.type)}catch(e){ie(b)}break;case"DOMPoint":case"DOMPointReadOnly":n=r[b];try{s=n.fromPoint?n.fromPoint(e):new n(e.x,e.y,e.z,e.w)}catch(e){ie(b)}break;case"DOMRect":case"DOMRectReadOnly":n=r[b];try{s=n.fromRect?n.fromRect(e):new n(e.x,e.y,e.width,e.height)}catch(e){ie(b)}break;case"DOMMatrix":case"DOMMatrixReadOnly":n=r[b];try{s=n.fromMatrix?n.fromMatrix(e):new n(e)}catch(e){ie(b)}break;case"AudioData":case"VideoFrame":l(e.clone)||ie(b);try{s=e.clone()}catch(e){re(b)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ie(b);default:re(b)}}switch(U(t,e,s),b){case"Array":case"Object":for(p=V(e),h=0,u=x(p);h<u;h++)f=p[h],v(s,f,oe(e[f],t));break;case"Map":e.forEach((function(e,n){U(s,oe(n,t),oe(e,t))}));break;case"Set":e.forEach((function(e){z(s,oe(e,t))}));break;case"Error":y(s,"message",oe(e.message,t)),g(e,"cause")&&y(s,"cause",oe(e.cause,t)),"AggregateError"===a?s.errors=oe(e.errors,t):"SuppressedError"===a&&(s.error=oe(e.error,t),s.suppressed=oe(e.suppressed,t));case"DOMException":E&&y(s,"stack",oe(e.stack,t))}return s};n({global:!0,enumerable:!0,sham:!A,forced:ee},{structuredClone:function(e){var t,n,i=b(arguments.length,1)>1&&!u(arguments[1])?f(arguments[1]):void 0,a=i?i.transfer:void 0;void 0!==a&&(n=function(e,t){if(!c(e))throw new L("Transfer option cannot be converted to a sequence");var n=[];p(e,(function(e){j(n,f(e))}));for(var i,a,s,o,u,d=0,g=x(n),v=new B;d<g;){if(i=n[d++],"ArrayBuffer"===(a=m(i))?H(v,i):N(t,i))throw new D("Duplicate transferable",Z);if("ArrayBuffer"!==a){if(A)o=$(i,{transfer:[i]});else switch(a){case"ImageBitmap":s=r.OffscreenCanvas,h(s)||ie(a,J);try{(u=new s(i.width,i.height)).getContext("bitmaprenderer").transferFromImageBitmap(i),o=u.transferToImageBitmap()}catch(e){}break;case"AudioData":case"VideoFrame":(!l(i.clone)||!l(i.close))&&ie(a,J);try{o=i.clone(),i.close()}catch(e){}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":ie(a,J)}if(void 0===o)throw new D("This object cannot be transferred: "+a,Z);U(t,i,o)}else z(v,i)}return v}(a,t=new k));var s=oe(e,t);return n&&function(e){M(e,(function(e){A?ne(e,{transfer:[e]}):l(e.transfer)?e.transfer():T?T(e):ie("ArrayBuffer",J)}))}(n),s}})})),Yre=Z((()=>{"use strict";var e=Je(),t=rn(),n=TT()(t.setInterval,!0);e({global:!0,bind:!0,forced:t.setInterval!==n},{setInterval:n})})),Kre=Z((()=>{"use strict";var e=Je(),t=rn(),n=TT()(t.setTimeout,!0);e({global:!0,bind:!0,forced:t.setTimeout!==n},{setTimeout:n})})),Jre=Z((()=>{"use strict";Yre(),Kre()})),LT=Z(((e,t)=>{"use strict";var n=kt(),r=rr(),i=An(),a=ci(),s=r("iterator");t.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),n.delete("b",void 0),a&&(!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b"))||!t.size&&(a||!i)||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}))})),cie=Z(((e,t)=>{"use strict";var n=Ut(),r=2147483647,i=/[^\0-\u007E]/,a=/[.\u3002\uFF0E\uFF61]/g,s="Overflow: input needs wider integers to process",o=RangeError,l=n(a.exec),h=Math.floor,u=String.fromCharCode,c=n("".charCodeAt),d=n([].join),p=n([].push),f=n("".replace),m=n("".split),g=n("".toLowerCase),v=function(e){return e+22+75*(e<26)},y=function(e,t,n){var r=0;for(e=n?h(e/700):e>>1,e+=h(e/t);e>455;)e=h(e/35),r+=36;return h(r+36*e/(e+38))},x=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=c(e,n++);if(i>=55296&&i<=56319&&n<r){var a=c(e,n++);56320==(64512&a)?p(t,((1023&i)<<10)+(1023&a)+65536):(p(t,i),n--)}else p(t,i)}return t}(e);var n,i,a=e.length,l=128,f=0,m=72;for(n=0;n<e.length;n++)(i=e[n])<128&&p(t,u(i));var g=t.length,x=g;for(g&&p(t,"-");x<a;){var b=r;for(n=0;n<e.length;n++)(i=e[n])>=l&&i<b&&(b=i);var _=x+1;if(b-l>h((r-f)/_))throw new o(s);for(f+=(b-l)*_,l=b,n=0;n<e.length;n++){if((i=e[n])<l&&++f>r)throw new o(s);if(i===l){for(var w=f,S=36;;){var M=S<=m?1:S>=m+26?26:S-m;if(w<M)break;var T=w-M,E=36-M;p(t,u(v(M+T%E))),w=h(T/E),S+=36}p(t,u(v(w))),m=y(f,_,x===g),f=0,x++}}f++,l++}return d(t,"")};t.exports=function(e){var t,n,r=[],s=m(f(g(e),a,"."),".");for(t=0;t<s.length;t++)n=s[t],p(r,l(i,n)?"xn--"+x(n):n);return d(r,".")}})),mL=Z(((e,t)=>{"use strict";gv();var n=Je(),r=rn(),i=MI(),a=qn(),s=Ut(),o=An(),l=LT(),h=Xr(),u=Ji(),c=Op(),d=Ws(),p=XE(),f=Ii(),m=Jo(),g=lr(),v=pr(),y=uo(),x=Zo(),b=Gn(),_=Kn(),w=Fn(),S=fa(),M=La(),T=uv(),E=Rp(),A=Dp(),C=fo(),P=rr(),I=QE(),R=P("iterator"),L="URLSearchParams",O=L+"Iterator",D=f.set,k=f.getterFor(L),N=f.getterFor(O),F=i("fetch"),U=i("Request"),B=i("Headers"),z=U&&U.prototype,H=B&&B.prototype,V=r.RegExp,j=r.TypeError,G=r.decodeURIComponent,W=r.encodeURIComponent,q=s("".charAt),X=s([].join),Y=s([].push),Z=s("".replace),J=s([].shift),K=s([].splice),Q=s("".split),$=s("".slice),ee=/\+/g,te=Array(4),ne=function(e){return te[e-1]||(te[e-1]=V("((?:%[\\da-f]{2}){"+e+"})","gi"))},re=function(e){try{return G(e)}catch(t){return e}},ie=function(e){var t=Z(e,ee," "),n=4;try{return G(t)}catch(e){for(;n;)t=Z(t,ne(n--),re);return t}},ae=/[!'()~]|%20/g,se={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},oe=function(e){return se[e]},le=function(e){return Z(W(e),ae,oe)},he=p((function(e,t){D(this,{type:O,target:k(e).entries,index:0,kind:t})}),L,(function(){var e=N(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=void 0,A(void 0,!0);var r=t[n];switch(e.kind){case"keys":return A(r.key,!1);case"values":return A(r.value,!1)}return A([r.key,r.value],!1)}),!0),ue=function(e){this.entries=[],this.url=null,void 0!==e&&(_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===q(e,0)?$(e,1):e:w(e)))};ue.prototype={type:L,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,s,o,l,h=this.entries,u=E(e);if(u)for(n=(t=T(e,u)).next;!(r=a(n,t)).done;){if(s=(i=T(b(r.value))).next,(o=a(s,i)).done||(l=a(s,i)).done||!a(s,i).done)throw new j("Expected sequence with length 2");Y(h,{key:w(o.value),value:w(l.value)})}else for(var c in e)v(e,c)&&Y(h,{key:c,value:w(e[c])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,i=Q(e,"&"),a=0;a<i.length;)(t=i[a++]).length&&(n=Q(t,"="),Y(r,{key:ie(J(n)),value:ie(X(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],Y(n,le(e.key)+"="+le(e.value));return X(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ce,de,pe,fe,me=function(){m(this,ge);var e=D(this,new ue(arguments.length>0?arguments[0]:void 0));o||(this.size=e.entries.length)},ge=me.prototype;c(ge,{append:function(e,t){var n=k(this);C(arguments.length,2),Y(n.entries,{key:w(e),value:w(t)}),o||this.length++,n.updateURL()},delete:function(e){for(var t=k(this),n=C(arguments.length,1),r=t.entries,i=w(e),a=n<2?void 0:arguments[1],s=void 0===a?a:w(a),l=0;l<r.length;){var h=r[l];if(h.key!==i||void 0!==s&&h.value!==s)l++;else if(K(r,l,1),void 0!==s)break}o||(this.size=r.length),t.updateURL()},get:function(e){var t=k(this).entries;C(arguments.length,1);for(var n=w(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=k(this).entries;C(arguments.length,1);for(var n=w(e),r=[],i=0;i<t.length;i++)t[i].key===n&&Y(r,t[i].value);return r},has:function(e){for(var t=k(this).entries,n=C(arguments.length,1),r=w(e),i=n<2?void 0:arguments[1],a=void 0===i?i:w(i),s=0;s<t.length;){var o=t[s++];if(o.key===r&&(void 0===a||o.value===a))return!0}return!1},set:function(e,t){var n=k(this);C(arguments.length,1);for(var r,i=n.entries,a=!1,s=w(e),l=w(t),h=0;h<i.length;h++)(r=i[h]).key===s&&(a?K(i,h--,1):(a=!0,r.value=l));a||Y(i,{key:s,value:l}),o||(this.size=i.length),n.updateURL()},sort:function(){var e=k(this);I(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=k(this).entries,r=y(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new he(this,"keys")},values:function(){return new he(this,"values")},entries:function(){return new he(this,"entries")}},{enumerable:!0}),h(ge,R,ge.entries,{name:"entries"}),h(ge,"toString",(function(){return k(this).serialize()}),{enumerable:!0}),o&&u(ge,"size",{get:function(){return k(this).entries.length},configurable:!0,enumerable:!0}),d(me,L),n({global:!0,constructor:!0,forced:!l},{URLSearchParams:me}),!l&&g(B)&&(ce=s(H.has),de=s(H.set),pe=function(e){if(_(e)){var t,n=e.body;if(x(n)===L)return t=e.headers?new B(e.headers):new B,ce(t,"content-type")||de(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),S(e,{body:M(0,w(n)),headers:M(0,t)})}return e},g(F)&&n({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return F(e,arguments.length>1?pe(arguments[1]):{})}}),g(U)&&(fe=function(e){return m(this,z),new U(e,arguments.length>1?pe(arguments[1]):{})},z.constructor=fe,fe.prototype=z,n({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:fe}))),t.exports={URLSearchParams:me,getState:k}})),Yie=Z((()=>{"use strict";pD();var e,t=Je(),n=An(),r=LT(),i=rn(),a=uo(),s=Ut(),o=Xr(),l=Ji(),h=Jo(),u=pr(),c=cI(),d=X2(),p=ka(),f=Wv().codeAt,m=cie(),g=Fn(),v=Ws(),y=fo(),x=mL(),b=Ii(),_=b.set,w=b.getterFor("URL"),S=x.URLSearchParams,M=x.getState,T=i.URL,E=i.TypeError,A=i.parseInt,C=Math.floor,P=Math.pow,I=s("".charAt),R=s(/./.exec),L=s([].join),O=s(1..toString),D=s([].pop),k=s([].push),N=s("".replace),F=s([].shift),U=s("".split),B=s("".slice),z=s("".toLowerCase),H=s([].unshift),V="Invalid scheme",j="Invalid host",G="Invalid port",W=/[a-z]/i,q=/[\d+-.a-z]/i,X=/\d/,Y=/^0x/i,Z=/^[0-7]+$/,J=/^\d+$/,K=/^[\da-f]+$/i,Q=/[\0\t\n\r #%/:<>?@[\\\]^|]/,$=/[\0\t\n\r #/:<>?@[\\\]^|]/,ee=/^[\u0000-\u0020]+/,te=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ne=/[\t\n\r]/g,re=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)H(t,e%256),e=C(e/256);return L(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=O(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},ie={},ae=c({},ie,{" ":1,'"':1,"<":1,">":1,"`":1}),se=c({},ae,{"#":1,"?":1,"{":1,"}":1}),oe=c({},se,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),le=function(e,t){var n=f(e,0);return n>32&&n<127&&!u(t,e)?e:encodeURIComponent(e)},he={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ue=function(e,t){var n;return 2===e.length&&R(W,I(e,0))&&(":"===(n=I(e,1))||!t&&"|"===n)},ce=function(e){var t;return e.length>1&&ue(B(e,0,2))&&(2===e.length||"/"===(t=I(e,2))||"\\"===t||"?"===t||"#"===t)},de=function(e){return"."===e||"%2e"===z(e)},pe=function(e){return".."===(e=z(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e},fe={},me={},ge={},ve={},ye={},xe={},be={},_e={},we={},Se={},Me={},Te={},Ee={},Ae={},Ce={},Pe={},Ie={},Re={},Le={},Oe={},De={},ke=function(e,t,n){var r,i,a,s=g(e);if(t){if(i=this.parse(s))throw new E(i);this.searchParams=null}else{if(void 0!==n&&(r=new ke(n,!0)),i=this.parse(s,null,r))throw new E(i);(a=M(new S)).bindURL(this),this.searchParams=a}};ke.prototype={type:"URL",parse:function(t,n,r){var i,a,s,o,l=this,h=n||fe,c=0,f="",m=!1,v=!1,y=!1;for(t=g(t),n||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,t=N(t,ee,""),t=N(t,te,"$1")),t=N(t,ne,""),i=d(t);c<=i.length;){switch(a=i[c],h){case fe:if(!a||!R(W,a)){if(n)return V;h=ge;continue}f+=z(a),h=me;break;case me:if(a&&(R(q,a)||"+"===a||"-"===a||"."===a))f+=z(a);else{if(":"!==a){if(n)return V;f="",h=ge,c=0;continue}if(n&&(l.isSpecial()!==u(he,f)||"file"===f&&(l.includesCredentials()||null!==l.port)||"file"===l.scheme&&!l.host))return;if(l.scheme=f,n)return void(l.isSpecial()&&he[l.scheme]===l.port&&(l.port=null));f="","file"===l.scheme?h=Ae:l.isSpecial()&&r&&r.scheme===l.scheme?h=ve:l.isSpecial()?h=_e:"/"===i[c+1]?(h=ye,c++):(l.cannotBeABaseURL=!0,k(l.path,""),h=Le)}break;case ge:if(!r||r.cannotBeABaseURL&&"#"!==a)return V;if(r.cannotBeABaseURL&&"#"===a){l.scheme=r.scheme,l.path=p(r.path),l.query=r.query,l.fragment="",l.cannotBeABaseURL=!0,h=De;break}h="file"===r.scheme?Ae:xe;continue;case ve:if("/"!==a||"/"!==i[c+1]){h=xe;continue}h=we,c++;break;case ye:if("/"===a){h=Se;break}h=Re;continue;case xe:if(l.scheme=r.scheme,a===e)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=p(r.path),l.query=r.query;else if("/"===a||"\\"===a&&l.isSpecial())h=be;else if("?"===a)l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=p(r.path),l.query="",h=Oe;else{if("#"!==a){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=p(r.path),l.path.length--,h=Re;continue}l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,l.path=p(r.path),l.query=r.query,l.fragment="",h=De}break;case be:if(!l.isSpecial()||"/"!==a&&"\\"!==a){if("/"!==a){l.username=r.username,l.password=r.password,l.host=r.host,l.port=r.port,h=Re;continue}h=Se}else h=we;break;case _e:if(h=we,"/"!==a||"/"!==I(f,c+1))continue;c++;break;case we:if("/"!==a&&"\\"!==a){h=Se;continue}break;case Se:if("@"===a){m&&(f="%40"+f),m=!0,s=d(f);for(var x=0;x<s.length;x++){var b=s[x];if(":"!==b||y){var _=le(b,oe);y?l.password+=_:l.username+=_}else y=!0}f=""}else if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()){if(m&&""===f)return"Invalid authority";c-=d(f).length+1,f="",h=Me}else f+=a;break;case Me:case Te:if(n&&"file"===l.scheme){h=Pe;continue}if(":"!==a||v){if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()){if(l.isSpecial()&&""===f)return j;if(n&&""===f&&(l.includesCredentials()||null!==l.port))return;if(o=l.parseHost(f))return o;if(f="",h=Ie,n)return;continue}"["===a?v=!0:"]"===a&&(v=!1),f+=a}else{if(""===f)return j;if(o=l.parseHost(f))return o;if(f="",h=Ee,n===Te)return}break;case Ee:if(!R(X,a)){if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()||n){if(""!==f){var w=A(f,10);if(w>65535)return G;l.port=l.isSpecial()&&w===he[l.scheme]?null:w,f=""}if(n)return;h=Ie;continue}return G}f+=a;break;case Ae:if(l.scheme="file","/"===a||"\\"===a)h=Ce;else{if(!r||"file"!==r.scheme){h=Re;continue}switch(a){case e:l.host=r.host,l.path=p(r.path),l.query=r.query;break;case"?":l.host=r.host,l.path=p(r.path),l.query="",h=Oe;break;case"#":l.host=r.host,l.path=p(r.path),l.query=r.query,l.fragment="",h=De;break;default:ce(L(p(i,c),""))||(l.host=r.host,l.path=p(r.path),l.shortenPath()),h=Re;continue}}break;case Ce:if("/"===a||"\\"===a){h=Pe;break}r&&"file"===r.scheme&&!ce(L(p(i,c),""))&&(ue(r.path[0],!0)?k(l.path,r.path[0]):l.host=r.host),h=Re;continue;case Pe:if(a===e||"/"===a||"\\"===a||"?"===a||"#"===a){if(!n&&ue(f))h=Re;else if(""===f){if(l.host="",n)return;h=Ie}else{if(o=l.parseHost(f))return o;if("localhost"===l.host&&(l.host=""),n)return;f="",h=Ie}continue}f+=a;break;case Ie:if(l.isSpecial()){if(h=Re,"/"!==a&&"\\"!==a)continue}else if(n||"?"!==a)if(n||"#"!==a){if(a!==e&&(h=Re,"/"!==a))continue}else l.fragment="",h=De;else l.query="",h=Oe;break;case Re:if(a===e||"/"===a||"\\"===a&&l.isSpecial()||!n&&("?"===a||"#"===a)){if(pe(f)?(l.shortenPath(),"/"!==a&&!("\\"===a&&l.isSpecial())&&k(l.path,"")):de(f)?"/"!==a&&!("\\"===a&&l.isSpecial())&&k(l.path,""):("file"===l.scheme&&!l.path.length&&ue(f)&&(l.host&&(l.host=""),f=I(f,0)+":"),k(l.path,f)),f="","file"===l.scheme&&(a===e||"?"===a||"#"===a))for(;l.path.length>1&&""===l.path[0];)F(l.path);"?"===a?(l.query="",h=Oe):"#"===a&&(l.fragment="",h=De)}else f+=le(a,se);break;case Le:"?"===a?(l.query="",h=Oe):"#"===a?(l.fragment="",h=De):a!==e&&(l.path[0]+=le(a,ie));break;case Oe:n||"#"!==a?a!==e&&("'"===a&&l.isSpecial()?l.query+="%27":l.query+="#"===a?"%23":le(a,ie)):(l.fragment="",h=De);break;case De:a!==e&&(l.fragment+=le(a,ae))}c++}},parseHost:function(e){var t,n,r;if("["===I(e,0)){if("]"!==I(e,e.length-1)||(t=function(e){var t,n,r,i,a,s,o,l=[0,0,0,0,0,0,0,0],h=0,u=null,c=0,d=function(){return I(e,c)};if(":"===d()){if(":"!==I(e,1))return;c+=2,u=++h}for(;d();){if(8===h)return;if(":"!==d()){for(t=n=0;n<4&&R(K,d());)t=16*t+A(d(),16),c++,n++;if("."===d()){if(0===n||(c-=n,h>6))return;for(r=0;d();){if(i=null,r>0){if(!("."===d()&&r<4))return;c++}if(!R(X,d()))return;for(;R(X,d());){if(a=A(d(),10),null===i)i=a;else{if(0===i)return;i=10*i+a}if(i>255)return;c++}l[h]=256*l[h]+i,(2==++r||4===r)&&h++}if(4!==r)return;break}if(":"===d()){if(c++,!d())return}else if(d())return;l[h++]=t}else{if(null!==u)return;c++,u=++h}}if(null!==u)for(s=h-u,h=7;0!==h&&s>0;)o=l[h],l[h--]=l[u+s-1],l[u+--s]=o;else if(8!==h)return;return l}(B(e,1,-1)),!t))return j;this.host=t}else if(this.isSpecial()){if(e=m(e),R(Q,e)||(t=function(e){var t,n,r,i,a,s,o,l=U(e,".");if(l.length&&""===l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(n=[],r=0;r<t;r++){if(""===(i=l[r]))return e;if(a=10,i.length>1&&"0"===I(i,0)&&(a=R(Y,i)?16:8,i=B(i,8===a?1:2)),""===i)s=0;else{if(!R(10===a?J:8===a?Z:K,i))return e;s=A(i,a)}k(n,s)}for(r=0;r<t;r++)if(s=n[r],r===t-1){if(s>=P(256,5-t))return null}else if(s>255)return null;for(o=D(n),r=0;r<n.length;r++)o+=n[r]*P(256,3-r);return o}(e),null===t))return j;this.host=t}else{if(R($,e))return j;for(t="",n=d(e),r=0;r<n.length;r++)t+=le(n[r],ie);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return u(he,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;t&&("file"!==this.scheme||1!==t||!ue(e[0],!0))&&e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,s=e.path,o=e.query,l=e.fragment,h=t+":";return null!==i?(h+="//",e.includesCredentials()&&(h+=n+(r?":"+r:"")+"@"),h+=re(i),null!==a&&(h+=":"+a)):"file"===t&&(h+="//"),h+=e.cannotBeABaseURL?s[0]:s.length?"/"+L(s,"/"):"",null!==o&&(h+="?"+o),null!==l&&(h+="#"+l),h},setHref:function(e){var t=this.parse(e);if(t)throw new E(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Ue(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+re(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(g(e)+":",fe)},getUsername:function(){return this.username},setUsername:function(e){var t=d(g(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=le(t[n],oe)}},getPassword:function(){return this.password},setPassword:function(e){var t=d(g(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=le(t[n],oe)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?re(e):re(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Me)},getHostname:function(){var e=this.host;return null===e?"":re(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Te)},getPort:function(){var e=this.port;return null===e?"":g(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=g(e))?this.port=null:this.parse(e,Ee))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+L(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ie))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=g(e))?this.query=null:("?"===I(e,0)&&(e=B(e,1)),this.query="",this.parse(e,Oe)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=g(e))?("#"===I(e,0)&&(e=B(e,1)),this.fragment="",this.parse(e,De)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ne,Fe,Ue=function(e){var t=h(this,Be),r=y(arguments.length,1)>1?arguments[1]:void 0,i=_(t,new ke(e,!1,r));n||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Be=Ue.prototype,ze=function(e,t){return{get:function(){return w(this)[e]()},set:t&&function(e){return w(this)[t](e)},configurable:!0,enumerable:!0}};n&&(l(Be,"href",ze("serialize","setHref")),l(Be,"origin",ze("getOrigin")),l(Be,"protocol",ze("getProtocol","setProtocol")),l(Be,"username",ze("getUsername","setUsername")),l(Be,"password",ze("getPassword","setPassword")),l(Be,"host",ze("getHost","setHost")),l(Be,"hostname",ze("getHostname","setHostname")),l(Be,"port",ze("getPort","setPort")),l(Be,"pathname",ze("getPathname","setPathname")),l(Be,"search",ze("getSearch","setSearch")),l(Be,"searchParams",ze("getSearchParams")),l(Be,"hash",ze("getHash","setHash"))),o(Be,"toJSON",(function(){return w(this).serialize()}),{enumerable:!0}),o(Be,"toString",(function(){return w(this).serialize()}),{enumerable:!0}),T&&(Ne=T.createObjectURL,Fe=T.revokeObjectURL,Ne&&o(Ue,"createObjectURL",a(Ne,T)),Fe&&o(Ue,"revokeObjectURL",a(Fe,T))),v(Ue,"URL"),t({global:!0,constructor:!0,forced:!r,sham:!n},{URL:Ue})})),$ie=Z((()=>{"use strict";Yie()})),Jie=Z((()=>{"use strict";var e=Je(),t=Ur(),n=kt(),r=fo(),i=Fn(),a=LT(),s=t("URL");e({target:"URL",stat:!0,forced:!(a&&n((function(){s.canParse()})))},{canParse:function(e){var t=r(arguments.length,1),n=i(e),a=t<2||void 0===arguments[1]?void 0:i(arguments[1]);try{return!!new s(n,a)}catch(e){return!1}}})})),Qie=Z((()=>{"use strict";var e=Je(),t=qn();e({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return t(URL.prototype.toString,this)}})})),ese=Z((()=>{"use strict";mL()})),ise=Z((()=>{"use strict";var e=Xr(),t=Ut(),n=Fn(),r=fo(),i=URLSearchParams,a=i.prototype,s=t(a.append),o=t(a.delete),l=t(a.forEach),h=t([].push),u=new i("a=1&a=2&b=3");u.delete("a",1),u.delete("b",void 0),u+""!="a=2"&&e(a,"delete",(function(e){var t=arguments.length,i=t<2?void 0:arguments[1];if(t&&void 0===i)return o(this,e);var a=[];l(this,(function(e,t){h(a,{key:t,value:e})})),r(t,1);for(var u,c=n(e),d=n(i),p=0,f=0,m=!1,g=a.length;p<g;)u=a[p++],m||u.key===c?(m=!0,o(this,u.key)):f++;for(;f<g;)(u=a[f++]).key===c&&u.value===d||s(this,u.key,u.value)}),{enumerable:!0,unsafe:!0})})),lse=Z((()=>{"use strict";var e=Xr(),t=Ut(),n=Fn(),r=fo(),i=URLSearchParams,a=i.prototype,s=t(a.getAll),o=t(a.has),l=new i("a=1");(l.has("a",2)||!l.has("a",void 0))&&e(a,"has",(function(e){var t=arguments.length,i=t<2?void 0:arguments[1];if(t&&void 0===i)return o(this,e);var a=s(this,e);r(t,1);for(var l=n(i),h=0;h<a.length;)if(a[h++]===l)return!0;return!1}),{enumerable:!0,unsafe:!0})})),cse=Z((()=>{"use strict";var e=An(),t=Ut(),n=Ji(),r=URLSearchParams.prototype,i=t(r.forEach);e&&!("size"in r)&&n(r,"size",{get:function(){var e=0;return i(this,(function(){e++})),e},configurable:!0,enumerable:!0})})),hse=Z(((e,t)=>{"use strict";k7(),z7(),q7(),G7(),W7(),j7(),X7(),Y7(),$7(),Z7(),K7(),J7(),Q7(),e9(),t9(),C9(),O9(),Z9(),ez(),nz(),cz(),dz(),mz(),yz(),xz(),Ez(),Tz(),Mz(),Az(),Pz(),Iz(),Lz(),Gz(),Wz(),Xz(),Yz(),gv(),mq(),xq(),bq(),_q(),Sq(),Rq(),Iq(),Oq(),Fq(),Nq(),Qq(),nG(),rG(),sG(),cG(),uG(),hG(),fG(),dG(),mG(),jG(),iW(),dW(),mW(),gW(),yW(),EW(),_W(),DW(),OW(),BW(),zW(),GW(),ZW(),QW(),rj(),ij(),E2(),sj(),_j(),Sj(),Aj(),Pj(),Dj(),Oj(),Lj(),Nj(),Uj(),Hj(),zj(),Gj(),jj(),Xj(),Yj(),$j(),Jj(),tX(),nX(),rX(),pX(),mX(),yX(),bX(),EX(),_X(),TX(),SX(),PX(),BX(),qX(),$X(),JX(),rY(),iY(),oY(),cY(),hY(),fY(),yY(),xY(),bY(),TY(),SY(),wY(),AY(),CY(),RY(),IY(),OY(),kY(),NY(),UY(),HY(),VY(),zY(),XY(),YY(),$Y(),JY(),QY(),t$(),r$(),mZ(),gZ(),yZ(),_Z(),TZ(),SZ(),IZ(),LZ(),kZ(),UZ(),HZ(),VZ(),zZ(),qZ(),GZ(),WZ(),ZZ(),JZ(),QZ(),mK(),vK(),V_(),TK(),wK(),CK(),DK(),LK(),kK(),UK(),GK(),XK(),$K(),KK(),pD(),uJ(),bJ(),_J(),TJ(),AJ(),CJ(),LJ(),UJ(),zJ(),YJ(),KJ(),QJ(),rQ(),oQ(),fQ(),vQ(),EQ(),_Q(),TQ(),SQ(),wQ(),MQ(),AQ(),CQ(),RQ(),PQ(),IQ(),DQ(),OQ(),cee(),uee(),hee(),fee(),dee(),pee(),mee(),gee(),vee(),xee(),Eee(),Tee(),wee(),Iee(),Oee(),kee(),Nee(),Uee(),Vee(),zee(),Gee(),jee(),Kee(),Qee(),tte(),rte(),ste(),ote(),cte(),hte(),vte(),xte(),Ete(),Ate(),Pte(),kte(),Fte(),Nte(),Ute(),Hte(),Wte(),ane(),lne(),bne(),wne(),Dne(),Nne(),Zne(),rre(),sre(),gre(),vre(),xre(),Wre(),Jre(),$ie(),Jie(),Qie(),ese(),ise(),lse(),cse(),t.exports=PE()})),fse=Z(((e,t)=>{var n=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof v?t:v,s=Object.create(a.prototype),o=new I(r||[]);return i(s,"_invoke",{value:E(e,n,o)}),s}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function v(){}function y(){}function x(){}var b={};h(b,s,(function(){return this}));var _=Object.getPrototypeOf,w=_&&_(_(R([])));w&&w!==n&&r.call(w,s)&&(b=w);var S=x.prototype=v.prototype=Object.create(b);function M(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,a,s,o){var l=c(e[i],e,a);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(u).then((function(e){h.value=e,s(h)}),(function(e){return n("throw",e,s,o)}))}o(l.arg)}var a;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}})}function E(e,t,n){var r=d;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===m){if("throw"===i)throw a;return L()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=A(s,n);if(o){if(o===g)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=c(e,t,n);if("normal"===l.type){if(r=n.done?m:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=m,n.method="throw",n.arg=l.arg)}}}function A(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=c(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var s=a.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function R(e){if(e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:L}}function L(){return{value:t,done:!0}}return y.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:y,configurable:!0}),y.displayName=h(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},M(T.prototype),h(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new T(u(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},M(S),h(S,l,"Generator"),h(S,s,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=R,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return o.type="throw",o.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var l=r.call(s,"catchLoc"),h=r.call(s,"finallyLoc");if(l&&h){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}})),Ole=Z(((e,t)=>{!function(e,n){"use strict";"function"==typeof define&&define.amd?define(n):"object"==typeof t&&t.exports?t.exports=n():e.log=n()}(e,(function(){"use strict";var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,n){for(var i=0;i<r.length;i++){var a=r[i];this[a]=i<t?e:this.methodFactory(a,t,n)}this.log=this.debug}function o(e,n,r){return function(){typeof console!==t&&(s.call(this,n,r),this[e].apply(this,arguments))}}function l(r,s,l){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&("trace"===r&&n?a:void 0!==console[r]?i(console,r):void 0!==console.log?i(console,"log"):e)}(r)||o.apply(this,arguments)}function h(e,n,i){var a,o=this;n=null==n?"WARN":n;var h="loglevel";function u(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(h)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||l,o.getLevel=function(){return a},o.setLevel=function(n,i){if("string"==typeof n&&void 0!==o.levels[n.toUpperCase()]&&(n=o.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==i&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+n+";"}catch(e){}}}(n),s.call(o,n,e),typeof console===t&&n<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){n=e,u()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(n,!1),function(){if(typeof window!==t&&h){try{return void window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var c=u();null==c&&(c=n),o.setLevel(c,!1)}var u=new h,c={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=c[e];return t||(t=c[e]=new h(e,u.getLevel(),u.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=d),u},u.getLoggers=function(){return c},u.default=u,u}))})),nA=Z(((e,t)=>{"use strict";t.exports=function(e,t,r){var i=e*t,a=n*e,s=a-(a-e),o=e-s,l=n*t,h=l-(l-t),u=t-h,c=o*u-(i-s*h-o*h-s*u);return r?(r[0]=c,r[1]=i,r):[c,i]};var n=+(Math.pow(2,27)+1)})),Z5=Z(((e,t)=>{"use strict";t.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=n-r,a=t-r,s=e-i,o=s+a;return o?[o,n]:[n]}(e[0],t[0]);var i,a,s=new Array(n+r),o=0,l=0,h=0,u=Math.abs,c=e[l],d=u(c),p=t[h],f=u(p);d<f?(a=c,(l+=1)<n&&(c=e[l],d=u(c))):(a=p,(h+=1)<r&&(p=t[h],f=u(p))),l<n&&d<f||h>=r?(i=c,(l+=1)<n&&(c=e[l],d=u(c))):(i=p,(h+=1)<r&&(p=t[h],f=u(p)));for(var m,g,v=i+a,y=v-i,x=a-y,b=x,_=v;l<n&&h<r;)d<f?(i=c,(l+=1)<n&&(c=e[l],d=u(c))):(i=p,(h+=1)<r&&(p=t[h],f=u(p))),(x=(a=b)-(y=(v=i+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m;for(;l<n;)(x=(a=b)-(y=(v=(i=c)+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m,(l+=1)<n&&(c=e[l]);for(;h<r;)(x=(a=b)-(y=(v=(i=p)+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m,(h+=1)<r&&(p=t[h]);return b&&(s[o++]=b),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}})),wce=Z(((e,t)=>{"use strict";t.exports=function(e,t,n){var r=e+t,i=r-e,a=t-i,s=e-(r-i);return n?(n[0]=s+a,n[1]=r,n):[s+a,r]}})),J5=Z(((e,t)=>{"use strict";var n=nA(),r=wce();t.exports=function(e,t){var i=e.length;if(1===i){var a=n(e[0],t);return a[0]?a:[a[1]]}var s=new Array(2*i),o=[.1,.1],l=[.1,.1],h=0;n(e[0],t,o),o[0]&&(s[h++]=o[0]);for(var u=1;u<i;++u){n(e[u],t,l);var c=o[1];r(c,l[0],o),o[0]&&(s[h++]=o[0]);var d=l[1],p=o[1],f=d+p,m=p-(f-d);o[1]=f,m&&(s[h++]=m)}return o[1]&&(s[h++]=o[1]),0===h&&(s[h++]=0),s.length=h,s}})),Cce=Z(((e,t)=>{"use strict";t.exports=function(e){for(var t=e.length,n=e[e.length-1],r=t,i=t-2;i>=0;--i){var a=n;(l=(o=e[i])-((n=a+o)-a))&&(e[--r]=n,n=l)}var s=0;for(i=r;i<t;++i){var o,l;(l=(o=n)-((n=(a=e[i])+o)-a))&&(e[s++]=l)}return e[s++]=n,e.length=s,e}})),Pce=Z(((e,t)=>{"use strict";t.exports=function(e,t){var n=0|e.length,r=0|t.length;if(1===n&&1===r)return function(e,t){var n=e+t,r=n-e,i=n-r,a=t-r,s=e-i,o=s+a;return o?[o,n]:[n]}(e[0],-t[0]);var i,a,s=new Array(n+r),o=0,l=0,h=0,u=Math.abs,c=e[l],d=u(c),p=-t[h],f=u(p);d<f?(a=c,(l+=1)<n&&(c=e[l],d=u(c))):(a=p,(h+=1)<r&&(p=-t[h],f=u(p))),l<n&&d<f||h>=r?(i=c,(l+=1)<n&&(c=e[l],d=u(c))):(i=p,(h+=1)<r&&(p=-t[h],f=u(p)));for(var m,g,v=i+a,y=v-i,x=a-y,b=x,_=v;l<n&&h<r;)d<f?(i=c,(l+=1)<n&&(c=e[l],d=u(c))):(i=p,(h+=1)<r&&(p=-t[h],f=u(p))),(x=(a=b)-(y=(v=i+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m;for(;l<n;)(x=(a=b)-(y=(v=(i=c)+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m,(l+=1)<n&&(c=e[l]);for(;h<r;)(x=(a=b)-(y=(v=(i=p)+a)-i))&&(s[o++]=x),b=_-((m=_+v)-(g=m-_))+(v-g),_=m,(h+=1)<r&&(p=-t[h]);return b&&(s[o++]=b),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}})),Dce=Z(((e,t)=>{"use strict";var n=nA(),r=Z5(),i=J5(),a=Pce();function s(e,t,n,r){return function(n,i,a){var s=e(e(t(i[1],a[0]),t(-a[1],i[0])),e(t(n[1],i[0]),t(-i[1],n[0]))),o=e(t(n[1],a[0]),t(-a[1],n[0])),l=r(s,o);return l[l.length-1]}}function o(e,t,n,r){return function(i,a,s,o){var l=e(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(n(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),e(n(e(t(a[1],o[0]),t(-o[1],a[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),o[2])))),h=e(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),o[2]))),e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2])))),u=r(l,h);return u[u.length-1]}}function l(e,t,n,r){return function(i,a,s,o,l){var h=e(e(e(n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),s[2]),e(n(e(t(s[1],l[0]),t(-l[1],s[0])),-o[2]),n(e(t(s[1],o[0]),t(-o[1],s[0])),l[2]))),a[3]),e(n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),a[2]),e(n(e(t(a[1],l[0]),t(-l[1],a[0])),-o[2]),n(e(t(a[1],o[0]),t(-o[1],a[0])),l[2]))),-s[3]),n(e(n(e(t(s[1],l[0]),t(-l[1],s[0])),a[2]),e(n(e(t(a[1],l[0]),t(-l[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),l[2]))),o[3]))),e(n(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(n(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),-l[3]),e(n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),a[2]),e(n(e(t(a[1],l[0]),t(-l[1],a[0])),-o[2]),n(e(t(a[1],o[0]),t(-o[1],a[0])),l[2]))),i[3]),n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),l[2]))),-a[3])))),e(e(n(e(n(e(t(a[1],l[0]),t(-l[1],a[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),l[2]))),o[3]),e(n(e(n(e(t(a[1],o[0]),t(-o[1],a[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),o[2]))),-l[3]),n(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(n(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),i[3]))),e(n(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),o[2]))),-a[3]),e(n(e(n(e(t(a[1],o[0]),t(-o[1],a[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),o[2]))),s[3]),n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2]))),-o[3]))))),u=e(e(e(n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),s[2]),e(n(e(t(s[1],l[0]),t(-l[1],s[0])),-o[2]),n(e(t(s[1],o[0]),t(-o[1],s[0])),l[2]))),i[3]),n(e(n(e(t(o[1],l[0]),t(-l[1],o[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-o[2]),n(e(t(i[1],o[0]),t(-o[1],i[0])),l[2]))),-s[3])),e(n(e(n(e(t(s[1],l[0]),t(-l[1],s[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),l[2]))),o[3]),n(e(n(e(t(s[1],o[0]),t(-o[1],s[0])),i[2]),e(n(e(t(i[1],o[0]),t(-o[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),o[2]))),-l[3]))),e(e(n(e(n(e(t(s[1],l[0]),t(-l[1],s[0])),a[2]),e(n(e(t(a[1],l[0]),t(-l[1],a[0])),-s[2]),n(e(t(a[1],s[0]),t(-s[1],a[0])),l[2]))),i[3]),n(e(n(e(t(s[1],l[0]),t(-l[1],s[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-s[2]),n(e(t(i[1],s[0]),t(-s[1],i[0])),l[2]))),-a[3])),e(n(e(n(e(t(a[1],l[0]),t(-l[1],a[0])),i[2]),e(n(e(t(i[1],l[0]),t(-l[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),l[2]))),s[3]),n(e(n(e(t(a[1],s[0]),t(-s[1],a[0])),i[2]),e(n(e(t(i[1],s[0]),t(-s[1],i[0])),-a[2]),n(e(t(i[1],a[0]),t(-a[1],i[0])),s[2]))),-l[3])))),c=r(h,u);return c[c.length-1]}}function h(e){return(3===e?s:4===e?o:l)(r,n,i,a)}var u=h(3),c=h(4),d=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,n){var r,i=(e[1]-n[1])*(t[0]-n[0]),a=(e[0]-n[0])*(t[1]-n[1]),s=i-a;if(i>0){if(a<=0)return s;r=i+a}else{if(!(i<0))return s;if(a>=0)return s;r=-(i+a)}var o=33306690738754716e-32*r;return s>=o||s<=-o?s:u(e,t,n)},function(e,t,n,r){var i=e[0]-r[0],a=t[0]-r[0],s=n[0]-r[0],o=e[1]-r[1],l=t[1]-r[1],h=n[1]-r[1],u=e[2]-r[2],d=t[2]-r[2],p=n[2]-r[2],f=a*h,m=s*l,g=s*o,v=i*h,y=i*l,x=a*o,b=u*(f-m)+d*(g-v)+p*(y-x),_=7771561172376103e-31*((Math.abs(f)+Math.abs(m))*Math.abs(u)+(Math.abs(g)+Math.abs(v))*Math.abs(d)+(Math.abs(y)+Math.abs(x))*Math.abs(p));return b>_||-b>_?b:c(e,t,n,r)}];function p(e){var t=d[e.length];return t||(t=d[e.length]=h(e.length)),t.apply(void 0,e)}function f(e,t,n,r,i,a,s){return function(t,n,o,l,h){switch(arguments.length){case 0:case 1:return 0;case 2:return r(t,n);case 3:return i(t,n,o);case 4:return a(t,n,o,l);case 5:return s(t,n,o,l,h)}for(var u=new Array(arguments.length),c=0;c<arguments.length;++c)u[c]=arguments[c];return e(u)}}!function(){for(;d.length<=5;)d.push(h(d.length));t.exports=f.apply(void 0,[p].concat(d));for(var e=0;e<=5;++e)t.exports[e]=d[e]}()})),Lce=Z(((e,t)=>{"use strict";t.exports=function(e,t,r,i){var a=n(e,r,i),s=n(t,r,i);if(a>0&&s>0||a<0&&s<0)return!1;var o=n(r,e,t),l=n(i,e,t);return!(o>0&&l>0||o<0&&l<0)&&(0!==a||0!==s||0!==o||0!==l||function(e,t,n,r){for(var i=0;i<2;++i){var a=e[i],s=t[i],o=Math.min(a,s),l=Math.max(a,s),h=n[i],u=r[i],c=Math.min(h,u);if(Math.max(h,u)<o||l<c)return!1}return!0}(e,t,r,i))};var n=Dce()[3]})),Fce=Z(((e,t)=>{"use strict";t.exports=function(e,t,o,l){if(!s(e,t,o,l))return[[0],[0],[0]];var h=r([o[1]],[-l[1]]),u=r([-o[0]],[l[0]]),c=r(r(i(u,e[1]),i(u,-t[1])),r(i(h,e[0]),i(h,-t[0]))),d=r(n(-e[0],t[1]),n(e[1],t[0])),p=r(n(-o[0],l[1]),n(o[1],l[0])),f=r(r(i(p,e[0]),i(p,-t[0])),r(i(d,-o[0]),i(d,l[0]))),m=r(r(i(p,e[1]),i(p,-t[1])),r(i(d,-o[1]),i(d,l[1])));return[a(f),a(m),a(c)]};var n=nA(),r=Z5(),i=J5(),a=Cce(),s=Lce()})),Bce=Z(((e,t)=>{t.exports=function(e){var t=0,n=e.length;switch(n){case 1:t=e[0];break;case 2:t=e[0]+e[1];break;case 3:t=e[0]+e[1]+e[2];break;case 4:t=e[0]+e[1]+e[2]+e[3];break;default:for(var r=0;r<n;r++)t+=e[r]}return t}})),Hce=Z(((e,t)=>{var n=Fce(),r=Bce();function i(e,t){return e[0]===t[0]&&e[1]===t[1]}t.exports=function(e,t){for(var u={},c=e.length,d=[],p=0;p<c;p++){var f=e[p],m=e[(p+1)%c];h(f,o),h(m,l);for(var g=0;g<c;g++)if(p!==g){var v=e[g],y=e[(g+1)%c];if(h(v,a),h(y,s),!(i(a,o)||i(a,l)||i(s,o)||i(s,l))){var x=n(o,l,a,s),b=x[2];if(1!==b.length||b[0]){var _=r(x[2]);if(x[0]=r(x[0])/_,x[1]=r(x[1])/_,x.pop(),!(i(x,o)||i(x,l)||i(x,a)||i(x,s))){var w=x+"",S=!u[w];S&&(u[w]=!0);var M=S;t&&(M=t(x,p,f,m,g,v,y,S)),M&&d.push(x)}}}}}return d};var a=[0,0],s=[0,0],o=[0,0],l=[0,0];function h(e,t){Array.isArray(e)?(t[0]=e[0],t[1]=e[1]):(t[0]=e.x,t[1]=e.y)}})),OA=Z((()=>{})),xfe=Z(((e,t)=>{var n,r;n=e,r=function(){"use strict";var e=Math.imul,t=Math.clz32;function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function o(){return(o=s()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){function n(){return o(e,arguments,i(this).constructor)}if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,e)},l(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){var t=s();return function(){var n,r=i(e);if(t){var a=i(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,n)}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],s=!0,o=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(o)throw i}}return a}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var f=function(e){var t=Math.abs,i=Math.max,s=Math.floor;function o(e,t){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=l.call(this,e)).sign=t,Object.setPrototypeOf(h(n),o.prototype),e>o.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return n}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(o,e);var l=u(o);return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1})}(o,[{key:"toDebugString",value:function(){var e,t=["BigInt["],n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}(this);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push((r&&(r>>>0).toString(16))+", ")}}catch(e){n.e(e)}finally{n.f()}return t.push("]"),t.join("")}},{key:"toString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":e&e-1?o.__toStringGeneric(this,e,!1):o.__toStringBasePowerOfTwo(this,e)}},{key:"valueOf",value:function(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}},{key:"__copy",value:function(){for(var e=new o(this.length,this.sign),t=0;t<this.length;t++)e[t]=this[t];return e}},{key:"__trim",value:function(){for(var e=this.length,t=this[e-1];0===t;)t=this[--e-1],this.pop();return 0===e&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var e=0;e<this.length;e++)this[e]=0}},{key:"__clzmsd",value:function(){return o.__clz30(this.__digit(this.length-1))}},{key:"__inplaceMultiplyAdd",value:function(e,t,n){n>this.length&&(n=this.length);for(var r=32767&e,i=e>>>15,a=0,s=t,l=0;l<n;l++){var h=this.__digit(l),u=32767&h,c=h>>>15,d=o.__imul(u,r),p=o.__imul(u,i),f=o.__imul(c,r),m=s+d+a;a=m>>>30,m&=1073741823,a+=(m+=((32767&p)<<15)+((32767&f)<<15))>>>30,s=o.__imul(c,i)+(p>>>15)+(f>>>15),this.__setDigit(l,1073741823&m)}if(0!==a||0!==s)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(e,t,n){for(var r,i=0,a=0;a<n;a++)i=(r=this.__halfDigit(t+a)+e.__halfDigit(a)+i)>>>15,this.__setHalfDigit(t+a,32767&r);return i}},{key:"__inplaceSub",value:function(e,t,n){var r=0;if(1&t){t>>=1;for(var i=this.__digit(t),a=32767&i,s=0;s<n-1>>>1;s++){var o=e.__digit(s),l=(i>>>15)-(32767&o)-r;r=1&l>>>15,this.__setDigit(t+s,(32767&l)<<15|32767&a),r=1&(a=(32767&(i=this.__digit(t+s+1)))-(o>>>15)-r)>>>15}var h=e.__digit(s),u=(i>>>15)-(32767&h)-r;if(r=1&u>>>15,this.__setDigit(t+s,(32767&u)<<15|32767&a),t+s+1>=this.length)throw new RangeError("out of bounds");!(1&n)&&(r=1&(a=(32767&(i=this.__digit(t+s+1)))-(h>>>15)-r)>>>15,this.__setDigit(t+e.length,1073709056&i|32767&a))}else{t>>=1;for(var c=0;c<e.length-1;c++){var d=this.__digit(t+c),p=e.__digit(c),f=(32767&d)-(32767&p)-r,m=(d>>>15)-(p>>>15)-(r=1&f>>>15);r=1&m>>>15,this.__setDigit(t+c,(32767&m)<<15|32767&f)}var g=this.__digit(t+c),v=e.__digit(c),y=(32767&g)-(32767&v)-r;r=1&y>>>15;var x=0;!(1&n)&&(r=1&(x=(g>>>15)-(v>>>15)-r)>>>15),this.__setDigit(t+c,(32767&x)<<15|32767&y)}return r}},{key:"__inplaceRightShift",value:function(e){if(0!==e){for(var t,n=this.__digit(0)>>>e,r=this.length-1,i=0;i<r;i++)t=this.__digit(i+1),this.__setDigit(i,1073741823&t<<30-e|n),n=t>>>e;this.__setDigit(r,n)}}},{key:"__digit",value:function(e){return this[e]}},{key:"__unsignedDigit",value:function(e){return this[e]>>>0}},{key:"__setDigit",value:function(e,t){this[e]=0|t}},{key:"__setDigitGrow",value:function(e,t){this[e]=0|t}},{key:"__halfDigitLength",value:function(){var e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}},{key:"__halfDigit",value:function(e){return 32767&this[e>>>1]>>>15*(1&e)}},{key:"__setHalfDigit",value:function(e,t){var n=e>>>1,r=this.__digit(n),i=1&e?32767&r|t<<15:1073709056&r|32767&t;this.__setDigit(n,i)}}],[{key:"BigInt",value:function(e){var t=Number.isFinite;if("number"==typeof e){if(0===e)return o.__zero();if(o.__isOneDigitInt(e))return 0>e?o.__oneDigit(-e,!0):o.__oneDigit(e,!1);if(!t(e)||s(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return o.__fromDouble(e)}if("string"==typeof e){var r=o.__fromString(e);if(null===r)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return r}if("boolean"==typeof e)return!0===e?o.__oneDigit(1,!1):o.__zero();if("object"===n(e)){if(e.constructor===o)return e;var i=o.__toPrimitive(e);return o.BigInt(i)}throw new TypeError("Cannot convert "+e+" to a BigInt")}},{key:"toNumber",value:function(e){var t=e.length;if(0===t)return 0;if(1===t){var n=e.__unsignedDigit(0);return e.sign?-n:n}var r=e.__digit(t-1),i=o.__clz30(r),a=30*t-i;if(1024<a)return e.sign?-1/0:1/0;var s=a-1,l=r,h=t-1,u=i+3,c=32===u?0:l<<u;c>>>=12;var d=u-12,p=12<=u?0:l<<20+u,f=20+u;for(0<d&&0<h&&(h--,c|=(l=e.__digit(h))>>>30-d,p=l<<d+2,f=d+2);0<f&&0<h;)h--,l=e.__digit(h),p|=30<=f?l<<f-30:l>>>30-f,f-=30;var m=o.__decideRounding(e,f,h,l);if((1===m||0===m&&1==(1&p))&&0==(p=p+1>>>0)&&++c>>>20!=0&&(c=0,1023<++s))return e.sign?-1/0:1/0;var g=e.sign?-2147483648:0;return s=s+1023<<20,o.__kBitConversionInts[1]=g|s|c,o.__kBitConversionInts[0]=p,o.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(e){if(0===e.length)return e;var t=e.__copy();return t.sign=!e.sign,t}},{key:"bitwiseNot",value:function(e){return e.sign?o.__absoluteSubOne(e).__trim():o.__absoluteAddOne(e,!0)}},{key:"exponentiate",value:function(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(0===t.length)return o.__oneDigit(1,!1);if(0===e.length)return e;if(1===e.length&&1===e.__digit(0))return!e.sign||1&t.__digit(0)?e:o.unaryMinus(e);if(1<t.length)throw new RangeError("BigInt too big");var n=t.__unsignedDigit(0);if(1===n)return e;if(n>=o.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===e.length&&2===e.__digit(0)){var r=1+(0|n/30),i=new o(r,e.sign&&0!=(1&n));i.__initializeDigits();var a=1<<n%30;return i.__setDigit(r-1,a),i}var s=null,l=e;for(1&n&&(s=e),n>>=1;0!==n;n>>=1)l=o.multiply(l,l),1&n&&(s=null===s?l:o.multiply(s,l));return s}},{key:"multiply",value:function(e,t){if(0===e.length)return e;if(0===t.length)return t;var n=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&n--;var r=new o(n,e.sign!==t.sign);r.__initializeDigits();for(var i=0;i<e.length;i++)o.__multiplyAccumulate(t,e.__digit(i),r,i);return r.__trim()}},{key:"divide",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>o.__absoluteCompare(e,t))return o.__zero();var n,r=e.sign!==t.sign,i=t.__unsignedDigit(0);if(1===t.length&&32767>=i){if(1===i)return r===e.sign?e:o.unaryMinus(e);n=o.__absoluteDivSmall(e,i,null)}else n=o.__absoluteDivLarge(e,t,!0,!1);return n.sign=r,n.__trim()}},{key:"remainder",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>o.__absoluteCompare(e,t))return e;var n=t.__unsignedDigit(0);if(1===t.length&&32767>=n){if(1===n)return o.__zero();var r=o.__absoluteModSmall(e,n);return 0===r?o.__zero():o.__oneDigit(r,e.sign)}var i=o.__absoluteDivLarge(e,t,!1,!0);return i.sign=e.sign,i.__trim()}},{key:"add",value:function(e,t){var n=e.sign;return n===t.sign?o.__absoluteAdd(e,t,n):0<=o.__absoluteCompare(e,t)?o.__absoluteSub(e,t,n):o.__absoluteSub(t,e,!n)}},{key:"subtract",value:function(e,t){var n=e.sign;return n===t.sign?0<=o.__absoluteCompare(e,t)?o.__absoluteSub(e,t,n):o.__absoluteSub(t,e,!n):o.__absoluteAdd(e,t,n)}},{key:"leftShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?o.__rightShiftByAbsolute(e,t):o.__leftShiftByAbsolute(e,t)}},{key:"signedRightShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?o.__leftShiftByAbsolute(e,t):o.__rightShiftByAbsolute(e,t)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(e,t){return 0>o.__compareToBigInt(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return 0>=o.__compareToBigInt(e,t)}},{key:"greaterThan",value:function(e,t){return 0<o.__compareToBigInt(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return 0<=o.__compareToBigInt(e,t)}},{key:"equal",value:function(e,t){if(e.sign!==t.sign||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e.__digit(n)!==t.__digit(n))return!1;return!0}},{key:"notEqual",value:function(e,t){return!o.equal(e,t)}},{key:"bitwiseAnd",value:function(e,t){if(!e.sign&&!t.sign)return o.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){var n=i(e.length,t.length)+1,r=o.__absoluteSubOne(e,n),a=o.__absoluteSubOne(t);return r=o.__absoluteOr(r,a,r),o.__absoluteAddOne(r,!0,r).__trim()}if(e.sign){var s=[t,e];e=s[0],t=s[1]}return o.__absoluteAndNot(e,o.__absoluteSubOne(t)).__trim()}},{key:"bitwiseXor",value:function(e,t){if(!e.sign&&!t.sign)return o.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){var n=i(e.length,t.length),r=o.__absoluteSubOne(e,n),a=o.__absoluteSubOne(t);return o.__absoluteXor(r,a,r).__trim()}var s=i(e.length,t.length)+1;if(e.sign){var l=[t,e];e=l[0],t=l[1]}var h=o.__absoluteSubOne(t,s);return h=o.__absoluteXor(h,e,h),o.__absoluteAddOne(h,!0,h).__trim()}},{key:"bitwiseOr",value:function(e,t){var n=i(e.length,t.length);if(!e.sign&&!t.sign)return o.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){var r=o.__absoluteSubOne(e,n),a=o.__absoluteSubOne(t);return r=o.__absoluteAnd(r,a,r),o.__absoluteAddOne(r,!0,r).__trim()}if(e.sign){var s=[t,e];e=s[0],t=s[1]}var l=o.__absoluteSubOne(t,n);return l=o.__absoluteAndNot(l,e,l),o.__absoluteAddOne(l,!0,l).__trim()}},{key:"asIntN",value:function(e,t){if(0===t.length)return t;if(0>(e=s(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return o.__zero();if(e>=o.__kMaxLengthBits)return t;var n=0|(e+29)/30;if(t.length<n)return t;var r=t.__unsignedDigit(n-1),i=1<<(e-1)%30;if(t.length===n&&r<i)return t;if((r&i)!==i)return o.__truncateToNBits(e,t);if(!t.sign)return o.__truncateAndSubFromPowerOfTwo(e,t,!0);if(!(r&i-1)){for(var a=n-2;0<=a;a--)if(0!==t.__digit(a))return o.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===n&&r===i?t:o.__truncateToNBits(e,t)}return o.__truncateAndSubFromPowerOfTwo(e,t,!1)}},{key:"asUintN",value:function(e,t){if(0===t.length)return t;if(0>(e=s(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return o.__zero();if(t.sign){if(e>o.__kMaxLengthBits)throw new RangeError("BigInt too big");return o.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=o.__kMaxLengthBits)return t;var n=0|(e+29)/30;if(t.length<n)return t;var r=e%30;if(t.length==n){if(0===r)return t;if(!(t.__digit(n-1)>>>r))return t}return o.__truncateToNBits(e,t)}},{key:"ADD",value:function(e,t){if(e=o.__toPrimitive(e),t=o.__toPrimitive(t),"string"==typeof e)return"string"!=typeof t&&(t=t.toString()),e+t;if("string"==typeof t)return e.toString()+t;if(e=o.__toNumeric(e),t=o.__toNumeric(t),o.__isBigInt(e)&&o.__isBigInt(t))return o.add(e,t);if("number"==typeof e&&"number"==typeof t)return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(e,t){return o.__compare(e,t,0)}},{key:"LE",value:function(e,t){return o.__compare(e,t,1)}},{key:"GT",value:function(e,t){return o.__compare(e,t,2)}},{key:"GE",value:function(e,t){return o.__compare(e,t,3)}},{key:"EQ",value:function(e,t){for(;;){if(o.__isBigInt(e))return o.__isBigInt(t)?o.equal(e,t):o.EQ(t,e);if("number"==typeof e){if(o.__isBigInt(t))return o.__equalToNumber(t,e);if("object"!==n(t))return e==t;t=o.__toPrimitive(t)}else if("string"==typeof e){if(o.__isBigInt(t))return null!==(e=o.__fromString(e))&&o.equal(e,t);if("object"!==n(t))return e==t;t=o.__toPrimitive(t)}else if("boolean"==typeof e){if(o.__isBigInt(t))return o.__equalToNumber(t,+e);if("object"!==n(t))return e==t;t=o.__toPrimitive(t)}else if("symbol"===n(e)){if(o.__isBigInt(t))return!1;if("object"!==n(t))return e==t;t=o.__toPrimitive(t)}else{if("object"!==n(e))return e==t;if("object"===n(t)&&t.constructor!==o)return e==t;e=o.__toPrimitive(e)}}}},{key:"NE",value:function(e,t){return!o.EQ(e,t)}},{key:"DataViewGetBigInt64",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return o.asIntN(64,o.DataViewGetBigUint64(e,t,n))}},{key:"DataViewGetBigUint64",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=c(n?[4,0]:[0,4],2),i=r[0],a=r[1],s=e.getUint32(t+i,n),l=e.getUint32(t+a,n),h=new o(3,!1);return h.__setDigit(0,1073741823&l),h.__setDigit(1,(268435455&s)<<2|l>>>30),h.__setDigit(2,s>>>28),h.__trim()}},{key:"DataViewSetBigInt64",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];o.DataViewSetBigUint64(e,t,n,r)}},{key:"DataViewSetBigUint64",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=0,a=0;if(0<(n=o.asUintN(64,n)).length&&(a=n.__digit(0),1<n.length)){var s=n.__digit(1);a|=s<<30,i=s>>>2,2<n.length&&(i|=n.__digit(2)<<28)}var l=c(r?[4,0]:[0,4],2),h=l[0],u=l[1];e.setUint32(t+h,i,r),e.setUint32(t+u,a,r)}},{key:"__zero",value:function(){return new o(0,!1)}},{key:"__oneDigit",value:function(e,t){var n=new o(1,t);return n.__setDigit(0,e),n}},{key:"__decideRounding",value:function(e,t,n,r){if(0<t)return-1;var i;if(0>t)i=-t-1;else{if(0===n)return-1;n--,r=e.__digit(n),i=29}var a=1<<i;if(!(r&a))return-1;if(0!=(r&(a-=1)))return 1;for(;0<n;)if(n--,0!==e.__digit(n))return 1;return 0}},{key:"__fromDouble",value:function(e){o.__kBitConversionDouble[0]=e;var t,n=(2047&o.__kBitConversionInts[1]>>>20)-1023,r=1+(0|n/30),i=new o(r,0>e),a=1048575&o.__kBitConversionInts[1]|1048576,s=o.__kBitConversionInts[0],l=n%30,h=0;if(l<20){var u=20-l;h=u+32,t=a>>>u,a=a<<32-u|s>>>u,s<<=32-u}else if(20===l)h=32,t=a,a=s,s=0;else{var c=l-20;h=32-c,t=a<<c|s>>>32-c,a=s<<c,s=0}i.__setDigit(r-1,t);for(var d=r-2;0<=d;d--)0<h?(h-=30,t=a>>>2,a=a<<30|s>>>2,s<<=30):t=0,i.__setDigit(d,t);return i.__trim()}},{key:"__isWhitespace",value:function(e){return 13>=e&&9<=e||(159>=e?32==e:131071>=e?160==e||5760==e:196607>=e?10>=(e&=131071)||40==e||41==e||47==e||95==e||4096==e:65279==e)}},{key:"__fromString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,r=e.length,i=0;if(i===r)return o.__zero();for(var a=e.charCodeAt(i);o.__isWhitespace(a);){if(++i===r)return o.__zero();a=e.charCodeAt(i)}if(43===a){if(++i===r)return null;a=e.charCodeAt(i),n=1}else if(45===a){if(++i===r)return null;a=e.charCodeAt(i),n=-1}if(0===t){if(t=10,48===a){if(++i===r)return o.__zero();if(88===(a=e.charCodeAt(i))||120===a){if(t=16,++i===r)return null;a=e.charCodeAt(i)}else if(79===a||111===a){if(t=8,++i===r)return null;a=e.charCodeAt(i)}else if(66===a||98===a){if(t=2,++i===r)return null;a=e.charCodeAt(i)}}}else if(16===t&&48===a){if(++i===r)return o.__zero();if(88===(a=e.charCodeAt(i))||120===a){if(++i===r)return null;a=e.charCodeAt(i)}}if(0!==n&&10!==t)return null;for(;48===a;){if(++i===r)return o.__zero();a=e.charCodeAt(i)}var s=r-i,l=o.__kMaxBitsPerChar[t],h=o.__kBitsPerCharTableMultiplier-1;if(s>1073741824/l)return null;var u=new o(0|(29+(l*s+h>>>o.__kBitsPerCharTableShift))/30,!1),c=10>t?t:10,d=10<t?t-10:0;if(t&t-1){u.__initializeDigits();var p=!1,f=0;do{for(var m,g=0,v=1;;){if(m=void 0,a-48>>>0<c)m=a-48;else{if(!((32|a)-97>>>0<d)){p=!0;break}m=(32|a)-87}var y=v*t;if(1073741823<y)break;if(v=y,g=g*t+m,f++,++i===r){p=!0;break}a=e.charCodeAt(i)}var x=0|(l*f+(h=30*o.__kBitsPerCharTableMultiplier-1)>>>o.__kBitsPerCharTableShift)/30;u.__inplaceMultiplyAdd(v,g,x)}while(!p)}else{l>>=o.__kBitsPerCharTableShift;var b=[],_=[],w=!1;do{for(var S,M=0,T=0;;){if(S=void 0,a-48>>>0<c)S=a-48;else{if(!((32|a)-97>>>0<d)){w=!0;break}S=(32|a)-87}if(T+=l,M=M<<l|S,++i===r){w=!0;break}if(a=e.charCodeAt(i),30<T+l)break}b.push(M),_.push(T)}while(!w);o.__fillFromParts(u,b,_)}if(i!==r){if(!o.__isWhitespace(a))return null;for(i++;i<r;i++)if(a=e.charCodeAt(i),!o.__isWhitespace(a))return null}return u.sign=-1===n,u.__trim()}},{key:"__fillFromParts",value:function(e,t,n){for(var r=0,i=0,a=0,s=t.length-1;0<=s;s--){var o=t[s],l=n[s];i|=o<<a,30===(a+=l)?(e.__setDigit(r++,i),a=0,i=0):30<a&&(e.__setDigit(r++,1073741823&i),i=o>>>l-(a-=30))}if(0!==i){if(r>=e.length)throw new Error("implementation bug");e.__setDigit(r++,i)}for(;r<e.length;r++)e.__setDigit(r,0)}},{key:"__toStringBasePowerOfTwo",value:function(e,t){var n=e.length,r=t-1,i=r=(15&(r=(51&(r=(85&r>>>1)+(85&r))>>>2)+(51&r))>>>4)+(15&r),a=t-1,s=e.__digit(n-1),l=0|(30*n-o.__clz30(s)+i-1)/i;if(e.sign&&l++,268435456<l)throw new Error("string too long");for(var h=Array(l),u=l-1,c=0,d=0,p=0;p<n-1;p++){var f=e.__digit(p),m=(c|f<<d)&a;h[u--]=o.__kConversionChars[m];var g=i-d;for(c=f>>>g,d=30-g;d>=i;)h[u--]=o.__kConversionChars[c&a],c>>>=i,d-=i}var v=(c|s<<d)&a;for(h[u--]=o.__kConversionChars[v],c=s>>>i-d;0!==c;)h[u--]=o.__kConversionChars[c&a],c>>>=i;if(e.sign&&(h[u--]="-"),-1!==u)throw new Error("implementation bug");return h.join("")}},{key:"__toStringGeneric",value:function(e,t,n){var r=e.length;if(0===r)return"";if(1===r){var i=e.__unsignedDigit(0).toString(t);return!1===n&&e.sign&&(i="-"+i),i}var a,s,l=30*r-o.__clz30(e.__digit(r-1)),h=o.__kMaxBitsPerChar[t]-1,u=l*o.__kBitsPerCharTableMultiplier,c=1+(u=0|(u+=h-1)/h)>>1,d=o.exponentiate(o.__oneDigit(t,!1),o.__oneDigit(c,!1)),p=d.__unsignedDigit(0);if(1===d.length&&32767>=p){(a=new o(e.length,!1)).__initializeDigits();for(var f,m=0,g=2*e.length-1;0<=g;g--)f=m<<15|e.__halfDigit(g),a.__setHalfDigit(g,0|f/p),m=0|f%p;s=m.toString(t)}else{var v=o.__absoluteDivLarge(e,d,!0,!0);a=v.quotient;var y=v.remainder.__trim();s=o.__toStringGeneric(y,t,!0)}a.__trim();for(var x=o.__toStringGeneric(a,t,!0);s.length<c;)s="0"+s;return!1===n&&e.sign&&(x="-"+x),x+s}},{key:"__unequalSign",value:function(e){return e?-1:1}},{key:"__absoluteGreater",value:function(e){return e?-1:1}},{key:"__absoluteLess",value:function(e){return e?1:-1}},{key:"__compareToBigInt",value:function(e,t){var n=e.sign;if(n!==t.sign)return o.__unequalSign(n);var r=o.__absoluteCompare(e,t);return 0<r?o.__absoluteGreater(n):0>r?o.__absoluteLess(n):0}},{key:"__compareToNumber",value:function(e,n){if(o.__isOneDigitInt(n)){var r=e.sign,i=0>n;if(r!==i)return o.__unequalSign(r);if(0===e.length){if(i)throw new Error("implementation bug");return 0===n?0:-1}if(1<e.length)return o.__absoluteGreater(r);var a=t(n),s=e.__unsignedDigit(0);return s>a?o.__absoluteGreater(r):s<a?o.__absoluteLess(r):0}return o.__compareToDouble(e,n)}},{key:"__compareToDouble",value:function(e,t){if(t!=t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;var n=e.sign;if(n!==0>t)return o.__unequalSign(n);if(0===t)throw new Error("implementation bug: should be handled elsewhere");if(0===e.length)return-1;o.__kBitConversionDouble[0]=t;var r=2047&o.__kBitConversionInts[1]>>>20;if(2047==r)throw new Error("implementation bug: handled elsewhere");var i=r-1023;if(0>i)return o.__absoluteGreater(n);var a=e.length,s=e.__digit(a-1),l=o.__clz30(s),h=30*a-l,u=i+1;if(h<u)return o.__absoluteLess(n);if(h>u)return o.__absoluteGreater(n);var c=1048576|1048575&o.__kBitConversionInts[1],d=o.__kBitConversionInts[0],p=29-l;if(p!==(0|(h-1)%30))throw new Error("implementation bug");var f,m=0;if(p<20){var g=20-p;m=g+32,f=c>>>g,c=c<<32-g|d>>>g,d<<=32-g}else if(20===p)m=32,f=c,c=d,d=0;else{var v=p-20;m=32-v,f=c<<v|d>>>32-v,c=d<<v,d=0}if((s>>>=0)>(f>>>=0))return o.__absoluteGreater(n);if(s<f)return o.__absoluteLess(n);for(var y=a-2;0<=y;y--){0<m?(m-=30,f=c>>>2,c=c<<30|d>>>2,d<<=30):f=0;var x=e.__unsignedDigit(y);if(x>f)return o.__absoluteGreater(n);if(x<f)return o.__absoluteLess(n)}if(0!==c||0!==d){if(0===m)throw new Error("implementation bug");return o.__absoluteLess(n)}return 0}},{key:"__equalToNumber",value:function(e,n){return o.__isOneDigitInt(n)?0===n?0===e.length:1===e.length&&e.sign===0>n&&e.__unsignedDigit(0)===t(n):0===o.__compareToDouble(e,n)}},{key:"__comparisonResultToBool",value:function(e,t){return 0===t?0>e:1===t?0>=e:2===t?0<e:3===t?0<=e:void 0}},{key:"__compare",value:function(e,t,n){if(e=o.__toPrimitive(e),t=o.__toPrimitive(t),"string"==typeof e&&"string"==typeof t)switch(n){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(o.__isBigInt(e)&&"string"==typeof t)return null!==(t=o.__fromString(t))&&o.__comparisonResultToBool(o.__compareToBigInt(e,t),n);if("string"==typeof e&&o.__isBigInt(t))return null!==(e=o.__fromString(e))&&o.__comparisonResultToBool(o.__compareToBigInt(e,t),n);if(e=o.__toNumeric(e),t=o.__toNumeric(t),o.__isBigInt(e)){if(o.__isBigInt(t))return o.__comparisonResultToBool(o.__compareToBigInt(e,t),n);if("number"!=typeof t)throw new Error("implementation bug");return o.__comparisonResultToBool(o.__compareToNumber(e,t),n)}if("number"!=typeof e)throw new Error("implementation bug");if(o.__isBigInt(t))return o.__comparisonResultToBool(o.__compareToNumber(t,e),2^n);if("number"!=typeof t)throw new Error("implementation bug");return 0===n?e<t:1===n?e<=t:2===n?e>t:3===n?e>=t:void 0}},{key:"__absoluteAdd",value:function(e,t,n){if(e.length<t.length)return o.__absoluteAdd(t,e,n);if(0===e.length)return e;if(0===t.length)return e.sign===n?e:o.unaryMinus(e);var r=e.length;(0===e.__clzmsd()||t.length===e.length&&0===t.__clzmsd())&&r++;for(var i,a=new o(r,n),s=0,l=0;l<t.length;l++)s=(i=e.__digit(l)+t.__digit(l)+s)>>>30,a.__setDigit(l,1073741823&i);for(;l<e.length;l++){var h=e.__digit(l)+s;s=h>>>30,a.__setDigit(l,1073741823&h)}return l<a.length&&a.__setDigit(l,s),a.__trim()}},{key:"__absoluteSub",value:function(e,t,n){if(0===e.length)return e;if(0===t.length)return e.sign===n?e:o.unaryMinus(e);for(var r,i=new o(e.length,n),a=0,s=0;s<t.length;s++)a=1&(r=e.__digit(s)-t.__digit(s)-a)>>>30,i.__setDigit(s,1073741823&r);for(;s<e.length;s++){var l=e.__digit(s)-a;a=1&l>>>30,i.__setDigit(s,1073741823&l)}return i.__trim()}},{key:"__absoluteAddOne",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=e.length;null===n?n=new o(r,t):n.sign=t;for(var i,a=1,s=0;s<r;s++)a=(i=e.__digit(s)+a)>>>30,n.__setDigit(s,1073741823&i);return 0!==a&&n.__setDigitGrow(r,1),n}},{key:"__absoluteSubOne",value:function(e,t){for(var n,r=e.length,i=new o(t=t||r,!1),a=1,s=0;s<r;s++)a=1&(n=e.__digit(s)-a)>>>30,i.__setDigit(s,1073741823&n);if(0!==a)throw new Error("implementation bug");for(var l=r;l<t;l++)i.__setDigit(l,0);return i}},{key:"__absoluteAnd",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=e.length,i=t.length,a=i;if(r<i){a=r;var s=e,l=r;e=t,r=i,t=s,i=l}var h=a;null===n?n=new o(h,!1):h=n.length;for(var u=0;u<a;u++)n.__setDigit(u,e.__digit(u)&t.__digit(u));for(;u<h;u++)n.__setDigit(u,0);return n}},{key:"__absoluteAndNot",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=e.length,i=t.length,a=i;r<i&&(a=r);var s=r;null===n?n=new o(s,!1):s=n.length;for(var l=0;l<a;l++)n.__setDigit(l,e.__digit(l)&~t.__digit(l));for(;l<r;l++)n.__setDigit(l,e.__digit(l));for(;l<s;l++)n.__setDigit(l,0);return n}},{key:"__absoluteOr",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=e.length,i=t.length,a=i;if(r<i){a=r;var s=e,l=r;e=t,r=i,t=s,i=l}var h=r;null===n?n=new o(h,!1):h=n.length;for(var u=0;u<a;u++)n.__setDigit(u,e.__digit(u)|t.__digit(u));for(;u<r;u++)n.__setDigit(u,e.__digit(u));for(;u<h;u++)n.__setDigit(u,0);return n}},{key:"__absoluteXor",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=e.length,i=t.length,a=i;if(r<i){a=r;var s=e,l=r;e=t,r=i,t=s,i=l}var h=r;null===n?n=new o(h,!1):h=n.length;for(var u=0;u<a;u++)n.__setDigit(u,e.__digit(u)^t.__digit(u));for(;u<r;u++)n.__setDigit(u,e.__digit(u));for(;u<h;u++)n.__setDigit(u,0);return n}},{key:"__absoluteCompare",value:function(e,t){var n=e.length-t.length;if(0!=n)return n;for(var r=e.length-1;0<=r&&e.__digit(r)===t.__digit(r);)r--;return 0>r?0:e.__unsignedDigit(r)>t.__unsignedDigit(r)?1:-1}},{key:"__multiplyAccumulate",value:function(e,t,n,r){if(0!==t){for(var i=32767&t,a=t>>>15,s=0,l=0,h=0;h<e.length;h++,r++){var u=n.__digit(r),c=e.__digit(h),d=32767&c,p=c>>>15,f=o.__imul(d,i),m=o.__imul(d,a),g=o.__imul(p,i);s=(u+=l+f+s)>>>30,u&=1073741823,s+=(u+=((32767&m)<<15)+((32767&g)<<15))>>>30,l=o.__imul(p,a)+(m>>>15)+(g>>>15),n.__setDigit(r,1073741823&u)}for(;0!==s||0!==l;r++){var v=n.__digit(r);v+=s+l,l=0,s=v>>>30,n.__setDigit(r,1073741823&v)}}}},{key:"__internalMultiplyAdd",value:function(e,t,n,r,i){for(var a=n,s=0,l=0;l<r;l++){var h=e.__digit(l),u=o.__imul(32767&h,t),c=o.__imul(h>>>15,t),d=u+((32767&c)<<15)+s+a;a=d>>>30,s=c>>>15,i.__setDigit(l,1073741823&d)}if(i.length>r)for(i.__setDigit(r++,a+s);r<i.length;)i.__setDigit(r++,0);else if(a+s!==0)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new o(e.length,!1));for(var r=0,i=2*e.length-1;0<=i;i-=2){var a=(r<<15|e.__halfDigit(i))>>>0,s=0|a/t,l=0|(a=((r=0|a%t)<<15|e.__halfDigit(i-1))>>>0)/t;r=0|a%t,n.__setDigit(i>>>1,s<<15|l)}return n}},{key:"__absoluteModSmall",value:function(e,t){for(var n=0,r=2*e.length-1;0<=r;r--)n=0|((n<<15|e.__halfDigit(r))>>>0)%t;return n}},{key:"__absoluteDivLarge",value:function(e,t,n,r){var i=t.__halfDigitLength(),a=t.length,s=e.__halfDigitLength()-i,l=null;n&&(l=new o(s+2>>>1,!1)).__initializeDigits();var h=new o(i+2>>>1,!1);h.__initializeDigits();var u=o.__clz15(t.__halfDigit(i-1));0<u&&(t=o.__specialLeftShift(t,u,0));for(var c=o.__specialLeftShift(e,u,1),d=t.__halfDigit(i-1),p=0,f=s;0<=f;f--){var m=32767,g=c.__halfDigit(f+i);if(g!==d){var v=(g<<15|c.__halfDigit(f+i-1))>>>0;m=0|v/d;for(var y=0|v%d,x=t.__halfDigit(i-2),b=c.__halfDigit(f+i-2);o.__imul(m,x)>>>0>(y<<16|b)>>>0&&(m--,!(32767<(y+=d))););}o.__internalMultiplyAdd(t,m,0,a,h);var _=c.__inplaceSub(h,f,i+1);0!==_&&(_=c.__inplaceAdd(t,f,i),c.__setHalfDigit(f+i,32767&c.__halfDigit(f+i)+_),m--),n&&(1&f?p=m<<15:l.__setDigit(f>>>1,p|m))}if(r)return c.__inplaceRightShift(u),n?{quotient:l,remainder:c}:c;if(n)return l;throw new Error("unreachable")}},{key:"__clz15",value:function(e){return o.__clz30(e)-15}},{key:"__specialLeftShift",value:function(e,t,n){var r=e.length,i=new o(r+n,!1);if(0===t){for(var a=0;a<r;a++)i.__setDigit(a,e.__digit(a));return 0<n&&i.__setDigit(r,0),i}for(var s,l=0,h=0;h<r;h++)s=e.__digit(h),i.__setDigit(h,1073741823&s<<t|l),l=s>>>30-t;return 0<n&&i.__setDigit(r,l),i}},{key:"__leftShiftByAbsolute",value:function(e,t){var n=o.__toShiftAmount(t);if(0>n)throw new RangeError("BigInt too big");var r=0|n/30,i=n%30,a=e.length,s=0!==i&&e.__digit(a-1)>>>30-i!=0,l=a+r+(s?1:0),h=new o(l,e.sign);if(0===i){for(var u=0;u<r;u++)h.__setDigit(u,0);for(;u<l;u++)h.__setDigit(u,e.__digit(u-r))}else{for(var c=0,d=0;d<r;d++)h.__setDigit(d,0);for(var p,f=0;f<a;f++)p=e.__digit(f),h.__setDigit(f+r,1073741823&p<<i|c),c=p>>>30-i;if(s)h.__setDigit(a+r,c);else if(0!==c)throw new Error("implementation bug")}return h.__trim()}},{key:"__rightShiftByAbsolute",value:function(e,t){var n=e.length,r=e.sign,i=o.__toShiftAmount(t);if(0>i)return o.__rightShiftByMaximum(r);var a=0|i/30,s=i%30,l=n-a;if(0>=l)return o.__rightShiftByMaximum(r);var h=!1;if(r)if(e.__digit(a)&(1<<s)-1)h=!0;else for(var u=0;u<a;u++)if(0!==e.__digit(u)){h=!0;break}h&&0===s&&!~e.__digit(n-1)&&l++;var c=new o(l,r);if(0===s){c.__setDigit(l-1,0);for(var d=a;d<n;d++)c.__setDigit(d-a,e.__digit(d))}else{for(var p,f=e.__digit(a)>>>s,m=n-a-1,g=0;g<m;g++)p=e.__digit(g+a+1),c.__setDigit(g,1073741823&p<<30-s|f),f=p>>>s;c.__setDigit(m,f)}return h&&(c=o.__absoluteAddOne(c,!0,c)),c.__trim()}},{key:"__rightShiftByMaximum",value:function(e){return e?o.__oneDigit(1,!0):o.__zero()}},{key:"__toShiftAmount",value:function(e){if(1<e.length)return-1;var t=e.__unsignedDigit(0);return t>o.__kMaxLengthBits?-1:t}},{key:"__toPrimitive",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==n(e)||e.constructor===o)return e;if("undefined"!=typeof Symbol&&"symbol"===n(Symbol.toPrimitive)){var r=e[Symbol.toPrimitive];if(r){var i=r(t);if("object"!==n(i))return i;throw new TypeError("Cannot convert object to primitive value")}}var a=e.valueOf;if(a){var s=a.call(e);if("object"!==n(s))return s}var l=e.toString;if(l){var h=l.call(e);if("object"!==n(h))return h}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(e){return o.__isBigInt(e)?e:+e}},{key:"__isBigInt",value:function(e){return"object"===n(e)&&null!==e&&e.constructor===o}},{key:"__truncateToNBits",value:function(e,t){for(var n=0|(e+29)/30,r=new o(n,t.sign),i=n-1,a=0;a<i;a++)r.__setDigit(a,t.__digit(a));var s=t.__digit(i);if(e%30!=0){var l=32-e%30;s=s<<l>>>l}return r.__setDigit(i,s),r.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(e,t,n){for(var r,i=Math.min,a=0|(e+29)/30,s=new o(a,n),l=0,h=a-1,u=0,c=i(h,t.length);l<c;l++)u=1&(r=0-t.__digit(l)-u)>>>30,s.__setDigit(l,1073741823&r);for(;l<h;l++)s.__setDigit(l,0|1073741823&-u);var d,p=h<t.length?t.__digit(h):0,f=e%30;if(0===f)d=0-p-u,d&=1073741823;else{var m=32-f,g=1<<32-m;d=g-(p=p<<m>>>m)-u,d&=g-1}return s.__setDigit(h,d),s.__trim()}},{key:"__digitPow",value:function(e,t){for(var n=1;0<t;)1&t&&(n*=e),t>>>=1,e*=e;return n}},{key:"__isOneDigitInt",value:function(e){return(1073741823&e)===e}}]),o}(l(Array));return f.__kMaxLength=33554432,f.__kMaxLengthBits=f.__kMaxLength<<5,f.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],f.__kBitsPerCharTableShift=5,f.__kBitsPerCharTableMultiplier=1<<f.__kBitsPerCharTableShift,f.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],f.__kBitConversionBuffer=new ArrayBuffer(8),f.__kBitConversionDouble=new Float64Array(f.__kBitConversionBuffer),f.__kBitConversionInts=new Int32Array(f.__kBitConversionBuffer),f.__clz30=t?function(e){return t(e)-2}:function(e){var t=Math.LN2,n=Math.log;return 0===e?30:0|29-(0|n(e>>>0)/t)},f.__imul=e||function(e,t){return 0|e*t},f},"object"==typeof e&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):(n=n||self).JSBI=r()})),Efe=Z(((e,t)=>{var n,r;n=e,r=function(){"use strict";function e(e,r,i,a,s){!function e(n,r,i,a,s){for(;a>i;){if(a-i>600){var o=a-i+1,l=r-i+1,h=Math.log(o),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(o-u)/o)*(l-o/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-l*u/o+c)),Math.min(a,Math.floor(r+(o-l)*u/o+c)),s)}var d=n[r],p=i,f=a;for(t(n,i,r),s(n[a],d)>0&&t(n,i,a);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[i],d)?t(n,i,f):t(n,++f,a),f<=r&&(i=f+1),r<=f&&(a=f-1)}}(e,r,i||0,a||e.length-1,s||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,r,i){i||(i=f(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t;a<n;a++){var s=e.children[a];o(i,e.leaf?r(s):s)}return i}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,n,r,i,a){for(var s=[n,r];s.length;)if(!((r=s.pop())-(n=s.pop())<=i)){var o=n+Math.ceil((r-n)/i/2)*i;e(t,o,n,r,a),s.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var r=this.toBBox,i=[];t;){for(var a=0;a<t.children.length;a++){var s=t.children[a],o=t.leaf?r(s):s;p(e,o)&&(t.leaf?n.push(s):d(e,o)?this._all(s,n):i.push(s))}t=i.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var i=t.children[r],a=t.leaf?this.toBBox(i):i;if(p(e,a)){if(t.leaf||d(e,a))return!0;n.push(i)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,a,s=this.data,o=this.toBBox(e),l=[],h=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=h.pop(),a=!0),s.leaf){var u=i(e,s.children,t);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}a||s.leaf||!d(s,o)?r?(n++,s=r.children[n],a=!1):s=null:(l.push(s),h.push(n),n=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var i,s=n-t+1,o=this._maxEntries;if(s<=o)return a(i=f(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(i=f([])).leaf=!1,i.height=r;var l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));m(e,t,n,h,this.compareMinX);for(var u=t;u<=n;u+=h){var c=Math.min(u+h-1,n);m(e,u,c,l,this.compareMinY);for(var d=u;d<=c;d+=l){var p=Math.min(d+l-1,c);i.children.push(this._build(e,d,p,r-1))}}return a(i,this.toBBox),i},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var i=1/0,a=1/0,s=void 0,o=0;o<t.children.length;o++){var l=t.children[o],h=u(l),c=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-h);c<a?(a=c,i=h<i?h:i,s=l):c===a&&h<i&&(i=h,s=l)}t=s||t.children[0]}var d,p;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),i=[],a=this._chooseSubtree(r,this.data,t,i);for(a.children.push(e),o(a,r);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(r,i,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var s=this._chooseSplitIndex(n,i,r),o=f(n.children.splice(s,n.children.length-s));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,i,a,o,l,h,c,d=1/0,p=1/0,f=t;f<=n-t;f++){var m=s(e,0,f,this.toBBox),g=s(e,f,n,this.toBBox),v=(i=m,a=g,o=Math.max(i.minX,a.minX),l=Math.max(i.minY,a.minY),h=Math.min(i.maxX,a.maxX),c=Math.min(i.maxY,a.maxY),Math.max(0,h-o)*Math.max(0,c-l)),y=u(m)+u(g);v<d?(d=v,r=f,p=y<p?y:p):v===d&&y<p&&(p=y,r=f)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var i=this.toBBox,a=s(e,0,t,i),l=s(e,n-t,n,i),h=c(a)+c(l),u=t;u<n-t;u++){var d=e.children[u];o(a,e.leaf?i(d):d),h+=c(a)}for(var p=n-t-1;p>=t;p--){var f=e.children[p];o(l,e.leaf?i(f):f),h+=c(l)}return h},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)o(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():a(e[t],this.toBBox)},r},"object"==typeof e&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):(n=n||self).RBush=r()})),_fe=Z(((e,t)=>{var n,r;n=e,r=function(){"use strict";var e=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n=t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r},e.prototype._down=function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var a=1+(e<<1),s=t[a],o=a+1;if(o<this.length&&n(t[o],s)<0&&(a=o,s=t[o]),n(s,i)>=0)break;t[e]=s,e=a}t[e]=i},e},"object"==typeof e&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):(n=n||self).TinyQueue=r()})),Sfe=Z(((e,t)=>{t.exports=function(e,t,n,r){var i=e[0],a=e[1],s=!1;void 0===n&&(n=0),void 0===r&&(r=t.length);for(var o=(r-n)/2,l=0,h=o-1;l<o;h=l++){var u=t[n+2*l+0],c=t[n+2*l+1],d=t[n+2*h+0],p=t[n+2*h+1];c>a!=p>a&&i<(d-u)*(a-c)/(p-c)+u&&(s=!s)}return s}})),Mfe=Z(((e,t)=>{t.exports=function(e,t,n,r){var i=e[0],a=e[1],s=!1;void 0===n&&(n=0),void 0===r&&(r=t.length);for(var o=r-n,l=0,h=o-1;l<o;h=l++){var u=t[l+n][0],c=t[l+n][1],d=t[h+n][0],p=t[h+n][1];c>a!=p>a&&i<(d-u)*(a-c)/(p-c)+u&&(s=!s)}return s}})),Rfe=Z(((e,t)=>{var n=Sfe(),r=Mfe();t.exports=function(e,t,i,a){return t.length>0&&Array.isArray(t[0])?r(e,t,i,a):n(e,t,i,a)},t.exports.nested=r,t.exports.flat=n})),Ife=Z(((e,t)=>{var n,r;n=e,r=function(e){"use strict";function t(e,t,n,r,i){let a,s,o,l,h=t[0],u=r[0],c=0,d=0;u>h==u>-h?(a=h,h=t[++c]):(a=u,u=r[++d]);let p=0;if(c<e&&d<n)for(u>h==u>-h?(o=a-((s=h+a)-h),h=t[++c]):(o=a-((s=u+a)-u),u=r[++d]),a=s,0!==o&&(i[p++]=o);c<e&&d<n;)u>h==u>-h?(o=a-((s=a+h)-(l=s-a))+(h-l),h=t[++c]):(o=a-((s=a+u)-(l=s-a))+(u-l),u=r[++d]),a=s,0!==o&&(i[p++]=o);for(;c<e;)o=a-((s=a+h)-(l=s-a))+(h-l),h=t[++c],a=s,0!==o&&(i[p++]=o);for(;d<n;)o=a-((s=a+u)-(l=s-a))+(u-l),u=r[++d],a=s,0!==o&&(i[p++]=o);return 0===a&&0!==p||(i[p++]=a),p}function n(e){return new Float64Array(e)}let r=n(4),i=n(8),a=n(12),s=n(16),o=n(4);e.orient2d=function(e,n,l,h,u,c){let d=(n-c)*(l-u),p=(e-u)*(h-c),f=d-p;if(0===d||0===p||d>0!=p>0)return f;let m=Math.abs(d+p);return Math.abs(f)>=33306690738754716e-32*m?f:-function(e,n,l,h,u,c,d){let p,f,m,g,v,y,x,b,_,w,S,M,T,E,A,C,P,I,R=e-u,L=l-u,O=n-c,D=h-c;v=(A=(b=R-(x=(y=134217729*R)-(y-R)))*(w=D-(_=(y=134217729*D)-(y-D)))-((E=R*D)-x*_-b*_-x*w))-(S=A-(P=(b=O-(x=(y=134217729*O)-(y-O)))*(w=L-(_=(y=134217729*L)-(y-L)))-((C=O*L)-x*_-b*_-x*w))),r[0]=A-(S+v)+(v-P),v=(T=E-((M=E+S)-(v=M-E))+(S-v))-(S=T-C),r[1]=T-(S+v)+(v-C),v=(I=M+S)-M,r[2]=M-(I-v)+(S-v),r[3]=I;let k=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,r),N=22204460492503146e-32*d;if(k>=N||-k>=N||(p=e-(R+(v=e-R))+(v-u),m=l-(L+(v=l-L))+(v-u),f=n-(O+(v=n-O))+(v-c),g=h-(D+(v=h-D))+(v-c),0===p&&0===f&&0===m&&0===g)||(N=11093356479670487e-47*d+33306690738754706e-32*Math.abs(k),(k+=R*g+D*p-(O*m+L*f))>=N||-k>=N))return k;v=(A=(b=p-(x=(y=134217729*p)-(y-p)))*(w=D-(_=(y=134217729*D)-(y-D)))-((E=p*D)-x*_-b*_-x*w))-(S=A-(P=(b=f-(x=(y=134217729*f)-(y-f)))*(w=L-(_=(y=134217729*L)-(y-L)))-((C=f*L)-x*_-b*_-x*w))),o[0]=A-(S+v)+(v-P),v=(T=E-((M=E+S)-(v=M-E))+(S-v))-(S=T-C),o[1]=T-(S+v)+(v-C),v=(I=M+S)-M,o[2]=M-(I-v)+(S-v),o[3]=I;let F=t(4,r,4,o,i);v=(A=(b=R-(x=(y=134217729*R)-(y-R)))*(w=g-(_=(y=134217729*g)-(y-g)))-((E=R*g)-x*_-b*_-x*w))-(S=A-(P=(b=O-(x=(y=134217729*O)-(y-O)))*(w=m-(_=(y=134217729*m)-(y-m)))-((C=O*m)-x*_-b*_-x*w))),o[0]=A-(S+v)+(v-P),v=(T=E-((M=E+S)-(v=M-E))+(S-v))-(S=T-C),o[1]=T-(S+v)+(v-C),v=(I=M+S)-M,o[2]=M-(I-v)+(S-v),o[3]=I;let U=t(F,i,4,o,a);v=(A=(b=p-(x=(y=134217729*p)-(y-p)))*(w=g-(_=(y=134217729*g)-(y-g)))-((E=p*g)-x*_-b*_-x*w))-(S=A-(P=(b=f-(x=(y=134217729*f)-(y-f)))*(w=m-(_=(y=134217729*m)-(y-m)))-((C=f*m)-x*_-b*_-x*w))),o[0]=A-(S+v)+(v-P),v=(T=E-((M=E+S)-(v=M-E))+(S-v))-(S=T-C),o[1]=T-(S+v)+(v-C),v=(I=M+S)-M,o[2]=M-(I-v)+(S-v),o[3]=I;let B=t(U,a,4,o,s);return s[B-1]}(e,n,l,h,u,c,m)},e.orient2dfast=function(e,t,n,r,i,a){return(t-a)*(n-i)-(e-i)*(r-a)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof e&&void 0!==t?r(e):"function"==typeof define&&define.amd?define(["exports"],r):r((n=n||self).predicates={})})),Nfe=Z(((e,t)=>{"use strict";var n=Efe(),r=_fe(),i=Rfe(),a=Ife().orient2d;function s(e,t,r){t=Math.max(0,void 0===t?2:t),r=r||0;var a=function(e){for(var t=e[0],n=e[0],r=e[0],a=e[0],s=0;s<e.length;s++){var o=e[s];o[0]<t[0]&&(t=o),o[0]>r[0]&&(r=o),o[1]<n[1]&&(n=o),o[1]>a[1]&&(a=o)}var l=[t,n,r,a],h=l.slice();for(s=0;s<e.length;s++)i(e[s],l)||h.push(e[s]);return function(e){e.sort(x);for(var t=[],n=0;n<e.length;n++){for(;t.length>=2&&d(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}for(var r=[],i=e.length-1;i>=0;i--){for(;r.length>=2&&d(r[r.length-2],r[r.length-1],e[i])<=0;)r.pop();r.push(e[i])}return r.pop(),t.pop(),t.concat(r)}(h)}(e),s=new n(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,t){return e[0]-t[0]},s.compareMinY=function(e,t){return e[1]-t[1]},s.load(e);for(var l,h=[],u=0;u<a.length;u++){var c=a[u];s.remove(c),l=m(c,l),h.push(l)}var p=new n(16);for(u=0;u<h.length;u++)p.insert(f(h[u]));for(var v=t*t,y=r*r;h.length;){var b=h.shift(),_=b.p,w=b.next.p,S=g(_,w);if(!(S<y)){var M=S/v;(c=o(s,b.prev.p,_,w,b.next.next.p,M,p))&&Math.min(g(c,_),g(c,w))<=M&&(h.push(b),h.push(m(c,b)),s.remove(c),p.remove(b),p.insert(f(b)),p.insert(f(b.next)))}}b=l;var T=[];do{T.push(b.p),b=b.next}while(b!==l);return T.push(b.p),T}function o(e,t,n,i,a,s,o){for(var u=new r([],l),d=e.data;d;){for(var p=0;p<d.children.length;p++){var f=d.children[p],m=d.leaf?v(f,n,i):h(n,i,f);m>s||u.push({node:f,dist:m})}for(;u.length&&!u.peek().node.children;){var g=u.pop(),y=g.node,x=v(y,t,n),b=v(y,i,a);if(g.dist<x&&g.dist<b&&c(n,y,o)&&c(i,y,o))return y}(d=u.pop())&&(d=d.node)}return null}function l(e,t){return e.dist-t.dist}function h(e,t,n){if(u(e,n)||u(t,n))return 0;var r=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var a=y(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===a)return 0;var s=y(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(r,i,a,s)}function u(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function c(e,t,n){for(var r=Math.min(e[0],t[0]),i=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),s=Math.max(e[1],t[1]),o=n.search({minX:r,minY:i,maxX:a,maxY:s}),l=0;l<o.length;l++)if(p(o[l].p,o[l].next.p,e,t))return!1;return!0}function d(e,t,n){return a(e[0],e[1],t[0],t[1],n[0],n[1])}function p(e,t,n,r){return e!==r&&t!==n&&d(e,t,n)>0!=d(e,t,r)>0&&d(n,r,e)>0!=d(n,r,t)>0}function f(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function m(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function g(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function v(e,t,n){var r=t[0],i=t[1],a=n[0]-r,s=n[1]-i;if(0!==a||0!==s){var o=((e[0]-r)*a+(e[1]-i)*s)/(a*a+s*s);o>1?(r=n[0],i=n[1]):o>0&&(r+=a*o,i+=s*o)}return(a=e[0]-r)*a+(s=e[1]-i)*s}function y(e,t,n,r,i,a,s,o){var l,h,u,c,d=n-e,p=r-t,f=s-i,m=o-a,g=e-i,v=t-a,y=d*d+p*p,x=d*f+p*m,b=f*f+m*m,_=d*g+p*v,w=f*g+m*v,S=y*b-x*x,M=S,T=S;0===S?(h=0,M=1,c=w,T=b):(c=y*w-x*_,(h=x*w-b*_)<0?(h=0,c=w,T=b):h>M&&(h=M,c=w+x,T=b)),c<0?(c=0,-_<0?h=0:-_>y?h=M:(h=-_,M=y)):c>T&&(c=T,-_+x<0?h=0:-_+x>y?h=M:(h=-_+x,M=y));var E=(1-(u=0===c?0:c/T))*i+u*s-((1-(l=0===h?0:h/M))*e+l*n),A=(1-u)*a+u*o-((1-l)*t+l*r);return E*E+A*A}function x(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}r.default&&(r=r.default),t.exports=s,t.exports.default=s})),ide=Z(((e,t)=>{t.exports=function(){var e,t=0,n=!1;function r(t,n){return e.list.push({type:t,data:n?JSON.parse(JSON.stringify(n)):void 0}),e}return e={list:[],segmentId:function(){return t++},checkIntersection:function(e,t){return r("check",{seg1:e,seg2:t})},segmentChop:function(e,t){return r("div_seg",{seg:e,pt:t}),r("chop",{seg:e,pt:t})},statusRemove:function(e){return r("pop_seg",{seg:e})},segmentUpdate:function(e){return r("seg_update",{seg:e})},segmentNew:function(e,t){return r("new_seg",{seg:e,primary:t})},segmentRemove:function(e){return r("rem_seg",{seg:e})},tempStatus:function(e,t,n){return r("temp_status",{seg:e,above:t,below:n})},rewind:function(e){return r("rewind",{seg:e})},status:function(e,t,n){return r("status",{seg:e,above:t,below:n})},vert:function(t){return t===n?e:(n=t,r("vert",{x:t}))},log:function(e){return"string"!=typeof e&&(e=JSON.stringify(e,!1,"  ")),r("log",{txt:e})},reset:function(){return r("reset")},selected:function(e){return r("selected",{segs:e})},chainStart:function(e){return r("chain_start",{seg:e})},chainRemoveHead:function(e,t){return r("chain_rem_head",{index:e,pt:t})},chainRemoveTail:function(e,t){return r("chain_rem_tail",{index:e,pt:t})},chainNew:function(e,t){return r("chain_new",{pt1:e,pt2:t})},chainMatch:function(e){return r("chain_match",{index:e})},chainClose:function(e){return r("chain_close",{index:e})},chainAddHead:function(e,t){return r("chain_add_head",{index:e,pt:t})},chainAddTail:function(e,t){return r("chain_add_tail",{index:e,pt:t})},chainConnect:function(e,t){return r("chain_con",{index1:e,index2:t})},chainReverse:function(e){return r("chain_rev",{index:e})},chainJoin:function(e,t){return r("chain_join",{index1:e,index2:t})},done:function(){return r("done")}}}})),ade=Z(((e,t)=>{t.exports=function(e){"number"!=typeof e&&(e=1e-10);var t={epsilon:function(t){return"number"==typeof t&&(e=t),e},pointAboveOrOnLine:function(t,n,r){var i=n[0],a=n[1],s=r[0],o=r[1],l=t[0];return(s-i)*(t[1]-a)-(o-a)*(l-i)>=-e},pointBetween:function(t,n,r){var i=t[1]-n[1],a=r[0]-n[0],s=t[0]-n[0],o=r[1]-n[1],l=s*a+i*o;return!(l<e)&&!(l-(a*a+o*o)>-e)},pointsSameX:function(t,n){return Math.abs(t[0]-n[0])<e},pointsSameY:function(t,n){return Math.abs(t[1]-n[1])<e},pointsSame:function(e,n){return t.pointsSameX(e,n)&&t.pointsSameY(e,n)},pointsCompare:function(e,n){return t.pointsSameX(e,n)?t.pointsSameY(e,n)?0:e[1]<n[1]?-1:1:e[0]<n[0]?-1:1},pointsCollinear:function(t,n,r){var i=t[0]-n[0],a=t[1]-n[1],s=n[0]-r[0],o=n[1]-r[1];return Math.abs(i*o-s*a)<e},linesIntersect:function(t,n,r,i){var a=n[0]-t[0],s=n[1]-t[1],o=i[0]-r[0],l=i[1]-r[1],h=a*l-s*o;if(Math.abs(h)<e)return!1;var u=t[0]-r[0],c=t[1]-r[1],d=(o*c-l*u)/h,p=(a*c-s*u)/h,f={alongA:0,alongB:0,pt:[t[0]+d*a,t[1]+d*s]};return f.alongA=d<=-e?-2:d<e?-1:d-1<=-e?0:d-1<e?1:2,f.alongB=p<=-e?-2:p<e?-1:p-1<=-e?0:p-1<e?1:2,f},pointInsideRegion:function(t,n){for(var r=t[0],i=t[1],a=n[n.length-1][0],s=n[n.length-1][1],o=!1,l=0;l<n.length;l++){var h=n[l][0],u=n[l][1];u-i>e!=s-i>e&&(a-h)*(i-u)/(s-u)+h-r>e&&(o=!o),a=h,s=u}return o}};return t}})),lde=Z(((e,t)=>{t.exports={create:function(){var e={root:{root:!0,next:null},exists:function(t){return!(null===t||t===e.root)},isEmpty:function(){return null===e.root.next},getHead:function(){return e.root.next},insertBefore:function(t,n){for(var r=e.root,i=e.root.next;null!==i;){if(n(i))return t.prev=i.prev,t.next=i,i.prev.next=t,void(i.prev=t);r=i,i=i.next}r.next=t,t.prev=r,t.next=null},findTransition:function(t){for(var n=e.root,r=e.root.next;null!==r&&!t(r);)n=r,r=r.next;return{before:n===e.root?null:n,after:r,insert:function(e){return e.prev=n,e.next=r,n.next=e,null!==r&&(r.prev=e),e}}}};return e},node:function(e){return e.prev=null,e.next=null,e.remove=function(){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),e.prev=null,e.next=null},e}}})),ude=Z(((e,t)=>{var n=lde();t.exports=function(e,t,r){function i(e,t){return{id:r?r.segmentId():-1,start:e,end:t,myFill:{above:null,below:null},otherFill:null}}function a(e,t,n){return{id:r?r.segmentId():-1,start:e,end:t,myFill:{above:n.myFill.above,below:n.myFill.below},otherFill:null}}var s=n.create();function o(e,n){s.insertBefore(e,(function(r){var i=function(e,n,r,i,a,s){var o=t.pointsCompare(n,a);return 0!==o?o:t.pointsSame(r,s)?0:e!==i?e?1:-1:t.pointAboveOrOnLine(r,i?a:s,i?s:a)?1:-1}(e.isStart,e.pt,n,r.isStart,r.pt,r.other.pt);return i<0}))}function l(e,t){var r=function(e,t){var r=n.node({isStart:!0,pt:e.start,seg:e,primary:t,other:null,status:null});return o(r,e.end),r}(e,t);return function(e,t,r){var i=n.node({isStart:!1,pt:t.end,seg:t,primary:r,other:e,status:null});e.other=i,o(i,e.pt)}(r,e,t),r}function h(e,t){var n=a(t,e.seg.end,e.seg);return function(e,t){r&&r.segmentChop(e.seg,t),e.other.remove(),e.seg.end=t,e.other.pt=t,o(e.other,e.pt)}(e,t),l(n,e.primary)}function u(i,a){var o=n.create();function l(e){return o.findTransition((function(n){var r=function(e,n){var r=e.seg.start,i=e.seg.end,a=n.seg.start,s=n.seg.end;return t.pointsCollinear(r,a,s)?t.pointsCollinear(i,a,s)||t.pointAboveOrOnLine(i,a,s)?1:-1:t.pointAboveOrOnLine(r,a,s)?1:-1}(e,n.ev);return r>0}))}function u(e,n){var i=e.seg,a=n.seg,s=i.start,o=i.end,l=a.start,u=a.end;r&&r.checkIntersection(i,a);var c=t.linesIntersect(s,o,l,u);if(!1===c){if(!t.pointsCollinear(s,o,l)||t.pointsSame(s,u)||t.pointsSame(o,l))return!1;var d=t.pointsSame(s,l),p=t.pointsSame(o,u);if(d&&p)return n;var f=!d&&t.pointBetween(s,l,u),m=!p&&t.pointBetween(o,l,u);if(d)return m?h(n,o):h(e,u),n;f&&(p||(m?h(n,o):h(e,u)),h(n,s))}else 0===c.alongA&&(-1===c.alongB?h(e,l):0===c.alongB?h(e,c.pt):1===c.alongB&&h(e,u)),0===c.alongB&&(-1===c.alongA?h(n,s):0===c.alongA?h(n,c.pt):1===c.alongA&&h(n,o));return!1}for(var c=[];!s.isEmpty();){var d=s.getHead();if(r&&r.vert(d.pt[0]),d.isStart){let t=function(){if(f){var e=u(d,f);if(e)return e}return!!m&&u(d,m)};r&&r.segmentNew(d.seg,d.primary);var p=l(d),f=p.before?p.before.ev:null,m=p.after?p.after.ev:null;r&&r.tempStatus(d.seg,!!f&&f.seg,!!m&&m.seg);var g=t();if(g){var v;if(e)(v=null===d.seg.myFill.below||d.seg.myFill.above!==d.seg.myFill.below)&&(g.seg.myFill.above=!g.seg.myFill.above);else g.seg.otherFill=d.seg.myFill;r&&r.segmentUpdate(g.seg),d.other.remove(),d.remove()}if(s.getHead()!==d){r&&r.rewind(d.seg);continue}if(e)v=null===d.seg.myFill.below||d.seg.myFill.above!==d.seg.myFill.below,d.seg.myFill.below=m?m.seg.myFill.above:i,d.seg.myFill.above=v?!d.seg.myFill.below:d.seg.myFill.below;else if(null===d.seg.otherFill){var y;y=m?d.primary===m.primary?m.seg.otherFill.above:m.seg.myFill.above:d.primary?a:i,d.seg.otherFill={above:y,below:y}}r&&r.status(d.seg,!!f&&f.seg,!!m&&m.seg),d.other.status=p.insert(n.node({ev:d}))}else{var x=d.status;if(null===x)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(o.exists(x.prev)&&o.exists(x.next)&&u(x.prev.ev,x.next.ev),r&&r.statusRemove(x.ev.seg),x.remove(),!d.primary){var b=d.seg.myFill;d.seg.myFill=d.seg.otherFill,d.seg.otherFill=b}c.push(d.seg)}s.getHead().remove()}return r&&r.done(),c}return e?{addRegion:function(e){for(var n,r=e[e.length-1],a=0;a<e.length;a++){n=r,r=e[a];var s=t.pointsCompare(n,r);0!==s&&l(i(s<0?n:r,s<0?r:n),!0)}},calculate:function(e){return u(e,!1)}}:{calculate:function(e,t,n,r){return e.forEach((function(e){l(a(e.start,e.end,e),!0)})),n.forEach((function(e){l(a(e.start,e.end,e),!1)})),u(t,r)}}}})),fde=Z(((e,t)=>{t.exports=function(e,t,n){var r=[],i=[];return e.forEach((function(e){var a=e.start,s=e.end;if(t.pointsSame(a,s))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{n&&n.chainStart(e);for(var o={index:0,matches_head:!1,matches_pt1:!1},l={index:0,matches_head:!1,matches_pt1:!1},h=o,u=0;u<r.length;u++){var c=(g=r[u])[0],d=(g[1],g[g.length-1]);g[g.length-2];if(t.pointsSame(c,a)){if(M(u,!0,!0))break}else if(t.pointsSame(c,s)){if(M(u,!0,!1))break}else if(t.pointsSame(d,a)){if(M(u,!1,!0))break}else if(t.pointsSame(d,s)&&M(u,!1,!1))break}if(h===o)return r.push([a,s]),void(n&&n.chainNew(a,s));if(h===l){n&&n.chainMatch(o.index);var p=o.index,f=o.matches_pt1?s:a,m=o.matches_head,g=r[p],v=m?g[0]:g[g.length-1],y=m?g[1]:g[g.length-2],x=m?g[g.length-1]:g[0],b=m?g[g.length-2]:g[1];return t.pointsCollinear(y,v,f)&&(m?(n&&n.chainRemoveHead(o.index,f),g.shift()):(n&&n.chainRemoveTail(o.index,f),g.pop()),v=y),t.pointsSame(x,f)?(r.splice(p,1),t.pointsCollinear(b,x,v)&&(m?(n&&n.chainRemoveTail(o.index,v),g.pop()):(n&&n.chainRemoveHead(o.index,v),g.shift())),n&&n.chainClose(o.index),void i.push(g)):void(m?(n&&n.chainAddHead(o.index,f),g.unshift(f)):(n&&n.chainAddTail(o.index,f),g.push(f)))}var _=o.index,w=l.index;n&&n.chainConnect(_,w);var S=r[_].length<r[w].length;o.matches_head?l.matches_head?S?(T(_),E(_,w)):(T(w),E(w,_)):E(w,_):l.matches_head?E(_,w):S?(T(_),E(w,_)):(T(w),E(_,w))}function M(e,t,n){return h.index=e,h.matches_head=t,h.matches_pt1=n,h===o?(h=l,!1):(h=null,!0)}function T(e){n&&n.chainReverse(e),r[e].reverse()}function E(e,i){var a=r[e],s=r[i],o=a[a.length-1],l=a[a.length-2],h=s[0],u=s[1];t.pointsCollinear(l,o,h)&&(n&&n.chainRemoveTail(e,o),a.pop(),o=l),t.pointsCollinear(o,h,u)&&(n&&n.chainRemoveHead(i,h),s.shift()),n&&n.chainJoin(e,i),r[e]=a.concat(s),r.splice(i,1)}})),i}})),pde=Z(((e,t)=>{function n(e,t,n){var r=[];return e.forEach((function(e){var i=(e.myFill.above?8:0)+(e.myFill.below?4:0)+(e.otherFill&&e.otherFill.above?2:0)+(e.otherFill&&e.otherFill.below?1:0);0!==t[i]&&r.push({id:n?n.segmentId():-1,start:e.start,end:e.end,myFill:{above:1===t[i],below:2===t[i]},otherFill:null})})),n&&n.selected(r),r}var r={union:function(e,t){return n(e,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],t)},intersect:function(e,t){return n(e,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],t)},difference:function(e,t){return n(e,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],t)},differenceRev:function(e,t){return n(e,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],t)},xor:function(e,t){return n(e,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],t)}};t.exports=r})),gde=Z(((e,t)=>{var n={toPolygon:function(e,t){function n(t){if(t.length<=0)return e.segments({inverted:!1,regions:[]});function n(t){var n=t.slice(0,t.length-1);return e.segments({inverted:!1,regions:[n]})}for(var r=n(t[0]),i=1;i<t.length;i++)r=e.selectDifference(e.combine(r,n(t[i])));return r}if("Polygon"===t.type)return e.polygon(n(t.coordinates));if("MultiPolygon"===t.type){for(var r=e.segments({inverted:!1,regions:[]}),i=0;i<t.coordinates.length;i++)r=e.selectUnion(e.combine(r,n(t.coordinates[i])));return e.polygon(r)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(e,t,n){function r(e,n){return t.pointInsideRegion([.5*(e[0][0]+e[1][0]),.5*(e[0][1]+e[1][1])],n)}function i(e){return{region:e,children:[]}}n=e.polygon(e.segments(n));var a=i(null);function s(e,t){for(var n=0;n<e.children.length;n++){if(r(t,(o=e.children[n]).region))return void s(o,t)}var a=i(t);for(n=0;n<e.children.length;n++){var o;r((o=e.children[n]).region,t)&&(a.children.push(o),e.children.splice(n,1),n--)}e.children.push(a)}for(var o=0;o<n.regions.length;o++){var l=n.regions[o];l.length<3||s(a,l)}function h(e,t){for(var n=0,r=e[e.length-1][0],i=e[e.length-1][1],a=[],s=0;s<e.length;s++){var o=e[s][0],l=e[s][1];a.push([o,l]),n+=l*r-o*i,r=o,i=l}return n<0!==t&&a.reverse(),a.push([a[0][0],a[0][1]]),a}var u=[];function c(e){var t=[h(e.region,!1)];u.push(t);for(var n=0;n<e.children.length;n++)t.push(d(e.children[n]))}function d(e){for(var t=0;t<e.children.length;t++)c(e.children[t]);return h(e.region,!0)}for(o=0;o<a.children.length;o++)c(a.children[o]);return u.length<=0?{type:"Polygon",coordinates:[]}:1==u.length?{type:"Polygon",coordinates:u[0]}:{type:"MultiPolygon",coordinates:u}}};t.exports=n})),bde=Z(((e,t)=>{var n,r=ide(),i=ade(),a=ude(),s=fde(),o=pde(),l=gde(),h=!1,u=i();function c(e,t,r){var i=n.segments(e),a=n.segments(t),s=r(n.combine(i,a));return n.polygon(s)}n={buildLog:function(e){return!0===e?h=r():!1===e&&(h=!1),!1!==h&&h.list},epsilon:function(e){return u.epsilon(e)},segments:function(e){var t=a(!0,u,h);return e.regions.forEach(t.addRegion),{segments:t.calculate(e.inverted),inverted:e.inverted}},combine:function(e,t){return{combined:a(!1,u,h).calculate(e.segments,e.inverted,t.segments,t.inverted),inverted1:e.inverted,inverted2:t.inverted}},selectUnion:function(e){return{segments:o.union(e.combined,h),inverted:e.inverted1||e.inverted2}},selectIntersect:function(e){return{segments:o.intersect(e.combined,h),inverted:e.inverted1&&e.inverted2}},selectDifference:function(e){return{segments:o.difference(e.combined,h),inverted:e.inverted1&&!e.inverted2}},selectDifferenceRev:function(e){return{segments:o.differenceRev(e.combined,h),inverted:!e.inverted1&&e.inverted2}},selectXor:function(e){return{segments:o.xor(e.combined,h),inverted:e.inverted1!==e.inverted2}},polygon:function(e){return{regions:s(e.segments,u,h),inverted:e.inverted}},polygonFromGeoJSON:function(e){return l.toPolygon(n,e)},polygonToGeoJSON:function(e){return l.fromPolygon(n,u,e)},union:function(e,t){return c(e,t,n.selectUnion)},intersect:function(e,t){return c(e,t,n.selectIntersect)},difference:function(e,t){return c(e,t,n.selectDifference)},differenceRev:function(e,t){return c(e,t,n.selectDifferenceRev)},xor:function(e,t){return c(e,t,n.selectXor)}},"object"==typeof window&&(window.PolyBool=n),t.exports=n})),Jde=Z(((e,t)=>{var n,r;n=e,r=function(){"use strict";function e(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var t=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function n(e,t){return e>t?1:e<t?-1:0}function r(e,n,r){for(var i=new t(null,null),a=i,s=i;;){var o=r(e,n.key);if(o<0){if(null===n.left)break;if(r(e,n.left.key)<0){var l=n.left;if(n.left=l.right,l.right=n,null===(n=l).left)break}s.left=n,s=n,n=n.left}else{if(!(o>0))break;if(null===n.right)break;if(r(e,n.right.key)>0&&(l=n.right,n.right=l.left,l.left=n,null===(n=l).right))break;a.right=n,a=n,n=n.right}}return a.right=n.left,s.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,n,i,a){var s=new t(e,n);if(null===i)return s.left=s.right=null,s;var o=a(e,(i=r(e,i,a)).key);return o<0?(s.left=i.left,s.right=i,i.left=null):o>=0&&(s.right=i.right,s.left=i,i.right=null),s}function a(e,t,n){var i=null,a=null;if(t){var s=n((t=r(e,t,n)).key,e);0===s?(i=t.left,a=t.right):s<0?(a=t.right,t.right=null,i=t):(i=t.left,t.left=null,a=t)}return{left:i,right:a}}function s(e,t,n,r,i){if(e){r(t+(n?"âââ ":"âââ ")+i(e)+"\n");var a=t+(n?"    ":"â   ");e.left&&s(e.left,a,!1,r,i),e.right&&s(e.right,a,!0,r,i)}}var o=function(){function o(e){void 0===e&&(e=n),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=i(e,t,this._root,this._comparator)},o.prototype.add=function(e,n){var i=new t(e,n);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var a=this._comparator,s=r(e,this._root,a),o=a(e,s.key);return 0===o?this._root=s:(o<0?(i.left=s.left,i.right=s,s.left=null):o>0&&(i.right=s.right,i.left=s,s.right=null),this._size++,this._root=i),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,n){var i;return null===t?null:0===n(e,(t=r(e,t,n)).key)?(null===t.left?i=t.right:(i=r(e,t.left,n)).right=t.right,this._size--,i):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=r(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=r(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},o.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},o.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},o.prototype.range=function(e,t,n,r){for(var i=[],a=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(a((s=i.pop()).key,t)>0)break;if(a(s.key,e)>=0&&n.call(r,s))return this;s=s.right}return this},o.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},o.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},o.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},o.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return function(e){for(var n=e,r=[],i=!1,a=new t(null,null),s=a;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=s=s.next=r.pop()).right:i=!0;return s.next=null,a.next}(this._root)},o.prototype.load=function(e,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=e.length,a=this._comparator;if(r&&u(e,n,0,i-1,a),null===this._root)this._root=l(e,n,0,i),this._size=i;else{var s=function(e,n,r){for(var i=new t(null,null),a=i,s=e,o=n;null!==s&&null!==o;)r(s.key,o.key)<0?(a.next=s,s=s.next):(a.next=o,o=o.next),a=a.next;return null!==s?a.next=s:null!==o&&(a.next=o),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,a=0;a<e.length;a++)i=i.next=new t(e[a],n[a]);return i.next=null,r.next}(e,n),a);i=this._size+i,this._root=h({head:s},0,i)}return this},o.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return s(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},o.prototype.update=function(e,t,n){var s=this._comparator,o=a(e,this._root,s),l=o.left,h=o.right;s(e,t)<0?h=i(t,n,h,s):l=i(t,n,l,s),this._root=function(e,t,n){return null===t?e:(null===e||((t=r(e.key,t,n)).left=e),t)}(l,h,s)},o.prototype.split=function(e){return a(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var t,n,r;return e(this,(function(e){switch(e.label){case 0:t=this._root,n=[],r=!1,e.label=1;case 1:return r?[3,6]:null===t?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return 0===n.length?[3,4]:[4,t=n.pop()];case 3:return e.sent(),t=t.right,[3,5];case 4:r=!0,e.label=5;case 5:return[3,1];case 6:return[2]}}))},o}();function l(e,n,r,i){var a=i-r;if(a>0){var s=r+Math.floor(a/2),o=e[s],h=n[s],u=new t(o,h);return u.left=l(e,n,r,s),u.right=l(e,n,s+1,i),u}return null}function h(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),a=h(e,t,i),s=e.head;return s.left=a,e.head=e.head.next,s.right=h(e,i+1,n),s}return null}function u(e,t,n,r,i){if(!(n>=r)){for(var a=e[n+r>>1],s=n-1,o=r+1;;){do{s++}while(i(e[s],a)<0);do{o--}while(i(e[o],a)>0);if(s>=o)break;var l=e[s];e[s]=e[o],e[o]=l,l=t[s],t[s]=t[o],t[o]=l}u(e,t,n,o,i),u(e,t,o+1,r,i)}}let c=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,d=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;let n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},p=Number.EPSILON;void 0===p&&(p=Math.pow(2,-52));let f=p*p,m=(e,t)=>{if(-p<e&&e<p&&-p<t&&t<p)return 0;let n=e-t;return n*n<f*e*t?0:e<t?-1:1};class g{constructor(){this.tree=new o,this.round(0)}round(e){let t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===m(t.key,n.key))return this.tree.remove(e),n.key;let r=this.tree.next(t);return null!==r&&0===m(t.key,r.key)?(this.tree.remove(e),r.key):e}}let v=new class{constructor(){this.reset()}reset(){this.xRounder=new g,this.yRounder=new g}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}},y=11102230246251565e-32,x=134217729,b=(3+8*y)*y;function _(e,t,n,r,i){let a,s,o,l,h=t[0],u=r[0],c=0,d=0;u>h==u>-h?(a=h,h=t[++c]):(a=u,u=r[++d]);let p=0;if(c<e&&d<n)for(u>h==u>-h?(s=h+a,o=a-(s-h),h=t[++c]):(s=u+a,o=a-(s-u),u=r[++d]),a=s,0!==o&&(i[p++]=o);c<e&&d<n;)u>h==u>-h?(s=a+h,l=s-a,o=a-(s-l)+(h-l),h=t[++c]):(s=a+u,l=s-a,o=a-(s-l)+(u-l),u=r[++d]),a=s,0!==o&&(i[p++]=o);for(;c<e;)s=a+h,l=s-a,o=a-(s-l)+(h-l),h=t[++c],a=s,0!==o&&(i[p++]=o);for(;d<n;)s=a+u,l=s-a,o=a-(s-l)+(u-l),u=r[++d],a=s,0!==o&&(i[p++]=o);return(0!==a||0===p)&&(i[p++]=a),p}function w(e){return new Float64Array(e)}let S=(2+12*y)*y,M=(9+64*y)*y*y,T=w(4),E=w(8),A=w(12),C=w(16),P=w(4);function I(e,t,n,r,i,a){let s=(t-a)*(n-i),o=(e-i)*(r-a),l=s-o,h=Math.abs(s+o);return Math.abs(l)>=33306690738754716e-32*h?l:-function(e,t,n,r,i,a,s){let o,l,h,u,c,d,p,f,m,g,v,y,w,I,R,L,O,D,k=e-i,N=n-i,F=t-a,U=r-a;I=k*U,d=x*k,p=d-(d-k),f=k-p,d=x*U,m=d-(d-U),g=U-m,R=f*g-(I-p*m-f*m-p*g),L=F*N,d=x*F,p=d-(d-F),f=F-p,d=x*N,m=d-(d-N),g=N-m,O=f*g-(L-p*m-f*m-p*g),v=R-O,c=R-v,T[0]=R-(v+c)+(c-O),y=I+v,c=y-I,w=I-(y-c)+(v-c),v=w-L,c=w-v,T[1]=w-(v+c)+(c-L),D=y+v,c=D-y,T[2]=y-(D-c)+(v-c),T[3]=D;let B=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,T),z=S*s;if(B>=z||-B>=z||(c=e-k,o=e-(k+c)+(c-i),c=n-N,h=n-(N+c)+(c-i),c=t-F,l=t-(F+c)+(c-a),c=r-U,u=r-(U+c)+(c-a),0===o&&0===l&&0===h&&0===u)||(z=M*s+b*Math.abs(B),B+=k*u+U*o-(F*h+N*l),B>=z||-B>=z))return B;I=o*U,d=x*o,p=d-(d-o),f=o-p,d=x*U,m=d-(d-U),g=U-m,R=f*g-(I-p*m-f*m-p*g),L=l*N,d=x*l,p=d-(d-l),f=l-p,d=x*N,m=d-(d-N),g=N-m,O=f*g-(L-p*m-f*m-p*g),v=R-O,c=R-v,P[0]=R-(v+c)+(c-O),y=I+v,c=y-I,w=I-(y-c)+(v-c),v=w-L,c=w-v,P[1]=w-(v+c)+(c-L),D=y+v,c=D-y,P[2]=y-(D-c)+(v-c),P[3]=D;let H=_(4,T,4,P,E);I=k*u,d=x*k,p=d-(d-k),f=k-p,d=x*u,m=d-(d-u),g=u-m,R=f*g-(I-p*m-f*m-p*g),L=F*h,d=x*F,p=d-(d-F),f=F-p,d=x*h,m=d-(d-h),g=h-m,O=f*g-(L-p*m-f*m-p*g),v=R-O,c=R-v,P[0]=R-(v+c)+(c-O),y=I+v,c=y-I,w=I-(y-c)+(v-c),v=w-L,c=w-v,P[1]=w-(v+c)+(c-L),D=y+v,c=D-y,P[2]=y-(D-c)+(v-c),P[3]=D;let V=_(H,E,4,P,A);I=o*u,d=x*o,p=d-(d-o),f=o-p,d=x*u,m=d-(d-u),g=u-m,R=f*g-(I-p*m-f*m-p*g),L=l*h,d=x*l,p=d-(d-l),f=l-p,d=x*h,m=d-(d-h),g=h-m,O=f*g-(L-p*m-f*m-p*g),v=R-O,c=R-v,P[0]=R-(v+c)+(c-O),y=I+v,c=y-I,w=I-(y-c)+(v-c),v=w-L,c=w-v,P[1]=w-(v+c)+(c-L),D=y+v,c=D-y,P[2]=y-(D-c)+(v-c),P[3]=D;let j=_(V,A,4,P,C);return C[j-1]}(e,t,n,r,i,a,h)}let R=(e,t)=>e.x*t.y-e.y*t.x,L=(e,t)=>e.x*t.x+e.y*t.y,O=(e,t,n)=>{let r=I(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},D=e=>Math.sqrt(L(e,e)),k=(e,t,n)=>{let r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return R(i,r)/D(i)/D(r)},N=(e,t,n)=>{let r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return L(i,r)/D(i)/D(r)},F=(e,t,n)=>0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n},U=(e,t,n)=>0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)};class B{static compare(e,t){let n=B.comparePoints(e.point,t.point);return 0!==n?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:H.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let t=e.point.events;for(let e=0,n=t.length;e<n;e++){let n=t[e];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let n=this.point.events[t];if(void 0===n.segment.consumedBy)for(let r=t+1;r<e;r++){let e=this.point.events[r];void 0===e.consumedBy&&n.otherSE.point.events===e.otherSE.point.events&&n.segment.consume(e.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,n=this.point.events.length;t<n;t++){let n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let t=new Map,n=n=>{let r=n.otherSE;t.set(n,{sine:k(this.point,e.point,r.point),cosine:N(this.point,e.point,r.point)})};return(e,r)=>{t.has(e)||n(e),t.has(r)||n(r);let{sine:i,cosine:a}=t.get(e),{sine:s,cosine:o}=t.get(r);return i>=0&&s>=0?a<o?1:a>o?-1:0:i<0&&s<0?a<o?-1:a>o?1:0:s<i?-1:s>i?1:0}}}let z=0;class H{static compare(e,t){let n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,a=t.rightSE.point.x;if(a<n)return 1;if(i<r)return-1;let s=e.leftSE.point.y,o=t.leftSE.point.y,l=e.rightSE.point.y,h=t.rightSE.point.y;if(n<r){if(o<s&&o<l)return 1;if(o>s&&o>l)return-1;let n=e.comparePoint(t.leftSE.point);if(n<0)return 1;if(n>0)return-1;let r=t.comparePoint(e.rightSE.point);return 0!==r?r:-1}if(n>r){if(s<o&&s<h)return-1;if(s>o&&s>h)return 1;let n=t.comparePoint(e.leftSE.point);if(0!==n)return n;let r=e.comparePoint(t.rightSE.point);return r<0?1:r>0?-1:1}if(s<o)return-1;if(s>o)return 1;if(i<a){let n=t.comparePoint(e.rightSE.point);if(0!==n)return n}if(i>a){let n=e.comparePoint(t.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(i!==a){let e=l-s,t=i-n,u=h-o,c=a-r;if(e>t&&u<c)return 1;if(e<t&&u>c)return-1}return i>a?1:i<a||l<h?-1:l>h?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,r){this.id=++z,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=r}static fromRing(e,t,n){let r,i,a,s=B.comparePoints(e,t);if(s<0)r=e,i=t,a=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);r=t,i=e,a=-1}let o=new B(r,!0),l=new B(i,!1);return new H(o,l,[n],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;let t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;let i=(e.y-t.y)/r.y,a=t.x+i*r.x;if(e.x===a)return 0;let s=(e.x-t.x)/r.x,o=t.y+s*r.y;return e.y===o?0:e.y<o?-1:1}getIntersection(e){let t=this.bbox(),n=e.bbox(),r=d(t,n);if(null===r)return null;let i=this.leftSE.point,a=this.rightSE.point,s=e.leftSE.point,o=e.rightSE.point,l=c(t,s)&&0===this.comparePoint(s),h=c(n,i)&&0===e.comparePoint(i),u=c(t,o)&&0===this.comparePoint(o),p=c(n,a)&&0===e.comparePoint(a);if(h&&l)return p&&!u?a:!p&&u?o:null;if(h)return u&&i.x===o.x&&i.y===o.y?null:i;if(l)return p&&a.x===s.x&&a.y===s.y?null:s;if(p&&u)return null;if(p)return a;if(u)return o;let f=((e,t,n,r)=>{if(0===t.x)return U(n,r,e.x);if(0===r.x)return U(e,t,n.x);if(0===t.y)return F(n,r,e.y);if(0===r.y)return F(e,t,n.y);let i=R(t,r);if(0==i)return null;let a={x:n.x-e.x,y:n.y-e.y},s=R(a,t)/i,o=R(a,r)/i;return{x:(e.x+o*t.x+(n.x+s*r.x))/2,y:(e.y+o*t.y+(n.y+s*r.y))/2}})(i,this.vector(),s,e.vector());return null!==f&&c(r,f)?v.round(f.x,f.y):null}split(e){let t=[],n=void 0!==e.events,r=new B(e,!0),i=new B(e,!1),a=this.rightSE;this.replaceRightSE(i),t.push(i),t.push(r);let s=new H(r,a,this.rings.slice(),this.windings.slice());return B.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),B.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(r.checkForConsuming(),i.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;let r=H.compare(t,n);if(0!==r){if(r>0){let e=t;t=n,n=e}if(t.prev===n){let e=t;t=n,n=e}for(let e=0,r=n.rings.length;e<r;e++){let r=n.rings[e],i=n.windings[e],a=t.rings.indexOf(r);-1===a?(t.rings.push(r),t.windings.push(i)):t.windings[a]+=i}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let e=0,r=this.rings.length;e<r;e++){let r=this.rings[e],i=this.windings[e],a=t.indexOf(r);-1===a?(t.push(r),n.push(i)):n[a]+=i}let i=[],a=[];for(let e=0,r=t.length;e<r;e++){if(0===n[e])continue;let r=t[e],s=r.poly;if(-1===a.indexOf(s))if(r.isExterior)i.push(s);else{-1===a.indexOf(s)&&a.push(s);let e=i.indexOf(r.poly);-1!==e&&i.splice(e,1)}}for(let e=0,t=i.length;e<t;e++){let t=i[e].multiPoly;-1===r.indexOf(t)&&r.push(t)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(K.type){case"union":{let n=0===e.length,r=0===t.length;this._isInResult=n!==r;break}case"intersection":{let n,r;e.length<t.length?(n=e.length,r=t.length):(n=t.length,r=e.length),this._isInResult=r===K.numMultiPolys&&n<r;break}case"xor":{let n=Math.abs(e.length-t.length);this._isInResult=n%2==1;break}case"difference":{let n=e=>1===e.length&&e[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${K.type}`)}return this._isInResult}}class V{constructor(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=v.round(e[0][0],e[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let t=1,n=e.length;t<n;t++){if("number"!=typeof e[t][0]||"number"!=typeof e[t][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let n=v.round(e[t][0],e[t][1]);n.x===i.x&&n.y===i.y||(this.segments.push(H.fromRing(i,n,this)),n.x<this.bbox.ll.x&&(this.bbox.ll.x=n.x),n.y<this.bbox.ll.y&&(this.bbox.ll.y=n.y),n.x>this.bbox.ur.x&&(this.bbox.ur.x=n.x),n.y>this.bbox.ur.y&&(this.bbox.ur.y=n.y),i=n)}(r.x!==i.x||r.y!==i.y)&&this.segments.push(H.fromRing(i,r,this))}getSweepEvents(){let e=[];for(let t=0,n=this.segments.length;t<n;t++){let n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}}class j{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new V(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,n=e.length;t<n;t++){let n=new V(e[t],this,!1);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){let n=this.interiorRings[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class G{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let t=0,n=e.length;t<n;t++){let n=new j(e[t],this);n.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,n=this.polys.length;t<n;t++){let n=this.polys[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}}class W{static factory(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r.isInResult()||r.ringOut)continue;let i=null,a=r.leftSE,s=r.rightSE,o=[a],l=a.point,h=[];for(;i=a,a=s,o.push(a),a.point!==l;)for(;;){let e=a.getAvailableLinkedEvents();if(0===e.length){let e=o[0].point,t=o[o.length-1].point;throw new Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(1===e.length){s=e[0].otherSE;break}let n=null;for(let e=0,t=h.length;e<t;e++)if(h[e].point===a.point){n=e;break}if(null!==n){let e=h.splice(n)[0],r=o.splice(e.index);r.unshift(r[0].otherSE),t.push(new W(r.reverse()));continue}h.push({index:o.length,point:a.point});let r=a.getLeftmostComparator(i);s=e.sort(r)[0].otherSE;break}t.push(new W(o))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point,t=[e];for(let n=1,r=this.events.length-1;n<r;n++){let r=this.events[n].point,i=this.events[n+1].point;0!==O(r,e,i)&&(t.push(r),e=r)}if(1===t.length)return null;let n=t[0],r=t[1];0===O(n,e,r)&&t.shift(),t.push(t[0]);let i=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,o=[];for(let e=a;e!=s;e+=i)o.push([t[e].x,t[e].y]);return o}isExteriorRing(){if(void 0===this._isExteriorRing){let e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,n=this.events.length;t<n;t++){let n=this.events[t];B.compare(e,n)>0&&(e=n)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class q{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(let t=0,n=this.interiorRings.length;t<n;t++){let n=this.interiorRings[t].getGeom();null!==n&&e.push(n)}return e}}class X{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,n=this.polys.length;t<n;t++){let n=this.polys[t].getGeom();null!==n&&e.push(n)}return e}_composePolys(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r.poly)if(r.isExteriorRing())t.push(new q(r));else{let e=r.enclosingRing();e.poly||t.push(new q(e)),e.poly.addInterior(r)}}return t}}class Y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.compare;this.queue=e,this.tree=new o(t),this.segments=[]}process(e){let t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;let r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let i,a,s=r,o=r;for(;void 0===i;)s=this.tree.prev(s),null===s?i=null:void 0===s.key.consumedBy&&(i=s.key);for(;void 0===a;)o=this.tree.next(o),null===o?a=null:void 0===o.key.consumedBy&&(a=o.key);if(e.isLeft){let r=null;if(i){let e=i.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(r=e),!i.isAnEndpoint(e))){let t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}let s=null;if(a){let e=a.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(s=e),!a.isAnEndpoint(e))){let t=this._splitSafely(a,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}if(null!==r||null!==s){let e=null;e=null===r?s:null===s||B.comparePoints(r,s)<=0?r:s,this.queue.remove(t.rightSE),n.push(t.rightSE);let i=t.split(e);for(let e=0,t=i.length;e<t;e++)n.push(i[e])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=i)}else{if(i&&a){let e=i.getIntersection(a);if(null!==e){if(!i.isAnEndpoint(e)){let t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}if(!a.isAnEndpoint(e)){let t=this._splitSafely(a,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);let n=e.rightSE;this.queue.remove(n);let r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}}let Z="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,J="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,K=new class{run(e,t,n){K.type=e,v.reset();let r=[new G(t,!0)];for(let e=0,t=n.length;e<t;e++)r.push(new G(n[e],!1));if(K.numMultiPolys=r.length,"difference"===K.type){let e=r[0],t=1;for(;t<r.length;)null!==d(r[t].bbox,e.bbox)?t++:r.splice(t,1)}if("intersection"===K.type)for(let e=0,t=r.length;e<t;e++){let t=r[e];for(let n=e+1,i=r.length;n<i;n++)if(null===d(t.bbox,r[n].bbox))return[]}let i=new o(B.compare);for(let e=0,t=r.length;e<t;e++){let t=r[e].getSweepEvents();for(let e=0,n=t.length;e<n;e++)if(i.insert(t[e]),i.size>Z)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}let a=new Y(i),s=i.size,l=i.pop();for(;l;){let e=l.key;if(i.size===s){let t=e.segment;throw new Error(`Unable to pop() ${e.isLeft?"left":"right"} SweepEvent [${e.point.x}, ${e.point.y}] from segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] from queue.`)}if(i.size>Z)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(a.segments.length>J)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");let t=a.process(e);for(let e=0,n=t.length;e<n;e++){let n=t[e];void 0===n.consumedBy&&i.insert(n)}s=i.size,l=i.pop()}v.reset();let h=W.factory(a.segments);return new X(h).getGeom()}};var Q={union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("difference",e,n)}};return Q},"object"==typeof e&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):(n="undefined"!=typeof globalThis?globalThis:n||self).polygonClipping=r()})),XC=Z(((e,t)=>{(function(){var n,r="Expected a function",i="__lodash_hash_undefined__",a="__lodash_placeholder__",s=16,o=32,l=64,h=128,u=256,c=1/0,d=9007199254740991,p=NaN,f=4294967295,m=[["ary",h],["bind",1],["bindKey",2],["curry",8],["curryRight",s],["flip",512],["partial",o],["partialRight",l],["rearg",u]],g="[object Arguments]",v="[object Array]",y="[object Boolean]",x="[object Date]",b="[object Error]",_="[object Function]",w="[object GeneratorFunction]",S="[object Map]",M="[object Number]",T="[object Object]",E="[object Promise]",A="[object RegExp]",C="[object Set]",P="[object String]",I="[object Symbol]",R="[object WeakMap]",L="[object ArrayBuffer]",O="[object DataView]",D="[object Float32Array]",k="[object Float64Array]",N="[object Int8Array]",F="[object Int16Array]",U="[object Int32Array]",B="[object Uint8Array]",z="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",j=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,W=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,X=/[&<>"']/g,Y=RegExp(q.source),Z=RegExp(X.source),J=/<%-([\s\S]+?)%>/g,K=/<%([\s\S]+?)%>/g,Q=/<%=([\s\S]+?)%>/g,$=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ee=/^\w*$/,te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/[\\^$.*+?()[\]{}|]/g,re=RegExp(ne.source),ie=/^\s+/,ae=/\s/,se=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,he=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ue=/[()=,{}\[\]\/\s]/,ce=/\\(\\)?/g,de=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pe=/\w*$/,fe=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,ve=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,xe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,be=/($^)/,_e=/['\n\r\u2028\u2029\\]/g,we="\\ud800-\\udfff",Se="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Me="\\u2700-\\u27bf",Te="a-z\\xdf-\\xf6\\xf8-\\xff",Ee="A-Z\\xc0-\\xd6\\xd8-\\xde",Ae="\\ufe0e\\ufe0f",Ce="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Pe="['â]",Ie="["+we+"]",Re="["+Ce+"]",Le="["+Se+"]",Oe="\\d+",De="["+Me+"]",ke="["+Te+"]",Ne="[^"+we+Ce+Oe+Me+Te+Ee+"]",Fe="\\ud83c[\\udffb-\\udfff]",Ue="[^"+we+"]",Be="(?:\\ud83c[\\udde6-\\uddff]){2}",ze="[\\ud800-\\udbff][\\udc00-\\udfff]",He="["+Ee+"]",Ve="\\u200d",je="(?:"+ke+"|"+Ne+")",Ge="(?:"+He+"|"+Ne+")",We="(?:['â](?:d|ll|m|re|s|t|ve))?",qe="(?:['â](?:D|LL|M|RE|S|T|VE))?",Xe="(?:"+Le+"|"+Fe+")"+"?",Ye="["+Ae+"]?",Ze=Ye+Xe+("(?:"+Ve+"(?:"+[Ue,Be,ze].join("|")+")"+Ye+Xe+")*"),Je="(?:"+[De,Be,ze].join("|")+")"+Ze,Ke="(?:"+[Ue+Le+"?",Le,Be,ze,Ie].join("|")+")",Qe=RegExp(Pe,"g"),$e=RegExp(Le,"g"),et=RegExp(Fe+"(?="+Fe+")|"+Ke+Ze,"g"),tt=RegExp([He+"?"+ke+"+"+We+"(?="+[Re,He,"$"].join("|")+")",Ge+"+"+qe+"(?="+[Re,He+je,"$"].join("|")+")",He+"?"+je+"+"+We,He+"+"+qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Oe,Je].join("|"),"g"),nt=RegExp("["+Ve+we+Se+Ae+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,it=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],at=-1,st={};st[D]=st[k]=st[N]=st[F]=st[U]=st[B]=st[z]=st[H]=st[V]=!0,st[g]=st[v]=st[L]=st[y]=st[O]=st[x]=st[b]=st[_]=st[S]=st[M]=st[T]=st[A]=st[C]=st[P]=st[R]=!1;var ot={};ot[g]=ot[v]=ot[L]=ot[O]=ot[y]=ot[x]=ot[D]=ot[k]=ot[N]=ot[F]=ot[U]=ot[S]=ot[M]=ot[T]=ot[A]=ot[C]=ot[P]=ot[I]=ot[B]=ot[z]=ot[H]=ot[V]=!0,ot[b]=ot[_]=ot[R]=!1;var lt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ht=parseFloat,ut=parseInt,ct="object"==typeof global&&global&&global.Object===Object&&global,dt="object"==typeof self&&self&&self.Object===Object&&self,pt=ct||dt||Function("return this")(),ft="object"==typeof e&&e&&!e.nodeType&&e,mt=ft&&"object"==typeof t&&t&&!t.nodeType&&t,gt=mt&&mt.exports===ft,vt=gt&&ct.process,yt=function(){try{return mt&&mt.require&&mt.require("util").types||vt&&vt.binding&&vt.binding("util")}catch(e){}}(),xt=yt&&yt.isArrayBuffer,bt=yt&&yt.isDate,_t=yt&&yt.isMap,wt=yt&&yt.isRegExp,St=yt&&yt.isSet,Mt=yt&&yt.isTypedArray;function Tt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Et(e,t,n,r){for(var i=-1,a=null==e?0:e.length;++i<a;){var s=e[i];t(r,s,n(s),e)}return r}function At(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Ct(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Pt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function It(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var s=e[n];t(s,n,e)&&(a[i++]=s)}return a}function Rt(e,t){return!!(null==e?0:e.length)&&Ht(e,t,0)>-1}function Lt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function Ot(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Dt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function kt(e,t,n,r){var i=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}function Nt(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function Ft(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var Ut=Wt("length");function Bt(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function zt(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function Ht(e,t,n){return t==t?function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):zt(e,jt,n)}function Vt(e,t,n,r){for(var i=n-1,a=e.length;++i<a;)if(r(e[i],t))return i;return-1}function jt(e){return e!=e}function Gt(e,t){var n=null==e?0:e.length;return n?Yt(e,t)/n:p}function Wt(e){return function(t){return null==t?n:t[e]}}function qt(e){return function(t){return null==e?n:e[t]}}function Xt(e,t,n,r,i){return i(e,(function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)})),n}function Yt(e,t){for(var r,i=-1,a=e.length;++i<a;){var s=t(e[i]);s!==n&&(r=r===n?s:r+s)}return r}function Zt(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Jt(e){return e&&e.slice(0,pn(e)+1).replace(ie,"")}function Kt(e){return function(t){return e(t)}}function Qt(e,t){return Ot(t,(function(t){return e[t]}))}function $t(e,t){return e.has(t)}function en(e,t){for(var n=-1,r=e.length;++n<r&&Ht(t,e[n],0)>-1;);return n}function tn(e,t){for(var n=e.length;n--&&Ht(t,e[n],0)>-1;);return n}var nn=qt({"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"}),rn=qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(e){return"\\"+lt[e]}function sn(e){return nt.test(e)}function on(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function ln(e,t){return function(n){return e(t(n))}}function hn(e,t){for(var n=-1,r=e.length,i=0,s=[];++n<r;){var o=e[n];(o===t||o===a)&&(e[n]=a,s[i++]=n)}return s}function un(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function cn(e){return sn(e)?function(e){for(var t=et.lastIndex=0;et.test(e);)++t;return t}(e):Ut(e)}function dn(e){return sn(e)?function(e){return e.match(et)||[]}(e):function(e){return e.split("")}(e)}function pn(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var fn=qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var mn=function e(t){var ae,we=(t=null==t?pt:mn.defaults(pt.Object(),t,mn.pick(pt,it))).Array,Se=t.Date,Me=t.Error,Te=t.Function,Ee=t.Math,Ae=t.Object,Ce=t.RegExp,Pe=t.String,Ie=t.TypeError,Re=we.prototype,Le=Te.prototype,Oe=Ae.prototype,De=t["__core-js_shared__"],ke=Le.toString,Ne=Oe.hasOwnProperty,Fe=0,Ue=(ae=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||""))?"Symbol(src)_1."+ae:"",Be=Oe.toString,ze=ke.call(Ae),He=pt._,Ve=Ce("^"+ke.call(Ne).replace(ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=gt?t.Buffer:n,Ge=t.Symbol,We=t.Uint8Array,qe=je?je.allocUnsafe:n,Xe=ln(Ae.getPrototypeOf,Ae),Ye=Ae.create,Ze=Oe.propertyIsEnumerable,Je=Re.splice,Ke=Ge?Ge.isConcatSpreadable:n,et=Ge?Ge.iterator:n,nt=Ge?Ge.toStringTag:n,lt=function(){try{var e=ca(Ae,"defineProperty");return e({},"",{}),e}catch(e){}}(),ct=t.clearTimeout!==pt.clearTimeout&&t.clearTimeout,dt=Se&&Se.now!==pt.Date.now&&Se.now,ft=t.setTimeout!==pt.setTimeout&&t.setTimeout,mt=Ee.ceil,vt=Ee.floor,yt=Ae.getOwnPropertySymbols,Ut=je?je.isBuffer:n,qt=t.isFinite,gn=Re.join,vn=ln(Ae.keys,Ae),yn=Ee.max,xn=Ee.min,bn=Se.now,_n=t.parseInt,wn=Ee.random,Sn=Re.reverse,Mn=ca(t,"DataView"),Tn=ca(t,"Map"),En=ca(t,"Promise"),An=ca(t,"Set"),Cn=ca(t,"WeakMap"),Pn=ca(Ae,"create"),In=Cn&&new Cn,Rn={},Ln=Fa(Mn),On=Fa(Tn),Dn=Fa(En),kn=Fa(An),Nn=Fa(Cn),Fn=Ge?Ge.prototype:n,Un=Fn?Fn.valueOf:n,Bn=Fn?Fn.toString:n;function zn(e){if(eo(e)&&!js(e)&&!(e instanceof Gn)){if(e instanceof jn)return e;if(Ne.call(e,"__wrapped__"))return Ua(e)}return new jn(e)}var Hn=function(){function e(){}return function(t){if(!$s(t))return{};if(Ye)return Ye(t);e.prototype=t;var r=new e;return e.prototype=n,r}}();function Vn(){}function jn(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=n}function Gn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Wn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function qn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Xn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Yn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Xn;++t<n;)this.add(e[t])}function Zn(e){var t=this.__data__=new qn(e);this.size=t.size}function Jn(e,t){var n=js(e),r=!n&&Vs(e),i=!n&&!r&&Xs(e),a=!n&&!r&&!i&&lo(e),s=n||r||i||a,o=s?Zt(e.length,Pe):[],l=o.length;for(var h in e)(t||Ne.call(e,h))&&(!s||!("length"==h||i&&("offset"==h||"parent"==h)||a&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||ya(h,l)))&&o.push(h);return o}function Kn(e){var t=e.length;return t?e[Yr(0,t-1)]:n}function Qn(e,t){return Da(Pi(e),or(t,0,e.length))}function $n(e){return Da(Pi(e))}function er(e,t,r){(r!==n&&!Bs(e[t],r)||r===n&&!(t in e))&&ar(e,t,r)}function tr(e,t,r){var i=e[t];(!Ne.call(e,t)||!Bs(i,r)||r===n&&!(t in e))&&ar(e,t,r)}function nr(e,t){for(var n=e.length;n--;)if(Bs(e[n][0],t))return n;return-1}function rr(e,t,n,r){return dr(e,(function(e,i,a){t(r,e,n(e),a)})),r}function ir(e,t){return e&&Ii(t,Ro(t),e)}function ar(e,t,n){"__proto__"==t&&lt?lt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function sr(e,t){for(var r=-1,i=t.length,a=we(i),s=null==e;++r<i;)a[r]=s?n:Eo(e,t[r]);return a}function or(e,t,r){return e==e&&(r!==n&&(e=e<=r?e:r),t!==n&&(e=e>=t?e:t)),e}function lr(e,t,r,i,a,s){var o,l=1&t,h=2&t,u=4&t;if(r&&(o=a?r(e,i,a,s):r(e)),o!==n)return o;if(!$s(e))return e;var c=js(e);if(c){if(o=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Ne.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!l)return Pi(e,o)}else{var d=fa(e),p=d==_||d==w;if(Xs(e))return Si(e,l);if(d==T||d==g||p&&!a){if(o=h||p?{}:ga(e),!l)return h?function(e,t){return Ii(e,pa(e),t)}(e,function(e,t){return e&&Ii(t,Lo(t),e)}(o,e)):function(e,t){return Ii(e,da(e),t)}(e,ir(o,e))}else{if(!ot[d])return a?e:{};o=function(e,t,n){var r=e.constructor;switch(t){case L:return Mi(e);case y:case x:return new r(+e);case O:return function(e,t){var n=t?Mi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case D:case k:case N:case F:case U:case B:case z:case H:case V:return Ti(e,n);case S:return new r;case M:case P:return new r(e);case A:return function(e){var t=new e.constructor(e.source,pe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case C:return new r;case I:return function(e){return Un?Ae(Un.call(e)):{}}(e)}}(e,d,l)}}s||(s=new Zn);var f=s.get(e);if(f)return f;s.set(e,o),ao(e)?e.forEach((function(n){o.add(lr(n,t,r,n,e,s))})):to(e)&&e.forEach((function(n,i){o.set(i,lr(n,t,r,i,e,s))}));var m=c?n:(u?h?ia:ra:h?Lo:Ro)(e);return At(m||e,(function(n,i){m&&(n=e[i=n]),tr(o,i,lr(n,t,r,i,e,s))})),o}function hr(e,t,r){var i=r.length;if(null==e)return!i;for(e=Ae(e);i--;){var a=r[i],s=t[a],o=e[a];if(o===n&&!(a in e)||!s(o))return!1}return!0}function ur(e,t,i){if("function"!=typeof e)throw new Ie(r);return Ia((function(){e.apply(n,i)}),t)}function cr(e,t,n,r){var i=-1,a=Rt,s=!0,o=e.length,l=[],h=t.length;if(!o)return l;n&&(t=Ot(t,Kt(n))),r?(a=Lt,s=!1):t.length>=200&&(a=$t,s=!1,t=new Yn(t));e:for(;++i<o;){var u=e[i],c=null==n?u:n(u);if(u=r||0!==u?u:0,s&&c==c){for(var d=h;d--;)if(t[d]===c)continue e;l.push(u)}else a(t,c,r)||l.push(u)}return l}zn.templateSettings={escape:J,evaluate:K,interpolate:Q,variable:"",imports:{_:zn}},zn.prototype=Vn.prototype,zn.prototype.constructor=zn,jn.prototype=Hn(Vn.prototype),jn.prototype.constructor=jn,Gn.prototype=Hn(Vn.prototype),Gn.prototype.constructor=Gn,Wn.prototype.clear=function(){this.__data__=Pn?Pn(null):{},this.size=0},Wn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Wn.prototype.get=function(e){var t=this.__data__;if(Pn){var r=t[e];return r===i?n:r}return Ne.call(t,e)?t[e]:n},Wn.prototype.has=function(e){var t=this.__data__;return Pn?t[e]!==n:Ne.call(t,e)},Wn.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Pn&&t===n?i:t,this},qn.prototype.clear=function(){this.__data__=[],this.size=0},qn.prototype.delete=function(e){var t=this.__data__,n=nr(t,e);return!(n<0)&&(n==t.length-1?t.pop():Je.call(t,n,1),--this.size,!0)},qn.prototype.get=function(e){var t=this.__data__,r=nr(t,e);return r<0?n:t[r][1]},qn.prototype.has=function(e){return nr(this.__data__,e)>-1},qn.prototype.set=function(e,t){var n=this.__data__,r=nr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Xn.prototype.clear=function(){this.size=0,this.__data__={hash:new Wn,map:new(Tn||qn),string:new Wn}},Xn.prototype.delete=function(e){var t=ha(this,e).delete(e);return this.size-=t?1:0,t},Xn.prototype.get=function(e){return ha(this,e).get(e)},Xn.prototype.has=function(e){return ha(this,e).has(e)},Xn.prototype.set=function(e,t){var n=ha(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Yn.prototype.add=Yn.prototype.push=function(e){return this.__data__.set(e,i),this},Yn.prototype.has=function(e){return this.__data__.has(e)},Zn.prototype.clear=function(){this.__data__=new qn,this.size=0},Zn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Zn.prototype.get=function(e){return this.__data__.get(e)},Zn.prototype.has=function(e){return this.__data__.has(e)},Zn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof qn){var r=n.__data__;if(!Tn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(e,t),this.size=n.size,this};var dr=Oi(br),pr=Oi(_r,!0);function fr(e,t){var n=!0;return dr(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function mr(e,t,r){for(var i=-1,a=e.length;++i<a;){var s=e[i],o=t(s);if(null!=o&&(l===n?o==o&&!oo(o):r(o,l)))var l=o,h=s}return h}function gr(e,t){var n=[];return dr(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function vr(e,t,n,r,i){var a=-1,s=e.length;for(n||(n=va),i||(i=[]);++a<s;){var o=e[a];t>0&&n(o)?t>1?vr(o,t-1,n,r,i):Dt(i,o):r||(i[i.length]=o)}return i}var yr=Di(),xr=Di(!0);function br(e,t){return e&&yr(e,t,Ro)}function _r(e,t){return e&&xr(e,t,Ro)}function wr(e,t){return It(t,(function(t){return Js(e[t])}))}function Sr(e,t){for(var r=0,i=(t=xi(t,e)).length;null!=e&&r<i;)e=e[Na(t[r++])];return r&&r==i?e:n}function Mr(e,t,n){var r=t(e);return js(e)?r:Dt(r,n(e))}function Tr(e){return null==e?e===n?"[object Undefined]":"[object Null]":nt&&nt in Ae(e)?function(e){var t=Ne.call(e,nt),r=e[nt];try{e[nt]=n;var i=!0}catch(e){}var a=Be.call(e);return i&&(t?e[nt]=r:delete e[nt]),a}(e):function(e){return Be.call(e)}(e)}function Er(e,t){return e>t}function Ar(e,t){return null!=e&&Ne.call(e,t)}function Cr(e,t){return null!=e&&t in Ae(e)}function Pr(e,t,r){for(var i=r?Lt:Rt,a=e[0].length,s=e.length,o=s,l=we(s),h=1/0,u=[];o--;){var c=e[o];o&&t&&(c=Ot(c,Kt(t))),h=xn(c.length,h),l[o]=!r&&(t||a>=120&&c.length>=120)?new Yn(o&&c):n}c=e[0];var d=-1,p=l[0];e:for(;++d<a&&u.length<h;){var f=c[d],m=t?t(f):f;if(f=r||0!==f?f:0,!(p?$t(p,m):i(u,m,r))){for(o=s;--o;){var g=l[o];if(!(g?$t(g,m):i(e[o],m,r)))continue e}p&&p.push(m),u.push(f)}}return u}function Ir(e,t,r){var i=null==(e=Aa(e,t=xi(t,e)))?e:e[Na(Za(t))];return null==i?n:Tt(i,e,r)}function Rr(e){return eo(e)&&Tr(e)==g}function Lr(e,t,r,i,a){return e===t||(null==e||null==t||!eo(e)&&!eo(t)?e!=e&&t!=t:function(e,t,r,i,a,s){var o=js(e),l=js(t),h=o?v:fa(e),u=l?v:fa(t),c=(h=h==g?T:h)==T,d=(u=u==g?T:u)==T,p=h==u;if(p&&Xs(e)){if(!Xs(t))return!1;o=!0,c=!1}if(p&&!c)return s||(s=new Zn),o||lo(e)?ta(e,t,r,i,a,s):function(e,t,n,r,i,a,s){switch(n){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case L:return!(e.byteLength!=t.byteLength||!a(new We(e),new We(t)));case y:case x:case M:return Bs(+e,+t);case b:return e.name==t.name&&e.message==t.message;case A:case P:return e==t+"";case S:var o=on;case C:var l=1&r;if(o||(o=un),e.size!=t.size&&!l)return!1;var h=s.get(e);if(h)return h==t;r|=2,s.set(e,t);var u=ta(o(e),o(t),r,i,a,s);return s.delete(e),u;case I:if(Un)return Un.call(e)==Un.call(t)}return!1}(e,t,h,r,i,a,s);if(!(1&r)){var f=c&&Ne.call(e,"__wrapped__"),m=d&&Ne.call(t,"__wrapped__");if(f||m){var _=f?e.value():e,w=m?t.value():t;return s||(s=new Zn),a(_,w,r,i,s)}}return!!p&&(s||(s=new Zn),function(e,t,r,i,a,s){var o=1&r,l=ra(e),h=l.length,u=ra(t),c=u.length;if(h!=c&&!o)return!1;for(var d=h;d--;){var p=l[d];if(!(o?p in t:Ne.call(t,p)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var g=!0;s.set(e,t),s.set(t,e);for(var v=o;++d<h;){var y=e[p=l[d]],x=t[p];if(i)var b=o?i(x,y,p,t,e,s):i(y,x,p,e,t,s);if(!(b===n?y===x||a(y,x,r,i,s):b)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var _=e.constructor,w=t.constructor;_!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof w&&w instanceof w)&&(g=!1)}return s.delete(e),s.delete(t),g}(e,t,r,i,a,s))}(e,t,r,i,Lr,a))}function Or(e,t,r,i){var a=r.length,s=a,o=!i;if(null==e)return!s;for(e=Ae(e);a--;){var l=r[a];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<s;){var h=(l=r[a])[0],u=e[h],c=l[1];if(o&&l[2]){if(u===n&&!(h in e))return!1}else{var d=new Zn;if(i)var p=i(u,c,h,e,t,d);if(!(p===n?Lr(c,u,3,i,d):p))return!1}}return!0}function Dr(e){return!(!$s(e)||function(e){return!!Ue&&Ue in e}(e))&&(Js(e)?Ve:ge).test(Fa(e))}function kr(e){return"function"==typeof e?e:null==e?rl:"object"==typeof e?js(e)?Hr(e[0],e[1]):zr(e):dl(e)}function Nr(e){if(!Sa(e))return vn(e);var t=[];for(var n in Ae(e))Ne.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Fr(e){if(!$s(e))return function(e){var t=[];if(null!=e)for(var n in Ae(e))t.push(n);return t}(e);var t=Sa(e),n=[];for(var r in e)"constructor"==r&&(t||!Ne.call(e,r))||n.push(r);return n}function Ur(e,t){return e<t}function Br(e,t){var n=-1,r=Ws(e)?we(e.length):[];return dr(e,(function(e,i,a){r[++n]=t(e,i,a)})),r}function zr(e){var t=ua(e);return 1==t.length&&t[0][2]?Ta(t[0][0],t[0][1]):function(n){return n===e||Or(n,e,t)}}function Hr(e,t){return ba(e)&&Ma(t)?Ta(Na(e),t):function(r){var i=Eo(r,e);return i===n&&i===t?Ao(r,e):Lr(t,i,3)}}function Vr(e,t,r,i,a){e!==t&&yr(t,(function(s,o){if(a||(a=new Zn),$s(s))!function(e,t,r,i,a,s,o){var l=Ca(e,r),h=Ca(t,r),u=o.get(h);if(u)return void er(e,r,u);var c=s?s(l,h,r+"",e,t,o):n,d=c===n;if(d){var p=js(h),f=!p&&Xs(h),m=!p&&!f&&lo(h);c=h,p||f||m?js(l)?c=l:qs(l)?c=Pi(l):f?(d=!1,c=Si(h,!0)):m?(d=!1,c=Ti(h,!0)):c=[]:ro(h)||Vs(h)?(c=l,Vs(l)?c=vo(l):(!$s(l)||Js(l))&&(c=ga(h))):d=!1}d&&(o.set(h,c),a(c,h,i,s,o),o.delete(h)),er(e,r,c)}(e,t,o,r,Vr,i,a);else{var l=i?i(Ca(e,o),s,o+"",e,t,a):n;l===n&&(l=s),er(e,o,l)}}),Lo)}function jr(e,t){var r=e.length;if(r)return ya(t+=t<0?r:0,r)?e[t]:n}function Gr(e,t,n){t=t.length?Ot(t,(function(e){return js(e)?function(t){return Sr(t,1===e.length?e[0]:e)}:e})):[rl];var r=-1;return t=Ot(t,Kt(la())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Br(e,(function(e,n,i){return{criteria:Ot(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,a=t.criteria,s=i.length,o=n.length;++r<s;){var l=Ei(i[r],a[r]);if(l)return r>=o?l:l*("desc"==n[r]?-1:1)}return e.index-t.index}(e,t,n)}))}function Wr(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var s=t[r],o=Sr(e,s);n(o,s)&&$r(a,xi(s,e),o)}return a}function qr(e,t,n,r){var i=r?Vt:Ht,a=-1,s=t.length,o=e;for(e===t&&(t=Pi(t)),n&&(o=Ot(e,Kt(n)));++a<s;)for(var l=0,h=t[a],u=n?n(h):h;(l=i(o,u,l,r))>-1;)o!==e&&Je.call(o,l,1),Je.call(e,l,1);return e}function Xr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==a){var a=i;ya(i)?Je.call(e,i,1):ci(e,i)}}return e}function Yr(e,t){return e+vt(wn()*(t-e+1))}function Zr(e,t){var n="";if(!e||t<1||t>d)return n;do{t%2&&(n+=e),(t=vt(t/2))&&(e+=e)}while(t);return n}function Jr(e,t){return Ra(Ea(e,t,rl),e+"")}function Kr(e){return Kn(zo(e))}function Qr(e,t){var n=zo(e);return Da(n,or(t,0,n.length))}function $r(e,t,r,i){if(!$s(e))return e;for(var a=-1,s=(t=xi(t,e)).length,o=s-1,l=e;null!=l&&++a<s;){var h=Na(t[a]),u=r;if("__proto__"===h||"constructor"===h||"prototype"===h)return e;if(a!=o){var c=l[h];(u=i?i(c,h,l):n)===n&&(u=$s(c)?c:ya(t[a+1])?[]:{})}tr(l,h,u),l=l[h]}return e}var ei=In?function(e,t){return In.set(e,t),e}:rl,ti=lt?function(e,t){return lt(e,"toString",{configurable:!0,enumerable:!1,value:el(t),writable:!0})}:rl;function ni(e){return Da(zo(e))}function ri(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=we(i);++r<i;)a[r]=e[r+t];return a}function ii(e,t){var n;return dr(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function ai(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var a=r+i>>>1,s=e[a];null!==s&&!oo(s)&&(n?s<=t:s<t)?r=a+1:i=a}return i}return si(e,t,rl,n)}function si(e,t,r,i){var a=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=r(t))!=t,l=null===t,h=oo(t),u=t===n;a<s;){var c=vt((a+s)/2),d=r(e[c]),p=d!==n,f=null===d,m=d==d,g=oo(d);if(o)var v=i||m;else v=u?m&&(i||p):l?m&&p&&(i||!f):h?m&&p&&!f&&(i||!g):!f&&!g&&(i?d<=t:d<t);v?a=c+1:s=c}return xn(s,4294967294)}function oi(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var s=e[n],o=t?t(s):s;if(!n||!Bs(o,l)){var l=o;a[i++]=0===s?0:s}}return a}function li(e){return"number"==typeof e?e:oo(e)?p:+e}function hi(e){if("string"==typeof e)return e;if(js(e))return Ot(e,hi)+"";if(oo(e))return Bn?Bn.call(e):"";var t=e+"";return"0"==t&&1/e==-c?"-0":t}function ui(e,t,n){var r=-1,i=Rt,a=e.length,s=!0,o=[],l=o;if(n)s=!1,i=Lt;else if(a>=200){var h=t?null:Zi(e);if(h)return un(h);s=!1,i=$t,l=new Yn}else l=t?[]:o;e:for(;++r<a;){var u=e[r],c=t?t(u):u;if(u=n||0!==u?u:0,s&&c==c){for(var d=l.length;d--;)if(l[d]===c)continue e;t&&l.push(c),o.push(u)}else i(l,c,n)||(l!==o&&l.push(c),o.push(u))}return o}function ci(e,t){return null==(e=Aa(e,t=xi(t,e)))||delete e[Na(Za(t))]}function di(e,t,n,r){return $r(e,t,n(Sr(e,t)),r)}function pi(e,t,n,r){for(var i=e.length,a=r?i:-1;(r?a--:++a<i)&&t(e[a],a,e););return n?ri(e,r?0:a,r?a+1:i):ri(e,r?a+1:0,r?i:a)}function fi(e,t){var n=e;return n instanceof Gn&&(n=n.value()),kt(t,(function(e,t){return t.func.apply(t.thisArg,Dt([e],t.args))}),n)}function mi(e,t,n){var r=e.length;if(r<2)return r?ui(e[0]):[];for(var i=-1,a=we(r);++i<r;)for(var s=e[i],o=-1;++o<r;)o!=i&&(a[i]=cr(a[i]||s,e[o],t,n));return ui(vr(a,1),t,n)}function gi(e,t,r){for(var i=-1,a=e.length,s=t.length,o={};++i<a;){var l=i<s?t[i]:n;r(o,e[i],l)}return o}function vi(e){return qs(e)?e:[]}function yi(e){return"function"==typeof e?e:rl}function xi(e,t){return js(e)?e:ba(e,t)?[e]:ka(yo(e))}var bi=Jr;function _i(e,t,r){var i=e.length;return r=r===n?i:r,!t&&r>=i?e:ri(e,t,r)}var wi=ct||function(e){return pt.clearTimeout(e)};function Si(e,t){if(t)return e.slice();var n=e.length,r=qe?qe(n):new e.constructor(n);return e.copy(r),r}function Mi(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function Ti(e,t){var n=t?Mi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Ei(e,t){if(e!==t){var r=e!==n,i=null===e,a=e==e,s=oo(e),o=t!==n,l=null===t,h=t==t,u=oo(t);if(!l&&!u&&!s&&e>t||s&&o&&h&&!l&&!u||i&&o&&h||!r&&h||!a)return 1;if(!i&&!s&&!u&&e<t||u&&r&&a&&!i&&!s||l&&r&&a||!o&&a||!h)return-1}return 0}function Ai(e,t,n,r){for(var i=-1,a=e.length,s=n.length,o=-1,l=t.length,h=yn(a-s,0),u=we(l+h),c=!r;++o<l;)u[o]=t[o];for(;++i<s;)(c||i<a)&&(u[n[i]]=e[i]);for(;h--;)u[o++]=e[i++];return u}function Ci(e,t,n,r){for(var i=-1,a=e.length,s=-1,o=n.length,l=-1,h=t.length,u=yn(a-o,0),c=we(u+h),d=!r;++i<u;)c[i]=e[i];for(var p=i;++l<h;)c[p+l]=t[l];for(;++s<o;)(d||i<a)&&(c[p+n[s]]=e[i++]);return c}function Pi(e,t){var n=-1,r=e.length;for(t||(t=we(r));++n<r;)t[n]=e[n];return t}function Ii(e,t,r,i){var a=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var l=t[s],h=i?i(r[l],e[l],l,r,e):n;h===n&&(h=e[l]),a?ar(r,l,h):tr(r,l,h)}return r}function Ri(e,t){return function(n,r){var i=js(n)?Et:rr,a=t?t():{};return i(n,e,la(r,2),a)}}function Li(e){return Jr((function(t,r){var i=-1,a=r.length,s=a>1?r[a-1]:n,o=a>2?r[2]:n;for(s=e.length>3&&"function"==typeof s?(a--,s):n,o&&xa(r[0],r[1],o)&&(s=a<3?n:s,a=1),t=Ae(t);++i<a;){var l=r[i];l&&e(t,l,i,s)}return t}))}function Oi(e,t){return function(n,r){if(null==n)return n;if(!Ws(n))return e(n,r);for(var i=n.length,a=t?i:-1,s=Ae(n);(t?a--:++a<i)&&!1!==r(s[a],a,s););return n}}function Di(e){return function(t,n,r){for(var i=-1,a=Ae(t),s=r(t),o=s.length;o--;){var l=s[e?o:++i];if(!1===n(a[l],l,a))break}return t}}function ki(e){return function(t){var r=sn(t=yo(t))?dn(t):n,i=r?r[0]:t.charAt(0),a=r?_i(r,1).join(""):t.slice(1);return i[e]()+a}}function Ni(e){return function(t){return kt(Ko(jo(t).replace(Qe,"")),e,"")}}function Fi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Hn(e.prototype),r=e.apply(n,t);return $s(r)?r:n}}function Ui(e){return function(t,r,i){var a=Ae(t);if(!Ws(t)){var s=la(r,3);t=Ro(t),r=function(e){return s(a[e],e,a)}}var o=e(t,r,i);return o>-1?a[s?t[o]:o]:n}}function Bi(e){return na((function(t){var i=t.length,a=i,s=jn.prototype.thru;for(e&&t.reverse();a--;){var o=t[a];if("function"!=typeof o)throw new Ie(r);if(s&&!l&&"wrapper"==sa(o))var l=new jn([],!0)}for(a=l?a:i;++a<i;){var h=sa(o=t[a]),u="wrapper"==h?aa(o):n;l=u&&_a(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[sa(u[0])].apply(l,u[3]):1==o.length&&_a(o)?l[h]():l.thru(o)}return function(){var e=arguments,n=e[0];if(l&&1==e.length&&js(n))return l.plant(n).value();for(var r=0,a=i?t[r].apply(this,e):n;++r<i;)a=t[r].call(this,a);return a}}))}function zi(e,t,r,i,a,s,o,l,u,c){var d=t&h,p=1&t,f=2&t,m=24&t,g=512&t,v=f?n:Fi(e);return function h(){for(var y=arguments.length,x=we(y),b=y;b--;)x[b]=arguments[b];if(m)var _=oa(h),w=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(x,_);if(i&&(x=Ai(x,i,a,m)),s&&(x=Ci(x,s,o,m)),y-=w,m&&y<c){var S=hn(x,_);return Xi(e,t,zi,h.placeholder,r,x,S,l,u,c-y)}var M=p?r:this,T=f?M[e]:e;return y=x.length,l?x=function(e,t){for(var r=e.length,i=xn(t.length,r),a=Pi(e);i--;){var s=t[i];e[i]=ya(s,r)?a[s]:n}return e}(x,l):g&&y>1&&x.reverse(),d&&u<y&&(x.length=u),this&&this!==pt&&this instanceof h&&(T=v||Fi(T)),T.apply(M,x)}}function Hi(e,t){return function(n,r){return function(e,t,n,r){return br(e,(function(e,i,a){t(r,n(e),i,a)})),r}(n,e,t(r),{})}}function Vi(e,t){return function(r,i){var a;if(r===n&&i===n)return t;if(r!==n&&(a=r),i!==n){if(a===n)return i;"string"==typeof r||"string"==typeof i?(r=hi(r),i=hi(i)):(r=li(r),i=li(i)),a=e(r,i)}return a}}function ji(e){return na((function(t){return t=Ot(t,Kt(la())),Jr((function(n){var r=this;return e(t,(function(e){return Tt(e,r,n)}))}))}))}function Gi(e,t){var r=(t=t===n?" ":hi(t)).length;if(r<2)return r?Zr(t,e):t;var i=Zr(t,mt(e/cn(t)));return sn(t)?_i(dn(i),0,e).join(""):i.slice(0,e)}function Wi(e){return function(t,r,i){return i&&"number"!=typeof i&&xa(t,r,i)&&(r=i=n),t=po(t),r===n?(r=t,t=0):r=po(r),function(e,t,n,r){for(var i=-1,a=yn(mt((t-e)/(n||1)),0),s=we(a);a--;)s[r?a:++i]=e,e+=n;return s}(t,r,i=i===n?t<r?1:-1:po(i),e)}}function qi(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=go(t),n=go(n)),e(t,n)}}function Xi(e,t,r,i,a,s,h,u,c,d){var p=8&t;t|=p?o:l,4&(t&=~(p?l:o))||(t&=-4);var f=[e,t,a,p?s:n,p?h:n,p?n:s,p?n:h,u,c,d],m=r.apply(n,f);return _a(e)&&Pa(m,f),m.placeholder=i,La(m,e,t)}function Yi(e){var t=Ee[e];return function(e,n){if(e=go(e),(n=null==n?0:xn(fo(n),292))&&qt(e)){var r=(yo(e)+"e").split("e");return+((r=(yo(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var Zi=An&&1/un(new An([,-0]))[1]==c?function(e){return new An(e)}:ll;function Ji(e){return function(t){var n=fa(t);return n==S?on(t):n==C?function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}(t):function(e,t){return Ot(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Ki(e,t,i,c,d,p,f,m){var g=2&t;if(!g&&"function"!=typeof e)throw new Ie(r);var v=c?c.length:0;if(v||(t&=-97,c=d=n),f=f===n?f:yn(fo(f),0),m=m===n?m:fo(m),v-=d?d.length:0,t&l){var y=c,x=d;c=d=n}var b=g?n:aa(e),_=[e,t,i,c,d,y,x,p,f,m];if(b&&function(e,t){var n=e[1],r=t[1],i=n|r,s=i<131,o=r==h&&8==n||r==h&&n==u&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!s&&!o)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var l=t[3];if(l){var c=e[3];e[3]=c?Ai(c,l,t[4]):l,e[4]=c?hn(e[3],a):t[4]}l=t[5],l&&(c=e[5],e[5]=c?Ci(c,l,t[6]):l,e[6]=c?hn(e[5],a):t[6]),l=t[7],l&&(e[7]=l),r&h&&(e[8]=null==e[8]?t[8]:xn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(_,b),e=_[0],t=_[1],i=_[2],c=_[3],d=_[4],!(m=_[9]=_[9]===n?g?0:e.length:yn(_[9]-v,0))&&24&t&&(t&=-25),t&&1!=t)w=8==t||t==s?function(e,t,r){var i=Fi(e);return function a(){for(var s=arguments.length,o=we(s),l=s,h=oa(a);l--;)o[l]=arguments[l];var u=s<3&&o[0]!==h&&o[s-1]!==h?[]:hn(o,h);return(s-=u.length)<r?Xi(e,t,zi,a.placeholder,n,o,u,n,n,r-s):Tt(this&&this!==pt&&this instanceof a?i:e,this,o)}}(e,t,m):t!=o&&33!=t||d.length?zi.apply(n,_):function(e,t,n,r){var i=1&t,a=Fi(e);return function t(){for(var s=-1,o=arguments.length,l=-1,h=r.length,u=we(h+o),c=this&&this!==pt&&this instanceof t?a:e;++l<h;)u[l]=r[l];for(;o--;)u[l++]=arguments[++s];return Tt(c,i?n:this,u)}}(e,t,i,c);else var w=function(e,t,n){var r=1&t,i=Fi(e);return function t(){return(this&&this!==pt&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,i);return La((b?ei:Pa)(w,_),e,t)}function Qi(e,t,r,i){return e===n||Bs(e,Oe[r])&&!Ne.call(i,r)?t:e}function $i(e,t,r,i,a,s){return $s(e)&&$s(t)&&(s.set(t,e),Vr(e,t,n,$i,s),s.delete(t)),e}function ea(e){return ro(e)?n:e}function ta(e,t,r,i,a,s){var o=1&r,l=e.length,h=t.length;if(l!=h&&!(o&&h>l))return!1;var u=s.get(e),c=s.get(t);if(u&&c)return u==t&&c==e;var d=-1,p=!0,f=2&r?new Yn:n;for(s.set(e,t),s.set(t,e);++d<l;){var m=e[d],g=t[d];if(i)var v=o?i(g,m,d,t,e,s):i(m,g,d,e,t,s);if(v!==n){if(v)continue;p=!1;break}if(f){if(!Ft(t,(function(e,t){if(!$t(f,t)&&(m===e||a(m,e,r,i,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!a(m,g,r,i,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function na(e){return Ra(Ea(e,n,Ga),e+"")}function ra(e){return Mr(e,Ro,da)}function ia(e){return Mr(e,Lo,pa)}var aa=In?function(e){return In.get(e)}:ll;function sa(e){for(var t=e.name+"",n=Rn[t],r=Ne.call(Rn,t)?n.length:0;r--;){var i=n[r],a=i.func;if(null==a||a==e)return i.name}return t}function oa(e){return(Ne.call(zn,"placeholder")?zn:e).placeholder}function la(){var e=zn.iteratee||il;return e=e===il?kr:e,arguments.length?e(arguments[0],arguments[1]):e}function ha(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function ua(e){for(var t=Ro(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Ma(i)]}return t}function ca(e,t){var r=function(e,t){return null==e?n:e[t]}(e,t);return Dr(r)?r:n}var da=yt?function(e){return null==e?[]:(e=Ae(e),It(yt(e),(function(t){return Ze.call(e,t)})))}:ml,pa=yt?function(e){for(var t=[];e;)Dt(t,da(e)),e=Xe(e);return t}:ml,fa=Tr;function ma(e,t,n){for(var r=-1,i=(t=xi(t,e)).length,a=!1;++r<i;){var s=Na(t[r]);if(!(a=null!=e&&n(e,s)))break;e=e[s]}return a||++r!=i?a:!!(i=null==e?0:e.length)&&Qs(i)&&ya(s,i)&&(js(e)||Vs(e))}function ga(e){return"function"!=typeof e.constructor||Sa(e)?{}:Hn(Xe(e))}function va(e){return js(e)||Vs(e)||!!(Ke&&e&&e[Ke])}function ya(e,t){var n=typeof e;return!!(t=null==t?d:t)&&("number"==n||"symbol"!=n&&ye.test(e))&&e>-1&&e%1==0&&e<t}function xa(e,t,n){if(!$s(n))return!1;var r=typeof t;return!!("number"==r?Ws(n)&&ya(t,n.length):"string"==r&&t in n)&&Bs(n[t],e)}function ba(e,t){if(js(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!oo(e))||(ee.test(e)||!$.test(e)||null!=t&&e in Ae(t))}function _a(e){var t=sa(e),n=zn[t];if("function"!=typeof n||!(t in Gn.prototype))return!1;if(e===n)return!0;var r=aa(n);return!!r&&e===r[0]}(Mn&&fa(new Mn(new ArrayBuffer(1)))!=O||Tn&&fa(new Tn)!=S||En&&fa(En.resolve())!=E||An&&fa(new An)!=C||Cn&&fa(new Cn)!=R)&&(fa=function(e){var t=Tr(e),r=t==T?e.constructor:n,i=r?Fa(r):"";if(i)switch(i){case Ln:return O;case On:return S;case Dn:return E;case kn:return C;case Nn:return R}return t});var wa=De?Js:gl;function Sa(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Oe)}function Ma(e){return e==e&&!$s(e)}function Ta(e,t){return function(r){return null!=r&&(r[e]===t&&(t!==n||e in Ae(r)))}}function Ea(e,t,r){return t=yn(t===n?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=yn(n.length-t,0),s=we(a);++i<a;)s[i]=n[t+i];i=-1;for(var o=we(t+1);++i<t;)o[i]=n[i];return o[t]=r(s),Tt(e,this,o)}}function Aa(e,t){return t.length<2?e:Sr(e,ri(t,0,-1))}function Ca(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Pa=Oa(ei),Ia=ft||function(e,t){return pt.setTimeout(e,t)},Ra=Oa(ti);function La(e,t,n){var r=t+"";return Ra(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(se,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return At(m,(function(n){var r="_."+n[0];t&n[1]&&!Rt(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(le):[]}(r),n)))}function Oa(e){var t=0,r=0;return function(){var i=bn(),a=16-(i-r);if(r=i,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(n,arguments)}}function Da(e,t){var r=-1,i=e.length,a=i-1;for(t=t===n?i:t;++r<t;){var s=Yr(r,a),o=e[s];e[s]=e[r],e[r]=o}return e.length=t,e}var ka=function(e){var t=Os(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(te,(function(e,n,r,i){t.push(r?i.replace(ce,"$1"):n||e)})),t}));function Na(e){if("string"==typeof e||oo(e))return e;var t=e+"";return"0"==t&&1/e==-c?"-0":t}function Fa(e){if(null!=e){try{return ke.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ua(e){if(e instanceof Gn)return e.clone();var t=new jn(e.__wrapped__,e.__chain__);return t.__actions__=Pi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ba=Jr((function(e,t){return qs(e)?cr(e,vr(t,1,qs,!0)):[]})),za=Jr((function(e,t){var r=Za(t);return qs(r)&&(r=n),qs(e)?cr(e,vr(t,1,qs,!0),la(r,2)):[]})),Ha=Jr((function(e,t){var r=Za(t);return qs(r)&&(r=n),qs(e)?cr(e,vr(t,1,qs,!0),n,r):[]}));function Va(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fo(n);return i<0&&(i=yn(r+i,0)),zt(e,la(t,3),i)}function ja(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var a=i-1;return r!==n&&(a=fo(r),a=r<0?yn(i+a,0):xn(a,i-1)),zt(e,la(t,3),a,!0)}function Ga(e){return(null==e?0:e.length)?vr(e,1):[]}function Wa(e){return e&&e.length?e[0]:n}var qa=Jr((function(e){var t=Ot(e,vi);return t.length&&t[0]===e[0]?Pr(t):[]})),Xa=Jr((function(e){var t=Za(e),r=Ot(e,vi);return t===Za(r)?t=n:r.pop(),r.length&&r[0]===e[0]?Pr(r,la(t,2)):[]})),Ya=Jr((function(e){var t=Za(e),r=Ot(e,vi);return(t="function"==typeof t?t:n)&&r.pop(),r.length&&r[0]===e[0]?Pr(r,n,t):[]}));function Za(e){var t=null==e?0:e.length;return t?e[t-1]:n}var Ja=Jr(Ka);function Ka(e,t){return e&&e.length&&t&&t.length?qr(e,t):e}var Qa=na((function(e,t){var n=null==e?0:e.length,r=sr(e,t);return Xr(e,Ot(t,(function(e){return ya(e,n)?+e:e})).sort(Ei)),r}));function $a(e){return null==e?e:Sn.call(e)}var es=Jr((function(e){return ui(vr(e,1,qs,!0))})),ts=Jr((function(e){var t=Za(e);return qs(t)&&(t=n),ui(vr(e,1,qs,!0),la(t,2))})),ns=Jr((function(e){var t=Za(e);return t="function"==typeof t?t:n,ui(vr(e,1,qs,!0),n,t)}));function rs(e){if(!e||!e.length)return[];var t=0;return e=It(e,(function(e){if(qs(e))return t=yn(e.length,t),!0})),Zt(t,(function(t){return Ot(e,Wt(t))}))}function is(e,t){if(!e||!e.length)return[];var r=rs(e);return null==t?r:Ot(r,(function(e){return Tt(t,n,e)}))}var as=Jr((function(e,t){return qs(e)?cr(e,t):[]})),ss=Jr((function(e){return mi(It(e,qs))})),os=Jr((function(e){var t=Za(e);return qs(t)&&(t=n),mi(It(e,qs),la(t,2))})),ls=Jr((function(e){var t=Za(e);return t="function"==typeof t?t:n,mi(It(e,qs),n,t)})),hs=Jr(rs);var us=Jr((function(e){var t=e.length,r=t>1?e[t-1]:n;return r="function"==typeof r?(e.pop(),r):n,is(e,r)}));function cs(e){var t=zn(e);return t.__chain__=!0,t}function ds(e,t){return t(e)}var ps=na((function(e){var t=e.length,r=t?e[0]:0,i=this.__wrapped__,a=function(t){return sr(t,e)};return!(t>1||this.__actions__.length)&&i instanceof Gn&&ya(r)?((i=i.slice(r,+r+(t?1:0))).__actions__.push({func:ds,args:[a],thisArg:n}),new jn(i,this.__chain__).thru((function(e){return t&&!e.length&&e.push(n),e}))):this.thru(a)}));var fs=Ri((function(e,t,n){Ne.call(e,n)?++e[n]:ar(e,n,1)}));var ms=Ui(Va),gs=Ui(ja);function vs(e,t){return(js(e)?At:dr)(e,la(t,3))}function ys(e,t){return(js(e)?Ct:pr)(e,la(t,3))}var xs=Ri((function(e,t,n){Ne.call(e,n)?e[n].push(t):ar(e,n,[t])}));var bs=Jr((function(e,t,n){var r=-1,i="function"==typeof t,a=Ws(e)?we(e.length):[];return dr(e,(function(e){a[++r]=i?Tt(t,e,n):Ir(e,t,n)})),a})),_s=Ri((function(e,t,n){ar(e,n,t)}));function ws(e,t){return(js(e)?Ot:Br)(e,la(t,3))}var Ss=Ri((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var Ms=Jr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&xa(e,t[0],t[1])?t=[]:n>2&&xa(t[0],t[1],t[2])&&(t=[t[0]]),Gr(e,vr(t,1),[])})),Ts=dt||function(){return pt.Date.now()};function Es(e,t,r){return t=r?n:t,t=e&&null==t?e.length:t,Ki(e,h,n,n,n,n,t)}function As(e,t){var i;if("function"!=typeof t)throw new Ie(r);return e=fo(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=n),i}}var Cs=Jr((function(e,t,n){var r=1;if(n.length){var i=hn(n,oa(Cs));r|=o}return Ki(e,r,t,n,i)})),Ps=Jr((function(e,t,n){var r=3;if(n.length){var i=hn(n,oa(Ps));r|=o}return Ki(t,r,e,n,i)}));function Is(e,t,i){var a,s,o,l,h,u,c=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new Ie(r);function m(t){var r=a,i=s;return a=s=n,c=t,l=e.apply(i,r)}function g(e){var r=e-u;return u===n||r>=t||r<0||p&&e-c>=o}function v(){var e=Ts();if(g(e))return y(e);h=Ia(v,function(e){var n=t-(e-u);return p?xn(n,o-(e-c)):n}(e))}function y(e){return h=n,f&&a?m(e):(a=s=n,l)}function x(){var e=Ts(),r=g(e);if(a=arguments,s=this,u=e,r){if(h===n)return function(e){return c=e,h=Ia(v,t),d?m(e):l}(u);if(p)return wi(h),h=Ia(v,t),m(u)}return h===n&&(h=Ia(v,t)),l}return t=go(t)||0,$s(i)&&(d=!!i.leading,o=(p="maxWait"in i)?yn(go(i.maxWait)||0,t):o,f="trailing"in i?!!i.trailing:f),x.cancel=function(){h!==n&&wi(h),c=0,a=u=s=h=n},x.flush=function(){return h===n?l:y(Ts())},x}var Rs=Jr((function(e,t){return ur(e,1,t)})),Ls=Jr((function(e,t,n){return ur(e,go(t)||0,n)}));function Os(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ie(r);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var s=e.apply(this,r);return n.cache=a.set(i,s)||a,s};return n.cache=new(Os.Cache||Xn),n}function Ds(e){if("function"!=typeof e)throw new Ie(r);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Os.Cache=Xn;var ks=bi((function(e,t){var n=(t=1==t.length&&js(t[0])?Ot(t[0],Kt(la())):Ot(vr(t,1),Kt(la()))).length;return Jr((function(r){for(var i=-1,a=xn(r.length,n);++i<a;)r[i]=t[i].call(this,r[i]);return Tt(e,this,r)}))})),Ns=Jr((function(e,t){var r=hn(t,oa(Ns));return Ki(e,o,n,t,r)})),Fs=Jr((function(e,t){var r=hn(t,oa(Fs));return Ki(e,l,n,t,r)})),Us=na((function(e,t){return Ki(e,u,n,n,n,t)}));function Bs(e,t){return e===t||e!=e&&t!=t}var zs=qi(Er),Hs=qi((function(e,t){return e>=t})),Vs=Rr(function(){return arguments}())?Rr:function(e){return eo(e)&&Ne.call(e,"callee")&&!Ze.call(e,"callee")},js=we.isArray,Gs=xt?Kt(xt):function(e){return eo(e)&&Tr(e)==L};function Ws(e){return null!=e&&Qs(e.length)&&!Js(e)}function qs(e){return eo(e)&&Ws(e)}var Xs=Ut||gl,Ys=bt?Kt(bt):function(e){return eo(e)&&Tr(e)==x};function Zs(e){if(!eo(e))return!1;var t=Tr(e);return t==b||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ro(e)}function Js(e){if(!$s(e))return!1;var t=Tr(e);return t==_||t==w||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ks(e){return"number"==typeof e&&e==fo(e)}function Qs(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=d}function $s(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eo(e){return null!=e&&"object"==typeof e}var to=_t?Kt(_t):function(e){return eo(e)&&fa(e)==S};function no(e){return"number"==typeof e||eo(e)&&Tr(e)==M}function ro(e){if(!eo(e)||Tr(e)!=T)return!1;var t=Xe(e);if(null===t)return!0;var n=Ne.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ke.call(n)==ze}var io=wt?Kt(wt):function(e){return eo(e)&&Tr(e)==A};var ao=St?Kt(St):function(e){return eo(e)&&fa(e)==C};function so(e){return"string"==typeof e||!js(e)&&eo(e)&&Tr(e)==P}function oo(e){return"symbol"==typeof e||eo(e)&&Tr(e)==I}var lo=Mt?Kt(Mt):function(e){return eo(e)&&Qs(e.length)&&!!st[Tr(e)]};var ho=qi(Ur),uo=qi((function(e,t){return e<=t}));function co(e){if(!e)return[];if(Ws(e))return so(e)?dn(e):Pi(e);if(et&&e[et])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[et]());var t=fa(e);return(t==S?on:t==C?un:zo)(e)}function po(e){return e?(e=go(e))===c||e===-c?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function fo(e){var t=po(e),n=t%1;return t==t?n?t-n:t:0}function mo(e){return e?or(fo(e),0,f):0}function go(e){if("number"==typeof e)return e;if(oo(e))return p;if($s(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=$s(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Jt(e);var n=me.test(e);return n||ve.test(e)?ut(e.slice(2),n?2:8):fe.test(e)?p:+e}function vo(e){return Ii(e,Lo(e))}function yo(e){return null==e?"":hi(e)}var xo=Li((function(e,t){if(Sa(t)||Ws(t))Ii(t,Ro(t),e);else for(var n in t)Ne.call(t,n)&&tr(e,n,t[n])})),bo=Li((function(e,t){Ii(t,Lo(t),e)})),_o=Li((function(e,t,n,r){Ii(t,Lo(t),e,r)})),wo=Li((function(e,t,n,r){Ii(t,Ro(t),e,r)})),So=na(sr);var Mo=Jr((function(e,t){e=Ae(e);var r=-1,i=t.length,a=i>2?t[2]:n;for(a&&xa(t[0],t[1],a)&&(i=1);++r<i;)for(var s=t[r],o=Lo(s),l=-1,h=o.length;++l<h;){var u=o[l],c=e[u];(c===n||Bs(c,Oe[u])&&!Ne.call(e,u))&&(e[u]=s[u])}return e})),To=Jr((function(e){return e.push(n,$i),Tt(Do,n,e)}));function Eo(e,t,r){var i=null==e?n:Sr(e,t);return i===n?r:i}function Ao(e,t){return null!=e&&ma(e,t,Cr)}var Co=Hi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),e[t]=n}),el(rl)),Po=Hi((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),Ne.call(e,t)?e[t].push(n):e[t]=[n]}),la),Io=Jr(Ir);function Ro(e){return Ws(e)?Jn(e):Nr(e)}function Lo(e){return Ws(e)?Jn(e,!0):Fr(e)}var Oo=Li((function(e,t,n){Vr(e,t,n)})),Do=Li((function(e,t,n,r){Vr(e,t,n,r)})),ko=na((function(e,t){var n={};if(null==e)return n;var r=!1;t=Ot(t,(function(t){return t=xi(t,e),r||(r=t.length>1),t})),Ii(e,ia(e),n),r&&(n=lr(n,7,ea));for(var i=t.length;i--;)ci(n,t[i]);return n}));var No=na((function(e,t){return null==e?{}:function(e,t){return Wr(e,t,(function(t,n){return Ao(e,n)}))}(e,t)}));function Fo(e,t){if(null==e)return{};var n=Ot(ia(e),(function(e){return[e]}));return t=la(t),Wr(e,n,(function(e,n){return t(e,n[0])}))}var Uo=Ji(Ro),Bo=Ji(Lo);function zo(e){return null==e?[]:Qt(e,Ro(e))}var Ho=Ni((function(e,t,n){return t=t.toLowerCase(),e+(n?Vo(t):t)}));function Vo(e){return Jo(yo(e).toLowerCase())}function jo(e){return(e=yo(e))&&e.replace(xe,nn).replace($e,"")}var Go=Ni((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Wo=Ni((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),qo=ki("toLowerCase");var Xo=Ni((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var Yo=Ni((function(e,t,n){return e+(n?" ":"")+Jo(t)}));var Zo=Ni((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Jo=ki("toUpperCase");function Ko(e,t,r){return e=yo(e),(t=r?n:t)===n?function(e){return rt.test(e)}(e)?function(e){return e.match(tt)||[]}(e):function(e){return e.match(he)||[]}(e):e.match(t)||[]}var Qo=Jr((function(e,t){try{return Tt(e,n,t)}catch(e){return Zs(e)?e:new Me(e)}})),$o=na((function(e,t){return At(t,(function(t){t=Na(t),ar(e,t,Cs(e[t],e))})),e}));function el(e){return function(){return e}}var tl=Bi(),nl=Bi(!0);function rl(e){return e}function il(e){return kr("function"==typeof e?e:lr(e,1))}var al=Jr((function(e,t){return function(n){return Ir(n,e,t)}})),sl=Jr((function(e,t){return function(n){return Ir(e,n,t)}}));function ol(e,t,n){var r=Ro(t),i=wr(t,r);null==n&&(!$s(t)||!i.length&&r.length)&&(n=t,t=e,e=this,i=wr(t,Ro(t)));var a=!($s(n)&&"chain"in n&&!n.chain),s=Js(e);return At(i,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(a||t){var n=e(this.__wrapped__);return(n.__actions__=Pi(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Dt([this.value()],arguments))})})),e}function ll(){}var hl=ji(Ot),ul=ji(Pt),cl=ji(Ft);function dl(e){return ba(e)?Wt(Na(e)):function(e){return function(t){return Sr(t,e)}}(e)}var pl=Wi(),fl=Wi(!0);function ml(){return[]}function gl(){return!1}var vl=Vi((function(e,t){return e+t}),0),yl=Yi("ceil"),xl=Vi((function(e,t){return e/t}),1),bl=Yi("floor");var _l=Vi((function(e,t){return e*t}),1),wl=Yi("round"),Sl=Vi((function(e,t){return e-t}),0);return zn.after=function(e,t){if("function"!=typeof t)throw new Ie(r);return e=fo(e),function(){if(--e<1)return t.apply(this,arguments)}},zn.ary=Es,zn.assign=xo,zn.assignIn=bo,zn.assignInWith=_o,zn.assignWith=wo,zn.at=So,zn.before=As,zn.bind=Cs,zn.bindAll=$o,zn.bindKey=Ps,zn.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return js(e)?e:[e]},zn.chain=cs,zn.chunk=function(e,t,r){t=(r?xa(e,t,r):t===n)?1:yn(fo(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var a=0,s=0,o=we(mt(i/t));a<i;)o[s++]=ri(e,a,a+=t);return o},zn.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var a=e[t];a&&(i[r++]=a)}return i},zn.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return Dt(js(n)?Pi(n):[n],vr(t,1))},zn.cond=function(e){var t=null==e?0:e.length,n=la();return e=t?Ot(e,(function(e){if("function"!=typeof e[1])throw new Ie(r);return[n(e[0]),e[1]]})):[],Jr((function(n){for(var r=-1;++r<t;){var i=e[r];if(Tt(i[0],this,n))return Tt(i[1],this,n)}}))},zn.conforms=function(e){return function(e){var t=Ro(e);return function(n){return hr(n,e,t)}}(lr(e,1))},zn.constant=el,zn.countBy=fs,zn.create=function(e,t){var n=Hn(e);return null==t?n:ir(n,t)},zn.curry=function e(t,r,i){var a=Ki(t,8,n,n,n,n,n,r=i?n:r);return a.placeholder=e.placeholder,a},zn.curryRight=function e(t,r,i){var a=Ki(t,s,n,n,n,n,n,r=i?n:r);return a.placeholder=e.placeholder,a},zn.debounce=Is,zn.defaults=Mo,zn.defaultsDeep=To,zn.defer=Rs,zn.delay=Ls,zn.difference=Ba,zn.differenceBy=za,zn.differenceWith=Ha,zn.drop=function(e,t,r){var i=null==e?0:e.length;return i?ri(e,(t=r||t===n?1:fo(t))<0?0:t,i):[]},zn.dropRight=function(e,t,r){var i=null==e?0:e.length;return i?ri(e,0,(t=i-(t=r||t===n?1:fo(t)))<0?0:t):[]},zn.dropRightWhile=function(e,t){return e&&e.length?pi(e,la(t,3),!0,!0):[]},zn.dropWhile=function(e,t){return e&&e.length?pi(e,la(t,3),!0):[]},zn.fill=function(e,t,r,i){var a=null==e?0:e.length;return a?(r&&"number"!=typeof r&&xa(e,t,r)&&(r=0,i=a),function(e,t,r,i){var a=e.length;for((r=fo(r))<0&&(r=-r>a?0:a+r),(i=i===n||i>a?a:fo(i))<0&&(i+=a),i=r>i?0:mo(i);r<i;)e[r++]=t;return e}(e,t,r,i)):[]},zn.filter=function(e,t){return(js(e)?It:gr)(e,la(t,3))},zn.flatMap=function(e,t){return vr(ws(e,t),1)},zn.flatMapDeep=function(e,t){return vr(ws(e,t),c)},zn.flatMapDepth=function(e,t,r){return r=r===n?1:fo(r),vr(ws(e,t),r)},zn.flatten=Ga,zn.flattenDeep=function(e){return(null==e?0:e.length)?vr(e,c):[]},zn.flattenDepth=function(e,t){return(null==e?0:e.length)?vr(e,t=t===n?1:fo(t)):[]},zn.flip=function(e){return Ki(e,512)},zn.flow=tl,zn.flowRight=nl,zn.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},zn.functions=function(e){return null==e?[]:wr(e,Ro(e))},zn.functionsIn=function(e){return null==e?[]:wr(e,Lo(e))},zn.groupBy=xs,zn.initial=function(e){return(null==e?0:e.length)?ri(e,0,-1):[]},zn.intersection=qa,zn.intersectionBy=Xa,zn.intersectionWith=Ya,zn.invert=Co,zn.invertBy=Po,zn.invokeMap=bs,zn.iteratee=il,zn.keyBy=_s,zn.keys=Ro,zn.keysIn=Lo,zn.map=ws,zn.mapKeys=function(e,t){var n={};return t=la(t,3),br(e,(function(e,r,i){ar(n,t(e,r,i),e)})),n},zn.mapValues=function(e,t){var n={};return t=la(t,3),br(e,(function(e,r,i){ar(n,r,t(e,r,i))})),n},zn.matches=function(e){return zr(lr(e,1))},zn.matchesProperty=function(e,t){return Hr(e,lr(t,1))},zn.memoize=Os,zn.merge=Oo,zn.mergeWith=Do,zn.method=al,zn.methodOf=sl,zn.mixin=ol,zn.negate=Ds,zn.nthArg=function(e){return e=fo(e),Jr((function(t){return jr(t,e)}))},zn.omit=ko,zn.omitBy=function(e,t){return Fo(e,Ds(la(t)))},zn.once=function(e){return As(2,e)},zn.orderBy=function(e,t,r,i){return null==e?[]:(js(t)||(t=null==t?[]:[t]),js(r=i?n:r)||(r=null==r?[]:[r]),Gr(e,t,r))},zn.over=hl,zn.overArgs=ks,zn.overEvery=ul,zn.overSome=cl,zn.partial=Ns,zn.partialRight=Fs,zn.partition=Ss,zn.pick=No,zn.pickBy=Fo,zn.property=dl,zn.propertyOf=function(e){return function(t){return null==e?n:Sr(e,t)}},zn.pull=Ja,zn.pullAll=Ka,zn.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?qr(e,t,la(n,2)):e},zn.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?qr(e,t,n,r):e},zn.pullAt=Qa,zn.range=pl,zn.rangeRight=fl,zn.rearg=Us,zn.reject=function(e,t){return(js(e)?It:gr)(e,Ds(la(t,3)))},zn.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],a=e.length;for(t=la(t,3);++r<a;){var s=e[r];t(s,r,e)&&(n.push(s),i.push(r))}return Xr(e,i),n},zn.rest=function(e,t){if("function"!=typeof e)throw new Ie(r);return Jr(e,t=t===n?t:fo(t))},zn.reverse=$a,zn.sampleSize=function(e,t,r){return t=(r?xa(e,t,r):t===n)?1:fo(t),(js(e)?Qn:Qr)(e,t)},zn.set=function(e,t,n){return null==e?e:$r(e,t,n)},zn.setWith=function(e,t,r,i){return i="function"==typeof i?i:n,null==e?e:$r(e,t,r,i)},zn.shuffle=function(e){return(js(e)?$n:ni)(e)},zn.slice=function(e,t,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&xa(e,t,r)?(t=0,r=i):(t=null==t?0:fo(t),r=r===n?i:fo(r)),ri(e,t,r)):[]},zn.sortBy=Ms,zn.sortedUniq=function(e){return e&&e.length?oi(e):[]},zn.sortedUniqBy=function(e,t){return e&&e.length?oi(e,la(t,2)):[]},zn.split=function(e,t,r){return r&&"number"!=typeof r&&xa(e,t,r)&&(t=r=n),(r=r===n?f:r>>>0)?(e=yo(e))&&("string"==typeof t||null!=t&&!io(t))&&(!(t=hi(t))&&sn(e))?_i(dn(e),0,r):e.split(t,r):[]},zn.spread=function(e,t){if("function"!=typeof e)throw new Ie(r);return t=null==t?0:yn(fo(t),0),Jr((function(n){var r=n[t],i=_i(n,0,t);return r&&Dt(i,r),Tt(e,this,i)}))},zn.tail=function(e){var t=null==e?0:e.length;return t?ri(e,1,t):[]},zn.take=function(e,t,r){return e&&e.length?ri(e,0,(t=r||t===n?1:fo(t))<0?0:t):[]},zn.takeRight=function(e,t,r){var i=null==e?0:e.length;return i?ri(e,(t=i-(t=r||t===n?1:fo(t)))<0?0:t,i):[]},zn.takeRightWhile=function(e,t){return e&&e.length?pi(e,la(t,3),!1,!0):[]},zn.takeWhile=function(e,t){return e&&e.length?pi(e,la(t,3)):[]},zn.tap=function(e,t){return t(e),e},zn.throttle=function(e,t,n){var i=!0,a=!0;if("function"!=typeof e)throw new Ie(r);return $s(n)&&(i="leading"in n?!!n.leading:i,a="trailing"in n?!!n.trailing:a),Is(e,t,{leading:i,maxWait:t,trailing:a})},zn.thru=ds,zn.toArray=co,zn.toPairs=Uo,zn.toPairsIn=Bo,zn.toPath=function(e){return js(e)?Ot(e,Na):oo(e)?[e]:Pi(ka(yo(e)))},zn.toPlainObject=vo,zn.transform=function(e,t,n){var r=js(e),i=r||Xs(e)||lo(e);if(t=la(t,4),null==n){var a=e&&e.constructor;n=i?r?new a:[]:$s(e)&&Js(a)?Hn(Xe(e)):{}}return(i?At:br)(e,(function(e,r,i){return t(n,e,r,i)})),n},zn.unary=function(e){return Es(e,1)},zn.union=es,zn.unionBy=ts,zn.unionWith=ns,zn.uniq=function(e){return e&&e.length?ui(e):[]},zn.uniqBy=function(e,t){return e&&e.length?ui(e,la(t,2)):[]},zn.uniqWith=function(e,t){return t="function"==typeof t?t:n,e&&e.length?ui(e,n,t):[]},zn.unset=function(e,t){return null==e||ci(e,t)},zn.unzip=rs,zn.unzipWith=is,zn.update=function(e,t,n){return null==e?e:di(e,t,yi(n))},zn.updateWith=function(e,t,r,i){return i="function"==typeof i?i:n,null==e?e:di(e,t,yi(r),i)},zn.values=zo,zn.valuesIn=function(e){return null==e?[]:Qt(e,Lo(e))},zn.without=as,zn.words=Ko,zn.wrap=function(e,t){return Ns(yi(t),e)},zn.xor=ss,zn.xorBy=os,zn.xorWith=ls,zn.zip=hs,zn.zipObject=function(e,t){return gi(e||[],t||[],tr)},zn.zipObjectDeep=function(e,t){return gi(e||[],t||[],$r)},zn.zipWith=us,zn.entries=Uo,zn.entriesIn=Bo,zn.extend=bo,zn.extendWith=_o,ol(zn,zn),zn.add=vl,zn.attempt=Qo,zn.camelCase=Ho,zn.capitalize=Vo,zn.ceil=yl,zn.clamp=function(e,t,r){return r===n&&(r=t,t=n),r!==n&&(r=(r=go(r))==r?r:0),t!==n&&(t=(t=go(t))==t?t:0),or(go(e),t,r)},zn.clone=function(e){return lr(e,4)},zn.cloneDeep=function(e){return lr(e,5)},zn.cloneDeepWith=function(e,t){return lr(e,5,t="function"==typeof t?t:n)},zn.cloneWith=function(e,t){return lr(e,4,t="function"==typeof t?t:n)},zn.conformsTo=function(e,t){return null==t||hr(e,t,Ro(t))},zn.deburr=jo,zn.defaultTo=function(e,t){return null==e||e!=e?t:e},zn.divide=xl,zn.endsWith=function(e,t,r){e=yo(e),t=hi(t);var i=e.length,a=r=r===n?i:or(fo(r),0,i);return(r-=t.length)>=0&&e.slice(r,a)==t},zn.eq=Bs,zn.escape=function(e){return(e=yo(e))&&Z.test(e)?e.replace(X,rn):e},zn.escapeRegExp=function(e){return(e=yo(e))&&re.test(e)?e.replace(ne,"\\$&"):e},zn.every=function(e,t,r){var i=js(e)?Pt:fr;return r&&xa(e,t,r)&&(t=n),i(e,la(t,3))},zn.find=ms,zn.findIndex=Va,zn.findKey=function(e,t){return Bt(e,la(t,3),br)},zn.findLast=gs,zn.findLastIndex=ja,zn.findLastKey=function(e,t){return Bt(e,la(t,3),_r)},zn.floor=bl,zn.forEach=vs,zn.forEachRight=ys,zn.forIn=function(e,t){return null==e?e:yr(e,la(t,3),Lo)},zn.forInRight=function(e,t){return null==e?e:xr(e,la(t,3),Lo)},zn.forOwn=function(e,t){return e&&br(e,la(t,3))},zn.forOwnRight=function(e,t){return e&&_r(e,la(t,3))},zn.get=Eo,zn.gt=zs,zn.gte=Hs,zn.has=function(e,t){return null!=e&&ma(e,t,Ar)},zn.hasIn=Ao,zn.head=Wa,zn.identity=rl,zn.includes=function(e,t,n,r){e=Ws(e)?e:zo(e),n=n&&!r?fo(n):0;var i=e.length;return n<0&&(n=yn(i+n,0)),so(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Ht(e,t,n)>-1},zn.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:fo(n);return i<0&&(i=yn(r+i,0)),Ht(e,t,i)},zn.inRange=function(e,t,r){return t=po(t),r===n?(r=t,t=0):r=po(r),function(e,t,n){return e>=xn(t,n)&&e<yn(t,n)}(e=go(e),t,r)},zn.invoke=Io,zn.isArguments=Vs,zn.isArray=js,zn.isArrayBuffer=Gs,zn.isArrayLike=Ws,zn.isArrayLikeObject=qs,zn.isBoolean=function(e){return!0===e||!1===e||eo(e)&&Tr(e)==y},zn.isBuffer=Xs,zn.isDate=Ys,zn.isElement=function(e){return eo(e)&&1===e.nodeType&&!ro(e)},zn.isEmpty=function(e){if(null==e)return!0;if(Ws(e)&&(js(e)||"string"==typeof e||"function"==typeof e.splice||Xs(e)||lo(e)||Vs(e)))return!e.length;var t=fa(e);if(t==S||t==C)return!e.size;if(Sa(e))return!Nr(e).length;for(var n in e)if(Ne.call(e,n))return!1;return!0},zn.isEqual=function(e,t){return Lr(e,t)},zn.isEqualWith=function(e,t,r){var i=(r="function"==typeof r?r:n)?r(e,t):n;return i===n?Lr(e,t,n,r):!!i},zn.isError=Zs,zn.isFinite=function(e){return"number"==typeof e&&qt(e)},zn.isFunction=Js,zn.isInteger=Ks,zn.isLength=Qs,zn.isMap=to,zn.isMatch=function(e,t){return e===t||Or(e,t,ua(t))},zn.isMatchWith=function(e,t,r){return r="function"==typeof r?r:n,Or(e,t,ua(t),r)},zn.isNaN=function(e){return no(e)&&e!=+e},zn.isNative=function(e){if(wa(e))throw new Me("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Dr(e)},zn.isNil=function(e){return null==e},zn.isNull=function(e){return null===e},zn.isNumber=no,zn.isObject=$s,zn.isObjectLike=eo,zn.isPlainObject=ro,zn.isRegExp=io,zn.isSafeInteger=function(e){return Ks(e)&&e>=-d&&e<=d},zn.isSet=ao,zn.isString=so,zn.isSymbol=oo,zn.isTypedArray=lo,zn.isUndefined=function(e){return e===n},zn.isWeakMap=function(e){return eo(e)&&fa(e)==R},zn.isWeakSet=function(e){return eo(e)&&"[object WeakSet]"==Tr(e)},zn.join=function(e,t){return null==e?"":gn.call(e,t)},zn.kebabCase=Go,zn.last=Za,zn.lastIndexOf=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var a=i;return r!==n&&(a=(a=fo(r))<0?yn(i+a,0):xn(a,i-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,a):zt(e,jt,a,!0)},zn.lowerCase=Wo,zn.lowerFirst=qo,zn.lt=ho,zn.lte=uo,zn.max=function(e){return e&&e.length?mr(e,rl,Er):n},zn.maxBy=function(e,t){return e&&e.length?mr(e,la(t,2),Er):n},zn.mean=function(e){return Gt(e,rl)},zn.meanBy=function(e,t){return Gt(e,la(t,2))},zn.min=function(e){return e&&e.length?mr(e,rl,Ur):n},zn.minBy=function(e,t){return e&&e.length?mr(e,la(t,2),Ur):n},zn.stubArray=ml,zn.stubFalse=gl,zn.stubObject=function(){return{}},zn.stubString=function(){return""},zn.stubTrue=function(){return!0},zn.multiply=_l,zn.nth=function(e,t){return e&&e.length?jr(e,fo(t)):n},zn.noConflict=function(){return pt._===this&&(pt._=He),this},zn.noop=ll,zn.now=Ts,zn.pad=function(e,t,n){e=yo(e);var r=(t=fo(t))?cn(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return Gi(vt(i),n)+e+Gi(mt(i),n)},zn.padEnd=function(e,t,n){e=yo(e);var r=(t=fo(t))?cn(e):0;return t&&r<t?e+Gi(t-r,n):e},zn.padStart=function(e,t,n){e=yo(e);var r=(t=fo(t))?cn(e):0;return t&&r<t?Gi(t-r,n)+e:e},zn.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),_n(yo(e).replace(ie,""),t||0)},zn.random=function(e,t,r){if(r&&"boolean"!=typeof r&&xa(e,t,r)&&(t=r=n),r===n&&("boolean"==typeof t?(r=t,t=n):"boolean"==typeof e&&(r=e,e=n)),e===n&&t===n?(e=0,t=1):(e=po(e),t===n?(t=e,e=0):t=po(t)),e>t){var i=e;e=t,t=i}if(r||e%1||t%1){var a=wn();return xn(e+a*(t-e+ht("1e-"+((a+"").length-1))),t)}return Yr(e,t)},zn.reduce=function(e,t,n){var r=js(e)?kt:Xt,i=arguments.length<3;return r(e,la(t,4),n,i,dr)},zn.reduceRight=function(e,t,n){var r=js(e)?Nt:Xt,i=arguments.length<3;return r(e,la(t,4),n,i,pr)},zn.repeat=function(e,t,r){return t=(r?xa(e,t,r):t===n)?1:fo(t),Zr(yo(e),t)},zn.replace=function(){var e=arguments,t=yo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},zn.result=function(e,t,r){var i=-1,a=(t=xi(t,e)).length;for(a||(a=1,e=n);++i<a;){var s=null==e?n:e[Na(t[i])];s===n&&(i=a,s=r),e=Js(s)?s.call(e):s}return e},zn.round=wl,zn.runInContext=e,zn.sample=function(e){return(js(e)?Kn:Kr)(e)},zn.size=function(e){if(null==e)return 0;if(Ws(e))return so(e)?cn(e):e.length;var t=fa(e);return t==S||t==C?e.size:Nr(e).length},zn.snakeCase=Xo,zn.some=function(e,t,r){var i=js(e)?Ft:ii;return r&&xa(e,t,r)&&(t=n),i(e,la(t,3))},zn.sortedIndex=function(e,t){return ai(e,t)},zn.sortedIndexBy=function(e,t,n){return si(e,t,la(n,2))},zn.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=ai(e,t);if(r<n&&Bs(e[r],t))return r}return-1},zn.sortedLastIndex=function(e,t){return ai(e,t,!0)},zn.sortedLastIndexBy=function(e,t,n){return si(e,t,la(n,2),!0)},zn.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=ai(e,t,!0)-1;if(Bs(e[n],t))return n}return-1},zn.startCase=Yo,zn.startsWith=function(e,t,n){return e=yo(e),n=null==n?0:or(fo(n),0,e.length),t=hi(t),e.slice(n,n+t.length)==t},zn.subtract=Sl,zn.sum=function(e){return e&&e.length?Yt(e,rl):0},zn.sumBy=function(e,t){return e&&e.length?Yt(e,la(t,2)):0},zn.template=function(e,t,r){var i=zn.templateSettings;r&&xa(e,t,r)&&(t=n),e=yo(e),t=_o({},t,i,Qi);var a,s,o=_o({},t.imports,i.imports,Qi),l=Ro(o),h=Qt(o,l),u=0,c=t.interpolate||be,d="__p += '",p=Ce((t.escape||be).source+"|"+c.source+"|"+(c===Q?de:be).source+"|"+(t.evaluate||be).source+"|$","g"),f="//# sourceURL="+(Ne.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++at+"]")+"\n";e.replace(p,(function(t,n,r,i,o,l){return r||(r=i),d+=e.slice(u,l).replace(_e,an),n&&(a=!0,d+="' +\n__e("+n+") +\n'"),o&&(s=!0,d+="';\n"+o+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),d+="';\n";var m=Ne.call(t,"variable")&&t.variable;if(m){if(ue.test(m))throw new Me("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(j,""):d).replace(G,"$1").replace(W,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Qo((function(){return Te(l,f+"return "+d).apply(n,h)}));if(g.source=d,Zs(g))throw g;return g},zn.times=function(e,t){if((e=fo(e))<1||e>d)return[];var n=f,r=xn(e,f);t=la(t),e-=f;for(var i=Zt(r,t);++n<e;)t(n);return i},zn.toFinite=po,zn.toInteger=fo,zn.toLength=mo,zn.toLower=function(e){return yo(e).toLowerCase()},zn.toNumber=go,zn.toSafeInteger=function(e){return e?or(fo(e),-d,d):0===e?e:0},zn.toString=yo,zn.toUpper=function(e){return yo(e).toUpperCase()},zn.trim=function(e,t,r){if((e=yo(e))&&(r||t===n))return Jt(e);if(!e||!(t=hi(t)))return e;var i=dn(e),a=dn(t);return _i(i,en(i,a),tn(i,a)+1).join("")},zn.trimEnd=function(e,t,r){if((e=yo(e))&&(r||t===n))return e.slice(0,pn(e)+1);if(!e||!(t=hi(t)))return e;var i=dn(e);return _i(i,0,tn(i,dn(t))+1).join("")},zn.trimStart=function(e,t,r){if((e=yo(e))&&(r||t===n))return e.replace(ie,"");if(!e||!(t=hi(t)))return e;var i=dn(e);return _i(i,en(i,dn(t))).join("")},zn.truncate=function(e,t){var r=30,i="...";if($s(t)){var a="separator"in t?t.separator:a;r="length"in t?fo(t.length):r,i="omission"in t?hi(t.omission):i}var s=(e=yo(e)).length;if(sn(e)){var o=dn(e);s=o.length}if(r>=s)return e;var l=r-cn(i);if(l<1)return i;var h=o?_i(o,0,l).join(""):e.slice(0,l);if(a===n)return h+i;if(o&&(l+=h.length-l),io(a)){if(e.slice(l).search(a)){var u,c=h;for(a.global||(a=Ce(a.source,yo(pe.exec(a))+"g")),a.lastIndex=0;u=a.exec(c);)var d=u.index;h=h.slice(0,d===n?l:d)}}else if(e.indexOf(hi(a),l)!=l){var p=h.lastIndexOf(a);p>-1&&(h=h.slice(0,p))}return h+i},zn.unescape=function(e){return(e=yo(e))&&Y.test(e)?e.replace(q,fn):e},zn.uniqueId=function(e){var t=++Fe;return yo(e)+t},zn.upperCase=Zo,zn.upperFirst=Jo,zn.each=vs,zn.eachRight=ys,zn.first=Wa,ol(zn,function(){var e={};return br(zn,(function(t,n){Ne.call(zn.prototype,n)||(e[n]=t)})),e}(),{chain:!1}),zn.VERSION="4.17.21",At(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){zn[e].placeholder=zn})),At(["drop","take"],(function(e,t){Gn.prototype[e]=function(r){r=r===n?1:yn(fo(r),0);var i=this.__filtered__&&!t?new Gn(this):this.clone();return i.__filtered__?i.__takeCount__=xn(r,i.__takeCount__):i.__views__.push({size:xn(r,f),type:e+(i.__dir__<0?"Right":"")}),i},Gn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),At(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Gn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:la(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),At(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Gn.prototype[e]=function(){return this[n](1).value()[0]}})),At(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Gn.prototype[e]=function(){return this.__filtered__?new Gn(this):this[n](1)}})),Gn.prototype.compact=function(){return this.filter(rl)},Gn.prototype.find=function(e){return this.filter(e).head()},Gn.prototype.findLast=function(e){return this.reverse().find(e)},Gn.prototype.invokeMap=Jr((function(e,t){return"function"==typeof e?new Gn(this):this.map((function(n){return Ir(n,e,t)}))})),Gn.prototype.reject=function(e){return this.filter(Ds(la(e)))},Gn.prototype.slice=function(e,t){e=fo(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Gn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==n&&(r=(t=fo(t))<0?r.dropRight(-t):r.take(t-e)),r)},Gn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Gn.prototype.toArray=function(){return this.take(f)},br(Gn.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),a=zn[i?"take"+("last"==t?"Right":""):t],s=i||/^find/.test(t);a&&(zn.prototype[t]=function(){var t=this.__wrapped__,o=i?[1]:arguments,l=t instanceof Gn,h=o[0],u=l||js(t),c=function(e){var t=a.apply(zn,Dt([e],o));return i&&d?t[0]:t};u&&r&&"function"==typeof h&&1!=h.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&u){t=m?t:new Gn(this);var g=e.apply(t,o);return g.__actions__.push({func:ds,args:[c],thisArg:n}),new jn(g,d)}return f&&m?e.apply(this,o):(g=this.thru(c),f?i?g.value()[0]:g.value():g)})})),At(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Re[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);zn.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(js(i)?i:[],e)}return this[n]((function(n){return t.apply(js(n)?n:[],e)}))}})),br(Gn.prototype,(function(e,t){var n=zn[t];if(n){var r=n.name+"";Ne.call(Rn,r)||(Rn[r]=[]),Rn[r].push({name:t,func:n})}})),Rn[zi(n,2).name]=[{name:"wrapper",func:n}],Gn.prototype.clone=function(){var e=new Gn(this.__wrapped__);return e.__actions__=Pi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Pi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Pi(this.__views__),e},Gn.prototype.reverse=function(){if(this.__filtered__){var e=new Gn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Gn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=js(e),r=t<0,i=n?e.length:0,a=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var a=n[r],s=a.size;switch(a.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=xn(t,e+s);break;case"takeRight":e=yn(e,t-s)}}return{start:e,end:t}}(0,i,this.__views__),s=a.start,o=a.end,l=o-s,h=r?o:s-1,u=this.__iteratees__,c=u.length,d=0,p=xn(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return fi(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[h+=t];++m<c;){var v=u[m],y=v.iteratee,x=v.type,b=y(g);if(2==x)g=b;else if(!b){if(1==x)continue e;break e}}f[d++]=g}return f},zn.prototype.at=ps,zn.prototype.chain=function(){return cs(this)},zn.prototype.commit=function(){return new jn(this.value(),this.__chain__)},zn.prototype.next=function(){this.__values__===n&&(this.__values__=co(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?n:this.__values__[this.__index__++]}},zn.prototype.plant=function(e){for(var t,r=this;r instanceof Vn;){var i=Ua(r);i.__index__=0,i.__values__=n,t?a.__wrapped__=i:t=i;var a=i;r=r.__wrapped__}return a.__wrapped__=e,t},zn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Gn){var t=e;return this.__actions__.length&&(t=new Gn(this)),(t=t.reverse()).__actions__.push({func:ds,args:[$a],thisArg:n}),new jn(t,this.__chain__)}return this.thru($a)},zn.prototype.toJSON=zn.prototype.valueOf=zn.prototype.value=function(){return fi(this.__wrapped__,this.__actions__)},zn.prototype.first=zn.prototype.head,et&&(zn.prototype[et]=function(){return this}),zn}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(pt._=mn,define((function(){return mn}))):mt?((mt.exports=mn)._=mn,ft._=mn):pt._=mn}).call(e)})),ape=Z(((e,t)=>{!function(){"use strict";var e,n={version:"6.4.2.2",use_lines:!0,use_xyz:!1},r=!1;if(void 0!==t&&t.exports?(t.exports=n,r=!0):("function"==typeof define&&define.amd&&define(n),"undefined"!=typeof document?window.ClipperLib=n:self.ClipperLib=n),r){var i="chrome";e="Netscape"}else{i=navigator.userAgent.toString().toLowerCase();e=navigator.appName}var a={};-1!=i.indexOf("chrome")&&-1==i.indexOf("chromium")?a.chrome=1:a.chrome=0,-1!=i.indexOf("chromium")?a.chromium=1:a.chromium=0,-1!=i.indexOf("safari")&&-1==i.indexOf("chrome")&&-1==i.indexOf("chromium")?a.safari=1:a.safari=0,-1!=i.indexOf("firefox")?a.firefox=1:a.firefox=0,-1!=i.indexOf("firefox/17")?a.firefox17=1:a.firefox17=0,-1!=i.indexOf("firefox/15")?a.firefox15=1:a.firefox15=0,-1!=i.indexOf("firefox/3")?a.firefox3=1:a.firefox3=0,-1!=i.indexOf("opera")?a.opera=1:a.opera=0,-1!=i.indexOf("msie 10")?a.msie10=1:a.msie10=0,-1!=i.indexOf("msie 9")?a.msie9=1:a.msie9=0,-1!=i.indexOf("msie 8")?a.msie8=1:a.msie8=0,-1!=i.indexOf("msie 7")?a.msie7=1:a.msie7=0,-1!=i.indexOf("msie ")?a.msie=1:a.msie=0,n.biginteger_used=null;var s;function o(e,t,r){n.biginteger_used=1,null!=e&&("number"==typeof e&&void 0===t?this.fromInt(e):"number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function l(){return new o(null,void 0,void 0)}"Microsoft Internet Explorer"==e?(o.prototype.am=function(e,t,n,r,i,a){for(var s=32767&t,o=t>>15;--a>=0;){var l=32767&this[e],h=this[e++]>>15,u=o*l+h*s;i=((l=s*l+((32767&u)<<15)+n[r]+(1073741823&i))>>>30)+(u>>>15)+o*h+(i>>>30),n[r++]=1073741823&l}return i},s=30):"Netscape"!=e?(o.prototype.am=function(e,t,n,r,i,a){for(;--a>=0;){var s=t*this[e++]+n[r]+i;i=Math.floor(s/67108864),n[r++]=67108863&s}return i},s=26):(o.prototype.am=function(e,t,n,r,i,a){for(var s=16383&t,o=t>>14;--a>=0;){var l=16383&this[e],h=this[e++]>>14,u=o*l+h*s;i=((l=s*l+((16383&u)<<14)+n[r]+i)>>28)+(u>>14)+o*h,n[r++]=268435455&l}return i},s=28),o.prototype.DB=s,o.prototype.DM=(1<<s)-1,o.prototype.DV=1<<s;o.prototype.FV=Math.pow(2,52),o.prototype.F1=52-s,o.prototype.F2=2*s-52;var h,u,c="0123456789abcdefghijklmnopqrstuvwxyz",d=new Array;for(h="0".charCodeAt(0),u=0;u<=9;++u)d[h++]=u;for(h="a".charCodeAt(0),u=10;u<36;++u)d[h++]=u;for(h="A".charCodeAt(0),u=10;u<36;++u)d[h++]=u;function p(e){return c.charAt(e)}function f(e,t){var n=d[e.charCodeAt(t)];return null==n?-1:n}function m(e){var t=l();return t.fromInt(e),t}function g(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function v(e){this.m=e}function y(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function x(e,t){return e&t}function b(e,t){return e|t}function _(e,t){return e^t}function w(e,t){return e&~t}function S(e){if(0==e)return-1;var t=0;return 65535&e||(e>>=16,t+=16),255&e||(e>>=8,t+=8),15&e||(e>>=4,t+=4),3&e||(e>>=2,t+=2),1&e||++t,t}function M(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function T(){}function E(e){return e}function A(e){this.r2=l(),this.q3=l(),o.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}v.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},v.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},y.prototype.convert=function(e){var t=l();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(o.ZERO)>0&&this.m.subTo(t,t),t},y.prototype.revert=function(e){var t=l();return e.copyTo(t),this.reduce(t),t},y.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e[t],r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[n=t+this.m.t]+=this.m.am(0,r,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},y.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},o.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},o.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},o.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,a=0;--r>=0;){var s=8==n?255&e[r]:f(e,r);s<0?"-"==e.charAt(r)&&(i=!0):(i=!1,0==a?this[this.t++]=s:a+n>this.DB?(this[this.t-1]|=(s&(1<<this.DB-a)-1)<<a,this[this.t++]=s>>this.DB-a):this[this.t-1]|=s<<a,(a+=n)>=this.DB&&(a-=this.DB))}8==n&&128&e[0]&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),i&&o.ZERO.subTo(this,this)},o.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},o.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s},o.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s},o.prototype.lShiftTo=function(e,t){var n,r=e%this.DB,i=this.DB-r,a=(1<<i)-1,s=Math.floor(e/this.DB),o=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t[n+s+1]=this[n]>>i|o,o=(this[n]&a)<<r;for(n=s-1;n>=0;--n)t[n]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()},o.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,a=(1<<r)-1;t[0]=this[n]>>r;for(var s=n+1;s<this.t;++s)t[s-n-1]|=(this[s]&a)<<i,t[s-n]=this[s]>>r;r>0&&(t[this.t-n-1]|=(this.s&a)<<i),t.t=this.t-n,t.clamp()}},o.prototype.subTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()},o.prototype.multiplyTo=function(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&o.ZERO.subTo(t,t)},o.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()},o.prototype.divRemTo=function(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=l());var a=l(),s=this.s,h=e.s,u=this.DB-g(r[r.t-1]);u>0?(r.lShiftTo(u,a),i.lShiftTo(u,n)):(r.copyTo(a),i.copyTo(n));var c=a.t,d=a[c-1];if(0!=d){var p=d*(1<<this.F1)+(c>1?a[c-2]>>this.F2:0),f=this.FV/p,m=(1<<this.F1)/p,v=1<<this.F2,y=n.t,x=y-c,b=null==t?l():t;for(a.dlShiftTo(x,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),o.ONE.dlShiftTo(c,b),b.subTo(a,a);a.t<c;)a[a.t++]=0;for(;--x>=0;){var _=n[--y]==d?this.DM:Math.floor(n[y]*f+(n[y-1]+v)*m);if((n[y]+=a.am(0,_,n,x,0,c))<_)for(a.dlShiftTo(x,b),n.subTo(b,n);n[y]<--_;)n.subTo(b,n)}null!=t&&(n.drShiftTo(c,t),s!=h&&o.ZERO.subTo(t,t)),n.t=c,n.clamp(),u>0&&n.rShiftTo(u,n),s<0&&o.ZERO.subTo(n,n)}}},o.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},o.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},o.prototype.exp=function(e,t){if(e>4294967295||e<1)return o.ONE;var n=l(),r=l(),i=t.convert(this),a=g(e)-1;for(i.copyTo(n);--a>=0;)if(t.sqrTo(n,r),(e&1<<a)>0)t.mulTo(r,i,n);else{var s=n;n=r,r=s}return t.revert(n)},o.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,a="",s=this.t,o=this.DB-s*this.DB%t;if(s-- >0)for(o<this.DB&&(n=this[s]>>o)>0&&(i=!0,a=p(n));s>=0;)o<t?(n=(this[s]&(1<<o)-1)<<t-o,n|=this[--s]>>(o+=this.DB-t)):(n=this[s]>>(o-=t)&r,o<=0&&(o+=this.DB,--s)),n>0&&(i=!0),i&&(a+=p(n));return i?a:"0"},o.prototype.negate=function(){var e=l();return o.ZERO.subTo(this,e),e},o.prototype.abs=function(){return this.s<0?this.negate():this},o.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this[n]-e[n]))return t;return 0},o.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+g(this[this.t-1]^this.s&this.DM)},o.prototype.mod=function(e){var t=l();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(o.ZERO)>0&&e.subTo(t,t),t},o.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new v(t):new y(t),this.exp(e,n)},o.ZERO=m(0),o.ONE=m(1),T.prototype.convert=E,T.prototype.revert=E,T.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},T.prototype.sqrTo=function(e,t){e.squareTo(t)},A.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=l();return e.copyTo(t),this.reduce(t),t},A.prototype.revert=function(e){return e},A.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},A.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},A.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var C=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],P=(1<<26)/C[C.length-1];o.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},o.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=m(n),i=l(),a=l(),s="";for(this.divRemTo(r,i,a);i.signum()>0;)s=(n+a.intValue()).toString(e).substr(1)+s,i.divRemTo(r,i,a);return a.intValue().toString(e)+s},o.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,a=0,s=0,l=0;l<e.length;++l){var h=f(e,l);h<0?"-"==e.charAt(l)&&0==this.signum()&&(i=!0):(s=t*s+h,++a>=n&&(this.dMultiply(r),this.dAddOffset(s,0),a=0,s=0))}a>0&&(this.dMultiply(Math.pow(t,a)),this.dAddOffset(s,0)),i&&o.ZERO.subTo(this,this)},o.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(o.ONE.shiftLeft(e-1),b,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(o.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=1+(e>>3),t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}},o.prototype.bitwiseTo=function(e,t,n){var r,i,a=Math.min(e.t,this.t);for(r=0;r<a;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){for(i=e.s&this.DM,r=a;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=a;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},o.prototype.changeBit=function(e,t){var n=o.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},o.prototype.addTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()},o.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},o.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},o.prototype.multiplyLowerTo=function(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n[--i]=0;for(r=n.t-this.t;i<r;++i)n[i+this.t]=this.am(0,e[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e[i],n,i,0,t-i);n.clamp()},o.prototype.multiplyUpperTo=function(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)},o.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n},o.prototype.millerRabin=function(e){var t=this.subtract(o.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);(e=e+1>>1)>C.length&&(e=C.length);for(var i=l(),a=0;a<e;++a){i.fromInt(C[Math.floor(Math.random()*C.length)]);var s=i.modPow(r,this);if(0!=s.compareTo(o.ONE)&&0!=s.compareTo(t)){for(var h=1;h++<n&&0!=s.compareTo(t);)if(0==(s=s.modPowInt(2,this)).compareTo(o.ONE))return!1;if(0!=s.compareTo(t))return!1}}return!0},o.prototype.clone=function(){var e=l();return this.copyTo(e),e},o.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},o.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},o.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},o.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},o.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this[e]&(1<<r)-1)<<8-r,n|=this[--e]>>(r+=this.DB-8)):(n=this[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),128&n&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t},o.prototype.equals=function(e){return 0==this.compareTo(e)},o.prototype.min=function(e){return this.compareTo(e)<0?this:e},o.prototype.max=function(e){return this.compareTo(e)>0?this:e},o.prototype.and=function(e){var t=l();return this.bitwiseTo(e,x,t),t},o.prototype.or=function(e){var t=l();return this.bitwiseTo(e,b,t),t},o.prototype.xor=function(e){var t=l();return this.bitwiseTo(e,_,t),t},o.prototype.andNot=function(e){var t=l();return this.bitwiseTo(e,w,t),t},o.prototype.not=function(){for(var e=l(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},o.prototype.shiftLeft=function(e){var t=l();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},o.prototype.shiftRight=function(e){var t=l();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},o.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+S(this[e]);return this.s<0?this.t*this.DB:-1},o.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=M(this[n]^t);return e},o.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},o.prototype.setBit=function(e){return this.changeBit(e,b)},o.prototype.clearBit=function(e){return this.changeBit(e,w)},o.prototype.flipBit=function(e){return this.changeBit(e,_)},o.prototype.add=function(e){var t=l();return this.addTo(e,t),t},o.prototype.subtract=function(e){var t=l();return this.subTo(e,t),t},o.prototype.multiply=function(e){var t=l();return this.multiplyTo(e,t),t},o.prototype.divide=function(e){var t=l();return this.divRemTo(e,t,null),t},o.prototype.remainder=function(e){var t=l();return this.divRemTo(e,null,t),t},o.prototype.divideAndRemainder=function(e){var t=l(),n=l();return this.divRemTo(e,t,n),new Array(t,n)},o.prototype.modPow=function(e,t){var n,r,i=e.bitLength(),a=m(1);if(i<=0)return a;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new v(t):t.isEven()?new A(t):new y(t);var s=new Array,o=3,h=n-1,u=(1<<n)-1;if(s[1]=r.convert(this),n>1){var c=l();for(r.sqrTo(s[1],c);o<=u;)s[o]=l(),r.mulTo(c,s[o-2],s[o]),o+=2}var d,p,f=e.t-1,x=!0,b=l();for(i=g(e[f])-1;f>=0;){for(i>=h?d=e[f]>>i-h&u:(d=(e[f]&(1<<i+1)-1)<<h-i,f>0&&(d|=e[f-1]>>this.DB+i-h)),o=n;!(1&d);)d>>=1,--o;if((i-=o)<0&&(i+=this.DB,--f),x)s[d].copyTo(a),x=!1;else{for(;o>1;)r.sqrTo(a,b),r.sqrTo(b,a),o-=2;o>0?r.sqrTo(a,b):(p=a,a=b,b=p),r.mulTo(b,s[d],a)}for(;f>=0&&!(e[f]&1<<i);)r.sqrTo(a,b),p=a,a=b,b=p,--i<0&&(i=this.DB-1,--f)}return r.revert(a)},o.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return o.ZERO;for(var n=e.clone(),r=this.clone(),i=m(1),a=m(0),s=m(0),l=m(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?((!i.isEven()||!a.isEven())&&(i.addTo(this,i),a.subTo(e,a)),i.rShiftTo(1,i)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);for(;r.isEven();)r.rShiftTo(1,r),t?((!s.isEven()||!l.isEven())&&(s.addTo(this,s),l.subTo(e,l)),s.rShiftTo(1,s)):l.isEven()||l.subTo(e,l),l.rShiftTo(1,l);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(s,i),a.subTo(l,a)):(r.subTo(n,r),t&&s.subTo(i,s),l.subTo(a,l))}return 0!=r.compareTo(o.ONE)?o.ZERO:l.compareTo(e)>=0?l.subtract(e):l.signum()<0?(l.addTo(e,l),l.signum()<0?l.add(e):l):l},o.prototype.pow=function(e){return this.exp(e,new T)},o.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),a=n.getLowestSetBit();if(a<0)return t;for(i<a&&(a=i),a>0&&(t.rShiftTo(a,t),n.rShiftTo(a,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return a>0&&n.lShiftTo(a,n),n},o.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n[0]<=C[C.length-1]){for(t=0;t<C.length;++t)if(n[0]==C[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<C.length;){for(var r=C[t],i=t+1;i<C.length&&r<P;)r*=C[i++];for(r=n.modInt(r);t<i;)if(r%C[t++]==0)return!1}return n.millerRabin(e)},o.prototype.square=function(){var e=l();return this.squareTo(e),e};var I=o;I.prototype.IsNegative=function(){return-1==this.compareTo(I.ZERO)},I.op_Equality=function(e,t){return 0==e.compareTo(t)},I.op_Inequality=function(e,t){return 0!=e.compareTo(t)},I.op_GreaterThan=function(e,t){return e.compareTo(t)>0},I.op_LessThan=function(e,t){return e.compareTo(t)<0},I.op_Addition=function(e,t){return new I(e,void 0,void 0).add(new I(t,void 0,void 0))},I.op_Subtraction=function(e,t){return new I(e,void 0,void 0).subtract(new I(t,void 0,void 0))},I.Int128Mul=function(e,t){return new I(e,void 0,void 0).multiply(new I(t,void 0,void 0))},I.op_Division=function(e,t){return e.divide(t)},I.prototype.ToDouble=function(){return parseFloat(this.toString())};var R=function(e,t){var n;if(void 0===Object.getOwnPropertyNames){for(n in t.prototype)(void 0===e.prototype[n]||e.prototype[n]===Object.prototype[n])&&(e.prototype[n]=t.prototype[n]);for(n in t)void 0===e[n]&&(e[n]=t[n]);e.$baseCtor=t}else{for(var r=Object.getOwnPropertyNames(t.prototype),i=0;i<r.length;i++)void 0===Object.getOwnPropertyDescriptor(e.prototype,r[i])&&Object.defineProperty(e.prototype,r[i],Object.getOwnPropertyDescriptor(t.prototype,r[i]));for(n in t)void 0===e[n]&&(e[n]=t[n]);e.$baseCtor=t}};n.Path=function(){return[]},n.Path.prototype.push=Array.prototype.push,n.Paths=function(){return[]},n.Paths.prototype.push=Array.prototype.push,n.DoublePoint=function(){var e=arguments;this.X=0,this.Y=0,1===e.length?(this.X=e[0].X,this.Y=e[0].Y):2===e.length&&(this.X=e[0],this.Y=e[1])},n.DoublePoint0=function(){this.X=0,this.Y=0},n.DoublePoint0.prototype=n.DoublePoint.prototype,n.DoublePoint1=function(e){this.X=e.X,this.Y=e.Y},n.DoublePoint1.prototype=n.DoublePoint.prototype,n.DoublePoint2=function(e,t){this.X=e,this.Y=t},n.DoublePoint2.prototype=n.DoublePoint.prototype,n.PolyNode=function(){this.m_Parent=null,this.m_polygon=new n.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},n.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,t=this.m_Parent;null!==t;)e=!e,t=t.m_Parent;return e},n.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},n.PolyNode.prototype.Contour=function(){return this.m_polygon},n.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},n.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},n.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},n.PolyNode.prototype.Childs=function(){return this.m_Childs},n.PolyNode.prototype.Parent=function(){return this.m_Parent},n.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},n.PolyTree=function(){this.m_AllPolys=[],n.PolyNode.call(this)},n.PolyTree.prototype.Clear=function(){for(var e=0,t=this.m_AllPolys.length;e<t;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},n.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},n.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;return e>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&e--,e},R(n.PolyTree,n.PolyNode),n.Math_Abs_Int64=n.Math_Abs_Int32=n.Math_Abs_Double=function(e){return Math.abs(e)},n.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)},a.msie||a.opera||a.safari?n.Cast_Int32=function(e){return 0|e}:n.Cast_Int32=function(e){return~~e},void 0===Number.toInteger&&(Number.toInteger=null),a.chrome?n.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):~~e}:a.firefox&&"function"==typeof Number.toInteger?n.Cast_Int64=function(e){return Number.toInteger(e)}:a.msie7||a.msie8?n.Cast_Int64=function(e){return parseInt(e,10)}:a.msie?n.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):0|e}:n.Cast_Int64=function(e){return e<0?Math.ceil(e):Math.floor(e)},n.Clear=function(e){e.length=0},n.PI=3.141592653589793,n.PI2=6.283185307179586,n.IntPoint=function(){var e=arguments,t=e.length;if(this.X=0,this.Y=0,n.use_xyz)if(this.Z=0,3===t)this.X=e[0],this.Y=e[1],this.Z=e[2];else if(2===t)this.X=e[0],this.Y=e[1],this.Z=0;else if(1===t)if(e[0]instanceof n.DoublePoint){var r=e[0];this.X=n.Clipper.Round(r.X),this.Y=n.Clipper.Round(r.Y),this.Z=0}else{void 0===(i=e[0]).Z&&(i.Z=0),this.X=i.X,this.Y=i.Y,this.Z=i.Z}else this.X=0,this.Y=0,this.Z=0;else if(2===t)this.X=e[0],this.Y=e[1];else if(1===t)if(e[0]instanceof n.DoublePoint){r=e[0];this.X=n.Clipper.Round(r.X),this.Y=n.Clipper.Round(r.Y)}else{var i=e[0];this.X=i.X,this.Y=i.Y}else this.X=0,this.Y=0},n.IntPoint.op_Equality=function(e,t){return e.X===t.X&&e.Y===t.Y},n.IntPoint.op_Inequality=function(e,t){return e.X!==t.X||e.Y!==t.Y},n.IntPoint0=function(){this.X=0,this.Y=0,n.use_xyz&&(this.Z=0)},n.IntPoint0.prototype=n.IntPoint.prototype,n.IntPoint1=function(e){this.X=e.X,this.Y=e.Y,n.use_xyz&&(void 0===e.Z?this.Z=0:this.Z=e.Z)},n.IntPoint1.prototype=n.IntPoint.prototype,n.IntPoint1dp=function(e){this.X=n.Clipper.Round(e.X),this.Y=n.Clipper.Round(e.Y),n.use_xyz&&(this.Z=0)},n.IntPoint1dp.prototype=n.IntPoint.prototype,n.IntPoint2=function(e,t,r){this.X=e,this.Y=t,n.use_xyz&&(this.Z=void 0===r?0:r)},n.IntPoint2.prototype=n.IntPoint.prototype,n.IntRect=function(){var e=arguments,t=e.length;if(4===t)this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3];else if(1===t){var n=e[0];this.left=n.left,this.top=n.top,this.right=n.right,this.bottom=n.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},n.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},n.IntRect0.prototype=n.IntRect.prototype,n.IntRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},n.IntRect1.prototype=n.IntRect.prototype,n.IntRect4=function(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r},n.IntRect4.prototype=n.IntRect.prototype,n.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},n.PolyType={ptSubject:0,ptClip:1},n.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},n.JoinType={jtSquare:0,jtRound:1,jtMiter:2},n.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},n.EdgeSide={esLeft:0,esRight:1},n.Direction={dRightToLeft:0,dLeftToRight:1},n.TEdge=function(){this.Bot=new n.IntPoint0,this.Curr=new n.IntPoint0,this.Top=new n.IntPoint0,this.Delta=new n.IntPoint0,this.Dx=0,this.PolyTyp=n.PolyType.ptSubject,this.Side=n.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},n.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new n.IntPoint0},n.MyIntersectNodeSort=function(){},n.MyIntersectNodeSort.Compare=function(e,t){var n=t.Pt.Y-e.Pt.Y;return n>0?1:n<0?-1:0},n.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},n.Scanbeam=function(){this.Y=0,this.Next=null},n.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},n.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},n.OutPt=function(){this.Idx=0,this.Pt=new n.IntPoint0,this.Next=null,this.Prev=null},n.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new n.IntPoint0},n.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},n.ClipperBase.horizontal=-9007199254740992,n.ClipperBase.Skip=-2,n.ClipperBase.Unassigned=-1,n.ClipperBase.tolerance=1e-20,n.ClipperBase.loRange=47453132,n.ClipperBase.hiRange=0xfffffffffffff,n.ClipperBase.near_zero=function(e){return e>-n.ClipperBase.tolerance&&e<n.ClipperBase.tolerance},n.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y},n.ClipperBase.prototype.PointIsVertex=function(e,t){var r=t;do{if(n.IntPoint.op_Equality(r.Pt,e))return!0;r=r.Next}while(r!==t);return!1},n.ClipperBase.prototype.PointOnLineSegment=function(e,t,n,r){return r?e.X===t.X&&e.Y===t.Y||e.X===n.X&&e.Y===n.Y||e.X>t.X==e.X<n.X&&e.Y>t.Y==e.Y<n.Y&&I.op_Equality(I.Int128Mul(e.X-t.X,n.Y-t.Y),I.Int128Mul(n.X-t.X,e.Y-t.Y)):e.X===t.X&&e.Y===t.Y||e.X===n.X&&e.Y===n.Y||e.X>t.X==e.X<n.X&&e.Y>t.Y==e.Y<n.Y&&(e.X-t.X)*(n.Y-t.Y)==(n.X-t.X)*(e.Y-t.Y)},n.ClipperBase.prototype.PointOnPolygon=function(e,t,n){for(var r=t;;){if(this.PointOnLineSegment(e,r.Pt,r.Next.Pt,n))return!0;if((r=r.Next)===t)break}return!1},n.ClipperBase.prototype.SlopesEqual=n.ClipperBase.SlopesEqual=function(){var e,t,r,i,a,s,o=arguments,l=o.length;return 3===l?(e=o[0],t=o[1],o[2]?I.op_Equality(I.Int128Mul(e.Delta.Y,t.Delta.X),I.Int128Mul(e.Delta.X,t.Delta.Y)):n.Cast_Int64(e.Delta.Y*t.Delta.X)===n.Cast_Int64(e.Delta.X*t.Delta.Y)):4===l?(r=o[0],i=o[1],a=o[2],o[3]?I.op_Equality(I.Int128Mul(r.Y-i.Y,i.X-a.X),I.Int128Mul(r.X-i.X,i.Y-a.Y)):n.Cast_Int64((r.Y-i.Y)*(i.X-a.X))-n.Cast_Int64((r.X-i.X)*(i.Y-a.Y))==0):(r=o[0],i=o[1],a=o[2],s=o[3],o[4]?I.op_Equality(I.Int128Mul(r.Y-i.Y,a.X-s.X),I.Int128Mul(r.X-i.X,a.Y-s.Y)):n.Cast_Int64((r.Y-i.Y)*(a.X-s.X))-n.Cast_Int64((r.X-i.X)*(a.Y-s.Y))==0)},n.ClipperBase.SlopesEqual3=function(e,t,r){return r?I.op_Equality(I.Int128Mul(e.Delta.Y,t.Delta.X),I.Int128Mul(e.Delta.X,t.Delta.Y)):n.Cast_Int64(e.Delta.Y*t.Delta.X)===n.Cast_Int64(e.Delta.X*t.Delta.Y)},n.ClipperBase.SlopesEqual4=function(e,t,r,i){return i?I.op_Equality(I.Int128Mul(e.Y-t.Y,t.X-r.X),I.Int128Mul(e.X-t.X,t.Y-r.Y)):n.Cast_Int64((e.Y-t.Y)*(t.X-r.X))-n.Cast_Int64((e.X-t.X)*(t.Y-r.Y))==0},n.ClipperBase.SlopesEqual5=function(e,t,r,i,a){return a?I.op_Equality(I.Int128Mul(e.Y-t.Y,r.X-i.X),I.Int128Mul(e.X-t.X,r.Y-i.Y)):n.Cast_Int64((e.Y-t.Y)*(r.X-i.X))-n.Cast_Int64((e.X-t.X)*(r.Y-i.Y))==0},n.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,t=this.m_edges.length;e<t;++e){for(var r=0,i=this.m_edges[e].length;r<i;++r)this.m_edges[e][r]=null;n.Clear(this.m_edges[e])}n.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},n.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var e=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=e}this.m_CurrentLM=null},n.ClipperBase.prototype.RangeTest=function(e,t){t.Value?(e.X>n.ClipperBase.hiRange||e.Y>n.ClipperBase.hiRange||-e.X>n.ClipperBase.hiRange||-e.Y>n.ClipperBase.hiRange)&&n.Error("Coordinate outside allowed range in RangeTest()."):(e.X>n.ClipperBase.loRange||e.Y>n.ClipperBase.loRange||-e.X>n.ClipperBase.loRange||-e.Y>n.ClipperBase.loRange)&&(t.Value=!0,this.RangeTest(e,t))},n.ClipperBase.prototype.InitEdge=function(e,t,r,i){e.Next=t,e.Prev=r,e.Curr.X=i.X,e.Curr.Y=i.Y,n.use_xyz&&(e.Curr.Z=i.Z),e.OutIdx=-1},n.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,n.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,n.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,n.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,n.use_xyz&&(e.Bot.Z=e.Next.Curr.Z)),this.SetDx(e),e.PolyTyp=t},n.ClipperBase.prototype.FindNextLocMin=function(e){for(var t;;){for(;n.IntPoint.op_Inequality(e.Bot,e.Prev.Bot)||n.IntPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!==n.ClipperBase.horizontal&&e.Prev.Dx!==n.ClipperBase.horizontal)break;for(;e.Prev.Dx===n.ClipperBase.horizontal;)e=e.Prev;for(t=e;e.Dx===n.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!==e.Prev.Bot.Y){t.Prev.Bot.X<e.Bot.X&&(e=t);break}}return e},n.ClipperBase.prototype.ProcessBound=function(e,t){var r,i,a=e;if(a.OutIdx===n.ClipperBase.Skip){if(e=a,t){for(;e.Top.Y===e.Next.Bot.Y;)e=e.Next;for(;e!==a&&e.Dx===n.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y===e.Prev.Bot.Y;)e=e.Prev;for(;e!==a&&e.Dx===n.ClipperBase.horizontal;)e=e.Next}if(e===a)a=t?e.Next:e.Prev;else{e=t?a.Next:a.Prev;var s=new n.LocalMinima;s.Next=null,s.Y=e.Bot.Y,s.LeftBound=null,s.RightBound=e,e.WindDelta=0,a=this.ProcessBound(e,t),this.InsertLocalMinima(s)}return a}if(e.Dx===n.ClipperBase.horizontal&&((r=t?e.Prev:e.Next).Dx===n.ClipperBase.horizontal?r.Bot.X!==e.Bot.X&&r.Top.X!==e.Bot.X&&this.ReverseHorizontal(e):r.Bot.X!==e.Bot.X&&this.ReverseHorizontal(e)),r=e,t){for(;a.Top.Y===a.Next.Bot.Y&&a.Next.OutIdx!==n.ClipperBase.Skip;)a=a.Next;if(a.Dx===n.ClipperBase.horizontal&&a.Next.OutIdx!==n.ClipperBase.Skip){for(i=a;i.Prev.Dx===n.ClipperBase.horizontal;)i=i.Prev;i.Prev.Top.X>a.Next.Top.X&&(a=i.Prev)}for(;e!==a;)e.NextInLML=e.Next,e.Dx===n.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx===n.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),a=a.Next}else{for(;a.Top.Y===a.Prev.Bot.Y&&a.Prev.OutIdx!==n.ClipperBase.Skip;)a=a.Prev;if(a.Dx===n.ClipperBase.horizontal&&a.Prev.OutIdx!==n.ClipperBase.Skip){for(i=a;i.Next.Dx===n.ClipperBase.horizontal;)i=i.Next;(i.Next.Top.X===a.Prev.Top.X||i.Next.Top.X>a.Prev.Top.X)&&(a=i.Next)}for(;e!==a;)e.NextInLML=e.Prev,e.Dx===n.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx===n.ClipperBase.horizontal&&e!==r&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),a=a.Prev}return a},n.ClipperBase.prototype.AddPath=function(e,t,r){n.use_lines?!r&&t===n.PolyType.ptClip&&n.Error("AddPath: Open paths must be subject."):r||n.Error("AddPath: Open paths have been disabled.");var i=e.length-1;if(r)for(;i>0&&n.IntPoint.op_Equality(e[i],e[0]);)--i;for(;i>0&&n.IntPoint.op_Equality(e[i],e[i-1]);)--i;if(r&&i<2||!r&&i<1)return!1;for(var a=new Array,s=0;s<=i;s++)a.push(new n.TEdge);var o=!0;a[1].Curr.X=e[1].X,a[1].Curr.Y=e[1].Y,n.use_xyz&&(a[1].Curr.Z=e[1].Z);var l={Value:this.m_UseFullRange};this.RangeTest(e[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(e[i],l),this.m_UseFullRange=l.Value,this.InitEdge(a[0],a[1],a[i],e[0]),this.InitEdge(a[i],a[0],a[i-1],e[i]);for(s=i-1;s>=1;--s)l.Value=this.m_UseFullRange,this.RangeTest(e[s],l),this.m_UseFullRange=l.Value,this.InitEdge(a[s],a[s+1],a[s-1],e[s]);for(var h=a[0],u=h,c=h;;)if(u.Curr!==u.Next.Curr||!r&&u.Next===h){if(u.Prev===u.Next)break;if(!r||!n.ClipperBase.SlopesEqual4(u.Prev.Curr,u.Curr,u.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(u.Prev.Curr,u.Curr,u.Next.Curr)){if((u=u.Next)===c||!r&&u.Next===h)break}else u===h&&(h=u.Next),c=u=(u=this.RemoveEdge(u)).Prev}else{if(u===u.Next)break;u===h&&(h=u.Next),c=u=this.RemoveEdge(u)}if(!r&&u===u.Next||r&&u.Prev===u.Next)return!1;r||(this.m_HasOpenPaths=!0,h.Prev.OutIdx=n.ClipperBase.Skip),u=h;do{this.InitEdge2(u,t),u=u.Next,o&&u.Curr.Y!==h.Curr.Y&&(o=!1)}while(u!==h);if(o){if(r)return!1;for(u.Prev.OutIdx=n.ClipperBase.Skip,(f=new n.LocalMinima).Next=null,f.Y=u.Bot.Y,f.LeftBound=null,f.RightBound=u,f.RightBound.Side=n.EdgeSide.esRight,f.RightBound.WindDelta=0;u.Bot.X!==u.Prev.Top.X&&this.ReverseHorizontal(u),u.Next.OutIdx!==n.ClipperBase.Skip;)u.NextInLML=u.Next,u=u.Next;return this.InsertLocalMinima(f),this.m_edges.push(a),!0}this.m_edges.push(a);var d,p=null;for(n.IntPoint.op_Equality(u.Prev.Bot,u.Prev.Top)&&(u=u.Next);(u=this.FindNextLocMin(u))!==p;){var f;null===p&&(p=u),(f=new n.LocalMinima).Next=null,f.Y=u.Bot.Y,u.Dx<u.Prev.Dx?(f.LeftBound=u.Prev,f.RightBound=u,d=!1):(f.LeftBound=u,f.RightBound=u.Prev,d=!0),f.LeftBound.Side=n.EdgeSide.esLeft,f.RightBound.Side=n.EdgeSide.esRight,r?f.LeftBound.Next===f.RightBound?f.LeftBound.WindDelta=-1:f.LeftBound.WindDelta=1:f.LeftBound.WindDelta=0,f.RightBound.WindDelta=-f.LeftBound.WindDelta,(u=this.ProcessBound(f.LeftBound,d)).OutIdx===n.ClipperBase.Skip&&(u=this.ProcessBound(u,d));var m=this.ProcessBound(f.RightBound,!d);m.OutIdx===n.ClipperBase.Skip&&(m=this.ProcessBound(m,!d)),f.LeftBound.OutIdx===n.ClipperBase.Skip?f.LeftBound=null:f.RightBound.OutIdx===n.ClipperBase.Skip&&(f.RightBound=null),this.InsertLocalMinima(f),d||(u=m)}return!0},n.ClipperBase.prototype.AddPaths=function(e,t,n){for(var r=!1,i=0,a=e.length;i<a;++i)this.AddPath(e[i],t,n)&&(r=!0);return r},n.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,r){return!(n.IntPoint.op_Equality(e,r)||n.IntPoint.op_Equality(e,t)||n.IntPoint.op_Equality(r,t))&&(e.X!==r.X?t.X>e.X==t.X<r.X:t.Y>e.Y==t.Y<r.Y)},n.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},n.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,0===e.Delta.Y?e.Dx=n.ClipperBase.horizontal:e.Dx=e.Delta.X/e.Delta.Y},n.ClipperBase.prototype.InsertLocalMinima=function(e){if(null===this.m_MinimaList)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var t=this.m_MinimaList;null!==t.Next&&e.Y<t.Next.Y;)t=t.Next;e.Next=t.Next,t.Next=e}},n.ClipperBase.prototype.PopLocalMinima=function(e,t){return t.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===e&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},n.ClipperBase.prototype.ReverseHorizontal=function(e){var t=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=t,n.use_xyz&&(t=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=t)},n.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var e=this.m_MinimaList;null!==e;){this.InsertScanbeam(e.Y);var t=e.LeftBound;null!==t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,n.use_xyz&&(t.Curr.Z=t.Bot.Z),t.OutIdx=n.ClipperBase.Unassigned),null!==(t=e.RightBound)&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,n.use_xyz&&(t.Curr.Z=t.Bot.Z),t.OutIdx=n.ClipperBase.Unassigned),e=e.Next}this.m_ActiveEdges=null}},n.ClipperBase.prototype.InsertScanbeam=function(e){if(null===this.m_Scanbeam)this.m_Scanbeam=new n.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new n.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{for(var r=this.m_Scanbeam;null!==r.Next&&e<=r.Next.Y;)r=r.Next;if(e===r.Y)return;var i=new n.Scanbeam;i.Y=e,i.Next=r.Next,r.Next=i}},n.ClipperBase.prototype.PopScanbeam=function(e){return null===this.m_Scanbeam?(e.v=0,!1):(e.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},n.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},n.ClipperBase.prototype.CreateOutRec=function(){var e=new n.OutRec;return e.Idx=n.ClipperBase.Unassigned,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},n.ClipperBase.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];t.Pts=null,t=null,this.m_PolyOuts[e]=null},n.ClipperBase.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&n.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,r=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,null!==t?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,null!==r&&(r.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,(e=e.NextInLML).Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.PrevInAEL=t,e.NextInAEL=r,n.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},n.ClipperBase.prototype.SwapPositionsInAEL=function(e,t){if(e.NextInAEL!==e.PrevInAEL&&t.NextInAEL!==t.PrevInAEL){if(e.NextInAEL===t){var n=t.NextInAEL;null!==n&&(n.PrevInAEL=e);var r=e.PrevInAEL;null!==r&&(r.NextInAEL=t),t.PrevInAEL=r,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=n}else if(t.NextInAEL===e){var i=e.NextInAEL;null!==i&&(i.PrevInAEL=t);var a=t.PrevInAEL;null!==a&&(a.NextInAEL=e),e.PrevInAEL=a,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=i}else{var s=e.NextInAEL,o=e.PrevInAEL;e.NextInAEL=t.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=s,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=o,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t)}null===e.PrevInAEL?this.m_ActiveEdges=e:null===t.PrevInAEL&&(this.m_ActiveEdges=t)}},n.ClipperBase.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,n=e.NextInAEL;null===t&&null===n&&e!==this.m_ActiveEdges||(null!==t?t.NextInAEL=n:this.m_ActiveEdges=n,null!==n&&(n.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null)},n.Clipper=function(e){void 0===e&&(e=0),this.m_PolyOuts=null,this.m_ClipType=n.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=n.PolyFillType.pftEvenOdd,this.m_SubjFillType=n.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,n.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=n.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&e),this.StrictlySimple=0!=(2&e),this.PreserveCollinear=0!=(4&e),n.use_xyz&&(this.ZFillFunction=null)},n.Clipper.ioReverseSolution=1,n.Clipper.ioStrictlySimple=2,n.Clipper.ioPreserveCollinear=4,n.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),n.ClipperBase.prototype.Clear.call(this))},n.Clipper.prototype.InsertMaxima=function(e){var t=new n.Maxima;if(t.X=e,null===this.m_Maxima)this.m_Maxima=t,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(e<this.m_Maxima.X)t.Next=this.m_Maxima,t.Prev=null,this.m_Maxima=t;else{for(var r=this.m_Maxima;null!==r.Next&&e>=r.Next.X;)r=r.Next;if(e===r.X)return;t.Next=r.Next,t.Prev=r,null!==r.Next&&(r.Next.Prev=t),r.Next=t}},n.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,r=e[1]instanceof n.PolyTree;if(4===t&&!r){var i=e[0],a=e[1],s=e[2],o=e[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&n.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,n.Clear(a),this.m_SubjFillType=s,this.m_ClipFillType=o,this.m_ClipType=i,this.m_UsingPolyTree=!1;try{(h=this.ExecuteInternal())&&this.BuildResult(a)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(4===t&&r){i=e[0];var l=e[1];s=e[2],o=e[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=s,this.m_ClipFillType=o,this.m_ClipType=i,this.m_UsingPolyTree=!0;try{var h;(h=this.ExecuteInternal())&&this.BuildResult2(l)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(2===t&&!r){i=e[0],a=e[1];return this.Execute(i,a,n.PolyFillType.pftEvenOdd,n.PolyFillType.pftEvenOdd)}if(2===t&&r){i=e[0],l=e[1];return this.Execute(i,l,n.PolyFillType.pftEvenOdd,n.PolyFillType.pftEvenOdd)}},n.Clipper.prototype.FixHoleLinkage=function(e){if(null!==e.FirstLeft&&(e.IsHole===e.FirstLeft.IsHole||null===e.FirstLeft.Pts)){for(var t=e.FirstLeft;null!==t&&(t.IsHole===e.IsHole||null===t.Pts);)t=t.FirstLeft;e.FirstLeft=t}},n.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var e,t,n,r={},i={};if(!this.PopScanbeam(r))return!1;for(this.InsertLocalMinimaIntoAEL(r.v);this.PopScanbeam(i)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(i.v))return!1;this.ProcessEdgesAtTopOfScanbeam(i.v),r.v=i.v,this.InsertLocalMinimaIntoAEL(r.v)}for(t=0,n=this.m_PolyOuts.length;t<n;t++)null!==(e=this.m_PolyOuts[t]).Pts&&!e.IsOpen&&(e.IsHole^this.ReverseSolution)==this.Area$1(e)>0&&this.ReversePolyPtLinks(e.Pts);for(this.JoinCommonEdges(),t=0,n=this.m_PolyOuts.length;t<n;t++)null!==(e=this.m_PolyOuts[t]).Pts&&(e.IsOpen?this.FixupOutPolyline(e):this.FixupOutPolygon(e));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},n.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,t=this.m_PolyOuts.length;e<t;++e)this.DisposeOutRec(e);n.Clear(this.m_PolyOuts)},n.Clipper.prototype.AddJoin=function(e,t,r){var i=new n.Join;i.OutPt1=e,i.OutPt2=t,i.OffPt.X=r.X,i.OffPt.Y=r.Y,n.use_xyz&&(i.OffPt.Z=r.Z),this.m_Joins.push(i)},n.Clipper.prototype.AddGhostJoin=function(e,t){var r=new n.Join;r.OutPt1=e,r.OffPt.X=t.X,r.OffPt.Y=t.Y,n.use_xyz&&(r.OffPt.Z=t.Z),this.m_GhostJoins.push(r)},n.Clipper.prototype.SetZ=function(e,t,r){if(null!==this.ZFillFunction){if(0!==e.Z||null===this.ZFillFunction)return;n.IntPoint.op_Equality(e,t.Bot)?e.Z=t.Bot.Z:n.IntPoint.op_Equality(e,t.Top)?e.Z=t.Top.Z:n.IntPoint.op_Equality(e,r.Bot)?e.Z=r.Bot.Z:n.IntPoint.op_Equality(e,r.Top)?e.Z=r.Top.Z:this.ZFillFunction(t.Bot,t.Top,r.Bot,r.Top,e)}},n.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var t,r,i={};this.PopLocalMinima(e,i);){t=i.v.LeftBound,r=i.v.RightBound;var a=null;if(null===t?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(a=this.AddOutPt(r,r.Bot))):null===r?(this.InsertEdgeIntoAEL(t,null),this.SetWindingCount(t),this.IsContributing(t)&&(a=this.AddOutPt(t,t.Bot)),this.InsertScanbeam(t.Top.Y)):(this.InsertEdgeIntoAEL(t,null),this.InsertEdgeIntoAEL(r,t),this.SetWindingCount(t),r.WindCnt=t.WindCnt,r.WindCnt2=t.WindCnt2,this.IsContributing(t)&&(a=this.AddLocalMinPoly(t,r,t.Bot)),this.InsertScanbeam(t.Top.Y)),null!==r&&(n.ClipperBase.IsHorizontal(r)?(null!==r.NextInLML&&this.InsertScanbeam(r.NextInLML.Top.Y),this.AddEdgeToSEL(r)):this.InsertScanbeam(r.Top.Y)),null!==t&&null!==r){if(null!==a&&n.ClipperBase.IsHorizontal(r)&&this.m_GhostJoins.length>0&&0!==r.WindDelta)for(var s=0,o=this.m_GhostJoins.length;s<o;s++){var l=this.m_GhostJoins[s];this.HorzSegmentsOverlap(l.OutPt1.Pt.X,l.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(l.OutPt1,a,l.OffPt)}if(t.OutIdx>=0&&null!==t.PrevInAEL&&t.PrevInAEL.Curr.X===t.Bot.X&&t.PrevInAEL.OutIdx>=0&&n.ClipperBase.SlopesEqual5(t.PrevInAEL.Curr,t.PrevInAEL.Top,t.Curr,t.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==t.PrevInAEL.WindDelta){var h=this.AddOutPt(t.PrevInAEL,t.Bot);this.AddJoin(a,h,t.Top)}if(t.NextInAEL!==r){if(r.OutIdx>=0&&r.PrevInAEL.OutIdx>=0&&n.ClipperBase.SlopesEqual5(r.PrevInAEL.Curr,r.PrevInAEL.Top,r.Curr,r.Top,this.m_UseFullRange)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta){h=this.AddOutPt(r.PrevInAEL,r.Bot);this.AddJoin(a,h,r.Top)}var u=t.NextInAEL;if(null!==u)for(;u!==r;)this.IntersectEdges(r,u,t.Curr),u=u.NextInAEL}}}},n.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(null===this.m_ActiveEdges)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(null===t&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=e,this.m_ActiveEdges=e;else{for(null===t&&(t=this.m_ActiveEdges);null!==t.NextInAEL&&!this.E2InsertsBeforeE1(t.NextInAEL,e);)t=t.NextInAEL;e.NextInAEL=t.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},n.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X===e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<n.Clipper.TopX(e,t.Top.Y):e.Top.X>n.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},n.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp===n.PolyType.ptSubject?this.m_SubjFillType===n.PolyFillType.pftEvenOdd:this.m_ClipFillType===n.PolyFillType.pftEvenOdd},n.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp===n.PolyType.ptSubject?this.m_ClipFillType===n.PolyFillType.pftEvenOdd:this.m_SubjFillType===n.PolyFillType.pftEvenOdd},n.Clipper.prototype.IsContributing=function(e){var t,r;switch(e.PolyTyp===n.PolyType.ptSubject?(t=this.m_SubjFillType,r=this.m_ClipFillType):(t=this.m_ClipFillType,r=this.m_SubjFillType),t){case n.PolyFillType.pftEvenOdd:if(0===e.WindDelta&&1!==e.WindCnt)return!1;break;case n.PolyFillType.pftNonZero:if(1!==Math.abs(e.WindCnt))return!1;break;case n.PolyFillType.pftPositive:if(1!==e.WindCnt)return!1;break;default:if(-1!==e.WindCnt)return!1}switch(this.m_ClipType){case n.ClipType.ctIntersection:switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case n.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case n.ClipType.ctUnion:switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===e.WindCnt2;case n.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}case n.ClipType.ctDifference:if(e.PolyTyp===n.PolyType.ptSubject)switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===e.WindCnt2;case n.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}else switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case n.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case n.ClipType.ctXor:if(0!==e.WindDelta)return!0;switch(r){case n.PolyFillType.pftEvenOdd:case n.PolyFillType.pftNonZero:return 0===e.WindCnt2;case n.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}}return!0},n.Clipper.prototype.SetWindingCount=function(e){for(var t=e.PrevInAEL;null!==t&&(t.PolyTyp!==e.PolyTyp||0===t.WindDelta);)t=t.PrevInAEL;if(null===t){var r=e.PolyTyp===n.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;0===e.WindDelta?e.WindCnt=r===n.PolyFillType.pftNegative?-1:1:e.WindCnt=e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges}else if(0===e.WindDelta&&this.m_ClipType!==n.ClipType.ctUnion)e.WindCnt=1,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;else if(this.IsEvenOddFillType(e)){if(0===e.WindDelta){for(var i=!0,a=t.PrevInAEL;null!==a;)a.PolyTyp===t.PolyTyp&&0!==a.WindDelta&&(i=!i),a=a.PrevInAEL;e.WindCnt=i?0:1}else e.WindCnt=e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}else t.WindCnt*t.WindDelta<0?Math.abs(t.WindCnt)>1?t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta:e.WindCnt=0===e.WindDelta?1:e.WindDelta:0===e.WindDelta?e.WindCnt=t.WindCnt<0?t.WindCnt-1:t.WindCnt+1:t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;if(this.IsEvenOddAltFillType(e))for(;t!==e;)0!==t.WindDelta&&(e.WindCnt2=0===e.WindCnt2?1:0),t=t.NextInAEL;else for(;t!==e;)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},n.Clipper.prototype.AddEdgeToSEL=function(e){null===this.m_SortedEdges?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=e,this.m_SortedEdges=e)},n.Clipper.prototype.PopEdgeFromSEL=function(e){if(e.v=this.m_SortedEdges,null===e.v)return!1;var t=e.v;return this.m_SortedEdges=e.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),t.NextInSEL=null,t.PrevInSEL=null,!0},n.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e=e.NextInAEL},n.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(!(null===e.NextInSEL&&null===e.PrevInSEL||null===t.NextInSEL&&null===t.PrevInSEL)){if(e.NextInSEL===t)null!==(n=t.NextInSEL)&&(n.PrevInSEL=e),null!==(r=e.PrevInSEL)&&(r.NextInSEL=t),t.PrevInSEL=r,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=n;else if(t.NextInSEL===e){null!==(n=e.NextInSEL)&&(n.PrevInSEL=t),null!==(r=t.PrevInSEL)&&(r.NextInSEL=e),e.PrevInSEL=r,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=n}else{var n=e.NextInSEL,r=e.PrevInSEL;e.NextInSEL=t.NextInSEL,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=n,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=r,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t)}null===e.PrevInSEL?this.m_SortedEdges=e:null===t.PrevInSEL&&(this.m_SortedEdges=t)}},n.Clipper.prototype.AddLocalMaxPoly=function(e,t,n){this.AddOutPt(e,n),0===t.WindDelta&&this.AddOutPt(t,n),e.OutIdx===t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},n.Clipper.prototype.AddLocalMinPoly=function(e,t,r){var i,a,s;if(n.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(i=this.AddOutPt(e,r),t.OutIdx=e.OutIdx,e.Side=n.EdgeSide.esLeft,t.Side=n.EdgeSide.esRight,s=(a=e).PrevInAEL===t?t.PrevInAEL:a.PrevInAEL):(i=this.AddOutPt(t,r),e.OutIdx=t.OutIdx,e.Side=n.EdgeSide.esRight,t.Side=n.EdgeSide.esLeft,s=(a=t).PrevInAEL===e?e.PrevInAEL:a.PrevInAEL),null!==s&&s.OutIdx>=0&&s.Top.Y<r.Y&&a.Top.Y<r.Y){var o=n.Clipper.TopX(s,r.Y),l=n.Clipper.TopX(a,r.Y);if(o===l&&0!==a.WindDelta&&0!==s.WindDelta&&n.ClipperBase.SlopesEqual5(new n.IntPoint2(o,r.Y),s.Top,new n.IntPoint2(l,r.Y),a.Top,this.m_UseFullRange)){var h=this.AddOutPt(s,r);this.AddJoin(i,h,a.Top)}}return i},n.Clipper.prototype.AddOutPt=function(e,t){if(e.OutIdx<0){(i=this.CreateOutRec()).IsOpen=0===e.WindDelta;var r=new n.OutPt;return i.Pts=r,r.Idx=i.Idx,r.Pt.X=t.X,r.Pt.Y=t.Y,n.use_xyz&&(r.Pt.Z=t.Z),r.Next=r,r.Prev=r,i.IsOpen||this.SetHoleState(e,i),e.OutIdx=i.Idx,r}var i,a=(i=this.m_PolyOuts[e.OutIdx]).Pts,s=e.Side===n.EdgeSide.esLeft;return s&&n.IntPoint.op_Equality(t,a.Pt)?a:!s&&n.IntPoint.op_Equality(t,a.Prev.Pt)?a.Prev:((r=new n.OutPt).Idx=i.Idx,r.Pt.X=t.X,r.Pt.Y=t.Y,n.use_xyz&&(r.Pt.Z=t.Z),r.Next=a,r.Prev=a.Prev,r.Prev.Next=r,a.Prev=r,s&&(i.Pts=r),r)},n.Clipper.prototype.GetLastOutPt=function(e){var t=this.m_PolyOuts[e.OutIdx];return e.Side===n.EdgeSide.esLeft?t.Pts:t.Pts.Prev},n.Clipper.prototype.SwapPoints=function(e,t){var r=new n.IntPoint1(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,n.use_xyz&&(e.Value.Z=t.Value.Z),t.Value.X=r.X,t.Value.Y=r.Y,n.use_xyz&&(t.Value.Z=r.Z)},n.Clipper.prototype.HorzSegmentsOverlap=function(e,t,n,r){var i;return e>t&&(i=e,e=t,t=i),n>r&&(i=n,n=r,r=i),e<r&&n<t},n.Clipper.prototype.SetHoleState=function(e,t){for(var n=e.PrevInAEL,r=null;null!==n;)n.OutIdx>=0&&0!==n.WindDelta&&(null===r?r=n:r.OutIdx===n.OutIdx&&(r=null)),n=n.PrevInAEL;null===r?(t.FirstLeft=null,t.IsHole=!1):(t.FirstLeft=this.m_PolyOuts[r.OutIdx],t.IsHole=!t.FirstLeft.IsHole)},n.Clipper.prototype.GetDx=function(e,t){return e.Y===t.Y?n.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},n.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var r=e.Prev;n.IntPoint.op_Equality(r.Pt,e.Pt)&&r!==e;)r=r.Prev;var i=Math.abs(this.GetDx(e.Pt,r.Pt));for(r=e.Next;n.IntPoint.op_Equality(r.Pt,e.Pt)&&r!==e;)r=r.Next;var a=Math.abs(this.GetDx(e.Pt,r.Pt));for(r=t.Prev;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!==t;)r=r.Prev;var s=Math.abs(this.GetDx(t.Pt,r.Pt));for(r=t.Next;n.IntPoint.op_Equality(r.Pt,t.Pt)&&r!==t;)r=r.Next;var o=Math.abs(this.GetDx(t.Pt,r.Pt));return Math.max(i,a)===Math.max(s,o)&&Math.min(i,a)===Math.min(s,o)?this.Area(e)>0:i>=s&&i>=o||a>=s&&a>=o},n.Clipper.prototype.GetBottomPt=function(e){for(var t=null,r=e.Next;r!==e;)r.Pt.Y>e.Pt.Y?(e=r,t=null):r.Pt.Y===e.Pt.Y&&r.Pt.X<=e.Pt.X&&(r.Pt.X<e.Pt.X?(t=null,e=r):r.Next!==e&&r.Prev!==e&&(t=r)),r=r.Next;if(null!==t)for(;t!==r;)for(this.FirstIsBottomPt(r,t)||(e=t),t=t.Next;n.IntPoint.op_Inequality(t.Pt,e.Pt);)t=t.Next;return e},n.Clipper.prototype.GetLowermostRec=function(e,t){null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts)),null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts));var n=e.BottomPt,r=t.BottomPt;return n.Pt.Y>r.Pt.Y?e:n.Pt.Y<r.Pt.Y?t:n.Pt.X<r.Pt.X?e:n.Pt.X>r.Pt.X||n.Next===n?t:r.Next===r||this.FirstIsBottomPt(n,r)?e:t},n.Clipper.prototype.OutRec1RightOfOutRec2=function(e,t){do{if((e=e.FirstLeft)===t)return!0}while(null!==e);return!1},n.Clipper.prototype.GetOutRec=function(e){for(var t=this.m_PolyOuts[e];t!==this.m_PolyOuts[t.Idx];)t=this.m_PolyOuts[t.Idx];return t},n.Clipper.prototype.AppendPolygon=function(e,t){var r,i=this.m_PolyOuts[e.OutIdx],a=this.m_PolyOuts[t.OutIdx];r=this.OutRec1RightOfOutRec2(i,a)?a:this.OutRec1RightOfOutRec2(a,i)?i:this.GetLowermostRec(i,a);var s=i.Pts,o=s.Prev,l=a.Pts,h=l.Prev;e.Side===n.EdgeSide.esLeft?t.Side===n.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=s,s.Prev=l,o.Next=h,h.Prev=o,i.Pts=h):(h.Next=s,s.Prev=h,l.Prev=o,o.Next=l,i.Pts=l):t.Side===n.EdgeSide.esRight?(this.ReversePolyPtLinks(l),o.Next=h,h.Prev=o,l.Next=s,s.Prev=l):(o.Next=l,l.Prev=o,s.Prev=h,h.Next=s),i.BottomPt=null,r===a&&(a.FirstLeft!==i&&(i.FirstLeft=a.FirstLeft),i.IsHole=a.IsHole),a.Pts=null,a.BottomPt=null,a.FirstLeft=i;var u=e.OutIdx,c=t.OutIdx;e.OutIdx=-1,t.OutIdx=-1;for(var d=this.m_ActiveEdges;null!==d;){if(d.OutIdx===c){d.OutIdx=u,d.Side=e.Side;break}d=d.NextInAEL}a.Idx=i.Idx},n.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!==e){var t,n;t=e;do{n=t.Next,t.Next=t.Prev,t.Prev=n,t=n}while(t!==e)}},n.Clipper.SwapSides=function(e,t){var n=e.Side;e.Side=t.Side,t.Side=n},n.Clipper.SwapPolyIndexes=function(e,t){var n=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=n},n.Clipper.prototype.IntersectEdges=function(e,t,r){var i=e.OutIdx>=0,a=t.OutIdx>=0;if(n.use_xyz&&this.SetZ(r,e,t),!n.use_lines||0!==e.WindDelta&&0!==t.WindDelta){if(e.PolyTyp===t.PolyTyp)if(this.IsEvenOddFillType(e)){var s=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=s}else e.WindCnt+t.WindDelta===0?e.WindCnt=-e.WindCnt:e.WindCnt+=t.WindDelta,t.WindCnt-e.WindDelta==0?t.WindCnt=-t.WindCnt:t.WindCnt-=e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2-=e.WindDelta;var o,l,h,u,c,d;switch(e.PolyTyp===n.PolyType.ptSubject?(o=this.m_SubjFillType,h=this.m_ClipFillType):(o=this.m_ClipFillType,h=this.m_SubjFillType),t.PolyTyp===n.PolyType.ptSubject?(l=this.m_SubjFillType,u=this.m_ClipFillType):(l=this.m_ClipFillType,u=this.m_SubjFillType),o){case n.PolyFillType.pftPositive:c=e.WindCnt;break;case n.PolyFillType.pftNegative:c=-e.WindCnt;break;default:c=Math.abs(e.WindCnt)}switch(l){case n.PolyFillType.pftPositive:d=t.WindCnt;break;case n.PolyFillType.pftNegative:d=-t.WindCnt;break;default:d=Math.abs(t.WindCnt)}if(i&&a)0!==c&&1!==c||0!==d&&1!==d||e.PolyTyp!==t.PolyTyp&&this.m_ClipType!==n.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):(this.AddOutPt(e,r),this.AddOutPt(t,r),n.Clipper.SwapSides(e,t),n.Clipper.SwapPolyIndexes(e,t));else if(i)(0===d||1===d)&&(this.AddOutPt(e,r),n.Clipper.SwapSides(e,t),n.Clipper.SwapPolyIndexes(e,t));else if(a)(0===c||1===c)&&(this.AddOutPt(t,r),n.Clipper.SwapSides(e,t),n.Clipper.SwapPolyIndexes(e,t));else if(!(0!==c&&1!==c||0!==d&&1!==d)){var p,f;switch(h){case n.PolyFillType.pftPositive:p=e.WindCnt2;break;case n.PolyFillType.pftNegative:p=-e.WindCnt2;break;default:p=Math.abs(e.WindCnt2)}switch(u){case n.PolyFillType.pftPositive:f=t.WindCnt2;break;case n.PolyFillType.pftNegative:f=-t.WindCnt2;break;default:f=Math.abs(t.WindCnt2)}if(e.PolyTyp!==t.PolyTyp)this.AddLocalMinPoly(e,t,r);else if(1===c&&1===d)switch(this.m_ClipType){case n.ClipType.ctIntersection:p>0&&f>0&&this.AddLocalMinPoly(e,t,r);break;case n.ClipType.ctUnion:p<=0&&f<=0&&this.AddLocalMinPoly(e,t,r);break;case n.ClipType.ctDifference:(e.PolyTyp===n.PolyType.ptClip&&p>0&&f>0||e.PolyTyp===n.PolyType.ptSubject&&p<=0&&f<=0)&&this.AddLocalMinPoly(e,t,r);break;case n.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else n.Clipper.SwapSides(e,t)}}else{if(0===e.WindDelta&&0===t.WindDelta)return;e.PolyTyp===t.PolyTyp&&e.WindDelta!==t.WindDelta&&this.m_ClipType===n.ClipType.ctUnion?0===e.WindDelta?a&&(this.AddOutPt(e,r),i&&(e.OutIdx=-1)):i&&(this.AddOutPt(t,r),a&&(t.OutIdx=-1)):e.PolyTyp!==t.PolyTyp&&(0!==e.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===n.ClipType.ctUnion&&0!==t.WindCnt2?0===t.WindDelta&&1===Math.abs(e.WindCnt)&&(this.m_ClipType!==n.ClipType.ctUnion||0===e.WindCnt2)&&(this.AddOutPt(t,r),a&&(t.OutIdx=-1)):(this.AddOutPt(e,r),i&&(e.OutIdx=-1)))}},n.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,n=e.NextInSEL;null===t&&null===n&&e!==this.m_SortedEdges||(null!==t?t.NextInSEL=n:this.m_SortedEdges=n,null!==n&&(n.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null)},n.Clipper.prototype.ProcessHorizontals=function(){for(var e={};this.PopEdgeFromSEL(e);)this.ProcessHorizontal(e.v)},n.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=n.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=n.Direction.dRightToLeft)},n.Clipper.prototype.ProcessHorizontal=function(e){var t={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,t);for(var r=t.Dir,i=t.Left,a=t.Right,s=0===e.WindDelta,o=e,l=null;null!==o.NextInLML&&n.ClipperBase.IsHorizontal(o.NextInLML);)o=o.NextInLML;null===o.NextInLML&&(l=this.GetMaximaPair(o));var h=this.m_Maxima;if(null!==h)if(r===n.Direction.dLeftToRight){for(;null!==h&&h.X<=e.Bot.X;)h=h.Next;null!==h&&h.X>=o.Top.X&&(h=null)}else{for(;null!==h.Next&&h.Next.X<e.Bot.X;)h=h.Next;h.X<=o.Top.X&&(h=null)}for(var u=null;;){for(var c=e===o,d=this.GetNextInAEL(e,r);null!==d;){if(null!==h)if(r===n.Direction.dLeftToRight)for(;null!==h&&h.X<d.Curr.X;)e.OutIdx>=0&&!s&&this.AddOutPt(e,new n.IntPoint2(h.X,e.Bot.Y)),h=h.Next;else for(;null!==h&&h.X>d.Curr.X;)e.OutIdx>=0&&!s&&this.AddOutPt(e,new n.IntPoint2(h.X,e.Bot.Y)),h=h.Prev;if(r===n.Direction.dLeftToRight&&d.Curr.X>a||r===n.Direction.dRightToLeft&&d.Curr.X<i||d.Curr.X===e.Top.X&&null!==e.NextInLML&&d.Dx<e.NextInLML.Dx)break;if(e.OutIdx>=0&&!s){n.use_xyz&&(r===n.Direction.dLeftToRight?this.SetZ(d.Curr,e,d):this.SetZ(d.Curr,d,e)),u=this.AddOutPt(e,d.Curr);for(var p=this.m_SortedEdges;null!==p;){if(p.OutIdx>=0&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,p.Bot.X,p.Top.X)){var f=this.GetLastOutPt(p);this.AddJoin(f,u,p.Top)}p=p.NextInSEL}this.AddGhostJoin(u,e.Bot)}if(d===l&&c)return e.OutIdx>=0&&this.AddLocalMaxPoly(e,l,e.Top),this.DeleteFromAEL(e),void this.DeleteFromAEL(l);if(r===n.Direction.dLeftToRight){var m=new n.IntPoint2(d.Curr.X,e.Curr.Y);this.IntersectEdges(e,d,m)}else{m=new n.IntPoint2(d.Curr.X,e.Curr.Y);this.IntersectEdges(d,e,m)}var g=this.GetNextInAEL(d,r);this.SwapPositionsInAEL(e,d),d=g}if(null===e.NextInLML||!n.ClipperBase.IsHorizontal(e.NextInLML))break;(e=this.UpdateEdgeIntoAEL(e)).OutIdx>=0&&this.AddOutPt(e,e.Bot),t={Dir:r,Left:i,Right:a},this.GetHorzDirection(e,t),r=t.Dir,i=t.Left,a=t.Right}if(e.OutIdx>=0&&null===u){u=this.GetLastOutPt(e);for(p=this.m_SortedEdges;null!==p;){if(p.OutIdx>=0&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,p.Bot.X,p.Top.X)){f=this.GetLastOutPt(p);this.AddJoin(f,u,p.Top)}p=p.NextInSEL}this.AddGhostJoin(u,e.Top)}if(null!==e.NextInLML)if(e.OutIdx>=0){if(u=this.AddOutPt(e,e.Top),0===(e=this.UpdateEdgeIntoAEL(e)).WindDelta)return;var v=e.PrevInAEL;g=e.NextInAEL;if(null!==v&&v.Curr.X===e.Bot.X&&v.Curr.Y===e.Bot.Y&&0===v.WindDelta&&v.OutIdx>=0&&v.Curr.Y>v.Top.Y&&n.ClipperBase.SlopesEqual3(e,v,this.m_UseFullRange)){f=this.AddOutPt(v,e.Bot);this.AddJoin(u,f,e.Top)}else if(null!==g&&g.Curr.X===e.Bot.X&&g.Curr.Y===e.Bot.Y&&0!==g.WindDelta&&g.OutIdx>=0&&g.Curr.Y>g.Top.Y&&n.ClipperBase.SlopesEqual3(e,g,this.m_UseFullRange)){f=this.AddOutPt(g,e.Bot);this.AddJoin(u,f,e.Top)}}else e=this.UpdateEdgeIntoAEL(e);else e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e)},n.Clipper.prototype.GetNextInAEL=function(e,t){return t===n.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},n.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!==e&&e.Next.NextInLML!==e},n.Clipper.prototype.IsMaxima=function(e,t){return null!==e&&e.Top.Y===t&&null===e.NextInLML},n.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y===t&&null!==e.NextInLML},n.Clipper.prototype.GetMaximaPair=function(e){return n.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?e.Next:n.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML?e.Prev:null},n.Clipper.prototype.GetMaximaPairEx=function(e){var t=this.GetMaximaPair(e);return null===t||t.OutIdx===n.ClipperBase.Skip||t.NextInAEL===t.PrevInAEL&&!n.ClipperBase.IsHorizontal(t)?null:t},n.Clipper.prototype.ProcessIntersections=function(e){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(e),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,n.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},n.Clipper.prototype.BuildIntersectList=function(e){if(null!==this.m_ActiveEdges){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t.Curr.X=n.Clipper.TopX(t,e),t=t.NextInAEL;for(var r=!0;r&&null!==this.m_SortedEdges;){for(r=!1,t=this.m_SortedEdges;null!==t.NextInSEL;){var i=t.NextInSEL,a=new n.IntPoint0;if(t.Curr.X>i.Curr.X){this.IntersectPoint(t,i,a),a.Y<e&&(a=new n.IntPoint2(n.Clipper.TopX(t,e),e));var s=new n.IntersectNode;s.Edge1=t,s.Edge2=i,s.Pt.X=a.X,s.Pt.Y=a.Y,n.use_xyz&&(s.Pt.Z=a.Z),this.m_IntersectList.push(s),this.SwapPositionsInSEL(t,i),r=!0}else t=i}if(null===t.PrevInSEL)break;t.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},n.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL===e.Edge2||e.Edge1.PrevInSEL===e.Edge2},n.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},n.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var e=this.m_IntersectList.length,t=0;t<e;t++){if(!this.EdgesAdjacent(this.m_IntersectList[t])){for(var n=t+1;n<e&&!this.EdgesAdjacent(this.m_IntersectList[n]);)n++;if(n===e)return!1;var r=this.m_IntersectList[t];this.m_IntersectList[t]=this.m_IntersectList[n],this.m_IntersectList[n]=r}this.SwapPositionsInSEL(this.m_IntersectList[t].Edge1,this.m_IntersectList[t].Edge2)}return!0},n.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,t=this.m_IntersectList.length;e<t;e++){var n=this.m_IntersectList[e];this.IntersectEdges(n.Edge1,n.Edge2,n.Pt),this.SwapPositionsInAEL(n.Edge1,n.Edge2)}this.m_IntersectList.length=0};a.msie?n.Clipper.Round=function(e){return e<0?Math.ceil(e-.5):Math.round(e)}:a.chromium?n.Clipper.Round=function(e){return e<0?-Math.round(Math.abs(e)):Math.round(e)}:a.safari?n.Clipper.Round=function(e){return e<0?(e-=.5)<-2147483648?Math.ceil(e):0|e:(e+=.5)>2147483647?Math.floor(e):0|e}:n.Clipper.Round=function(e){return e<0?Math.ceil(e-.5):Math.floor(e+.5)},n.Clipper.TopX=function(e,t){return t===e.Top.Y?e.Top.X:e.Bot.X+n.Clipper.Round(e.Dx*(t-e.Bot.Y))},n.Clipper.prototype.IntersectPoint=function(e,t,r){var i,a;if(r.X=0,r.Y=0,e.Dx===t.Dx)return r.Y=e.Curr.Y,void(r.X=n.Clipper.TopX(e,r.Y));if(0===e.Delta.X)r.X=e.Bot.X,n.ClipperBase.IsHorizontal(t)?r.Y=t.Bot.Y:(a=t.Bot.Y-t.Bot.X/t.Dx,r.Y=n.Clipper.Round(r.X/t.Dx+a));else if(0===t.Delta.X)r.X=t.Bot.X,n.ClipperBase.IsHorizontal(e)?r.Y=e.Bot.Y:(i=e.Bot.Y-e.Bot.X/e.Dx,r.Y=n.Clipper.Round(r.X/e.Dx+i));else{i=e.Bot.X-e.Bot.Y*e.Dx;var s=((a=t.Bot.X-t.Bot.Y*t.Dx)-i)/(e.Dx-t.Dx);r.Y=n.Clipper.Round(s),Math.abs(e.Dx)<Math.abs(t.Dx)?r.X=n.Clipper.Round(e.Dx*s+i):r.X=n.Clipper.Round(t.Dx*s+a)}if(r.Y<e.Top.Y||r.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return r.Y=e.Top.Y,r.X=n.Clipper.TopX(t,e.Top.Y),r.X<e.Top.X;r.Y=t.Top.Y,Math.abs(e.Dx)<Math.abs(t.Dx)?r.X=n.Clipper.TopX(e,r.Y):r.X=n.Clipper.TopX(t,r.Y)}r.Y>e.Curr.Y&&(r.Y=e.Curr.Y,Math.abs(e.Dx)>Math.abs(t.Dx)?r.X=n.Clipper.TopX(t,r.Y):r.X=n.Clipper.TopX(e,r.Y))},n.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t=this.m_ActiveEdges;null!==t;){var r=this.IsMaxima(t,e);if(r){var i=this.GetMaximaPairEx(t);r=null===i||!n.ClipperBase.IsHorizontal(i)}if(r){this.StrictlySimple&&this.InsertMaxima(t.Top.X);var a=t.PrevInAEL;this.DoMaxima(t),t=null===a?this.m_ActiveEdges:a.NextInAEL}else{if(this.IsIntermediate(t,e)&&n.ClipperBase.IsHorizontal(t.NextInLML)?((t=this.UpdateEdgeIntoAEL(t)).OutIdx>=0&&this.AddOutPt(t,t.Bot),this.AddEdgeToSEL(t)):(t.Curr.X=n.Clipper.TopX(t,e),t.Curr.Y=e),n.use_xyz&&(t.Top.Y===e?t.Curr.Z=t.Top.Z:t.Bot.Y===e?t.Curr.Z=t.Bot.Z:t.Curr.Z=0),this.StrictlySimple){a=t.PrevInAEL;if(t.OutIdx>=0&&0!==t.WindDelta&&null!==a&&a.OutIdx>=0&&a.Curr.X===t.Curr.X&&0!==a.WindDelta){var s=new n.IntPoint1(t.Curr);n.use_xyz&&this.SetZ(s,a,t);var o=this.AddOutPt(a,s),l=this.AddOutPt(t,s);this.AddJoin(o,l,s)}}t=t.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,t=this.m_ActiveEdges;null!==t;){if(this.IsIntermediate(t,e)){o=null;t.OutIdx>=0&&(o=this.AddOutPt(t,t.Top));a=(t=this.UpdateEdgeIntoAEL(t)).PrevInAEL;var h=t.NextInAEL;if(null!==a&&a.Curr.X===t.Bot.X&&a.Curr.Y===t.Bot.Y&&null!==o&&a.OutIdx>=0&&a.Curr.Y===a.Top.Y&&n.ClipperBase.SlopesEqual5(t.Curr,t.Top,a.Curr,a.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==a.WindDelta){l=this.AddOutPt(ePrev2,t.Bot);this.AddJoin(o,l,t.Top)}else if(null!==h&&h.Curr.X===t.Bot.X&&h.Curr.Y===t.Bot.Y&&null!==o&&h.OutIdx>=0&&h.Curr.Y===h.Top.Y&&n.ClipperBase.SlopesEqual5(t.Curr,t.Top,h.Curr,h.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==h.WindDelta){l=this.AddOutPt(h,t.Bot);this.AddJoin(o,l,t.Top)}}t=t.NextInAEL}},n.Clipper.prototype.DoMaxima=function(e){var t=this.GetMaximaPairEx(e);if(null===t)return e.OutIdx>=0&&this.AddOutPt(e,e.Top),void this.DeleteFromAEL(e);for(var r=e.NextInAEL;null!==r&&r!==t;)this.IntersectEdges(e,r,e.Top),this.SwapPositionsInAEL(e,r),r=e.NextInAEL;-1===e.OutIdx&&-1===t.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(t)):e.OutIdx>=0&&t.OutIdx>=0?(e.OutIdx>=0&&this.AddLocalMaxPoly(e,t,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(t)):n.use_lines&&0===e.WindDelta?(e.OutIdx>=0&&(this.AddOutPt(e,e.Top),e.OutIdx=n.ClipperBase.Unassigned),this.DeleteFromAEL(e),t.OutIdx>=0&&(this.AddOutPt(t,e.Top),t.OutIdx=n.ClipperBase.Unassigned),this.DeleteFromAEL(t)):n.Error("DoMaxima error")},n.Clipper.ReversePaths=function(e){for(var t=0,n=e.length;t<n;t++)e[t].reverse()},n.Clipper.Orientation=function(e){return n.Clipper.Area(e)>=0},n.Clipper.prototype.PointCount=function(e){if(null===e)return 0;var t=0,n=e;do{t++,n=n.Next}while(n!==e);return t},n.Clipper.prototype.BuildResult=function(e){n.Clear(e);for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var i=this.m_PolyOuts[t];if(null!==i.Pts){var a=i.Pts.Prev,s=this.PointCount(a);if(!(s<2)){for(var o=new Array(s),l=0;l<s;l++)o[l]=a.Pt,a=a.Prev;e.push(o)}}}},n.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var i=this.m_PolyOuts[t],a=this.PointCount(i.Pts);if(!(i.IsOpen&&a<2||!i.IsOpen&&a<3)){this.FixHoleLinkage(i);var s=new n.PolyNode;e.m_AllPolys.push(s),i.PolyNode=s,s.m_polygon.length=a;for(var o=i.Pts.Prev,l=0;l<a;l++)s.m_polygon[l]=o.Pt,o=o.Prev}}for(t=0,r=this.m_PolyOuts.length;t<r;t++){null!==(i=this.m_PolyOuts[t]).PolyNode&&(i.IsOpen?(i.PolyNode.IsOpen=!0,e.AddChild(i.PolyNode)):null!==i.FirstLeft&&null!==i.FirstLeft.PolyNode?i.FirstLeft.PolyNode.AddChild(i.PolyNode):e.AddChild(i.PolyNode))}},n.Clipper.prototype.FixupOutPolyline=function(e){for(var t=e.Pts,r=t.Prev;t!==r;)if(t=t.Next,n.IntPoint.op_Equality(t.Pt,t.Prev.Pt)){t===r&&(r=t.Prev);var i=t.Prev;i.Next=t.Next,t.Next.Prev=i,t=i}t===t.Prev&&(e.Pts=null)},n.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.BottomPt=null;for(var r=e.Pts,i=this.PreserveCollinear||this.StrictlySimple;;){if(r.Prev===r||r.Prev===r.Next)return void(e.Pts=null);if(n.IntPoint.op_Equality(r.Pt,r.Next.Pt)||n.IntPoint.op_Equality(r.Pt,r.Prev.Pt)||n.ClipperBase.SlopesEqual4(r.Prev.Pt,r.Pt,r.Next.Pt,this.m_UseFullRange)&&(!i||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Pt,r.Pt,r.Next.Pt)))t=null,r.Prev.Next=r.Next,r.Next.Prev=r.Prev,r=r.Prev;else{if(r===t)break;null===t&&(t=r),r=r.Next}}e.Pts=r},n.Clipper.prototype.DupOutPt=function(e,t){var r=new n.OutPt;return r.Pt.X=e.Pt.X,r.Pt.Y=e.Pt.Y,n.use_xyz&&(r.Pt.Z=e.Pt.Z),r.Idx=e.Idx,t?(r.Next=e.Next,r.Prev=e,e.Next.Prev=r,e.Next=r):(r.Prev=e.Prev,r.Next=e,e.Prev.Next=r,e.Prev=r),r},n.Clipper.prototype.GetOverlap=function(e,t,n,r,i){return e<t?n<r?(i.Left=Math.max(e,n),i.Right=Math.min(t,r)):(i.Left=Math.max(e,r),i.Right=Math.min(t,n)):n<r?(i.Left=Math.max(t,n),i.Right=Math.min(e,r)):(i.Left=Math.max(t,r),i.Right=Math.min(e,n)),i.Left<i.Right},n.Clipper.prototype.JoinHorz=function(e,t,r,i,a,s){var o=e.Pt.X>t.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight,l=r.Pt.X>i.Pt.X?n.Direction.dRightToLeft:n.Direction.dLeftToRight;if(o===l)return!1;if(o===n.Direction.dLeftToRight){for(;e.Next.Pt.X<=a.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y===a.Y;)e=e.Next;s&&e.Pt.X!==a.X&&(e=e.Next),t=this.DupOutPt(e,!s),n.IntPoint.op_Inequality(t.Pt,a)&&((e=t).Pt.X=a.X,e.Pt.Y=a.Y,n.use_xyz&&(e.Pt.Z=a.Z),t=this.DupOutPt(e,!s))}else{for(;e.Next.Pt.X>=a.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y===a.Y;)e=e.Next;!s&&e.Pt.X!==a.X&&(e=e.Next),t=this.DupOutPt(e,s),n.IntPoint.op_Inequality(t.Pt,a)&&((e=t).Pt.X=a.X,e.Pt.Y=a.Y,n.use_xyz&&(e.Pt.Z=a.Z),t=this.DupOutPt(e,s))}if(l===n.Direction.dLeftToRight){for(;r.Next.Pt.X<=a.X&&r.Next.Pt.X>=r.Pt.X&&r.Next.Pt.Y===a.Y;)r=r.Next;s&&r.Pt.X!==a.X&&(r=r.Next),i=this.DupOutPt(r,!s),n.IntPoint.op_Inequality(i.Pt,a)&&((r=i).Pt.X=a.X,r.Pt.Y=a.Y,n.use_xyz&&(r.Pt.Z=a.Z),i=this.DupOutPt(r,!s))}else{for(;r.Next.Pt.X>=a.X&&r.Next.Pt.X<=r.Pt.X&&r.Next.Pt.Y===a.Y;)r=r.Next;!s&&r.Pt.X!==a.X&&(r=r.Next),i=this.DupOutPt(r,s),n.IntPoint.op_Inequality(i.Pt,a)&&((r=i).Pt.X=a.X,r.Pt.Y=a.Y,n.use_xyz&&(r.Pt.Z=a.Z),i=this.DupOutPt(r,s))}return o===n.Direction.dLeftToRight===s?(e.Prev=r,r.Next=e,t.Next=i,i.Prev=t):(e.Next=r,r.Prev=e,t.Prev=i,i.Next=t),!0},n.Clipper.prototype.JoinPoints=function(e,t,r){var i=e.OutPt1,a=new n.OutPt,s=e.OutPt2,o=new n.OutPt,l=e.OutPt1.Pt.Y===e.OffPt.Y;if(l&&n.IntPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&n.IntPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(t!==r)return!1;for(a=e.OutPt1.Next;a!==i&&n.IntPoint.op_Equality(a.Pt,e.OffPt);)a=a.Next;var h=a.Pt.Y>e.OffPt.Y;for(o=e.OutPt2.Next;o!==s&&n.IntPoint.op_Equality(o.Pt,e.OffPt);)o=o.Next;return h!==o.Pt.Y>e.OffPt.Y&&(h?(a=this.DupOutPt(i,!1),o=this.DupOutPt(s,!0),i.Prev=s,s.Next=i,a.Next=o,o.Prev=a,e.OutPt1=i,e.OutPt2=a,!0):(a=this.DupOutPt(i,!0),o=this.DupOutPt(s,!1),i.Next=s,s.Prev=i,a.Prev=o,o.Next=a,e.OutPt1=i,e.OutPt2=a,!0))}if(l){for(a=i;i.Prev.Pt.Y===i.Pt.Y&&i.Prev!==a&&i.Prev!==s;)i=i.Prev;for(;a.Next.Pt.Y===a.Pt.Y&&a.Next!==i&&a.Next!==s;)a=a.Next;if(a.Next===i||a.Next===s)return!1;for(o=s;s.Prev.Pt.Y===s.Pt.Y&&s.Prev!==o&&s.Prev!==a;)s=s.Prev;for(;o.Next.Pt.Y===o.Pt.Y&&o.Next!==s&&o.Next!==i;)o=o.Next;if(o.Next===s||o.Next===i)return!1;var u={Left:null,Right:null};if(!this.GetOverlap(i.Pt.X,a.Pt.X,s.Pt.X,o.Pt.X,u))return!1;var c,d=u.Left,p=u.Right,f=new n.IntPoint0;return i.Pt.X>=d&&i.Pt.X<=p?(f.X=i.Pt.X,f.Y=i.Pt.Y,n.use_xyz&&(f.Z=i.Pt.Z),c=i.Pt.X>a.Pt.X):s.Pt.X>=d&&s.Pt.X<=p?(f.X=s.Pt.X,f.Y=s.Pt.Y,n.use_xyz&&(f.Z=s.Pt.Z),c=s.Pt.X>o.Pt.X):a.Pt.X>=d&&a.Pt.X<=p?(f.X=a.Pt.X,f.Y=a.Pt.Y,n.use_xyz&&(f.Z=a.Pt.Z),c=a.Pt.X>i.Pt.X):(f.X=o.Pt.X,f.Y=o.Pt.Y,n.use_xyz&&(f.Z=o.Pt.Z),c=o.Pt.X>s.Pt.X),e.OutPt1=i,e.OutPt2=s,this.JoinHorz(i,a,s,o,f,c)}for(a=i.Next;n.IntPoint.op_Equality(a.Pt,i.Pt)&&a!==i;)a=a.Next;var m=a.Pt.Y>i.Pt.Y||!n.ClipperBase.SlopesEqual4(i.Pt,a.Pt,e.OffPt,this.m_UseFullRange);if(m){for(a=i.Prev;n.IntPoint.op_Equality(a.Pt,i.Pt)&&a!==i;)a=a.Prev;if(a.Pt.Y>i.Pt.Y||!n.ClipperBase.SlopesEqual4(i.Pt,a.Pt,e.OffPt,this.m_UseFullRange))return!1}for(o=s.Next;n.IntPoint.op_Equality(o.Pt,s.Pt)&&o!==s;)o=o.Next;var g=o.Pt.Y>s.Pt.Y||!n.ClipperBase.SlopesEqual4(s.Pt,o.Pt,e.OffPt,this.m_UseFullRange);if(g){for(o=s.Prev;n.IntPoint.op_Equality(o.Pt,s.Pt)&&o!==s;)o=o.Prev;if(o.Pt.Y>s.Pt.Y||!n.ClipperBase.SlopesEqual4(s.Pt,o.Pt,e.OffPt,this.m_UseFullRange))return!1}return a!==i&&o!==s&&a!==o&&(t!==r||m!==g)&&(m?(a=this.DupOutPt(i,!1),o=this.DupOutPt(s,!0),i.Prev=s,s.Next=i,a.Next=o,o.Prev=a,e.OutPt1=i,e.OutPt2=a,!0):(a=this.DupOutPt(i,!0),o=this.DupOutPt(s,!1),i.Next=s,s.Prev=i,a.Prev=o,o.Next=a,e.OutPt1=i,e.OutPt2=a,!0))},n.Clipper.GetBounds=function(e){for(var t=0,r=e.length;t<r&&0===e[t].length;)t++;if(t===r)return new n.IntRect(0,0,0,0);var i=new n.IntRect;for(i.left=e[t][0].X,i.right=i.left,i.top=e[t][0].Y,i.bottom=i.top;t<r;t++)for(var a=0,s=e[t].length;a<s;a++)e[t][a].X<i.left?i.left=e[t][a].X:e[t][a].X>i.right&&(i.right=e[t][a].X),e[t][a].Y<i.top?i.top=e[t][a].Y:e[t][a].Y>i.bottom&&(i.bottom=e[t][a].Y);return i},n.Clipper.prototype.GetBounds2=function(e){var t=e,r=new n.IntRect;for(r.left=e.Pt.X,r.right=e.Pt.X,r.top=e.Pt.Y,r.bottom=e.Pt.Y,e=e.Next;e!==t;)e.Pt.X<r.left&&(r.left=e.Pt.X),e.Pt.X>r.right&&(r.right=e.Pt.X),e.Pt.Y<r.top&&(r.top=e.Pt.Y),e.Pt.Y>r.bottom&&(r.bottom=e.Pt.Y),e=e.Next;return r},n.Clipper.PointInPolygon=function(e,t){var n=0,r=t.length;if(r<3)return 0;for(var i=t[0],a=1;a<=r;++a){var s=a===r?t[0]:t[a];if(s.Y===e.Y&&(s.X===e.X||i.Y===e.Y&&s.X>e.X==i.X<e.X))return-1;if(i.Y<e.Y!=s.Y<e.Y)if(i.X>=e.X)if(s.X>e.X)n=1-n;else{if(0===(o=(i.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(i.Y-e.Y)))return-1;o>0==s.Y>i.Y&&(n=1-n)}else if(s.X>e.X){var o;if(0===(o=(i.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(i.Y-e.Y)))return-1;o>0==s.Y>i.Y&&(n=1-n)}i=s}return n},n.Clipper.prototype.PointInPolygon=function(e,t){var n=0,r=t,i=e.X,a=e.Y,s=t.Pt.X,o=t.Pt.Y;do{var l=(t=t.Next).Pt.X,h=t.Pt.Y;if(h===a&&(l===i||o===a&&l>i==s<i))return-1;if(o<a!=h<a)if(s>=i)if(l>i)n=1-n;else{if(0===(u=(s-i)*(h-a)-(l-i)*(o-a)))return-1;u>0==h>o&&(n=1-n)}else if(l>i){var u;if(0===(u=(s-i)*(h-a)-(l-i)*(o-a)))return-1;u>0==h>o&&(n=1-n)}s=l,o=h}while(r!==t);return n},n.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var n=e;do{var r=this.PointInPolygon(n.Pt,t);if(r>=0)return r>0;n=n.Next}while(n!==e);return!0},n.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var r,i,a=0,s=this.m_PolyOuts.length;a<s;a++)r=this.m_PolyOuts[a],i=n.Clipper.ParseFirstLeft(r.FirstLeft),null!==r.Pts&&i===e&&this.Poly2ContainsPoly1(r.Pts,t.Pts)&&(r.FirstLeft=t)},n.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var r,i,a=t.FirstLeft,s=0,o=this.m_PolyOuts.length;s<o;s++)null!==(r=this.m_PolyOuts[s]).Pts&&r!==t&&r!==e&&(((i=n.Clipper.ParseFirstLeft(r.FirstLeft))===a||i===e||i===t)&&(this.Poly2ContainsPoly1(r.Pts,e.Pts)?r.FirstLeft=e:this.Poly2ContainsPoly1(r.Pts,t.Pts)?r.FirstLeft=t:(r.FirstLeft===e||r.FirstLeft===t)&&(r.FirstLeft=a)))},n.Clipper.prototype.FixupFirstLefts3=function(e,t){for(var r,i,a=0,s=this.m_PolyOuts.length;a<s;a++)r=this.m_PolyOuts[a],i=n.Clipper.ParseFirstLeft(r.FirstLeft),null!==r.Pts&&i===e&&(r.FirstLeft=t)},n.Clipper.ParseFirstLeft=function(e){for(;null!==e&&null===e.Pts;)e=e.FirstLeft;return e},n.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,t=this.m_Joins.length;e<t;e++){var n,r=this.m_Joins[e],i=this.GetOutRec(r.OutPt1.Idx),a=this.GetOutRec(r.OutPt2.Idx);if(null!==i.Pts&&null!==a.Pts&&!i.IsOpen&&!a.IsOpen)n=i===a?i:this.OutRec1RightOfOutRec2(i,a)?a:this.OutRec1RightOfOutRec2(a,i)?i:this.GetLowermostRec(i,a),this.JoinPoints(r,i,a)&&(i===a?(i.Pts=r.OutPt1,i.BottomPt=null,(a=this.CreateOutRec()).Pts=r.OutPt2,this.UpdateOutPtIdxs(a),this.Poly2ContainsPoly1(a.Pts,i.Pts)?(a.IsHole=!i.IsHole,a.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(a,i),(a.IsHole^this.ReverseSolution)==this.Area$1(a)>0&&this.ReversePolyPtLinks(a.Pts)):this.Poly2ContainsPoly1(i.Pts,a.Pts)?(a.IsHole=i.IsHole,i.IsHole=!a.IsHole,a.FirstLeft=i.FirstLeft,i.FirstLeft=a,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,a),(i.IsHole^this.ReverseSolution)==this.Area$1(i)>0&&this.ReversePolyPtLinks(i.Pts)):(a.IsHole=i.IsHole,a.FirstLeft=i.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(i,a))):(a.Pts=null,a.BottomPt=null,a.Idx=i.Idx,i.IsHole=n.IsHole,n===a&&(i.FirstLeft=a.FirstLeft),a.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts3(a,i)))}},n.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do{t.Idx=e.Idx,t=t.Prev}while(t!==e.Pts)},n.Clipper.prototype.DoSimplePolygons=function(){for(var e=0;e<this.m_PolyOuts.length;){var t=this.m_PolyOuts[e++],r=t.Pts;if(null!==r&&!t.IsOpen)do{for(var i=r.Next;i!==t.Pts;){if(n.IntPoint.op_Equality(r.Pt,i.Pt)&&i.Next!==r&&i.Prev!==r){var a=r.Prev,s=i.Prev;r.Prev=s,s.Next=r,i.Prev=a,a.Next=i,t.Pts=r;var o=this.CreateOutRec();o.Pts=i,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,t.Pts)?(o.IsHole=!t.IsHole,o.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,t)):this.Poly2ContainsPoly1(t.Pts,o.Pts)?(o.IsHole=t.IsHole,t.IsHole=!o.IsHole,o.FirstLeft=t.FirstLeft,t.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,o)):(o.IsHole=t.IsHole,o.FirstLeft=t.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(t,o)),i=r}i=i.Next}r=r.Next}while(r!==t.Pts)}},n.Clipper.Area=function(e){if(!Array.isArray(e))return 0;var t=e.length;if(t<3)return 0;for(var n=0,r=0,i=t-1;r<t;++r)n+=(e[i].X+e[r].X)*(e[i].Y-e[r].Y),i=r;return.5*-n},n.Clipper.prototype.Area=function(e){var t=e;if(null===e)return 0;var n=0;do{n+=(e.Prev.Pt.X+e.Pt.X)*(e.Prev.Pt.Y-e.Pt.Y),e=e.Next}while(e!==t);return.5*n},n.Clipper.prototype.Area$1=function(e){return this.Area(e.Pts)},n.Clipper.SimplifyPolygon=function(e,t){var r=new Array,i=new n.Clipper(0);return i.StrictlySimple=!0,i.AddPath(e,n.PolyType.ptSubject,!0),i.Execute(n.ClipType.ctUnion,r,t,t),r},n.Clipper.SimplifyPolygons=function(e,t){void 0===t&&(t=n.PolyFillType.pftEvenOdd);var r=new Array,i=new n.Clipper(0);return i.StrictlySimple=!0,i.AddPaths(e,n.PolyType.ptSubject,!0),i.Execute(n.ClipType.ctUnion,r,t,t),r},n.Clipper.DistanceSqrd=function(e,t){var n=e.X-t.X,r=e.Y-t.Y;return n*n+r*r},n.Clipper.DistanceFromLineSqrd=function(e,t,n){var r=t.Y-n.Y,i=n.X-t.X,a=r*t.X+i*t.Y;return(a=r*e.X+i*e.Y-a)*a/(r*r+i*i)},n.Clipper.SlopesNearCollinear=function(e,t,r,i){return Math.abs(e.X-t.X)>Math.abs(e.Y-t.Y)?e.X>t.X==e.X<r.X?n.Clipper.DistanceFromLineSqrd(e,t,r)<i:t.X>e.X==t.X<r.X?n.Clipper.DistanceFromLineSqrd(t,e,r)<i:n.Clipper.DistanceFromLineSqrd(r,e,t)<i:e.Y>t.Y==e.Y<r.Y?n.Clipper.DistanceFromLineSqrd(e,t,r)<i:t.Y>e.Y==t.Y<r.Y?n.Clipper.DistanceFromLineSqrd(t,e,r)<i:n.Clipper.DistanceFromLineSqrd(r,e,t)<i},n.Clipper.PointsAreClose=function(e,t,n){var r=e.X-t.X,i=e.Y-t.Y;return r*r+i*i<=n},n.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},n.Clipper.CleanPolygon=function(e,t){void 0===t&&(t=1.415);var r=e.length;if(0===r)return new Array;for(var i=new Array(r),a=0;a<r;++a)i[a]=new n.OutPt;for(a=0;a<r;++a)i[a].Pt=e[a],i[a].Next=i[(a+1)%r],i[a].Next.Prev=i[a],i[a].Idx=0;for(var s=t*t,o=i[0];0===o.Idx&&o.Next!==o.Prev;)n.Clipper.PointsAreClose(o.Pt,o.Prev.Pt,s)?(o=n.Clipper.ExcludeOp(o),r--):n.Clipper.PointsAreClose(o.Prev.Pt,o.Next.Pt,s)?(n.Clipper.ExcludeOp(o.Next),o=n.Clipper.ExcludeOp(o),r-=2):n.Clipper.SlopesNearCollinear(o.Prev.Pt,o.Pt,o.Next.Pt,s)?(o=n.Clipper.ExcludeOp(o),r--):(o.Idx=1,o=o.Next);r<3&&(r=0);var l=new Array(r);for(a=0;a<r;++a)l[a]=new n.IntPoint1(o.Pt),o=o.Next;return i=null,l},n.Clipper.CleanPolygons=function(e,t){for(var r=new Array(e.length),i=0,a=e.length;i<a;i++)r[i]=n.Clipper.CleanPolygon(e[i],t);return r},n.Clipper.Minkowski=function(e,t,r,i){var a=i?1:0,s=e.length,o=t.length,l=new Array;if(r)for(var h=0;h<o;h++){for(var u=new Array(s),c=0,d=e.length,p=e[c];c<d;p=e[++c])u[c]=new n.IntPoint2(t[h].X+p.X,t[h].Y+p.Y);l.push(u)}else for(h=0;h<o;h++){for(u=new Array(s),c=0,d=e.length,p=e[c];c<d;p=e[++c])u[c]=new n.IntPoint2(t[h].X-p.X,t[h].Y-p.Y);l.push(u)}var f=new Array;for(h=0;h<o-1+a;h++)for(c=0;c<s;c++){var m=new Array;m.push(l[h%o][c%s]),m.push(l[(h+1)%o][c%s]),m.push(l[(h+1)%o][(c+1)%s]),m.push(l[h%o][(c+1)%s]),n.Clipper.Orientation(m)||m.reverse(),f.push(m)}return f},n.Clipper.MinkowskiSum=function(e,t,r){if(t[0]instanceof Array){for(var i=t,a=new n.Paths,s=new n.Clipper,o=0;o<i.length;++o){var l=n.Clipper.Minkowski(e,i[o],!0,r);if(s.AddPaths(l,n.PolyType.ptSubject,!0),r){var h=n.Clipper.TranslatePath(i[o],e[0]);s.AddPath(h,n.PolyType.ptClip,!0)}}return s.Execute(n.ClipType.ctUnion,a,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),a}h=t,i=n.Clipper.Minkowski(e,h,!0,r);return(s=new n.Clipper).AddPaths(i,n.PolyType.ptSubject,!0),s.Execute(n.ClipType.ctUnion,i,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),i},n.Clipper.TranslatePath=function(e,t){for(var r=new n.Path,i=0;i<e.length;i++)r.push(new n.IntPoint2(e[i].X+t.X,e[i].Y+t.Y));return r},n.Clipper.MinkowskiDiff=function(e,t){var r=n.Clipper.Minkowski(e,t,!1,!0),i=new n.Clipper;return i.AddPaths(r,n.PolyType.ptSubject,!0),i.Execute(n.ClipType.ctUnion,r,n.PolyFillType.pftNonZero,n.PolyFillType.pftNonZero),r},n.Clipper.PolyTreeToPaths=function(e){var t=new Array;return n.Clipper.AddPolyNodeToPaths(e,n.Clipper.NodeType.ntAny,t),t},n.Clipper.AddPolyNodeToPaths=function(e,t,r){var i=!0;switch(t){case n.Clipper.NodeType.ntOpen:return;case n.Clipper.NodeType.ntClosed:i=!e.IsOpen}e.m_polygon.length>0&&i&&r.push(e.m_polygon);for(var a=0,s=e.Childs(),o=s.length,l=s[a];a<o;l=s[++a])n.Clipper.AddPolyNodeToPaths(l,t,r)},n.Clipper.OpenPathsFromPolyTree=function(e){for(var t=new n.Paths,r=0,i=e.ChildCount();r<i;r++)e.Childs()[r].IsOpen&&t.push(e.Childs()[r].m_polygon);return t},n.Clipper.ClosedPathsFromPolyTree=function(e){var t=new n.Paths;return n.Clipper.AddPolyNodeToPaths(e,n.Clipper.NodeType.ntClosed,t),t},R(n.Clipper,n.ClipperBase),n.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},n.ClipperOffset=function(e,t){void 0===e&&(e=2),void 0===t&&(t=n.ClipperOffset.def_arc_tolerance),this.m_destPolys=new n.Paths,this.m_srcPoly=new n.Path,this.m_destPoly=new n.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new n.IntPoint0,this.m_polyNodes=new n.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},n.ClipperOffset.two_pi=6.28318530717959,n.ClipperOffset.def_arc_tolerance=.25,n.ClipperOffset.prototype.Clear=function(){n.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},n.ClipperOffset.Round=n.Clipper.Round,n.ClipperOffset.prototype.AddPath=function(e,t,r){var i=e.length-1;if(!(i<0)){var a=new n.PolyNode;if(a.m_jointype=t,a.m_endtype=r,r===n.EndType.etClosedLine||r===n.EndType.etClosedPolygon)for(;i>0&&n.IntPoint.op_Equality(e[0],e[i]);)i--;a.m_polygon.push(e[0]);for(var s=0,o=0,l=1;l<=i;l++)n.IntPoint.op_Inequality(a.m_polygon[s],e[l])&&(s++,a.m_polygon.push(e[l]),(e[l].Y>a.m_polygon[o].Y||e[l].Y===a.m_polygon[o].Y&&e[l].X<a.m_polygon[o].X)&&(o=s));if(!(r===n.EndType.etClosedPolygon&&s<2)&&(this.m_polyNodes.AddChild(a),r===n.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new n.IntPoint2(this.m_polyNodes.ChildCount()-1,o);else{var h=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(a.m_polygon[o].Y>h.Y||a.m_polygon[o].Y===h.Y&&a.m_polygon[o].X<h.X)&&(this.m_lowest=new n.IntPoint2(this.m_polyNodes.ChildCount()-1,o))}}},n.ClipperOffset.prototype.AddPaths=function(e,t,n){for(var r=0,i=e.length;r<i;r++)this.AddPath(e[r],t,n)},n.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!n.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){((t=this.m_polyNodes.Childs()[e]).m_endtype===n.EndType.etClosedPolygon||t.m_endtype===n.EndType.etClosedLine&&n.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse()}else for(e=0;e<this.m_polyNodes.ChildCount();e++){var t;(t=this.m_polyNodes.Childs()[e]).m_endtype===n.EndType.etClosedLine&&!n.Clipper.Orientation(t.m_polygon)&&t.m_polygon.reverse()}},n.ClipperOffset.GetUnitNormal=function(e,t){var r=t.X-e.X,i=t.Y-e.Y;if(0===r&&0===i)return new n.DoublePoint2(0,0);var a=1/Math.sqrt(r*r+i*i);return r*=a,i*=a,new n.DoublePoint2(i,-r)},n.ClipperOffset.prototype.DoOffset=function(e){if(this.m_destPolys=new Array,this.m_delta=e,n.ClipperBase.near_zero(e))for(var t=0;t<this.m_polyNodes.ChildCount();t++){(a=this.m_polyNodes.Childs()[t]).m_endtype===n.EndType.etClosedPolygon&&this.m_destPolys.push(a.m_polygon)}else{var r;this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5,r=this.ArcTolerance<=0?n.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*n.ClipperOffset.def_arc_tolerance?Math.abs(e)*n.ClipperOffset.def_arc_tolerance:this.ArcTolerance;var i=3.14159265358979/Math.acos(1-r/Math.abs(e));this.m_sin=Math.sin(n.ClipperOffset.two_pi/i),this.m_cos=Math.cos(n.ClipperOffset.two_pi/i),this.m_StepsPerRad=i/n.ClipperOffset.two_pi,e<0&&(this.m_sin=-this.m_sin);for(t=0;t<this.m_polyNodes.ChildCount();t++){var a=this.m_polyNodes.Childs()[t];this.m_srcPoly=a.m_polygon;var s=this.m_srcPoly.length;if(!(0===s||e<=0&&(s<3||a.m_endtype!==n.EndType.etClosedPolygon))){if(this.m_destPoly=new Array,1===s){if(a.m_jointype===n.JoinType.jtRound)for(var o=1,l=0,h=1;h<=i;h++){this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+o*e),n.ClipperOffset.Round(this.m_srcPoly[0].Y+l*e)));var u=o;o=o*this.m_cos-this.m_sin*l,l=u*this.m_sin+l*this.m_cos}else for(o=-1,l=-1,h=0;h<4;++h)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+o*e),n.ClipperOffset.Round(this.m_srcPoly[0].Y+l*e))),o<0?o=1:l<0?l=1:o=-1;this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(h=0;h<s-1;h++)this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[h],this.m_srcPoly[h+1]));if(a.m_endtype===n.EndType.etClosedLine||a.m_endtype===n.EndType.etClosedPolygon?this.m_normals.push(n.ClipperOffset.GetUnitNormal(this.m_srcPoly[s-1],this.m_srcPoly[0])):this.m_normals.push(new n.DoublePoint1(this.m_normals[s-2])),a.m_endtype===n.EndType.etClosedPolygon){var c=s-1;for(h=0;h<s;h++)c=this.OffsetPoint(h,c,a.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(a.m_endtype===n.EndType.etClosedLine){for(c=s-1,h=0;h<s;h++)c=this.OffsetPoint(h,c,a.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;var d=this.m_normals[s-1];for(h=s-1;h>0;h--)this.m_normals[h]=new n.DoublePoint2(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new n.DoublePoint2(-d.X,-d.Y),c=0;for(h=s-1;h>=0;h--)c=this.OffsetPoint(h,c,a.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(c=0,h=1;h<s-1;++h)c=this.OffsetPoint(h,c,a.m_jointype);var p;if(a.m_endtype===n.EndType.etOpenButt){h=s-1;p=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*e),n.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*e)),this.m_destPoly.push(p),p=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[h].X-this.m_normals[h].X*e),n.ClipperOffset.Round(this.m_srcPoly[h].Y-this.m_normals[h].Y*e)),this.m_destPoly.push(p)}else{h=s-1;c=s-2,this.m_sinA=0,this.m_normals[h]=new n.DoublePoint2(-this.m_normals[h].X,-this.m_normals[h].Y),a.m_endtype===n.EndType.etOpenSquare?this.DoSquare(h,c):this.DoRound(h,c)}for(h=s-1;h>0;h--)this.m_normals[h]=new n.DoublePoint2(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new n.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y);for(h=(c=s-1)-1;h>0;--h)c=this.OffsetPoint(h,c,a.m_jointype);a.m_endtype===n.EndType.etOpenButt?(p=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*e),n.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*e)),this.m_destPoly.push(p),p=new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*e),n.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*e)),this.m_destPoly.push(p)):(c=1,this.m_sinA=0,a.m_endtype===n.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}}}},n.ClipperOffset.prototype.Execute=function(){var e=arguments;if(e[0]instanceof n.PolyTree){var t=e[1];if((o=e[0]).Clear(),this.FixOrientations(),this.DoOffset(t),(s=new n.Clipper(0)).AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),t>0)s.Execute(n.ClipType.ctUnion,o,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive);else{var r=n.Clipper.GetBounds(this.m_destPolys);if((l=new n.Path).push(new n.IntPoint2(r.left-10,r.bottom+10)),l.push(new n.IntPoint2(r.right+10,r.bottom+10)),l.push(new n.IntPoint2(r.right+10,r.top-10)),l.push(new n.IntPoint2(r.left-10,r.top-10)),s.AddPath(l,n.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(n.ClipType.ctUnion,o,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),1===o.ChildCount()&&o.Childs()[0].ChildCount()>0){var i=o.Childs()[0];o.Childs()[0]=i.Childs()[0],o.Childs()[0].m_Parent=o;for(var a=1;a<i.ChildCount();a++)o.AddChild(i.Childs()[a])}else o.Clear()}}else{var s,o=e[0];t=e[1];if(n.Clear(o),this.FixOrientations(),this.DoOffset(t),(s=new n.Clipper(0)).AddPaths(this.m_destPolys,n.PolyType.ptSubject,!0),t>0)s.Execute(n.ClipType.ctUnion,o,n.PolyFillType.pftPositive,n.PolyFillType.pftPositive);else{var l;r=n.Clipper.GetBounds(this.m_destPolys);(l=new n.Path).push(new n.IntPoint2(r.left-10,r.bottom+10)),l.push(new n.IntPoint2(r.right+10,r.bottom+10)),l.push(new n.IntPoint2(r.right+10,r.top-10)),l.push(new n.IntPoint2(r.left-10,r.top-10)),s.AddPath(l,n.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(n.ClipType.ctUnion,o,n.PolyFillType.pftNegative,n.PolyFillType.pftNegative),o.length>0&&o.splice(0,1)}}},n.ClipperOffset.prototype.OffsetPoint=function(e,t,r){if(this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y,Math.abs(this.m_sinA*this.m_delta)<1){if(this.m_normals[t].X*this.m_normals[e].X+this.m_normals[e].Y*this.m_normals[t].Y>0)return this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),t}else this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),this.m_destPoly.push(new n.IntPoint1(this.m_srcPoly[e])),this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)));else switch(r){case n.JoinType.jtMiter:var i=this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y+1;i>=this.m_miterLim?this.DoMiter(e,t,i):this.DoSquare(e,t);break;case n.JoinType.jtSquare:this.DoSquare(e,t);break;case n.JoinType.jtRound:this.DoRound(e,t)}return t=e},n.ClipperOffset.prototype.DoSquare=function(e,t){var r=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*r)))),this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*r)),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*r))))},n.ClipperOffset.prototype.DoMiter=function(e,t,r){var i=this.m_delta/r;this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*i),n.ClipperOffset.Round(this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*i)))},n.ClipperOffset.prototype.DoRound=function(e,t){for(var r,i=Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y),a=Math.max(n.Cast_Int32(n.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(i))),1),s=this.m_normals[t].X,o=this.m_normals[t].Y,l=0;l<a;++l)this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+s*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[e].Y+o*this.m_delta))),r=s,s=s*this.m_cos-this.m_sin*o,o=r*this.m_sin+o*this.m_cos;this.m_destPoly.push(new n.IntPoint2(n.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),n.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)))},n.Error=function(e){try{throw new Error(e)}catch(e){alert(e.message)}},n.JS={},n.JS.AreaOfPolygon=function(e,t){return t||(t=1),n.Clipper.Area(e)/(t*t)},n.JS.AreaOfPolygons=function(e,t){t||(t=1);for(var r=0,i=0;i<e.length;i++)r+=n.Clipper.Area(e[i]);return r/(t*t)},n.JS.BoundsOfPath=function(e,t){return n.JS.BoundsOfPaths([e],t)},n.JS.BoundsOfPaths=function(e,t){t||(t=1);var r=n.Clipper.GetBounds(e);return r.left/=t,r.bottom/=t,r.right/=t,r.top/=t,r},n.JS.Clean=function(e,t){if(!(e instanceof Array))return[];var r=e[0]instanceof Array;e=n.JS.Clone(e);if("number"!=typeof t||null===t)return n.Error("Delta is not a number in Clean()."),e;if(0===e.length||1===e.length&&0===e[0].length||t<0)return e;r||(e=[e]);for(var i,a,s,o,l,h,u,c=e.length,d=[],p=0;p<c;p++)if(0!==(i=(a=e[p]).length)){if(i<3){s=a,d.push(s);continue}for(s=a,o=t*t,l=a[0],h=1,u=1;u<i;u++)(a[u].X-l.X)*(a[u].X-l.X)+(a[u].Y-l.Y)*(a[u].Y-l.Y)<=o||(s[h]=a[u],l=a[u],h++);l=a[h-1],(a[0].X-l.X)*(a[0].X-l.X)+(a[0].Y-l.Y)*(a[0].Y-l.Y)<=o&&h--,h<i&&s.splice(h,i-h),s.length&&d.push(s)}return!r&&d.length?d=d[0]:r||0!==d.length?r&&0===d.length&&(d=[[]]):d=[],d},n.JS.Clone=function(e){if(!(e instanceof Array))return[];if(0===e.length)return[];if(1===e.length&&0===e[0].length)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var n,r,i,a,s=e.length,o=new Array(s);for(r=0;r<s;r++){for(n=e[r].length,a=new Array(n),i=0;i<n;i++)a[i]={X:e[r][i].X,Y:e[r][i].Y};o[r]=a}return t||(o=o[0]),o},n.JS.Lighten=function(e,t){if(!(e instanceof Array))return[];if("number"!=typeof t||null===t)return n.Error("Tolerance is not a number in Lighten()."),n.JS.Clone(e);if(0===e.length||1===e.length&&0===e[0].length||t<0)return n.JS.Clone(e);var r=e[0]instanceof Array;r||(e=[e]);var i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b=e.length,_=t*t,w=[];for(i=0;i<b;i++)if(0!==(h=(s=e[i]).length)){for(o=0;o<1e6;o++){for(l=[],s[(h=s.length)-1].X!==s[0].X||s[h-1].Y!==s[0].Y?(f=1,s.push({X:s[0].X,Y:s[0].Y}),h=s.length):f=0,p=[],a=0;a<h-2;a++)u=s[a],d=s[a+1],c=s[a+2],y=u.X,x=u.Y,m=c.X-y,g=c.Y-x,(0!==m||0!==g)&&((v=((d.X-y)*m+(d.Y-x)*g)/(m*m+g*g))>1?(y=c.X,x=c.Y):v>0&&(y+=m*v,x+=g*v)),(m=d.X-y)*m+(g=d.Y-x)*g<=_&&(p[a+1]=1,a++);for(l.push({X:s[0].X,Y:s[0].Y}),a=1;a<h-1;a++)p[a]||l.push({X:s[a].X,Y:s[a].Y});if(l.push({X:s[h-1].X,Y:s[h-1].Y}),f&&s.pop(),!p.length)break;s=l}l[(h=l.length)-1].X===l[0].X&&l[h-1].Y===l[0].Y&&l.pop(),l.length>2&&w.push(l)}return r||(w=w[0]),void 0===w&&(w=[]),w},n.JS.PerimeterOfPath=function(e,t,n){if(void 0===e)return 0;var r,i,a=Math.sqrt,s=0,o=0,l=0,h=0,u=0,c=e.length;if(c<2)return 0;for(t&&(e[c]=e[0],c++);--c;)o=(r=e[c]).X,l=r.Y,s+=a((o-(h=(i=e[c-1]).X))*(o-h)+(l-(u=i.Y))*(l-u));return t&&e.pop(),s/n},n.JS.PerimeterOfPaths=function(e,t,r){r||(r=1);for(var i=0,a=0;a<e.length;a++)i+=n.JS.PerimeterOfPath(e[a],t,r);return i},n.JS.ScaleDownPath=function(e,t){var n,r;for(t||(t=1),n=e.length;n--;)(r=e[n]).X=r.X/t,r.Y=r.Y/t},n.JS.ScaleDownPaths=function(e,t){var n,r,i;for(t||(t=1),n=e.length;n--;)for(r=e[n].length;r--;)(i=e[n][r]).X=i.X/t,i.Y=i.Y/t},n.JS.ScaleUpPath=function(e,t){var n,r,i=Math.round;for(t||(t=1),n=e.length;n--;)(r=e[n]).X=i(r.X*t),r.Y=i(r.Y*t)},n.JS.ScaleUpPaths=function(e,t){var n,r,i,a=Math.round;for(t||(t=1),n=e.length;n--;)for(r=e[n].length;r--;)(i=e[n][r]).X=a(i.X*t),i.Y=a(i.Y*t)},n.ExPolygons=function(){return[]},n.ExPolygon=function(){this.outer=null,this.holes=null},n.JS.AddOuterPolyNodeToExPolygons=function(e,t){var r=new n.ExPolygon;r.outer=e.Contour();var i,a,s,o,l,h,u=e.Childs(),c=u.length;for(r.holes=new Array(c),s=0;s<c;s++)for(i=u[s],r.holes[s]=i.Contour(),o=0,h=(l=i.Childs()).length;o<h;o++)a=l[o],n.JS.AddOuterPolyNodeToExPolygons(a,t);t.push(r)},n.JS.ExPolygonsToPaths=function(e){var t,r,i,a,s=new n.Paths;for(t=0,i=e.length;t<i;t++)for(s.push(e[t].outer),r=0,a=e[t].holes.length;r<a;r++)s.push(e[t].holes[r]);return s},n.JS.PolyTreeToExPolygons=function(e){var t,r,i,a,s=new n.ExPolygons;for(r=0,a=(i=e.Childs()).length;r<a;r++)t=i[r],n.JS.AddOuterPolyNodeToExPolygons(t,s);return s}}()})),ope=Z((()=>{})),lpe=Z((()=>{})),cpe=Z((()=>{})),upe=Z((()=>{})),hpe=Z((()=>{})),Hpe=Z(((exports,module)=>{var e,t;e=globalThis,t=()=>(()=>{"use strict";var __webpack_modules__=[,(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.TextRenderingMode=t.RenderingIntentFlag=t.PromiseCapability=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.MAX_IMAGE_SIZE_TO_CACHE=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.BASELINE_FACTOR=t.AnnotationType=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.assert=function(e,t){e||s(t)},t.bytesToString=function(e){("object"!=typeof e||void 0===(null==e?void 0:e.length))&&s("Invalid argument for bytesToString");let t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);let r=[];for(let i=0;i<t;i+=n){let a=Math.min(i+n,t),s=e.subarray(i,a);r.push(String.fromCharCode.apply(null,s))}return r.join("")},t.createValidAbsoluteUrl=function(e,t=null,n=null){if(!e)return null;try{if(n&&"string"==typeof e){if(n.addDefaultProtocol&&e.startsWith("www.")){let t=e.match(/\./g);(null==t?void 0:t.length)>=2&&(e=`http://${e}`)}if(n.tryConvertEncoding)try{e=d(e)}catch(e){}}let r=t?new URL(e,t):new URL(e);if(function(e){switch(null==e?void 0:e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(r))return r}catch(e){}return null},t.getModificationDate=function(e=new Date){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return i},t.info=function(e){i>=r.INFOS&&console.log(`Info: ${e}`)},t.isArrayBuffer=function(e){return"object"==typeof e&&void 0!==(null==e?void 0:e.byteLength)},t.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0},t.normalizeUnicode=function(e){return p||(p=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,f=new Map([["ï¬","Å¿t"]])),e.replaceAll(p,((e,t,n)=>t?t.normalize("NFKC"):f.get(n)))},t.objectFromMap=function(e){let t=Object.create(null);for(let[n,r]of e)t[n]=r;return t},t.objectSize=function(e){return Object.keys(e).length},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(i=e)},t.shadow=o,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=h,t.stringToPDFString=function(e){if(e[0]>="Ã¯"){let t;if("Ã¾"===e[0]&&"Ã¿"===e[1]?t="utf-16be":"Ã¿"===e[0]&&"Ã¾"===e[1]?t="utf-16le":"Ã¯"===e[0]&&"Â»"===e[1]&&"Â¿"===e[2]&&(t="utf-8"),t)try{let n=new TextDecoder(t,{fatal:!0}),r=h(e);return n.decode(r)}catch(e){a(`stringToPDFString: "${e}".`)}}let t=[];for(let n=0,r=e.length;n<r;n++){let r=c[e.charCodeAt(n)];t.push(r?String.fromCharCode(r):e.charAt(n))}return t.join("")},t.stringToUTF8String=d,t.unreachable=s,t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=a,t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.MAX_IMAGE_SIZE_TO_CACHE=1e7,t.LINE_FACTOR=1.35,t.LINE_DESCENT_FACTOR=.35,t.BASELINE_FACTOR=.25925925925925924,t.RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},t.AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},t.AnnotationEditorPrefix="pdfjs_internal_editor_",t.AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15},t.AnnotationEditorParamsType={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},t.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},t.PageActionEventType={O:"PageOpen",C:"PageClose"};let r={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=r,t.CMapCompressionType={NONE:0,BINARY:1},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let i=r.WARNINGS;function a(e){i>=r.WARNINGS&&console.log(`Warning: ${e}`)}function s(e){throw new Error(e)}function o(e,t,n,r=!1){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!0,writable:!1}),n}let l=function(){function e(t,n){this.constructor===e&&s("Cannot initialize BaseException."),this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();function h(e){"string"!=typeof e&&s("Invalid argument for stringToBytes");let t=e.length,n=new Uint8Array(t);for(let r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n}t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e,"PasswordException"),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},t.InvalidPDFException=class extends l{constructor(e){super(e,"InvalidPDFException")}},t.MissingPDFException=class extends l{constructor(e){super(e,"MissingPDFException")}},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},t.FormatError=class extends l{constructor(e){super(e,"FormatError")}},t.AbortException=class extends l{constructor(e){super(e,"AbortException")}},t.FeatureTest=class{static get isLittleEndian(){return o(this,"isLittleEndian",function(){let e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return o(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}static get isOffscreenCanvasSupported(){return o(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"==typeof navigator?o(this,"platform",{isWin:!1,isMac:!1}):o(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}};let u=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));t.Util=class{static makeHexColor(e,t,n){return`#${u[e]}${u[t]}${u[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[1],t[1]=n),t[0]*=e[0],t[1]*=e[0],e[3]<0&&(n=t[2],t[2]=t[3],t[3]=n),t[2]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[2],t[2]=n,n=t[1],t[1]=t[3],t[3]=n,e[1]<0&&(n=t[2],t[2]=t[3],t[3]=n),t[2]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[1],t[1]=n),t[0]*=e[2],t[1]*=e[2]),t[0]+=e[4],t[1]+=e[4],t[2]+=e[5],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){let n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]}static getAxialAlignedBoundingBox(e,t){let n=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),i=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],r[0],i[0],a[0]),Math.min(n[1],r[1],i[1],a[1]),Math.max(n[0],r[0],i[0],a[0]),Math.max(n[1],r[1],i[1],a[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],s=(n+a)/2,o=Math.sqrt(Y0(n+a,2)-4*(n*a-i*r))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;let i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[n,i,r,a]}static bezierBoundingBox(e,t,n,r,i,a,s,o){let l,h,u,c,d,p,f,m,g=[],v=[[],[]];for(let v=0;v<2;++v)if(0===v?(h=6*e-12*n+6*i,l=-3*e+9*n-9*i+3*s,u=3*n-3*e):(h=6*t-12*r+6*a,l=-3*t+9*r-9*a+3*o,u=3*r-3*t),Math.abs(l)<1e-12){if(Math.abs(h)<1e-12)continue;c=-u/h,0<c&&c<1&&g.push(c)}else f=h*h-4*u*l,m=Math.sqrt(f),!(f<0)&&(d=(-h+m)/(2*l),0<d&&d<1&&g.push(d),p=(-h-m)/(2*l),0<p&&p<1&&g.push(p));let y,x=g.length,b=x;for(;x--;)c=g[x],y=1-c,v[0][x]=y*y*y*e+3*y*y*c*n+3*y*c*c*i+c*c*c*s,v[1][x]=y*y*y*t+3*y*y*c*r+3*y*c*c*a+c*c*c*o;return v[0][b]=e,v[1][b]=t,v[0][b+1]=s,v[1][b+1]=o,v[0].length=v[1].length=b+2,[Math.min(...v[0]),Math.min(...v[1]),Math.max(...v[0]),Math.max(...v[1])]}};let c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function d(e){return decodeURIComponent(escape(e))}n=new WeakMap,t.PromiseCapability=class{constructor(){Ye(this,n,!1),this.promise=new Promise(((e,t)=>{this.resolve=t=>{xt(this,n,!0),e(t)},this.reject=e=>{xt(this,n,!0),t(e)}}))}get settled(){return re(this,n)}};let p=null,f=null},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var r,t,n,i,w0,a,ZC,l,c,u,h,f,d,p,g,JN,v,E,QN,_,R;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultFilterFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;let DefaultStandardFontDataFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory,createPDFNetworkStream;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{PDFNodeStream:e}=__w_pdfjs_require__(21);createPDFNetworkStream=t=>new e(t)}else{let{PDFNetworkStream:e}=__w_pdfjs_require__(24),{PDFFetchStream:t}=__w_pdfjs_require__(25);createPDFNetworkStream=n=>(0,_display_utils.isValidFetchUrl)(n.url)?new t(n):new e(n)}function getDocument(e){var t,n;if("string"==typeof e||e instanceof URL?e={url:e}:(0,_util.isArrayBuffer)(e)&&(e={data:e}),"object"!=typeof e)throw new Error("Invalid parameter in getDocument, need parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");let r=new PDFDocumentLoadingTask,{docId:i}=r,a=e.url?getUrlProp(e.url):null,s=e.data?getDataProp(e.data):null,o=e.httpHeaders||null,l=!0===e.withCredentials,h=null!=(t=e.password)?t:null,u=e.range instanceof PDFDataRangeTransport?e.range:null,c=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE,d=e.worker instanceof PDFWorker?e.worker:null,p=e.verbosity,f="string"!=typeof e.docBaseUrl||(0,_display_utils.isDataScheme)(e.docBaseUrl)?null:e.docBaseUrl,m="string"==typeof e.cMapUrl?e.cMapUrl:null,g=!1!==e.cMapPacked,v=e.CMapReaderFactory||DefaultCMapReaderFactory,y="string"==typeof e.standardFontDataUrl?e.standardFontDataUrl:null,x=e.StandardFontDataFactory||DefaultStandardFontDataFactory,b=!0!==e.stopAtErrors,_=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,w=!1!==e.isEvalSupported,S="boolean"==typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!_is_node.isNodeJS,M=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,T="boolean"==typeof e.disableFontFace?e.disableFontFace:_is_node.isNodeJS,E=!0===e.fontExtraProperties,A=!0===e.enableXfa,C=e.ownerDocument||globalThis.document,P=!0===e.disableRange,I=!0===e.disableStream,R=!0===e.disableAutoFetch,L=!0===e.pdfBug,O=u?u.length:null!=(n=e.length)?n:NaN,D="boolean"==typeof e.useSystemFonts?e.useSystemFonts:!_is_node.isNodeJS&&!T,k="boolean"==typeof e.useWorkerFetch?e.useWorkerFetch:v===_display_utils.DOMCMapReaderFactory&&x===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(m,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(y,document.baseURI),N=e.canvasFactory||new DefaultCanvasFactory({ownerDocument:C}),F=e.filterFactory||new DefaultFilterFactory({docId:i,ownerDocument:C});(0,_util.setVerbosityLevel)(p);let U={canvasFactory:N,filterFactory:F};if(k||(U.cMapReaderFactory=new v({baseUrl:m,isCompressed:g}),U.standardFontDataFactory=new x({baseUrl:y})),!d){let e={verbosity:p,port:_worker_options.GlobalWorkerOptions.workerPort};d=e.port?PDFWorker.fromPort(e):new PDFWorker(e),r._worker=d}let B={docId:i,apiVersion:"3.8.162",data:s,password:h,disableAutoFetch:R,rangeChunkSize:c,length:O,docBaseUrl:f,enableXfa:A,evaluatorOptions:{maxImageSize:_,disableFontFace:T,ignoreErrors:b,isEvalSupported:w,isOffscreenCanvasSupported:S,canvasMaxAreaInBytes:M,fontExtraProperties:E,useSystemFonts:D,cMapUrl:k?m:null,standardFontDataUrl:k?y:null}},z={ignoreErrors:b,isEvalSupported:w,disableFontFace:T,fontExtraProperties:E,enableXfa:A,ownerDocument:C,disableAutoFetch:R,pdfBug:L,styleElement:null};return d.promise.then((function(){if(r.destroyed)throw new Error("Loading aborted");let e=_fetchDocument(d,B),t=new Promise((function(e){let t;u?t=new _transport_stream.PDFDataTransportStream({length:O,initialData:u.initialData,progressiveDone:u.progressiveDone,contentDispositionFilename:u.contentDispositionFilename,disableRange:P,disableStream:I},u):s||(t=createPDFNetworkStream({url:a,length:O,httpHeaders:o,withCredentials:l,rangeChunkSize:c,disableRange:P,disableStream:I})),e(t)}));return Promise.all([e,t]).then((function([e,t]){if(r.destroyed)throw new Error("Loading aborted");let n=new _message_handler.MessageHandler(i,e,d.port),a=new WorkerTransport(n,r,t,z,U);r._transport=a,n.send("Ready",null)}))})).catch(r._capability.reject),r}function _fetchDocument(e,t){return Et(this,null,(function*(){if(e.destroyed)throw new Error("Worker was destroyed");let n=yield e.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(e.destroyed)throw new Error("Worker was destroyed");return n}))}function getUrlProp(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch(t){if(_is_node.isNodeJS&&"string"==typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(e){if(_is_node.isNodeJS&&"undefined"!=typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"==typeof e)return(0,_util.stringToBytes)(e);if("object"==typeof e&&!isNaN(null==e?void 0:e.length)||(0,_util.isArrayBuffer)(e))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}let e=class{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId="d"+lE(e,r)._++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return Et(this,null,(function*(){var e;this.destroyed=!0,yield null==(e=this._transport)?void 0:e.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}))}},PDFDocumentLoadingTask=e;r=new WeakMap,Ye(PDFDocumentLoadingTask,r,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(let n of this._progressListeners)n(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(let t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(let e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,r,s,o=!1){Ye(this,i),Ye(this,a),Ye(this,t,null),Ye(this,n,!1),this._pageIndex=e,this._pageInfo=r,this._transport=s,this._stats=o?new _display_utils.StatTimer:null,this._pdfBug=o,this.commonObjs=s.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){let t=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return Et(this,null,(function*(){var e;return(null==(e=this._transport._htmlForXfa)?void 0:e.children[this._pageIndex])||null}))}render({canvasContext:e,viewport:t,intent:r="display",annotationMode:s=_util.AnnotationMode.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:h=null,annotationCanvasMap:u=null,pageColors:c=null,printAnnotationStorage:d=null}){var p,f;null==(p=this._stats)||p.time("Overall");let m=this._transport.getRenderingIntent(r,s,d);xt(this,n,!1),at(this,a,ZC).call(this),h||(h=this._transport.getOptionalContentConfig());let g=this._intentStates.get(m.cacheKey);g||(g=Object.create(null),this._intentStates.set(m.cacheKey,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let v=!!(m.renderingIntent&_util.RenderingIntentFlag.PRINT);g.displayReadyCapability||(g.displayReadyCapability=new _util.PromiseCapability,g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null==(f=this._stats)||f.time("Page Request"),this._pumpOperatorList(m));let y=e=>{var t,r;g.renderTasks.delete(x),(this._maybeCleanupAfterRender||v)&&xt(this,n,!0),at(this,i,w0).call(this,!v),e?(x.capability.reject(e),this._abortOperatorList({intentState:g,reason:e instanceof Error?e:new Error(e)})):x.capability.resolve(),null==(t=this._stats)||t.timeEnd("Rendering"),null==(r=this._stats)||r.timeEnd("Overall")},x=new InternalRenderTask({callback:y,params:{canvasContext:e,viewport:t,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:u,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:c});(g.renderTasks||(g.renderTasks=new Set)).add(x);let b=x.task;return Promise.all([g.displayReadyCapability.promise,h]).then((([e,t])=>{var n;this.destroyed?y():(null==(n=this._stats)||n.time("Rendering"),x.initializeGraphics({transparency:e,optionalContentConfig:t}),x.operatorListChanged())})).catch(y),b}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:n=null}={}){var r;let i,a=this._transport.getRenderingIntent(e,t,n,!0),s=this._intentStates.get(a.cacheKey);return s||(s=Object.create(null),this._intentStates.set(a.cacheKey,s)),s.opListReadCapability||(i=Object.create(null),i.operatorListChanged=function(){s.operatorList.lastChunk&&(s.opListReadCapability.resolve(s.operatorList),s.renderTasks.delete(i))},s.opListReadCapability=new _util.PromiseCapability,(s.renderTasks||(s.renderTasks=new Set)).add(i),s.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null==(r=this._stats)||r.time("Page Request"),this._pumpOperatorList(a)),s.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then((e=>_xfa_text.XfaText.textContent(e)));let t=this.streamTextContent(e);return new Promise((function(e,n){let r=t.getReader(),i={items:[],styles:Object.create(null)};!function t(){r.read().then((function({value:n,done:r}){r?e(i):(Object.assign(i.styles,n.styles),i.items.push(...n.items),t())}),n)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),xt(this,n,!1),at(this,a,ZC).call(this),Promise.all(e)}cleanup(e=!1){xt(this,n,!0);let t=at(this,i,w0).call(this,!1);return e&&t&&this._stats&&(this._stats=new _display_utils.StatTimer),t}_startRenderPage(e,t){var n,r;let i=this._intentStates.get(t);i&&(null==(n=this._stats)||n.timeEnd("Page Request"),null==(r=i.displayReadyCapability)||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let e of t.renderTasks)e.operatorListChanged();e.lastChunk&&at(this,i,w0).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n}){let{map:r,transfers:a}=n,s=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r},a).getReader(),o=this._intentStates.get(t);o.streamReader=s;let l=()=>{s.read().then((({value:e,done:t})=>{t?o.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,o),l())}),(e=>{if(o.streamReader=null,!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(let e of o.renderTasks)e.operatorListChanged();at(this,i,w0).call(this,!0)}if(o.displayReadyCapability)o.displayReadyCapability.reject(e);else{if(!o.opListReadCapability)throw e;o.opListReadCapability.reject(e)}}}))};l()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){let n=RENDERING_CANCELLED_TIMEOUT;return t.extraDelay>0&&t.extraDelay<1e3&&(n+=t.extraDelay),void(e.streamReaderCancelTimeout=setTimeout((()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})}),n))}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch((()=>{})),e.streamReader=null,!this._transport.destroyed){for(let[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,n=new WeakMap,i=new WeakSet,w0=function(e=!1){if(at(this,a,ZC).call(this),!re(this,n)||this.destroyed)return!1;if(e)return xt(this,t,setTimeout((()=>{xt(this,t,null),at(this,i,w0).call(this,!1)}),DELAYED_CLEANUP_TIMEOUT)),!1;for(let{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),xt(this,n,!1),!0},a=new WeakSet,ZC=function(){re(this,t)&&(clearTimeout(re(this,t)),xt(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Ye(this,l,new Set),Ye(this,c,Promise.resolve())}postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};re(this,c).then((()=>{for(let e of re(this,l))e.call(this,n)}))}addEventListener(e,t){re(this,l).add(t)}removeEventListener(e,t){re(this,l).delete(t)}terminate(){re(this,l).clear()}}l=new WeakMap,c=new WeakMap,exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};if(exports.PDFWorkerUtil=PDFWorkerUtil,_is_node.isNodeJS&&"function"==typeof v3)PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if("object"==typeof document){let e=null==(u=null==document?void 0:document.currentScript)?void 0:u.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(e,t){let n;try{if(n=new URL(e),!n.origin||"null"===n.origin)return!1}catch(e){return!1}let r=new URL(t,n);return n.origin===r.origin},PDFWorkerUtil.createCDNWrapper=function(e){let t=`importScripts("${e}");`;return URL.createObjectURL(new Blob([t]))};let _PDFWorker=class{constructor({name:e=null,port:t=null,verbosity:n=(0,_util.getVerbosityLevel)()}={}){if(t&&re(_PDFWorker,h).has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,t)return re(_PDFWorker,h).set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:e}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,e)||(e=PDFWorkerUtil.createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e),n=new _message_handler.MessageHandler("main","worker",t),r=()=>{t.removeEventListener("error",i),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||r()};t.addEventListener("error",i),n.on("test",(e=>{t.removeEventListener("error",i),this.destroyed?r():e?(this._messageHandler=n,this._port=t,this._webWorker=t,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),n.destroy(),t.terminate())})),n.on("ready",(e=>{if(t.removeEventListener("error",i),this.destroyed)r();else try{a()}catch(e){this._setupFakeWorker()}}));let a=()=>{let e=new Uint8Array;n.send("test",e,[e.buffer])};return void a()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));let t=new LoopbackPort;this._port=t;let n="fake"+PDFWorkerUtil.fakeWorkerId++,r=new _message_handler.MessageHandler(n+"_worker",n,t);e.setup(r,t);let i=new _message_handler.MessageHandler(n,n+"_worker",t);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),re(_PDFWorker,h).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(null==e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return re(this,h).has(e.port)?re(this,h).get(e.port):new _PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(null!==PDFWorkerUtil.fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var e;try{return(null==(e=globalThis.pdfjsWorker)?void 0:e.WorkerMessageHandler)||null}catch(e){return null}}static get _setupFakeWorkerGlobal(){let loader=()=>Et(this,null,(function*(){let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&"function"==typeof v3){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return yield(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler}));return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}},PDFWorker=_PDFWorker;h=new WeakMap,Ye(PDFWorker,h,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(e,t,n,r,i){Ye(this,g),Ye(this,f,new Map),Ye(this,d,new Map),Ye(this,p,new Map),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,n=null,r=!1){let i=_util.RenderingIntentFlag.DISPLAY,a=_annotation_storage.SerializableEmpty;switch(e){case"any":i=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":i=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:i+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:i+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:i+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,a=(i&_util.RenderingIntentFlag.PRINT&&n instanceof _annotation_storage.PrintAnnotationStorage?n:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return r&&(i+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:i,cacheKey:`${i}_${a.hash}`,annotationStorageSerializable:a}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let t of re(this,d).values())e.push(t._destroy());re(this,d).clear(),re(this,p).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),re(this,f).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{let n=new _util.PromiseCapability,r=this._fullReader;return r.headersReady.then((()=>{var e;(!r.isStreamingSupported||!r.isRangeSupported)&&(this._lastProgress&&(null==(e=t.onProgress)||e.call(t,this._lastProgress)),r.onProgress=e=>{var n;null==(n=t.onProgress)||n.call(t,{loaded:e.loaded,total:e.total})}),n.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})}),n.reject),n.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(e.begin,e.end);n?(t.onPull=()=>{n.read().then((function({value:e,done:n}){n?t.close():((0,_util.assert)(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{n.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let n;switch(e.name){case"PasswordException":n=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":n=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":n=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":n=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":n=new _util.UnknownErrorException(e.message,e.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(n)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=new _util.PromiseCapability,t.onPassword){let n=e=>{e instanceof Error?this._passwordCapability.reject(e):this._passwordCapability.resolve({password:e})};try{t.onPassword(n,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{var n;null==(n=t.onProgress)||n.call(t,{loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||re(this,d).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(([t,n,r])=>{var i;if(!this.destroyed&&!this.commonObjs.has(t))switch(n){case"Font":let a=this._params;if("error"in r){let e=r.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}let s=a.pdfBug&&null!=(i=globalThis.FontInspector)&&i.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,o=new _font_loader.FontFaceObject(r,{isEvalSupported:a.isEvalSupported,disableFontFace:a.disableFontFace,ignoreErrors:a.ignoreErrors,inspectFont:s});this.fontLoader.bind(o).catch((n=>e.sendWithPromise("FontFallback",{id:t}))).finally((()=>{!a.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(t,o)}));break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(t,r);break;default:throw new Error(`Got unknown common object type ${n}`)}})),e.on("obj",(([e,t,n,r])=>{var i;if(this.destroyed)return;let a=re(this,d).get(t);if(!a.objs.has(e))switch(n){case"Image":if(a.objs.resolve(e,r),r){let e;if(r.bitmap){let{width:t,height:n}=r;e=t*n*4}else e=(null==(i=r.data)?void 0:i.length)||0;e>_util.MAX_IMAGE_SIZE_TO_CACHE&&(a._maybeCleanupAfterRender=!0)}break;case"Pattern":a.objs.resolve(e,r);break;default:throw new Error(`Got unknown object type ${n}`)}})),e.on("DocProgress",(e=>{var n;this.destroyed||null==(n=t.onProgress)||n.call(t,{loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var e,t;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:n,transfers:r}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:n,filename:null!=(t=null==(e=this._fullReader)?void 0:e.filename)?t:null},r).finally((()=>{this.annotationStorage.resetModified()}))}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,n=re(this,p).get(t);if(n)return n;let r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");let n=new PDFPageProxy(t,e,this,this._params.pdfBug);return re(this,d).set(t,n),n}));return re(this,p).set(t,r),r}getPageIndex(e){return"object"!=typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return at(this,g,JN).call(this,"GetFieldObjects")}hasJSActions(){return at(this,g,JN).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=re(this,f).get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then((e=>{var t,n,r,i;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:null!=(n=null==(t=this._fullReader)?void 0:t.filename)?n:null,contentLength:null!=(i=null==(r=this._fullReader)?void 0:r.contentLength)?i:null}}));return re(this,f).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return Et(this,null,(function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let e of re(this,d).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),re(this,f).clear(),this.filterFactory.destroy(!0)}}))}get loadingParams(){let{disableAutoFetch:e,enableXfa:t}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e,enableXfa:t})}}f=new WeakMap,d=new WeakMap,p=new WeakMap,g=new WeakSet,JN=function(e,t=null){let n=re(this,f).get(e);if(n)return n;let r=this.messageHandler.sendWithPromise(e,t);return re(this,f).set(e,r),r};class PDFObjects{constructor(){Ye(this,E),Ye(this,v,Object.create(null))}get(e,t=null){if(t){let n=at(this,E,QN).call(this,e);return n.capability.promise.then((()=>t(n.data))),null}let n=re(this,v)[e];if(null==n||!n.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=re(this,v)[e];return(null==t?void 0:t.capability.settled)||!1}resolve(e,t=null){let n=at(this,E,QN).call(this,e);n.data=t,n.capability.resolve()}clear(){var e;for(let t in re(this,v)){let{data:n}=re(this,v)[t];null==(e=null==n?void 0:n.bitmap)||e.close()}xt(this,v,Object.create(null))}}v=new WeakMap,E=new WeakSet,QN=function(e){return re(this,v)[e]||(re(this,v)[e]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(e){Ye(this,_,null),xt(this,_,e),this.onContinue=null}get promise(){return re(this,_).capability.promise}cancel(e=0){re(this,_).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=re(this,_).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=re(this,_);return e.form||e.canvas&&(null==t?void 0:t.size)>0}}_=new WeakMap,exports.RenderTask=RenderTask;let A=class{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:s,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:u=!1,pageColors:c=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=s,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=u,this.pageColors=c,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!=typeof window,this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var n,r;if(this.cancelled)return;if(this._canvas){if(re(A,R).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");re(A,R).add(this._canvas)}this._pdfBug&&null!=(n=globalThis.StepperManager)&&n.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:a,transform:s,background:o}=this.params;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:a,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,null==(r=this.graphicsReadyCallback)||r.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,null==(n=this.gfx)||n.endDrawing(),this._canvas&&re(A,R).delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;this.graphicsReady?(null==(e=this.stepper)||e.updateOperatorList(this.operatorList),!this.running&&this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return Et(this,null,(function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&re(A,R).delete(this._canvas),this.callback())))}))}},InternalRenderTask=A;R=new WeakMap,Ye(InternalRenderTask,R,new WeakSet);let version="3.8.162";exports.version=version;let build="2c74323e3";exports.build=build},(e,t,n)=>{var r,i,a,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.SerializableEmpty=t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var l=n(1),h=n(4),u=n(8);let c=Object.freeze({map:null,hash:"",transfers:void 0});t.SerializableEmpty=c;class d{constructor(){Ye(this,a),Ye(this,r,!1),Ye(this,i,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=re(this,i).get(e);return void 0===n?t:Object.assign(t,n)}getRawValue(e){return re(this,i).get(e)}remove(e){if(re(this,i).delete(e),0===re(this,i).size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(let e of re(this,i).values())if(e instanceof h.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=re(this,i).get(e),r=!1;if(void 0!==n)for(let[e,i]of Object.entries(t))n[e]!==i&&(r=!0,n[e]=i);else r=!0,re(this,i).set(e,t);r&&at(this,a,s).call(this),t instanceof h.AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return re(this,i).has(e)}getAll(){return re(this,i).size>0?(0,l.objectFromMap)(re(this,i)):null}setAll(e){for(let[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return re(this,i).size}resetModified(){re(this,r)&&(xt(this,r,!1),"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new p(this)}get serializable(){if(0===re(this,i).size)return c;let e=new Map,t=new u.MurmurHash3_64,n=[];for(let[r,a]of re(this,i)){let i=a instanceof h.AnnotationEditor?a.serialize():a;i&&(e.set(r,i),t.update(`${r}:${JSON.stringify(i)}`),i.bitmap&&n.push(i.bitmap))}return e.size>0?{map:e,hash:t.hexdigest(),transfers:n}:c}}r=new WeakMap,i=new WeakMap,a=new WeakSet,s=function(){re(this,r)||(xt(this,r,!0),"function"==typeof this.onSetModified&&this.onSetModified())},t.AnnotationStorage=d;class p extends d{constructor(e){super(),Ye(this,o,void 0);let{map:t,hash:n,transfers:r}=e.serializable,i=structuredClone(t,r?{transfer:r}:null);xt(this,o,{map:i,hash:n,transfers:r})}get print(){(0,l.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return re(this,o)}}o=new WeakMap,t.PrintAnnotationStorage=p},(e,t,n)=>{var r,i,a,s,o,l;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var h=n(5),u=n(1);let c=class{constructor(e){Ye(this,r,this.focusin.bind(this)),Ye(this,i,this.focusout.bind(this)),Ye(this,a,!1),Ye(this,s,!1),Ye(this,o,!1),li(this,"_uiManager",null),Ye(this,l,c._zIndex++),this.constructor===c&&(0,u.unreachable)("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:h,pageX:d,pageY:p}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,h],this.pageTranslation=[d,p];let[f,m]=this.parentDimensions;this.x=e.x/f,this.y=e.y/m,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,u.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new p({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=re(this,l)}setParent(e){null!==e&&(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions),this.parent=e}focusin(e){re(this,a)?xt(this,a,!1):this.parent.setSelected(this)}focusout(e){var t;if(!this.isAttachedToDOM)return;let n=e.relatedTarget;null!=n&&n.closest(`#${this.id}`)||(e.preventDefault(),null!=(t=this.parent)&&t.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(e){let t=this.parent.div.getBoundingClientRect();this.startX=e.clientX-t.x,this.startY=e.clientY-t.y,e.dataTransfer.setData("text/plain",this.id),e.dataTransfer.effectAllowed="move"}setAt(e,t,n,r){let[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}translate(e,t){let[n,r]=this.parentDimensions;[e,t]=this.screenToPageTranslation(e,t),this.x+=e/n,this.y+=t/r,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}screenToPageTranslation(e,t){switch(this.parentRotation){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{realScale:e}=this._uiManager.viewParameters,[t,n]=this.pageDimensions;return[t*e,n*e]}setDims(e,t){let[n,r]=this.parentDimensions;this.div.style.width=100*e/n+"%",this.div.style.height=100*t/r+"%"}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,r=n.endsWith("%"),i=t.endsWith("%");if(r&&i)return;let[a,s]=this.parentDimensions;r||(e.width=100*parseFloat(n)/a+"%"),i||(e.height=100*parseFloat(t)/s+"%")}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",re(this,r)),this.div.addEventListener("focusout",re(this,i));let[e,t]=this.getInitialTranslation();return this.translate(e,t),(0,h.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(e){let{isMac:t}=u.FeatureTest.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this),xt(this,a,!0))}getRect(e,t){let n=this.parentScale,[r,i]=this.pageDimensions,[a,s]=this.pageTranslation,o=e/n,l=t/n,h=this.x*r,u=this.y*i,c=this.width*r,d=this.height*i;switch(this.rotation){case 0:return[h+o+a,i-u-l-d+s,h+o+c+a,i-u-l+s];case 90:return[h+l+a,i-u+o+s,h+l+d+a,i-u+o+c+s];case 180:return[h-o-c+a,i-u+l+s,h-o+a,i-u+l+d+s];case 270:return[h-l-d+a,i-u-o-c+s,h-l+a,i-u-o+s];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[n,r,i,a]=e,s=i-n,o=a-r;switch(this.rotation){case 0:return[n,t-a,s,o];case 90:return[n,t-r,o,s];case 180:return[i,t-r,s,o];case 270:return[i,t-a,o,s];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){xt(this,o,!0)}disableEditMode(){xt(this,o,!1)}isInEditMode(){return re(this,o)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var e,t;null==(e=this.div)||e.addEventListener("focusin",re(this,r)),null==(t=this.div)||t.addEventListener("focusout",re(this,i))}serialize(e=!1){(0,u.unreachable)("An editor must be serializable")}static deserialize(e,t,n){let r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});r.rotation=e.rotation;let[i,a]=r.pageDimensions,[s,o,l,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=s/i,r.y=o/a,r.width=l/i,r.height=h/a,r}remove(){this.div.removeEventListener("focusin",re(this,r)),this.div.removeEventListener("focusout",re(this,i)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var e;null==(e=this.div)||e.classList.add("selectedEditor")}unselect(){var e;null==(e=this.div)||e.classList.remove("selectedEditor")}updateParams(e,t){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return re(this,s)}set isEditing(e){xt(this,s,e),e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}},d=c;r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,li(d,"_colorManager",new h.ColorManager),li(d,"_zIndex",1),t.AnnotationEditor=d;class p extends d{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,A,C,P,I,R,L,O,D,k,N,F,U,B,z,H,V,j,G,W,q,X,Y,Z,J,K,Q,$,ee,te;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=function(e,t,n){for(let r of n)t.addEventListener(r,e[r].bind(e))},t.opacityToHex=function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")};var ne=n(1),ie=n(6);class ae{constructor(){Ye(this,r,0)}getId(){return`${ne.AnnotationEditorPrefix}${lE(this,r)._++}`}}r=new WeakMap;class se{constructor(e=128){Ye(this,i,[]),Ye(this,a,!1),Ye(this,s,void 0),Ye(this,o,-1),xt(this,s,e)}add({cmd:e,undo:t,mustExec:n,type:r=NaN,overwriteIfSameType:l=!1,keepUndo:h=!1}){if(n&&e(),re(this,a))return;let u={cmd:e,undo:t,type:r};if(-1===re(this,o))return re(this,i).length>0&&(re(this,i).length=0),xt(this,o,0),void re(this,i).push(u);if(l&&re(this,i)[re(this,o)].type===r)return h&&(u.undo=re(this,i)[re(this,o)].undo),void(re(this,i)[re(this,o)]=u);let c=re(this,o)+1;c===re(this,s)?re(this,i).splice(0,1):(xt(this,o,c),c<re(this,i).length&&re(this,i).splice(c)),re(this,i).push(u)}undo(){-1!==re(this,o)&&(xt(this,a,!0),re(this,i)[re(this,o)].undo(),xt(this,a,!1),xt(this,o,re(this,o)-1))}redo(){re(this,o)<re(this,i).length-1&&(xt(this,o,re(this,o)+1),xt(this,a,!0),re(this,i)[re(this,o)].cmd(),xt(this,a,!1))}hasSomethingToUndo(){return-1!==re(this,o)}hasSomethingToRedo(){return re(this,o)<re(this,i).length-1}destroy(){xt(this,i,null)}}i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,t.CommandManager=se;class oe{constructor(e){Ye(this,l),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=ne.FeatureTest.platform;for(let[n,r,i=!1]of e)for(let e of n){let n=e.startsWith("mac+");t&&n?(this.callbacks.set(e.slice(4),{callback:r,bubbles:i}),this.allKeys.add(e.split("+").at(-1))):!t&&!n&&(this.callbacks.set(e,{callback:r,bubbles:i}),this.allKeys.add(e.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(at(this,l,h).call(this,t));if(!n)return;let{callback:r,bubbles:i}=n;r.bind(e)(),i||(t.stopPropagation(),t.preventDefault())}}l=new WeakSet,h=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t},t.KeyboardManager=oe;let le=class{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return(0,ie.getColorValues)(e),(0,ne.shadow)(this,"_colors",e)}convert(e){let t=(0,ie.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[e,n]of this._colors)if(n.every(((e,n)=>e===t[n])))return le._colorsMapping.get(e);return t}getHexCode(e){let t=this._colors.get(e);return t?ne.Util.makeHexColor(...t):e}},he=le;li(he,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),t.ColorManager=he;let ue=class{constructor(e,t,n){Ye(this,D),Ye(this,N),Ye(this,U),Ye(this,z),Ye(this,V),Ye(this,G),Ye(this,q),Ye(this,Y),Ye(this,J),Ye(this,Q),Ye(this,ee),Ye(this,u,null),Ye(this,c,new Map),Ye(this,d,new Map),Ye(this,p,null),Ye(this,f,new se),Ye(this,m,0),Ye(this,g,new Set),Ye(this,v,null),Ye(this,y,new Set),Ye(this,x,null),Ye(this,b,new ae),Ye(this,_,!1),Ye(this,w,ne.AnnotationEditorType.NONE),Ye(this,S,new Set),Ye(this,M,this.copy.bind(this)),Ye(this,T,this.cut.bind(this)),Ye(this,E,this.paste.bind(this)),Ye(this,A,this.keydown.bind(this)),Ye(this,C,this.onEditingAction.bind(this)),Ye(this,P,this.onPageChanging.bind(this)),Ye(this,I,this.onScaleChanging.bind(this)),Ye(this,R,this.onRotationChanging.bind(this)),Ye(this,L,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1}),Ye(this,O,null),xt(this,O,e),xt(this,x,t),re(this,x)._on("editingaction",re(this,C)),re(this,x)._on("pagechanging",re(this,P)),re(this,x)._on("scalechanging",re(this,I)),re(this,x)._on("rotationchanging",re(this,R)),xt(this,p,n),this.viewParameters={realScale:ie.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){return(0,ne.shadow)(this,"_keyboardManager",new oe([[["ctrl+a","mac+meta+a"],ue.prototype.selectAll],[["ctrl+z","mac+meta+z"],ue.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],ue.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],ue.prototype.delete],[["Escape","mac+Escape"],ue.prototype.unselectAll]]))}destroy(){at(this,N,F).call(this),re(this,x)._off("editingaction",re(this,C)),re(this,x)._off("pagechanging",re(this,P)),re(this,x)._off("scalechanging",re(this,I)),re(this,x)._off("rotationchanging",re(this,R));for(let e of re(this,d).values())e.destroy();re(this,d).clear(),re(this,c).clear(),re(this,y).clear(),xt(this,u,null),re(this,S).clear(),re(this,f).destroy()}onPageChanging({pageNumber:e}){xt(this,m,e-1)}focusMainContainer(){re(this,O).focus()}addShouldRescale(e){re(this,y).add(e)}removeShouldRescale(e){re(this,y).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*ie.PixelsPerInch.PDF_TO_CSS_UNITS;for(let e of re(this,y))e.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&re(this,p)&&!re(this,p).has(e.id)&&re(this,p).setValue(e.id,e)}copy(e){if(e.preventDefault(),re(this,u)&&re(this,u).commitOrRemove(),!this.hasSelection)return;let t=[];for(let e of re(this,S)){let n=e.serialize(!0);n&&t.push(n)}0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();let t=e.clipboardData.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(e){return void(0,ne.warn)(`paste: "${e.message}".`)}if(!Array.isArray(t))return;this.unselectAll();let n=re(this,d).get(re(this,m));try{let e=[];for(let r of t){let t=n.deserialize(r);if(!t)return;e.push(t)}let r=()=>{for(let t of e)at(this,J,K).call(this,t);at(this,ee,te).call(this,e)},i=()=>{for(let t of e)t.remove()};this.addCommands({cmd:r,undo:i,mustExec:!0})}catch(e){(0,ne.warn)(`paste: "${e.message}".`)}}keydown(e){var t;null!=(t=this.getActive())&&t.shouldGetKeyboardEvents()||ue._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(at(this,D,k).call(this),at(this,U,B).call(this),at(this,V,j).call(this,{isEditing:re(this,w)!==ne.AnnotationEditorType.NONE,isEmpty:at(this,Q,$).call(this),hasSomethingToUndo:re(this,f).hasSomethingToUndo(),hasSomethingToRedo:re(this,f).hasSomethingToRedo(),hasSelectedEditor:!1})):(at(this,N,F).call(this),at(this,z,H).call(this),at(this,V,j).call(this,{isEditing:!1}))}registerEditorTypes(e){if(!re(this,v)){xt(this,v,e);for(let e of re(this,v))at(this,G,W).call(this,e.defaultPropertiesToUpdate)}}getId(){return re(this,b).getId()}get currentLayer(){return re(this,d).get(re(this,m))}get currentPageIndex(){return re(this,m)}addLayer(e){re(this,d).set(e.pageIndex,e),re(this,_)?e.enable():e.disable()}removeLayer(e){re(this,d).delete(e.pageIndex)}updateMode(e){if(xt(this,w,e),e===ne.AnnotationEditorType.NONE)this.setEditingState(!1),at(this,Y,Z).call(this);else{this.setEditingState(!0),at(this,q,X).call(this);for(let t of re(this,d).values())t.updateMode(e)}}updateToolbar(e){e!==re(this,w)&&re(this,x).dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(re(this,v)){for(let n of re(this,S))n.updateParams(e,t);for(let n of re(this,v))n.updateDefaultParams(e,t)}}getEditors(e){let t=[];for(let n of re(this,c).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return re(this,c).get(e)}addEditor(e){re(this,c).set(e.id,e)}removeEditor(e){var t;re(this,c).delete(e.id),this.unselect(e),(!e.annotationElementId||!re(this,g).has(e.annotationElementId))&&(null==(t=re(this,p))||t.remove(e.id))}addDeletedAnnotationElement(e){re(this,g).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return re(this,g).has(e)}removeDeletedAnnotationElement(e){re(this,g).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){re(this,u)!==e&&(xt(this,u,e),e&&at(this,G,W).call(this,e.propertiesToUpdate))}toggleSelected(e){if(re(this,S).has(e))return re(this,S).delete(e),e.unselect(),void at(this,V,j).call(this,{hasSelectedEditor:this.hasSelection});re(this,S).add(e),e.select(),at(this,G,W).call(this,e.propertiesToUpdate),at(this,V,j).call(this,{hasSelectedEditor:!0})}setSelected(e){for(let t of re(this,S))t!==e&&t.unselect();re(this,S).clear(),re(this,S).add(e),e.select(),at(this,G,W).call(this,e.propertiesToUpdate),at(this,V,j).call(this,{hasSelectedEditor:!0})}isSelected(e){return re(this,S).has(e)}unselect(e){e.unselect(),re(this,S).delete(e),at(this,V,j).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==re(this,S).size}undo(){re(this,f).undo(),at(this,V,j).call(this,{hasSomethingToUndo:re(this,f).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:at(this,Q,$).call(this)})}redo(){re(this,f).redo(),at(this,V,j).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:re(this,f).hasSomethingToRedo(),isEmpty:at(this,Q,$).call(this)})}addCommands(e){re(this,f).add(e),at(this,V,j).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:at(this,Q,$).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let e=[...re(this,S)];this.addCommands({cmd:()=>{for(let t of e)t.remove()},undo:()=>{for(let t of e)at(this,J,K).call(this,t)},mustExec:!0})}commitOrRemove(){var e;null==(e=re(this,u))||e.commitOrRemove()}selectAll(){for(let e of re(this,S))e.commit();at(this,ee,te).call(this,re(this,c).values())}unselectAll(){if(re(this,u))re(this,u).commitOrRemove();else if(0!==re(this,S).size){for(let e of re(this,S))e.unselect();re(this,S).clear(),at(this,V,j).call(this,{hasSelectedEditor:!1})}}isActive(e){return re(this,u)===e}getActive(){return re(this,u)}getMode(){return re(this,w)}},ce=ue;u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,x=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakMap,M=new WeakMap,T=new WeakMap,E=new WeakMap,A=new WeakMap,C=new WeakMap,P=new WeakMap,I=new WeakMap,R=new WeakMap,L=new WeakMap,O=new WeakMap,D=new WeakSet,k=function(){re(this,O).addEventListener("keydown",re(this,A))},N=new WeakSet,F=function(){re(this,O).removeEventListener("keydown",re(this,A))},U=new WeakSet,B=function(){document.addEventListener("copy",re(this,M)),document.addEventListener("cut",re(this,T)),document.addEventListener("paste",re(this,E))},z=new WeakSet,H=function(){document.removeEventListener("copy",re(this,M)),document.removeEventListener("cut",re(this,T)),document.removeEventListener("paste",re(this,E))},V=new WeakSet,j=function(e){Object.entries(e).some((([e,t])=>re(this,L)[e]!==t))&&re(this,x).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(re(this,L),e)})},G=new WeakSet,W=function(e){re(this,x).dispatch("annotationeditorparamschanged",{source:this,details:e})},q=new WeakSet,X=function(){if(!re(this,_)){xt(this,_,!0);for(let e of re(this,d).values())e.enable()}},Y=new WeakSet,Z=function(){if(this.unselectAll(),re(this,_)){xt(this,_,!1);for(let e of re(this,d).values())e.disable()}},J=new WeakSet,K=function(e){let t=re(this,d).get(e.pageIndex);t?t.addOrRebuild(e):this.addEditor(e)},Q=new WeakSet,$=function(){if(0===re(this,c).size)return!0;if(1===re(this,c).size)for(let e of re(this,c).values())return e.isEmpty();return!1},ee=new WeakSet,te=function(e){re(this,S).clear();for(let t of e)t.isEmpty()||(re(this,S).add(t),t.select());at(this,V,j).call(this,{hasSelectedEditor:!0})},t.AnnotationEditorUIManager=ce},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,A;Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMFilterFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=t.AnnotationPrefix=void 0,t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.getColorValues=function(e){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let n of e.keys()){t.style.color=n;let r=window.getComputedStyle(t).color;e.set(n,G(r))}t.remove()},t.getCurrentTransform=function(e){let{a:t,b:n,c:r,d:i,e:a,f:s}=e.getTransform();return[t,n,r,i,a,s]},t.getCurrentTransformInverse=function(e){let{a:t,b:n,c:r,d:i,e:a,f:s}=e.getTransform().invertSelf();return[t,n,r,i,a,s]},t.getFilenameFromUrl=function(e,t=!1){return t||([e]=e.split(/[#?]/,1)),e.substring(e.lastIndexOf("/")+1)},t.getPdfFilenameFromUrl=function(e,t="document.pdf"){if("string"!=typeof e)return t;if(V(e))return(0,P.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e),i=n.exec(r[1])||n.exec(r[2])||n.exec(r[3]);if(i&&(i=i[0],i.includes("%")))try{i=n.exec(decodeURIComponent(i))[0]}catch(e){}return i||t},t.getRGB=G,t.getXfaPageViewport=function(e,{scale:t=1,rotation:n=0}){let{width:r,height:i}=e.attributes.style,a=[0,0,parseInt(r),parseInt(i)];return new z({viewBox:a,scale:t,rotation:n})},t.isDataScheme=V,t.isPdfFile=function(e){return"string"==typeof e&&/\.pdf$/i.test(e)},t.isValidFetchUrl=j,t.loadScript=function(e,t=!1){return new Promise(((n,r)=>{let i=document.createElement("script");i.src=e,i.onload=function(e){t&&i.remove(),n(e)},i.onerror=function(){r(new Error(`Cannot load script at: ${i.src}`))},(document.head||document.documentElement).append(i)}))},t.setLayerDimensions=function(e,t,n=!1,r=!0){if(t instanceof z){let{pageWidth:r,pageHeight:i}=t.rawDims,{style:a}=e,s=`calc(var(--scale-factor) * ${r}px)`,o=`calc(var(--scale-factor) * ${i}px)`;n&&t.rotation%180!=0?(a.width=o,a.height=s):(a.width=s,a.height=o)}r&&e.setAttribute("data-main-rotation",t.rotation)};var C=n(7),P=n(1);let I="http://www.w3.org/2000/svg";t.AnnotationPrefix="pdfjs_internal_id_";let R,L=class{},O=L;li(O,"CSS",96),li(O,"PDF",72),li(O,"PDF_TO_CSS_UNITS",L.CSS/L.PDF),t.PixelsPerInch=O;class D extends C.BaseFilterFactory{constructor({docId:e,ownerDocument:t=globalThis.document}={}){super(),Ye(this,f),Ye(this,g),Ye(this,y),Ye(this,b),Ye(this,w),Ye(this,M),Ye(this,E),Ye(this,r,void 0),Ye(this,i,void 0),Ye(this,a,void 0),Ye(this,s,void 0),Ye(this,o,void 0),Ye(this,l,void 0),Ye(this,h,void 0),Ye(this,u,void 0),Ye(this,c,void 0),Ye(this,d,void 0),Ye(this,p,0),xt(this,a,e),xt(this,s,t)}addFilter(e){if(!e)return"none";let t,n,r,i,s=re(this,f,m).get(e);if(s)return s;if(1===e.length){let a=e[0],s=new Array(256);for(let e=0;e<256;e++)s[e]=a[e]/255;i=t=n=r=s.join(",")}else{let[a,s,o]=e,l=new Array(256),h=new Array(256),u=new Array(256);for(let e=0;e<256;e++)l[e]=a[e]/255,h[e]=s[e]/255,u[e]=o[e]/255;t=l.join(","),n=h.join(","),r=u.join(","),i=`${t}${n}${r}`}if(s=re(this,f,m).get(i),s)return re(this,f,m).set(e,s),s;let o=`g_${re(this,a)}_transfer_map_${lE(this,p)._++}`,l=`url(#${o})`;re(this,f,m).set(e,l),re(this,f,m).set(i,l);let h=at(this,b,_).call(this,o);return at(this,M,T).call(this,t,n,r,h),l}addHCMFilter(e,t){var n;let r=`${e}-${t}`;if(re(this,l)===r)return re(this,h);if(xt(this,l,r),xt(this,h,"none"),null==(n=re(this,o))||n.remove(),!e||!t)return re(this,h);let i=at(this,E,A).call(this,e);e=P.Util.makeHexColor(...i);let s=at(this,E,A).call(this,t);if(t=P.Util.makeHexColor(...s),re(this,g,v).style.color="","#000000"===e&&"#ffffff"===t||e===t)return re(this,h);let c=new Array(256);for(let e=0;e<=255;e++){let t=e/255;c[e]=t<=.03928?t/12.92:Y0((t+.055)/1.055,2.4)}let d=c.join(","),p=`g_${re(this,a)}_hcm_filter`,f=xt(this,u,at(this,b,_).call(this,p));at(this,M,T).call(this,d,d,d,f),at(this,y,x).call(this,f);let m=(e,t)=>{let n=i[e]/255,r=s[e]/255,a=new Array(t+1);for(let e=0;e<=t;e++)a[e]=n+e/t*(r-n);return a.join(",")};return at(this,M,T).call(this,m(0,5),m(1,5),m(2,5),f),xt(this,h,`url(#${p})`),re(this,h)}addHighlightHCMFilter(e,t,n,r){var i;let s=`${e}-${t}-${n}-${r}`;if(re(this,c)===s)return re(this,d);if(xt(this,c,s),xt(this,d,"none"),null==(i=re(this,u))||i.remove(),!e||!t)return re(this,d);let[o,l]=[e,t].map(at(this,E,A).bind(this)),h=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),p=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[f,m]=[n,r].map(at(this,E,A).bind(this));p<h&&([h,p,f,m]=[p,h,m,f]),re(this,g,v).style.color="";let w=(e,t,n)=>{let r=new Array(256),i=(p-h)/n,a=e/255,s=(t-e)/(255*n),o=0;for(let e=0;e<=n;e++){let t=Math.round(h+e*i),n=a+e*s;for(let e=o;e<=t;e++)r[e]=n;o=t+1}for(let e=o;e<256;e++)r[e]=r[o-1];return r.join(",")},S=`g_${re(this,a)}_hcm_highlight_filter`,C=xt(this,u,at(this,b,_).call(this,S));return at(this,y,x).call(this,C),at(this,M,T).call(this,w(f[0],m[0],5),w(f[1],m[1],5),w(f[2],m[2],5),C),xt(this,d,`url(#${S})`),re(this,d)}destroy(e=!1){e&&(re(this,h)||re(this,d))||(re(this,i)&&(re(this,i).parentNode.parentNode.remove(),xt(this,i,null)),re(this,r)&&(re(this,r).clear(),xt(this,r,null)),xt(this,p,0))}}r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakSet,m=function(){return re(this,r)||xt(this,r,new Map)},g=new WeakSet,v=function(){if(!re(this,i)){let e=re(this,s).createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let n=re(this,s).createElementNS(I,"svg");n.setAttribute("width",0),n.setAttribute("height",0),xt(this,i,re(this,s).createElementNS(I,"defs")),e.append(n),n.append(re(this,i)),re(this,s).body.append(e)}return re(this,i)},y=new WeakSet,x=function(e){let t=re(this,s).createElementNS(I,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)},b=new WeakSet,_=function(e){let t=re(this,s).createElementNS(I,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),re(this,g,v).append(t),t},w=new WeakSet,S=function(e,t,n){let r=re(this,s).createElementNS(I,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",n),e.append(r)},M=new WeakSet,T=function(e,t,n,r){let i=re(this,s).createElementNS(I,"feComponentTransfer");r.append(i),at(this,w,S).call(this,i,"feFuncR",e),at(this,w,S).call(this,i,"feFuncG",t),at(this,w,S).call(this,i,"feFuncB",n)},E=new WeakSet,A=function(e){return re(this,g,v).style.color=e,G(getComputedStyle(re(this,g,v)).getPropertyValue("color"))},t.DOMFilterFactory=D;class k extends C.BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}_createCanvas(e,t){let n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}function N(e,t=!1){return Et(this,null,(function*(){if(j(e,document.baseURI)){let n=yield fetch(e);if(!n.ok)throw new Error(n.statusText);return t?new Uint8Array(yield n.arrayBuffer()):(0,P.stringToBytes)(yield n.text())}return new Promise(((n,r)=>{let i=new XMLHttpRequest;i.open("GET",e,!0),t&&(i.responseType="arraybuffer"),i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(200===i.status||0===i.status){let e;if(t&&i.response?e=new Uint8Array(i.response):!t&&i.responseText&&(e=(0,P.stringToBytes)(i.responseText)),e)return void n(e)}r(new Error(i.statusText))}},i.send(null)}))}))}t.DOMCanvasFactory=k;class F extends C.BaseCMapReaderFactory{_fetchData(e,t){return N(e,this.isCompressed).then((e=>({cMapData:e,compressionType:t})))}}t.DOMCMapReaderFactory=F;class U extends C.BaseStandardFontDataFactory{_fetchData(e){return N(e,!0)}}t.DOMStandardFontDataFactory=U;class B extends C.BaseSVGFactory{_createSVG(e){return document.createElementNS(I,e)}}t.DOMSVGFactory=B;class z{constructor({viewBox:e,scale:t,rotation:n,offsetX:r=0,offsetY:i=0,dontFlip:a=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=r,this.offsetY=i;let s,o,l,h,u,c,d,p,f=(e[2]+e[0])/2,m=(e[3]+e[1])/2;switch((n%=360)<0&&(n+=360),n){case 180:s=-1,o=0,l=0,h=1;break;case 90:s=0,o=1,l=1,h=0;break;case 270:s=0,o=-1,l=-1,h=0;break;case 0:s=1,o=0,l=0,h=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(l=-l,h=-h),0===s?(u=Math.abs(m-e[1])*t+r,c=Math.abs(f-e[0])*t+i,d=(e[3]-e[1])*t,p=(e[2]-e[0])*t):(u=Math.abs(f-e[0])*t+r,c=Math.abs(m-e[1])*t+i,d=(e[2]-e[0])*t,p=(e[3]-e[1])*t),this.transform=[s*t,o*t,l*t,h*t,u-s*t*f-l*t*m,c-o*t*f-h*t*m],this.width=d,this.height=p}get rawDims(){let{viewBox:e}=this;return(0,P.shadow)(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new z({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){return P.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=P.Util.applyTransform([e[0],e[1]],this.transform),n=P.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return P.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=z;class H extends P.BaseException{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function V(e){let t=e.length,n=0;for(;n<t&&""===e[n].trim();)n++;return"data:"===e.substring(n,n+5).toLowerCase()}function j(e,t){try{let{protocol:n}=t?new URL(e,t):new URL(e);return"http:"===n||"https:"===n}catch(e){return!1}}function G(e){if(e.startsWith("#")){let t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):((0,P.warn)(`Not a valid color format: "${e}"`),[0,0,0])}t.RenderingCancelledException=H,t.StatTimer=class{constructor(){li(this,"started",Object.create(null)),li(this,"times",[])}time(e){e in this.started&&(0,P.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,P.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:e}of this.times)t=Math.max(e.length,t);for(let{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms\n`);return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||"string"!=typeof e)return null;R||(R=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=R.exec(e);if(!t)return null;let n=parseInt(t[1],10),r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let s=parseInt(t[5],10);s=s>=0&&s<=59?s:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;let l=t[7]||"Z",h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,"-"===l?(a+=h,s+=u):"+"===l&&(a-=h,s-=u),new Date(Date.UTC(n,r,i,a,s,o))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseFilterFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var r=n(1);class i{constructor(){this.constructor===i&&(0,r.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addHighlightHCMFilter(e,t,n,r){return"none"}destroy(e=!1){}}t.BaseFilterFactory=i;class a{constructor(){this.constructor===a&&(0,r.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d")}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,r.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=a;class s{constructor({baseUrl:e=null,isCompressed:t=!0}){this.constructor===s&&(0,r.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}fetch(e){return Et(this,arguments,(function*({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":""),n=this.isCompressed?r.CMapCompressionType.BINARY:r.CMapCompressionType.NONE;return this._fetchData(t,n).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}))}_fetchData(e,t){(0,r.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=s;class o{constructor({baseUrl:e=null}){this.constructor===o&&(0,r.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}fetch(e){return Et(this,arguments,(function*({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetchData(t).catch((e=>{throw new Error(`Unable to load font data at: ${t}`)}))}))}_fetchData(e){(0,r.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=o;class l{constructor(){this.constructor===l&&(0,r.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,r.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=l},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var r=n(1);let i=3285377520,a=4294901760,s=65535;t.MurmurHash3_64=class{constructor(e){this.h1=e?4294967295&e:i,this.h2=e?4294967295&e:i}update(e){let t,n;if("string"==typeof e){t=new Uint8Array(2*e.length),n=0;for(let r=0,i=e.length;r<i;r++){let i=e.charCodeAt(r);i<=255?t[n++]=i:(t[n++]=i>>>8,t[n++]=255&i)}}else{if(!(0,r.isArrayBuffer)(e))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");t=e.slice(),n=t.byteLength}let i=n>>2,o=n-4*i,l=new Uint32Array(t.buffer,0,i),h=0,u=0,c=this.h1,d=this.h2,p=3432918353,f=461845907,m=p&s,g=f&s;for(let e=0;e<i;e++)1&e?(h=l[e],h=h*p&a|h*m&s,h=h<<15|h>>>17,h=h*f&a|h*g&s,c^=h,c=c<<13|c>>>19,c=5*c+3864292196):(u=l[e],u=u*p&a|u*m&s,u=u<<15|u>>>17,u=u*f&a|u*g&s,d^=u,d=d<<13|d>>>19,d=5*d+3864292196);switch(h=0,o){case 3:h^=t[4*i+2]<<16;case 2:h^=t[4*i+1]<<8;case 1:h^=t[4*i],h=h*p&a|h*m&s,h=h<<15|h>>>17,h=h*f&a|h*g&s,1&i?c^=h:d^=h}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&a|36045*e&s,t=4283543511*t&a|(2950163797*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,e=444984403*e&a|60499*e&s,t=3301882366*t&a|(3120437893*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}},(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var i=n(1),a=n(10);r=new WeakMap,t.FontLoader=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){Ye(this,r,new Set),this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),re(this,r).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(e){return Et(this,null,(function*(){if(e&&!re(this,r).has(e.loadedName)){if((0,i.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:t,src:n,style:a}=e,s=new FontFace(t,n,a);this.addNativeFontFace(s);try{yield s.load(),re(this,r).add(t)}catch(t){(0,i.warn)(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}return}(0,i.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}))}bind(e){return Et(this,null,(function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void(yield this.loadSystemFont(e.systemFontInfo));if(this.isFontLoadingAPISupported){let t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{yield t.loaded}catch(n){throw(0,i.warn)(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise((t=>{let n=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,n)}))}}))}get isFontLoadingAPISupported(){var e;let t=!(null==(e=this._document)||!e.fonts);return(0,i.shadow)(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let e=!1;return(a.isNodeJS||"undefined"!=typeof navigator&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){let{loadingRequests:t}=this,n={done:!1,complete:function(){for((0,i.assert)(!n.done,"completeRequest() cannot be called twice."),n.done=!0;t.length>0&&t[0].done;){let e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(n),n}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,i.shadow)(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function r(e,t,n,r){return e.substring(0,t)+r+e.substring(t+n)}let a,s,o=this._document.createElement("canvas");o.width=1,o.height=1;let l=o.getContext("2d"),h=0,u=`lt${Date.now()}${this.loadTestFontId++}`,c=this._loadTestFont;c=r(c,976,u.length,u);let d=1482184792,p=n(c,16);for(a=0,s=u.length-3;a<s;a+=4)p=p-d+n(u,a)|0;a<u.length&&(p=p-d+n(u+"XXX",a)|0),c=r(c,16,4,(0,i.string32)(p));let f=`@font-face {font-family:"${u}";src:url(data:font/opentype;base64,${btoa(c)});}`;this.insertRule(f);let m=this._document.createElement("div");m.style.visibility="hidden",m.style.width=m.style.height="10px",m.style.position="absolute",m.style.top=m.style.left="0px";for(let t of[e.loadedName,u]){let e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=t,m.append(e)}this._document.body.append(m),function e(t,n){if(++h>30)return(0,i.warn)("Load test font never loaded."),void n();l.font="30px "+t,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?n():setTimeout(e.bind(null,t,n))}(u,(()=>{m.remove(),t.complete()}))}},t.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:n=!1,ignoreErrors:r=!1,inspectFont:i=null}){this.compiledGlyphs=Object.create(null);for(let t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===n,this.ignoreErrors=!0===r,this._inspectFont=i}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){let e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return null==(e=this._inspectFont)||e.call(this,this),t}createFontFaceRule(){var e;if(!this.data||this.disableFontFace)return null;let t,n=(0,i.bytesToString)(this.data),r=`url(data:${this.mimetype};base64,${btoa(n)});`;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${r}}`}else t=`@font-face {font-family:"${this.loadedName}";src:${r}}`;return null==(e=this._inspectFont)||e.call(this,this,r),t}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return(0,i.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){let e=[];for(let t of n){let n=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",n,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(let r of n)"scale"===r.cmd&&(r.args=[t,-t]),e[r.cmd].apply(e,r.args)}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;let n=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=n},(e,t,n)=>{var r,i,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var o=n(1),l=n(6),h=n(12),u=n(13),c=n(10);let d=4096,p=16;class f{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return void 0!==this.cache[e]?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function m(e,t,n,r,i,a,s,o,h,u){let[c,d,p,f,m,g]=(0,l.getCurrentTransform)(e);if(0===d&&0===p){let l=s*c+m,v=Math.round(l),y=o*f+g,x=Math.round(y),b=(s+h)*c+m,_=Math.abs(Math.round(b)-v)||1,w=(o+u)*f+g,S=Math.abs(Math.round(w)-x)||1;return e.setTransform(Math.sign(c),0,0,Math.sign(f),v,x),e.drawImage(t,n,r,i,a,0,0,_,S),e.setTransform(c,d,p,f,m,g),[_,S]}if(0===c&&0===f){let l=o*p+m,v=Math.round(l),y=s*d+g,x=Math.round(y),b=(o+u)*p+m,_=Math.abs(Math.round(b)-v)||1,w=(s+h)*d+g,S=Math.abs(Math.round(w)-x)||1;return e.setTransform(0,Math.sign(d),Math.sign(p),0,v,x),e.drawImage(t,n,r,i,a,0,0,S,_),e.setTransform(c,d,p,f,m,g),[S,_]}return e.drawImage(t,n,r,i,a,s,o,h,u),[Math.hypot(c,d)*h,Math.hypot(p,f)*u]}class g{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=o.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=o.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=o.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=o.Util.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){let n=o.Util.applyTransform(t,e),r=o.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,n[0],r[0]),this.minY=Math.min(this.minY,n[1],r[1]),this.maxX=Math.max(this.maxX,n[0],r[0]),this.maxY=Math.max(this.maxY,n[1],r[1])}updateScalingPathMinMax(e,t){o.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,r,i,a,s,l,h,u){let c=o.Util.bezierBoundingBox(t,n,r,i,a,s,l,h);if(u)return u[0]=Math.min(u[0],c[0],c[2]),u[1]=Math.max(u[1],c[0],c[2]),u[2]=Math.min(u[2],c[1],c[3]),void(u[3]=Math.max(u[3],c[1],c[3]));this.updateRectMinMax(e,c)}getPathBoundingBox(e=h.PathType.FILL,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===h.PathType.STROKE){t||(0,o.unreachable)("Stroke bounding box must include transform.");let e=o.Util.singularValueDecompose2dScale(t),r=e[0]*this.lineWidth/2,i=e[1]*this.lineWidth/2;n[0]-=r,n[1]-=i,n[2]+=r,n[3]+=i}return n}updateClipFromPath(){let e=o.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=h.PathType.FILL,t=null){return o.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function v(e,t){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);let n,r,i,a,s,l=t.height,h=t.width,u=l%p,c=(l-u)/p,d=0===u?c:c+1,f=e.createImageData(h,p),m=0,g=t.data,v=f.data;if(t.kind===o.ImageKind.GRAYSCALE_1BPP){let t=g.byteLength,s=new Uint32Array(v.buffer,0,v.byteLength>>2),l=s.length,y=h+7>>3,x=4294967295,b=o.FeatureTest.isLittleEndian?4278190080:255;for(r=0;r<d;r++){for(a=r<c?p:u,n=0,i=0;i<a;i++){let e=t-m,r=0,i=e>y?h:8*e-7,a=-8&i,o=0,l=0;for(;r<a;r+=8)l=g[m++],s[n++]=128&l?x:b,s[n++]=64&l?x:b,s[n++]=32&l?x:b,s[n++]=16&l?x:b,s[n++]=8&l?x:b,s[n++]=4&l?x:b,s[n++]=2&l?x:b,s[n++]=1&l?x:b;for(;r<i;r++)0===o&&(l=g[m++],o=128),s[n++]=l&o?x:b,o>>=1}for(;n<l;)s[n++]=0;e.putImageData(f,0,r*p)}}else if(t.kind===o.ImageKind.RGBA_32BPP){for(i=0,s=h*p*4,r=0;r<c;r++)v.set(g.subarray(m,m+s)),m+=s,e.putImageData(f,0,i),i+=p;r<d&&(s=h*u*4,v.set(g.subarray(m,m+s)),e.putImageData(f,0,i))}else{if(t.kind!==o.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);for(a=p,s=h*a,r=0;r<d;r++){for(r>=c&&(a=u,s=h*a),n=0,i=s;i--;)v[n++]=g[m++],v[n++]=g[m++],v[n++]=g[m++],v[n++]=255;e.putImageData(f,0,r*p)}}}function y(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);let n=t.height,r=t.width,i=n%p,a=(n-i)/p,s=0===i?a:a+1,o=e.createImageData(r,p),l=0,h=t.data,c=o.data;for(let t=0;t<s;t++){let n=t<a?p:i;({srcPos:l}=(0,u.convertBlackAndWhiteToRGBA)({src:h,srcPos:l,dest:c,width:r,height:n,nonBlackColor:0})),e.putImageData(o,0,t*p)}}function x(e,t){let n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let r of n)void 0!==e[r]&&(t[r]=e[r]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function b(e){e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0),c.isNodeJS||(e.filter="none")}function _(e,t,n,r){let i=e.length;for(let a=3;a<i;a+=4){let i=e[a];if(0===i)e[a-3]=t,e[a-2]=n,e[a-1]=r;else if(i<255){let s=255-i;e[a-3]=e[a-3]*i+t*s>>8,e[a-2]=e[a-2]*i+n*s>>8,e[a-1]=e[a-1]*i+r*s>>8}}}function w(e,t,n){let r=e.length;for(let i=3;i<r;i+=4){let r=n?n[e[i]]:e[i];t[i]=t[i]*r*.00392156862745098|0}}function S(e,t,n){let r=e.length;for(let i=3;i<r;i+=4){let r=77*e[i-3]+152*e[i-2]+28*e[i-1];t[i]=n?t[i]*n[r>>8]>>8:t[i]*r>>16}}function M(e,t,n,r){let i=r[0],a=r[1],s=r[2]-i,o=r[3]-a;0===s||0===o||(function(e,t,n,r,i,a,s,o,l,h,u){let c,d=!!a,p=d?a[0]:0,f=d?a[1]:0,m=d?a[2]:0;c="Luminosity"===i?S:w;let g=Math.min(r,Math.ceil(1048576/n));for(let i=0;i<r;i+=g){let a=Math.min(g,r-i),v=e.getImageData(o-h,i+(l-u),n,a),y=t.getImageData(o,i+l,n,a);d&&_(v.data,p,f,m),c(v.data,y.data,s),t.putImageData(y,o,i+l)}}(t.context,n,s,o,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}function T(e,t){let n=o.Util.singularValueDecompose2dScale(e);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);let r=Math.fround((globalThis.devicePixelRatio||1)*l.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:n[0]<=r||n[1]<=r}let E=["butt","round","square"],A=["miter","round","bevel"],C={},P={},I=class{constructor(e,t,n,i,s,{optionalContentConfig:o,markedContentStack:l=null},h,u){Ye(this,r),Ye(this,a),this.ctx=e,this.current=new g(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new f(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){let i=this.ctx.canvas.width,a=this.ctx.canvas.height,s=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=s,n){let e=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...(0,l.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),b(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=(0,l.getCurrentTransform)(this.ctx)}executeOperatorList(e,t,n,r){let i=e.argsArray,a=e.fnArray,s=t||0,l=i.length;if(l===s)return s;let h,u=l-s>10&&"function"==typeof n,c=u?Date.now()+15:0,d=0,p=this.commonObjs,f=this.objs;for(;;){if(void 0!==r&&s===r.nextBreakPoint)return r.breakIt(s,n),s;if(h=a[s],h!==o.OPS.dependency)this[h].apply(this,i[s]);else for(let e of i[s]){let t=e.startsWith("g_")?p:f;if(!t.has(e))return t.get(e,n),s}if(s++,s===l)return s;if(u&&++d>10){if(Date.now()>c)return n(),s;d=0}}}endDrawing(){at(this,r,i).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),at(this,a,s).call(this)}_scaleImage(e,t){let n,r,i=e.width,a=e.height,s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=i,h=a,u="prescale1";for(;s>2&&l>1||o>2&&h>1;){let t=l,i=h;s>2&&l>1&&(t=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),s/=l/t),o>2&&h>1&&(i=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,o/=h/i),n=this.cachedCanvases.getCanvas(u,t,i),r=n.context,r.clearRect(0,0,t,i),r.drawImage(e,0,0,l,h,0,0,t,i),e=n.canvas,l=t,h=i,u="prescale1"===u?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:h}}_createMaskCanvas(e){let t,n,r,i,a=this.ctx,{width:s,height:u}=e,c=this.current.fillColor,d=this.current.patternFill,p=(0,l.getCurrentTransform)(a);if((e.bitmap||e.data)&&e.count>1){let i=e.bitmap||e.data.buffer;n=JSON.stringify(d?p:[p.slice(0,4),c]),t=this._cachedBitmapsMap.get(i),t||(t=new Map,this._cachedBitmapsMap.set(i,t));let a=t.get(n);if(a&&!d)return{canvas:a,offsetX:Math.round(Math.min(p[0],p[2])+p[4]),offsetY:Math.round(Math.min(p[1],p[3])+p[5])};r=a}r||(i=this.cachedCanvases.getCanvas("maskCanvas",s,u),y(i.context,e));let f=o.Util.transform(p,[1/s,0,0,-1/u,0,0]);f=o.Util.transform(f,[1,0,0,1,0,-u]);let g=o.Util.applyTransform([0,0],f),v=o.Util.applyTransform([s,u],f),x=o.Util.normalizeRect([g[0],g[1],v[0],v[1]]),b=Math.round(x[2]-x[0])||1,_=Math.round(x[3]-x[1])||1,w=this.cachedCanvases.getCanvas("fillCanvas",b,_),S=w.context,M=Math.min(g[0],v[0]),E=Math.min(g[1],v[1]);S.translate(-M,-E),S.transform(...f),r||(r=this._scaleImage(i.canvas,(0,l.getCurrentTransformInverse)(S)),r=r.img,t&&d&&t.set(n,r)),S.imageSmoothingEnabled=T((0,l.getCurrentTransform)(S),e.interpolate),m(S,r,0,0,r.width,r.height,0,0,s,u),S.globalCompositeOperation="source-in";let A=o.Util.transform((0,l.getCurrentTransformInverse)(S),[1,0,0,1,-M,-E]);return S.fillStyle=d?c.getPattern(a,this,A,h.PathType.FILL):c,S.fillRect(0,0,s,u),t&&!d&&(this.cachedCanvases.delete("fillCanvas"),t.set(n,w.canvas)),{canvas:w.canvas,offsetX:Math.round(M),offsetY:Math.round(E)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=E[e]}setLineJoin(e){this.ctx.lineJoin=A[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;let i=this.ctx;i.setTransform(...(0,l.getCurrentTransform)(this.suspendedCtx)),x(this.suspendedCtx,i),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,r,i,a,s){t.transform(e,n,r,i,a,s),this.__originalTransform(e,n,r,i,a,s)},e.setTransform=function(e,n,r,i,a,s){t.setTransform(e,n,r,i,a,s),this.__originalSetTransform(e,n,r,i,a,s)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,r,i,a,s){t.bezierCurveTo(e,n,r,i,a,s),this.__originalBezierCurveTo(e,n,r,i,a,s)},e.rect=function(e,n,r,i){t.rect(e,n,r,i),this.__originalRect(e,n,r,i)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),x(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask;M(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(x(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),x(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,r,i,a){this.ctx.transform(e,t,n,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){let r,i,a=this.ctx,s=this.current,h=s.x,u=s.y,c=(0,l.getCurrentTransform)(a),d=0===c[0]&&0===c[3]||0===c[1]&&0===c[2],p=d?n.slice(0):null;for(let n=0,l=0,f=e.length;n<f;n++)switch(0|e[n]){case o.OPS.rectangle:h=t[l++],u=t[l++];let e=t[l++],n=t[l++],f=h+e,m=u+n;a.moveTo(h,u),0===e||0===n?a.lineTo(f,m):(a.lineTo(f,u),a.lineTo(f,m),a.lineTo(h,m)),d||s.updateRectMinMax(c,[h,u,f,m]),a.closePath();break;case o.OPS.moveTo:h=t[l++],u=t[l++],a.moveTo(h,u),d||s.updatePathMinMax(c,h,u);break;case o.OPS.lineTo:h=t[l++],u=t[l++],a.lineTo(h,u),d||s.updatePathMinMax(c,h,u);break;case o.OPS.curveTo:r=h,i=u,h=t[l+4],u=t[l+5],a.bezierCurveTo(t[l],t[l+1],t[l+2],t[l+3],h,u),s.updateCurvePathMinMax(c,r,i,t[l],t[l+1],t[l+2],t[l+3],h,u,p),l+=6;break;case o.OPS.curveTo2:r=h,i=u,a.bezierCurveTo(h,u,t[l],t[l+1],t[l+2],t[l+3]),s.updateCurvePathMinMax(c,r,i,h,u,t[l],t[l+1],t[l+2],t[l+3],p),h=t[l+2],u=t[l+3],l+=4;break;case o.OPS.curveTo3:r=h,i=u,h=t[l+2],u=t[l+3],a.bezierCurveTo(t[l],t[l+1],h,u,h,u),s.updateCurvePathMinMax(c,r,i,t[l],t[l+1],h,u,h,u,p),l+=4;break;case o.OPS.closePath:a.closePath()}d&&s.updateScalingPathMinMax(c,p),s.setCurrentPoint(h,u)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof n&&null!=n&&n.getPattern?(t.save(),t.strokeStyle=n.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,n=this.current.fillColor,r=!1;this.current.patternFill&&(t.save(),t.fillStyle=n.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.FILL),r=!0);let i=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==i&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),r&&t.restore(),e&&this.consumePath(i)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=C}eoClip(){this.pendingClip=P}beginText(){this.current.textMatrix=o.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(let n of e)t.setTransform(...n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var n;let r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix||o.FONT_IDENTITY_MATRIX,(0===i.fontMatrix[0]||0===i.fontMatrix[3])&&(0,o.warn)("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;let a=r.loadedName||"sans-serif",s=(null==(n=r.systemFontInfo)?void 0:n.css)||`"${a}", ${r.fallbackName}`,l="normal";r.black?l="900":r.bold&&(l="bold");let h=r.italic?"italic":"normal",u=t;t<16?u=16:t>100&&(u=100),this.current.fontSizeScale=t/u,this.ctx.font=`${h} ${l} ${u}px ${s}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,r,i,a){this.current.textMatrix=[e,t,n,r,i,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,r){let i,a=this.ctx,s=this.current,h=s.font,u=s.textRenderingMode,c=s.fontSize/s.fontSizeScale,d=u&o.TextRenderingMode.FILL_STROKE_MASK,p=!!(u&o.TextRenderingMode.ADD_TO_PATH_FLAG),f=s.patternFill&&!h.missingFile;(h.disableFontFace||p||f)&&(i=h.getPathGenerator(this.commonObjs,e)),h.disableFontFace||f?(a.save(),a.translate(t,n),a.beginPath(),i(a,c),r&&a.setTransform(...r),(d===o.TextRenderingMode.FILL||d===o.TextRenderingMode.FILL_STROKE)&&a.fill(),(d===o.TextRenderingMode.STROKE||d===o.TextRenderingMode.FILL_STROKE)&&a.stroke(),a.restore()):((d===o.TextRenderingMode.FILL||d===o.TextRenderingMode.FILL_STROKE)&&a.fillText(e,t,n),(d===o.TextRenderingMode.STROKE||d===o.TextRenderingMode.FILL_STROKE)&&a.strokeText(e,t,n)),p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,l.getCurrentTransform)(a),x:t,y:n,fontSize:c,addToPath:i})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){n=!0;break}return(0,o.shadow)(this,"isFontSubpixelAAEnabled",n)}showText(e){let t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);let r=t.fontSize;if(0===r)return;let i,a=this.ctx,s=t.fontSizeScale,u=t.charSpacing,c=t.wordSpacing,d=t.fontDirection,p=t.textHScale*d,f=e.length,m=n.vertical,g=m?1:-1,v=n.defaultVMetrics,y=r*t.fontMatrix[0],x=t.textRenderingMode===o.TextRenderingMode.FILL&&!n.disableFontFace&&!t.patternFill;if(a.save(),a.transform(...t.textMatrix),a.translate(t.x,t.y+t.textRise),d>0?a.scale(p,-1):a.scale(p,1),t.patternFill){a.save();let e=t.fillColor.getPattern(a,this,(0,l.getCurrentTransformInverse)(a),h.PathType.FILL);i=(0,l.getCurrentTransform)(a),a.restore(),a.fillStyle=e}let b=t.lineWidth,_=t.textMatrixScale;if(0===_||0===b){let e=t.textRenderingMode&o.TextRenderingMode.FILL_STROKE_MASK;(e===o.TextRenderingMode.STROKE||e===o.TextRenderingMode.FILL_STROKE)&&(b=this.getSinglePixelWidth())}else b/=_;if(1!==s&&(a.scale(s,s),b/=s),a.lineWidth=b,n.isInvalidPDFjsFont){let n=[],r=0;for(let t of e)n.push(t.unicode),r+=t.width;return a.fillText(n.join(""),0,0),t.x+=r*y*p,a.restore(),void this.compose()}let w,S=0;for(w=0;w<f;++w){let t=e[w];if("number"==typeof t){S+=g*t*r/1e3;continue}let o,l,h,p=!1,f=(t.isSpace?c:0)+u,b=t.fontChar,_=t.accent,M=t.width;if(m){let e=t.vmetric||v,n=-(t.vmetric?e[1]:.5*M)*y,r=e[2]*y;M=e?-e[0]:M,o=n/s,l=(S+r)/s}else o=S/s,l=0;if(n.remeasure&&M>0){let e=1e3*a.measureText(b).width/r*s;if(M<e&&this.isFontSubpixelAAEnabled){let t=M/e;p=!0,a.save(),a.scale(t,1),o/=t}else M!==e&&(o+=(M-e)/2e3*r/s)}if(this.contentVisible&&(t.isInFont||n.missingFile))if(x&&!_)a.fillText(b,o,l);else if(this.paintChar(b,o,l,i),_){let e=o+r*_.offset.x/s,t=l-r*_.offset.y/s;this.paintChar(_.fontChar,e,t,i)}h=m?M*y-f*d:M*y+f*d,S+=h,p&&a.restore()}m?t.y-=S:t.x+=S*p,a.restore(),this.compose()}showType3Text(e){let t,n,r,i,a=this.ctx,s=this.current,l=s.font,h=s.fontSize,u=s.fontDirection,c=l.vertical?1:-1,d=s.charSpacing,p=s.wordSpacing,f=s.textHScale*u,m=s.fontMatrix||o.FONT_IDENTITY_MATRIX,g=e.length;if(s.textRenderingMode!==o.TextRenderingMode.INVISIBLE&&0!==h){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,a.save(),a.transform(...s.textMatrix),a.translate(s.x,s.y),a.scale(f,u),t=0;t<g;++t){if(n=e[t],"number"==typeof n){i=c*n*h/1e3,this.ctx.translate(i,0),s.x+=i*f;continue}let u=(n.isSpace?p:0)+d,g=l.charProcOperatorList[n.operatorListId];g?(this.contentVisible&&(this.processingType3=n,this.save(),a.scale(h,h),a.transform(...m),this.executeOperatorList(g),this.restore()),r=o.Util.applyTransform([n.width,0],m)[0]*h+u,a.translate(r,0),s.x+=r*f):(0,o.warn)(`Type3 character "${n.operatorListId}" is not available.`)}a.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,a){this.ctx.rect(n,r,i-n,a-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){let n=e[1],r=this.baseTransform||(0,l.getCurrentTransform)(this.ctx),i={createCanvasGraphics:e=>new I(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new h.TilingPattern(e,n,this.ctx,i,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){let r=o.Util.makeHexColor(e,t,n);this.ctx.strokeStyle=r,this.current.strokeColor=r}setFillRGBColor(e,t,n){let r=o.Util.makeHexColor(e,t,n);this.ctx.fillStyle=r,this.current.fillColor=r,this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=(0,h.getShadingPattern)(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.SHADING);let r=(0,l.getCurrentTransformInverse)(t);if(r){let{width:e,height:n}=t.canvas,[i,a,s,l]=o.Util.getAxialAlignedBoundingBox([0,0,e,n],r);this.ctx.fillRect(i,a,s-i,l-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,o.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,o.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform(...e),this.baseTransform=(0,l.getCurrentTransform)(this.ctx),t)){let e=t[2]-t[0],n=t[3]-t[1];this.ctx.rect(t[0],t[1],e,n),this.current.updateRectMinMax((0,l.getCurrentTransform)(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||(0,o.info)("TODO: Support non-isolated groups."),e.knockout&&(0,o.warn)("Knockout groups not supported.");let n=(0,l.getCurrentTransform)(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=o.Util.getAxialAlignedBoundingBox(e.bbox,(0,l.getCurrentTransform)(t)),i=[0,0,t.canvas.width,t.canvas.height];r=o.Util.intersect(r,i)||[0,0,0,0];let a=Math.floor(r[0]),s=Math.floor(r[1]),h=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-s,1),c=1,p=1;h>d&&(c=h/d,h=d),u>d&&(p=u/d,u=d),this.current.startNewPathAndClipBox([0,0,h,u]);let f="groupAt"+this.groupLevel;e.smask&&(f+="_smask_"+this.smaskCounter++%2);let m=this.cachedCanvases.getCanvas(f,h,u),g=m.context;g.scale(1/c,1/p),g.translate(-a,-s),g.transform(...n),e.smask?this.smaskStack.push({canvas:m.canvas,context:g,offsetX:a,offsetY:s,scaleX:c,scaleY:p,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,s),t.scale(c,p),t.save()),x(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let e=(0,l.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);let n=o.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,n,a,s){if(at(this,r,i).call(this),b(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(t)&&4===t.length){let r=t[2]-t[0],i=t[3]-t[1];if(s&&this.annotationCanvasMap){(n=n.slice())[4]-=t[0],n[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=r,t[3]=i;let[a,s]=o.Util.singularValueDecompose2dScale((0,l.getCurrentTransform)(this.ctx)),{viewportScale:h}=this,u=Math.ceil(r*this.outputScaleX*h),c=Math.ceil(i*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(u,c);let{canvas:d,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,d),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(a,0,0,-s,0,i*s),b(this.ctx)}else b(this.ctx),this.ctx.rect(t[0],t[1],r,i),this.ctx.clip(),this.endPath()}this.current=new g(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...a)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),at(this,a,s).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;(e=this.getObject(e.data,e)).count=t;let n=this.ctx,r=this.processingType3;if(r&&(void 0===r.compiled&&(r.compiled=function(e){let{width:t,height:n}=e;if(t>1e3||n>1e3)return null;let r,i,a,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=t+1,l=new Uint8Array(o*(n+1)),h=t+7&-8,u=new Uint8Array(h*n),c=0;for(let t of e.data){let e=128;for(;e>0;)u[c++]=t&e?0:255,e>>=1}let d=0;for(c=0,0!==u[c]&&(l[0]=1,++d),i=1;i<t;i++)u[c]!==u[c+1]&&(l[i]=u[c]?2:1,++d),c++;for(0!==u[c]&&(l[i]=2,++d),r=1;r<n;r++){c=r*h,a=r*o,u[c-h]!==u[c]&&(l[a]=u[c]?1:8,++d);let e=(u[c]?4:0)+(u[c-h]?8:0);for(i=1;i<t;i++)e=(e>>2)+(u[c+1]?4:0)+(u[c-h+1]?8:0),s[e]&&(l[a+i]=s[e],++d),c++;if(u[c-h]!==u[c]&&(l[a+i]=u[c]?2:4,++d),d>1e3)return null}for(c=h*(n-1),a=r*o,0!==u[c]&&(l[a]=8,++d),i=1;i<t;i++)u[c]!==u[c+1]&&(l[a+i]=u[c]?4:8,++d),c++;if(0!==u[c]&&(l[a+i]=4,++d),d>1e3)return null;let p=new Int32Array([0,o,-1,0,-o,0,0,0,1]),f=new Path2D;for(r=0;d&&r<=n;r++){let e=r*o,n=e+t;for(;e<n&&!l[e];)e++;if(e===n)continue;f.moveTo(e%o,r);let i=e,a=l[e];do{let t=p[a];do{e+=t}while(!l[e]);let n=l[e];5!==n&&10!==n?(a=n,l[e]=0):(a=n&51*a>>4,l[e]&=a>>2|a<<2),f.lineTo(e%o,e/o|0),l[e]||--d}while(i!==e);--r}return u=null,l=null,function(e){e.save(),e.scale(1/t,-1/n),e.translate(0,-n),e.fill(f),e.beginPath(),e.restore()}}(e)),r.compiled))return void r.compiled(n);let i=this._createMaskCanvas(e),a=i.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(a,i.offsetX,i.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);let s=this.ctx;s.save();let h=(0,l.getCurrentTransform)(s);s.transform(t,n,r,i,0,0);let u=this._createMaskCanvas(e);s.setTransform(1,0,0,1,u.offsetX-h[4],u.offsetY-h[5]);for(let e=0,l=a.length;e<l;e+=2){let l=o.Util.transform(h,[t,n,r,i,a[e],a[e+1]]),[c,d]=o.Util.applyTransform([0,0],l);s.drawImage(u.canvas,c,d)}s.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,n=this.current.fillColor,r=this.current.patternFill;for(let i of e){let{data:e,width:a,height:s,transform:o}=i,u=this.cachedCanvases.getCanvas("maskCanvas",a,s),c=u.context;c.save(),y(c,this.getObject(e,i)),c.globalCompositeOperation="source-in",c.fillStyle=r?n.getPattern(c,this,(0,l.getCurrentTransformInverse)(t),h.PathType.FILL):n,c.fillRect(0,0,a,s),c.restore(),t.save(),t.transform(...o),t.scale(1,-1),m(t,u.canvas,0,0,a,s,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,o.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,n,r){if(!this.contentVisible)return;let i=this.getObject(e);if(!i)return void(0,o.warn)("Dependent image isn't ready yet");let a=i.width,s=i.height,l=[];for(let e=0,i=r.length;e<i;e+=2)l.push({transform:[t,0,0,n,r[e],r[e+1]],x:0,y:0,w:a,h:s});this.paintInlineImageXObjectGroup(i,l)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;let{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",n,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t,n=e.width,r=e.height,i=this.ctx;if(this.save(),c.isNodeJS||(i.filter="none"),i.scale(1/n,-1/r),e.bitmap)t=this.applyTransferMapsToBitmap(e);else if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)t=e;else{let i=this.cachedCanvases.getCanvas("inlineImage",n,r).context;v(i,e),t=this.applyTransferMapsToCanvas(i)}let a=this._scaleImage(t,(0,l.getCurrentTransformInverse)(i));i.imageSmoothingEnabled=T((0,l.getCurrentTransform)(i),e.interpolate),m(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-r,n,r),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let n,r=this.ctx;if(e.bitmap)n=e.bitmap;else{let t=e.width,r=e.height,i=this.cachedCanvases.getCanvas("inlineImage",t,r).context;v(i,e),n=this.applyTransferMapsToCanvas(i)}for(let e of t)r.save(),r.transform(...e.transform),r.scale(1,-1),m(r,n,e.x,e.y,e.w,e.h,0,-1,1,1),r.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let n=this.ctx;this.pendingClip&&(t||(this.pendingClip===P?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=(0,l.getCurrentTransform)(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let e,t,{lineWidth:n}=this.current,{a:r,b:i,c:a,d:s}=this.ctx.getTransform();if(0===i&&0===a){let i=Math.abs(r),a=Math.abs(s);if(i===a)if(0===n)e=t=1/i;else{let r=i*n;e=t=r<1?1/r:1}else if(0===n)e=1/i,t=1/a;else{let r=i*n,s=a*n;e=r<1?1/r:1,t=s<1?1/s:1}}else{let o=Math.abs(r*s-i*a),l=Math.hypot(r,i),h=Math.hypot(a,s);if(0===n)e=h/o,t=l/o;else{let r=n*o;e=h>r?h/r:1,t=l>r?l/r:1}}this._cachedScaleForStroking[0]=e,this._cachedScaleForStroking[1]=t}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:n}=this.current,[r,i]=this.getScaleForStroking();if(t.lineWidth=n||1,1===r&&1===i)return void t.stroke();let a=t.getLineDash();if(e&&t.save(),t.scale(r,i),a.length>0){let e=Math.max(r,i);t.setLineDash(a.map((t=>t/e))),t.lineDashOffset/=e}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},R=I;r=new WeakSet,i=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},a=new WeakSet,s=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},t.CanvasGraphics=R;for(let e in o.OPS)void 0!==R.prototype[e]&&(R.prototype[o.OPS[e]]=R.prototype[e])},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=function(e){switch(e[0]){case"RadialAxial":return new l(e);case"Mesh":return new c(e);case"Dummy":return new d}throw new Error(`Unknown IR type: ${e[0]}`)};var r=n(1),i=n(6);let a={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function s(e,t){if(!t)return;let n=t[2]-t[0],r=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],n,r),e.clip(i)}t.PathType=a;class o{constructor(){this.constructor===o&&(0,r.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,r.unreachable)("Abstract method `getPattern` called.")}}class l extends o{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,n,o){let l;if(o===a.STROKE||o===a.FILL){let a=t.current.getClippedPathBoundingBox(o,(0,i.getCurrentTransform)(e))||[0,0,0,0],h=Math.ceil(a[2]-a[0])||1,u=Math.ceil(a[3]-a[1])||1,c=t.cachedCanvases.getCanvas("pattern",h,u,!0),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),n=r.Util.transform(n,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),s(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),l=e.createPattern(c.canvas,"no-repeat");let p=new DOMMatrix(n);l.setTransform(p)}else s(e,this._bbox),l=this._createGradient(e);return l}}function h(e,t,n,r,i,a,s,o){let l,h=t.coords,u=t.colors,c=e.data,d=4*e.width;h[n+1]>h[r+1]&&(l=n,n=r,r=l,l=a,a=s,s=l),h[r+1]>h[i+1]&&(l=r,r=i,i=l,l=s,s=o,o=l),h[n+1]>h[r+1]&&(l=n,n=r,r=l,l=a,a=s,s=l);let p=(h[n]+t.offsetX)*t.scaleX,f=(h[n+1]+t.offsetY)*t.scaleY,m=(h[r]+t.offsetX)*t.scaleX,g=(h[r+1]+t.offsetY)*t.scaleY,v=(h[i]+t.offsetX)*t.scaleX,y=(h[i+1]+t.offsetY)*t.scaleY;if(f>=y)return;let x,b,_,w,S,M,T,E,A=u[a],C=u[a+1],P=u[a+2],I=u[s],R=u[s+1],L=u[s+2],O=u[o],D=u[o+1],k=u[o+2],N=Math.round(f),F=Math.round(y);for(let e=N;e<=F;e++){if(e<g){let t;t=e<f?0:(f-e)/(f-g),x=p-(p-m)*t,b=A-(A-I)*t,_=C-(C-R)*t,w=P-(P-L)*t}else{let t;t=e>y?1:g===y?0:(g-e)/(g-y),x=m-(m-v)*t,b=I-(I-O)*t,_=R-(R-D)*t,w=L-(L-k)*t}let t;t=e<f?0:e>y?1:(f-e)/(f-y),S=p-(p-v)*t,M=A-(A-O)*t,T=C-(C-D)*t,E=P-(P-k)*t;let n=Math.round(Math.min(x,S)),r=Math.round(Math.max(x,S)),i=d*e+4*n;for(let e=n;e<=r;e++)t=(x-e)/(x-S),t<0?t=0:t>1&&(t=1),c[i++]=b-(b-M)*t|0,c[i++]=_-(_-T)*t|0,c[i++]=w-(w-E)*t|0,c[i++]=255}}function u(e,t,n){let r,i,a=t.coords,s=t.colors;switch(t.type){case"lattice":let o=t.verticesPerRow,l=Math.floor(a.length/o)-1,u=o-1;for(r=0;r<l;r++){let t=r*o;for(let r=0;r<u;r++,t++)h(e,n,a[t],a[t+1],a[t+o],s[t],s[t+1],s[t+o]),h(e,n,a[t+o+1],a[t+1],a[t+o],s[t+o+1],s[t+1],s[t+o])}break;case"triangles":for(r=0,i=a.length;r<i;r+=3)h(e,n,a[r],a[r+1],a[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class c extends o{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){let r=Math.floor(this._bounds[0]),i=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-r,s=Math.ceil(this._bounds[3])-i,o=Math.min(Math.ceil(Math.abs(a*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*e[1]*1.1)),3e3),h=a/o,c=s/l,d={coords:this._coords,colors:this._colors,offsetX:-r,offsetY:-i,scaleX:1/h,scaleY:1/c},p=o+4,f=l+4,m=n.getCanvas("mesh",p,f,!1),g=m.context,v=g.createImageData(o,l);if(t){let e=v.data;for(let n=0,r=e.length;n<r;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(let e of this._figures)u(v,e,d);return g.putImageData(v,2,2),{canvas:m.canvas,offsetX:r-2*h,offsetY:i-2*c,scaleX:h,scaleY:c}}getPattern(e,t,n,o){let l;if(s(e,this._bbox),o===a.SHADING)l=r.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(e));else if(l=r.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){let e=r.Util.singularValueDecompose2dScale(this.matrix);l=[l[0]*e[0],l[1]*e[1]]}let h=this._createMeshCanvas(l,o===a.SHADING?null:this._background,t.cachedCanvases);return o!==a.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(h.offsetX,h.offsetY),e.scale(h.scaleX,h.scaleY),e.createPattern(h.canvas,"no-repeat")}}class d extends o{getPattern(){return"hotpink"}}let p=1,f=2,m=class{constructor(e,t,n,r,i){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e){let t=this.operatorList,n=this.bbox,a=this.xstep,s=this.ystep,o=this.paintType,l=this.tilingType,h=this.color,u=this.canvasGraphicsFactory;(0,r.info)("TilingType: "+l);let c=n[0],d=n[1],p=n[2],f=n[3],m=r.Util.singularValueDecompose2dScale(this.matrix),g=r.Util.singularValueDecompose2dScale(this.baseTransform),v=[m[0]*g[0],m[1]*g[1]],y=this.getSizeAndScale(a,this.ctx.canvas.width,v[0]),x=this.getSizeAndScale(s,this.ctx.canvas.height,v[1]),b=e.cachedCanvases.getCanvas("pattern",y.size,x.size,!0),_=b.context,w=u.createCanvasGraphics(_);w.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(w,o,h);let S=c,M=d,T=p,E=f;return c<0&&(S=0,T+=Math.abs(c)),d<0&&(M=0,E+=Math.abs(d)),_.translate(-y.scale*S,-x.scale*M),w.transform(y.scale,0,0,x.scale,0,0),_.save(),this.clipBbox(w,S,M,T,E),w.baseTransform=(0,i.getCurrentTransform)(w.ctx),w.executeOperatorList(t),w.endDrawing(),{canvas:b.canvas,scaleX:y.scale,scaleY:x.scale,offsetX:S,offsetY:M}}getSizeAndScale(e,t,n){e=Math.abs(e);let r=Math.max(m.MAX_PATTERN_SIZE,t),i=Math.ceil(e*n);return i>=r?i=r:n=i/e,{scale:n,size:i}}clipBbox(e,t,n,r,a){let s=r-t,o=a-n;e.ctx.rect(t,n,s,o),e.current.updateRectMinMax((0,i.getCurrentTransform)(e.ctx),[t,n,r,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let i=e.ctx,a=e.current;switch(t){case p:let e=this.ctx;i.fillStyle=e.fillStyle,i.strokeStyle=e.strokeStyle,a.fillColor=e.fillStyle,a.strokeColor=e.strokeStyle;break;case f:let s=r.Util.makeHexColor(n[0],n[1],n[2]);i.fillStyle=s,i.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new r.FormatError(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,i){let s=n;i!==a.SHADING&&(s=r.Util.transform(s,t.baseTransform),this.matrix&&(s=r.Util.transform(s,this.matrix)));let o=this.createPatternCanvas(t),l=new DOMMatrix(s);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);let h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}},g=m;li(g,"MAX_PATTERN_SIZE",3e3),t.TilingPattern=g},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertBlackAndWhiteToRGBA=i,t.convertToRGBA=function(e){switch(e.kind){case r.ImageKind.GRAYSCALE_1BPP:return i(e);case r.ImageKind.RGB_24BPP:return function({src:e,srcPos:t=0,dest:n,destPos:i=0,width:a,height:s}){let o=0,l=e.length>>2,h=new Uint32Array(e.buffer,t,l);if(r.FeatureTest.isLittleEndian){for(;o<l-2;o+=3,i+=4){let e=h[o],t=h[o+1],r=h[o+2];n[i]=4278190080|e,n[i+1]=e>>>24|t<<8|4278190080,n[i+2]=t>>>16|r<<16|4278190080,n[i+3]=r>>>8|4278190080}for(let t=4*o,r=e.length;t<r;t+=3)n[i++]=e[t]|e[t+1]<<8|e[t+2]<<16|4278190080}else{for(;o<l-2;o+=3,i+=4){let e=h[o],t=h[o+1],r=h[o+2];n[i]=255|e,n[i+1]=e<<24|t>>>8|255,n[i+2]=t<<16|r>>>16|255,n[i+3]=r<<8|255}for(let t=4*o,r=e.length;t<r;t+=3)n[i++]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|255}return{srcPos:t,destPos:i}}(e)}return null},t.grayToRGBA=function(e,t){if(r.FeatureTest.isLittleEndian)for(let n=0,r=e.length;n<r;n++)t[n]=65793*e[n]|4278190080;else for(let n=0,r=e.length;n<r;n++)t[n]=16843008*e[n]|255};var r=n(1);function i({src:e,srcPos:t=0,dest:n,width:i,height:a,nonBlackColor:s=4294967295,inverseDecode:o=!1}){let l=r.FeatureTest.isLittleEndian?4278190080:255,[h,u]=o?[s,l]:[l,s],c=i>>3,d=7&i,p=e.length;n=new Uint32Array(n.buffer);let f=0;for(let r=0;r<a;r++){for(let r=t+c;t<r;t++){let r=t<p?e[t]:255;n[f++]=128&r?u:h,n[f++]=64&r?u:h,n[f++]=32&r?u:h,n[f++]=16&r?u:h,n[f++]=8&r?u:h,n[f++]=4&r?u:h,n[f++]=2&r?u:h,n[f++]=1&r?u:h}if(0===d)continue;let r=t<p?e[t++]:255;for(let e=0;e<d;e++)n[f++]=r&1<<7-e?u:h}return{srcPos:t,destPos:f}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;let n=Object.create(null);t.GlobalWorkerOptions=n,n.workerPort=null,n.workerSrc=""},(e,t,n)=>{var r,i,a,s,o,l;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var h=n(1);let u=1,c=2,d=1,p=2,f=3,m=4,g=5,v=6,y=7,x=8;function b(e){switch(e instanceof Error||"object"==typeof e&&null!==e||(0,h.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new h.AbortException(e.message);case"MissingPDFException":return new h.MissingPDFException(e.message);case"PasswordException":return new h.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new h.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new h.UnknownErrorException(e.message,e.details);default:return new h.UnknownErrorException(e.message,e.toString())}}r=new WeakSet,i=function(e){let t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this,s=this.actionHandler[e.action],o={enqueue(e,a=1,s){if(this.isCancelled)return;let o=this.desiredSize;this.desiredSize-=a,o>0&&this.desiredSize<=0&&(this.sinkCapability=new h.PromiseCapability,this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:m,streamId:t,chunk:e},s)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:f,streamId:t}),delete a.streamSinks[t])},error(e){(0,h.assert)(e instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:g,streamId:t,reason:b(e)}))},sinkCapability:new h.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,new Promise((function(t){t(s(e.data,o))})).then((function(){i.postMessage({sourceName:n,targetName:r,stream:x,streamId:t,success:!0})}),(function(e){i.postMessage({sourceName:n,targetName:r,stream:x,streamId:t,reason:b(e)})}))},a=new WeakSet,s=function(e){let t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],s=this.streamSinks[t];switch(e.stream){case x:e.success?a.startCall.resolve():a.startCall.reject(b(e.reason));break;case y:e.success?a.pullCall.resolve():a.pullCall.reject(b(e.reason));break;case v:if(!s){i.postMessage({sourceName:n,targetName:r,stream:y,streamId:t,success:!0});break}s.desiredSize<=0&&e.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=e.desiredSize,new Promise((function(e){var t;e(null==(t=s.onPull)?void 0:t.call(s))})).then((function(){i.postMessage({sourceName:n,targetName:r,stream:y,streamId:t,success:!0})}),(function(e){i.postMessage({sourceName:n,targetName:r,stream:y,streamId:t,reason:b(e)})}));break;case m:if((0,h.assert)(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case f:if((0,h.assert)(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),at(this,o,l).call(this,a,t);break;case g:(0,h.assert)(a,"error should have stream controller"),a.controller.error(b(e.reason)),at(this,o,l).call(this,a,t);break;case p:e.success?a.cancelCall.resolve():a.cancelCall.reject(b(e.reason)),at(this,o,l).call(this,a,t);break;case d:if(!s)break;new Promise((function(t){var n;t(null==(n=s.onCancel)?void 0:n.call(s,b(e.reason)))})).then((function(){i.postMessage({sourceName:n,targetName:r,stream:p,streamId:t,success:!0})}),(function(e){i.postMessage({sourceName:n,targetName:r,stream:p,streamId:t,reason:b(e)})})),s.sinkCapability.reject(b(e.reason)),s.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},o=new WeakSet,l=function(e,t){return Et(this,null,(function*(){var n,r,i;yield Promise.allSettled([null==(n=e.startCall)?void 0:n.promise,null==(r=e.pullCall)?void 0:r.promise,null==(i=e.cancelCall)?void 0:i.promise]),delete this.streamControllers[t]}))},t.MessageHandler=class{constructor(e,t,n){Ye(this,r),Ye(this,a),Ye(this,o),this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{let t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void at(this,a,s).call(this,t);if(t.callback){let e=t.callbackId,n=this.callbackCapabilities[e];if(!n)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===u)n.resolve(t.data);else{if(t.callback!==c)throw new Error("Unexpected callback case");n.reject(b(t.reason))}return}let o=this.actionHandler[t.action];if(!o)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let e=this.sourceName,r=t.sourceName;new Promise((function(e){e(o(t.data))})).then((function(i){n.postMessage({sourceName:e,targetName:r,callback:u,callbackId:t.callbackId,data:i})}),(function(i){n.postMessage({sourceName:e,targetName:r,callback:c,callbackId:t.callbackId,reason:b(i)})}))}else t.streamId?at(this,r,i).call(this,t):o(t.data)},n.addEventListener("message",this._onComObjOnMessage)}on(e,t){let n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let r=this.callbackId++,i=new h.PromiseCapability;this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(e){i.reject(e)}return i.promise}sendWithStream(e,t,n,r){let i=this.streamId++,a=this.sourceName,s=this.targetName,o=this.comObj;return new ReadableStream({start:n=>{let l=new h.PromiseCapability;return this.streamControllers[i]={controller:n,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:a,targetName:s,action:e,streamId:i,data:t,desiredSize:n.desiredSize},r),l.promise},pull:e=>{let t=new h.PromiseCapability;return this.streamControllers[i].pullCall=t,o.postMessage({sourceName:a,targetName:s,stream:v,streamId:i,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,h.assert)(e instanceof Error,"cancel must have a valid reason");let t=new h.PromiseCapability;return this.streamControllers[i].cancelCall=t,this.streamControllers[i].isClosed=!0,o.postMessage({sourceName:a,targetName:s,stream:d,streamId:i,reason:b(e)}),t.promise}},n)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,t,n)=>{var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var a=n(1);r=new WeakMap,i=new WeakMap,t.Metadata=class{constructor({parsedData:e,rawData:t}){Ye(this,r,void 0),Ye(this,i,void 0),xt(this,r,e),xt(this,i,t)}getRaw(){return re(this,i)}get(e){var t;return null!=(t=re(this,r).get(e))?t:null}getAll(){return(0,a.objectFromMap)(re(this,r))}has(e){return re(this,r).has(e)}}},(e,t,n)=>{var r,i,a,s,o,l,h;Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var u=n(1),c=n(8);let d=Symbol("INTERNAL");class p{constructor(e,t){Ye(this,r,!0),this.name=e,this.intent=t}get visible(){return re(this,r)}_setVisible(e,t){e!==d&&(0,u.unreachable)("Internal method `_setVisible` called."),xt(this,r,t)}}r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakSet,h=function(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let r=1;r<t;r++){let t,i=e[r];if(Array.isArray(i))t=at(this,l,h).call(this,i);else{if(!re(this,a).has(i))return(0,u.warn)(`Optional content group not found: ${i}`),!0;t=re(this,a).get(i).visible}switch(n){case"And":if(!t)return!1;break;case"Or":if(t)return!0;break;case"Not":return!t;default:return!0}}return"And"===n},t.OptionalContentConfig=class{constructor(e){if(Ye(this,l),Ye(this,i,null),Ye(this,a,new Map),Ye(this,s,null),Ye(this,o,null),this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,xt(this,o,e.order);for(let t of e.groups)re(this,a).set(t.id,new p(t.name,t.intent));if("OFF"===e.baseState)for(let e of re(this,a).values())e._setVisible(d,!1);for(let t of e.on)re(this,a).get(t)._setVisible(d,!0);for(let t of e.off)re(this,a).get(t)._setVisible(d,!1);xt(this,s,this.getHash())}}isVisible(e){if(0===re(this,a).size)return!0;if(!e)return(0,u.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return re(this,a).has(e.id)?re(this,a).get(e.id).visible:((0,u.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return at(this,l,h).call(this,e.expression);if(!e.policy||"AnyOn"===e.policy){for(let t of e.ids){if(!re(this,a).has(t))return(0,u.warn)(`Optional content group not found: ${t}`),!0;if(re(this,a).get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(let t of e.ids){if(!re(this,a).has(t))return(0,u.warn)(`Optional content group not found: ${t}`),!0;if(!re(this,a).get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(let t of e.ids){if(!re(this,a).has(t))return(0,u.warn)(`Optional content group not found: ${t}`),!0;if(!re(this,a).get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(let t of e.ids){if(!re(this,a).has(t))return(0,u.warn)(`Optional content group not found: ${t}`),!0;if(re(this,a).get(t).visible)return!1}return!0}return(0,u.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,u.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){re(this,a).has(e)?(re(this,a).get(e)._setVisible(d,!!t),xt(this,i,null)):(0,u.warn)(`Optional content group not found: ${e}`)}get hasInitialVisibility(){return this.getHash()===re(this,s)}getOrder(){return re(this,a).size?re(this,o)?re(this,o).slice():[...re(this,a).keys()]:null}getGroups(){return re(this,a).size>0?(0,u.objectFromMap)(re(this,a)):null}getGroup(e){return re(this,a).get(e)||null}getHash(){if(null!==re(this,i))return re(this,i);let e=new c.MurmurHash3_64;for(let[t,n]of re(this,a))e.update(`${t}:${n.visible}`);return xt(this,i,e.hexdigest())}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var r=n(1),i=n(6);t.PDFDataTransportStream=class{constructor({length:e,initialData:t,progressiveDone:n=!1,contentDispositionFilename:i=null,disableRange:a=!1,disableStream:s=!1},o){if((0,r.assert)(o,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=n,this._contentDispositionFilename=i,(null==t?void 0:t.length)>0){let e=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=o,this._isStreamingSupported=!s,this._isRangeSupported=!a,this._contentLength=e,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(void 0===e)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let t=this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(n),!0)}));(0,r.assert)(t,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}_onProgress(e){var t,n,r,i;void 0===e.total?null==(n=null==(t=this._rangeReaders[0])?void 0:t.onProgress)||n.call(t,{loaded:e.loaded}):null==(i=null==(r=this._fullRequestReader)?void 0:r.onProgress)||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;null==(e=this._fullRequestReader)||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,r.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new a(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new s(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}};class a{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=(0,i.isPdfFile)(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(let e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return Et(this,null,(function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=new r.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class s{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return Et(this,null,(function*(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=new r.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class n{static textContent(e){let t=[],r={items:t,styles:Object.create(null)};return function e(r){var i;if(!r)return;let a=null,s=r.name;if("#text"===s)a=r.value;else{if(!n.shouldBuildText(s))return;null!=(i=null==r?void 0:r.attributes)&&i.textContent?a=r.attributes.textContent:r.value&&(a=r.value)}if(null!==a&&t.push({str:a}),r.children)for(let t of r.children)e(t)}(e),r}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}t.XfaText=n},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeFilterFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var r=n(7);let i=function(e){return new Promise(((t,n)=>{OA().readFile(e,((e,r)=>{!e&&r?t(new Uint8Array(r)):n(new Error(e))}))}))};class a extends r.BaseFilterFactory{}t.NodeFilterFactory=a;class s extends r.BaseCanvasFactory{_createCanvas(e,t){return ope().createCanvas(e,t)}}t.NodeCanvasFactory=s;class o extends r.BaseCMapReaderFactory{_fetchData(e,t){return i(e).then((e=>({cMapData:e,compressionType:t})))}}t.NodeCMapReaderFactory=o;class l extends r.BaseStandardFontDataFactory{_fetchData(e){return i(e)}}t.NodeStandardFontDataFactory=l},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var r=n(1),i=n(22);let a=OA(),s=lpe(),o=cpe(),l=upe(),h=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){let t=l.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?l.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new m(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=this.isFsUrl?new g(this,e,t):new f(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class u{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=new r.PromiseCapability,this._headersCapability=new r.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return Et(this,null,(function*(){var e;if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return null===t?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=t.length,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}))}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new r.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class c{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new r.PromiseCapability;let t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}read(){return Et(this,null,(function*(){var e;if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return null===t?(this._readCapability=new r.PromiseCapability,this.read()):(this._loaded+=t.length,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}))}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends u{constructor(e){super(e);let t=t=>{if(404===t.statusCode){let e=new r.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);let n=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:a,suggestedLength:s}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(n)};this._request=null,"http:"===this._url.protocol?this._request=s.request(d(this._url,e.httpHeaders),t):this._request=o.request(d(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class f extends c{constructor(e,t,n){super(e),this._httpHeaders={};for(let t in e.httpHeaders){let n=e.httpHeaders[t];void 0!==n&&(this._httpHeaders[t]=n)}this._httpHeaders.Range=`bytes=${t}-${n-1}`;let i=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{let e=new r.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=s.request(d(this._url,this._httpHeaders),i):this._request=o.request(d(this._url,this._httpHeaders),i),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class m extends u{constructor(e){super(e);let t=decodeURIComponent(this._url.path);h.test(this._url.href)&&(t=t.replace(/^\//,"")),a.lstat(t,((e,n)=>{if(e)return"ENOENT"===e.code&&(e=new r.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=n.size,this._setReadableStream(a.createReadStream(t)),this._headersCapability.resolve()}))}}class g extends c{constructor(e,t,n){super(e);let r=decodeURIComponent(this._url.path);h.test(this._url.href)&&(r=r.replace(/^\//,"")),this._setReadableStream(a.createReadStream(r,{start:t,end:n-1}))}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new r.MissingPDFException('Missing PDF "'+t+'".'):new r.UnexpectedResponseException(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)},t.extractFilenameFromHeader=function(e){let t=e("Content-Disposition");if(t){let e=(0,i.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if((0,a.isPdfFile)(e))return e}return null},t.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:n,disableRange:r}){let i={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(e("Content-Length"),10);return!Number.isInteger(a)||(i.suggestedLength=a,a<=2*n)||r||!t||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(i.allowRangeRequests=!0),i},t.validateResponseStatus=function(e){return 200===e||206===e};var r=n(1),i=n(23),a=n(6)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,n=i("filename\\*","i").exec(e);if(n){n=n[1];let e=o(n);return e=unescape(e),e=l(e),e=h(e),s(e)}if(n=function(e){let t,n=[],r=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(t=r.exec(e));){let[,e,r,i]=t;if(e=parseInt(e,10),e in n){if(0===e)break}else n[e]=[r,i]}let a=[];for(let e=0;e<n.length&&e in n;++e){let[t,r]=n[e];r=o(r),t&&(r=unescape(r),0===e&&(r=l(r))),a.push(r)}return a.join("")}(e),n)return s(h(n));if(n=i("filename","i").exec(e),n){n=n[1];let e=o(n);return e=h(e),s(e)}function i(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function a(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{let i=new TextDecoder(e,{fatal:!0}),a=(0,r.stringToBytes)(n);n=i.decode(a),t=!1}catch(e){}}return n}function s(e){return t&&/[\x80-\xff]/.test(e)&&(e=a("utf-8",e),t&&(e=a("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){let t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){let n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){let t=e.indexOf("'");return-1===t?e:a(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function h(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,n,r){if("q"===n||"Q"===n)return a(t,r=(r=r.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{r=atob(r)}catch(e){}return a(t,r)}))}return""};var r=n(1)},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var r=n(1),i=n(22);class a{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){let r={begin:e,end:t};for(let e in n)r[e]=n[e];return this.request(r)}requestFull(e){return this.request(e)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let e in this.httpHeaders){let n=this.httpHeaders[e];void 0!==n&&t.setRequestHeader(e,n)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=206):r.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(n){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var n;let r=this.pendingRequests[e];r&&(null==(n=r.onProgress)||n.call(r,t))}onStateChange(e,t){var n,i,a;let s=this.pendingRequests[e];if(!s)return;let o=s.xhr;if(o.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),4!==o.readyState||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===o.status&&this.isHttp)return void(null==(n=s.onError)||n.call(s,o.status));let l=o.status||200;if((200!==l||206!==s.expectedStatus)&&l!==s.expectedStatus)return void(null==(i=s.onError)||i.call(s,o.status));let h=function(e){let t=e.response;return"string"!=typeof t?t:(0,r.stringToBytes)(t).buffer}(o);if(206===l){let e=o.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);s.onDone({begin:parseInt(t[1],10),chunk:h})}else h?s.onDone({begin:0,chunk:h}):null==(a=s.onError)||a.call(s,o.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new a(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new s(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new o(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class s{constructor(e,t){this._manager=e;let n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=new r.PromiseCapability,this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=e=>t.getResponseHeader(e),{allowRangeRequests:r,suggestedLength:a}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,i.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;null==(t=this.onProgress)||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}read(){return Et(this,null,(function*(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=new r.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class o{constructor(e,t,n){this._manager=e;let r={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,r),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;null==(e=this.onClosed)||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,i.createResponseStatusError)(e,this._url);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||null==(t=this.onProgress)||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return Et(this,null,(function*(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=new r.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var r=n(1),i=n(22);function a(e,t,n){return{method:"GET",headers:e,signal:n.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function s(e){let t=new Headers;for(let n in e){let r=e[n];void 0!==r&&t.append(n,r)}return t}function o(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:((0,r.warn)(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}getFullReader(){return(0,r.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new h(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class l{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=new r.PromiseCapability,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=s(this._stream.httpHeaders);let n=t.url;fetch(n,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,n);this._reader=e.body.getReader(),this._headersCapability.resolve();let t=t=>e.headers.get(t),{allowRangeRequests:a,suggestedLength:s}=(0,i.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,i.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new r.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return Et(this,null,(function*(){var e;yield this._headersCapability.promise;let{value:t,done:n}=yield this._reader.read();return n?{value:t,done:n}:(this._loaded+=t.byteLength,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:o(t),done:!1})}))}cancel(e){var t;null==(t=this._reader)||t.cancel(e),this._abortController.abort()}}class h{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let o=e.source;this._withCredentials=o.withCredentials||!1,this._readCapability=new r.PromiseCapability,this._isStreamingSupported=!o.disableStream,this._abortController=new AbortController,this._headers=s(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${n-1}`);let l=o.url;fetch(l,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,i.validateResponseStatus)(e.status))throw(0,i.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return Et(this,null,(function*(){var e;yield this._readCapability.promise;let{value:t,done:n}=yield this._reader.read();return n?{value:t,done:n}:(this._loaded+=t.byteLength,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded}),{value:o(t),done:!1})}))}cancel(e){var t;null==(t=this._reader)||t.cancel(e),this._abortController.abort()}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=function(e){!e.textContentSource&&(e.textContent||e.textContentStream)&&((0,i.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),e.textContentSource=e.textContent||e.textContentStream);let{container:t,viewport:n}=e,r=getComputedStyle(t),a=r.getPropertyValue("visibility"),s=parseFloat(r.getPropertyValue("--scale-factor"));"visible"===a&&(!s||Math.abs(s-n.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");let o=new c(e);return o._render(),o},t.updateTextLayer=function({container:e,viewport:t,textDivs:n,textDivProperties:r,isOffscreenCanvasSupported:a,mustRotate:s=!0,mustRescale:o=!0}){if(s&&(0,i.setLayerDimensions)(e,{rotation:t.rotation}),o){let e=l(0,a),i={prevFontSize:null,prevFontFamily:null,div:null,scale:t.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:e};for(let e of n)i.properties=r.get(e),i.div=e,u(i)}};var r=n(1),i=n(6);let a=30,s=.8,o=new Map;function l(e,t){let n;if(t&&r.FeatureTest.isOffscreenCanvasSupported)n=new OffscreenCanvas(e,e).getContext("2d",{alpha:!1});else{let t=document.createElement("canvas");t.width=t.height=e,n=t.getContext("2d",{alpha:!1})}return n}function h(e,t,n){let i=document.createElement("span"),h={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};e._textDivs.push(i);let u=r.Util.transform(e._transform,t.transform),c=Math.atan2(u[1],u[0]),d=n[t.fontName];d.vertical&&(c+=Math.PI/2);let p,f,m=Math.hypot(u[2],u[3]),g=m*function(e,t){let n=o.get(e);if(n)return n;let r=l(a,t);r.font=`${a}px ${e}`;let i=r.measureText(""),h=i.fontBoundingBoxAscent,u=Math.abs(i.fontBoundingBoxDescent);if(h){let t=h/(h+u);return o.set(e,t),r.canvas.width=r.canvas.height=0,t}r.strokeStyle="red",r.clearRect(0,0,a,a),r.strokeText("g",0,0);let c=r.getImageData(0,0,a,a).data;u=0;for(let e=c.length-1-3;e>=0;e-=4)if(c[e]>0){u=Math.ceil(e/4/a);break}r.clearRect(0,0,a,a),r.strokeText("A",0,a),c=r.getImageData(0,0,a,a).data,h=0;for(let e=0,t=c.length;e<t;e+=4)if(c[e]>0){h=a-Math.floor(e/4/a);break}if(r.canvas.width=r.canvas.height=0,h){let t=h/(h+u);return o.set(e,t),t}return o.set(e,s),s}(d.fontFamily,e._isOffscreenCanvasSupported);0===c?(p=u[4],f=u[5]-g):(p=u[4]+g*Math.sin(c),f=u[5]-g*Math.cos(c));let v="calc(var(--scale-factor)*",y=i.style;e._container===e._rootContainer?(y.left=`${(100*p/e._pageWidth).toFixed(2)}%`,y.top=`${(100*f/e._pageHeight).toFixed(2)}%`):(y.left=`${v}${p.toFixed(2)}px)`,y.top=`${v}${f.toFixed(2)}px)`),y.fontSize=`${v}${m.toFixed(2)}px)`,y.fontFamily=d.fontFamily,h.fontSize=m,i.setAttribute("role","presentation"),i.textContent=t.str,i.dir=t.dir,e._fontInspectorEnabled&&(i.dataset.fontName=t.fontName),0!==c&&(h.angle=c*(180/Math.PI));let x=!1;if(t.str.length>1)x=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){let e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(x=!0)}x&&(h.canvasWidth=d.vertical?t.height:t.width),e._textDivProperties.set(i,h),e._isReadableStream&&e._layoutText(i)}function u(e){let{div:t,scale:n,properties:r,ctx:i,prevFontSize:a,prevFontFamily:s}=e,{style:o}=t,l="";if(0!==r.canvasWidth&&r.hasText){let{fontFamily:h}=o,{canvasWidth:u,fontSize:c}=r;(a!==c||s!==h)&&(i.font=`${c*n}px ${h}`,e.prevFontSize=c,e.prevFontFamily=h);let{width:d}=i.measureText(t.textContent);d>0&&(l=`scaleX(${u*n/d})`)}0!==r.angle&&(l=`rotate(${r.angle}deg) ${l}`),l.length>0&&(o.transform=l)}class c{constructor({textContentSource:e,container:t,viewport:n,textDivs:a,textDivProperties:s,textContentItemsStr:o,isOffscreenCanvasSupported:h}){var u;this._textContentSource=e,this._isReadableStream=e instanceof ReadableStream,this._container=this._rootContainer=t,this._textDivs=a||[],this._textContentItemsStr=o||[],this._isOffscreenCanvasSupported=h,this._fontInspectorEnabled=!(null==(u=globalThis.FontInspector)||!u.enabled),this._reader=null,this._textDivProperties=s||new WeakMap,this._canceled=!1,this._capability=new r.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:n.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,h)};let{pageWidth:c,pageHeight:d,pageX:p,pageY:f}=n.rawDims;this._transform=[1,0,0,-1,-p,f+d],this._pageWidth=c,this._pageHeight=d,(0,i.setLayerDimensions)(t,n),this._capability.promise.finally((()=>{this._layoutTextParams=null})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new r.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),this._capability.reject(new r.AbortException("TextLayer task cancelled."))}_processItems(e,t){for(let n of e)if(void 0!==n.str)this._textContentItemsStr.push(n.str),h(this,n,t);else if("beginMarkedContentProps"===n.type||"beginMarkedContent"===n.type){let e=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==n.id&&this._container.setAttribute("id",`${n.id}`),e.append(this._container)}else"endMarkedContent"===n.type&&(this._container=this._container.parentNode)}_layoutText(e){let t=this._layoutTextParams.properties=this._textDivProperties.get(e);if(this._layoutTextParams.div=e,u(this._layoutTextParams),t.hasText&&this._container.append(e),t.hasEOL){let e=document.createElement("br");e.setAttribute("role","presentation"),this._container.append(e)}}_render(){let e=new r.PromiseCapability,t=Object.create(null);if(this._isReadableStream){let n=()=>{this._reader.read().then((({value:r,done:i})=>{i?e.resolve():(Object.assign(t,r.styles),this._processItems(r.items,t),n())}),e.reject)};this._reader=this._textContentSource.getReader(),n()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');{let{items:t,styles:n}=this._textContentSource;this._processItems(t,n),e.resolve()}}e.promise.then((()=>{t=null,function(e){if(e._canceled)return;let t=e._textDivs,n=e._capability;if(t.length>1e5)n.resolve();else{if(!e._isReadableStream)for(let n of t)e._layoutText(n);n.resolve()}}(this)}),this._capability.reject)}}t.TextLayerRenderTask=c},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var _=n(1),w=n(4),S=n(5),M=n(28),T=n(33),E=n(6);let A=class{constructor(e){Ye(this,p),Ye(this,m),Ye(this,v),Ye(this,x),Ye(this,r,void 0),Ye(this,i,!1),Ye(this,a,null),Ye(this,s,this.pointerup.bind(this)),Ye(this,o,this.pointerdown.bind(this)),Ye(this,l,new Map),Ye(this,h,!1),Ye(this,u,!1),Ye(this,c,!1),Ye(this,d,void 0),A._initialized||(A._initialized=!0,M.FreeTextEditor.initialize(e.l10n),T.InkEditor.initialize(e.l10n)),e.uiManager.registerEditorTypes([M.FreeTextEditor,T.InkEditor]),xt(this,d,e.uiManager),this.pageIndex=e.pageIndex,this.div=e.div,xt(this,r,e.accessibilityManager),xt(this,a,e.annotationLayer),this.viewport=e.viewport,re(this,d).addLayer(this)}get isEmpty(){return 0===re(this,l).size}updateToolbar(e){re(this,d).updateToolbar(e)}updateMode(e=re(this,d).getMode()){at(this,x,b).call(this),e===_.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),re(this,d).unselectAll(),e!==_.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",e===_.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",e===_.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(e){if(e||re(this,d).getMode()===_.AnnotationEditorType.INK){if(!e)for(let e of re(this,l).values())if(e.isEmpty())return void e.setInBackground();at(this,v,y).call(this,{offsetX:0,offsetY:0}).setInBackground()}}setEditingState(e){re(this,d).setEditingState(e)}addCommands(e){re(this,d).addCommands(e)}enable(){this.div.style.pointerEvents="auto";let e=new Set;for(let t of re(this,l).values())t.enableEditing(),t.annotationElementId&&e.add(t.annotationElementId);if(!re(this,a))return;let t=re(this,a).getEditableAnnotations();for(let n of t){if(n.hide(),re(this,d).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let t=this.deserialize(n);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){var e;xt(this,c,!0),this.div.style.pointerEvents="none";let t=new Set;for(let n of re(this,l).values())n.disableEditing(),n.annotationElementId&&null===n.serialize()?(null==(e=this.getEditableAnnotation(n.annotationElementId))||e.show(),n.remove()):t.add(n.annotationElementId);if(re(this,a)){let e=re(this,a).getEditableAnnotations();for(let n of e){let{id:e}=n.data;t.has(e)||re(this,d).isDeletedAnnotationElement(e)||n.show()}}at(this,x,b).call(this),this.isEmpty&&(this.div.hidden=!0),xt(this,c,!1)}getEditableAnnotation(e){var t;return(null==(t=re(this,a))?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){re(this,d).getActive()!==e&&re(this,d).setActiveEditor(e)}enableClick(){this.div.addEventListener("pointerdown",re(this,o)),this.div.addEventListener("pointerup",re(this,s))}disableClick(){this.div.removeEventListener("pointerdown",re(this,o)),this.div.removeEventListener("pointerup",re(this,s))}attach(e){re(this,l).set(e.id,e);let{annotationElementId:t}=e;t&&re(this,d).isDeletedAnnotationElement(t)&&re(this,d).removeDeletedAnnotationElement(e)}detach(e){var t;re(this,l).delete(e.id),null==(t=re(this,r))||t.removePointerInTextLayer(e.contentDiv),!re(this,c)&&e.annotationElementId&&re(this,d).addDeletedAnnotationElement(e)}remove(e){this.detach(e),re(this,d).removeEditor(e),e.div.style.display="none",setTimeout((()=>{e.div.style.display="",e.div.remove(),e.isAttachedToDOM=!1,document.activeElement===document.body&&re(this,d).focusMainContainer()}),0),re(this,u)||this.addInkEditorIfNeeded(!1)}add(e){if(at(this,p,f).call(this,e),re(this,d).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}this.moveEditorInDOM(e),e.onceAdded(),re(this,d).addToAnnotationStorage(e)}moveEditorInDOM(e){var t;null==(t=re(this,r))||t.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?e.rebuild():this.add(e)}getNextId(){return re(this,d).getId()}deserialize(e){var t;switch(null!=(t=e.annotationType)?t:e.annotationEditorType){case _.AnnotationEditorType.FREETEXT:return M.FreeTextEditor.deserialize(e,this,re(this,d));case _.AnnotationEditorType.INK:return T.InkEditor.deserialize(e,this,re(this,d))}return null}setSelected(e){re(this,d).setSelected(e)}toggleSelected(e){re(this,d).toggleSelected(e)}isSelected(e){return re(this,d).isSelected(e)}unselect(e){re(this,d).unselect(e)}pointerup(e){let{isMac:t}=_.FeatureTest.platform;if(!(0!==e.button||e.ctrlKey&&t)&&e.target===this.div&&re(this,h)){if(xt(this,h,!1),!re(this,i))return void xt(this,i,!0);at(this,v,y).call(this,e)}}pointerdown(e){let{isMac:t}=_.FeatureTest.platform;if(0!==e.button||e.ctrlKey&&t||e.target!==this.div)return;xt(this,h,!0);let n=re(this,d).getActive();xt(this,i,!n||n.isEmpty())}drop(e){let t=e.dataTransfer.getData("text/plain"),n=re(this,d).getEditor(t);if(!n)return;e.preventDefault(),e.dataTransfer.dropEffect="move",at(this,p,f).call(this,n);let r=this.div.getBoundingClientRect(),i=e.clientX-r.x,a=e.clientY-r.y;n.translate(i-n.startX,a-n.startY),this.moveEditorInDOM(n),n.div.focus()}dragover(e){e.preventDefault()}destroy(){var e,t;(null==(e=re(this,d).getActive())?void 0:e.parent)===this&&re(this,d).setActiveEditor(null);for(let e of re(this,l).values())null==(t=re(this,r))||t.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,re(this,l).clear(),re(this,d).removeLayer(this)}render({viewport:e}){this.viewport=e,(0,E.setLayerDimensions)(this.div,e),(0,S.bindEvents)(this,this.div,["dragover","drop"]);for(let e of re(this,d).getEditors(this.pageIndex))this.add(e);this.updateMode()}update({viewport:e}){re(this,d).commitOrRemove(),this.viewport=e,(0,E.setLayerDimensions)(this.div,{rotation:e.rotation}),this.updateMode()}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}},C=A;r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakSet,f=function(e){var t;e.parent!==this&&(e.annotationElementId&&(re(this,d).addDeletedAnnotationElement(e.annotationElementId),w.AnnotationEditor.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),null==(t=e.parent)||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))},m=new WeakSet,g=function(e){switch(re(this,d).getMode()){case _.AnnotationEditorType.FREETEXT:return new M.FreeTextEditor(e);case _.AnnotationEditorType.INK:return new T.InkEditor(e)}return null},v=new WeakSet,y=function(e){let t=this.getNextId(),n=at(this,m,g).call(this,{parent:this,id:t,x:e.offsetX,y:e.offsetY,uiManager:re(this,d)});return n&&this.add(n),n},x=new WeakSet,b=function(){xt(this,u,!0);for(let e of re(this,l).values())e.isEmpty()&&e.remove();xt(this,u,!1)},li(C,"_initialized",!1),t.AnnotationEditorLayer=C},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b,_,w,S,M,T;Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var E=n(1),A=n(5),C=n(4),P=n(29);let I=class extends C.AnnotationEditor{constructor(e){super(Ki(oi({},e),{name:"freeTextEditor"})),Ye(this,d),Ye(this,f),Ye(this,g),Ye(this,y),Ye(this,b),Ye(this,w),Ye(this,M),Ye(this,r,this.editorDivBlur.bind(this)),Ye(this,i,this.editorDivFocus.bind(this)),Ye(this,a,this.editorDivInput.bind(this)),Ye(this,s,this.editorDivKeydown.bind(this)),Ye(this,o,void 0),Ye(this,l,""),Ye(this,h,`${this.id}-editor`),Ye(this,u,void 0),Ye(this,c,null),xt(this,o,e.color||I._defaultColor||C.AnnotationEditor._defaultLineColor),xt(this,u,e.fontSize||I._defaultFontSize)}static get _keyboardManager(){return(0,E.shadow)(this,"_keyboardManager",new A.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],I.prototype.commitOrRemove,!0],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],I.prototype.commitOrRemove]]))}static initialize(e){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map((t=>[t,e.get(t)])));let t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case E.AnnotationEditorParamsType.FREETEXT_SIZE:I._defaultFontSize=t;break;case E.AnnotationEditorParamsType.FREETEXT_COLOR:I._defaultColor=t}}updateParams(e,t){switch(e){case E.AnnotationEditorParamsType.FREETEXT_SIZE:at(this,d,p).call(this,t);break;case E.AnnotationEditorParamsType.FREETEXT_COLOR:at(this,f,m).call(this,t)}}static get defaultPropertiesToUpdate(){return[[E.AnnotationEditorParamsType.FREETEXT_SIZE,I._defaultFontSize],[E.AnnotationEditorParamsType.FREETEXT_COLOR,I._defaultColor||C.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[E.AnnotationEditorParamsType.FREETEXT_SIZE,re(this,u)],[E.AnnotationEditorParamsType.FREETEXT_COLOR,re(this,o)]]}getInitialTranslation(){let e=this.parentScale;return[-I._internalPadding*e,-(I._internalPadding+re(this,u))*e]}rebuild(){super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(E.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",re(this,s)),this.editorDiv.addEventListener("focus",re(this,i)),this.editorDiv.addEventListener("blur",re(this,r)),this.editorDiv.addEventListener("input",re(this,a)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",re(this,h)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",re(this,s)),this.editorDiv.removeEventListener("focus",re(this,i)),this.editorDiv.removeEventListener("blur",re(this,r)),this.editorDiv.removeEventListener("input",re(this,a)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(e){super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width?at(this,M,T).call(this):(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=re(this,l),t=xt(this,l,at(this,g,v).call(this).trimEnd());if(e===t)return;let n=e=>{xt(this,l,e),e?(at(this,b,_).call(this),this.rebuild(),at(this,y,x).call(this)):this.remove()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),at(this,y,x).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(e){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(e){I._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",re(this,h)),this.enableEditing(),I._l10nPromise.get("editor_free_text2_aria_label").then((e=>{var t;return null==(t=this.editorDiv)?void 0:t.setAttribute("aria-label",e)})),I._l10nPromise.get("free_text2_default_content").then((e=>{var t;return null==(t=this.editorDiv)?void 0:t.setAttribute("default-content",e)})),this.editorDiv.contentEditable=!0;let{style:n}=this.editorDiv;if(n.fontSize=`calc(${re(this,u)}px * var(--scale-factor))`,n.color=re(this,o),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,A.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[n,r]=this.parentDimensions;if(this.annotationElementId){let[i]=this.getInitialTranslation();this.setAt(e*n,t*r,i,i)}else this.setAt(e*n,t*r,this.width*n,this.height*r);at(this,b,_).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(e,t,n){let r=null;if(e instanceof P.FreeTextAnnotationElement){let{data:{defaultAppearanceData:{fontSize:t,fontColor:n},rect:i,rotation:a,id:s},textContent:o,parent:{page:{pageNumber:l}}}=e;if(!o||0===o.length)return null;r=e={annotationType:E.AnnotationEditorType.FREETEXT,color:Array.from(n),fontSize:t,value:o.join("\n"),pageIndex:l-1,rect:i,rotation:a,id:s,deleted:!1}}let i=super.deserialize(e,t,n);return xt(i,u,e.fontSize),xt(i,o,E.Util.makeHexColor(...e.color)),xt(i,l,e.value),i.annotationElementId=e.id||null,xt(i,c,r),i}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};let t=I._internalPadding*this.parentScale,n=this.getRect(t,t),r=C.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:re(this,o)),i={annotationType:E.AnnotationEditorType.FREETEXT,color:r,fontSize:re(this,u),value:re(this,l),pageIndex:this.pageIndex,rect:n,rotation:this.rotation};return e?i:this.annotationElementId&&!at(this,w,S).call(this,i)?null:(i.id=this.annotationElementId,i)}},R=I;r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakSet,p=function(e){let t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-re(this,u))*this.parentScale),xt(this,u,e),at(this,y,x).call(this)},n=re(this,u);this.addCommands({cmd:()=>{t(e)},undo:()=>{t(n)},mustExec:!0,type:E.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},f=new WeakSet,m=function(e){let t=re(this,o);this.addCommands({cmd:()=>{xt(this,o,this.editorDiv.style.color=e)},undo:()=>{xt(this,o,this.editorDiv.style.color=t)},mustExec:!0,type:E.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},g=new WeakSet,v=function(){let e=this.editorDiv.getElementsByTagName("div");if(0===e.length)return this.editorDiv.innerText;let t=[];for(let n of e)t.push(n.innerText.replace(/\r\n?|\n/,""));return t.join("\n")},y=new WeakSet,x=function(){let e,[t,n]=this.parentDimensions;if(this.isAttachedToDOM)e=this.div.getBoundingClientRect();else{let{currentLayer:t,div:n}=this,r=n.style.display;n.style.display="hidden",t.div.append(this.div),e=n.getBoundingClientRect(),n.remove(),n.style.display=r}this.width=e.width/t,this.height=e.height/n},b=new WeakSet,_=function(){if(this.editorDiv.replaceChildren(),re(this,l))for(let e of re(this,l).split("\n")){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}},w=new WeakSet,S=function(e){let{value:t,fontSize:n,color:r,rect:i,pageIndex:a}=re(this,c);return e.value!==t||e.fontSize!==n||e.rect.some(((e,t)=>Math.abs(e-i[t])>=1))||e.color.some(((e,t)=>e!==r[t]))||e.pageIndex!==a},M=new WeakSet,T=function(e=!1){if(!this.annotationElementId)return;if(at(this,y,x).call(this),!e&&(0===this.width||0===this.height))return void setTimeout((()=>at(this,M,T).call(this,!0)),0);let t=I._internalPadding*this.parentScale;re(this,c).rect=this.getRect(t,t)},li(R,"_freeTextDefaultContent",""),li(R,"_l10nPromise"),li(R,"_internalPadding",0),li(R,"_defaultColor",null),li(R,"_defaultFontSize",10),li(R,"_type","freetext"),t.FreeTextEditor=R},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,A,C,P,I,R,L,O,D,k,N,F,U,B,z,H;Object.defineProperty(t,"__esModule",{value:!0}),t.InkAnnotationElement=t.FreeTextAnnotationElement=t.AnnotationLayer=void 0;var V=n(1),j=n(6),G=n(3),W=n(30),q=n(31);let X=1e3,Y=new WeakSet;function Z(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class J{static create(e){switch(e.data.annotationType){case V.AnnotationType.LINK:return new Q(e);case V.AnnotationType.TEXT:return new $(e);case V.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new te(e);case"Btn":return e.data.radioButton?new ae(e):e.data.checkBox?new ie(e):new se(e);case"Ch":return new oe(e);case"Sig":return new ne(e)}return new ee(e);case V.AnnotationType.POPUP:return new le(e);case V.AnnotationType.FREETEXT:return new ue(e);case V.AnnotationType.LINE:return new ce(e);case V.AnnotationType.SQUARE:return new de(e);case V.AnnotationType.CIRCLE:return new pe(e);case V.AnnotationType.POLYLINE:return new fe(e);case V.AnnotationType.CARET:return new ge(e);case V.AnnotationType.INK:return new ve(e);case V.AnnotationType.POLYGON:return new me(e);case V.AnnotationType.HIGHLIGHT:return new ye(e);case V.AnnotationType.UNDERLINE:return new xe(e);case V.AnnotationType.SQUIGGLY:return new be(e);case V.AnnotationType.STRIKEOUT:return new _e(e);case V.AnnotationType.STAMP:return new we(e);case V.AnnotationType.FILEATTACHMENT:return new Se(e);default:return new K(e)}}}class K{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&(this.quadrilaterals=this._createQuadrilaterals(n))}_createContainer(e){let{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),i.style.zIndex=this.parent.zIndex++,this.data.popupRef&&i.setAttribute("aria-haspopup","dialog"),t.noRotate&&i.classList.add("norotate");let{pageWidth:a,pageHeight:s,pageX:o,pageY:l}=r.rawDims;if(!t.rect||this instanceof le){let{rotation:e}=t;return!t.hasOwnCanvas&&0!==e&&this.setRotation(e,i),i}let{width:h,height:u}=Z(t.rect),c=V.Util.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]);if(!e&&t.borderStyle.width>0){i.style.borderWidth=`${t.borderStyle.width}px`;let e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;if(e>0||n>0){let t=`calc(${e}px * var(--scale-factor)) / calc(${n}px * var(--scale-factor))`;i.style.borderRadius=t}else if(this instanceof ae){let e=`calc(${h}px * var(--scale-factor)) / calc(${u}px * var(--scale-factor))`;i.style.borderRadius=e}switch(t.borderStyle.style){case V.AnnotationBorderStyleType.SOLID:i.style.borderStyle="solid";break;case V.AnnotationBorderStyleType.DASHED:i.style.borderStyle="dashed";break;case V.AnnotationBorderStyleType.BEVELED:(0,V.warn)("Unimplemented border style: beveled");break;case V.AnnotationBorderStyleType.INSET:(0,V.warn)("Unimplemented border style: inset");break;case V.AnnotationBorderStyleType.UNDERLINE:i.style.borderBottomStyle="solid"}let r=t.borderColor||null;r?i.style.borderColor=V.Util.makeHexColor(0|r[0],0|r[1],0|r[2]):i.style.borderWidth=0}i.style.left=100*(c[0]-o)/a+"%",i.style.top=100*(c[1]-l)/s+"%";let{rotation:d}=t;return t.hasOwnCanvas||0===d?(i.style.width=100*h/a+"%",i.style.height=100*u/s+"%"):this.setRotation(d,i),i}setRotation(e,t=this.container){let n,r,{pageWidth:i,pageHeight:a}=this.parent.viewport.rawDims,{width:s,height:o}=Z(this.data.rect);e%180==0?(n=100*s/i,r=100*o/a):(n=100*o/i,r=100*s/a),t.style.width=`${n}%`,t.style.height=`${r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(e,t,n)=>{let r=n.detail[e];n.target.style[t]=W.ColorConverters[`${r[0]}_HTML`](r.slice(1))};return(0,V.shadow)(this,"_commonActions",{display:e=>{let t=e.detail.display%2==1;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:t,print:0===e.detail.display||3===e.detail.display})},print:e=>{this.annotationStorage.setValue(this.data.id,{print:e.detail.print})},hidden:e=>{this.container.style.visibility=e.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:e.detail.hidden})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.detail.readonly?e.target.setAttribute("readonly",""):e.target.removeAttribute("readonly")},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{let t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let r of Object.keys(t.detail)){let i=e[r]||n[r];null==i||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[r,i]of Object.entries(t)){let a=n[r];a&&(a({detail:{[r]:i},target:e}),delete t[r])}}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;let t=[],n=this.data.rect,r=null;for(let n of this.data.quadPoints)this.data.rect=[n[2].x,n[2].y,n[1].x,n[1].y],t.push(this._createContainer(e)),r||(r=this.data.rect);return this.data.rect=n,this.firstQuadRect=r,t}_createPopup(){let{container:e,data:t}=this;e.setAttribute("aria-haspopup","dialog");let n=new le({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:this.firstQuadRect||t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(n.render())}_renderQuadrilaterals(e){for(let t of this.quadrilaterals)t.classList.add(e);return this.quadrilaterals}render(){(0,V.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let r=this._fieldObjects[e];if(r)for(let{page:e,id:i,exportValues:a}of r){if(-1===e||i===t)continue;let r="string"==typeof a?a:null,s=document.querySelector(`[data-element-id="${i}"]`);!s||Y.has(s)?n.push({id:i,exportValue:r,domElement:s}):(0,V.warn)(`_getElementsByName - element not allowed: ${i}`)}return n}for(let r of document.getElementsByName(e)){let{exportValue:e}=r,i=r.getAttribute("data-element-id");i!==t&&Y.has(r)&&n.push({id:i,exportValue:e,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),null==(e=this.popup)||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),null==(e=this.popup)||e.forceHide()}getElementsToTriggerPopup(){return this.quadrilaterals||this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}}class Q extends K{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!(null==t||!t.ignoreBorder),createQuadrilaterals:!0}),Ye(this,r),Ye(this,a),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,n=document.createElement("a");n.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action),r=!0):e.attachment?(this._bindAttachment(n,e.attachment),r=!0):e.setOCGState?(at(this,a,s).call(this,n,e.setOCGState),r=!0):e.dest?(this._bindLink(n,e.dest),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,""),r=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map(((e,t)=>{let r=0===t?n:n.cloneNode();return e.append(r),e})):(this.container.classList.add("linkAnnotation"),r&&this.container.append(n),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&at(this,r,i).call(this)}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),at(this,r,i).call(this)}_bindAttachment(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var e;return null==(e=this.downloadManager)||e.openOrDownloadData(this.container,t.content,t.filename),!1},at(this,r,i).call(this)}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let n=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let r of Object.keys(t.actions)){let i=n.get(r);i&&(e[i]=()=>{var e;return null==(e=this.linkService.eventBus)||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1})}e.onclick||(e.onclick=()=>!1),at(this,r,i).call(this)}_bindResetFormAction(e,t){let n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl("")),at(this,r,i).call(this),!this._fieldObjects)return(0,V.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(n||(e.onclick=()=>!1));e.onclick=()=>{var e;null==n||n();let{fields:r,refs:i,include:a}=t,s=[];if(0!==r.length||0!==i.length){let e=new Set(i);for(let t of r){let n=this._fieldObjects[t]||[];for(let{id:t}of n)e.add(t)}for(let t of Object.values(this._fieldObjects))for(let n of t)e.has(n.id)===a&&s.push(n)}else for(let e of Object.values(this._fieldObjects))s.push(...e);let o=this.annotationStorage,l=[];for(let e of s){let{id:t}=e;switch(l.push(t),e.type){case"text":{let n=e.defaultValue||"";o.setValue(t,{value:n});break}case"checkbox":case"radiobutton":{let n=e.defaultValue===e.exportValues;o.setValue(t,{value:n});break}case"combobox":case"listbox":{let n=e.defaultValue||"";o.setValue(t,{value:n});break}default:continue}let n=document.querySelector(`[data-element-id="${t}"]`);n&&(Y.has(n)?n.dispatchEvent(new Event("resetform")):(0,V.warn)(`_bindResetFormAction - element not allowed: ${t}`))}return this.enableScripting&&(null==(e=this.linkService.eventBus)||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}})),!1}}}r=new WeakSet,i=function(){this.container.setAttribute("data-internal-link","")},a=new WeakSet,s=function(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),at(this,r,i).call(this)};class $ extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str)})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(e),this.container}}class ee extends K{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&("CANVAS"===(null==(t=e.previousSibling)?void 0:t.nodeName)&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){let{isWin:t,isMac:n}=V.FeatureTest.platform;return t&&e.ctrlKey||n&&e.metaKey}_setEventListener(e,t,n,r){t.includes("mouse")?e.addEventListener(t,(e=>{var t;null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(t,(e=>{var t;null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:r(e)}})}))}_setEventListeners(e,t,n){var r;for(let[i,a]of t)("Action"===a||null!=(r=this.data.actions)&&r[a])&&this._setEventListener(e,i,a,n)}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":V.Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t,{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||9,i=e.style,a=e=>Math.round(10*e)/10;if(this.data.multiLine){let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),n=e/(Math.round(e/(V.LINE_FACTOR*r))||1);t=Math.min(r,a(n/V.LINE_FACTOR))}else{let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);t=Math.min(r,a(e/V.LINE_FACTOR))}i.fontSize=`calc(${t}px * var(--scale-factor))`,i.color=V.Util.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(i.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class te extends ee{constructor(e){super(e,{isRenderable:e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,n,r){let i=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){var e,t;let n=this.annotationStorage,r=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){let a=n.getValue(r,{value:this.data.fieldValue}),s=a.value||"",o=n.getValue(r,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));let l=a.formattedValue||(null==(e=this.data.textContent)?void 0:e.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));let h={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=null!=l?l:s,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",null!=l?l:s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Y.add(i),i.setAttribute("data-element-id",r),i.disabled=this.data.readOnly,i.name=this.data.baseFieldName||this.data.fieldName,i.tabIndex=X,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",(e=>{n.setValue(r,{value:e.target.value}),this.setPropertyOnSiblings(i,"value",e.target.value,"value"),h.formattedValue=null})),i.addEventListener("resetform",(e=>{var t;let n=null!=(t=this.data.defaultFieldValue)?t:"";i.value=h.userValue=n,h.formattedValue=null}));let u=e=>{let{formattedValue:t}=h;null!=t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",(e=>{let{target:t}=e;h.userValue&&(t.value=h.userValue),h.lastCommittedValue=t.value,h.commitKey=1})),i.addEventListener("updatefromsandbox",(e=>{this.showElementAndHideCanvas(e.target);let t={value(e){var t;h.userValue=null!=(t=e.detail.value)?t:"",n.setValue(r,{value:h.userValue.toString()}),e.target.value=h.userValue},formattedValue(e){let{formattedValue:t}=e.detail;h.formattedValue=t,null!=t&&e.target!==document.activeElement&&(e.target.value=t),n.setValue(r,{formattedValue:t})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:e=>{var t;let{charLimit:i}=e.detail,{target:a}=e;if(0===i)return void a.removeAttribute("maxLength");a.setAttribute("maxLength",i);let s=h.userValue;!s||s.length<=i||(s=s.slice(0,i),a.value=h.userValue=s,n.setValue(r,{value:s}),null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:s,willCommit:!0,commitKey:1,selStart:a.selectionStart,selEnd:a.selectionEnd}}))}};this._dispatchEventFromSandbox(t,e)})),i.addEventListener("keydown",(e=>{var t;h.commitKey=1;let n=-1;if("Escape"===e.key?n=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(h.commitKey=3):n=2,-1===n)return;let{value:i}=e.target;h.lastCommittedValue!==i&&(h.lastCommittedValue=i,h.userValue=i,null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:i,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));let e=u;u=null,i.addEventListener("blur",(t=>{var n;if(!t.relatedTarget)return;let{value:i}=t.target;h.userValue=i,h.lastCommittedValue!==i&&(null==(n=this.linkService.eventBus)||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:i,willCommit:!0,commitKey:h.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})),e(t)})),null!=(t=this.data.actions)&&t.Keystroke&&i.addEventListener("beforeinput",(e=>{var t;h.lastCommittedValue=null;let{data:n,target:i}=e,{value:a,selectionStart:s,selectionEnd:o}=i,l=s,u=o;switch(e.inputType){case"deleteWordBackward":{let e=a.substring(0,s).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{let e=a.substring(s).match(/^[^\w]*\w*/);e&&(u+=e[0].length);break}case"deleteContentBackward":s===o&&(l-=1);break;case"deleteContentForward":s===o&&(u+=1)}e.preventDefault(),null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r,name:"Keystroke",value:a,change:n||"",willCommit:!1,selStart:l,selEnd:u}})})),this._setEventListeners(i,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(u&&i.addEventListener("blur",u),this.data.comb){let e=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell";return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class ne extends ee{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class ie extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;"string"==typeof r&&(r="Off"!==r,e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let i=document.createElement("input");return Y.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.baseFieldName||t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=X,i.addEventListener("change",(r=>{let{name:i,checked:a}=r.target;for(let r of this._getElementsByName(i,n)){let n=a&&r.exportValue===t.exportValue;r.domElement&&(r.domElement.checked=n),e.setValue(r.id,{value:n})}e.setValue(n,{value:a})})),i.addEventListener("resetform",(e=>{let n=t.defaultFieldValue||"Off";e.target.checked=n===t.exportValue})),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",(t=>{let r={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(n,{value:t.target.checked})}};this._dispatchEventFromSandbox(r,t)})),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class ae extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;"string"==typeof r&&(r=r!==t.buttonValue,e.setValue(n,{value:r}));let i=document.createElement("input");if(Y.add(i),i.setAttribute("data-element-id",n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.baseFieldName||t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=X,i.addEventListener("change",(t=>{let{name:r,checked:i}=t.target;for(let t of this._getElementsByName(r,n))e.setValue(t.id,{value:!1});e.setValue(n,{value:i})})),i.addEventListener("resetform",(e=>{let n=t.defaultFieldValue;e.target.checked=null!=n&&n===t.buttonValue})),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;i.addEventListener("updatefromsandbox",(t=>{let i={value:t=>{let i=r===t.detail.value;for(let r of this._getElementsByName(t.target.name)){let t=i&&r.id===n;r.domElement&&(r.domElement.checked=t),e.setValue(r.id,{value:t})}}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(i,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class se extends Q{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(e.title=this.data.alternativeText);let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class oe extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");Y.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.baseFieldName||this.data.fieldName,r.tabIndex=X;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",(e=>{let t=this.data.defaultFieldValue;for(let e of r.options)e.selected=e.value===t}));for(let e of this.data.options){let t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,n.value.includes(e.exportValue)&&(t.setAttribute("selected",!0),i=!1),r.append(t)}let a=null;if(i){let e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),r.prepend(e),a=()=>{e.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}let s=e=>{let t=e?"value":"textContent",{options:n,multiple:i}=r;return i?Array.prototype.filter.call(n,(e=>e.selected)).map((e=>e[t])):-1===n.selectedIndex?null:n[n.selectedIndex][t]},o=s(!1),l=e=>{let t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",(n=>{let i={value(n){null==a||a();let i=n.detail.value,l=new Set(Array.isArray(i)?i:[i]);for(let e of r.options)e.selected=l.has(e.value);e.setValue(t,{value:s(!0)}),o=s(!1)},multipleSelection(e){r.multiple=!0},remove(n){let i=r.options,a=n.detail.remove;i[a].selected=!1,r.remove(a),i.length>0&&-1===Array.prototype.findIndex.call(i,(e=>e.selected))&&(i[0].selected=!0),e.setValue(t,{value:s(!0),items:l(n)}),o=s(!1)},clear(n){for(;0!==r.length;)r.remove(0);e.setValue(t,{value:null,items:[]}),o=s(!1)},insert(n){let{index:i,displayValue:a,exportValue:h}=n.detail.insert,u=r.children[i],c=document.createElement("option");c.textContent=a,c.value=h,u?u.before(c):r.append(c),e.setValue(t,{value:s(!0),items:l(n)}),o=s(!1)},items(n){let{items:i}=n.detail;for(;0!==r.length;)r.remove(0);for(let e of i){let{displayValue:t,exportValue:n}=e,i=document.createElement("option");i.textContent=t,i.value=n,r.append(i)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:s(!0),items:l(n)}),o=s(!1)},indices(n){let r=new Set(n.detail.indices);for(let e of n.target.options)e.selected=r.has(e.index);e.setValue(t,{value:s(!0)}),o=s(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(i,n)})),r.addEventListener("input",(n=>{var r;let i=s(!0);e.setValue(t,{value:i}),n.preventDefault(),null==(r=this.linkService.eventBus)||r.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(r,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(e=>e.target.value))):r.addEventListener("input",(function(n){e.setValue(t,{value:s(!0)})})),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class le extends K{constructor(e){var t,n,r;let{data:i,elements:a}=e;super(e,{isRenderable:!!(null!=(t=i.titleObj)&&t.str||null!=(n=i.contentsObj)&&n.str||null!=(r=i.richText)&&r.str)}),this.elements=a}render(){this.container.classList.add("popupAnnotation");let e=new he({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let n of this.elements)n.popup=e,t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.join(",")),this.container}}class he{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:s,parent:P,rect:I,parentRect:R,open:L}){Ye(this,S),Ye(this,T),Ye(this,A),Ye(this,o,null),Ye(this,l,at(this,A,C).bind(this)),Ye(this,h,at(this,T,E).bind(this)),Ye(this,u,at(this,S,M).bind(this)),Ye(this,c,null),Ye(this,d,null),Ye(this,p,null),Ye(this,f,null),Ye(this,m,null),Ye(this,g,null),Ye(this,v,!1),Ye(this,y,null),Ye(this,x,null),Ye(this,b,null),Ye(this,_,null),Ye(this,w,!1),xt(this,d,e),xt(this,_,r),xt(this,p,a),xt(this,b,s),xt(this,m,P),xt(this,c,t),xt(this,x,I),xt(this,g,R),xt(this,f,n);let O=j.PDFDateString.toDateObject(i);O&&xt(this,o,P.l10n.get("annotation_date_string",{date:O.toLocaleDateString(),time:O.toLocaleTimeString()})),this.trigger=n.flatMap((e=>e.getElementsToTriggerPopup()));for(let e of this.trigger)e.addEventListener("click",re(this,u)),e.addEventListener("mouseenter",re(this,h)),e.addEventListener("mouseleave",re(this,l));re(this,d).hidden=!0,L&&at(this,S,M).call(this)}render(){if(re(this,y))return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=re(this,m),a=xt(this,y,document.createElement("div"));if(a.className="popup",re(this,c)){let e=a.style.outlineColor=V.Util.makeHexColor(...re(this,c));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?a.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`:a.style.backgroundColor=V.Util.makeHexColor(...re(this,c).map((e=>Math.floor(.7*(255-e)+e))))}let s=document.createElement("span");s.className="header";let l=document.createElement("h1");if(s.append(l),({dir:l.dir,str:l.textContent}=re(this,_)),a.append(s),re(this,o)){let e=document.createElement("span");e.classList.add("popupDate"),re(this,o).then((t=>{e.textContent=t})),s.append(e)}let h=re(this,p),u=re(this,b);if(null==u||!u.str||null!=h&&h.str&&h.str!==u.str){let e=this._formatContents(h);a.append(e)}else q.XfaLayer.render({xfaHtml:u.html,intent:"richText",div:a}),a.lastChild.classList.add("richText","popupContent");let v=!!re(this,g),w=re(this,v?g:x);for(let e of re(this,f))if(!w||null!==V.Util.intersect(e.data.rect,w)){w=e.data.rect,v=!0;break}let S=V.Util.normalizeRect([w[0],e[3]-w[1]+e[1],w[2],e[3]-w[3]+e[1]]),M=v?w[2]-w[0]+5:0,T=S[0]+M,E=S[1],{style:A}=re(this,d);A.left=100*(T-r)/t+"%",A.top=100*(E-i)/n+"%",re(this,d).append(a)}_formatContents({str:e,dir:t}){let n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;let r=e.split(/(?:\r\n?|\n)/);for(let e=0,t=r.length;e<t;++e){let i=r[e];n.append(document.createTextNode(i)),e<t-1&&n.append(document.createElement("br"))}return n}forceHide(){xt(this,w,this.isVisible),re(this,w)&&(re(this,d).hidden=!0)}maybeShow(){re(this,w)&&(xt(this,w,!1),re(this,d).hidden=!1)}get isVisible(){return!1===re(this,d).hidden}}o=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,x=new WeakMap,b=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakSet,M=function(){xt(this,v,!re(this,v)),re(this,v)?(at(this,T,E).call(this),re(this,d).addEventListener("click",re(this,u))):(at(this,A,C).call(this),re(this,d).removeEventListener("click",re(this,u)))},T=new WeakSet,E=function(){re(this,y)||this.render(),this.isVisible?re(this,v)&&re(this,d).classList.add("focused"):(re(this,d).hidden=!1,re(this,d).style.zIndex=parseInt(re(this,d).style.zIndex)+1e3)},A=new WeakSet,C=function(){re(this,d).classList.remove("focused"),!re(this,v)&&(re(this,d).hidden=!0,re(this,d).style.zIndex=parseInt(re(this,d).style.zIndex)-1e3)};class ue extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),this.textContent=e.data.textContent,this.annotationEditorType=V.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return this.data.popupRef||this._createPopup(),this.container}}t.FreeTextAnnotationElement=ue;class ce extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),Ye(this,P,null)}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:n}=Z(e.rect),r=this.svgFactory.create(t,n,!0),i=xt(this,P,this.svgFactory.createElement("svg:line"));return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),r.append(i),this.container.append(r),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return re(this,P)}addHighlightArea(){this.container.classList.add("highlightArea")}}P=new WeakMap;class de extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),Ye(this,I,null)}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:n}=Z(e.rect),r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,a=xt(this,I,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",i/2),a.setAttribute("y",i/2),a.setAttribute("width",t-i),a.setAttribute("height",n-i),a.setAttribute("stroke-width",i||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return re(this,I)}addHighlightArea(){this.container.classList.add("highlightArea")}}I=new WeakMap;class pe extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),Ye(this,R,null)}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:n}=Z(e.rect),r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,a=xt(this,R,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",t/2),a.setAttribute("cy",n/2),a.setAttribute("rx",t/2-i/2),a.setAttribute("ry",n/2-i/2),a.setAttribute("stroke-width",i||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return re(this,R)}addHighlightArea(){this.container.classList.add("highlightArea")}}R=new WeakMap;class fe extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),Ye(this,L,null),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let e=this.data,{width:t,height:n}=Z(e.rect),r=this.svgFactory.create(t,n,!0),i=[];for(let t of e.vertices){let n=t.x-e.rect[0],r=e.rect[3]-t.y;i.push(n+","+r)}i=i.join(" ");let a=xt(this,L,this.svgFactory.createElement(this.svgElementName));return a.setAttribute("points",i),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),e.popupRef||this._createPopup(a,e),this.container}getElementsToTriggerPopup(){return re(this,L)}addHighlightArea(){this.container.classList.add("highlightArea")}}L=new WeakMap;class me extends fe{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ge extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class ve extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0}),Ye(this,O,[]),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=V.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);let e=this.data,{width:t,height:n}=Z(e.rect),r=this.svgFactory.create(t,n,!0);for(let t of e.inkLists){let n=[];for(let r of t){let t=r.x-e.rect[0],i=e.rect[3]-r.y;n.push(`${t},${i}`)}n=n.join(" ");let i=this.svgFactory.createElement(this.svgElementName);re(this,O).push(i),i.setAttribute("points",n),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),e.popupRef||this._createPopup(i,e),r.append(i)}return this.container.append(r),this.container}getElementsToTriggerPopup(){return re(this,O)}addHighlightArea(){this.container.classList.add("highlightArea")}}O=new WeakMap,t.InkAnnotationElement=ve;class ye extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class xe extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class be extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class _e extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class we extends K{constructor(e){var t,n,r;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(n=e.data.contentsObj)&&n.str||null!=(r=e.data.richText)&&r.str),ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class Se extends K{constructor(e){var t;super(e,{isRenderable:!0}),Ye(this,D,null);let{filename:n,content:r}=this.data.file;this.filename=(0,j.getFilenameFromUrl)(n,!0),this.content=r,null==(t=this.linkService.eventBus)||t.dispatch("fileattachmentannotation",{source:this,filename:n,content:r})}render(){var e,t;let n;return this.container.classList.add("fileAttachmentAnnotation"),this.data.hasAppearance?n=document.createElement("div"):(n=document.createElement("img"),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),n.classList.add("popupTriggerArea"),n.addEventListener("dblclick",this._download.bind(this)),xt(this,D,n),!this.data.popupRef&&(null!=(e=this.data.titleObj)&&e.str||null!=(t=this.data.contentsObj)&&t.str||this.data.richText)&&this._createPopup(),this.container.append(n),this.container}getElementsToTriggerPopup(){return re(this,D)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var e;null==(e=this.downloadManager)||e.openOrDownloadData(this.container,this.content,this.filename)}}D=new WeakMap,k=new WeakMap,N=new WeakMap,F=new WeakMap,U=new WeakSet,B=function(e,t){var n;let r=e.firstChild||e;r.id=`${j.AnnotationPrefix}${t}`,this.div.append(e),null==(n=re(this,k))||n.moveElementInDOM(this.div,e,r,!1)},z=new WeakSet,H=function(){if(!re(this,N))return;let e=this.div;for(let[t,n]of re(this,N)){let r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;let{firstChild:i}=r;i?"CANVAS"===i.nodeName?i.replaceWith(n):i.before(n):r.append(n)}re(this,N).clear()},t.AnnotationLayer=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:r,l10n:i,page:a,viewport:s}){Ye(this,U),Ye(this,z),Ye(this,k,null),Ye(this,N,null),Ye(this,F,new Map),this.div=e,xt(this,k,t),xt(this,N,r),this.l10n=i,this.page=a,this.viewport=s,this.zIndex=0;let{NullL10n:o}=n(32);this.l10n||(this.l10n=o)}render(e){return Et(this,null,(function*(){let{annotations:t}=e,n=this.div;(0,j.setLayerDimensions)(n,this.viewport);let r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new j.DOMSVGFactory,annotationStorage:e.annotationStorage||new G.AnnotationStorage,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let e of t){if(e.noHTML)continue;let t=e.annotationType===V.AnnotationType.POPUP;if(t){let t=r.get(e.id);if(!t)continue;i.elements=t}else{let{width:t,height:n}=Z(e.rect);if(t<=0||n<=0)continue}i.data=e;let n=J.create(i);if(!n.isRenderable)continue;if(!t&&e.popupRef){let t=r.get(e.popupRef);t?t.push(n):r.set(e.popupRef,[n])}n.annotationEditorType>0&&re(this,F).set(n.data.id,n);let a=n.render();if(e.hidden&&(a.style.visibility="hidden"),Array.isArray(a))for(let t of a)at(this,U,B).call(this,t,e.id);else at(this,U,B).call(this,a,e.id)}at(this,z,H).call(this),yield this.l10n.translate(n)}))}update({viewport:e}){let t=this.div;this.viewport=e,(0,j.setLayerDimensions)(t,{rotation:e.rotation}),at(this,z,H).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(re(this,F).values())}getEditableAnnotation(e){return re(this,F).get(e)}}},(e,t)=>{function n(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0,t.ColorConverters=class{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_HTML([e]){let t=n(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_HTML([e,t,r]){return`#${n(e)}${n(t)}${n(r)}`}static T_HTML(){return"#00000000"}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let r=1-e,i=1-t,a=1-n;return["CMYK",r,i,a,Math.min(r,i,a)]}}},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var r=n(19);t.XfaLayer=class{static setupStorage(e,t,n,r,i){let a=r.getValue(t,{value:null});switch(n.name){case"textarea":if(null!==a.value&&(e.textContent=a.value),"print"===i)break;e.addEventListener("input",(e=>{r.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(a.value===n.attributes.xfaOn?e.setAttribute("checked",!0):a.value===n.attributes.xfaOff&&e.removeAttribute("checked"),"print"===i)break;e.addEventListener("change",(e=>{r.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==a.value&&e.setAttribute("value",a.value),"print"===i)break;e.addEventListener("input",(e=>{r.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==a.value)for(let e of n.children)e.attributes.value===a.value&&(e.attributes.selected=!0);e.addEventListener("input",(e=>{let n=e.target.options,i=-1===n.selectedIndex?"":n[n.selectedIndex].value;r.setValue(t,{value:i})}))}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){let{attributes:a}=t,s=e instanceof HTMLAnchorElement;"radio"===a.type&&(a.name=`${a.name}-${r}`);for(let[t,n]of Object.entries(a))if(null!=n)switch(t){case"class":n.length&&e.setAttribute(t,n.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",n);break;case"style":Object.assign(e.style,n);break;case"textContent":e.textContent=n;break;default:(!s||"href"!==t&&"newWindow"!==t)&&e.setAttribute(t,n)}s&&i.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){var t;let n=e.annotationStorage,i=e.linkService,a=e.xfaHtml,s=e.intent||"display",o=document.createElement(a.name);a.attributes&&this.setAttributes({html:o,element:a,intent:s,linkService:i});let l=[[a,-1,o]],h=e.div;if(h.append(o),e.viewport){let t=`matrix(${e.viewport.transform.join(",")})`;h.style.transform=t}"richText"!==s&&h.setAttribute("class","xfaLayer xfaFont");let u=[];for(;l.length>0;){let[e,a,o]=l.at(-1);if(a+1===e.children.length){l.pop();continue}let h=e.children[++l.at(-1)[1]];if(null===h)continue;let c,{name:d}=h;if("#text"!==d){if(c=null!=(t=null==h?void 0:h.attributes)&&t.xmlns?document.createElementNS(h.attributes.xmlns,d):document.createElement(d),o.append(c),h.attributes&&this.setAttributes({html:c,element:h,storage:n,intent:s,linkService:i}),h.children&&h.children.length>0)l.push([h,-1,c]);else if(h.value){let e=document.createTextNode(h.value);r.XfaText.shouldBuildText(d)&&u.push(e),c.append(e)}}else{let e=document.createTextNode(h.value);u.push(e),o.append(e)}}for(let e of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullL10n=void 0,t.getL10nFallback=r;let n={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} Ã {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} Ã {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typingâ¦",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};function r(e,t){switch(e){case"find_match_count":e=`find_match_count[${1===t.total?"one":"other"}]`;break;case"find_match_count_limit":e=`find_match_count_limit[${1===t.limit?"one":"other"}]`}return n[e]||""}n.print_progress_percent="{{progress}}%";let i={getLanguage(){return Et(this,null,(function*(){return"en-us"}))},getDirection(){return Et(this,null,(function*(){return"ltr"}))},get(e){return Et(this,arguments,(function*(e,t=null,n=r(e,t)){return function(e,t){return t?e.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,((e,n)=>n in t?t[n]:"{{"+n+"}}")):e}(n,t)}))},translate(e){return Et(this,null,(function*(){}))}};t.NullL10n=i},(e,t,n)=>{var r,i,a,s,o,l,h,u,c,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,A,C,P,I,R,L,O,D,k,N,F,U,B,z,H,V,j,G,W,q,X,Y,Z,J,K,Q,$,ee,te,ne,ie,ae,se,oe,le,he,ue,ce,de,pe,fe,me,ge,ve,ye,xe;Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0;var be=n(1),_e=n(4),we=n(29),Se=n(5);let Me=16,Te=class extends _e.AnnotationEditor{constructor(e){super(Ki(oi({},e),{name:"inkEditor"})),Ye(this,x),Ye(this,_),Ye(this,S),Ye(this,T),Ye(this,A),Ye(this,P),Ye(this,R),Ye(this,O),Ye(this,k),Ye(this,F),Ye(this,B),Ye(this,H),Ye(this,j),Ye(this,W),Ye(this,X),Ye(this,Z),Ye(this,K),Ye(this,$),Ye(this,te),Ye(this,ue),Ye(this,de),Ye(this,fe),Ye(this,ge),Ye(this,ye),Ye(this,r,0),Ye(this,i,0),Ye(this,a,0),Ye(this,s,this.canvasContextMenu.bind(this)),Ye(this,o,this.canvasPointermove.bind(this)),Ye(this,l,this.canvasPointerleave.bind(this)),Ye(this,h,this.canvasPointerup.bind(this)),Ye(this,u,this.canvasPointerdown.bind(this)),Ye(this,c,new Path2D),Ye(this,d,!1),Ye(this,p,!1),Ye(this,f,!1),Ye(this,m,null),Ye(this,g,0),Ye(this,v,0),Ye(this,y,null),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(e){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map((t=>[t,e.get(t)])))}static updateDefaultParams(e,t){switch(e){case be.AnnotationEditorParamsType.INK_THICKNESS:Te._defaultThickness=t;break;case be.AnnotationEditorParamsType.INK_COLOR:Te._defaultColor=t;break;case be.AnnotationEditorParamsType.INK_OPACITY:Te._defaultOpacity=t/100}}updateParams(e,t){switch(e){case be.AnnotationEditorParamsType.INK_THICKNESS:at(this,x,b).call(this,t);break;case be.AnnotationEditorParamsType.INK_COLOR:at(this,_,w).call(this,t);break;case be.AnnotationEditorParamsType.INK_OPACITY:at(this,S,M).call(this,t)}}static get defaultPropertiesToUpdate(){return[[be.AnnotationEditorParamsType.INK_THICKNESS,Te._defaultThickness],[be.AnnotationEditorParamsType.INK_COLOR,Te._defaultColor||_e.AnnotationEditor._defaultLineColor],[be.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*Te._defaultOpacity)]]}get propertiesToUpdate(){var e;return[[be.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Te._defaultThickness],[be.AnnotationEditorParamsType.INK_COLOR,this.color||Te._defaultColor||_e.AnnotationEditor._defaultLineColor],[be.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(null!=(e=this.opacity)?e:Te._defaultOpacity))]]}rebuild(){super.rebuild(),null!==this.div&&(this.canvas||(at(this,X,Y).call(this),at(this,Z,J).call(this)),this.isAttachedToDOM||(this.parent.add(this),at(this,K,Q).call(this)),at(this,ge,ve).call(this))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,re(this,m).disconnect(),xt(this,m,null),super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){let[e,t]=this.parentDimensions,n=this.width*e,r=this.height*t;this.setDimensions(n,r)}enableEditMode(){re(this,d)||null===this.canvas||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",re(this,u)))}disableEditMode(){!this.isInEditMode()||null===this.canvas||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",re(this,u)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}commit(){re(this,d)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),xt(this,d,!0),this.div.classList.add("disabled"),at(this,ge,ve).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(e){super.focusin(e),this.enableEditMode()}canvasPointerdown(e){0!==e.button||!this.isInEditMode()||re(this,d)||(this.setInForeground(),e.preventDefault(),"mouse"!==e.type&&this.div.focus(),at(this,P,I).call(this,e.offsetX,e.offsetY))}canvasContextMenu(e){e.preventDefault()}canvasPointermove(e){e.preventDefault(),at(this,R,L).call(this,e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),at(this,W,q).call(this,e)}canvasPointerleave(e){at(this,W,q).call(this,e)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),Te._l10nPromise.get("editor_ink2_aria_label").then((e=>{var t;return null==(t=this.div)?void 0:t.setAttribute("aria-label",e)}));let[n,r,i,a]=at(this,T,E).call(this);if(this.setAt(n,r,0,0),this.setDims(i,a),at(this,X,Y).call(this),this.width){let[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),xt(this,f,!0),at(this,K,Q).call(this),this.setDims(this.width*n,this.height*r),at(this,j,G).call(this),at(this,ye,xe).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return at(this,Z,J).call(this),this.div}setDimensions(e,t){let n=Math.round(e),i=Math.round(t);if(re(this,g)===n&&re(this,v)===i)return;xt(this,g,n),xt(this,v,i),this.canvas.style.visibility="hidden",re(this,r)&&Math.abs(re(this,r)-e/t)>.01&&(t=Math.ceil(e/re(this,r)),this.setDims(e,t));let[a,s]=this.parentDimensions;this.width=e/a,this.height=t/s,re(this,d)&&at(this,$,ee).call(this,e,t),at(this,K,Q).call(this),at(this,j,G).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(e,t,n){var s,o,l;if(e instanceof we.InkAnnotationElement)return null;let h=super.deserialize(e,t,n);h.thickness=e.thickness,h.color=be.Util.makeHexColor(...e.color),h.opacity=e.opacity;let[u,c]=h.pageDimensions,p=h.width*u,f=h.height*c,m=h.parentScale,y=e.thickness/2;xt(h,r,p/f),xt(h,d,!0),xt(h,g,Math.round(p)),xt(h,v,Math.round(f));let{paths:x,rect:b,rotation:_}=e;for(let{bezier:e}of x){e=at(s=Te,le,he).call(s,e,b,_);let t=[];h.paths.push(t);let n=m*(e[0]-y),r=m*(e[1]-y);for(let i=2,a=e.length;i<a;i+=6){let a=m*(e[i]-y),s=m*(e[i+1]-y),o=m*(e[i+2]-y),l=m*(e[i+3]-y),h=m*(e[i+4]-y),u=m*(e[i+5]-y);t.push([[n,r],[a,s],[o,l],[h,u]]),n=h,r=u}let i=at(this,ie,ae).call(this,t);h.bezierPath2D.push(i)}let w=at(o=h,de,pe).call(o);return xt(h,a,Math.max(Me,w[2]-w[0])),xt(h,i,Math.max(Me,w[3]-w[1])),at(l=h,$,ee).call(l,p,f),h}serialize(){if(this.isEmpty())return null;let e=this.getRect(0,0),t=_e.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:be.AnnotationEditorType.INK,color:t,thickness:this.thickness,opacity:this.opacity,paths:at(this,ue,ce).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation}}},Ee=Te;r=new WeakMap,i=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,x=new WeakSet,b=function(e){let t=this.thickness;this.addCommands({cmd:()=>{this.thickness=e,at(this,ge,ve).call(this)},undo:()=>{this.thickness=t,at(this,ge,ve).call(this)},mustExec:!0,type:be.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},_=new WeakSet,w=function(e){let t=this.color;this.addCommands({cmd:()=>{this.color=e,at(this,j,G).call(this)},undo:()=>{this.color=t,at(this,j,G).call(this)},mustExec:!0,type:be.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},S=new WeakSet,M=function(e){e/=100;let t=this.opacity;this.addCommands({cmd:()=>{this.opacity=e,at(this,j,G).call(this)},undo:()=>{this.opacity=t,at(this,j,G).call(this)},mustExec:!0,type:be.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},T=new WeakSet,E=function(){let{parentRotation:e,parentDimensions:[t,n]}=this;switch(e){case 90:return[0,n,n,t];case 180:return[t,n,t,n];case 270:return[t,0,n,t];default:return[0,0,t,n]}},A=new WeakSet,C=function(){let{ctx:e,color:t,opacity:n,thickness:r,parentScale:i,scaleFactor:a}=this;e.lineWidth=r*i/a,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${t}${(0,Se.opacityToHex)(n)}`},P=new WeakSet,I=function(e,t){this.canvas.addEventListener("contextmenu",re(this,s)),this.canvas.addEventListener("pointerleave",re(this,l)),this.canvas.addEventListener("pointermove",re(this,o)),this.canvas.addEventListener("pointerup",re(this,h)),this.canvas.removeEventListener("pointerdown",re(this,u)),this.isEditing=!0,re(this,f)||(xt(this,f,!0),at(this,K,Q).call(this),this.thickness||(this.thickness=Te._defaultThickness),this.color||(this.color=Te._defaultColor||_e.AnnotationEditor._defaultLineColor),null!=this.opacity||(this.opacity=Te._defaultOpacity)),this.currentPath.push([e,t]),xt(this,p,!1),at(this,A,C).call(this),xt(this,y,(()=>{at(this,F,U).call(this),re(this,y)&&window.requestAnimationFrame(re(this,y))})),window.requestAnimationFrame(re(this,y))},R=new WeakSet,L=function(e,t){let[n,r]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===n&&t===r)return;let i=this.currentPath,a=re(this,c);if(i.push([e,t]),xt(this,p,!0),i.length<=2)return a.moveTo(...i[0]),void a.lineTo(e,t);3===i.length&&(xt(this,c,a=new Path2D),a.moveTo(...i[0])),at(this,B,z).call(this,a,...i.at(-3),...i.at(-2),e,t)},O=new WeakSet,D=function(){if(0===this.currentPath.length)return;let e=this.currentPath.at(-1);re(this,c).lineTo(...e)},k=new WeakSet,N=function(e,t){let n;if(xt(this,y,null),e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height),at(this,R,L).call(this,e,t),at(this,O,D).call(this),1!==this.currentPath.length)n=at(this,H,V).call(this);else{let r=[e,t];n=[[r,r.slice(),r.slice(),r]]}let r=re(this,c),i=this.currentPath;this.currentPath=[],xt(this,c,new Path2D),this.addCommands({cmd:()=>{this.allRawPaths.push(i),this.paths.push(n),this.bezierPath2D.push(r),this.rebuild()},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(at(this,X,Y).call(this),at(this,Z,J).call(this)),at(this,ge,ve).call(this))},mustExec:!0})},F=new WeakSet,U=function(){if(!re(this,p))return;xt(this,p,!1);Math.ceil(this.thickness*this.parentScale);let e=this.currentPath.slice(-3),t=e.map((e=>e[0])),n=e.map((e=>e[1])),{ctx:r}=(Math.min(...t),Math.max(...t),Math.min(...n),Math.max(...n),this);r.save(),r.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e of this.bezierPath2D)r.stroke(e);r.stroke(re(this,c)),r.restore()},B=new WeakSet,z=function(e,t,n,r,i,a,s){let o=(t+r)/2,l=(n+i)/2,h=(r+a)/2,u=(i+s)/2;e.bezierCurveTo(o+2*(r-o)/3,l+2*(i-l)/3,h+2*(r-h)/3,u+2*(i-u)/3,h,u)},H=new WeakSet,V=function(){let e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];let t,n=[],[r,i]=e[0];for(t=1;t<e.length-2;t++){let[a,s]=e[t],[o,l]=e[t+1],h=(a+o)/2,u=(s+l)/2,c=[r+2*(a-r)/3,i+2*(s-i)/3],d=[h+2*(a-h)/3,u+2*(s-u)/3];n.push([[r,i],c,d,[h,u]]),[r,i]=[h,u]}let[a,s]=e[t],[o,l]=e[t+1],h=[r+2*(a-r)/3,i+2*(s-i)/3],u=[o+2*(a-o)/3,l+2*(s-l)/3];return n.push([[r,i],h,u,[o,l]]),n},j=new WeakSet,G=function(){if(this.isEmpty())return void at(this,te,ne).call(this);at(this,A,C).call(this);let{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),at(this,te,ne).call(this);for(let e of this.bezierPath2D)t.stroke(e)},W=new WeakSet,q=function(e){this.canvas.removeEventListener("pointerleave",re(this,l)),this.canvas.removeEventListener("pointermove",re(this,o)),this.canvas.removeEventListener("pointerup",re(this,h)),this.canvas.addEventListener("pointerdown",re(this,u)),setTimeout((()=>{this.canvas.removeEventListener("contextmenu",re(this,s))}),10),at(this,k,N).call(this,e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()},X=new WeakSet,Y=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Te._l10nPromise.get("editor_ink_canvas_aria_label").then((e=>{var t;return null==(t=this.canvas)?void 0:t.setAttribute("aria-label",e)})),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Z=new WeakSet,J=function(){xt(this,m,new ResizeObserver((e=>{let t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)}))),re(this,m).observe(this.div)},K=new WeakSet,Q=function(){if(!re(this,f))return;let[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),at(this,te,ne).call(this)},$=new WeakSet,ee=function(e,t){let n=at(this,fe,me).call(this),r=(e-n)/re(this,a),s=(t-n)/re(this,i);this.scaleFactor=Math.min(r,s)},te=new WeakSet,ne=function(){let e=at(this,fe,me).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)},ie=new WeakSet,ae=function(e){let t=new Path2D;for(let n=0,r=e.length;n<r;n++){let[r,i,a,s]=e[n];0===n&&t.moveTo(...r),t.bezierCurveTo(i[0],i[1],a[0],a[1],s[0],s[1])}return t},se=new WeakSet,oe=function(e,t,n){let[r,i,a,s]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]+=r,e[t+1]=s-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){let n=e[t];e[t]=e[t+1]+r,e[t+1]=n+i}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=a-e[t],e[t+1]+=i;break;case 270:for(let t=0,n=e.length;t<n;t+=2){let n=e[t];e[t]=a-e[t+1],e[t+1]=s-n}break;default:throw new Error("Invalid rotation")}return e},le=new WeakSet,he=function(e,t,n){let[r,i,a,s]=t;switch(n){case 0:for(let t=0,n=e.length;t<n;t+=2)e[t]-=r,e[t+1]=s-e[t+1];break;case 90:for(let t=0,n=e.length;t<n;t+=2){let n=e[t];e[t]=e[t+1]-i,e[t+1]=n-r}break;case 180:for(let t=0,n=e.length;t<n;t+=2)e[t]=a-e[t],e[t+1]-=i;break;case 270:for(let t=0,n=e.length;t<n;t+=2){let n=e[t];e[t]=s-e[t+1],e[t+1]=a-n}break;default:throw new Error("Invalid rotation")}return e},ue=new WeakSet,ce=function(e,t,n,r){var i,a;let s=[],o=this.thickness/2,l=e*t+o,h=e*n+o;for(let t of this.paths){let n=[],o=[];for(let r=0,i=t.length;r<i;r++){let[a,s,u,c]=t[r],d=e*a[0]+l,p=e*a[1]+h,f=e*s[0]+l,m=e*s[1]+h,g=e*u[0]+l,v=e*u[1]+h,y=e*c[0]+l,x=e*c[1]+h;0===r&&(n.push(d,p),o.push(d,p)),n.push(f,m,g,v,y,x),o.push(f,m),r===i-1&&o.push(y,x)}s.push({bezier:at(i=Te,se,oe).call(i,n,r,this.rotation),points:at(a=Te,se,oe).call(a,o,r,this.rotation)})}return s},de=new WeakSet,pe=function(){let e=1/0,t=-1/0,n=1/0,r=-1/0;for(let i of this.paths)for(let[a,s,o,l]of i){let i=be.Util.bezierBoundingBox(...a,...s,...o,...l);e=Math.min(e,i[0]),n=Math.min(n,i[1]),t=Math.max(t,i[2]),r=Math.max(r,i[3])}return[e,n,t,r]},fe=new WeakSet,me=function(){return re(this,d)?Math.ceil(this.thickness*this.parentScale):0},ge=new WeakSet,ve=function(e=!1){if(this.isEmpty())return;if(!re(this,d))return void at(this,j,G).call(this);let t=at(this,de,pe).call(this),n=at(this,fe,me).call(this);xt(this,a,Math.max(Me,t[2]-t[0])),xt(this,i,Math.max(Me,t[3]-t[1]));let s=Math.ceil(n+re(this,a)*this.scaleFactor),o=Math.ceil(n+re(this,i)*this.scaleFactor),[l,h]=this.parentDimensions;this.width=s/l,this.height=o/h,xt(this,r,s/o),at(this,ye,xe).call(this);let u=this.translationX,c=this.translationY;this.translationX=-t[0],this.translationY=-t[1],at(this,K,Q).call(this),at(this,j,G).call(this),xt(this,g,s),xt(this,v,o),this.setDims(s,o);let p=e?n/this.scaleFactor/2:0;this.translate(u-this.translationX-p,c-this.translationY-p)},ye=new WeakSet,xe=function(){let{style:e}=this.div;re(this,r)>=1?(e.minHeight="16px",e.minWidth=`${Math.round(re(this,r)*Me)}px`):(e.minWidth="16px",e.minHeight=`${Math.round(Me/re(this,r))}px`)},Ye(Ee,ie),Ye(Ee,se),Ye(Ee,le),li(Ee,"_defaultColor",null),li(Ee,"_defaultOpacity",1),li(Ee,"_defaultThickness",1),li(Ee,"_l10nPromise"),li(Ee,"_type","ink"),t.InkEditor=Ee},(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var r=n(6),i=n(1),a=n(10);let s="normal",o="normal",l="#000000",h=["butt","round","square"],u=["miter","round","bevel"],c=function(e,t="",n=!1){if(URL.createObjectURL&&"undefined"!=typeof Blob&&!n)return URL.createObjectURL(new Blob([e],{type:t}));let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=`data:${t};base64,`;for(let t=0,n=e.length;t<n;t+=3){let a=255&e[t],s=255&e[t+1],o=255&e[t+2];i+=r[a>>2]+r[(3&a)<<4|s>>4]+r[t+1<n?(15&s)<<2|o>>6:64]+r[t+2<n?63&o:64]}return i},d=function(){let e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let e=0;e<256;e++){let n=e;for(let e=0;e<8;e++)n=1&n?3988292384^n>>1&2147483647:n>>1&2147483647;t[e]=n}function n(e,n,r,i){let a=i,s=n.length;r[a]=s>>24&255,r[a+1]=s>>16&255,r[a+2]=s>>8&255,r[a+3]=255&s,a+=4,r[a]=255&e.charCodeAt(0),r[a+1]=255&e.charCodeAt(1),r[a+2]=255&e.charCodeAt(2),r[a+3]=255&e.charCodeAt(3),a+=4,r.set(n,a),a+=n.length;let o=function(e,n,r){let i=-1;for(let a=n;a<r;a++){let n=255&(i^e[a]);i=i>>>8^t[n]}return-1^i}(r,i+4,a);r[a]=o>>24&255,r[a+1]=o>>16&255,r[a+2]=o>>8&255,r[a+3]=255&o}function r(e){let t=e.length,n=65535,r=Math.ceil(t/n),i=new Uint8Array(2+t+5*r+4),a=0;i[a++]=120,i[a++]=156;let s=0;for(;t>n;)i[a++]=0,i[a++]=255,i[a++]=255,i[a++]=0,i[a++]=0,i.set(e.subarray(s,s+n),a),a+=n,s+=n,t-=n;i[a++]=1,i[a++]=255&t,i[a++]=t>>8&255,i[a++]=255&~t,i[a++]=(65535&~t)>>8&255,i.set(e.subarray(s),a),a+=e.length-s;let o=function(e,t,n){let r=1,i=0;for(let a=t;a<n;++a)r=(r+(255&e[a]))%65521,i=(i+r)%65521;return i<<16|r}(e,0,e.length);return i[a++]=o>>24&255,i[a++]=o>>16&255,i[a++]=o>>8&255,i[a++]=255&o,i}function s(t,s,o,l){let h,u,d,p=t.width,f=t.height,m=t.data;switch(s){case i.ImageKind.GRAYSCALE_1BPP:u=0,h=1,d=p+7>>3;break;case i.ImageKind.RGB_24BPP:u=2,h=8,d=3*p;break;case i.ImageKind.RGBA_32BPP:u=6,h=8,d=4*p;break;default:throw new Error("invalid format")}let g=new Uint8Array((1+d)*f),v=0,y=0;for(let e=0;e<f;++e)g[v++]=0,g.set(m.subarray(y,y+d),v),y+=d,v+=d;if(s===i.ImageKind.GRAYSCALE_1BPP&&l){v=0;for(let e=0;e<f;e++){v++;for(let e=0;e<d;e++)g[v++]^=255}}let x=new Uint8Array([p>>24&255,p>>16&255,p>>8&255,255&p,f>>24&255,f>>16&255,f>>8&255,255&f,h,u,0,0,0]),b=function(e){if(!a.isNodeJS)return r(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);let n=hpe().deflateSync(t,{level:9});return n instanceof Uint8Array?n:new Uint8Array(n)}catch(e){(0,i.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return r(e)}(g),_=e.length+36+x.length+b.length,w=new Uint8Array(_),S=0;return w.set(e,S),S+=e.length,n("IHDR",x,w,S),S+=12+x.length,n("IDATA",b,w,S),S+=12+b.length,n("IEND",new Uint8Array(0),w,S),c(w,"image/png",o)}return function(e,t,n){return s(e,void 0===e.kind?i.ImageKind.GRAYSCALE_1BPP:e.kind,t,n)}}();class p{constructor(){this.fontSizeScale=1,this.fontWeight=o,this.fontSize=0,this.textMatrix=i.IDENTITY_MATRIX,this.fontMatrix=i.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=i.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function f(e){if(Number.isInteger(e))return e.toString();let t=e.toFixed(10),n=t.length-1;if("0"!==t[n])return t;do{n--}while("0"===t[n]);return t.substring(0,"."===t[n]?n:n+1)}function m(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${f(e[0])} ${f(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2])return`rotate(${f(180*Math.acos(e[0])/Math.PI)})`}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${f(e[4])} ${f(e[5])})`;return`matrix(${f(e[0])} ${f(e[1])} ${f(e[2])} ${f(e[3])} ${f(e[4])} ${f(e[5])})`}let g=0,v=0,y=0;t.SVGGraphics=class{constructor(e,t,n=!1){(0,r.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new r.DOMSVGFactory,this.current=new p,this.transformMatrix=i.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!n,this._operatorIdMapping=[];for(let e in i.OPS)this._operatorIdMapping[i.OPS[e]]=e}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}save(){this.transformStack.push(this.transformMatrix);let e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){let t=e.fnArray,n=e.argsArray;for(let e=0,r=t.length;e<r;e++)if(t[e]===i.OPS.dependency)for(let t of n[e]){let e=t.startsWith("g_")?this.commonObjs:this.objs,n=new Promise((n=>{e.get(t,n)}));this.current.dependencies.push(n)}return Promise.all(this.current.dependencies)}transform(e,t,n,r,a,s){let o=[e,t,n,r,a,s];this.transformMatrix=i.Util.transform(this.transformMatrix,o),this.tgrp=null}getSVG(e,t){this.viewport=t;let n=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=i.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),n)))}convertOpList(e){let t=this._operatorIdMapping,n=e.argsArray,r=e.fnArray,i=[];for(let e=0,a=r.length;e<a;e++){let a=r[e];i.push({fnId:a,fn:t[a],args:n[e]})}return function(e){let t=[],n=[];for(let r of e)"save"!==r.fn?"restore"===r.fn?t=n.pop():t.push(r):(t.push({fnId:92,fn:"group",items:[]}),n.push(t),t=t.at(-1).items);return t}(i)}executeOpTree(e){for(let t of e){let e=t.fn,n=t.fnId,r=t.args;switch(0|n){case i.OPS.beginText:this.beginText();break;case i.OPS.dependency:break;case i.OPS.setLeading:this.setLeading(r);break;case i.OPS.setLeadingMoveText:this.setLeadingMoveText(r[0],r[1]);break;case i.OPS.setFont:this.setFont(r);break;case i.OPS.showText:case i.OPS.showSpacedText:this.showText(r[0]);break;case i.OPS.endText:this.endText();break;case i.OPS.moveText:this.moveText(r[0],r[1]);break;case i.OPS.setCharSpacing:this.setCharSpacing(r[0]);break;case i.OPS.setWordSpacing:this.setWordSpacing(r[0]);break;case i.OPS.setHScale:this.setHScale(r[0]);break;case i.OPS.setTextMatrix:this.setTextMatrix(r[0],r[1],r[2],r[3],r[4],r[5]);break;case i.OPS.setTextRise:this.setTextRise(r[0]);break;case i.OPS.setTextRenderingMode:this.setTextRenderingMode(r[0]);break;case i.OPS.setLineWidth:this.setLineWidth(r[0]);break;case i.OPS.setLineJoin:this.setLineJoin(r[0]);break;case i.OPS.setLineCap:this.setLineCap(r[0]);break;case i.OPS.setMiterLimit:this.setMiterLimit(r[0]);break;case i.OPS.setFillRGBColor:this.setFillRGBColor(r[0],r[1],r[2]);break;case i.OPS.setStrokeRGBColor:this.setStrokeRGBColor(r[0],r[1],r[2]);break;case i.OPS.setStrokeColorN:this.setStrokeColorN(r);break;case i.OPS.setFillColorN:this.setFillColorN(r);break;case i.OPS.shadingFill:this.shadingFill(r[0]);break;case i.OPS.setDash:this.setDash(r[0],r[1]);break;case i.OPS.setRenderingIntent:this.setRenderingIntent(r[0]);break;case i.OPS.setFlatness:this.setFlatness(r[0]);break;case i.OPS.setGState:this.setGState(r[0]);break;case i.OPS.fill:this.fill();break;case i.OPS.eoFill:this.eoFill();break;case i.OPS.stroke:this.stroke();break;case i.OPS.fillStroke:this.fillStroke();break;case i.OPS.eoFillStroke:this.eoFillStroke();break;case i.OPS.clip:this.clip("nonzero");break;case i.OPS.eoClip:this.clip("evenodd");break;case i.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case i.OPS.paintImageXObject:this.paintImageXObject(r[0]);break;case i.OPS.paintInlineImageXObject:this.paintInlineImageXObject(r[0]);break;case i.OPS.paintImageMaskXObject:this.paintImageMaskXObject(r[0]);break;case i.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(r[0],r[1]);break;case i.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case i.OPS.closePath:this.closePath();break;case i.OPS.closeStroke:this.closeStroke();break;case i.OPS.closeFillStroke:this.closeFillStroke();break;case i.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case i.OPS.nextLine:this.nextLine();break;case i.OPS.transform:this.transform(r[0],r[1],r[2],r[3],r[4],r[5]);break;case i.OPS.constructPath:this.constructPath(r[0],r[1]);break;case i.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,i.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,n,r,i,a){let s=this.current;s.textMatrix=s.lineMatrix=[e,t,n,r,i,a],s.textMatrixScale=Math.hypot(e,t),s.x=s.lineX=0,s.y=s.lineY=0,s.xcoords=[],s.ycoords=[],s.tspan=this.svgFactory.createElement("svg:tspan"),s.tspan.setAttributeNS(null,"font-family",s.fontFamily),s.tspan.setAttributeNS(null,"font-size",`${f(s.fontSize)}px`),s.tspan.setAttributeNS(null,"y",f(-s.y)),s.txtElement=this.svgFactory.createElement("svg:text"),s.txtElement.append(s.tspan)}beginText(){let e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=i.IDENTITY_MATRIX,e.lineMatrix=i.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){let n=this.current;n.x=n.lineX+=e,n.y=n.lineY+=t,n.xcoords=[],n.ycoords=[],n.tspan=this.svgFactory.createElement("svg:tspan"),n.tspan.setAttributeNS(null,"font-family",n.fontFamily),n.tspan.setAttributeNS(null,"font-size",`${f(n.fontSize)}px`),n.tspan.setAttributeNS(null,"y",f(-n.y))}showText(e){let t=this.current,n=t.font,r=t.fontSize;if(0===r)return;let a=t.fontSizeScale,h=t.charSpacing,u=t.wordSpacing,c=t.fontDirection,d=t.textHScale*c,p=n.vertical,g=p?1:-1,v=n.defaultVMetrics,y=r*t.fontMatrix[0],x=0;for(let i of e){if(null===i){x+=c*u;continue}if("number"==typeof i){x+=g*i*r/1e3;continue}let e,s,o,l=(i.isSpace?u:0)+h,d=i.fontChar,f=i.width;if(p){let t,n=i.vmetric||v;t=i.vmetric?n[1]:.5*f,t=-t*y;let r=n[2]*y;f=n?-n[0]:f,e=t/a,s=(x+r)/a}else e=x/a,s=0;(i.isInFont||n.missingFile)&&(t.xcoords.push(t.x+e),p&&t.ycoords.push(-t.y+s),t.tspan.textContent+=d),o=p?f*y-l*c:f*y+l*c,x+=o}t.tspan.setAttributeNS(null,"x",t.xcoords.map(f).join(" ")),p?t.tspan.setAttributeNS(null,"y",t.ycoords.map(f).join(" ")):t.tspan.setAttributeNS(null,"y",f(-t.y)),p?t.y-=x:t.x+=x*d,t.tspan.setAttributeNS(null,"font-family",t.fontFamily),t.tspan.setAttributeNS(null,"font-size",`${f(t.fontSize)}px`),t.fontStyle!==s&&t.tspan.setAttributeNS(null,"font-style",t.fontStyle),t.fontWeight!==o&&t.tspan.setAttributeNS(null,"font-weight",t.fontWeight);let b=t.textRenderingMode&i.TextRenderingMode.FILL_STROKE_MASK;if(b===i.TextRenderingMode.FILL||b===i.TextRenderingMode.FILL_STROKE?(t.fillColor!==l&&t.tspan.setAttributeNS(null,"fill",t.fillColor),t.fillAlpha<1&&t.tspan.setAttributeNS(null,"fill-opacity",t.fillAlpha)):t.textRenderingMode===i.TextRenderingMode.ADD_TO_PATH?t.tspan.setAttributeNS(null,"fill","transparent"):t.tspan.setAttributeNS(null,"fill","none"),b===i.TextRenderingMode.STROKE||b===i.TextRenderingMode.FILL_STROKE){let e=1/(t.textMatrixScale||1);this._setStrokeAttributes(t.tspan,e)}let _=t.textMatrix;0!==t.textRise&&(_=_.slice(),_[5]+=t.textRise),t.txtElement.setAttributeNS(null,"transform",`${m(_)} scale(${f(d)}, -1)`),t.txtElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t.txtElement.append(t.tspan),t.txtgrp.append(t.txtElement),this._ensureTransformGroup().append(t.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let t=c(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${t}); }\n`}setFont(e){let t=this.current,n=this.commonObjs.get(e[0]),r=e[1];t.font=n,this.embedFonts&&!n.missingFile&&!this.embeddedFonts[n.loadedName]&&(this.addFontStyle(n),this.embeddedFonts[n.loadedName]=n),t.fontMatrix=n.fontMatrix||i.FONT_IDENTITY_MATRIX;let a="normal";n.black?a="900":n.bold&&(a="bold");let s=n.italic?"italic":"normal";r<0?(r=-r,t.fontDirection=-1):t.fontDirection=1,t.fontSize=r,t.fontFamily=n.loadedName,t.fontWeight=a,t.fontStyle=s,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",f(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){var e;let t=this.current;t.textRenderingMode&i.TextRenderingMode.ADD_TO_PATH_FLAG&&null!=(e=t.txtElement)&&e.hasChildNodes()&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=h[e]}setLineJoin(e){this.current.lineJoin=u[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,n){this.current.strokeColor=i.Util.makeHexColor(e,t,n)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,n){this.current.fillColor=i.Util.makeHexColor(e,t,n),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){let{width:t,height:n}=this.viewport,r=i.Util.inverseTransform(this.transformMatrix),[a,s,o,l]=i.Util.getAxialAlignedBoundingBox([0,0,t,n],r),h=this.svgFactory.createElement("svg:rect");h.setAttributeNS(null,"x",a),h.setAttributeNS(null,"y",s),h.setAttributeNS(null,"width",o-a),h.setAttributeNS(null,"height",l-s),h.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&h.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(h)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){let t=e[1],n=e[2],r=e[3]||i.IDENTITY_MATRIX,[a,s,o,l]=e[4],h=e[5],u=e[6],c=e[7],d="shading"+y++,[p,f,m,g]=i.Util.normalizeRect([...i.Util.applyTransform([a,s],r),...i.Util.applyTransform([o,l],r)]),[v,x]=i.Util.singularValueDecompose2dScale(r),b=h*v,_=u*x,w=this.svgFactory.createElement("svg:pattern");w.setAttributeNS(null,"id",d),w.setAttributeNS(null,"patternUnits","userSpaceOnUse"),w.setAttributeNS(null,"width",b),w.setAttributeNS(null,"height",_),w.setAttributeNS(null,"x",`${p}`),w.setAttributeNS(null,"y",`${f}`);let S=this.svg,M=this.transformMatrix,T=this.current.fillColor,E=this.current.strokeColor,A=this.svgFactory.create(m-p,g-f);if(this.svg=A,this.transformMatrix=r,2===c){let e=i.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(n)),this.svg=S,this.transformMatrix=M,this.current.fillColor=T,this.current.strokeColor=E,w.append(A.childNodes[0]),this.defs.append(w),`url(#${d})`}_makeShadingPattern(e){switch("string"==typeof e&&(e=this.objs.get(e)),e[0]){case"RadialAxial":let t,n="shading"+y++,r=e[3];switch(e[1]){case"axial":let r=e[4],i=e[5];t=this.svgFactory.createElement("svg:linearGradient"),t.setAttributeNS(null,"id",n),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",r[0]),t.setAttributeNS(null,"y1",r[1]),t.setAttributeNS(null,"x2",i[0]),t.setAttributeNS(null,"y2",i[1]);break;case"radial":let a=e[4],s=e[5],o=e[6],l=e[7];t=this.svgFactory.createElement("svg:radialGradient"),t.setAttributeNS(null,"id",n),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"cx",s[0]),t.setAttributeNS(null,"cy",s[1]),t.setAttributeNS(null,"r",l),t.setAttributeNS(null,"fx",a[0]),t.setAttributeNS(null,"fy",a[1]),t.setAttributeNS(null,"fr",o);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(let e of r){let n=this.svgFactory.createElement("svg:stop");n.setAttributeNS(null,"offset",e[0]),n.setAttributeNS(null,"stop-color",e[1]),t.append(n)}return this.defs.append(t),`url(#${n})`;case"Mesh":return(0,i.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){let n=this.current,r=n.x,a=n.y,s=[],o=0;for(let n of e)switch(0|n){case i.OPS.rectangle:r=t[o++],a=t[o++];let e=r+t[o++],n=a+t[o++];s.push("M",f(r),f(a),"L",f(e),f(a),"L",f(e),f(n),"L",f(r),f(n),"Z");break;case i.OPS.moveTo:r=t[o++],a=t[o++],s.push("M",f(r),f(a));break;case i.OPS.lineTo:r=t[o++],a=t[o++],s.push("L",f(r),f(a));break;case i.OPS.curveTo:r=t[o+4],a=t[o+5],s.push("C",f(t[o]),f(t[o+1]),f(t[o+2]),f(t[o+3]),f(r),f(a)),o+=6;break;case i.OPS.curveTo2:s.push("C",f(r),f(a),f(t[o]),f(t[o+1]),f(t[o+2]),f(t[o+3])),r=t[o+2],a=t[o+3],o+=4;break;case i.OPS.curveTo3:r=t[o+2],a=t[o+3],s.push("C",f(t[o]),f(t[o+1]),f(r),f(a),f(r),f(a)),o+=4;break;case i.OPS.closePath:s.push("Z")}s=s.join(" "),n.path&&e.length>0&&e[0]!==i.OPS.rectangle&&e[0]!==i.OPS.moveTo?s=n.path.getAttributeNS(null,"d")+s:(n.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(n.path)),n.path.setAttributeNS(null,"d",s),n.path.setAttributeNS(null,"fill","none"),n.element=n.path,n.setCurrentPoint(r,a)}endPath(){let e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);let t="clippath"+g++,n=this.svgFactory.createElement("svg:clipPath");n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"transform",m(this.transformMatrix));let r=e.element.cloneNode(!0);if("evenodd"===this.pendingClip?r.setAttributeNS(null,"clip-rule","evenodd"):r.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,n.append(r),this.defs.append(n),e.activeClipUrl){e.clipGroup=null;for(let e of this.extraStack)e.clipGroup=null;n.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){let e=this.current;if(e.path){let t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n);break;case"CA":this.setStrokeAlpha(n);break;case"ca":this.setFillAlpha(n);break;default:(0,i.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){let e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){let e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){let n=this.current,r=n.dashArray;1!==t&&r.length>0&&(r=r.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",n.strokeColor),e.setAttributeNS(null,"stroke-opacity",n.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",f(n.miterLimit)),e.setAttributeNS(null,"stroke-linecap",n.lineCap),e.setAttributeNS(null,"stroke-linejoin",n.lineJoin),e.setAttributeNS(null,"stroke-width",f(t*n.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",r.map(f).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",f(t*n.dashPhase)+"px")}eoFill(){var e;null==(e=this.current.element)||e.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var e;null==(e=this.current.element)||e.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(e)}paintImageXObject(e){let t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,i.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){let n=e.width,r=e.height,i=d(e,this.forceDataSchema,!!t),a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width",f(n)),a.setAttributeNS(null,"height",f(r)),this.current.element=a,this.clip("nonzero");let s=this.svgFactory.createElement("svg:image");s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i),s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y",f(-r)),s.setAttributeNS(null,"width",f(n)+"px"),s.setAttributeNS(null,"height",f(r)+"px"),s.setAttributeNS(null,"transform",`scale(${f(1/n)} ${f(-1/r)})`),t?t.append(s):this._ensureTransformGroup().append(s)}paintImageMaskXObject(e){let t=this.getObject(e.data,e);if(t.bitmap)return void(0,i.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");let n=this.current,r=t.width,a=t.height,s=n.fillColor;n.maskId="mask"+v++;let o=this.svgFactory.createElement("svg:mask");o.setAttributeNS(null,"id",n.maskId);let l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",f(r)),l.setAttributeNS(null,"height",f(a)),l.setAttributeNS(null,"fill",s),l.setAttributeNS(null,"mask",`url(#${n.maskId})`),this.defs.append(o),this._ensureTransformGroup().append(l),this.paintInlineImageXObject(t,o)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){let e=t[2]-t[0],n=t[3]-t[1],r=this.svgFactory.createElement("svg:rect");r.setAttributeNS(null,"x",t[0]),r.setAttributeNS(null,"y",t[1]),r.setAttributeNS(null,"width",f(e)),r.setAttributeNS(null,"height",f(n)),this.current.element=r,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){let t=this.svgFactory.create(e.width,e.height),n=this.svgFactory.createElement("svg:defs");t.append(n),this.defs=n;let r=this.svgFactory.createElement("svg:g");return r.setAttributeNS(null,"transform",m(e.transform)),t.append(r),this.svg=r,t}_ensureClipGroup(){if(!this.current.clipGroup){let e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",m(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__w_pdfjs_require__),n.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AbortException",{enumerable:!0,get:function(){return t.AbortException}}),Object.defineProperty(e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return a.AnnotationEditorLayer}}),Object.defineProperty(e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(e,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return s.AnnotationEditorUIManager}}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"FeatureTest",{enumerable:!0,get:function(){return t.FeatureTest}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(e,"ImageKind",{enumerable:!0,get:function(){return t.ImageKind}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return n.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return r.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return n.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return r.PixelsPerInch}}),Object.defineProperty(e,"PromiseCapability",{enumerable:!0,get:function(){return t.PromiseCapability}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return r.RenderingCancelledException}}),e.SVGGraphics=void 0,Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return n.build}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return n.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return r.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return r.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return r.getXfaPageViewport}}),Object.defineProperty(e,"isDataScheme",{enumerable:!0,get:function(){return r.isDataScheme}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return r.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return r.loadScript}}),Object.defineProperty(e,"normalizeUnicode",{enumerable:!0,get:function(){return t.normalizeUnicode}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return i.renderTextLayer}}),Object.defineProperty(e,"setLayerDimensions",{enumerable:!0,get:function(){return r.setLayerDimensions}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"updateTextLayer",{enumerable:!0,get:function(){return i.updateTextLayer}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return n.version}});var t=__w_pdfjs_require__(1),n=__w_pdfjs_require__(2),r=__w_pdfjs_require__(6),i=__w_pdfjs_require__(26),a=__w_pdfjs_require__(27),s=__w_pdfjs_require__(5),o=__w_pdfjs_require__(29),l=__w_pdfjs_require__(14),h=__w_pdfjs_require__(31);let u=__w_pdfjs_require__(34).SVGGraphics;e.SVGGraphics=u})(),__webpack_exports__})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("pdfjs-dist/build/pdf",[],t):"object"==typeof exports?exports["pdfjs-dist/build/pdf"]=t():e["pdfjs-dist/build/pdf"]=e.pdfjsLib=t()}));!function(){if("undefined"!=typeof document&&!document.getElementById("953d8e1c8d2fd4c807986e925978f6426135afe7bd39a00aa70a9a121d720264")){var e=document.createElement("style");e.id="953d8e1c8d2fd4c807986e925978f6426135afe7bd39a00aa70a9a121d720264",e.textContent='.model-layout-switch-bar{position:absolute;bottom:0;width:100%;height:24px;background:#ffffff;opacity:.7;display:flex;font-size:14px;line-height:1;overflow-x:scroll;overflow-y:hidden;z-index:1}.model-layout-switch-bar .model-layout-switch-bar-content{white-space:nowrap}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item{position:relative;display:inline-block;padding:3px 10px 0;color:#000;height:22px;cursor:pointer;transform:translate(0)}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:before{content:"";position:absolute;inset:0;z-index:-1;background:#fff;border:1px solid #000;border-top:0px}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:hover{color:#8080f0}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:nth-child(n+2){margin-left:-1px}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item.activate{color:#fff!important}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item.activate:before{background:#212830!important}.model-layout-switch-bar.hidden{display:none}.model-layout-switch-bar::-webkit-scrollbar{display:none}.pop-panel{z-index:99999999;top:calc(70% - 100px);left:calc(90% - 160px);position:absolute;background:#ffffff;color:#333;border-radius:4px;width:160px;box-shadow:0 12px 48px 16px #00000008,0 9px 28px #0000000d,0 6px 16px -8px #00000014}.pop-panel .pop-panel-header{font-size:16px;font-weight:bolder;padding:16px 24px 8px;color:#333;border-bottom:1px solid #EFEFEF;cursor:move;user-select:none}.pop-panel .pop-panel-body{display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:16px 24px}.pop-panel .pop-panel-body .pop-panel-item{display:inline-block;cursor:pointer;margin-right:16px;font-size:16px}.pop-panel .pop-panel-body .pop-panel-item .dxf-viewer-iconfont{font-size:24px}.pop-panel .pop-panel-body .pop-panel-item:last-child{margin-right:0}.pop-panel .pop-panel-body .pop-panel-item:hover,.pop-panel .pop-panel-body .pop-panel-item.active{color:#2c7be5}.pop-panel .pop-panel-body .pop-panel-item.disable{color:#999;cursor:not-allowed}.follow-tooltip{z-index:99999999;position:absolute;left:-500px;padding:6px;background:rgba(25,25,25,.3);color:#fffc;font-size:12px;border-radius:2px}#axisGizmo{width:100px;height:100px;position:absolute;display:block;bottom:1px;left:10px;background:rgba(255,255,255,0)}.bottom-bar{position:absolute;bottom:0;right:0;display:flex;color:#666;z-index:3;overflow:hidden;user-select:none}.bottom-bar i{font-size:18px;padding:3px;align-self:center;opacity:.4;cursor:pointer;line-height:1}.bottom-bar i:hover,.bottom-bar i.active{color:#2c7be5;opacity:1}.bottom-bar .fps{width:4rem}.bottom-bar span{align-self:center;padding:4px;font-size:14px}#dxf-viewer-threejs-statistics-tooltip,#dxf-viewer-threejs-tips-tooltip,#dxf-viewer-threejs-cameraCfg-tooltip{position:absolute;right:5px;bottom:30px;background:#666666;color:#fff;padding:8px 8px 5px;font-size:.8rem;border-radius:4px;z-index:3;opacity:.9;user-select:none}#dxf-viewer-threejs-statistics-tooltip p,#dxf-viewer-threejs-tips-tooltip p,#dxf-viewer-threejs-cameraCfg-tooltip p{padding-bottom:3px;margin:3px}#dxf-viewer-threejs-statistics-tooltip p span,#dxf-viewer-threejs-tips-tooltip p span,#dxf-viewer-threejs-cameraCfg-tooltip p span{float:left;margin-right:10px}.layer-manager{position:absolute;top:30px;left:20px;width:330px;height:600px;max-height:90%;border-radius:4px;box-shadow:1px 3px 10px #0006;background-color:#ffffffe6;color:#000;z-index:2;overflow:hidden;user-select:none}.layer-manager:hover{background-color:#fffffff2}.layer-manager input[type=checkbox]{width:16px;height:16px;cursor:pointer}.layer-manager input[type=color]{width:30px;height:16px;border:0;padding:0;background-color:#0000;overflow:hidden}.layer-manager ::-webkit-color-swatch{position:relative;margin-top:-5px;width:40px;height:16px}.layer-manager .header{display:flex;align-items:center;padding-left:6px;width:100%;height:40px;border-bottom:1px solid #ccc;cursor:move;font-size:16px}.layer-manager .header .close{position:absolute;right:8px;cursor:pointer;padding:10px}.layer-manager .header .close:hover{font-weight:700}.layer-manager .layer-list{width:100%;height:calc(100% - 40px);padding:0;margin:0;border-bottom:1px solid #ccc;overflow-y:scroll}.layer-manager .layer-list-item{display:flex;align-items:center;padding:6px;border-bottom:1px solid #ccc;white-space:nowrap}.layer-manager .layer-list-item:hover{background-color:#f0f8ff}.layer-manager .popup-layer-color{display:inline-block;margin-left:5px;width:20px;font-size:12px}.layer-manager .item-color{margin-left:8px;font-size:12px;border:1px solid black;width:18px;height:16px;min-width:18px}.layer-manager .item-layer-name{display:inline-block;margin-left:10px;padding:1px 0;width:280px;font-size:12px;text-overflow:ellipsis;overflow:hidden}.layer-manager .popup-freeze{margin-right:5px;color:#ccc;font-size:12px;width:50px}#dxf-viewer-overview-map{width:200px;height:200px;top:10px;left:10px;position:absolute;z-index:1;border:1px rgba(80,80,80,.5647058824) solid;background-color:#80808030}.statsOutput{position:absolute;opacity:.6;top:1px;left:1px;z-index:99}.toolbar{position:absolute;display:flex;box-sizing:border-box;height:68px;left:50%;bottom:40px;padding:8px 20px;box-shadow:1px 3px 10px #0006;border-radius:4px;background:rgba(255,255,255,.8);transform:translate(-50%);align-items:center;z-index:10;user-select:none}.toolbar .toolbar-group{display:flex;padding:0 2px;box-sizing:border-box}.toolbar .toolbar-group-division{width:1px;background-color:#999c;height:60%}.toolbar .toolbar-menu{display:flex;box-sizing:border-box;flex-direction:column;word-break:break-word;width:50px;height:50px;padding:3px 1px;margin:0 2px;transition:all .3s;cursor:pointer;color:#666;border-radius:4px}.toolbar .toolbar-menu.active{color:#2c7be5}.toolbar .toolbar-menu .icon{width:24px;height:24px;margin:auto;font-size:24px;line-height:normal}.toolbar .toolbar-menu span{display:block;width:100%;margin:auto;font-size:12px;text-align:center;user-select:none}.toolbar .toolbar-menu-active{color:#2c7be5;background-color:#fffc}.toolbar .toolbar-parent-menu{position:relative}.toolbar .toolbar-parent-menu-active .toolbar-sub-menu{display:block}.toolbar .toolbar-parent-menu-active .toolbar-sub-menu-list{background:rgba(255,255,255,.8)}.toolbar .toolbar-parent-menu:after{content:"";position:absolute;box-sizing:border-box;width:0;height:0;right:2px;top:2px;border-width:4px;border-style:solid;border-top-color:#666;border-right-color:#666;border-bottom-color:transparent;border-left-color:transparent;border-radius:1px}.toolbar .toolbar-sub-menu{display:none;position:absolute;min-width:50px;bottom:100%;box-shadow:1px 3px 10px #0006}.toolbar .toolbar-sub-menu .toolbar-sub-menu-list{margin-bottom:2px;border-radius:4px}.toolbar .toolbar-sub-menu .toolbar-sub-menu-list .toolbar-menu{margin:0}@media screen and (max-width:768px){.toolbar .toolbar-menu{width:30px;height:30px;margin:0}.toolbar .toolbar-menu .icon+span{display:none}.toolbar .toolbar-parent-menu:after{top:1px;right:0}.toolbar .toolbar-sub-menu{min-width:30px}}.progress-bar{z-index:3;bottom:20%;left:25%;position:absolute;color:#ffffffa0;width:50%;user-select:none;font-size:14px}.progress-bar.hidden{display:none}.progress-bar .progress-bar-item{width:100%;text-align:center;padding:2px}.x-spinner{display:flex;flex-flow:row nowrap;align-items:center;justify-content:space-between;width:2em;position:absolute;pointer-events:none;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px}.x-spinner.hidden{display:none}.x-spinner span{width:.3em;height:1em;background-color:#3cefff}.x-spinner span:nth-of-type(1){animation:grow 1s -.45s ease-in-out infinite}.x-spinner span:nth-of-type(2){animation:grow 1s -.3s ease-in-out infinite}.x-spinner span:nth-of-type(3){animation:grow 1s -.15s ease-in-out infinite}.x-spinner span:nth-of-type(4){animation:grow 1s ease-in-out infinite}@keyframes grow{0%,to{transform:scaleY(1)}50%{transform:scaleY(2)}}.anchor{position:absolute;top:0;left:0;opacity:0;width:20px;height:20px;transform:translate(-50%,-50%);pointer-events:none;user-select:none;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAADjRJREFUeF7tXQnQttUYvq4Zxr5MqBgaihRlKakUU7SYSBQljUhaxijtso2MTCrRn8YoldKIUlIIJRplSyKyqzGyJDSDLGHmMtfvvOb19n7fe7Zn+/7nnnnn+/7/O8t9zrne+5xzn3sh1hCS9GUA20UO9xqS20eWHXQxDpr7BOZHAMyfrBEA8+dllAAJX65BFB0lwCgBxjPAHAyMW8C4BQxCghczOW4B4xYwbgHjFjDqAWYxMJ4BxjNA8fY6iAbGM8B4BhjPAGvKGUDSYwA8FcAmAJ4EYOPw8/6R4upvAH4I4Efh580AbiJ5W2T9wRRbEWcASTuFBX/a1KLfq/Iq/HsKDN8NgLiych+tNzdYAEh6JoAXAdgtLHrrkwfAkuEyAJeTvL4LBkr7HBQAJK0fFtwLH/u0WzpHsfWvMRAMCJK3xlbqutwgACDplVMLf++uJ21B//+aAsL5PecVvQaApB0BHA3AP4dIVwE4maR/9pJ6CYBwij8GwOt7OWvpTJ0O4KQ+3iJ6BwBJXnQvvq9yK4l8hTQIDIbeUG8AsALEfeyi9mpb6AUAJL0bwBtjZ3CFlDuR5LFdj6VzAEi6EMCeXU9ER/1fRHKvjvpe3W1nAJC0NoDPAnhGwxNwF4DbZz6/m/q3u183fNaZ+n3yfw9smL8bALyA5B0N9zO3+U4AIMmL/gUAazU0aKtor/CH5M9K+pD0BAC7hI9Vzk3QnQB2JmkwtEqtA0DS7gAuqTxKn7C96F8EcBXJP1Zuf3Vzkh4WdBI7ADAYat9U9iD5ySZ4X6rNVgEg6TAA76s4wKsBnBa+6X6saY0k+bHJkuFQAM+r2PHhJE+t2N6yTbUGAEkHADiz0sBu8sKTPKdSe0XNSHpNAIKfoGvQgSQ/VKOhRW20AoDwcvfNRcxE/P034Rvvxf97RPnWiki6XwCBJcKjKnS8ZRsvjI0DILzg3VI4IX5gsahf1Ud16vTYghr7DQEMpQ9XGzT9stgoACQ9BMD3Cw9LlhyvI3ljIYharS5pMwAfALBlQcc+3G5K8k8FbXR3BpDkE+1LCpj3+/o+JH2XHxxJsg7ho8FwJZf/S0n65tQINSYBJH0QwEEFXJ9F0gfHwZMkH+heWzCQM0geXFB/yaqNAEDS8QDeUsDwsSRPLKjfu6qS/NbhN49cehfJt+ZWXqpedQCEV70SY8ltSX619kD70J6kbQBcV8DLTrWNS5oAgBc/y4KHZHV+Cia7saqSlNm4tZxV1dFVJzwYc7w/c3BPJPnTzLqDqiZpQwA/yWT6kJpGJdUAEO6/Ft05+vFdSX4mc0IGWU3SCwF8OoN5Xw23qaUPqQkAf/NzbPiOJPnejIkYfBVJRwA4JWMgp5M8JKPePapUAUDBwa+x602NyWmjjYLrcpUDYS0A5Bz87Ky5C8l/tDHRs31IesTUdnUbyd93xMd9g+1CalzCKgfCYgAEp42PJE6edftbtaXeDWrZ59ryJiz6owHcZ4bnuwH8CoD3WFsqfall/r4BIPXtYF+SRc4nNQBwMYA9EgFwCsmjEuskFZe0c7A1tAuZXcpyyC5edvmy7Z4tmBojSe8BcGRiB5eQfGlinf8rXgSA8NL340Tk+knX3/5GXK0l+U3ehievLpmYOXXPBXAqSdsiVKdwi7IUSHlKtiTdqOTFsBQAhwNIPcE3ouaVZN9/q0q9+H6bb4Jsg2BrneNJOoZAVcpUFx9BMtvKqhQAKVE3PFn+9mxd25hD0tMB+PHJLuNtkF3BDyb5nZqdBaOSr4dYB7FNF4W1zQZAppXP/rXNuCS9HMDHYmercrm9SX68ZpvBvOzsxDazrYdKAJD64nc1SVvTViNJbwdwXLUG8xo6juQ78qrOryXJ1s0phqbZL4UlALClj2PwxNJuJG3gUYXCKf/zVRorb+RZJC26q5AkB8Bw5JFYupnkprGFp8tlASBD8/dbAOuRrGK6XeFZNWeuFtV5HMlfLCoU8/dgcv5LAI+MKR/KZGkGcwHg+6rvrbF0Acl9YgsvVy5c8+z1k3JdqtH1ojasDfWj1j8XFYz5uySbkr0ipmwocxTJ5HeFXAD4TvyqBOaq2blL8jaya0LfbRY9geSba3SY4UdxHslk3UcuAL4NwFavsbRODefHgifUWD5Ly1lP4GtusbIoOM/aiTWWbiS5eWzhSblkAEiy6PVeF6u3vpbkc1IZm1e+59/+Ccvnktyv0ni/AuDZkW1ZK/hYkta0RlMOAGySlKIXr6L5G8C3f3rSn1/j7SBDM2gP4yR7zBwApKp/Nybp94IiknQBgL2LGmmvctZ+PMuepI1CuNpYzpPVwjkAsJbKzpAxdBfJB8UUXK6MJLfxawDFbZXyElnf9gXrRZZdtpikvwCIDVJxDsn9U/rNAYBdtWJ17j8n6QALRSRpXwDnFTXSfuUqyiFJDnDx+Ej2ryeZ5IrGEEc/sv3VxbYA8IDICteRjD3ELNlkBRezSHarFnsbSavLi0jStQC2jWzkrwC+FVl2dTEDINdGPaafi0m+LKbggi2gSR5L2VuqftEr3aRRSZ8AUGT0sdwAmwZAsfWqpAcDaMw7tqnVB3ALyVjRvZz0y7W2jhpa0wAoFoOSbL/XiPVQ1AzlF7qbpA0+i0iSjVzeWdTIMpWbBsABJM8qYV6SM378oKSNDuuuXWptLMlexY2Fi2kaAMUeP5K2BvC1DhexpOvNSy2Lm1aAjQAoWd7Fddd4AIxbQKHDydC3gPEQuFhKLFti6IfA8RpYDoBBXwNHRVA5ABpXBNm2P4X8DhCbgLGWKjjVPCplPE2VPZpkitncXD4SVcF2VklKX5fzGGRdc2yI91qPQQ4112oQ5QqoKL4BmIfEx6AbSPqtJppyAGBPYKdxi6Faz8F+DrXnrgNPDoFuJblBDUYTn4PPJ+mX02jKAYDTnJwQ3QOwYWnM/vBNSAFeAnuNFE1+l5/HRchVkBI36U0kk0LR5QAgNbbNYSRXlU5z0xqxUv5m6tcyCXPM4ZTQ8cma1xwAOAiU/eZjkzNfSdK++sW0BhqF2vYyNiycnW7WT3W7TwZAEMc2e35Kwoo+vEYWjwFIgZpm4c5O8oeEOf4eyeR8BbkASL2WVfOi7bkUqOkYkur1nOV9lQsA5/M9KQGdZ5MsCZb8v64kbQXgcwAemtB/G0V9/96+VuAISX5GTzHwPIbkyakDzQVAqm+ADTq8P9VyDrXPnKVQn2izWgEjgnOoz1kpQTeTfQI8eVkACOeArt3DHSjRWUT6QNW2uDC3/XYPD0yOASL+C701NkCE3wRSE0E1ESLGV8yuAkVUue9Pi7DBhIgJUqAvQaIch/+iFmMG2AFzz9p5DQYVJCoAINVP0NWqOIvObvwhcIStZ5uOHeAI3zZ0KXYBnzOGnKwiyf6A0/1mHwIDAByBs2+BIq2qPrABIHjhz2wqrP0gA0UGEPQ1VKyB4Ouif+Y6ldox03kMrGRpNJ/BIEPFBgD4abi3waKDZ7HtCV6ckMLuUgCfAuCUbQZBoxSCWQ8zWHQAQU64eN8gdmg7J2BwNbO7mT8T+wK7nv3ZH5L+2RqF3IKOC5jk1RuypMc+FC05nqIzwKTVjLBxk6qXk9yttdnuYUeSHA/Qip9UygoLN9tJFQAEKZBrvbpiEkSmrmBBQslia+sJrzUBYL11btKoRq6GqQvSZvmM+D8T9vqZNCpIASeNyk0bt2ITRs6575ckkOxn2rip80DOgXB19TFx5EIZVCVP0HQv1baACgfCSRMrNoFkYcJIz0+Vg1+jAAhbgS1TrdbMpWTjxtyO2qpXwZztRJK2yK5K1SXAlCS4MCRtymV4xSSULEgQOZk7J63aK3cil6vXGACCJEjxIprH5xnOAdRVbsHSCZfkEDE26z6ooK1kb5+UvpoGwNoh0uVaKUzNlPWTs0Oh31jQRutVg3rXvoGpCSGneb0TgCOt3tHUABoFQJAC9iNMil03Z7AOhGzzr1Wpdu9NTdxS7YZXPTt0HJoQUHup5rYgeUOTY2gcAAEEuwO4pMJAbIhhIJxWO/NYKW/BmMOL7k+NZBZ7kGzcIbYVAAQQOJ9fdn67mQWyMYZBcE7pwtWoH8y4vPDJjhlL9H84yRSXsOxhtAaAAIIDbFSRze09K14dJMIVtUzOY3kLptu7hG98SoavRV1Uy66yqCP/vVUABBDkGJMuGouTUvmw6Dy/lzV1aApZPPx66XzEPtylJHVaNAb/PTv/X0zj88q0DoAAApuSebFSHB9SxugAy84AbjAU5SoIMfu96M48Xhz4eolB+IFnu5IcwCmTM122EwAEENgY48MJVjq5Y7wLwO0zH+fimfyf2103fNaZ+n3yf7Gx+nP5s/XRfiQ7iYfcGQAmsyXJOX9LFCW5E9+HemeQPLhLRjoHQJAGqV5GXc5Zrb6z073WYqCTQ+BSzAezMnsd71hzgD1s6yoAJ5P0z86pFxJgehYk2ajkmAYPiF1Nug96J5E8vSsGenMLWDQBQZ1qEBgMK4G86F783uU96J0EmJEG3g6GvC30StwPRgLMMirJzie+i9t8OjZjaVeSww9Xzm9sHcT5XTER22+vJcAcIFiBNAGCtXF9Iiu2Jgvv6B6DoEEBYGZ7sErZEsGA2KSj2b7Z33QvPMmkGL0d8XuPbgcLgDlnBYet23TqU3ursGh3WJzJx2HZenGVKwHTigDAnK3C7/GWCk8OPye/xya8dAJGJ6ryN9yf1b+nZuYuWZi26q5IAMybvJAhNfbcUCXpY1uLWNLPCID5szcCoARVfaw7SoD5qzJKgFEC9PH7Wp+nUQKMEiAlpN14Bqj/Hey2xVECjBJglABzMDAeAsdDYLeiua3exy1g3ALGLWDcAlY7dMTQGnML+A8qtnUcTFYqYAAAAABJRU5ErkJggg==) no-repeat center center;background-size:100% 100%;background-blend-mode:lighten;filter:invert(61%) sepia(87%) saturate(845%) hue-rotate(120deg) brightness(94%) contrast(101%);transition:opacity .5s ease-in-out}.anchor.active{opacity:1}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(360deg)}}\n',document.head.appendChild(e)}}();var tbe=fetch;window.fetch=(...e)=>Promise.resolve(tbe(...e));var g9t=ca(pH(),1),v9t=ca(hse(),1),y9t=ca(fse(),1),$t={};YU($t,{ACESFilmicToneMapping:()=>Soe,AddEquation:()=>oh,AddOperation:()=>boe,AdditiveAnimationBlendMode:()=>Y6,AdditiveBlending:()=>Ak,AgXToneMapping:()=>Moe,AlphaFormat:()=>z6,AlwaysCompare:()=>Goe,AlwaysDepth:()=>doe,AlwaysStencilFunc:()=>Ik,AmbientLight:()=>vg,AnimationAction:()=>tM,AnimationClip:()=>Ed,AnimationLoader:()=>s6,AnimationMixer:()=>b6,AnimationObjectGroup:()=>x6,AnimationUtils:()=>Rit,ArcCurve:()=>hd,ArrayCamera:()=>_w,ArrowHelper:()=>wd,AttachedBindMode:()=>Pk,Audio:()=>Qw,AudioAnalyser:()=>v6,AudioContext:()=>Ry,AudioListener:()=>m6,AudioLoader:()=>d6,AxesHelper:()=>F6,BackSide:()=>zi,BasicDepthPacking:()=>koe,BasicShadowMap:()=>JKe,BatchedMesh:()=>Mw,Bone:()=>py,BooleanKeyframeTrack:()=>au,Box2:()=>Vr,Box3:()=>Ft,Box3Helper:()=>L6,BoxGeometry:()=>ru,BoxHelper:()=>O6,BufferAttribute:()=>vn,BufferGeometry:()=>Nt,BufferGeometryLoader:()=>Jw,ByteType:()=>U6,Cache:()=>Jc,Camera:()=>ad,CameraHelper:()=>bg,CanvasTexture:()=>ud,CapsuleGeometry:()=>ig,CatmullRomCurve3:()=>Pw,CineonToneMapping:()=>Toe,CircleGeometry:()=>sg,ClampToEdgeWrapping:()=>xa,Clock:()=>ph,Color:()=>Ot,ColorKeyframeTrack:()=>Sy,ColorManagement:()=>vr,CompressedArrayTexture:()=>Qk,CompressedCubeTexture:()=>e6,CompressedTexture:()=>Yl,CompressedTextureLoader:()=>a6,ConeGeometry:()=>ag,ConstantAlphaFactor:()=>uoe,ConstantColorFactor:()=>loe,CubeCamera:()=>bw,CubeReflectionMapping:()=>tu,CubeRefractionMapping:()=>ch,CubeTexture:()=>od,CubeTextureLoader:()=>o6,CubeUVReflectionMapping:()=>_g,CubicBezierCurve:()=>my,CubicBezierCurve3:()=>Iw,CubicInterpolant:()=>qw,CullFaceBack:()=>Mk,CullFaceFront:()=>Xae,CullFaceFrontBack:()=>KKe,CullFaceNone:()=>jae,Curve:()=>Ga,CurvePath:()=>Lw,CustomBlending:()=>Yae,CustomToneMapping:()=>woe,CylinderGeometry:()=>hh,Cylindrical:()=>M6,Data3DTexture:()=>ay,DataArrayTexture:()=>Qm,DataTexture:()=>ba,DataTextureLoader:()=>My,DataUtils:()=>Tg,DecrementStencilOp:()=>cJe,DecrementWrapStencilOp:()=>hJe,DefaultLoadingManager:()=>ole,DepthFormat:()=>Qf,DepthStencilFormat:()=>id,DepthTexture:()=>uy,DetachedBindMode:()=>Coe,DirectionalLight:()=>gg,DirectionalLightHelper:()=>xg,DiscreteInterpolant:()=>Gw,DisplayP3ColorSpace:()=>hM,DodecahedronGeometry:()=>og,DoubleSide:()=>Mr,DstAlphaFactor:()=>roe,DstColorFactor:()=>soe,DynamicCopyUsage:()=>MJe,DynamicDrawUsage:()=>bJe,DynamicReadUsage:()=>TJe,EdgesGeometry:()=>fh,EllipseCurve:()=>su,EqualCompare:()=>Hoe,EqualDepth:()=>moe,EqualStencilFunc:()=>mJe,EquirectangularReflectionMapping:()=>K1,EquirectangularRefractionMapping:()=>J1,Euler:()=>Fi,EventDispatcher:()=>cl,ExtrudeGeometry:()=>rs,FileLoader:()=>Ls,Float16BufferAttribute:()=>Uk,Float32BufferAttribute:()=>Wt,FloatType:()=>ns,Fog:()=>ng,FogExp2:()=>tg,FramebufferTexture:()=>Jk,FrontSide:()=>Os,Frustum:()=>ul,GLBufferAttribute:()=>T6,GLSL1:()=>CJe,GLSL3:()=>Dk,GreaterCompare:()=>Voe,GreaterDepth:()=>voe,GreaterEqualCompare:()=>qoe,GreaterEqualDepth:()=>goe,GreaterEqualStencilFunc:()=>xJe,GreaterStencilFunc:()=>vJe,GridHelper:()=>I6,Group:()=>Ai,HalfFloatType:()=>ja,HemisphereLight:()=>mg,HemisphereLightHelper:()=>P6,IcosahedronGeometry:()=>lg,ImageBitmapLoader:()=>f6,ImageLoader:()=>_d,ImageUtils:()=>yw,IncrementStencilOp:()=>lJe,IncrementWrapStencilOp:()=>uJe,InstancedBufferAttribute:()=>iu,InstancedBufferGeometry:()=>Kw,InstancedInterleavedBuffer:()=>_6,InstancedMesh:()=>wo,Int16BufferAttribute:()=>Nk,Int32BufferAttribute:()=>Bk,Int8BufferAttribute:()=>kk,IntType:()=>iM,InterleavedBuffer:()=>cd,InterleavedBufferAttribute:()=>So,Interpolant:()=>vd,InterpolateDiscrete:()=>sd,InterpolateLinear:()=>Km,InterpolateSmooth:()=>qS,InvertStencilOp:()=>fJe,KeepStencilOp:()=>Wf,KeyframeTrack:()=>Wa,LOD:()=>Sw,LatheGeometry:()=>dd,Layers:()=>uh,LessCompare:()=>Uoe,LessDepth:()=>poe,LessEqualCompare:()=>$6,LessEqualDepth:()=>Z1,LessEqualStencilFunc:()=>gJe,LessStencilFunc:()=>pJe,Light:()=>Jl,LightProbe:()=>Zw,Line:()=>ti,Line3:()=>xs,LineBasicMaterial:()=>gr,LineCurve:()=>gy,LineCurve3:()=>Dw,LineDashedMaterial:()=>Kl,LineLoop:()=>Rw,LineSegments:()=>ni,LinearDisplayP3ColorSpace:()=>Ly,LinearFilter:()=>Dr,LinearInterpolant:()=>Ty,LinearMipMapLinearFilter:()=>nJe,LinearMipMapNearestFilter:()=>tJe,LinearMipmapLinearFilter:()=>Eo,LinearMipmapNearestFilter:()=>Jf,LinearSRGBColorSpace:()=>fl,LinearToneMapping:()=>Eoe,LinearTransfer:()=>ey,Loader:()=>Ri,LoaderUtils:()=>Cy,LoadingManager:()=>wy,LoopOnce:()=>Roe,LoopPingPong:()=>Ioe,LoopRepeat:()=>Poe,LuminanceAlphaFormat:()=>W6,LuminanceFormat:()=>G6,MOUSE:()=>$Ke,Material:()=>Ir,MaterialLoader:()=>yg,MathUtils:()=>zr,Matrix2:()=>Py,Matrix3:()=>Tn,Matrix4:()=>At,MaxEquation:()=>Jae,Mesh:()=>Jt,MeshBasicMaterial:()=>mr,MeshDepthMaterial:()=>hy,MeshDistanceMaterial:()=>fy,MeshLambertMaterial:()=>Vw,MeshMatcapMaterial:()=>zw,MeshNormalMaterial:()=>Hw,MeshPhongMaterial:()=>pg,MeshPhysicalMaterial:()=>Bw,MeshStandardMaterial:()=>_y,MeshToonMaterial:()=>Uw,MinEquation:()=>Kae,MirroredRepeatWrapping:()=>nd,MixOperation:()=>xoe,MultiplyBlending:()=>Rk,MultiplyOperation:()=>Iy,NearestFilter:()=>Li,NearestMipMapLinearFilter:()=>eJe,NearestMipMapNearestFilter:()=>QKe,NearestMipmapLinearFilter:()=>lh,NearestMipmapNearestFilter:()=>Dy,NeutralToneMapping:()=>Aoe,NeverCompare:()=>Boe,NeverDepth:()=>foe,NeverStencilFunc:()=>dJe,NoBlending:()=>Qc,NoColorSpace:()=>ol,NoToneMapping:()=>eu,NormalAnimationBlendMode:()=>uM,NormalBlending:()=>Kf,NotEqualCompare:()=>zoe,NotEqualDepth:()=>yoe,NotEqualStencilFunc:()=>yJe,NumberKeyframeTrack:()=>yd,Object3D:()=>Cn,ObjectLoader:()=>h6,ObjectSpaceNormalMap:()=>Noe,OctahedronGeometry:()=>md,OneFactor:()=>eoe,OneMinusConstantAlphaFactor:()=>hoe,OneMinusConstantColorFactor:()=>coe,OneMinusDstAlphaFactor:()=>ioe,OneMinusDstColorFactor:()=>aoe,OneMinusSrcAlphaFactor:()=>WS,OneMinusSrcColorFactor:()=>noe,OrthographicCamera:()=>To,P3Primaries:()=>ny,PCFShadowMap:()=>B6,PCFSoftShadowMap:()=>nM,PMREMGenerator:()=>ld,Path:()=>$l,PerspectiveCamera:()=>ui,Plane:()=>Oi,PlaneGeometry:()=>ys,PlaneHelper:()=>k6,PointLight:()=>Xw,PointLightHelper:()=>R6,Points:()=>Ni,PointsMaterial:()=>Wi,PolarGridHelper:()=>D6,PolyhedronGeometry:()=>Zl,PositionalAudio:()=>g6,PropertyBinding:()=>Wn,PropertyMixer:()=>eM,QuadraticBezierCurve:()=>vy,QuadraticBezierCurve3:()=>yy,Quaternion:()=>Ci,QuaternionKeyframeTrack:()=>xd,QuaternionLinearInterpolant:()=>Ww,RED_GREEN_RGTC2_Format:()=>gw,RED_RGTC1_Format:()=>X6,REVISION:()=>Eg,RGBADepthPacking:()=>Foe,RGBAFormat:()=>vs,RGBAIntegerFormat:()=>cM,RGBA_ASTC_10x10_Format:()=>uw,RGBA_ASTC_10x5_Format:()=>ow,RGBA_ASTC_10x6_Format:()=>lw,RGBA_ASTC_10x8_Format:()=>cw,RGBA_ASTC_12x10_Format:()=>hw,RGBA_ASTC_12x12_Format:()=>fw,RGBA_ASTC_4x4_Format:()=>QS,RGBA_ASTC_5x4_Format:()=>ew,RGBA_ASTC_5x5_Format:()=>tw,RGBA_ASTC_6x5_Format:()=>nw,RGBA_ASTC_6x6_Format:()=>rw,RGBA_ASTC_8x5_Format:()=>iw,RGBA_ASTC_8x6_Format:()=>sw,RGBA_ASTC_8x8_Format:()=>aw,RGBA_BPTC_Format:()=>W1,RGBA_ETC2_EAC_Format:()=>JS,RGBA_PVRTC_2BPPV1_Format:()=>$S,RGBA_PVRTC_4BPPV1_Format:()=>YS,RGBA_S3TC_DXT1_Format:()=>z1,RGBA_S3TC_DXT3_Format:()=>q1,RGBA_S3TC_DXT5_Format:()=>G1,RGBDepthPacking:()=>iJe,RGBFormat:()=>q6,RGBIntegerFormat:()=>rJe,RGB_BPTC_SIGNED_Format:()=>dw,RGB_BPTC_UNSIGNED_Format:()=>pw,RGB_ETC1_Format:()=>ZS,RGB_ETC2_Format:()=>KS,RGB_PVRTC_2BPPV1_Format:()=>XS,RGB_PVRTC_4BPPV1_Format:()=>jS,RGB_S3TC_DXT1_Format:()=>V1,RGDepthPacking:()=>sJe,RGFormat:()=>j6,RGIntegerFormat:()=>lM,RawShaderMaterial:()=>Nw,Ray:()=>_o,Raycaster:()=>Sd,Rec709Primaries:()=>ty,RectAreaLight:()=>Yw,RedFormat:()=>oM,RedIntegerFormat:()=>Oy,ReinhardToneMapping:()=>_oe,RenderTarget:()=>xw,RepeatWrapping:()=>td,ReplaceStencilOp:()=>oJe,ReverseSubtractEquation:()=>Zae,RingGeometry:()=>cg,SIGNED_RED_GREEN_RGTC2_Format:()=>vw,SIGNED_RED_RGTC1_Format:()=>mw,SRGBColorSpace:()=>yi,SRGBTransfer:()=>Hr,Scene:()=>ea,ShaderChunk:()=>Hn,ShaderLib:()=>al,ShaderMaterial:()=>fr,ShadowMaterial:()=>Fw,Shape:()=>ki,ShapeGeometry:()=>Mo,ShapePath:()=>Md,ShapeUtils:()=>Ds,ShortType:()=>H6,Skeleton:()=>rg,SkeletonHelper:()=>C6,SkinnedMesh:()=>ww,Source:()=>ll,Sphere:()=>ir,SphereGeometry:()=>gd,Spherical:()=>w6,SphericalHarmonics3:()=>$w,SplineCurve:()=>fd,SpotLight:()=>jw,SpotLightHelper:()=>A6,Sprite:()=>Tw,SpriteMaterial:()=>dy,SrcAlphaFactor:()=>GS,SrcAlphaSaturateFactor:()=>ooe,SrcColorFactor:()=>toe,StaticCopyUsage:()=>wJe,StaticDrawUsage:()=>ry,StaticReadUsage:()=>_Je,StereoCamera:()=>p6,StreamCopyUsage:()=>AJe,StreamDrawUsage:()=>EJe,StreamReadUsage:()=>SJe,StringKeyframeTrack:()=>ou,SubtractEquation:()=>$ae,SubtractiveBlending:()=>Ck,TOUCH:()=>ZKe,TangentSpaceNormalMap:()=>mh,TetrahedronGeometry:()=>ug,Texture:()=>ei,TextureLoader:()=>dh,TextureUtils:()=>Nrt,TorusGeometry:()=>hg,TorusKnotGeometry:()=>fg,Triangle:()=>Pr,TriangleFanDrawMode:()=>Loe,TriangleStripDrawMode:()=>Ooe,TrianglesDrawMode:()=>Doe,TubeGeometry:()=>dg,UVMapping:()=>rM,Uint16BufferAttribute:()=>ly,Uint32BufferAttribute:()=>cy,Uint8BufferAttribute:()=>oy,Uint8ClampedBufferAttribute:()=>Fk,Uniform:()=>Td,UniformsGroup:()=>E6,UniformsLib:()=>qt,UniformsUtils:()=>fM,UnsignedByteType:()=>Xl,UnsignedInt248Type:()=>rd,UnsignedInt5999Type:()=>V6,UnsignedIntType:()=>nu,UnsignedShort4444Type:()=>sM,UnsignedShort5551Type:()=>aM,UnsignedShortType:()=>Zm,VSMShadowMap:()=>Wl,Vector2:()=>Te,Vector3:()=>q,Vector4:()=>hr,VectorKeyframeTrack:()=>bd,VideoTexture:()=>Kk,WebGL3DRenderTarget:()=>Lk,WebGLArrayRenderTarget:()=>Ok,WebGLCoordinateSystem:()=>jl,WebGLCubeRenderTarget:()=>Ew,WebGLMultipleRenderTargets:()=>N6,WebGLRenderTarget:()=>Qs,WebGLRenderer:()=>hl,WebGLUtils:()=>ele,WebGPUCoordinateSystem:()=>iy,WireframeGeometry:()=>kw,WrapAroundEnding:()=>Q1,ZeroCurvatureEnding:()=>Yf,ZeroFactor:()=>Qae,ZeroSlopeEnding:()=>$f,ZeroStencilOp:()=>aJe,createCanvasElement:()=>joe});var Eg="167",$Ke={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ZKe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},jae=0,Mk=1,Xae=2,KKe=3,JKe=0,B6=1,nM=2,Wl=3,Os=0,zi=1,Mr=2,Qc=0,Kf=1,Ak=2,Ck=3,Rk=4,Yae=5,oh=100,$ae=101,Zae=102,Kae=103,Jae=104,Qae=200,eoe=201,toe=202,noe=203,GS=204,WS=205,roe=206,ioe=207,soe=208,aoe=209,ooe=210,loe=211,coe=212,uoe=213,hoe=214,foe=0,doe=1,poe=2,Z1=3,moe=4,goe=5,voe=6,yoe=7,Iy=0,xoe=1,boe=2,eu=0,Eoe=1,_oe=2,Toe=3,Soe=4,woe=5,Moe=6,Aoe=7,Pk="attached",Coe="detached",rM=300,tu=301,ch=302,K1=303,J1=304,_g=306,td=1e3,xa=1001,nd=1002,Li=1003,Dy=1004,QKe=1004,lh=1005,eJe=1005,Dr=1006,Jf=1007,tJe=1007,Eo=1008,nJe=1008,Xl=1009,U6=1010,H6=1011,Zm=1012,iM=1013,nu=1014,ns=1015,ja=1016,sM=1017,aM=1018,rd=1020,V6=35902,z6=1021,q6=1022,vs=1023,G6=1024,W6=1025,Qf=1026,id=1027,oM=1028,Oy=1029,j6=1030,lM=1031,rJe=1032,cM=1033,V1=33776,z1=33777,q1=33778,G1=33779,jS=35840,XS=35841,YS=35842,$S=35843,ZS=36196,KS=37492,JS=37496,QS=37808,ew=37809,tw=37810,nw=37811,rw=37812,iw=37813,sw=37814,aw=37815,ow=37816,lw=37817,cw=37818,uw=37819,hw=37820,fw=37821,W1=36492,dw=36494,pw=36495,X6=36283,mw=36284,gw=36285,vw=36286,Roe=2200,Poe=2201,Ioe=2202,sd=2300,Km=2301,qS=2302,Yf=2400,$f=2401,Q1=2402,uM=2500,Y6=2501,Doe=0,Ooe=1,Loe=2,koe=3200,Foe=3201,iJe=3202,sJe=3203,mh=0,Noe=1,ol="",yi="srgb",fl="srgb-linear",hM="display-p3",Ly="display-p3-linear",ey="linear",Hr="srgb",ty="rec709",ny="p3",aJe=0,Wf=7680,oJe=7681,lJe=7682,cJe=7683,uJe=34055,hJe=34056,fJe=5386,dJe=512,pJe=513,mJe=514,gJe=515,vJe=516,yJe=517,xJe=518,Ik=519,Boe=512,Uoe=513,Hoe=514,$6=515,Voe=516,zoe=517,qoe=518,Goe=519,ry=35044,bJe=35048,EJe=35040,_Je=35045,TJe=35049,SJe=35041,wJe=35046,MJe=35050,AJe=35042,CJe="100",Dk="300 es",jl=2e3,iy=2001,cl=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}},Rs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],dse=1234567,ed=Math.PI/180,Jm=180/Math.PI;function qa(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Rs[255&e]+Rs[e>>8&255]+Rs[e>>16&255]+Rs[e>>24&255]+"-"+Rs[255&t]+Rs[t>>8&255]+"-"+Rs[t>>16&15|64]+Rs[t>>24&255]+"-"+Rs[63&n|128]+Rs[n>>8&255]+"-"+Rs[n>>16&255]+Rs[n>>24&255]+Rs[255&r]+Rs[r>>8&255]+Rs[r>>16&255]+Rs[r>>24&255]).toLowerCase()}function xi(e,t,n){return Math.max(t,Math.min(n,e))}function Z6(e,t){return(e%t+t)%t}function RJe(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)}function PJe(e,t,n){return e!==t?(n-e)/(t-e):0}function j1(e,t,n){return(1-n)*e+n*t}function IJe(e,t,n,r){return j1(e,t,1-Math.exp(-n*r))}function DJe(e,t=1){return t-Math.abs(Z6(e,2*t)-t)}function OJe(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)}function LJe(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)}function kJe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function FJe(e,t){return e+Math.random()*(t-e)}function NJe(e){return e*(.5-Math.random())}function BJe(e){void 0!==e&&(dse=e);let t=dse+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}function UJe(e){return e*ed}function HJe(e){return e*Jm}function VJe(e){return 0==(e&e-1)&&0!==e}function zJe(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function qJe(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function GJe(e,t,n,r,i){let a=Math.cos,s=Math.sin,o=a(n/2),l=s(n/2),h=a((t+r)/2),u=s((t+r)/2),c=a((t-r)/2),d=s((t-r)/2),p=a((r-t)/2),f=s((r-t)/2);switch(i){case"XYX":e.set(o*u,l*c,l*d,o*h);break;case"YZY":e.set(l*d,o*u,l*c,o*h);break;case"ZXZ":e.set(l*c,l*d,o*u,o*h);break;case"XZX":e.set(o*u,l*f,l*p,o*h);break;case"YXY":e.set(l*p,o*u,l*f,o*h);break;case"ZYZ":e.set(l*f,l*p,o*u,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Js(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Nn(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var zr={DEG2RAD:ed,RAD2DEG:Jm,generateUUID:qa,clamp:xi,euclideanModulo:Z6,mapLinear:RJe,inverseLerp:PJe,lerp:j1,damp:IJe,pingpong:DJe,smoothstep:OJe,smootherstep:LJe,randInt:kJe,randFloat:FJe,randFloatSpread:NJe,seededRandom:BJe,degToRad:UJe,radToDeg:HJe,isPowerOfTwo:VJe,ceilPowerOfTwo:zJe,floorPowerOfTwo:qJe,setQuaternionFromProperEuler:GJe,normalize:Nn,denormalize:Js},Te=class{constructor(e=0,t=0){Te.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Tn=class{constructor(e,t,n,r,i,a,s,o,l){Tn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l)}set(e,t,n,r,i,a,s,o,l){let h=this.elements;return h[0]=e,h[1]=r,h[2]=s,h[3]=t,h[4]=i,h[5]=o,h[6]=n,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[3],o=n[6],l=n[1],h=n[4],u=n[7],c=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],b=r[2],_=r[5],w=r[8];return i[0]=a*f+s*v+o*b,i[3]=a*m+s*y+o*_,i[6]=a*g+s*x+o*w,i[1]=l*f+h*v+u*b,i[4]=l*m+h*y+u*_,i[7]=l*g+h*x+u*w,i[2]=c*f+d*v+p*b,i[5]=c*m+d*y+p*_,i[8]=c*g+d*x+p*w,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8];return t*a*h-t*s*l-n*i*h+n*s*o+r*i*l-r*a*o}invert(){let e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],u=h*a-s*l,c=s*o-h*i,d=l*i-a*o,p=t*u+n*c+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-h*n)*f,e[2]=(s*n-r*a)*f,e[3]=c*f,e[4]=(h*t-r*o)*f,e[5]=(r*i-s*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(a*t-n*i)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,a,s){let o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*a+l*s)+a+e,-r*l,r*o,-r*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(VL.makeScale(e,t)),this}rotate(e){return this.premultiply(VL.makeRotation(-e)),this}translate(e,t){return this.premultiply(VL.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},VL=new Tn;function Woe(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var WJe={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Gm(e,t){return new WJe[e](t)}function sy(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function joe(){let e=sy("canvas");return e.style.display="block",e}var pse={};function Xm(e){e in pse||(pse[e]=!0,console.warn(e))}function jJe(e,t,n){return new Promise((function(r,i){setTimeout((function a(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(a,n);break;default:r()}}),n)}))}var mse=(new Tn).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),gse=(new Tn).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),M1={[fl]:{transfer:ey,primaries:ty,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e,fromReference:e=>e},[yi]:{transfer:Hr,primaries:ty,luminanceCoefficients:[.2126,.7152,.0722],toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[Ly]:{transfer:ey,primaries:ny,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.applyMatrix3(gse),fromReference:e=>e.applyMatrix3(mse)},[hM]:{transfer:Hr,primaries:ny,luminanceCoefficients:[.2289,.6917,.0793],toReference:e=>e.convertSRGBToLinear().applyMatrix3(gse),fromReference:e=>e.applyMatrix3(mse).convertLinearToSRGB()}},XJe=new Set([fl,Ly]),vr={enabled:!0,_workingColorSpace:fl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!XJe.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,n){if(!1===this.enabled||t===n||!t||!n)return e;let r=M1[t].toReference;return(0,M1[n].fromReference)(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return M1[e].primaries},getTransfer:function(e){return e===ol?ey:M1[e].transfer},getLuminanceCoefficients:function(e,t=this._workingColorSpace){return e.fromArray(M1[t].luminanceCoefficients)}};function Ym(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function zL(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Tm,yw=class{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Tm&&(Tm=sy("canvas")),Tm.width=e.width,Tm.height=e.height;let n=Tm.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Tm}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=sy("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*Ym(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Ym(t[e]/255)):t[e]=Ym(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},YJe=0,ll=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:YJe++}),this.uuid=qa(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(qL(r[t].image)):e.push(qL(r[t]))}else e=qL(r);n.url=e}return t||(e.images[this.uuid]=n),n}};function qL(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yw.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var $Je=0,ei=class extends cl{constructor(e=ei.DEFAULT_IMAGE,t=ei.DEFAULT_MAPPING,n=xa,r=xa,i=Dr,a=Eo,s=vs,o=Xl,l=ei.DEFAULT_ANISOTROPY,h=ol){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:$Je++}),this.uuid=qa(),this.name="",this.source=new ll(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new Te(0,0),this.repeat=new Te(1,1),this.center=new Te(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==rM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case td:e.x=e.x-Math.floor(e.x);break;case xa:e.x=e.x<0?0:1;break;case nd:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case td:e.y=e.y-Math.floor(e.y);break;case xa:e.y=e.y<0?0:1;break;case nd:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}};ei.DEFAULT_IMAGE=null,ei.DEFAULT_MAPPING=rM,ei.DEFAULT_ANISOTROPY=1;var hr=class{constructor(e=0,t=0,n=0,r=1){hr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i,a=e.elements,s=a[0],o=a[4],l=a[8],h=a[1],u=a[5],c=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(o-h)<.01&&Math.abs(l-d)<.01&&Math.abs(c-p)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+d)<.1&&Math.abs(c+p)<.1&&Math.abs(s+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(u+1)/2,m=(f+1)/2,g=(o+h)/4,v=(l+d)/4,y=(c+p)/4;return e>a&&e>m?e<.01?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=g/n,i=v/n):a>m?a<.01?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=g/r,i=y/r):m<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=v/i,r=y/i),this.set(n,r,i,t),this}let m=Math.sqrt((p-c)*(p-c)+(l-d)*(l-d)+(h-o)*(h-o));return Math.abs(m)<.001&&(m=1),this.x=(p-c)/m,this.y=(l-d)/m,this.z=(h-o)/m,this.w=Math.acos((s+u+f-1)/2),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},xw=class extends cl{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new hr(0,0,e,t),this.scissorTest=!1,this.viewport=new hr(0,0,e,t);let r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);let i=new ei(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];let a=n.count;for(let e=0;e<a;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++)this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new ll(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Qs=class extends xw{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}},Qm=class extends ei{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Li,this.minFilter=Li,this.wrapR=xa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},Ok=class extends Qs{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Qm(null,e,t,n),this.texture.isRenderTargetTexture=!0}},ay=class extends ei{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Li,this.minFilter=Li,this.wrapR=xa,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Lk=class extends Qs{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new ay(null,e,t,n),this.texture.isRenderTargetTexture=!0}},Ci=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,a,s){let o=n[r+0],l=n[r+1],h=n[r+2],u=n[r+3],c=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=h,void(e[t+3]=u);if(1===s)return e[t+0]=c,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(u!==f||o!==c||l!==d||h!==p){let e=1-s,t=o*c+l*d+h*p+u*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){let i=Math.sqrt(r),a=Math.atan2(i,t*n);e=Math.sin(e*a)/i,s=Math.sin(s*a)/i}let i=s*n;if(o=o*e+c*i,l=l*e+d*i,h=h*e+p*i,u=u*e+f*i,e===1-s){let e=1/Math.sqrt(o*o+l*l+h*h+u*u);o*=e,l*=e,h*=e,u*=e}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,a){let s=n[r],o=n[r+1],l=n[r+2],h=n[r+3],u=i[a],c=i[a+1],d=i[a+2],p=i[a+3];return e[t]=s*p+h*u+o*d-l*c,e[t+1]=o*p+h*c+l*u-s*d,e[t+2]=l*p+h*d+s*c-o*u,e[t+3]=h*p-s*u-o*c-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let n=e._x,r=e._y,i=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(n/2),h=s(r/2),u=s(i/2),c=o(n/2),d=o(r/2),p=o(i/2);switch(a){case"XYZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"YXZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"ZXY":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"ZYX":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"YZX":this._x=c*h*u+l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u-c*d*p;break;case"XZY":this._x=c*h*u-l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],s=t[5],o=t[9],l=t[2],h=t[6],u=t[10],c=n+s+u;if(c>0){let e=.5/Math.sqrt(c+1);this._w=.25/e,this._x=(h-o)*e,this._y=(i-l)*e,this._z=(a-r)*e}else if(n>s&&n>u){let e=2*Math.sqrt(1+n-s-u);this._w=(h-o)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(i+l)/e}else if(s>u){let e=2*Math.sqrt(1+s-n-u);this._w=(i-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(o+h)/e}else{let e=2*Math.sqrt(1+u-n-s);this._w=(a-r)/e,this._x=(i+l)/e,this._y=(o+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(xi(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(0===n)return this;let r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,r=e._y,i=e._z,a=e._w,s=t._x,o=t._y,l=t._z,h=t._w;return this._x=n*h+a*s+r*l-i*o,this._y=r*h+a*o+i*s-n*l,this._z=i*h+a*l+n*o-r*s,this._w=a*h-n*s-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let n=this._x,r=this._y,i=this._z,a=this._w,s=a*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}let l=Math.sqrt(o),h=Math.atan2(l,s),u=Math.sin((1-t)*h)/l,c=Math.sin(t*h)/l;return this._w=a*u+this._w*c,this._x=n*u+this._x*c,this._y=r*u+this._y*c,this._z=i*u+this._z*c,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){let e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},q=class{constructor(e=0,t=0,n=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(vse.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(vse.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}applyQuaternion(e){let t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*r-s*n),h=2*(s*t-i*r),u=2*(i*n-a*t);return this.x=t+o*l+a*u-s*h,this.y=n+o*h+s*l-i*u,this.z=r+o*u+i*h-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,r=e.y,i=e.z,a=t.x,s=t.y,o=t.z;return this.x=r*o-i*s,this.y=i*a-n*o,this.z=n*s-r*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return GL.copy(this).projectOnVector(e),this.sub(GL)}reflect(e){return this.sub(GL.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(xi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},GL=new q,vse=new Ci,Ft=class{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(rl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(rl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=rl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(void 0!==n){let r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,rl):rl.fromBufferAttribute(r,t),rl.applyMatrix4(e.matrixWorld),this.expandByPoint(rl);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),KT.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),KT.copy(n.boundingBox)),KT.applyMatrix4(e.matrixWorld),this.union(KT)}let r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,rl),rl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(A1),JT.subVectors(this.max,A1),Sm.subVectors(e.a,A1),wm.subVectors(e.b,A1),Mm.subVectors(e.c,A1),Qu.subVectors(wm,Sm),eh.subVectors(Mm,wm),Of.subVectors(Sm,Mm);let t=[0,-Qu.z,Qu.y,0,-eh.z,eh.y,0,-Of.z,Of.y,Qu.z,0,-Qu.x,eh.z,0,-eh.x,Of.z,0,-Of.x,-Qu.y,Qu.x,0,-eh.y,eh.x,0,-Of.y,Of.x,0];return!(!WL(t,Sm,wm,Mm,JT)||(t=[1,0,0,0,1,0,0,0,1],!WL(t,Sm,wm,Mm,JT)))&&(QT.crossVectors(Qu,eh),t=[QT.x,QT.y,QT.z],WL(t,Sm,wm,Mm,JT))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,rl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(rl).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Wc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wc)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Wc=[new q,new q,new q,new q,new q,new q,new q,new q],rl=new q,KT=new Ft,Sm=new q,wm=new q,Mm=new q,Qu=new q,eh=new q,Of=new q,A1=new q,JT=new q,QT=new q,Lf=new q;function WL(e,t,n,r,i){for(let a=0,s=e.length-3;a<=s;a+=3){Lf.fromArray(e,a);let s=i.x*Math.abs(Lf.x)+i.y*Math.abs(Lf.y)+i.z*Math.abs(Lf.z),o=t.dot(Lf),l=n.dot(Lf),h=r.dot(Lf);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>s)return!1}return!0}var ZJe=new Ft,C1=new q,jL=new q,ir=class{constructor(e=new q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;void 0!==t?n.copy(t):ZJe.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;C1.subVectors(e,this.center);let t=C1.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(C1,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(jL.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(C1.copy(e.center).add(jL)),this.expandByPoint(C1.copy(e.center).sub(jL))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},jc=new q,XL=new q,eS=new q,th=new q,YL=new q,tS=new q,$L=new q,_o=class{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,jc)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=jc.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(jc.copy(this.origin).addScaledVector(this.direction,t),jc.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){XL.copy(e).add(t).multiplyScalar(.5),eS.copy(t).sub(e).normalize(),th.copy(this.origin).sub(XL);let i,a,s,o,l=.5*e.distanceTo(t),h=-this.direction.dot(eS),u=th.dot(this.direction),c=-th.dot(eS),d=th.lengthSq(),p=Math.abs(1-h*h);if(p>0)if(i=h*c-u,a=h*u-c,o=l*p,i>=0)if(a>=-o)if(a<=o){let e=1/p;i*=e,a*=e,s=i*(i+h*a+2*u)+a*(h*i+a+2*c)+d}else a=l,i=Math.max(0,-(h*a+u)),s=-i*i+a*(a+2*c)+d;else a=-l,i=Math.max(0,-(h*a+u)),s=-i*i+a*(a+2*c)+d;else a<=-o?(i=Math.max(0,-(-h*l+u)),a=i>0?-l:Math.min(Math.max(-l,-c),l),s=-i*i+a*(a+2*c)+d):a<=o?(i=0,a=Math.min(Math.max(-l,-c),l),s=a*(a+2*c)+d):(i=Math.max(0,-(h*l+u)),a=i>0?l:Math.min(Math.max(-l,-c),l),s=-i*i+a*(a+2*c)+d);else a=h>0?-l:l,i=Math.max(0,-(h*a+u)),s=-i*i+a*(a+2*c)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,i),r&&r.copy(XL).addScaledVector(eS,a),s}intersectSphere(e,t){jc.subVectors(e.center,this.origin);let n=jc.dot(this.direction),r=jc.dot(jc)-n*n,i=e.radius*e.radius;if(r>i)return null;let a=Math.sqrt(i-r),s=n-a,o=n+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,a,s,o,l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,c=this.origin;return l>=0?(n=(e.min.x-c.x)*l,r=(e.max.x-c.x)*l):(n=(e.max.x-c.x)*l,r=(e.min.x-c.x)*l),h>=0?(i=(e.min.y-c.y)*h,a=(e.max.y-c.y)*h):(i=(e.max.y-c.y)*h,a=(e.min.y-c.y)*h),n>a||i>r||((i>n||isNaN(n))&&(n=i),(a<r||isNaN(r))&&(r=a),u>=0?(s=(e.min.z-c.z)*u,o=(e.max.z-c.z)*u):(s=(e.max.z-c.z)*u,o=(e.min.z-c.z)*u),n>o||s>r)||((s>n||n!=n)&&(n=s),(o<r||r!=r)&&(r=o),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return null!==this.intersectBox(e,jc)}intersectTriangle(e,t,n,r,i){YL.subVectors(t,e),tS.subVectors(n,e),$L.crossVectors(YL,tS);let a,s=this.direction.dot($L);if(s>0){if(r)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}th.subVectors(this.origin,e);let o=a*this.direction.dot(tS.crossVectors(th,tS));if(o<0)return null;let l=a*this.direction.dot(YL.cross(th));if(l<0||o+l>s)return null;let h=-a*th.dot($L);return h<0?null:this.at(h/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},At=class{constructor(e,t,n,r,i,a,s,o,l,h,u,c,d,p,f,m){At.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,a,s,o,l,h,u,c,d,p,f,m)}set(e,t,n,r,i,a,s,o,l,h,u,c,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=u,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new At).fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,r=1/Am.setFromMatrixColumn(e,0).length(),i=1/Am.setFromMatrixColumn(e,1).length(),a=1/Am.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),s=Math.sin(n),o=Math.cos(r),l=Math.sin(r),h=Math.cos(i),u=Math.sin(i);if("XYZ"===e.order){let e=a*h,n=a*u,r=s*h,i=s*u;t[0]=o*h,t[4]=-o*u,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-s*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*h,n=o*u,r=l*h,i=l*u;t[0]=e+i*s,t[4]=r*s-n,t[8]=a*l,t[1]=a*u,t[5]=a*h,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*h,n=o*u,r=l*h,i=l*u;t[0]=e-i*s,t[4]=-a*u,t[8]=r+n*s,t[1]=n+r*s,t[5]=a*h,t[9]=i-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*h,n=a*u,r=s*h,i=s*u;t[0]=o*h,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*u,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*h,t[4]=i-e*u,t[8]=r*u+n,t[1]=u,t[5]=a*h,t[9]=-s*h,t[2]=-l*h,t[6]=n*u+r,t[10]=e-i*u}else if("XZY"===e.order){let e=a*o,n=a*l,r=s*o,i=s*l;t[0]=o*h,t[4]=-u,t[8]=l*h,t[1]=e*u+i,t[5]=a*h,t[9]=n*u-r,t[2]=r*u-n,t[6]=s*h,t[10]=i*u+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(KJe,e,JJe)}lookAt(e,t,n){let r=this.elements;return Va.subVectors(e,t),0===Va.lengthSq()&&(Va.z=1),Va.normalize(),nh.crossVectors(n,Va),0===nh.lengthSq()&&(1===Math.abs(n.z)?Va.x+=1e-4:Va.z+=1e-4,Va.normalize(),nh.crossVectors(n,Va)),nh.normalize(),nS.crossVectors(Va,nh),r[0]=nh.x,r[4]=nS.x,r[8]=Va.x,r[1]=nh.y,r[5]=nS.y,r[9]=Va.y,r[2]=nh.z,r[6]=nS.z,r[10]=Va.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,r=t.elements,i=this.elements,a=n[0],s=n[4],o=n[8],l=n[12],h=n[1],u=n[5],c=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=r[0],w=r[4],S=r[8],M=r[12],T=r[1],E=r[5],A=r[9],C=r[13],P=r[2],I=r[6],R=r[10],L=r[14],O=r[3],D=r[7],k=r[11],N=r[15];return i[0]=a*_+s*T+o*P+l*O,i[4]=a*w+s*E+o*I+l*D,i[8]=a*S+s*A+o*R+l*k,i[12]=a*M+s*C+o*L+l*N,i[1]=h*_+u*T+c*P+d*O,i[5]=h*w+u*E+c*I+d*D,i[9]=h*S+u*A+c*R+d*k,i[13]=h*M+u*C+c*L+d*N,i[2]=p*_+f*T+m*P+g*O,i[6]=p*w+f*E+m*I+g*D,i[10]=p*S+f*A+m*R+g*k,i[14]=p*M+f*C+m*L+g*N,i[3]=v*_+y*T+x*P+b*O,i[7]=v*w+y*E+x*I+b*D,i[11]=v*S+y*A+x*R+b*k,i[15]=v*M+y*C+x*L+b*N,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],s=e[5],o=e[9],l=e[13],h=e[2],u=e[6],c=e[10],d=e[14];return e[3]*(+i*o*u-r*l*u-i*s*c+n*l*c+r*s*d-n*o*d)+e[7]*(+t*o*d-t*l*c+i*a*c-r*a*d+r*l*h-i*o*h)+e[11]*(+t*l*u-t*s*d-i*a*u+n*a*d+i*s*h-n*l*h)+e[15]*(-r*s*h-t*o*u+t*s*c+r*a*u-n*a*c+n*o*h)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,n){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*c*l+f*o*d-s*m*d-u*o*g+s*c*g,y=p*c*l-h*m*l-p*o*d+a*m*d+h*o*g-a*c*g,x=h*f*l-p*u*l+p*s*d-a*f*d-h*s*g+a*u*g,b=p*u*o-h*f*o-p*s*c+a*f*c+h*s*m-a*u*m,_=t*v+n*y+r*x+i*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/_;return e[0]=v*w,e[1]=(f*c*i-u*m*i-f*r*d+n*m*d+u*r*g-n*c*g)*w,e[2]=(s*m*i-f*o*i+f*r*l-n*m*l-s*r*g+n*o*g)*w,e[3]=(u*o*i-s*c*i-u*r*l+n*c*l+s*r*d-n*o*d)*w,e[4]=y*w,e[5]=(h*m*i-p*c*i+p*r*d-t*m*d-h*r*g+t*c*g)*w,e[6]=(p*o*i-a*m*i-p*r*l+t*m*l+a*r*g-t*o*g)*w,e[7]=(a*c*i-h*o*i+h*r*l-t*c*l-a*r*d+t*o*d)*w,e[8]=x*w,e[9]=(p*u*i-h*f*i-p*n*d+t*f*d+h*n*g-t*u*g)*w,e[10]=(a*f*i-p*s*i+p*n*l-t*f*l-a*n*g+t*s*g)*w,e[11]=(h*s*i-a*u*i-h*n*l+t*u*l+a*n*d-t*s*d)*w,e[12]=b*w,e[13]=(h*f*r-p*u*r+p*n*c-t*f*c-h*n*m+t*u*m)*w,e[14]=(p*s*r-a*f*r-p*n*o+t*f*o+a*n*m-t*s*m)*w,e[15]=(a*u*r-h*s*r+h*n*o-t*u*o-a*n*c+t*s*c)*w,this}scale(e){let t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,s=e.y,o=e.z,l=i*a,h=i*s;return this.set(l*a+n,l*s-r*o,l*o+r*s,0,l*s+r*o,h*s+n,h*o-r*a,0,l*o-r*s,h*o+r*a,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){let r=this.elements,i=t._x,a=t._y,s=t._z,o=t._w,l=i+i,h=a+a,u=s+s,c=i*l,d=i*h,p=i*u,f=a*h,m=a*u,g=s*u,v=o*l,y=o*h,x=o*u,b=n.x,_=n.y,w=n.z;return r[0]=(1-(f+g))*b,r[1]=(d+x)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-x)*_,r[5]=(1-(c+g))*_,r[6]=(m+v)*_,r[7]=0,r[8]=(p+y)*w,r[9]=(m-v)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){let r=this.elements,i=Am.set(r[0],r[1],r[2]).length(),a=Am.set(r[4],r[5],r[6]).length(),s=Am.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],il.copy(this);let o=1/i,l=1/a,h=1/s;return il.elements[0]*=o,il.elements[1]*=o,il.elements[2]*=o,il.elements[4]*=l,il.elements[5]*=l,il.elements[6]*=l,il.elements[8]*=h,il.elements[9]*=h,il.elements[10]*=h,t.setFromRotationMatrix(il),n.x=i,n.y=a,n.z=s,this}makePerspective(e,t,n,r,i,a,s=jl){let o,l,h=this.elements,u=2*i/(t-e),c=2*i/(n-r),d=(t+e)/(t-e),p=(n+r)/(n-r);if(s===jl)o=-(a+i)/(a-i),l=-2*a*i/(a-i);else{if(s!==iy)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);o=-a/(a-i),l=-a*i/(a-i)}return h[0]=u,h[4]=0,h[8]=d,h[12]=0,h[1]=0,h[5]=c,h[9]=p,h[13]=0,h[2]=0,h[6]=0,h[10]=o,h[14]=l,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,n,r,i,a,s=jl){let o,l,h=this.elements,u=1/(t-e),c=1/(n-r),d=1/(a-i),p=(t+e)*u,f=(n+r)*c;if(s===jl)o=(a+i)*d,l=-2*d;else{if(s!==iy)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);o=i*d,l=-1*d}return h[0]=2*u,h[4]=0,h[8]=0,h[12]=-p,h[1]=0,h[5]=2*c,h[9]=0,h[13]=-f,h[2]=0,h[6]=0,h[10]=l,h[14]=-o,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}},Am=new q,il=new At,KJe=new q(0,0,0),JJe=new q(1,1,1),nh=new q,nS=new q,Va=new q,yse=new At,xse=new Ci,Fi=class{constructor(e=0,t=0,n=0,r=Fi.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){let r=e.elements,i=r[0],a=r[4],s=r[8],o=r[1],l=r[5],h=r[9],u=r[2],c=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(xi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-xi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,i),this._z=0);break;case"ZXY":this._x=Math.asin(xi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-xi(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(xi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,i)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-xi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return yse.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yse,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xse.setFromEuler(this),this.setFromQuaternion(xse,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Fi.DEFAULT_ORDER="XYZ";var uh=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}},QJe=0,bse=new q,Cm=new Ci,Xc=new At,rS=new q,R1=new q,eQe=new q,tQe=new Ci,Ese=new q(1,0,0),_se=new q(0,1,0),Tse=new q(0,0,1),Sse={type:"added"},nQe={type:"removed"},Rm={type:"childadded",child:null},ZL={type:"childremoved",child:null},Cn=class extends cl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:QJe++}),this.uuid=qa(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cn.DEFAULT_UP.clone();let e=new q,t=new Fi,n=new Ci,r=new q(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new At},normalMatrix:{value:new Tn}}),this.matrix=new At,this.matrixWorld=new At,this.matrixAutoUpdate=Cn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new uh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Cm.setFromAxisAngle(e,t),this.quaternion.multiply(Cm),this}rotateOnWorldAxis(e,t){return Cm.setFromAxisAngle(e,t),this.quaternion.premultiply(Cm),this}rotateX(e){return this.rotateOnAxis(Ese,e)}rotateY(e){return this.rotateOnAxis(_se,e)}rotateZ(e){return this.rotateOnAxis(Tse,e)}translateOnAxis(e,t){return bse.copy(e).applyQuaternion(this.quaternion),this.position.add(bse.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ese,e)}translateY(e){return this.translateOnAxis(_se,e)}translateZ(e){return this.translateOnAxis(Tse,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Xc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?rS.copy(e):rS.set(e,t,n);let r=this.parent;this.updateWorldMatrix(!0,!1),R1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xc.lookAt(R1,rS,this.up):Xc.lookAt(rS,R1,this.up),this.quaternion.setFromRotationMatrix(Xc),r&&(Xc.extractRotation(r.matrixWorld),Cm.setFromRotationMatrix(Xc),this.quaternion.premultiply(Cm.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Sse),Rm.child=e,this.dispatchEvent(Rm),Rm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(nQe),ZL.child=e,this.dispatchEvent(ZL),ZL.child=null),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Xc.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Xc.multiply(e.parent.matrixWorld)),e.applyMatrix4(Xc),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Sse),Rm.child=e,this.dispatchEvent(Rm),Rm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);let r=this.children;for(let i=0,a=r.length;i<a;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R1,e,eQe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(R1,tQe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){let e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){let t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){let r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){let n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){let t=a(e.geometries),r=a(e.materials),i=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),h=a(e.animations),u=a(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),h.length>0&&(n.animations=h),u.length>0&&(n.nodes=u)}return n.object=r,n;function a(e){let t=[];for(let n in e){let r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let n=e.children[t];this.add(n.clone())}return this}};Cn.DEFAULT_UP=new q(0,1,0),Cn.DEFAULT_MATRIX_AUTO_UPDATE=!0,Cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var sl=new q,Yc=new q,KL=new q,$c=new q,Pm=new q,Im=new q,wse=new q,JL=new q,QL=new q,ek=new q,Pr=class{constructor(e=new q,t=new q,n=new q){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),sl.subVectors(e,t),r.cross(sl);let i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){sl.subVectors(r,t),Yc.subVectors(n,t),KL.subVectors(e,t);let a=sl.dot(sl),s=sl.dot(Yc),o=sl.dot(KL),l=Yc.dot(Yc),h=Yc.dot(KL),u=a*l-s*s;if(0===u)return i.set(0,0,0),null;let c=1/u,d=(l*o-s*h)*c,p=(a*h-s*o)*c;return i.set(1-d-p,p,d)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,$c)&&($c.x>=0&&$c.y>=0&&$c.x+$c.y<=1)}static getInterpolation(e,t,n,r,i,a,s,o){return null===this.getBarycoord(e,t,n,r,$c)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(i,$c.x),o.addScaledVector(a,$c.y),o.addScaledVector(s,$c.z),o)}static isFrontFacing(e,t,n,r){return sl.subVectors(n,t),Yc.subVectors(e,t),sl.cross(Yc).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return sl.subVectors(this.c,this.b),Yc.subVectors(this.a,this.b),.5*sl.cross(Yc).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Pr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Pr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return Pr.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return Pr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Pr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n,r,i=this.a,a=this.b,s=this.c;Pm.subVectors(a,i),Im.subVectors(s,i),JL.subVectors(e,i);let o=Pm.dot(JL),l=Im.dot(JL);if(o<=0&&l<=0)return t.copy(i);QL.subVectors(e,a);let h=Pm.dot(QL),u=Im.dot(QL);if(h>=0&&u<=h)return t.copy(a);let c=o*u-h*l;if(c<=0&&o>=0&&h<=0)return n=o/(o-h),t.copy(i).addScaledVector(Pm,n);ek.subVectors(e,s);let d=Pm.dot(ek),p=Im.dot(ek);if(p>=0&&d<=p)return t.copy(s);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(i).addScaledVector(Im,r);let m=h*p-d*u;if(m<=0&&u-h>=0&&d-p>=0)return wse.subVectors(s,a),r=(u-h)/(u-h+(d-p)),t.copy(a).addScaledVector(wse,r);let g=1/(m+f+c);return n=f*g,r=c*g,t.copy(i).addScaledVector(Pm,n).addScaledVector(Im,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Xoe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},rh={h:0,s:0,l:0},iS={h:0,s:0,l:0};function tk(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}var Ot=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){let t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=yi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,vr.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=vr.workingColorSpace){return this.r=e,this.g=t,this.b=n,vr.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=vr.workingColorSpace){if(e=Z6(e,1),t=xi(t,0,1),n=xi(n,0,1),0===t)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=tk(i,r,e+1/3),this.g=tk(i,r,e),this.b=tk(i,r,e-1/3)}return vr.toWorkingColorSpace(this,r),this}setStyle(e,t=yi){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let i,a=r[1],s=r[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,t);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,t);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],i=n.length;if(3===i)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,t);if(6===i)return this.setHex(parseInt(n,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=yi){let n=Xoe[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ym(e.r),this.g=Ym(e.g),this.b=Ym(e.b),this}copyLinearToSRGB(e){return this.r=zL(e.r),this.g=zL(e.g),this.b=zL(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=yi){return vr.fromWorkingColorSpace(Ps.copy(this),e),65536*Math.round(xi(255*Ps.r,0,255))+256*Math.round(xi(255*Ps.g,0,255))+Math.round(xi(255*Ps.b,0,255))}getHexString(e=yi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=vr.workingColorSpace){vr.fromWorkingColorSpace(Ps.copy(this),t);let n,r,i=Ps.r,a=Ps.g,s=Ps.b,o=Math.max(i,a,s),l=Math.min(i,a,s),h=(l+o)/2;if(l===o)n=0,r=0;else{let e=o-l;switch(r=h<=.5?e/(o+l):e/(2-o-l),o){case i:n=(a-s)/e+(a<s?6:0);break;case a:n=(s-i)/e+2;break;case s:n=(i-a)/e+4}n/=6}return e.h=n,e.s=r,e.l=h,e}getRGB(e,t=vr.workingColorSpace){return vr.fromWorkingColorSpace(Ps.copy(this),t),e.r=Ps.r,e.g=Ps.g,e.b=Ps.b,e}getStyle(e=yi){vr.fromWorkingColorSpace(Ps.copy(this),e);let t=Ps.r,n=Ps.g,r=Ps.b;return e!==yi?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(rh),this.setHSL(rh.h+e,rh.s+t,rh.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(rh),e.getHSL(iS);let n=j1(rh.h,iS.h,t),r=j1(rh.s,iS.s,t),i=j1(rh.l,iS.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},Ps=new Ot;Ot.NAMES=Xoe;var rQe=0,Ir=class extends cl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rQe++}),this.uuid=qa(),this.name="",this.type="Material",this.blending=Kf,this.side=Os,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=GS,this.blendDst=WS,this.blendEquation=oh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ot(0,0,0),this.blendAlpha=0,this.depthFunc=Z1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ik,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Wf,this.stencilZFail=Wf,this.stencilZPass=Wf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let n=e[t];if(void 0===n){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){let t=[];for(let n in e){let r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Kf&&(n.blending=this.blending),this.side!==Os&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==GS&&(n.blendSrc=this.blendSrc),this.blendDst!==WS&&(n.blendDst=this.blendDst),this.blendEquation!==oh&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Z1&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Ik&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Wf&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Wf&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Wf&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){let t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(null!==t){let e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}},mr=class extends Ir{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fi,this.combine=Iy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Kc=iQe();function iQe(){let e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:a,exponentTable:s,offsetTable:o}}function ya(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=xi(e,-65504,65504),Kc.floatView[0]=e;let t=Kc.uint32View[0],n=t>>23&511;return Kc.baseTable[n]+((8388607&t)>>Kc.shiftTable[n])}function U1(e){let t=e>>10;return Kc.uint32View[0]=Kc.mantissaTable[Kc.offsetTable[t]+(1023&e)]+Kc.exponentTable[t],Kc.floatView[0]}var Tg={toHalfFloat:ya,fromHalfFloat:U1},Di=new q,sS=new Te,vn=class{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=ry,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ns,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return Xm("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)sS.fromBufferAttribute(this,t),sS.applyMatrix3(e),this.setXY(t,sS.x,sS.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Di.fromBufferAttribute(this,t),Di.applyMatrix3(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Di.fromBufferAttribute(this,t),Di.applyMatrix4(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Di.fromBufferAttribute(this,t),Di.applyNormalMatrix(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Di.fromBufferAttribute(this,t),Di.transformDirection(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Js(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Js(t,this.array)),t}setX(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Js(t,this.array)),t}setY(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Js(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Js(t,this.array)),t}setW(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array),i=Nn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==ry&&(e.usage=this.usage),e}},kk=class extends vn{constructor(e,t,n){super(new Int8Array(e),t,n)}},oy=class extends vn{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Fk=class extends vn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Nk=class extends vn{constructor(e,t,n){super(new Int16Array(e),t,n)}},ly=class extends vn{constructor(e,t,n){super(new Uint16Array(e),t,n)}},Bk=class extends vn{constructor(e,t,n){super(new Int32Array(e),t,n)}},cy=class extends vn{constructor(e,t,n){super(new Uint32Array(e),t,n)}},Uk=class extends vn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=U1(this.array[e*this.itemSize]);return this.normalized&&(t=Js(t,this.array)),t}setX(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize]=ya(t),this}getY(e){let t=U1(this.array[e*this.itemSize+1]);return this.normalized&&(t=Js(t,this.array)),t}setY(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+1]=ya(t),this}getZ(e){let t=U1(this.array[e*this.itemSize+2]);return this.normalized&&(t=Js(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+2]=ya(t),this}getW(e){let t=U1(this.array[e*this.itemSize+3]);return this.normalized&&(t=Js(t,this.array)),t}setW(e,t){return this.normalized&&(t=Nn(t,this.array)),this.array[e*this.itemSize+3]=ya(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array)),this.array[e+0]=ya(t),this.array[e+1]=ya(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array)),this.array[e+0]=ya(t),this.array[e+1]=ya(n),this.array[e+2]=ya(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array),i=Nn(i,this.array)),this.array[e+0]=ya(t),this.array[e+1]=ya(n),this.array[e+2]=ya(r),this.array[e+3]=ya(i),this}},Wt=class extends vn{constructor(e,t,n){super(new Float32Array(e),t,n)}},sQe=0,bo=new At,nk=new Cn,Dm=new q,za=new Ft,P1=new Ft,ts=new q,Nt=class extends cl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:sQe++}),this.uuid=qa(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Woe(e)?cy:ly)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(void 0!==n){let t=(new Tn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}let r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return bo.makeRotationFromQuaternion(e),this.applyMatrix4(bo),this}rotateX(e){return bo.makeRotationX(e),this.applyMatrix4(bo),this}rotateY(e){return bo.makeRotationY(e),this.applyMatrix4(bo),this}rotateZ(e){return bo.makeRotationZ(e),this.applyMatrix4(bo),this}translate(e,t,n){return bo.makeTranslation(e,t,n),this.applyMatrix4(bo),this}scale(e,t,n){return bo.makeScale(e,t,n),this.applyMatrix4(bo),this}lookAt(e){return nk.lookAt(e),nk.updateMatrix(),this.applyMatrix4(nk.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dm).negate(),this.translate(Dm.x,Dm.y,Dm.z),this}setFromPoints(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Wt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ft);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){let n=t[e];za.setFromBufferAttribute(n),this.morphTargetsRelative?(ts.addVectors(this.boundingBox.min,za.min),this.boundingBox.expandByPoint(ts),ts.addVectors(this.boundingBox.max,za.max),this.boundingBox.expandByPoint(ts)):(this.boundingBox.expandByPoint(za.min),this.boundingBox.expandByPoint(za.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ir);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new q,1/0);if(e){let n=this.boundingSphere.center;if(za.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){let n=t[e];P1.setFromBufferAttribute(n),this.morphTargetsRelative?(ts.addVectors(za.min,P1.min),za.expandByPoint(ts),ts.addVectors(za.max,P1.max),za.expandByPoint(ts)):(za.expandByPoint(P1.min),za.expandByPoint(P1.max))}za.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)ts.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(ts));if(t)for(let i=0,a=t.length;i<a;i++){let a=t[i],s=this.morphTargetsRelative;for(let t=0,i=a.count;t<i;t++)ts.fromBufferAttribute(a,t),s&&(Dm.fromBufferAttribute(e,t),ts.add(Dm)),r=Math.max(r,n.distanceToSquared(ts))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new vn(new Float32Array(4*n.count),4));let a=this.getAttribute("tangent"),s=[],o=[];for(let e=0;e<n.count;e++)s[e]=new q,o[e]=new q;let l=new q,h=new q,u=new q,c=new Te,d=new Te,p=new Te,f=new q,m=new q;function g(e,t,r){l.fromBufferAttribute(n,e),h.fromBufferAttribute(n,t),u.fromBufferAttribute(n,r),c.fromBufferAttribute(i,e),d.fromBufferAttribute(i,t),p.fromBufferAttribute(i,r),h.sub(l),u.sub(l),d.sub(c),p.sub(c);let a=1/(d.x*p.y-p.x*d.y);isFinite(a)&&(f.copy(h).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(a),m.copy(u).multiplyScalar(d.x).addScaledVector(h,-p.x).multiplyScalar(a),s[e].add(f),s[t].add(f),s[r].add(f),o[e].add(m),o[t].add(m),o[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let t=0,n=v.length;t<n;++t){let n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}let y=new q,x=new q,b=new q,_=new q;function w(e){b.fromBufferAttribute(r,e),_.copy(b);let t=s[e];y.copy(t),y.sub(b.multiplyScalar(b.dot(t))).normalize(),x.crossVectors(_,t);let n=x.dot(o[e])<0?-1:1;a.setXYZW(e,y.x,y.y,y.z,n)}for(let t=0,n=v.length;t<n;++t){let n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)w(e.getX(t+0)),w(e.getX(t+1)),w(e.getX(t+2))}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new vn(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);let r=new q,i=new q,a=new q,s=new q,o=new q,l=new q,h=new q,u=new q;if(e)for(let c=0,d=e.count;c<d;c+=3){let d=e.getX(c+0),p=e.getX(c+1),f=e.getX(c+2);r.fromBufferAttribute(t,d),i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),h.subVectors(a,i),u.subVectors(r,i),h.cross(u),s.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),s.add(h),o.add(h),l.add(h),n.setXYZ(d,s.x,s.y,s.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),h.subVectors(a,i),u.subVectors(r,i),h.cross(u),n.setXYZ(e+0,h.x,h.y,h.z),n.setXYZ(e+1,h.x,h.y,h.z),n.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ts.fromBufferAttribute(e,t),ts.normalize(),e.setXYZ(t,ts.x,ts.y,ts.z)}toNonIndexed(){function e(e,t){let n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),s=0,o=0;for(let i=0,l=t.length;i<l;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)a[o++]=n[s++]}return new vn(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Nt,n=this.index.array,r=this.attributes;for(let i in r){let a=e(r[i],n);t.setAttribute(i,a)}let i=this.morphAttributes;for(let r in i){let a=[],s=i[r];for(let t=0,r=s.length;t<r;t++){let r=e(s[t],n);a.push(r)}t.morphAttributes[r]=a}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,n=a.length;e<n;e++){let n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let t in n){let r=n[t];e.data.attributes[t]=r.toJSON(e.data)}let r={},i=!1;for(let t in this.morphAttributes){let n=this.morphAttributes[t],a=[];for(let t=0,r=n.length;t<r;t++){let r=n[t];a.push(r.toJSON(e.data))}a.length>0&&(r[t]=a,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;null!==n&&this.setIndex(n.clone(t));let r=e.attributes;for(let e in r){let n=r[e];this.setAttribute(e,n.clone(t))}let i=e.morphAttributes;for(let e in i){let n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,t=a.length;e<t;e++){let t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},Mse=new At,kf=new _o,aS=new ir,Ase=new q,Om=new q,Lm=new q,km=new q,rk=new q,oS=new q,lS=new Te,cS=new Te,uS=new Te,Cse=new q,Rse=new q,Pse=new q,hS=new q,fS=new q,Jt=class extends Cn{constructor(e=new Nt,t=new mr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){let t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(r,e);let s=this.morphTargetInfluences;if(i&&s){oS.set(0,0,0);for(let n=0,r=i.length;n<r;n++){let r=s[n],o=i[n];0!==r&&(rk.fromBufferAttribute(o,e),a?oS.addScaledVector(rk,r):oS.addScaledVector(rk.sub(t),r))}t.add(oS)}return t}raycast(e,t){let n=this.geometry,r=this.material,i=this.matrixWorld;void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),aS.copy(n.boundingSphere),aS.applyMatrix4(i),kf.copy(e.ray).recast(e.near),(!1!==aS.containsPoint(kf.origin)||!(null===kf.intersectSphere(aS,Ase)||kf.origin.distanceToSquared(Ase)>Y0(e.far-e.near,2)))&&(Mse.copy(i).invert(),kf.copy(e.ray).applyMatrix4(Mse),(null===n.boundingBox||!1!==kf.intersectsBox(n.boundingBox))&&this._computeIntersections(e,t,kf)))}_computeIntersections(e,t,n){let r,i=this.geometry,a=this.material,s=i.index,o=i.attributes.position,l=i.attributes.uv,h=i.attributes.uv1,u=i.attributes.normal,c=i.groups,d=i.drawRange;if(null!==s)if(Array.isArray(a))for(let i=0,o=c.length;i<o;i++){let o=c[i],p=a[o.materialIndex];for(let i=Math.max(o.start,d.start),a=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));i<a;i+=3){r=dS(this,p,e,n,l,h,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);i<o;i+=3){r=dS(this,a,e,n,l,h,u,s.getX(i),s.getX(i+1),s.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(a))for(let i=0,s=c.length;i<s;i++){let s=c[i],p=a[s.materialIndex];for(let i=Math.max(s.start,d.start),a=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));i<a;i+=3){r=dS(this,p,e,n,l,h,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))}}else{for(let i=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);i<s;i+=3){r=dS(this,a,e,n,l,h,u,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}};function aQe(e,t,n,r,i,a,s,o){let l;if(l=t.side===zi?r.intersectTriangle(s,a,i,!0,o):r.intersectTriangle(i,a,s,t.side===Os,o),null===l)return null;fS.copy(o),fS.applyMatrix4(e.matrixWorld);let h=n.ray.origin.distanceTo(fS);return h<n.near||h>n.far?null:{distance:h,point:fS.clone(),object:e}}function dS(e,t,n,r,i,a,s,o,l,h){e.getVertexPosition(o,Om),e.getVertexPosition(l,Lm),e.getVertexPosition(h,km);let u=aQe(e,t,n,r,Om,Lm,km,hS);if(u){i&&(lS.fromBufferAttribute(i,o),cS.fromBufferAttribute(i,l),uS.fromBufferAttribute(i,h),u.uv=Pr.getInterpolation(hS,Om,Lm,km,lS,cS,uS,new Te)),a&&(lS.fromBufferAttribute(a,o),cS.fromBufferAttribute(a,l),uS.fromBufferAttribute(a,h),u.uv1=Pr.getInterpolation(hS,Om,Lm,km,lS,cS,uS,new Te)),s&&(Cse.fromBufferAttribute(s,o),Rse.fromBufferAttribute(s,l),Pse.fromBufferAttribute(s,h),u.normal=Pr.getInterpolation(hS,Om,Lm,km,Cse,Rse,Pse,new q),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));let e={a:o,b:l,c:h,normal:new q,materialIndex:0};Pr.getNormal(Om,Lm,km,e.normal),u.face=e}return u}var ru=class extends Nt{constructor(e=1,t=1,n=1,r=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};let s=this;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);let o=[],l=[],h=[],u=[],c=0,d=0;function p(e,t,n,r,i,a,p,f,m,g,v){let y=a/m,x=p/g,b=a/2,_=p/2,w=f/2,S=m+1,M=g+1,T=0,E=0,A=new q;for(let a=0;a<M;a++){let s=a*x-_;for(let o=0;o<S;o++){let c=o*y-b;A[e]=c*r,A[t]=s*i,A[n]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,h.push(A.x,A.y,A.z),u.push(o/m),u.push(1-a/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let n=c+t+S*e,r=c+t+S*(e+1),i=c+(t+1)+S*(e+1),a=c+(t+1)+S*e;o.push(n,r,a),o.push(r,i,a),E+=6}s.addGroup(d,E,v),d+=E,c+=T}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(h,3)),this.setAttribute("uv",new Wt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ru(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function eg(e){let t={};for(let n in e){t[n]={};for(let r in e[n]){let i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[n][r]=null):t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Ks(e){let t={};for(let n=0;n<e.length;n++){let r=eg(e[n]);for(let e in r)t[e]=r[e]}return t}function oQe(e){let t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}function Yoe(e){let t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:vr.workingColorSpace}var fM={clone:eg,merge:Ks},lQe="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",cQe="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",fr=class extends Ir{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=lQe,this.fragmentShader=cQe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=eg(e.uniforms),this.uniformsGroups=oQe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let n={};for(let e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},ad=class extends Cn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new At,this.projectionMatrix=new At,this.projectionMatrixInverse=new At,this.coordinateSystem=jl}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},ih=new q,Ise=new Te,Dse=new Te,ui=class extends ad{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*Jm*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*ed*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Jm*Math.atan(Math.tan(.5*ed*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){ih.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(ih.x,ih.y).multiplyScalar(-e/ih.z),ih.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(ih.x,ih.y).multiplyScalar(-e/ih.z)}getViewSize(e,t){return this.getViewBounds(e,Ise,Dse),t.subVectors(Dse,Ise)}setViewOffset(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*ed*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/e,t-=a.offsetY*n/s,r*=a.width/e,n*=a.height/s}let s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Fm=-90,Nm=1,bw=class extends Cn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;let r=new ui(Fm,Nm,e,t);r.layers=this.layers,this.add(r);let i=new ui(Fm,Nm,e,t);i.layers=this.layers,this.add(i);let a=new ui(Fm,Nm,e,t);a.layers=this.layers,this.add(a);let s=new ui(Fm,Nm,e,t);s.layers=this.layers,this.add(s);let o=new ui(Fm,Nm,e,t);o.layers=this.layers,this.add(o);let l=new ui(Fm,Nm,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[n,r,i,a,s,o]=t;for(let e of t)this.remove(e);if(e===jl)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==iy)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(let e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();let{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[i,a,s,o,l,h]=this.children,u=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;let f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,a),e.setRenderTarget(n,2,r),e.render(t,s),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,h),e.setRenderTarget(u,c,d),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}},od=class extends ei{constructor(e,t,n,r,i,a,s,o,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:tu,n,r,i,a,s,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Ew=class extends Qs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new od(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Dr}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new ru(5,5,5),i=new fr({name:"CubemapFromEquirect",uniforms:eg(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:zi,blending:Qc});i.uniforms.tEquirect.value=t;let a=new Jt(r,i),s=t.minFilter;return t.minFilter===Eo&&(t.minFilter=Dr),new bw(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,n,r){let i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}},ik=new q,uQe=new q,hQe=new Tn,Oi=class{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let r=ik.subVectors(n,t).cross(uQe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let n=e.delta(ik),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||hQe.getNormalMatrix(e),r=this.coplanarPoint(ik).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Ff=new ir,pS=new q,ul=class{constructor(e=new Oi,t=new Oi,n=new Oi,r=new Oi,i=new Oi,a=new Oi){this.planes=[e,t,n,r,i,a]}set(e,t,n,r,i,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(a),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=jl){let n=this.planes,r=e.elements,i=r[0],a=r[1],s=r[2],o=r[3],l=r[4],h=r[5],u=r[6],c=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],x=r[15];if(n[0].setComponents(o-i,c-l,m-d,x-g).normalize(),n[1].setComponents(o+i,c+l,m+d,x+g).normalize(),n[2].setComponents(o+a,c+h,m+p,x+v).normalize(),n[3].setComponents(o-a,c-h,m-p,x-v).normalize(),n[4].setComponents(o-s,c-u,m-f,x-y).normalize(),t===jl)n[5].setComponents(o+s,c+u,m+f,x+y).normalize();else{if(t!==iy)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(s,u,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Ff.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Ff.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ff)}intersectsSprite(e){return Ff.center.set(0,0,0),Ff.radius=.7071067811865476,Ff.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ff)}intersectsSphere(e){let t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let r=t[n];if(pS.x=r.normal.x>0?e.max.x:e.min.x,pS.y=r.normal.y>0?e.max.y:e.min.y,pS.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(pS)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function $oe(){let e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function fQe(e){let t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);let r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){let e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}let i=t.get(n);if(void 0===i)t.set(n,function(t,n){let r,i=t.array,a=t.usage,s=i.byteLength,o=e.createBuffer();if(e.bindBuffer(n,o),e.bufferData(n,i,a),t.onUploadCallback(),i instanceof Float32Array)r=e.FLOAT;else if(i instanceof Uint16Array)r=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(i instanceof Int16Array)r=e.SHORT;else if(i instanceof Uint32Array)r=e.UNSIGNED_INT;else if(i instanceof Int32Array)r=e.INT;else if(i instanceof Int8Array)r=e.BYTE;else if(i instanceof Uint8Array)r=e.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);r=e.UNSIGNED_BYTE}return{buffer:o,type:r,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(t,n,r){let i=n.array,a=n._updateRange,s=n.updateRanges;if(e.bindBuffer(r,t),-1===a.count&&0===s.length&&e.bufferSubData(r,0,i),0!==s.length){for(let t=0,n=s.length;t<n;t++){let n=s[t];e.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}-1!==a.count&&(e.bufferSubData(r,a.offset*i.BYTES_PER_ELEMENT,i,a.offset,a.count),a.count=-1),n.onUploadCallback()})(i.buffer,n,r),i.version=n.version}}}}var ys=class extends Nt{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};let i=e/2,a=t/2,s=Math.floor(n),o=Math.floor(r),l=s+1,h=o+1,u=e/s,c=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<h;e++){let t=e*c-a;for(let n=0;n<l;n++){let r=n*u-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){let n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),a=t+1+l*e;d.push(n,r,a),d.push(r,i,a)}this.setIndex(d),this.setAttribute("position",new Wt(p,3)),this.setAttribute("normal",new Wt(f,3)),this.setAttribute("uv",new Wt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ys(e.width,e.height,e.widthSegments,e.heightSegments)}},dQe="#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",pQe="#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",mQe="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",gQe="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",vQe="#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",yQe="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",xQe="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",bQe="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",EQe="#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",_Qe="#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",TQe="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",SQe="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",wQe="float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",MQe="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",AQe="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",CQe="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",RQe="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",PQe="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",IQe="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",DQe="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",OQe="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",LQe="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",kQe="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",FQe="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",NQe="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",BQe="vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",UQe="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",HQe="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",VQe="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",zQe="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",qQe="gl_FragColor = linearToOutputTexel( gl_FragColor );",GQe="\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",WQe="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",jQe="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",XQe="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",YQe="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",$Qe="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",ZQe="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",KQe="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",JQe="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",QQe="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",eet="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",tet="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",net="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",ret="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",iet="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",set="#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",aet="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",oet="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",cet="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",uet="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",het="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",fet="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",det="\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",pet="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",met="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",get="#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",vet="#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",yet="#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",xet="#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",bet="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",Eet="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",_et="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",Tet="#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",wet="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Met="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Aet="#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",Cet="#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",Ret="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",Pet="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",Iet="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",Det="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",Oet="#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",Let="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",ket="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",Fet="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",Net="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",Bet="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",Uet="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",Het="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",Vet="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",zet="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",qet="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",Get="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",Wet="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",jet="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",Xet="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",Yet="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",$et="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",Zet="#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",Ket="#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",Jet="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",Qet="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",ett="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",ttt="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",ntt="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",rtt="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",itt="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",stt="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",att="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",ott="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",ltt="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",ctt="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",utt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",htt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",ftt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",dtt="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",ptt="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",mtt="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",gtt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",vtt="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",ytt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",xtt="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",btt="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Ett="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",_tt="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Ttt="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",Stt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",wtt="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Mtt="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Att="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ctt="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",Rtt="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ptt="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Itt="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Dtt="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Ott="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Ltt="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",ktt="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",Ftt="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Ntt="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Btt="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",Utt="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Htt="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Vtt="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",ztt="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",qtt="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Gtt="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Wtt="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",jtt="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Xtt="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",Hn={alphahash_fragment:dQe,alphahash_pars_fragment:pQe,alphamap_fragment:mQe,alphamap_pars_fragment:gQe,alphatest_fragment:vQe,alphatest_pars_fragment:yQe,aomap_fragment:xQe,aomap_pars_fragment:bQe,batching_pars_vertex:EQe,batching_vertex:_Qe,begin_vertex:TQe,beginnormal_vertex:SQe,bsdfs:wQe,iridescence_fragment:MQe,bumpmap_pars_fragment:AQe,clipping_planes_fragment:CQe,clipping_planes_pars_fragment:RQe,clipping_planes_pars_vertex:PQe,clipping_planes_vertex:IQe,color_fragment:DQe,color_pars_fragment:OQe,color_pars_vertex:LQe,color_vertex:kQe,common:FQe,cube_uv_reflection_fragment:NQe,defaultnormal_vertex:BQe,displacementmap_pars_vertex:UQe,displacementmap_vertex:HQe,emissivemap_fragment:VQe,emissivemap_pars_fragment:zQe,colorspace_fragment:qQe,colorspace_pars_fragment:GQe,envmap_fragment:WQe,envmap_common_pars_fragment:jQe,envmap_pars_fragment:XQe,envmap_pars_vertex:YQe,envmap_physical_pars_fragment:set,envmap_vertex:$Qe,fog_vertex:ZQe,fog_pars_vertex:KQe,fog_fragment:JQe,fog_pars_fragment:QQe,gradientmap_pars_fragment:eet,lightmap_pars_fragment:tet,lights_lambert_fragment:net,lights_lambert_pars_fragment:ret,lights_pars_begin:iet,lights_toon_fragment:aet,lights_toon_pars_fragment:oet,lights_phong_fragment:cet,lights_phong_pars_fragment:uet,lights_physical_fragment:het,lights_physical_pars_fragment:fet,lights_fragment_begin:det,lights_fragment_maps:pet,lights_fragment_end:met,logdepthbuf_fragment:get,logdepthbuf_pars_fragment:vet,logdepthbuf_pars_vertex:yet,logdepthbuf_vertex:xet,map_fragment:bet,map_pars_fragment:Eet,map_particle_fragment:_et,map_particle_pars_fragment:Tet,metalnessmap_fragment:wet,metalnessmap_pars_fragment:Met,morphinstance_vertex:Aet,morphcolor_vertex:Cet,morphnormal_vertex:Ret,morphtarget_pars_vertex:Pet,morphtarget_vertex:Iet,normal_fragment_begin:Det,normal_fragment_maps:Oet,normal_pars_fragment:Let,normal_pars_vertex:ket,normal_vertex:Fet,normalmap_pars_fragment:Net,clearcoat_normal_fragment_begin:Bet,clearcoat_normal_fragment_maps:Uet,clearcoat_pars_fragment:Het,iridescence_pars_fragment:Vet,opaque_fragment:zet,packing:qet,premultiplied_alpha_fragment:Get,project_vertex:Wet,dithering_fragment:jet,dithering_pars_fragment:Xet,roughnessmap_fragment:Yet,roughnessmap_pars_fragment:$et,shadowmap_pars_fragment:Zet,shadowmap_pars_vertex:Ket,shadowmap_vertex:Jet,shadowmask_pars_fragment:Qet,skinbase_vertex:ett,skinning_pars_vertex:ttt,skinning_vertex:ntt,skinnormal_vertex:rtt,specularmap_fragment:itt,specularmap_pars_fragment:stt,tonemapping_fragment:att,tonemapping_pars_fragment:ott,transmission_fragment:ltt,transmission_pars_fragment:ctt,uv_pars_fragment:utt,uv_pars_vertex:htt,uv_vertex:ftt,worldpos_vertex:dtt,background_vert:ptt,background_frag:mtt,backgroundCube_vert:gtt,backgroundCube_frag:vtt,cube_vert:ytt,cube_frag:xtt,depth_vert:btt,depth_frag:Ett,distanceRGBA_vert:_tt,distanceRGBA_frag:Ttt,equirect_vert:Stt,equirect_frag:wtt,linedashed_vert:Mtt,linedashed_frag:Att,meshbasic_vert:Ctt,meshbasic_frag:Rtt,meshlambert_vert:Ptt,meshlambert_frag:Itt,meshmatcap_vert:Dtt,meshmatcap_frag:Ott,meshnormal_vert:Ltt,meshnormal_frag:ktt,meshphong_vert:Ftt,meshphong_frag:Ntt,meshphysical_vert:Btt,meshphysical_frag:Utt,meshtoon_vert:Htt,meshtoon_frag:Vtt,points_vert:ztt,points_frag:qtt,shadow_vert:Gtt,shadow_frag:Wtt,sprite_vert:jtt,sprite_frag:Xtt},qt={common:{diffuse:{value:new Ot(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Tn}},envmap:{envMap:{value:null},envMapRotation:{value:new Tn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Tn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Tn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Tn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Tn},normalScale:{value:new Te(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Tn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Tn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Tn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Tn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ot(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ot(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0},uvTransform:{value:new Tn}},sprite:{diffuse:{value:new Ot(16777215)},opacity:{value:1},center:{value:new Te(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Tn},alphaMap:{value:null},alphaMapTransform:{value:new Tn},alphaTest:{value:0}}},al={basic:{uniforms:Ks([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.fog]),vertexShader:Hn.meshbasic_vert,fragmentShader:Hn.meshbasic_frag},lambert:{uniforms:Ks([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new Ot(0)}}]),vertexShader:Hn.meshlambert_vert,fragmentShader:Hn.meshlambert_frag},phong:{uniforms:Ks([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new Ot(0)},specular:{value:new Ot(1118481)},shininess:{value:30}}]),vertexShader:Hn.meshphong_vert,fragmentShader:Hn.meshphong_frag},standard:{uniforms:Ks([qt.common,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.roughnessmap,qt.metalnessmap,qt.fog,qt.lights,{emissive:{value:new Ot(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Hn.meshphysical_vert,fragmentShader:Hn.meshphysical_frag},toon:{uniforms:Ks([qt.common,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.gradientmap,qt.fog,qt.lights,{emissive:{value:new Ot(0)}}]),vertexShader:Hn.meshtoon_vert,fragmentShader:Hn.meshtoon_frag},matcap:{uniforms:Ks([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,{matcap:{value:null}}]),vertexShader:Hn.meshmatcap_vert,fragmentShader:Hn.meshmatcap_frag},points:{uniforms:Ks([qt.points,qt.fog]),vertexShader:Hn.points_vert,fragmentShader:Hn.points_frag},dashed:{uniforms:Ks([qt.common,qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Hn.linedashed_vert,fragmentShader:Hn.linedashed_frag},depth:{uniforms:Ks([qt.common,qt.displacementmap]),vertexShader:Hn.depth_vert,fragmentShader:Hn.depth_frag},normal:{uniforms:Ks([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,{opacity:{value:1}}]),vertexShader:Hn.meshnormal_vert,fragmentShader:Hn.meshnormal_frag},sprite:{uniforms:Ks([qt.sprite,qt.fog]),vertexShader:Hn.sprite_vert,fragmentShader:Hn.sprite_frag},background:{uniforms:{uvTransform:{value:new Tn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Hn.background_vert,fragmentShader:Hn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Tn}},vertexShader:Hn.backgroundCube_vert,fragmentShader:Hn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Hn.cube_vert,fragmentShader:Hn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Hn.equirect_vert,fragmentShader:Hn.equirect_frag},distanceRGBA:{uniforms:Ks([qt.common,qt.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Hn.distanceRGBA_vert,fragmentShader:Hn.distanceRGBA_frag},shadow:{uniforms:Ks([qt.lights,qt.fog,{color:{value:new Ot(0)},opacity:{value:1}}]),vertexShader:Hn.shadow_vert,fragmentShader:Hn.shadow_frag}};al.physical={uniforms:Ks([al.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Tn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Tn},clearcoatNormalScale:{value:new Te(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Tn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Tn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Tn},sheen:{value:0},sheenColor:{value:new Ot(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Tn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Tn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Tn},transmissionSamplerSize:{value:new Te},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Tn},attenuationDistance:{value:0},attenuationColor:{value:new Ot(0)},specularColor:{value:new Ot(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Tn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Tn},anisotropyVector:{value:new Te},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Tn}}]),vertexShader:Hn.meshphysical_vert,fragmentShader:Hn.meshphysical_frag};var mS={r:0,b:0,g:0},Nf=new Fi,Ytt=new At;function $tt(e,t,n,r,i,a,s){let o,l,h=new Ot(0),u=!0===a?0:1,c=null,d=0,p=null;function f(e){let r=!0===e.isScene?e.background:null;return r&&r.isTexture&&(r=(e.backgroundBlurriness>0?n:t).get(r)),r}function m(t,n){t.getRGB(mS,Yoe(e)),r.buffers.color.setClear(mS.r,mS.g,mS.b,n,s)}return{getClearColor:function(){return h},setClearColor:function(e,t=1){h.set(e),u=t,m(h,u)},getClearAlpha:function(){return u},setClearAlpha:function(e){u=e,m(h,u)},render:function(t){let n=!1,i=f(t);null===i?m(h,u):i&&i.isColor&&(m(i,1),n=!0);let a=e.xr.getEnvironmentBlendMode();"additive"===a?r.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===a&&r.buffers.color.setClear(0,0,0,0,s),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){let r=f(n);r&&(r.isCubeTexture||r.mapping===_g)?(void 0===l&&(l=new Jt(new ru(1,1,1),new fr({name:"BackgroundCubeMaterial",uniforms:eg(al.backgroundCube.uniforms),vertexShader:al.backgroundCube.vertexShader,fragmentShader:al.backgroundCube.fragmentShader,side:zi,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),Nf.copy(n.backgroundRotation),Nf.x*=-1,Nf.y*=-1,Nf.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(Nf.y*=-1,Nf.z*=-1),l.material.uniforms.envMap.value=r,l.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.uniforms.backgroundRotation.value.setFromMatrix4(Ytt.makeRotationFromEuler(Nf)),l.material.toneMapped=vr.getTransfer(r.colorSpace)!==Hr,(c!==r||d!==r.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,c=r,d=r.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null)):r&&r.isTexture&&(void 0===o&&(o=new Jt(new ys(2,2),new fr({name:"BackgroundMaterial",uniforms:eg(al.background.uniforms),vertexShader:al.background.vertexShader,fragmentShader:al.background.fragmentShader,side:Os,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=r,o.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,o.material.toneMapped=vr.getTransfer(r.colorSpace)!==Hr,!0===r.matrixAutoUpdate&&r.updateMatrix(),o.material.uniforms.uvTransform.value.copy(r.matrix),(c!==r||d!==r.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,c=r,d=r.version,p=e.toneMapping),o.layers.enableAll(),t.unshift(o,o.geometry,o.material,0,0,null))}}}function Ztt(e,t){let n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=h(null),a=i,s=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function h(e){let t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){let e=a.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function c(e){d(e,0)}function d(t,n){let r=a.newAttributes,i=a.enabledAttributes,s=a.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),s[t]!==n&&(e.vertexAttribDivisor(t,n),s[t]=n)}function p(){let t=a.newAttributes,n=a.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function f(t,n,r,i,a,s,o){!0===o?e.vertexAttribIPointer(t,n,r,a,s):e.vertexAttribPointer(t,n,r,i,a,s)}function m(){g(),s=!0,a!==i&&(a=i,o(a.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1,y=function(t,n,i){let a=!0===i.wireframe,s=r[t.id];void 0===s&&(s={},r[t.id]=s);let o=s[n.id];void 0===o&&(o={},s[n.id]=o);let l=o[a];return void 0===l&&(l=h(e.createVertexArray()),o[a]=l),l}(m,l,i);a!==y&&(a=y,o(a.object)),v=function(e,t,n,r){let i=a.attributes,s=t.attributes,o=0,l=n.getAttributes();for(let t in l)if(l[t].location>=0){let n=i[t],r=s[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n||n.attribute!==r||r&&n.data!==r.data)return!0;o++}return a.attributesNum!==o||a.index!==r}(n,m,l,g),v&&function(e,t,n,r){let i={},s=t.attributes,o=0,l=n.getAttributes();for(let t in l)if(l[t].location>=0){let n=s[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));let r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,o++}a.attributes=i,a.attributesNum=o,a.index=r}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||s)&&(s=!1,function(n,r,i,a){u();let s=a.attributes,o=i.getAttributes(),l=r.defaultAttributeValues;for(let r in o){let i=o[r];if(i.location>=0){let o=s[r];if(void 0===o&&("instanceMatrix"===r&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){let r=o.normalized,s=o.itemSize,l=t.get(o);if(void 0===l)continue;let h=l.buffer,u=l.type,p=l.bytesPerElement,m=u===e.INT||u===e.UNSIGNED_INT||o.gpuType===iM;if(o.isInterleavedBufferAttribute){let t=o.data,l=t.stride,g=o.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)d(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)c(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<i.locationSize;e++)f(i.location+e,s/i.locationSize,u,r,l*p,(g+s/i.locationSize*e)*p,m)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)d(i.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<i.locationSize;e++)c(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,h);for(let e=0;e<i.locationSize;e++)f(i.location+e,s/i.locationSize,u,r,s*p,s/i.locationSize*e*p,m)}}else if(void 0!==l){let t=l[r];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,i,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(let e in r){let t=r[e];for(let e in t){let n=t[e];for(let e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;let t=r[e.id];for(let e in t){let n=t[e];for(let e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e.id]},releaseStatesOfProgram:function(e){for(let t in r){let n=r[t];if(void 0===n[e.id])continue;let i=n[e.id];for(let e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:c,disableUnusedAttributes:p}}function Ktt(e,t,n){let r;function i(t,i,a){0!==a&&(e.drawArraysInstanced(r,t,i,a),n.update(i,r,a))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,a);let s=0;for(let e=0;e<a;e++)s+=i[e];n.update(s,r,1)},this.renderMultiDrawInstances=function(e,a,s,o){if(0===s)return;let l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],a[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,a,0,o,0,s);let t=0;for(let e=0;e<s;e++)t+=a[e];for(let e=0;e<o.length;e++)n.update(t,r,o[e])}}}function Jtt(e,t,n,r){let i;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let s=void 0!==n.precision?n.precision:"highp",o=a(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=!0===n.logarithmicDepthBuffer,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){let n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:a,textureFormatReadable:function(t){return!(t!==vs&&r.convert(t)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT))},textureTypeReadable:function(n){let i=n===ja&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==Xl&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==ns&&!i)},precision:s,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:u,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:u>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function Qtt(e){let t=this,n=null,r=0,i=!1,a=!1,s=new Oi,o=new Tn,l={value:null,needsUpdate:!1};function h(e,n,r,i){let a=null!==e?e.length:0,h=null;if(0!==a){if(h=l.value,!0!==i||null===h){let t=r+4*a,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,n=r;t!==a;++t,n+=4)s.copy(e[t]).applyMatrix4(i,o),s.normal.toArray(h,n),h[n+3]=s.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){a=!0,h(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){n=h(e,t,0)},this.setState=function(s,o,u){let c=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!i||null===c||0===c.length||a&&!p)a?h(null):(l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0);else{let e=a?0:r,t=4*e,i=f.clippingState||null;l.value=i,i=h(c,o,t,u);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function ent(e){let t=new WeakMap;function n(e,t){return t===K1?e.mapping=tu:t===J1&&(e.mapping=ch),e}function r(e){let n=e.target;n.removeEventListener("dispose",r);let i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){let a=i.mapping;if(a===K1||a===J1){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{let a=i.image;if(a&&a.height>0){let s=new Ew(a.height);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}var To=class extends ad{constructor(e=-1,t=1,n=1,r=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,s=r+t,o=r-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,a=i+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},Wm=4,Ose=[.125,.215,.35,.446,.526,.582],Xf=20,sk=new To,Lse=new Ot,ak=null,ok=0,lk=0,ck=!1,jf=(1+Math.sqrt(5))/2,Bm=1/jf,kse=[new q(-jf,Bm,0),new q(jf,Bm,0),new q(-Bm,0,jf),new q(Bm,0,jf),new q(0,jf,-Bm),new q(0,jf,Bm),new q(-1,1,-1),new q(1,1,-1),new q(-1,1,1),new q(1,1,1)],ld=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){ak=this._renderer.getRenderTarget(),ok=this._renderer.getActiveCubeFace(),lk=this._renderer.getActiveMipmapLevel(),ck=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);let i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Bse(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Nse(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ak,ok,lk),this._renderer.xr.enabled=ck,e.scissorTest=!1,gS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===tu||e.mapping===ch?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ak=this._renderer.getRenderTarget(),ok=this._renderer.getActiveCubeFace(),lk=this._renderer.getActiveMipmapLevel(),ck=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;let n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Dr,minFilter:Dr,generateMipmaps:!1,type:ja,format:vs,colorSpace:fl,depthBuffer:!1},r=Fse(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Fse(e,t,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=tnt(r)),this._blurMaterial=nnt(r,e,t)}return r}_compileMaterial(e){let t=new Jt(this._lodPlanes[0],e);this._renderer.compile(t,sk)}_sceneToCubeUV(e,t,n,r){let i=new ui(90,1,t,n),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Lse),o.toneMapping=eu,o.autoClear=!1;let u=new mr({name:"PMREM.Background",side:zi,depthWrite:!1,depthTest:!1}),c=new Jt(new ru,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(Lse),d=!0);for(let t=0;t<6;t++){let n=t%3;0===n?(i.up.set(0,a[t],0),i.lookAt(s[t],0,0)):1===n?(i.up.set(0,0,a[t]),i.lookAt(0,s[t],0)):(i.up.set(0,a[t],0),i.lookAt(0,0,s[t]));let l=this._cubeSize;gS(r,n*l,t>2?l:0,l,l),o.setRenderTarget(r),d&&o.render(c,i),o.render(e,i)}c.geometry.dispose(),c.material.dispose(),o.toneMapping=h,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let n=this._renderer,r=e.mapping===tu||e.mapping===ch;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Bse()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Nse());let i=r?this._cubemapMaterial:this._equirectMaterial,a=new Jt(this._lodPlanes[0],i);i.uniforms.envMap.value=e;let s=this._cubeSize;gS(t,0,0,3*s,2*s),n.setRenderTarget(t),n.render(a,sk)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;let r=this._lodPlanes.length;for(let t=1;t<r;t++){let n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=kse[(r-t-1)%kse.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,r,i){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new Jt(this._lodPlanes[r],l),u=l.uniforms,c=this._sizeLods[n]-1,d=isFinite(i)?Math.PI/(2*c):2*Math.PI/(2*Xf-1),p=i/d,f=isFinite(i)?1+Math.floor(3*p):Xf;f>Xf&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Xf}`);let m=[],g=0;for(let e=0;e<Xf;++e){let t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;u.envMap.value=e.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,s&&(u.poleAxis.value=s);let{_lodMax:v}=this;u.dTheta.value=d,u.mipInt.value=v-n;let y=this._sizeLods[r];gS(t,3*y*(r>v-Wm?r-v+Wm:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(h,sk)}};function tnt(e){let t=[],n=[],r=[],i=e,a=e-Wm+1+Ose.length;for(let s=0;s<a;s++){let a=Math.pow(2,i);n.push(a);let o=1/a;s>e-Wm?o=Ose[s-e+Wm-1]:0===s&&(o=0),r.push(o);let l=1/(a-2),h=-l,u=1+l,c=[h,h,u,h,u,u,h,h,u,u,h,u],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let e=0;e<d;e++){let t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,f*p*e),y.set(c,m*p*e);let i=[e,e,e,e,e,e];x.set(i,g*p*e)}let b=new Nt;b.setAttribute("position",new vn(v,f)),b.setAttribute("uv",new vn(y,m)),b.setAttribute("faceIndex",new vn(x,g)),t.push(b),i>Wm&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}function Fse(e,t,n){let r=new Qs(e,t,n);return r.texture.mapping=_g,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function gS(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function nnt(e,t,n){let r=new Float32Array(Xf),i=new q(0,1,0);return new fr({name:"SphericalGaussianBlur",defines:{n:Xf,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:K6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Qc,depthTest:!1,depthWrite:!1})}function Nse(){return new fr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:K6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Qc,depthTest:!1,depthWrite:!1})}function Bse(){return new fr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:K6(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Qc,depthTest:!1,depthWrite:!1})}function K6(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function rnt(e){let t=new WeakMap,n=null;function r(e){let n=e.target;n.removeEventListener("dispose",r);let i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){let a=i.mapping,s=a===K1||a===J1,o=a===tu||a===ch;if(s||o){let a=t.get(i),l=void 0!==a?a.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new ld(e)),a=s?n.fromEquirectangular(i,a):n.fromCubemap(i,a),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),a.texture;if(void 0!==a)return a.texture;{let l=i.image;return s&&l&&l.height>0||o&&l&&function(e){let t=0,n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)?(null===n&&(n=new ld(e)),a=s?n.fromEquirectangular(i):n.fromCubemap(i),a.texture.pmremVersion=i.pmremVersion,t.set(i,a),i.addEventListener("dispose",r),a.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function int(e){let t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){let t=n(e);return null===t&&Xm("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function snt(e,t,n,r){let i={},a=new WeakMap;function s(e){let o=e.target;null!==o.index&&t.remove(o.index);for(let e in o.attributes)t.remove(o.attributes[e]);for(let e in o.morphAttributes){let n=o.morphAttributes[e];for(let e=0,r=n.length;e<r;e++)t.remove(n[e])}o.removeEventListener("dispose",s),delete i[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){let n=[],r=e.index,i=e.attributes.position,s=0;if(null!==r){let e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){let r=e[t+0],i=e[t+1],a=e[t+2];n.push(r,i,i,a,a,r)}}else{if(void 0===i)return;{let e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){let e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}let o=new(Woe(n)?cy:ly)(n,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(n){let r=n.attributes;for(let n in r)t.update(r[n],e.ARRAY_BUFFER);let i=n.morphAttributes;for(let n in i){let r=i[n];for(let n=0,i=r.length;n<i;n++)t.update(r[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){let t=a.get(e);if(t){let n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return a.get(e)}}}function ant(e,t,n){let r,i,a;function s(t,s,o){0!==o&&(e.drawElementsInstanced(r,s,i,t*a,o),n.update(s,r,o))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,a=e.bytesPerElement},this.render=function(t,s){e.drawElements(r,s,i,t*a),n.update(s,r,1)},this.renderInstances=s,this.renderMultiDraw=function(e,a,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,a,0,i,e,0,s);let o=0;for(let e=0;e<s;e++)o+=a[e];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,o,l,h){if(0===l)return;let u=t.get("WEBGL_multi_draw");if(null===u)for(let t=0;t<e.length;t++)s(e[t]/a,o[t],h[t]);else{u.multiDrawElementsInstancedWEBGL(r,o,0,i,e,0,h,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e];for(let e=0;e<h.length;e++)n.update(t,r,h[e])}}}function ont(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function lnt(e,t,n){let r=new WeakMap,i=new hr;return{update:function(a,s,o){let l=a.morphTargetInfluences,h=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,u=void 0!==h?h.length:0,c=r.get(s);if(void 0===c||c.count!==u){let e=function(){v.dispose(),r.delete(s),s.removeEventListener("dispose",e)};void 0!==c&&c.texture.dispose();let n=void 0!==s.morphAttributes.position,a=void 0!==s.morphAttributes.normal,o=void 0!==s.morphAttributes.color,l=s.morphAttributes.position||[],h=s.morphAttributes.normal||[],d=s.morphAttributes.color||[],p=0;!0===n&&(p=1),!0===a&&(p=2),!0===o&&(p=3);let f=s.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let g=new Float32Array(f*m*4*u),v=new Qm(g,f,m,u);v.type=ns,v.needsUpdate=!0;let y=4*p;for(let e=0;e<u;e++){let t=l[e],r=h[e],s=d[e],u=f*m*4*e;for(let e=0;e<t.count;e++){let l=e*y;!0===n&&(i.fromBufferAttribute(t,e),g[u+l+0]=i.x,g[u+l+1]=i.y,g[u+l+2]=i.z,g[u+l+3]=0),!0===a&&(i.fromBufferAttribute(r,e),g[u+l+4]=i.x,g[u+l+5]=i.y,g[u+l+6]=i.z,g[u+l+7]=0),!0===o&&(i.fromBufferAttribute(s,e),g[u+l+8]=i.x,g[u+l+9]=i.y,g[u+l+10]=i.z,g[u+l+11]=4===s.itemSize?i.w:1)}}c={count:u,texture:v,size:new Te(f,m)},r.set(s,c),s.addEventListener("dispose",e)}if(!0===a.isInstancedMesh&&null!==a.morphTexture)o.getUniforms().setValue(e,"morphTexture",a.morphTexture,n);else{let t=0;for(let e=0;e<l.length;e++)t+=l[e];let n=s.morphTargetsRelative?1:1-t;o.getUniforms().setValue(e,"morphTargetBaseInfluence",n),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",c.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",c.size)}}}function cnt(e,t,n,r){let i=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(s){let o=r.render.frame,l=s.geometry,h=t.get(s,l);if(i.get(h)!==o&&(t.update(h),i.set(h,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),i.get(s)!==o&&(n.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&n.update(s.instanceColor,e.ARRAY_BUFFER),i.set(s,o))),s.isSkinnedMesh){let e=s.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return h},dispose:function(){i=new WeakMap}}}var uy=class extends ei{constructor(e,t,n,r,i,a,s,o,l,h=Qf){if(h!==Qf&&h!==id)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&h===Qf&&(n=nu),void 0===n&&h===id&&(n=rd),super(null,r,i,a,s,o,h,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:Li,this.minFilter=void 0!==o?o:Li,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}},Zoe=new ei,Use=new uy(1,1),Koe=new Qm,Joe=new ay,Qoe=new od,Hse=[],Vse=[],zse=new Float32Array(16),qse=new Float32Array(9),Gse=new Float32Array(4);function Sg(e,t,n){let r=e[0];if(r<=0||r>0)return e;let i=t*n,a=Hse[i];if(void 0===a&&(a=new Float32Array(i),Hse[i]=a),0!==t){r.toArray(a,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(a,i)}return a}function qi(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Gi(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function dM(e,t){let n=Vse[t];void 0===n&&(n=new Int32Array(t),Vse[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function unt(e,t){let n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function hnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(qi(n,t))return;e.uniform2fv(this.addr,t),Gi(n,t)}}function fnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)(n[0]!==t.r||n[1]!==t.g||n[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(qi(n,t))return;e.uniform3fv(this.addr,t),Gi(n,t)}}function dnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(qi(n,t))return;e.uniform4fv(this.addr,t),Gi(n,t)}}function pnt(e,t){let n=this.cache,r=t.elements;if(void 0===r){if(qi(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Gi(n,t)}else{if(qi(n,r))return;Gse.set(r),e.uniformMatrix2fv(this.addr,!1,Gse),Gi(n,r)}}function mnt(e,t){let n=this.cache,r=t.elements;if(void 0===r){if(qi(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Gi(n,t)}else{if(qi(n,r))return;qse.set(r),e.uniformMatrix3fv(this.addr,!1,qse),Gi(n,r)}}function gnt(e,t){let n=this.cache,r=t.elements;if(void 0===r){if(qi(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Gi(n,t)}else{if(qi(n,r))return;zse.set(r),e.uniformMatrix4fv(this.addr,!1,zse),Gi(n,r)}}function vnt(e,t){let n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ynt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(qi(n,t))return;e.uniform2iv(this.addr,t),Gi(n,t)}}function xnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(qi(n,t))return;e.uniform3iv(this.addr,t),Gi(n,t)}}function bnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(qi(n,t))return;e.uniform4iv(this.addr,t),Gi(n,t)}}function Ent(e,t){let n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function _nt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(qi(n,t))return;e.uniform2uiv(this.addr,t),Gi(n,t)}}function Tnt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(qi(n,t))return;e.uniform3uiv(this.addr,t),Gi(n,t)}}function Snt(e,t){let n=this.cache;if(void 0!==t.x)(n[0]!==t.x||n[1]!==t.y||n[2]!==t.z||n[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(qi(n,t))return;e.uniform4uiv(this.addr,t),Gi(n,t)}}function wnt(e,t,n){let r,i=this.cache,a=n.allocateTextureUnit();i[0]!==a&&(e.uniform1i(this.addr,a),i[0]=a),this.type===e.SAMPLER_2D_SHADOW?(Use.compareFunction=$6,r=Use):r=Zoe,n.setTexture2D(t||r,a)}function Mnt(e,t,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||Joe,i)}function Ant(e,t,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||Qoe,i)}function Cnt(e,t,n){let r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Koe,i)}function Rnt(e){switch(e){case 5126:return unt;case 35664:return hnt;case 35665:return fnt;case 35666:return dnt;case 35674:return pnt;case 35675:return mnt;case 35676:return gnt;case 5124:case 35670:return vnt;case 35667:case 35671:return ynt;case 35668:case 35672:return xnt;case 35669:case 35673:return bnt;case 5125:return Ent;case 36294:return _nt;case 36295:return Tnt;case 36296:return Snt;case 35678:case 36198:case 36298:case 36306:case 35682:return wnt;case 35679:case 36299:case 36307:return Mnt;case 35680:case 36300:case 36308:case 36293:return Ant;case 36289:case 36303:case 36311:case 36292:return Cnt}}function Pnt(e,t){e.uniform1fv(this.addr,t)}function Int(e,t){let n=Sg(t,this.size,2);e.uniform2fv(this.addr,n)}function Dnt(e,t){let n=Sg(t,this.size,3);e.uniform3fv(this.addr,n)}function Ont(e,t){let n=Sg(t,this.size,4);e.uniform4fv(this.addr,n)}function Lnt(e,t){let n=Sg(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function knt(e,t){let n=Sg(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Fnt(e,t){let n=Sg(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Nnt(e,t){e.uniform1iv(this.addr,t)}function Bnt(e,t){e.uniform2iv(this.addr,t)}function Unt(e,t){e.uniform3iv(this.addr,t)}function Hnt(e,t){e.uniform4iv(this.addr,t)}function Vnt(e,t){e.uniform1uiv(this.addr,t)}function znt(e,t){e.uniform2uiv(this.addr,t)}function qnt(e,t){e.uniform3uiv(this.addr,t)}function Gnt(e,t){e.uniform4uiv(this.addr,t)}function Wnt(e,t,n){let r=this.cache,i=t.length,a=dM(n,i);qi(r,a)||(e.uniform1iv(this.addr,a),Gi(r,a));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||Zoe,a[e])}function jnt(e,t,n){let r=this.cache,i=t.length,a=dM(n,i);qi(r,a)||(e.uniform1iv(this.addr,a),Gi(r,a));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||Joe,a[e])}function Xnt(e,t,n){let r=this.cache,i=t.length,a=dM(n,i);qi(r,a)||(e.uniform1iv(this.addr,a),Gi(r,a));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||Qoe,a[e])}function Ynt(e,t,n){let r=this.cache,i=t.length,a=dM(n,i);qi(r,a)||(e.uniform1iv(this.addr,a),Gi(r,a));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||Koe,a[e])}function $nt(e){switch(e){case 5126:return Pnt;case 35664:return Int;case 35665:return Dnt;case 35666:return Ont;case 35674:return Lnt;case 35675:return knt;case 35676:return Fnt;case 5124:case 35670:return Nnt;case 35667:case 35671:return Bnt;case 35668:case 35672:return Unt;case 35669:case 35673:return Hnt;case 5125:return Vnt;case 36294:return znt;case 36295:return qnt;case 36296:return Gnt;case 35678:case 36198:case 36298:case 36306:case 35682:return Wnt;case 35679:case 36299:case 36307:return jnt;case 35680:case 36300:case 36308:case 36293:return Xnt;case 36289:case 36303:case 36311:case 36292:return Ynt}}var Hk=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Rnt(t.type)}},Vk=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=$nt(t.type)}},zk=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){let r=this.seq;for(let i=0,a=r.length;i!==a;++i){let a=r[i];a.setValue(e,t[a.id],n)}}},uk=/(\w+)(\])?(\[|\.)?/g;function Wse(e,t){e.seq.push(t),e.map[t.id]=t}function Znt(e,t,n){let r=e.name,i=r.length;for(uk.lastIndex=0;;){let a=uk.exec(r),s=uk.lastIndex,o=a[1],l="]"===a[2],h=a[3];if(l&&(o|=0),void 0===h||"["===h&&s+2===i){Wse(n,void 0===h?new Hk(o,e,t):new Vk(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new zk(o),Wse(n,e)),n=e}}}var $m=class{constructor(e,t){this.seq=[],this.map={};let n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){let n=e.getActiveUniform(t,r);Znt(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){let i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){let r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,a=t.length;i!==a;++i){let a=t[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,r)}}static seqWithValue(e,t){let n=[];for(let r=0,i=e.length;r!==i;++r){let i=e[r];i.id in t&&n.push(i)}return n}};function jse(e,t,n){let r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var Knt=37297,Jnt=0;function Qnt(e,t){let n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let e=i;e<a;e++){let i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}function ert(e){let t,n=vr.getPrimaries(vr.workingColorSpace),r=vr.getPrimaries(e);switch(n===r?t="":n===ny&&r===ty?t="LinearDisplayP3ToLinearSRGB":n===ty&&r===ny&&(t="LinearSRGBToLinearDisplayP3"),e){case fl:case Ly:return[t,"LinearTransferOETF"];case yi:case hM:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[t,"LinearTransferOETF"]}}function Xse(e,t,n){let r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";let a=/ERROR: 0:(\d+)/.exec(i);if(a){let r=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+Qnt(e.getShaderSource(t),r)}return i}function trt(e,t){let n=ert(t);return`vec4 ${e}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function nrt(e,t){let n;switch(t){case Eoe:n="Linear";break;case _oe:n="Reinhard";break;case Toe:n="OptimizedCineon";break;case Soe:n="ACESFilmic";break;case Moe:n="AgX";break;case Aoe:n="Neutral";break;case woe:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}var vS=new q;function rrt(){return vr.getLuminanceCoefficients(vS),["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${vS.x.toFixed(4)}, ${vS.y.toFixed(4)}, ${vS.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function irt(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(H1).join("\n")}function srt(e){let t=[];for(let n in e){let r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}function art(e,t){let n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){let r=e.getActiveAttrib(t,i),a=r.name,s=1;r.type===e.FLOAT_MAT2&&(s=2),r.type===e.FLOAT_MAT3&&(s=3),r.type===e.FLOAT_MAT4&&(s=4),n[a]={type:r.type,location:e.getAttribLocation(t,a),locationSize:s}}return n}function H1(e){return""!==e}function Yse(e,t){let n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function $se(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var ort=/^[ \t]*#include +<([\w\d./]+)>/gm;function qk(e){return e.replace(ort,crt)}var lrt=new Map;function crt(e,t){let n=Hn[t];if(void 0===n){let e=lrt.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=Hn[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return qk(n)}var urt=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Zse(e){return e.replace(urt,hrt)}function hrt(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Kse(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function frt(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===B6?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===nM?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Wl&&(t="SHADOWMAP_TYPE_VSM"),t}function drt(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case tu:case ch:t="ENVMAP_TYPE_CUBE";break;case _g:t="ENVMAP_TYPE_CUBE_UV"}return t}function prt(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap&&e.envMapMode===ch)t="ENVMAP_MODE_REFRACTION";return t}function mrt(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Iy:t="ENVMAP_BLENDING_MULTIPLY";break;case xoe:t="ENVMAP_BLENDING_MIX";break;case boe:t="ENVMAP_BLENDING_ADD"}return t}function grt(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}function vrt(e,t,n,r){let i,a,s=e.getContext(),o=n.defines,l=n.vertexShader,h=n.fragmentShader,u=frt(n),c=drt(n),d=prt(n),p=mrt(n),f=grt(n),m=irt(n),g=srt(o),v=s.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(i=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g].filter(H1).join("\n"),i.length>0&&(i+="\n"),a=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g].filter(H1).join("\n"),a.length>0&&(a+="\n")):(i=[Kse(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(H1).join("\n"),a=[Kse(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==eu?"#define TONE_MAPPING":"",n.toneMapping!==eu?Hn.tonemapping_pars_fragment:"",n.toneMapping!==eu?nrt("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Hn.colorspace_pars_fragment,trt("linearToOutputTexel",n.outputColorSpace),rrt(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(H1).join("\n")),l=qk(l),l=Yse(l,n),l=$se(l,n),h=qk(h),h=Yse(h,n),h=$se(h,n),l=Zse(l),h=Zse(h),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",i=[m,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===Dk?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Dk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let x,b,_=y+i+l,w=y+a+h,S=jse(s,s.VERTEX_SHADER,_),M=jse(s,s.FRAGMENT_SHADER,w);function T(t){if(e.debug.checkShaderErrors){let n=s.getProgramInfoLog(v).trim(),r=s.getShaderInfoLog(S).trim(),o=s.getShaderInfoLog(M).trim(),l=!0,h=!0;if(!1===s.getProgramParameter(v,s.LINK_STATUS))if(l=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(s,v,S,M);else{let e=Xse(s,S,"vertex"),r=Xse(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(v,s.VALIDATE_STATUS)+"\n\nMaterial Name: "+t.name+"\nMaterial Type: "+t.type+"\n\nProgram Info Log: "+n+"\n"+e+"\n"+r)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):(""===r||""===o)&&(h=!1);h&&(t.diagnostics={runnable:l,programLog:n,vertexShader:{log:r,prefix:i},fragmentShader:{log:o,prefix:a}})}s.deleteShader(S),s.deleteShader(M),x=new $m(s,v),b=art(s,v)}s.attachShader(v,S),s.attachShader(v,M),void 0!==n.index0AttributeName?s.bindAttribLocation(v,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),this.getUniforms=function(){return void 0===x&&T(this),x},this.getAttributes=function(){return void 0===b&&T(this),b};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=s.getProgramParameter(v,Knt)),E},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Jnt++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=M,this}var yrt=0,Gk=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){let t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new Wk(e),t.set(e,n)),n}},Wk=class{constructor(e){this.id=yrt++,this.code=e,this.usedTimes=0}};function xrt(e,t,n,r,i,a,s){let o=new uh,l=new Gk,h=new Set,u=[],c=i.logarithmicDepthBuffer,d=i.vertexTextures,p=i.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return h.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(a,o,u,g,v){let y=g.fog,x=v.geometry,b=a.isMeshStandardMaterial?g.environment:null,_=(a.isMeshStandardMaterial?n:t).get(a.envMap||b),w=_&&_.mapping===_g?_.image.height:null,S=f[a.type];null!==a.precision&&(p=i.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));let M,T,E,A,C=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,P=void 0!==C?C.length:0,I=0;if(void 0!==x.morphAttributes.position&&(I=1),void 0!==x.morphAttributes.normal&&(I=2),void 0!==x.morphAttributes.color&&(I=3),S){let e=al[S];M=e.vertexShader,T=e.fragmentShader}else M=a.vertexShader,T=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),A=l.getFragmentShaderID(a);let R=e.getRenderTarget(),L=!0===v.isInstancedMesh,O=!0===v.isBatchedMesh,D=!!a.map,k=!!a.matcap,N=!!_,F=!!a.aoMap,U=!!a.lightMap,B=!!a.bumpMap,z=!!a.normalMap,H=!!a.displacementMap,V=!!a.emissiveMap,j=!!a.metalnessMap,G=!!a.roughnessMap,W=a.anisotropy>0,q=a.clearcoat>0,X=a.dispersion>0,Y=a.iridescence>0,Z=a.sheen>0,J=a.transmission>0,K=W&&!!a.anisotropyMap,Q=q&&!!a.clearcoatMap,$=q&&!!a.clearcoatNormalMap,ee=q&&!!a.clearcoatRoughnessMap,te=Y&&!!a.iridescenceMap,ne=Y&&!!a.iridescenceThicknessMap,re=Z&&!!a.sheenColorMap,ie=Z&&!!a.sheenRoughnessMap,ae=!!a.specularMap,se=!!a.specularColorMap,oe=!!a.specularIntensityMap,le=J&&!!a.transmissionMap,he=J&&!!a.thicknessMap,ue=!!a.gradientMap,ce=!!a.alphaMap,de=a.alphaTest>0,pe=!!a.alphaHash,fe=!!a.extensions,me=eu;a.toneMapped&&(null===R||!0===R.isXRRenderTarget)&&(me=e.toneMapping);let ge={shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:M,fragmentShader:T,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:A,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:O,batchingColor:O&&null!==v._colorsTexture,instancing:L,instancingColor:L&&null!==v.instanceColor,instancingMorph:L&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===R?e.outputColorSpace:!0===R.isXRRenderTarget?R.texture.colorSpace:fl,alphaToCoverage:!!a.alphaToCoverage,map:D,matcap:k,envMap:N,envMapMode:N&&_.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:U,bumpMap:B,normalMap:z,displacementMap:d&&H,emissiveMap:V,normalMapObjectSpace:z&&a.normalMapType===Noe,normalMapTangentSpace:z&&a.normalMapType===mh,metalnessMap:j,roughnessMap:G,anisotropy:W,anisotropyMap:K,clearcoat:q,clearcoatMap:Q,clearcoatNormalMap:$,clearcoatRoughnessMap:ee,dispersion:X,iridescence:Y,iridescenceMap:te,iridescenceThicknessMap:ne,sheen:Z,sheenColorMap:re,sheenRoughnessMap:ie,specularMap:ae,specularColorMap:se,specularIntensityMap:oe,transmission:J,transmissionMap:le,thicknessMap:he,gradientMap:ue,opaque:!1===a.transparent&&a.blending===Kf&&!1===a.alphaToCoverage,alphaMap:ce,alphaTest:de,alphaHash:pe,combine:a.combine,mapUv:D&&m(a.map.channel),aoMapUv:F&&m(a.aoMap.channel),lightMapUv:U&&m(a.lightMap.channel),bumpMapUv:B&&m(a.bumpMap.channel),normalMapUv:z&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:V&&m(a.emissiveMap.channel),metalnessMapUv:j&&m(a.metalnessMap.channel),roughnessMapUv:G&&m(a.roughnessMap.channel),anisotropyMapUv:K&&m(a.anisotropyMap.channel),clearcoatMapUv:Q&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:$&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:te&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:ne&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(a.sheenRoughnessMap.channel),specularMapUv:ae&&m(a.specularMap.channel),specularColorMapUv:se&&m(a.specularColorMap.channel),specularIntensityMapUv:oe&&m(a.specularIntensityMap.channel),transmissionMapUv:le&&m(a.transmissionMap.channel),thicknessMapUv:he&&m(a.thicknessMap.channel),alphaMapUv:ce&&m(a.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(z||W),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!x.attributes.uv&&(D||ce),fog:!!y,useFog:!0===a.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:P,morphTextureStride:I,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&u.length>0,shadowMapType:e.shadowMap.type,toneMapping:me,decodeVideoTexture:D&&!0===a.map.isVideoTexture&&vr.getTransfer(a.map.colorSpace)===Hr,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===Mr,flipSided:a.side===zi,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionClipCullDistance:fe&&!0===a.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(fe&&!0===a.extensions.multiDraw||O)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()};return ge.vertexUv1s=h.has(1),ge.vertexUv2s=h.has(2),ge.vertexUv3s=h.has(3),h.clear(),ge},getProgramCacheKey:function(t){let n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0),t.instancing&&o.enable(1),t.instancingColor&&o.enable(2),t.instancingMorph&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),t.batching&&o.enable(19),t.dispersion&&o.enable(20),t.batchingColor&&o.enable(21),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.doubleSided&&o.enable(10),t.flipSided&&o.enable(11),t.useDepthPacking&&o.enable(12),t.dithering&&o.enable(13),t.transmission&&o.enable(14),t.sheen&&o.enable(15),t.opaque&&o.enable(16),t.pointsUvs&&o.enable(17),t.decodeVideoTexture&&o.enable(18),t.alphaToCoverage&&o.enable(19),e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){let t,n=f[e.type];if(n){let e=al[n];t=fM.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){let r;for(let e=0,t=u.length;e<t;e++){let t=u[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new vrt(e,n,t,a),u.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){let t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:u,dispose:function(){l.dispose()}}}function brt(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Ert(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Jse(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Qse(){let e=[],t=0,n=[],r=[],i=[];function a(n,r,i,a,s,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:s,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=a,l.renderOrder=n.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,o,l,h){let u=a(e,t,s,o,l,h);s.transmission>0?r.push(u):!0===s.transparent?i.push(u):n.push(u)},unshift:function(e,t,s,o,l,h){let u=a(e,t,s,o,l,h);s.transmission>0?r.unshift(u):!0===s.transparent?i.unshift(u):n.unshift(u)},finish:function(){for(let n=t,r=e.length;n<r;n++){let t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ert),r.length>1&&r.sort(t||Jse),i.length>1&&i.sort(t||Jse)}}}function _rt(){let e=new WeakMap;return{get:function(t,n){let r,i=e.get(t);return void 0===i?(r=new Qse,e.set(t,[r])):n>=i.length?(r=new Qse,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Trt(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new q,color:new Ot};break;case"SpotLight":n={position:new q,direction:new q,color:new Ot,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new q,color:new Ot,distance:0,decay:0};break;case"HemisphereLight":n={direction:new q,skyColor:new Ot,groundColor:new Ot};break;case"RectAreaLight":n={color:new Ot,position:new q,halfWidth:new q,halfHeight:new q}}return e[t.id]=n,n}}}function Srt(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Te};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Te,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}var wrt=0;function Mrt(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Art(e){let t=new Trt,n=Srt(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new q);let i=new q,a=new At,s=new At;return{setup:function(i){let a=0,s=0,o=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,h=0,u=0,c=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;i.sort(Mrt);for(let e=0,x=i.length;e<x;e++){let x=i[e],b=x.color,_=x.intensity,w=x.distance,S=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)a+=b.r*_,s+=b.g*_,o+=b.b*_;else if(x.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(x.sh.coefficients[e],_);y++}else if(x.isDirectionalLight){let e=t.get(x);if(e.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){let e=x.shadow,t=n.get(x);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=S,r.directionalShadowMatrix[l]=x.shadow.matrix,p++}r.directional[l]=e,l++}else if(x.isSpotLight){let e=t.get(x);e.position.setFromMatrixPosition(x.matrixWorld),e.color.copy(b).multiplyScalar(_),e.distance=w,e.coneCos=Math.cos(x.angle),e.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),e.decay=x.decay,r.spot[u]=e;let i=x.shadow;if(x.map&&(r.spotLightMap[g]=x.map,g++,i.updateMatrices(x),x.castShadow&&v++),r.spotLightMatrix[u]=i.matrix,x.castShadow){let e=n.get(x);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=S,m++}u++}else if(x.isRectAreaLight){let e=t.get(x);e.color.copy(b).multiplyScalar(_),e.halfWidth.set(.5*x.width,0,0),e.halfHeight.set(0,.5*x.height,0),r.rectArea[c]=e,c++}else if(x.isPointLight){let e=t.get(x);if(e.color.copy(x.color).multiplyScalar(x.intensity),e.distance=x.distance,e.decay=x.decay,x.castShadow){let e=x.shadow,t=n.get(x);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[h]=t,r.pointShadowMap[h]=S,r.pointShadowMatrix[h]=x.shadow.matrix,f++}r.point[h]=e,h++}else if(x.isHemisphereLight){let e=t.get(x);e.skyColor.copy(x.color).multiplyScalar(_),e.groundColor.copy(x.groundColor).multiplyScalar(_),r.hemi[d]=e,d++}}c>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=qt.LTC_FLOAT_1,r.rectAreaLTC2=qt.LTC_FLOAT_2):(r.rectAreaLTC1=qt.LTC_HALF_1,r.rectAreaLTC2=qt.LTC_HALF_2)),r.ambient[0]=a,r.ambient[1]=s,r.ambient[2]=o;let x=r.hash;(x.directionalLength!==l||x.pointLength!==h||x.spotLength!==u||x.rectAreaLength!==c||x.hemiLength!==d||x.numDirectionalShadows!==p||x.numPointShadows!==f||x.numSpotShadows!==m||x.numSpotMaps!==g||x.numLightProbes!==y)&&(r.directional.length=l,r.spot.length=u,r.rectArea.length=c,r.point.length=h,r.hemi.length=d,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=y,x.directionalLength=l,x.pointLength=h,x.spotLength=u,x.rectAreaLength=c,x.hemiLength=d,x.numDirectionalShadows=p,x.numPointShadows=f,x.numSpotShadows=m,x.numSpotMaps=g,x.numLightProbes=y,r.version=wrt++)},setupView:function(e,t){let n=0,o=0,l=0,h=0,u=0,c=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(c),n++}else if(d.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(c),e.direction.setFromMatrixPosition(d.matrixWorld),i.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(c),l++}else if(d.isRectAreaLight){let e=r.rectArea[h];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(c),s.identity(),a.copy(d.matrixWorld),a.premultiply(c),s.extractRotation(a),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),h++}else if(d.isPointLight){let e=r.point[o];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(c),o++}else if(d.isHemisphereLight){let e=r.hemi[u];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(c),u++}}},state:r}}function eae(e){let t=new Art(e),n=[],r=[];let i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Crt(e){let t=new WeakMap;return{get:function(n,r=0){let i,a=t.get(n);return void 0===a?(i=new eae(e),t.set(n,[i])):r>=a.length?(i=new eae(e),a.push(i)):i=a[r],i},dispose:function(){t=new WeakMap}}}var hy=class extends Ir{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=koe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},fy=class extends Ir{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Rrt="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Prt="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Irt(e,t,n){let r=new ul,i=new Te,a=new Te,s=new hr,o=new hy({depthPacking:Foe}),l=new fy,h={},u=n.maxTextureSize,c={[Os]:zi,[zi]:Os,[Mr]:Mr},d=new fr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Te},radius:{value:4}},vertexShader:Rrt,fragmentShader:Prt}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Nt;f.setAttribute("position",new vn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Jt(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=B6;let v=this.type;function y(n,r){let a=t.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Qs(i.x,i.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,p,m,null)}function x(t,n,r,i){let a=null,s=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){let e=a.uuid,t=n.uuid,r=h[e];void 0===r&&(r={},h[e]=r);let i=r[t];void 0===i&&(i=a.clone(),r[t]=i,n.addEventListener("dispose",_)),a=i}if(a.visible=n.visible,a.wireframe=n.wireframe,a.side=i===Wl?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],a.alphaMap=n.alphaMap,a.alphaTest=n.alphaTest,a.map=n.map,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.clipIntersection=n.clipIntersection,a.displacementMap=n.displacementMap,a.displacementScale=n.displacementScale,a.displacementBias=n.displacementBias,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,!0===r.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=r}return a}function b(n,i,a,s,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===Wl)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);let r=t.update(n),l=n.material;if(Array.isArray(l)){let t=r.groups;for(let h=0,u=t.length;h<u;h++){let u=t[h],c=l[u.materialIndex];if(c&&c.visible){let t=x(n,c,s,o);n.onBeforeShadow(e,n,i,a,r,t,u),e.renderBufferDirect(a,null,r,t,n,u),n.onAfterShadow(e,n,i,a,r,t,u)}}}else if(l.visible){let t=x(n,l,s,o);n.onBeforeShadow(e,n,i,a,r,t,null),e.renderBufferDirect(a,null,r,t,n,null),n.onAfterShadow(e,n,i,a,r,t,null)}}let l=n.children;for(let e=0,t=l.length;e<t;e++)b(l[e],i,a,s,o)}function _(e){e.target.removeEventListener("dispose",_);for(let t in h){let n=h[t],r=e.target.uuid;r in n&&(n[r].dispose(),delete n[r])}}this.render=function(t,n,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),h=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),d=e.state;d.setBlending(Qc),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);let p=v!==Wl&&this.type===Wl,f=v===Wl&&this.type!==Wl;for(let l=0,h=t.length;l<h;l++){let h=t[l],c=h.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;i.copy(c.mapSize);let m=c.getFrameExtents();if(i.multiply(m),a.copy(c.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(a.x=Math.floor(u/m.x),i.x=a.x*m.x,c.mapSize.x=a.x),i.y>u&&(a.y=Math.floor(u/m.y),i.y=a.y*m.y,c.mapSize.y=a.y)),null===c.map||!0===p||!0===f){let e=this.type!==Wl?{minFilter:Li,magFilter:Li}:{};null!==c.map&&c.map.dispose(),c.map=new Qs(i.x,i.y,e),c.map.texture.name=h.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();let g=c.getViewportCount();for(let e=0;e<g;e++){let t=c.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(s),c.updateMatrices(h,e),r=c.getFrustum(),b(n,o,c.camera,h,this.type)}!0!==c.isPointLightShadow&&this.type===Wl&&y(c,o),c.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,h,c)}}function Drt(e){let t=new function(){let t=!1,n=new hr,r=null,i=new hr(0,0,0,0);return{setMask:function(n){r!==n&&!t&&(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,s,o){!0===o&&(t*=s,r*=s,a*=s),n.set(t,r,a,s),!1===i.equals(n)&&(e.clearColor(t,r,a,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},n=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(t){t?B(e.DEPTH_TEST):z(e.DEPTH_TEST)},setMask:function(r){n!==r&&!t&&(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case foe:e.depthFunc(e.NEVER);break;case doe:e.depthFunc(e.ALWAYS);break;case poe:e.depthFunc(e.LESS);break;case Z1:e.depthFunc(e.LEQUAL);break;case moe:e.depthFunc(e.EQUAL);break;case goe:e.depthFunc(e.GEQUAL);break;case voe:e.depthFunc(e.GREATER);break;case yoe:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},r=new function(){let t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(n){t||(n?B(e.STENCIL_TEST):z(e.STENCIL_TEST))},setMask:function(r){n!==r&&!t&&(e.stencilMask(r),n=r)},setFunc:function(t,n,s){(r!==t||i!==n||a!==s)&&(e.stencilFunc(t,n,s),r=t,i=n,a=s)},setOp:function(t,n,r){(s!==t||o!==n||l!==r)&&(e.stencilOp(t,n,r),s=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,s=null,o=null,l=null,h=null}}},i=new WeakMap,a=new WeakMap,s={},o={},l=new WeakMap,h=[],u=null,c=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new Ot(0,0,0),b=0,_=!1,w=null,S=null,M=null,T=null,E=null,A=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),C=!1,P=0,I=e.getParameter(e.VERSION);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(I)[1]),C=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),C=P>=2);let R=null,L={},O=e.getParameter(e.SCISSOR_BOX),D=e.getParameter(e.VIEWPORT),k=(new hr).fromArray(O),N=(new hr).fromArray(D);function F(t,n,r,i){let a=new Uint8Array(4),s=e.createTexture();e.bindTexture(t,s),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let s=0;s<r;s++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a);return s}let U={};function B(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function z(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}U[e.TEXTURE_2D]=F(e.TEXTURE_2D,e.TEXTURE_2D,1),U[e.TEXTURE_CUBE_MAP]=F(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),U[e.TEXTURE_2D_ARRAY]=F(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),U[e.TEXTURE_3D]=F(e.TEXTURE_3D,e.TEXTURE_3D,1,1),t.setClear(0,0,0,1),n.setClear(1),r.setClear(0),B(e.DEPTH_TEST),n.setFunc(Z1),G(!1),W(Mk),B(e.CULL_FACE),j(Qc);let H={[oh]:e.FUNC_ADD,[$ae]:e.FUNC_SUBTRACT,[Zae]:e.FUNC_REVERSE_SUBTRACT};H[Kae]=e.MIN,H[Jae]=e.MAX;let V={[Qae]:e.ZERO,[eoe]:e.ONE,[toe]:e.SRC_COLOR,[GS]:e.SRC_ALPHA,[ooe]:e.SRC_ALPHA_SATURATE,[soe]:e.DST_COLOR,[roe]:e.DST_ALPHA,[noe]:e.ONE_MINUS_SRC_COLOR,[WS]:e.ONE_MINUS_SRC_ALPHA,[aoe]:e.ONE_MINUS_DST_COLOR,[ioe]:e.ONE_MINUS_DST_ALPHA,[loe]:e.CONSTANT_COLOR,[coe]:e.ONE_MINUS_CONSTANT_COLOR,[uoe]:e.CONSTANT_ALPHA,[hoe]:e.ONE_MINUS_CONSTANT_ALPHA};function j(t,n,r,i,a,s,o,l,h,u){if(t!==Qc){if(!1===c&&(B(e.BLEND),c=!0),t===Yae)a=a||n,s=s||r,o=o||i,(n!==p||a!==g)&&(e.blendEquationSeparate(H[n],H[a]),p=n,g=a),(r!==f||i!==m||s!==v||o!==y)&&(e.blendFuncSeparate(V[r],V[i],V[s],V[o]),f=r,m=i,v=s,y=o),(!1===l.equals(x)||h!==b)&&(e.blendColor(l.r,l.g,l.b,h),x.copy(l),b=h),d=t,_=!1;else if(t!==d||u!==_){if((p!==oh||g!==oh)&&(e.blendEquation(e.FUNC_ADD),p=oh,g=oh),u)switch(t){case Kf:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ak:e.blendFunc(e.ONE,e.ONE);break;case Ck:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Rk:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Kf:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case Ak:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case Ck:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case Rk:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,v=null,y=null,x.set(0,0,0),b=0,d=t,_=u}}else!0===c&&(z(e.BLEND),c=!1)}function G(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function W(t){t!==jae?(B(e.CULL_FACE),t!==S&&(t===Mk?e.cullFace(e.BACK):t===Xae?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):z(e.CULL_FACE),S=t}function q(t,n,r){t?(B(e.POLYGON_OFFSET_FILL),(T!==n||E!==r)&&(e.polygonOffset(n,r),T=n,E=r)):z(e.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:n,stencil:r},enable:B,disable:z,bindFramebuffer:function(t,n){return o[t]!==n&&(e.bindFramebuffer(t,n),o[t]=n,t===e.DRAW_FRAMEBUFFER&&(o[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(o[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=h,i=!1;if(t){r=l.get(n),void 0===r&&(r=[],l.set(n,r));let a=t.textures;if(r.length!==a.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=a.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=a.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return u!==t&&(e.useProgram(t),u=t,!0)},setBlending:j,setMaterial:function(i,a){i.side===Mr?z(e.CULL_FACE):B(e.CULL_FACE);let s=i.side===zi;a&&(s=!s),G(s),i.blending===Kf&&!1===i.transparent?j(Qc):j(i.blending,i.blendEquation,i.blendSrc,i.blendDst,i.blendEquationAlpha,i.blendSrcAlpha,i.blendDstAlpha,i.blendColor,i.blendAlpha,i.premultipliedAlpha),n.setFunc(i.depthFunc),n.setTest(i.depthTest),n.setMask(i.depthWrite),t.setMask(i.colorWrite);let o=i.stencilWrite;r.setTest(o),o&&(r.setMask(i.stencilWriteMask),r.setFunc(i.stencilFunc,i.stencilRef,i.stencilFuncMask),r.setOp(i.stencilFail,i.stencilZFail,i.stencilZPass)),q(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),!0===i.alphaToCoverage?B(e.SAMPLE_ALPHA_TO_COVERAGE):z(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==M&&(C&&e.lineWidth(t),M=t)},setPolygonOffset:q,setScissorTest:function(t){t?B(e.SCISSOR_TEST):z(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+A-1),R!==t&&(e.activeTexture(t),R=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===R?e.TEXTURE0+A-1:R);let i=L[r];void 0===i&&(i={type:void 0,texture:void 0},L[r]=i),(i.type!==t||i.texture!==n)&&(R!==r&&(e.activeTexture(r),R=r),e.bindTexture(t,n||U[t]),i.type=t,i.texture=n)},unbindTexture:function(){let t=L[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){let r=a.get(n);void 0===r&&(r=new WeakMap,a.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){let r=a.get(n).get(t);i.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),i.set(n,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===k.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),k.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},R=null,L={},o={},l=new WeakMap,h=[],u=null,c=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new Ot(0,0,0),b=0,_=!1,w=null,S=null,M=null,T=null,E=null,k.set(0,0,e.canvas.width,e.canvas.height),N.set(0,0,e.canvas.width,e.canvas.height),t.reset(),n.reset(),r.reset()}}}function Ort(e,t){let n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}function Lrt(e,t){let n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}function krt(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}function jk(e,t,n,r){let i=Frt(r);switch(n){case z6:case G6:return e*t;case W6:return e*t*2;case oM:case Oy:return e*t/i.components*i.byteLength;case j6:case lM:return e*t*2/i.components*i.byteLength;case q6:return e*t*3/i.components*i.byteLength;case vs:case cM:return e*t*4/i.components*i.byteLength;case V1:case z1:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case q1:case G1:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case XS:case $S:return Math.max(e,16)*Math.max(t,8)/4;case jS:case YS:return Math.max(e,8)*Math.max(t,8)/2;case ZS:case KS:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case JS:case QS:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case ew:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case tw:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case nw:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case rw:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case iw:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case sw:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case aw:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case ow:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case lw:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case cw:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case uw:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case hw:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case fw:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case W1:case dw:case pw:return Math.ceil(e/4)*Math.ceil(t/4)*16;case X6:case mw:return Math.ceil(e/4)*Math.ceil(t/4)*8;case gw:case vw:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Frt(e){switch(e){case Xl:case U6:return{byteLength:1,components:1};case Zm:case H6:case ja:return{byteLength:2,components:1};case sM:case aM:return{byteLength:2,components:4};case nu:case iM:case ns:return{byteLength:4,components:1};case V6:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}var Nrt={contain:Ort,cover:Lrt,fill:krt,getByteLength:jk};function Brt(e,t,n,r,i,a,s){let o,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,h="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new Te,c=new WeakMap,d=new WeakMap,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return p?new OffscreenCanvas(e,t):sy("canvas")}function m(e,t,n){let r=1,i=z(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){let n=Math.floor(r*i.width),a=Math.floor(r*i.height);void 0===o&&(o=f(n,a));let s=t?f(n,a):o;return s.width=n,s.height=a,s.getContext("2d").drawImage(e,0,0,n,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+i.width+"x"+i.height+") to ("+n+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+i.width+"x"+i.height+")."),e}return e}function g(e){return e.generateMipmaps&&e.minFilter!==Li&&e.minFilter!==Dr}function v(t){e.generateMipmap(t)}function y(n,r,i,a,s=!1){if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=r;if(r===e.RED&&(i===e.FLOAT&&(o=e.R32F),i===e.HALF_FLOAT&&(o=e.R16F),i===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.R8UI),i===e.UNSIGNED_SHORT&&(o=e.R16UI),i===e.UNSIGNED_INT&&(o=e.R32UI),i===e.BYTE&&(o=e.R8I),i===e.SHORT&&(o=e.R16I),i===e.INT&&(o=e.R32I)),r===e.RG&&(i===e.FLOAT&&(o=e.RG32F),i===e.HALF_FLOAT&&(o=e.RG16F),i===e.UNSIGNED_BYTE&&(o=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RG8UI),i===e.UNSIGNED_SHORT&&(o=e.RG16UI),i===e.UNSIGNED_INT&&(o=e.RG32UI),i===e.BYTE&&(o=e.RG8I),i===e.SHORT&&(o=e.RG16I),i===e.INT&&(o=e.RG32I)),r===e.RGB&&i===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),r===e.RGBA){let t=s?ey:vr.getTransfer(a);i===e.FLOAT&&(o=e.RGBA32F),i===e.HALF_FLOAT&&(o=e.RGBA16F),i===e.UNSIGNED_BYTE&&(o=t===Hr?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return(o===e.R16F||o===e.R32F||o===e.RG16F||o===e.RG32F||o===e.RGBA16F||o===e.RGBA32F)&&t.get("EXT_color_buffer_float"),o}function x(t,n){let r;return t?null===n||n===nu||n===rd?r=e.DEPTH24_STENCIL8:n===ns?r=e.DEPTH32F_STENCIL8:n===Zm&&(r=e.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===nu||n===rd?r=e.DEPTH_COMPONENT24:n===ns?r=e.DEPTH_COMPONENT32F:n===Zm&&(r=e.DEPTH_COMPONENT16),r}function b(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==Li&&e.minFilter!==Dr?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function _(e){let t=e.target;t.removeEventListener("dispose",_),function(e){let t=r.get(e);if(void 0===t.__webglInit)return;let n=e.source,i=d.get(n);if(i){let r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&S(e),0===Object.keys(i).length&&d.delete(n)}r.remove(e)}(t),t.isVideoTexture&&c.delete(t)}function w(t){let n=t.target;n.removeEventListener("dispose",w),function(t){let n=r.get(t);if(t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}let i=t.textures;for(let t=0,n=i.length;t<n;t++){let n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),s.memory.textures--),r.remove(i[t])}r.remove(t)}(n)}function S(t){let n=r.get(t);e.deleteTexture(n.__webglTexture);let i=t.source;delete d.get(i)[n.__cacheKey],s.memory.textures--}let M=0;function T(t,i){let a=r.get(t);if(t.isVideoTexture&&function(e){let t=s.render.frame;c.get(e)!==t&&(c.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){let e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void R(a,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+i)}let E={[td]:e.REPEAT,[xa]:e.CLAMP_TO_EDGE,[nd]:e.MIRRORED_REPEAT},A={[Li]:e.NEAREST,[Dy]:e.NEAREST_MIPMAP_NEAREST,[lh]:e.NEAREST_MIPMAP_LINEAR,[Dr]:e.LINEAR,[Jf]:e.LINEAR_MIPMAP_NEAREST,[Eo]:e.LINEAR_MIPMAP_LINEAR},C={[Boe]:e.NEVER,[Goe]:e.ALWAYS,[Uoe]:e.LESS,[$6]:e.LEQUAL,[Hoe]:e.EQUAL,[qoe]:e.GEQUAL,[Voe]:e.GREATER,[zoe]:e.NOTEQUAL};function P(n,a){if(a.type===ns&&!1===t.has("OES_texture_float_linear")&&(a.magFilter===Dr||a.magFilter===Jf||a.magFilter===lh||a.magFilter===Eo||a.minFilter===Dr||a.minFilter===Jf||a.minFilter===lh||a.minFilter===Eo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),e.texParameteri(n,e.TEXTURE_WRAP_S,E[a.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,E[a.wrapT]),(n===e.TEXTURE_3D||n===e.TEXTURE_2D_ARRAY)&&e.texParameteri(n,e.TEXTURE_WRAP_R,E[a.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[a.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[a.minFilter]),a.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,C[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(a.magFilter===Li||a.minFilter!==lh&&a.minFilter!==Eo||a.type===ns&&!1===t.has("OES_texture_float_linear"))return;if(a.anisotropy>1||r.get(a).__currentAnisotropy){let s=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy}}}function I(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_));let i=n.source,a=d.get(i);void 0===a&&(a={},d.set(i,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),a[o].usedTimes++;let i=a[t.__cacheKey];void 0!==i&&(a[t.__cacheKey].usedTimes--,0===i.usedTimes&&S(n)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return r}function R(t,s,o){let l=e.TEXTURE_2D;(s.isDataArrayTexture||s.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),s.isData3DTexture&&(l=e.TEXTURE_3D);let h=I(t,s),u=s.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);let c=r.get(u);if(u.version!==c.__version||!0===h){n.activeTexture(e.TEXTURE0+o);let t=vr.getPrimaries(vr.workingColorSpace),r=s.colorSpace===ol?null:vr.getPrimaries(s.colorSpace),d=s.colorSpace===ol||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(s.image,!1,i.maxTextureSize);p=B(s,p);let f=a.convert(s.format,s.colorSpace),_=a.convert(s.type),w=y(s.internalFormat,f,_,s.colorSpace,s.isVideoTexture);P(l,s);let S,M=s.mipmaps,T=!0!==s.isVideoTexture,E=void 0===c.__version||!0===h,A=u.dataReady,C=b(s,p);if(s.isDepthTexture)w=x(s.format===id,s.type),E&&(T?n.texStorage2D(e.TEXTURE_2D,1,w,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,_,null));else if(s.isDataTexture)if(M.length>0){T&&E&&n.texStorage2D(e.TEXTURE_2D,C,w,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)S=M[t],T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,_,S.data):n.texImage2D(e.TEXTURE_2D,t,w,S.width,S.height,0,f,_,S.data);s.generateMipmaps=!1}else T?(E&&n.texStorage2D(e.TEXTURE_2D,C,w,p.width,p.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,_,p.data)):n.texImage2D(e.TEXTURE_2D,0,w,p.width,p.height,0,f,_,p.data);else if(s.isCompressedTexture)if(s.isCompressedArrayTexture){T&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,w,M[0].width,M[0].height,p.depth);for(let t=0,r=M.length;t<r;t++)if(S=M[t],s.format!==vs)if(null!==f)if(T){if(A)if(s.layerUpdates.size>0){let r=jk(S.width,S.height,s.format,s.type);for(let i of s.layerUpdates){let a=S.data.subarray(i*r/S.data.BYTES_PER_ELEMENT,(i+1)*r/S.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,S.width,S.height,1,f,a,0,0)}s.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,p.depth,f,S.data,0,0)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,w,S.width,S.height,p.depth,0,S.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,p.depth,f,_,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,w,S.width,S.height,p.depth,0,f,_,S.data)}else{T&&E&&n.texStorage2D(e.TEXTURE_2D,C,w,M[0].width,M[0].height);for(let t=0,r=M.length;t<r;t++)S=M[t],s.format!==vs?null!==f?T?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,w,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,_,S.data):n.texImage2D(e.TEXTURE_2D,t,w,S.width,S.height,0,f,_,S.data)}else if(s.isDataArrayTexture)if(T){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,w,p.width,p.height,p.depth),A)if(s.layerUpdates.size>0){let t=jk(p.width,p.height,s.format,s.type);for(let r of s.layerUpdates){let i=p.data.subarray(r*t/p.data.BYTES_PER_ELEMENT,(r+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,_,i)}s.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,w,p.width,p.height,p.depth,0,f,_,p.data);else if(s.isData3DTexture)T?(E&&n.texStorage3D(e.TEXTURE_3D,C,w,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):n.texImage3D(e.TEXTURE_3D,0,w,p.width,p.height,p.depth,0,f,_,p.data);else if(s.isFramebufferTexture){if(E)if(T)n.texStorage2D(e.TEXTURE_2D,C,w,p.width,p.height);else{let t=p.width,r=p.height;for(let i=0;i<C;i++)n.texImage2D(e.TEXTURE_2D,i,w,t,r,0,f,_,null),t>>=1,r>>=1}}else if(M.length>0){if(T&&E){let t=z(M[0]);n.texStorage2D(e.TEXTURE_2D,C,w,t.width,t.height)}for(let t=0,r=M.length;t<r;t++)S=M[t],T?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,_,S):n.texImage2D(e.TEXTURE_2D,t,w,f,_,S);s.generateMipmaps=!1}else if(T){if(E){let t=z(p);n.texStorage2D(e.TEXTURE_2D,C,w,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,_,p)}else n.texImage2D(e.TEXTURE_2D,0,w,f,_,p);g(s)&&v(l),c.__version=u.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}function L(t,i,s,o,h,u){let c=a.convert(s.format,s.colorSpace),d=a.convert(s.type),p=y(s.internalFormat,c,d,s.colorSpace);if(!r.get(i).__hasExternalTextures){let t=Math.max(1,i.width>>u),r=Math.max(1,i.height>>u);h===e.TEXTURE_3D||h===e.TEXTURE_2D_ARRAY?n.texImage3D(h,u,p,t,r,i.depth,0,c,d,null):n.texImage2D(h,u,p,t,r,0,c,d,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,h,r.get(s).__webglTexture,0,F(i)):(h===e.TEXTURE_2D||h>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&h<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,h,r.get(s).__webglTexture,u),n.bindFramebuffer(e.FRAMEBUFFER,null)}function O(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){let i=n.depthTexture,a=i&&i.isDepthTexture?i.type:null,s=x(n.stencilBuffer,a),o=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,h=F(n);U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,h,s,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,h,s,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,o,e.RENDERBUFFER,t)}else{let t=n.textures;for(let i=0;i<t.length;i++){let s=t[i],o=a.convert(s.format,s.colorSpace),h=a.convert(s.type),u=y(s.internalFormat,o,h,s.colorSpace),c=F(n);r&&!1===U(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,u,n.width,n.height):U(n)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,u,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,u,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){let i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(i.depthTexture).__webglTexture||i.depthTexture.image.width!==i.width||i.depthTexture.image.height!==i.height)&&(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);let a=r.get(i.depthTexture).__webglTexture,s=F(i);if(i.depthTexture.format===Qf)U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==id)throw new Error("Unknown depthTexture format");U(i)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),O(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),O(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}let k=[],N=[];function F(e){return Math.min(i.maxSamples,e.samples)}function U(e){let n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(e,t){let n=e.colorSpace,r=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==fl&&n!==ol&&(vr.getTransfer(n)===Hr?(r!==vs||i!==Xl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),t}function z(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){let e=M;return e>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+i.maxTextures),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(t,i){let a=r.get(t);t.version>0&&a.__version!==t.version?R(a,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){let a=r.get(t);t.version>0&&a.__version!==t.version?R(a,t,i):n.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,s){let o=r.get(t);t.version>0&&o.__version!==t.version?function(t,s,o){if(6!==s.image.length)return;let l=I(t,s),h=s.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);let u=r.get(h);if(h.version!==u.__version||!0===l){n.activeTexture(e.TEXTURE0+o);let t=vr.getPrimaries(vr.workingColorSpace),r=s.colorSpace===ol?null:vr.getPrimaries(s.colorSpace),c=s.colorSpace===ol||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,s.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,s.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,c);let d=s.isCompressedTexture||s.image[0].isCompressedTexture,p=s.image[0]&&s.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=d||p?p?s.image[e].image:s.image[e]:m(s.image[e],!0,i.maxCubemapSize),f[e]=B(s,f[e]);let x,_=f[0],w=a.convert(s.format,s.colorSpace),S=a.convert(s.type),M=y(s.internalFormat,w,S,s.colorSpace),T=!0!==s.isVideoTexture,E=void 0===u.__version||!0===l,A=h.dataReady,C=b(s,_);if(P(e.TEXTURE_CUBE_MAP,s),d){T&&E&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,M,_.width,_.height);for(let t=0;t<6;t++){x=f[t].mipmaps;for(let r=0;r<x.length;r++){let i=x[r];s.format!==vs?null!==w?T?A&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,w,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,M,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,w,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,M,i.width,i.height,0,w,S,i.data)}}}else{if(x=s.mipmaps,T&&E){x.length>0&&C++;let t=z(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,C,M,t.width,t.height)}for(let t=0;t<6;t++)if(p){T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,w,S,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,M,f[t].width,f[t].height,0,w,S,f[t].data);for(let r=0;r<x.length;r++){let i=x[r].image[t].image;T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,w,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,M,i.width,i.height,0,w,S,i.data)}}else{T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,w,S,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,M,w,S,f[t]);for(let r=0;r<x.length;r++){let i=x[r];T?A&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,w,S,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,M,w,S,i.image[t])}}}g(s)&&v(e.TEXTURE_CUBE_MAP),u.__version=h.version,s.onUpdate&&s.onUpdate(s)}t.__version=s.version}(o,t,s):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+s)},this.rebindTextures=function(t,n,i){let a=r.get(t);void 0!==n&&L(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&D(t)},this.setupRenderTarget=function(t){let i=t.texture,o=r.get(t),l=r.get(i);t.addEventListener("dispose",w);let h=t.textures,u=!0===t.isWebGLCubeRenderTarget,c=h.length>1;if(c||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,s.memory.textures++),u){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(c)for(let t=0,n=h.length;t<n;t++){let n=r.get(h[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}if(t.samples>0&&!1===U(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<h.length;n++){let r=h[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);let i=a.convert(r.format,r.colorSpace),s=a.convert(r.type),l=y(r.internalFormat,i,s,r.colorSpace,!0===t.isXRRenderTarget),u=F(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),O(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),P(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)L(o.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else L(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(c){for(let i=0,a=h.length;i<a;i++){let a=h[i],s=r.get(a);n.bindTexture(e.TEXTURE_2D,s.__webglTexture),P(e.TEXTURE_2D,a),L(o.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),g(a)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),P(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)L(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else L(o.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(t){let i=t.textures;for(let a=0,s=i.length;a<s;a++){let s=i[a];if(g(s)){let i=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(s).__webglTexture;n.bindTexture(i,a),v(i),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===U(t)){let i=t.textures,a=t.width,s=t.height,o=e.COLOR_BUFFER_BIT,l=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=r.get(t),c=i.length>1;if(c)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),c){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[n]);let t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),!0===h&&(k.length=0,N.length=0,k.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(k.push(l),N.push(l),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,N)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,k))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),c)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);let a=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&h){let n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=L,this.useMultisampledRTT=U}function ele(e,t){return{convert:function(n,r=ol){let i,a=vr.getTransfer(r);if(n===Xl)return e.UNSIGNED_BYTE;if(n===sM)return e.UNSIGNED_SHORT_4_4_4_4;if(n===aM)return e.UNSIGNED_SHORT_5_5_5_1;if(n===V6)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===U6)return e.BYTE;if(n===H6)return e.SHORT;if(n===Zm)return e.UNSIGNED_SHORT;if(n===iM)return e.INT;if(n===nu)return e.UNSIGNED_INT;if(n===ns)return e.FLOAT;if(n===ja)return e.HALF_FLOAT;if(n===z6)return e.ALPHA;if(n===q6)return e.RGB;if(n===vs)return e.RGBA;if(n===G6)return e.LUMINANCE;if(n===W6)return e.LUMINANCE_ALPHA;if(n===Qf)return e.DEPTH_COMPONENT;if(n===id)return e.DEPTH_STENCIL;if(n===oM)return e.RED;if(n===Oy)return e.RED_INTEGER;if(n===j6)return e.RG;if(n===lM)return e.RG_INTEGER;if(n===cM)return e.RGBA_INTEGER;if(n===V1||n===z1||n===q1||n===G1)if(a===Hr){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===V1)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===z1)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===q1)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===G1)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===V1)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===z1)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===q1)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===G1)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===jS||n===XS||n===YS||n===$S){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===jS)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===XS)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===YS)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===$S)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===ZS||n===KS||n===JS){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===ZS||n===KS)return a===Hr?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===JS)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===QS||n===ew||n===tw||n===nw||n===rw||n===iw||n===sw||n===aw||n===ow||n===lw||n===cw||n===uw||n===hw||n===fw){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===QS)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===ew)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===tw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===nw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===rw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===iw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===sw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===aw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ow)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===lw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===cw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===uw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===hw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===fw)return a===Hr?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===W1||n===dw||n===pw){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===W1)return a===Hr?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===dw)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===pw)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===X6||n===mw||n===gw||n===vw){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===W1)return i.COMPRESSED_RED_RGTC1_EXT;if(n===mw)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===gw)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===vw)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===rd?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}var _w=class extends ui{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Ai=class extends Cn{constructor(){super(),this.isGroup=!0,this.type="Group"}},Urt={type:"move"},X1=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ai,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ai,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ai,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(let r of e.hand.values()){let e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}let r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],s=r.position.distanceTo(i.position),o=.02,h=.005;l.inputState.pinching&&s>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Urt)))}return null!==s&&(s.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let n=new Ai;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}},Hrt="\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",Vrt="\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",Xk=class{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){let r=new ei;e.properties.get(r).__webglTexture=t.texture,(t.depthNear!=n.depthNear||t.depthFar!=n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){let t=e.cameras[0].viewport,n=new fr({vertexShader:Hrt,fragmentShader:Vrt,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Jt(new ys(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}},Yk=class extends cl{constructor(e,t){super();let n=this,r=null,i=1,a=null,s="local-floor",o=1,l=null,h=null,u=null,c=null,d=null,p=null,f=new Xk,m=t.getContextAttributes(),g=null,v=null,y=[],x=[],b=new Te,_=null,w=new ui;w.layers.enable(1),w.viewport=new hr;let S=new ui;S.layers.enable(2),S.viewport=new hr;let M=[w,S],T=new _w;T.layers.enable(1),T.layers.enable(2);let E=null,A=null;function C(e){let t=x.indexOf(e.inputSource);if(-1===t)return;let n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||a),n.dispatchEvent({type:e.type,data:e.inputSource}))}function P(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",I);for(let e=0;e<y.length;e++){let t=x[e];null!==t&&(x[e]=null,y[e].disconnect(t))}E=null,A=null,f.reset(),e.setRenderTarget(g),d=null,c=null,u=null,r=null,v=null,k.stop(),n.isPresenting=!1,e.setPixelRatio(_),e.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function I(e){for(let t=0;t<e.removed.length;t++){let n=e.removed[t],r=x.indexOf(n);r>=0&&(x[r]=null,y[r].disconnect(n))}for(let t=0;t<e.added.length;t++){let n=e.added[t],r=x.indexOf(n);if(-1===r){for(let e=0;e<y.length;e++){if(e>=x.length){x.push(n),r=e;break}if(null===x[e]){x[e]=n,r=e;break}}if(-1===r)break}let i=y[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new X1,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new X1,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new X1,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==c?c:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=function(h){return Et(this,null,(function*(){if(r=h,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",P),r.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&(yield t.makeXRCompatible()),_=e.getPixelRatio(),e.getSize(b),void 0===r.renderState.layers){let n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Qs(d.framebufferWidth,d.framebufferHeight,{format:vs,type:Xl,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,a=null,s=null;m.depth&&(s=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?id:Qf,a=m.stencil?rd:nu);let o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:i};u=new XRWebGLBinding(r,t),c=u.createProjectionLayer(o),r.updateRenderState({layers:[c]}),e.setPixelRatio(1),e.setSize(c.textureWidth,c.textureHeight,!1),v=new Qs(c.textureWidth,c.textureHeight,{format:vs,type:Xl,depthTexture:new uy(c.textureWidth,c.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===c.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=yield r.requestReferenceSpace(s),k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}}))},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};let R=new q,L=new q;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;null!==f.texture&&(e.near=f.depthNear,e.far=f.depthFar),T.near=S.near=w.near=e.near,T.far=S.far=w.far=e.far,(E!==T.near||A!==T.far)&&(r.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far,w.near=E,w.far=A,S.near=E,S.far=A,w.updateProjectionMatrix(),S.updateProjectionMatrix(),e.updateProjectionMatrix());let t=e.parent,n=T.cameras;O(T,t);for(let e=0;e<n.length;e++)O(n[e],t);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);let r=R.distanceTo(L),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,s=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],h=(i[9]-1)/i[5],u=(i[8]-1)/i[0],c=(a[8]+1)/a[0],d=s*u,p=s*c,f=r/(-u+c),m=f*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=s+f,v=o+f,y=d-m,x=p+(r-m),b=l*o/v*g,_=h*o/v*g;e.projectionMatrix.makePerspective(y,x,b,_,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Jm*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,T,t)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==c||null!==d)return o},this.setFoveation=function(e){o=e,null!==c&&(c.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let D=null;let k=new $oe;k.setAnimationLoop((function(t,i){if(h=i.getViewerPose(l||a),p=i,null!==h){let t=h.views;null!==d&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){let i=t[r],a=null;if(null!==d)a=d.getViewport(i);else{let t=u.getViewSubImage(c,i);a=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,c.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let s=M[r];void 0===s&&(s=new ui,s.layers.enable(r),s.viewport=new hr,M[r]=s),s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(i.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===r&&(T.matrix.copy(s.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(s)}let i=r.enabledFeatures;if(i&&i.includes("depth-sensing")){let n=u.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,r.renderState)}}for(let e=0;e<y.length;e++){let t=x[e],n=y[e];null!==t&&void 0!==n&&n.update(t,i,l||a)}D&&D(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){D=e},this.dispose=function(){}}},Bf=new Fi,zrt=new At;function qrt(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,r.side===zi&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),r.side===zi&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);let i=t.get(r),a=i.envMap,s=i.envMapRotation;a&&(e.envMap.value=a,Bf.copy(s),Bf.x*=-1,Bf.y*=-1,Bf.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Bf.y*=-1,Bf.z*=-1),e.envMapRotation.value.setFromMatrix4(zrt.makeRotationFromEuler(Bf)),e.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Yoe(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,a,s,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform)),e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform)),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===zi&&e.clearcoatNormalScale.value.negate())),t.dispersion>0&&(e.dispersion.value=t.dispersion),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){let r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,a,s):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Grt(e,t,n,r){let i={},a={},s=[],o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){let i=e.value,a=t+"_"+n;if(void 0===r[a])return r[a]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{let e=r[a];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[a]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function h(e){let t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){let n=t.target;n.removeEventListener("dispose",u);let r=s.indexOf(n.__bindingPointIndex);s.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){let n=t.program;r.uniformBlockBinding(e,n)},update:function(n,c){let d=i[n.id];void 0===d&&(function(e){let t=e.uniforms,n=0,r=16;for(let e=0,i=t.length;e<i;e++){let i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=i.length;e<t;e++){let t=i[e],a=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=a.length;e<i;e++){let i=h(a[e]),s=n%r,o=s%i.boundary,l=s+o;n+=o,0!==l&&r-l<i.storage&&(n+=r-l),t.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,n+=i.storage}}}let i=n%r;i>0&&(n+=r-i),e.__size=n,e.__cache={}}(n),d=function(t){let n=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;let r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=d,n.addEventListener("dispose",u));let p=c.program;r.updateUBOMapping(n,p);let f=t.render.frame;a[n.id]!==f&&(function(t){let n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){let n=Array.isArray(r[t])?r[t]:[r[t]];for(let r=0,i=n.length;r<i;r++){let i=n[r];if(!0===l(i,t,r,a)){let t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value],r=0;for(let a=0;a<n.length;a++){let s=n[a],o=h(s);"number"==typeof s||"boolean"==typeof s?(i.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):s.isMatrix3?(i.__data[0]=s.elements[0],i.__data[1]=s.elements[1],i.__data[2]=s.elements[2],i.__data[3]=0,i.__data[4]=s.elements[3],i.__data[5]=s.elements[4],i.__data[6]=s.elements[5],i.__data[7]=0,i.__data[8]=s.elements[6],i.__data[9]=s.elements[7],i.__data[10]=s.elements[8],i.__data[11]=0):(s.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),a[n.id]=f)},dispose:function(){for(let t in i)e.deleteBuffer(i[t]);s=[],i={},a={}}}}var hl=class{constructor(e={}){let t,{canvas:n=joe(),context:r=null,depth:i=!0,stencil:a=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:h=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:c=!1}=e;if(this.isWebGLRenderer=!0,null!==r){if("undefined"!=typeof WebGLRenderingContext&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");t=r.getContextAttributes().alpha}else t=s;let d=new Uint32Array(4),p=new Int32Array(4),f=null,m=null,g=[],v=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=yi,this.toneMapping=eu,this.toneMappingExposure=1;let y=this,x=!1,b=0,_=0,w=null,S=-1,M=null,T=new hr,E=new hr,A=null,C=new Ot(0),P=0,I=n.width,R=n.height,L=1,O=null,D=null,k=new hr(0,0,I,R),N=new hr(0,0,I,R),F=!1,U=new ul,B=!1,z=!1,H=new At,V=new q,j=new hr,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0},W=!1;function X(){return null===w?L:1}let Y,Z,J,K,Q,$,ee,te,ne,re,ie,ae,se,oe,le,he,ue,ce,de,pe,fe,me,ge,ve,ye=r;function xe(e,t){return n.getContext(e,t)}try{let e={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${Eg}`),n.addEventListener("webglcontextlost",we,!1),n.addEventListener("webglcontextrestored",Se,!1),n.addEventListener("webglcontextcreationerror",Me,!1),null===ye){let t="webgl2";if(ye=xe(t,e),null===ye)throw xe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function be(){Y=new int(ye),Y.init(),me=new ele(ye,Y),Z=new Jtt(ye,Y,e,me),J=new Drt(ye),K=new ont(ye),Q=new brt,$=new Brt(ye,Y,J,Q,Z,me,K),ee=new ent(y),te=new rnt(y),ne=new fQe(ye),ge=new Ztt(ye,ne),re=new snt(ye,ne,K,ge),ie=new cnt(ye,re,ne,K),de=new lnt(ye,Z,$),he=new Qtt(Q),ae=new xrt(y,ee,te,Y,Z,ge,he),se=new qrt(y,Q),oe=new _rt,le=new Crt(Y),ce=new $tt(y,ee,te,J,ie,t,l),ue=new Irt(y,ie,Z),ve=new Grt(ye,K,Z,J),pe=new Ktt(ye,Y,K),fe=new ant(ye,Y,K),K.programs=ae.programs,y.capabilities=Z,y.extensions=Y,y.properties=Q,y.renderLists=oe,y.shadowMap=ue,y.state=J,y.info=K}be();let _e=new Yk(y,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;let e=K.autoReset,t=ue.enabled,n=ue.autoUpdate,r=ue.needsUpdate,i=ue.type;be(),K.autoReset=e,ue.enabled=t,ue.autoUpdate=n,ue.needsUpdate=r,ue.type=i}function Me(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Te(e){let t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){let t=Q.get(e).programs;void 0!==t&&(t.forEach((function(e){ae.releaseProgram(e)})),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),Q.remove(e)}(t)}function Ee(e,t,n){!0===e.transparent&&e.side===Mr&&!1===e.forceSinglePass?(e.side=zi,e.needsUpdate=!0,Ne(e,t,n),e.side=Os,e.needsUpdate=!0,Ne(e,t,n),e.side=Mr):Ne(e,t,n)}this.xr=_e,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){let e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(I,R,!1))},this.getSize=function(e){return e.set(I,R)},this.setSize=function(e,t,r=!0){_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(I=e,R=t,n.width=Math.floor(e*L),n.height=Math.floor(t*L),!0===r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(I*L,R*L).floor()},this.setDrawingBufferSize=function(e,t,r){I=e,R=t,L=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(T)},this.getViewport=function(e){return e.copy(k)},this.setViewport=function(e,t,n,r){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,n,r),J.viewport(T.copy(k).multiplyScalar(L).round())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),J.scissor(E.copy(N).multiplyScalar(L).round())},this.getScissorTest=function(){return F},this.setScissorTest=function(e){J.setScissorTest(F=e)},this.setOpaqueSort=function(e){O=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==w){let t=w.texture.format;e=t===cM||t===lM||t===Oy}if(e){let e=w.texture.type,t=e===Xl||e===nu||e===Zm||e===rd||e===sM||e===aM,n=ce.getClearColor(),r=ce.getClearAlpha(),i=n.r,a=n.g,s=n.b;t?(d[0]=i,d[1]=a,d[2]=s,d[3]=r,ye.clearBufferuiv(ye.COLOR,0,d)):(p[0]=i,p[1]=a,p[2]=s,p[3]=r,ye.clearBufferiv(ye.COLOR,0,p))}else r|=ye.COLOR_BUFFER_BIT}t&&(r|=ye.DEPTH_BUFFER_BIT),n&&(r|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",we,!1),n.removeEventListener("webglcontextrestored",Se,!1),n.removeEventListener("webglcontextcreationerror",Me,!1),oe.dispose(),le.dispose(),Q.dispose(),ee.dispose(),te.dispose(),ie.dispose(),ge.dispose(),ve.dispose(),ae.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Ce),_e.removeEventListener("sessionend",Pe),Ie.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=G);let s=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=G),$.resetTextureUnits();let a=t.fog,s=r.isMeshStandardMaterial?t.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:fl,l=(r.isMeshStandardMaterial?te:ee).get(r.envMap||s),h=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),c=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,f=eu;r.toneMapped&&(null===w||!0===w.isXRRenderTarget)&&(f=y.toneMapping);let g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,x=Q.get(r),b=m.state.lights;if(!0===B&&(!0===z||e!==M)){let t=e===M&&r.id===S;he.setState(r,e,t)}let _=!1;r.version===x.__version?(x.needsLights&&x.lightsStateVersion!==b.state.version||x.outputColorSpace!==o||i.isBatchedMesh&&!1===x.batching||!i.isBatchedMesh&&!0===x.batching||i.isBatchedMesh&&!0===x.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===x.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===x.instancing||!i.isInstancedMesh&&!0===x.instancing||i.isSkinnedMesh&&!1===x.skinning||!i.isSkinnedMesh&&!0===x.skinning||i.isInstancedMesh&&!0===x.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===x.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===x.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===x.instancingMorph&&null!==i.morphTexture||x.envMap!==l||!0===r.fog&&x.fog!==a||void 0!==x.numClippingPlanes&&(x.numClippingPlanes!==he.numPlanes||x.numIntersection!==he.numIntersection)||x.vertexAlphas!==h||x.vertexTangents!==u||x.morphTargets!==c||x.morphNormals!==d||x.morphColors!==p||x.toneMapping!==f||x.morphTargetsCount!==v)&&(_=!0):(_=!0,x.__version=r.version);let T=x.currentProgram;!0===_&&(T=Ne(r,t,i));let E=!1,A=!1,C=!1,P=T.getUniforms(),I=x.uniforms;if(J.useProgram(T.program)&&(E=!0,A=!0,C=!0),r.id!==S&&(S=r.id,A=!0),E||M!==e){P.setValue(ye,"projectionMatrix",e.projectionMatrix),P.setValue(ye,"viewMatrix",e.matrixWorldInverse);let t=P.map.cameraPosition;void 0!==t&&t.setValue(ye,V.setFromMatrixPosition(e.matrixWorld)),Z.logarithmicDepthBuffer&&P.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&P.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),M!==e&&(M=e,A=!0,C=!0)}if(i.isSkinnedMesh){P.setOptional(ye,i,"bindMatrix"),P.setOptional(ye,i,"bindMatrixInverse");let e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(ye,"boneTexture",e.boneTexture,$))}i.isBatchedMesh&&(P.setOptional(ye,i,"batchingTexture"),P.setValue(ye,"batchingTexture",i._matricesTexture,$),P.setOptional(ye,i,"batchingIdTexture"),P.setValue(ye,"batchingIdTexture",i._indirectTexture,$),P.setOptional(ye,i,"batchingColorTexture"),null!==i._colorsTexture&&P.setValue(ye,"batchingColorTexture",i._colorsTexture,$));let O=n.morphAttributes;if((void 0!==O.position||void 0!==O.normal||void 0!==O.color)&&de.update(i,n,T),(A||x.receiveShadow!==i.receiveShadow)&&(x.receiveShadow=i.receiveShadow,P.setValue(ye,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(I.envMap.value=l,I.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(I.envMapIntensity.value=t.environmentIntensity),A&&(P.setValue(ye,"toneMappingExposure",y.toneMappingExposure),x.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(I,C),a&&!0===r.fog&&se.refreshFogUniforms(I,a),se.refreshMaterialUniforms(I,r,L,R,m.state.transmissionRenderTarget[e.id]),$m.upload(ye,Fe(x),I,$)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&($m.upload(ye,Fe(x),I,$),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&P.setValue(ye,"center",i.center),P.setValue(ye,"modelViewMatrix",i.modelViewMatrix),P.setValue(ye,"normalMatrix",i.normalMatrix),P.setValue(ye,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){let e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){let n=e[t];ve.update(n,T),ve.bind(n,T)}}return T}(e,t,n,r,i);J.setMaterial(r,s);let l=n.index,h=1;if(!0===r.wireframe){if(l=re.getWireframeAttribute(n),void 0===l)return;h=2}let u=n.drawRange,c=n.attributes.position,d=u.start*h,p=(u.start+u.count)*h;null!==a&&(d=Math.max(d,a.start*h),p=Math.min(p,(a.start+a.count)*h)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=c&&(d=Math.max(d,0),p=Math.min(p,c.count));let f=p-d;if(f<0||f===1/0)return;ge.setup(i,r,o,n,l);let g,v=pe;if(null!==l&&(g=ne.get(l),v=fe,v.setIndex(g)),i.isMesh)!0===r.wireframe?(J.setLineWidth(r.wireframeLinewidth*X()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),J.setLineWidth(e*X()),i.isLineSegments?v.setMode(ye.LINES):i.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else i.isPoints?v.setMode(ye.POINTS):i.isSprite&&v.setMode(ye.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)v.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(Y.get("WEBGL_multi_draw"))v.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{let e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,a=l?ne.get(l).bytesPerElement:1,s=Q.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)s.setValue(ye,"_gl_DrawID",r),v.render(e[r]/a,t[r])}else if(i.isInstancedMesh)v.renderInstances(d,f,i.count);else if(n.isInstancedBufferGeometry){let e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t,n=null){null===n&&(n=e),m=le.get(n),m.init(t),v.push(m),n.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==n&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights();let r=new Set;return e.traverse((function(e){let t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){let a=t[i];Ee(a,n,e),r.add(a)}else Ee(t,n,e),r.add(t)})),v.pop(),m=null,r},this.compileAsync=function(e,t,n=null){let r=this.compile(e,t,n);return new Promise((t=>{function n(){r.forEach((function(e){Q.get(e).currentProgram.isReady()&&r.delete(e)})),0!==r.size?setTimeout(n,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Ae=null;function Ce(){Ie.stop()}function Pe(){Ie.start()}let Ie=new $oe;function Re(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);let t=ie.update(e),i=e.material;i.visible&&f.push(e,t,i,n,j.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||U.intersectsObject(e))){let t=ie.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),j.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),j.copy(t.boundingSphere.center)),j.applyMatrix4(e.matrixWorld).applyMatrix4(H)),Array.isArray(i)){let r=t.groups;for(let a=0,s=r.length;a<s;a++){let s=r[a],o=i[s.materialIndex];o&&o.visible&&f.push(e,t,o,n,j.z,s)}}else i.visible&&f.push(e,t,i,n,j.z,null)}let i=e.children;for(let e=0,a=i.length;e<a;e++)Re(i[e],t,n,r)}function Le(e,t,n,r){let i=e.opaque,a=e.transmissive,s=e.transparent;m.setupLightsView(n),!0===B&&he.setGlobalState(y.clippingPlanes,n),r&&J.viewport(T.copy(r)),i.length>0&&De(i,t,n),a.length>0&&De(a,t,n),s.length>0&&De(s,t,n),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function Oe(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[r.id]&&(m.state.transmissionRenderTarget[r.id]=new Qs(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")||Y.has("EXT_color_buffer_float")?ja:Xl,minFilter:Eo,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:vr.workingColorSpace}));let i=m.state.transmissionRenderTarget[r.id],s=r.viewport||T;i.setSize(s.z,s.w);let o=y.getRenderTarget();y.setRenderTarget(i),y.getClearColor(C),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5),y.clear(),W&&ce.render(n);let l=y.toneMapping;y.toneMapping=eu;let h=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),m.setupLightsView(r),!0===B&&he.setGlobalState(y.clippingPlanes,r),De(e,n,r),$.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i),!1===Y.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,a=t.length;i<a;i++){let a=t[i],s=a.object,o=a.geometry,l=a.material,h=a.group;if(l.side===Mr&&s.layers.test(r.layers)){let t=l.side;l.side=zi,l.needsUpdate=!0,ke(s,n,r,o,l,h),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&($.updateMultisampleRenderTarget(i),$.updateRenderTargetMipmap(i))}y.setRenderTarget(o),y.setClearColor(C,P),void 0!==h&&(r.viewport=h),y.toneMapping=l}function De(e,t,n){let r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,a=e.length;i<a;i++){let a=e[i],s=a.object,o=a.geometry,l=null===r?a.material:r,h=a.group;s.layers.test(n.layers)&&ke(s,t,n,o,l,h)}}function ke(e,t,n,r,i,a){e.onBeforeRender(y,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),!0===i.transparent&&i.side===Mr&&!1===i.forceSinglePass?(i.side=zi,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=Os,i.needsUpdate=!0,y.renderBufferDirect(n,t,r,i,e,a),i.side=Mr):y.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(y,t,n,r,i,a)}function Ne(e,t,n){!0!==t.isScene&&(t=G);let r=Q.get(e),i=m.state.lights,a=m.state.shadowsArray,s=i.state.version,o=ae.getParameters(e,i.state,a,t,n),l=ae.getProgramCacheKey(o),h=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===h&&(e.addEventListener("dispose",Te),h=new Map,r.programs=h);let u=h.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===s)return Ue(e,o),u}else o.uniforms=ae.getUniforms(e),e.onBeforeCompile(o,y),u=ae.acquireProgram(o,l),h.set(l,u),r.uniforms=o.uniforms;let c=r.uniforms;return(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(c.clippingPlanes=he.uniform),Ue(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(c.ambientLightColor.value=i.state.ambient,c.lightProbe.value=i.state.probe,c.directionalLights.value=i.state.directional,c.directionalLightShadows.value=i.state.directionalShadow,c.spotLights.value=i.state.spot,c.spotLightShadows.value=i.state.spotShadow,c.rectAreaLights.value=i.state.rectArea,c.ltc_1.value=i.state.rectAreaLTC1,c.ltc_2.value=i.state.rectAreaLTC2,c.pointLights.value=i.state.point,c.pointLightShadows.value=i.state.pointShadow,c.hemisphereLights.value=i.state.hemi,c.directionalShadowMap.value=i.state.directionalShadowMap,c.directionalShadowMatrix.value=i.state.directionalShadowMatrix,c.spotShadowMap.value=i.state.spotShadowMap,c.spotLightMatrix.value=i.state.spotLightMatrix,c.spotLightMap.value=i.state.spotLightMap,c.pointShadowMap.value=i.state.pointShadowMap,c.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=u,r.uniformsList=null,u}function Fe(e){if(null===e.uniformsList){let t=e.currentProgram.getUniforms();e.uniformsList=$m.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){let n=Q.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Ie.setAnimationLoop((function(e){Ae&&Ae(e)})),"undefined"!=typeof self&&Ie.setContext(self),this.setAnimationLoop=function(e){Ae=e,_e.setAnimationLoop(e),null===e?Ie.stop():Ie.start()},_e.addEventListener("sessionstart",Ce),_e.addEventListener("sessionend",Pe),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),m=le.get(e,v.length),m.init(t),v.push(m),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),z=this.localClippingEnabled,B=he.init(this.clippingPlanes,z),f=oe.get(e,g.length),f.init(),g.push(f),!0===_e.enabled&&!0===_e.isPresenting){let e=y.xr.getDepthSensingMesh();null!==e&&Re(e,t,-1/0,y.sortObjects)}Re(e,t,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(O,D),W=!1===_e.enabled||!1===_e.isPresenting||!1===_e.hasDepthSensing(),W&&ce.addToRenderList(f,e),this.info.render.frame++,!0===B&&he.beginShadows();let n=m.state.shadowsArray;ue.render(n,e,t),!0===B&&he.endShadows(),!0===this.info.autoReset&&this.info.reset();let r=f.opaque,i=f.transmissive;if(m.setupLights(),t.isArrayCamera){let n=t.cameras;if(i.length>0)for(let t=0,a=n.length;t<a;t++){Oe(r,i,e,n[t])}W&&ce.render(e);for(let t=0,r=n.length;t<r;t++){let r=n[t];Le(f,e,r,r.viewport)}}else i.length>0&&Oe(r,i,e,t),W&&ce.render(e),Le(f,e,t);null!==w&&($.updateMultisampleRenderTarget(w),$.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),ge.resetDefaultState(),S=-1,M=null,v.pop(),v.length>0?(m=v[v.length-1],!0===B&&he.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){Q.get(e.texture).__webglTexture=t,Q.get(e.depthTexture).__webglTexture=n;let r=Q.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){let n=Q.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){w=e,b=t,_=n;let r=!0,i=null,a=!1,s=!1;if(e){let o=Q.get(e);void 0!==o.__useDefaultFramebuffer?(J.bindFramebuffer(ye.FRAMEBUFFER,null),r=!1):void 0===o.__webglFramebuffer?$.setupRenderTarget(e):o.__hasExternalTextures&&$.rebindTextures(e,Q.get(e.texture).__webglTexture,Q.get(e.depthTexture).__webglTexture);let l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);let h=Q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(h[t])?h[t][n]:h[t],a=!0):i=e.samples>0&&!1===$.useMultisampledRTT(e)?Q.get(e).__webglMultisampledFramebuffer:Array.isArray(h)?h[n]:h,T.copy(e.viewport),E.copy(e.scissor),A=e.scissorTest}else T.copy(k).multiplyScalar(L).floor(),E.copy(N).multiplyScalar(L).floor(),A=F;if(J.bindFramebuffer(ye.FRAMEBUFFER,i)&&r&&J.drawBuffers(e,i),J.viewport(T),J.scissor(E),J.setScissorTest(A),a){let r=Q.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(s){let r=Q.get(e.texture),i=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){J.bindFramebuffer(ye.FRAMEBUFFER,o);try{let s=e.texture,o=s.format,l=s.type;if(!Z.textureFormatReadable(o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Z.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&ye.readPixels(t,n,r,i,me.convert(o),me.convert(l),a)}finally{let e=null!==w?Q.get(w).__webglFramebuffer:null;J.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=function(e,t,n,r,i,a,s){return Et(this,null,(function*(){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=Q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){J.bindFramebuffer(ye.FRAMEBUFFER,o);try{let s=e.texture,o=s.format,l=s.type;if(!Z.textureFormatReadable(o))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Z.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){let e=ye.createBuffer();ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.bufferData(ye.PIXEL_PACK_BUFFER,a.byteLength,ye.STREAM_READ),ye.readPixels(t,n,r,i,me.convert(o),me.convert(l),0),ye.flush();let s=ye.fenceSync(ye.SYNC_GPU_COMMANDS_COMPLETE,0);yield jJe(ye,s,4);try{ye.bindBuffer(ye.PIXEL_PACK_BUFFER,e),ye.getBufferSubData(ye.PIXEL_PACK_BUFFER,0,a)}finally{ye.deleteBuffer(e),ye.deleteSync(s)}return a}}finally{let e=null!==w?Q.get(w).__webglFramebuffer:null;J.bindFramebuffer(ye.FRAMEBUFFER,e)}}}))},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(Xm("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);let r=Math.pow(2,-n),i=Math.floor(e.image.width*r),a=Math.floor(e.image.height*r),s=null!==t?t.x:0,o=null!==t?t.y:0;$.setTexture2D(e,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,n,0,0,s,o,i,a),J.unbindTexture()},this.copyTextureToTexture=function(e,t,n=null,r=null,i=0){let a,s,o,l,h,u;!0!==e.isTexture&&(Xm("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,e=arguments[1],t=arguments[2],i=arguments[3]||0,n=null),null!==n?(a=n.max.x-n.min.x,s=n.max.y-n.min.y,o=n.min.x,l=n.min.y):(a=e.image.width,s=e.image.height,o=0,l=0),null!==r?(h=r.x,u=r.y):(h=0,u=0);let c=me.convert(t.format),d=me.convert(t.type);$.setTexture2D(t,0),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);let p=ye.getParameter(ye.UNPACK_ROW_LENGTH),f=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),m=ye.getParameter(ye.UNPACK_SKIP_PIXELS),g=ye.getParameter(ye.UNPACK_SKIP_ROWS),v=ye.getParameter(ye.UNPACK_SKIP_IMAGES),y=e.isCompressedTexture?e.mipmaps[i]:e.image;ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,y.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,o),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,l),e.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,i,h,u,a,s,c,d,y.data):e.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,i,h,u,y.width,y.height,c,y.data):ye.texSubImage2D(ye.TEXTURE_2D,i,h,u,a,s,c,d,y),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,p),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,m),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,g),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,v),0===i&&t.generateMipmaps&&ye.generateMipmap(ye.TEXTURE_2D),J.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,r=null,i=0){!0!==e.isTexture&&(Xm("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,e=arguments[2],t=arguments[3],i=arguments[4]||0);let a,s,o,l,h,u,c,d,p,f=e.isCompressedTexture?e.mipmaps[i]:e.image;null!==n?(a=n.max.x-n.min.x,s=n.max.y-n.min.y,o=n.max.z-n.min.z,l=n.min.x,h=n.min.y,u=n.min.z):(a=f.width,s=f.height,o=f.depth,l=0,h=0,u=0),null!==r?(c=r.x,d=r.y,p=r.z):(c=0,d=0,p=0);let m,g=me.convert(t.format),v=me.convert(t.type);if(t.isData3DTexture)$.setTexture3D(t,0),m=ye.TEXTURE_3D;else{if(!t.isDataArrayTexture&&!t.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(t,0),m=ye.TEXTURE_2D_ARRAY}ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,t.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,t.unpackAlignment);let y=ye.getParameter(ye.UNPACK_ROW_LENGTH),x=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),b=ye.getParameter(ye.UNPACK_SKIP_PIXELS),_=ye.getParameter(ye.UNPACK_SKIP_ROWS),w=ye.getParameter(ye.UNPACK_SKIP_IMAGES);ye.pixelStorei(ye.UNPACK_ROW_LENGTH,f.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,f.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,l),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,h),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,u),e.isDataTexture||e.isData3DTexture?ye.texSubImage3D(m,i,c,d,p,a,s,o,g,v,f.data):t.isCompressedArrayTexture?ye.compressedTexSubImage3D(m,i,c,d,p,a,s,o,g,f.data):ye.texSubImage3D(m,i,c,d,p,a,s,o,g,v,f),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,y),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,x),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,b),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,_),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,w),0===i&&t.generateMipmaps&&ye.generateMipmap(m),J.unbindTexture()},this.initRenderTarget=function(e){void 0===Q.get(e).__webglFramebuffer&&$.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?$.setTextureCube(e,0):e.isData3DTexture?$.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?$.setTexture2DArray(e,0):$.setTexture2D(e,0),J.unbindTexture()},this.resetState=function(){b=0,_=0,w=null,J.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return jl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===hM?"display-p3":"srgb",t.unpackColorSpace=vr.workingColorSpace===Ly?"display-p3":"srgb"}},tg=class{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ot(e),this.density=t}clone(){return new tg(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}},ng=class{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ot(e),this.near=t,this.far=n}clone(){return new ng(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}},ea=class extends Cn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Fi,this.environmentIntensity=1,this.environmentRotation=new Fi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}},cd=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=ry,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=qa()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return Xm("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qa()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qa()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Zs=new q,So=class{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Zs.fromBufferAttribute(this,t),Zs.applyMatrix4(e),this.setXYZ(t,Zs.x,Zs.y,Zs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Zs.fromBufferAttribute(this,t),Zs.applyNormalMatrix(e),this.setXYZ(t,Zs.x,Zs.y,Zs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Zs.fromBufferAttribute(this,t),Zs.transformDirection(e),this.setXYZ(t,Zs.x,Zs.y,Zs.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Js(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Nn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Nn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Js(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Js(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Js(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Js(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nn(t,this.array),n=Nn(n,this.array),r=Nn(r,this.array),i=Nn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new vn(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new So(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},dy=class extends Ir{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},Um,I1=new q,Hm=new q,Vm=new q,zm=new Te,D1=new Te,tle=new At,yS=new q,O1=new q,xS=new q,tae=new Te,hk=new Te,nae=new Te,Tw=class extends Cn{constructor(e=new dy){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Um){Um=new Nt;let e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new cd(e,5);Um.setIndex([0,1,2,0,2,3]),Um.setAttribute("position",new So(t,3,0,!1)),Um.setAttribute("uv",new So(t,2,3,!1))}this.geometry=Um,this.material=e,this.center=new Te(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Hm.setFromMatrixScale(this.matrixWorld),tle.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Vm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Hm.multiplyScalar(-Vm.z);let n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));let a=this.center;bS(yS.set(-.5,-.5,0),Vm,a,Hm,n,r),bS(O1.set(.5,-.5,0),Vm,a,Hm,n,r),bS(xS.set(.5,.5,0),Vm,a,Hm,n,r),tae.set(0,0),hk.set(1,0),nae.set(1,1);let s=e.ray.intersectTriangle(yS,O1,xS,!1,I1);if(null===s&&(bS(O1.set(-.5,.5,0),Vm,a,Hm,n,r),hk.set(0,1),s=e.ray.intersectTriangle(yS,xS,O1,!1,I1),null===s))return;let o=e.ray.origin.distanceTo(I1);o<e.near||o>e.far||t.push({distance:o,point:I1.clone(),uv:Pr.getInterpolation(I1,yS,O1,xS,tae,hk,nae,new Te),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}};function bS(e,t,n,r,i,a){zm.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(D1.x=a*zm.x-i*zm.y,D1.y=i*zm.x+a*zm.y):D1.copy(zm),e.copy(t),e.x+=D1.x,e.y+=D1.y,e.applyMatrix4(tle)}var ES=new q,rae=new q,Sw=class extends Cn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let e=0,n=t.length;e<n;e++){let n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);let r,i=this.levels;for(r=0;r<i.length&&!(t<i[r].distance);r++);return i.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ES.setFromMatrixPosition(this.matrixWorld);let n=e.ray.origin.distanceTo(ES);this.getObjectForDistance(n).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){ES.setFromMatrixPosition(e.matrixWorld),rae.setFromMatrixPosition(this.matrixWorld);let n,r,i=ES.distanceTo(rae)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r;n++){let e=t[n].distance;if(t[n].object.visible&&(e-=e*t[n].hysteresis),!(i>=e))break;t[n-1].object.visible=!1,t[n].object.visible=!0}for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}toJSON(e){let t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];let n=this.levels;for(let e=0,r=n.length;e<r;e++){let r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}},iae=new q,sae=new hr,aae=new hr,Wrt=new q,oae=new At,_S=new q,fk=new ir,lae=new At,dk=new _o,ww=class extends Jt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Pk,this.bindMatrix=new At,this.bindMatrixInverse=new At,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Ft),this.boundingBox.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,_S),this.boundingBox.expandByPoint(_S)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new ir),this.boundingSphere.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,_S),this.boundingSphere.expandByPoint(_S)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){let n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),fk.copy(this.boundingSphere),fk.applyMatrix4(r),!1!==e.ray.intersectsSphere(fk)&&(lae.copy(r).invert(),dk.copy(e.ray).applyMatrix4(lae),(null===this.boundingBox||!1!==dk.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,dk)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new hr,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);let r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Pk?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Coe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){let n=this.skeleton,r=this.geometry;sae.fromBufferAttribute(r.attributes.skinIndex,e),aae.fromBufferAttribute(r.attributes.skinWeight,e),iae.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let r=aae.getComponent(e);if(0!==r){let i=sae.getComponent(e);oae.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Wrt.copy(iae).applyMatrix4(oae),r)}}return t.applyMatrix4(this.bindMatrixInverse)}},py=class extends Cn{constructor(){super(),this.isBone=!0,this.type="Bone"}},ba=class extends ei{constructor(e=null,t=1,n=1,r,i,a,s,o,l=Li,h=Li,u,c){super(null,a,s,o,l,h,r,i,u,c),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},cae=new At,jrt=new At,rg=class{constructor(e=[],t=[]){this.uuid=qa(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new At)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new At;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){let i=e[r]?e[r].matrixWorld:jrt;cae.multiplyMatrices(i,t[r]),cae.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new rg(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let n=new ba(t,e,e,vs,ns);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){let n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=e.bones[n],i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new py),this.bones.push(i),this.boneInverses.push((new At).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){let i=t[r];e.bones.push(i.uuid);let a=n[r];e.boneInverses.push(a.toArray())}return e}},iu=class extends vn{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},qm=new At,uae=new At,TS=[],hae=new Ft,Xrt=new At,L1=new Jt,k1=new ir,wo=class extends Jt{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new iu(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,Xrt)}computeBoundingBox(){let e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Ft),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,qm),hae.copy(e.boundingBox).applyMatrix4(qm),this.boundingBox.union(hae)}computeBoundingSphere(){let e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new ir),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,qm),k1.copy(e.boundingSphere).applyMatrix4(qm),this.boundingSphere.union(k1)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){let n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[i+e]}raycast(e,t){let n=this.matrixWorld,r=this.count;if(L1.geometry=this.geometry,L1.material=this.material,void 0!==L1.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),k1.copy(this.boundingSphere),k1.applyMatrix4(n),!1!==e.ray.intersectsSphere(k1)))for(let i=0;i<r;i++){this.getMatrixAt(i,qm),uae.multiplyMatrices(n,qm),L1.matrixWorld=uae,L1.raycast(e,TS);for(let e=0,n=TS.length;e<n;e++){let n=TS[e];n.instanceId=i,n.object=this,t.push(n)}TS.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new iu(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){let n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new ba(new Float32Array(r*this.count),r,this.count,oM,ns));let i=this.morphTexture.source.data.data,a=0;for(let e=0;e<n.length;e++)a+=n[e];let s=this.geometry.morphTargetsRelative?1:1-a,o=r*e;i[o]=s,i.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}};function Yrt(e,t){return e.z-t.z}function $rt(e,t){return t.z-e.z}var $k=class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n){let r=this.pool,i=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1,index:-1});let a=r[this.index];i.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=t,a.index=n}reset(){this.list.length=0,this.index=0}},sh=new At,pk=new At,Zrt=new At,Krt=new Ot(1,1,1),fae=new At,mk=new ul,SS=new Ft,Uf=new ir,F1=new q,dae=new q,Jrt=new q,gk=new $k,Is=new Jt,wS=[];function Qrt(e,t,n=0){let r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){let i=e.count;for(let a=0;a<i;a++)for(let i=0;i<r;i++)t.setComponent(a+n,i,e.getComponent(a,i))}else t.array.set(e.array,n*r);t.needsUpdate=!0}var Mw=class extends Jt{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,t,n=2*t,r){super(new Nt,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);let t=new Float32Array(e*e*4),n=new ba(t,e,e,vs,ns);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);let t=new Uint32Array(e*e),n=new ba(t,e,e,Oy,nu);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxIndexCount);e=Math.ceil(e);let t=new Float32Array(e*e*4).fill(1),n=new ba(t,e,e,vs,ns);n.colorSpace=vr.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){let t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(let r in e.attributes){let i=e.getAttribute(r),{array:a,itemSize:s,normalized:o}=i,l=new a.constructor(n*s),h=new vn(l,s,o);t.setAttribute(r,h)}if(null!==e.getIndex()){let e=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new vn(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){let t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(let n in t.attributes){if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);let r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ft);let e=this._geometryCount,t=this.boundingBox,n=this._drawInfo;t.makeEmpty();for(let r=0;r<e;r++){if(!1===n[r].active)continue;let e=n[r].geometryIndex;this.getMatrixAt(r,sh),this.getBoundingBoxAt(e,SS).applyMatrix4(sh),t.union(SS)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ir);let e=this.boundingSphere,t=this._drawInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;let r=t[n].geometryIndex;this.getMatrixAt(n,sh),this.getBoundingSphereAt(r,Uf).applyMatrix4(sh),e.union(Uf)}}addInstance(e){if(this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");this._drawInfo.push({visible:!0,active:!0,geometryIndex:e});let t=this._drawInfo.length-1,n=this._matricesTexture,r=n.image.data;Zrt.toArray(r,16*t),n.needsUpdate=!0;let i=this._colorsTexture;return i&&(Krt.toArray(i.image.data,4*t),i.needsUpdate=!0),t}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");let r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},i=null,a=this._reservedRanges,s=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(i=a[a.length-1]),r.vertexCount=-1===t?e.getAttribute("position").count:t,r.vertexStart=null===i?0:i.vertexStart+i.vertexCount;let l=e.getIndex(),h=null!==l;if(h&&(r.indexCount=-1===n?l.count:n,r.indexStart=null===i?0:i.indexStart+i.indexCount),-1!==r.indexStart&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let u=this._geometryCount;return this._geometryCount++,a.push(r),s.push({start:h?r.indexStart:r.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new Ft,sphereInitialized:!1,sphere:new ir}),this.setGeometryAt(u,e),u}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);let n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),a=t.getIndex(),s=this._reservedRanges[e];if(r&&a.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");let o=s.vertexStart,l=s.vertexCount;for(let e in n.attributes){let r=t.getAttribute(e),i=n.getAttribute(e);Qrt(r,i,o);let a=r.itemSize;for(let e=r.count,t=l;e<t;e++){let t=o+e;for(let e=0;e<a;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(o*a,l*a)}if(r){let e=s.indexStart;for(let t=0;t<a.count;t++)i.setX(e+t,o+a.getX(t));for(let t=a.count,n=s.indexCount;t<n;t++)i.setX(e+t,o);i.needsUpdate=!0,i.addUpdateRange(e,s.indexCount)}let h=this._bounds[e];null!==t.boundingBox?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,null!==t.boundingSphere?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;let u=this._drawRanges[e],c=t.getAttribute("position");return u.count=r?a.count:c.count,this._visibilityChanged=!0,e}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;let n=this._bounds[e],r=n.box,i=this.geometry;if(!1===n.boxInitialized){r.makeEmpty();let t=i.index,a=i.attributes.position,s=this._drawRanges[e];for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),r.expandByPoint(F1.fromBufferAttribute(a,n))}n.boxInitialized=!0}return t.copy(r),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;let n=this._bounds[e],r=n.sphere,i=this.geometry;if(!1===n.sphereInitialized){r.makeEmpty(),this.getBoundingBoxAt(e,SS),SS.getCenter(r.center);let t=i.index,a=i.attributes.position,s=this._drawRanges[e],o=0;for(let e=s.start,n=s.start+s.count;e<n;e++){let n=e;t&&(n=t.getX(n)),F1.fromBufferAttribute(a,n),o=Math.max(o,r.center.distanceToSquared(F1))}r.radius=Math.sqrt(o),n.sphereInitialized=!0}return t.copy(r),t}setMatrixAt(e,t){let n=this._drawInfo,r=this._matricesTexture,i=this._matricesTexture.image.data;return e>=n.length||!1===n[e].active||(t.toArray(i,16*e),r.needsUpdate=!0),this}getMatrixAt(e,t){let n=this._drawInfo,r=this._matricesTexture.image.data;return e>=n.length||!1===n[e].active?null:t.fromArray(r,16*e)}setColorAt(e,t){null===this._colorsTexture&&this._initColorsTexture();let n=this._colorsTexture,r=this._colorsTexture.image.data,i=this._drawInfo;return e>=i.length||!1===i[e].active||(t.toArray(r,4*e),n.needsUpdate=!0),this}getColorAt(e,t){let n=this._colorsTexture.image.data,r=this._drawInfo;return e>=r.length||!1===r[e].active?null:t.fromArray(n,4*e)}setVisibleAt(e,t){let n=this._drawInfo;return e>=n.length||!1===n[e].active||n[e].visible===t||(n[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){let t=this._drawInfo;return!(e>=t.length||!1===t[e].active)&&t[e].visible}raycast(e,t){let n=this._drawInfo,r=this._drawRanges,i=this.matrixWorld,a=this.geometry;Is.material=this.material,Is.geometry.index=a.index,Is.geometry.attributes=a.attributes,null===Is.geometry.boundingBox&&(Is.geometry.boundingBox=new Ft),null===Is.geometry.boundingSphere&&(Is.geometry.boundingSphere=new ir);for(let a=0,s=n.length;a<s;a++){if(!n[a].visible||!n[a].active)continue;let s=n[a].geometryIndex,o=r[s];Is.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(a,Is.matrixWorld).premultiply(i),this.getBoundingBoxAt(s,Is.geometry.boundingBox),this.getBoundingSphereAt(s,Is.geometry.boundingSphere),Is.raycast(e,wS);for(let e=0,n=wS.length;e<n;e++){let n=wS[e];n.object=this,n.batchId=a,t.push(n)}wS.length=0}Is.material=null,Is.geometry.index=null,Is.geometry.attributes={},Is.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map((e=>oi({},e))),this._reservedRanges=e._reservedRanges.map((e=>oi({},e))),this._drawInfo=e._drawInfo.map((e=>oi({},e))),this._bounds=e._bounds.map((e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()}))),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=r.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._drawInfo,l=this._multiDrawStarts,h=this._multiDrawCounts,u=this._drawRanges,c=this.perObjectFrustumCulled,d=this._indirectTexture,p=d.image.data;c&&(fae.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),mk.setFromProjectionMatrix(fae,e.coordinateSystem));let f=0;if(this.sortObjects){pk.copy(this.matrixWorld).invert(),F1.setFromMatrixPosition(n.matrixWorld).applyMatrix4(pk),dae.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(pk);for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){let t=o[e].geometryIndex;this.getMatrixAt(e,sh),this.getBoundingSphereAt(t,Uf).applyMatrix4(sh);let n=!1;if(c&&(n=!mk.intersectsSphere(Uf)),!n){let n=Jrt.subVectors(Uf.center,F1).dot(dae);gk.push(u[t],n,e)}}let e=gk.list,t=this.customSort;null===t?e.sort(i.transparent?$rt:Yrt):t.call(this,e,n);for(let t=0,n=e.length;t<n;t++){let n=e[t];l[f]=n.start*s,h[f]=n.count,p[f]=n.index,f++}gk.reset()}else for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){let t=o[e].geometryIndex,n=!1;if(c&&(this.getMatrixAt(e,sh),this.getBoundingSphereAt(t,Uf).applyMatrix4(sh),n=!mk.intersectsSphere(Uf)),!n){let n=u[t];l[f]=n.start*s,h[f]=n.count,p[f]=e,f++}}d.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,i,a){this.onBeforeRender(e,null,r,i,a)}},gr=class extends Ir{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ot(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Aw=new q,Cw=new q,pae=new At,N1=new _o,MS=new ir,vk=new q,mae=new q,ti=class extends Cn{constructor(e=new Nt,t=new gr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)Aw.fromBufferAttribute(t,e-1),Cw.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Aw.distanceTo(Cw);e.setAttribute("lineDistance",new Wt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),MS.copy(n.boundingSphere),MS.applyMatrix4(r),MS.radius+=i,!1===e.ray.intersectsSphere(MS))return;pae.copy(r).invert(),N1.copy(e.ray).applyMatrix4(pae);let s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=this.isLineSegments?2:1,h=n.index,u=n.attributes.position;if(null!==h){let n=Math.max(0,a.start),r=Math.min(h.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){let n=h.getX(i),r=h.getX(i+1),a=AS(this,e,N1,o,n,r);a&&t.push(a)}if(this.isLineLoop){let i=h.getX(r-1),a=h.getX(n),s=AS(this,e,N1,o,i,a);s&&t.push(s)}}else{let n=Math.max(0,a.start),r=Math.min(u.count,a.start+a.count);for(let i=n,a=r-1;i<a;i+=l){let n=AS(this,e,N1,o,i,i+1);n&&t.push(n)}if(this.isLineLoop){let i=AS(this,e,N1,o,r-1,n);i&&t.push(i)}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){let t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}};function AS(e,t,n,r,i,a){let s=e.geometry.attributes.position;if(Aw.fromBufferAttribute(s,i),Cw.fromBufferAttribute(s,a),n.distanceSqToSegment(Aw,Cw,vk,mae)>r)return;vk.applyMatrix4(e.matrixWorld);let o=t.ray.origin.distanceTo(vk);return o<t.near||o>t.far?void 0:{distance:o,point:mae.clone().applyMatrix4(e.matrixWorld),index:i,face:null,faceIndex:null,object:e}}var gae=new q,vae=new q,ni=class extends ti{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)gae.fromBufferAttribute(t,e),vae.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+gae.distanceTo(vae);e.setAttribute("lineDistance",new Wt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Rw=class extends ti{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}},Wi=class extends Ir{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ot(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},yae=new At,Zk=new _o,CS=new ir,RS=new q,Ni=class extends Cn{constructor(e=new Nt,t=new Wi){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),CS.copy(n.boundingSphere),CS.applyMatrix4(r),CS.radius+=i,!1===e.ray.intersectsSphere(CS))return;yae.copy(r).invert(),Zk.copy(e.ray).applyMatrix4(yae);let s=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=n.index,h=n.attributes.position;if(null!==l){for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++){let i=l.getX(n);RS.fromBufferAttribute(h,i),xae(RS,i,o,r,e,t,this)}}else{for(let n=Math.max(0,a.start),i=Math.min(h.count,a.start+a.count);n<i;n++)RS.fromBufferAttribute(h,n),xae(RS,n,o,r,e,t,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){let t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}};function xae(e,t,n,r,i,a,s){let o=Zk.distanceSqToPoint(e);if(o<n){let n=new q;Zk.closestPointToPoint(e,n),n.applyMatrix4(r);let l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,object:s})}}var Kk=class extends ei{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:Dr,this.magFilter=void 0!==i?i:Dr,this.generateMipmaps=!1;let h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){h.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e==!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},Jk=class extends ei{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Li,this.minFilter=Li,this.generateMipmaps=!1,this.needsUpdate=!0}},Yl=class extends ei{constructor(e,t,n,r,i,a,s,o,l,h,u,c){super(null,a,s,o,l,h,r,i,u,c),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}},Qk=class extends Yl{constructor(e,t,n,r,i,a){super(e,t,n,i,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=xa,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},e6=class extends Yl{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,tu),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},ud=class extends ei{constructor(e,t,n,r,i,a,s,o,l){super(e,t,n,r,i,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Ga=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t,n=[],r=this.getPoint(0),i=0;n.push(0);for(let a=1;a<=e;a++)t=this.getPoint(a/e),i+=t.distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];let s,o=0,l=a-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),s=r[i]-n,s<0)o=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,r[i]===n)return i/(a-1);let h=r[i];return(i+(n-h)/(r[i+1]-h))/(a-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),r>1&&(r=1);let i=this.getPoint(n),a=this.getPoint(r),s=t||(i.isVector2?new Te:new q);return s.copy(a).sub(i).normalize(),s}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new q,r=[],i=[],a=[],s=new q,o=new At;for(let t=0;t<=e;t++){let n=t/e;r[t]=this.getTangentAt(n,new q)}i[0]=new q,a[0]=new q;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),u=Math.abs(r[0].y),c=Math.abs(r[0].z);h<=l&&(l=h,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),c<=l&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),a[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(xi(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(xi(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),a[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},su=class extends Ga{constructor(e=0,t=0,n=1,r=1,i=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t=new Te){let n=t,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0===this.aClockwise&&!a&&(i===r?i=-r:i-=r);let s=this.aStartAngle+e*i,o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},hd=class extends su{constructor(e,t,n,r,i,a){super(e,t,n,n,r,i,a),this.isArcCurve=!0,this.type="ArcCurve"}};function J6(){let e=0,t=0,n=0,r=0;function i(i,a,s,o){e=i,t=s,n=-3*i+3*a-2*s-o,r=2*i-2*a+s+o}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,s,o){let l=(t-e)/a-(n-e)/(a+s)+(n-t)/s,h=(n-t)/s-(r-t)/(s+o)+(r-n)/o;l*=s,h*=s,i(t,n,l,h)},calc:function(i){let a=i*i;return e+t*i+n*a+r*(a*i)}}}var PS=new q,yk=new J6,xk=new J6,bk=new J6,Pw=class extends Ga{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new q){let n,r,i=t,a=this.points,s=a.length,o=(s-(this.closed?0:1))*e,l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===h&&l===s-1&&(l=s-2,h=1),this.closed||l>0?n=a[(l-1)%s]:(PS.subVectors(a[0],a[1]).add(a[0]),n=PS);let u=a[l%s],c=a[(l+1)%s];if(this.closed||l+2<s?r=a[(l+2)%s]:(PS.subVectors(a[s-1],a[s-2]).add(a[s-1]),r=PS),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(n.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(c),e),a=Math.pow(c.distanceToSquared(r),e);i<1e-4&&(i=1),t<1e-4&&(t=i),a<1e-4&&(a=i),yk.initNonuniformCatmullRom(n.x,u.x,c.x,r.x,t,i,a),xk.initNonuniformCatmullRom(n.y,u.y,c.y,r.y,t,i,a),bk.initNonuniformCatmullRom(n.z,u.z,c.z,r.z,t,i,a)}else"catmullrom"===this.curveType&&(yk.initCatmullRom(n.x,u.x,c.x,r.x,this.tension),xk.initCatmullRom(n.y,u.y,c.y,r.y,this.tension),bk.initCatmullRom(n.z,u.z,c.z,r.z,this.tension));return i.set(yk.calc(h),xk.calc(h),bk.calc(h)),i}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push((new q).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function bae(e,t,n,r,i){let a=.5*(r-t),s=.5*(i-n),o=e*e;return(2*n-2*r+a+s)*(e*o)+(-3*n+3*r-2*a-s)*o+a*e+n}function eit(e,t){let n=1-e;return n*n*t}function tit(e,t){return 2*(1-e)*e*t}function nit(e,t){return e*e*t}function Y1(e,t,n,r){return eit(e,t)+tit(e,n)+nit(e,r)}function rit(e,t){let n=1-e;return n*n*n*t}function iit(e,t){let n=1-e;return 3*n*n*e*t}function sit(e,t){return 3*(1-e)*e*e*t}function ait(e,t){return e*e*e*t}function $1(e,t,n,r,i){return rit(e,t)+iit(e,n)+sit(e,r)+ait(e,i)}var my=class extends Ga{constructor(e=new Te,t=new Te,n=new Te,r=new Te){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Te){let n=t,r=this.v0,i=this.v1,a=this.v2,s=this.v3;return n.set($1(e,r.x,i.x,a.x,s.x),$1(e,r.y,i.y,a.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Iw=class extends Ga{constructor(e=new q,t=new q,n=new q,r=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new q){let n=t,r=this.v0,i=this.v1,a=this.v2,s=this.v3;return n.set($1(e,r.x,i.x,a.x,s.x),$1(e,r.y,i.y,a.y,s.y),$1(e,r.z,i.z,a.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},gy=class extends Ga{constructor(e=new Te,t=new Te){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Te){let n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Te){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Dw=class extends Ga{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){let n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},vy=class extends Ga{constructor(e=new Te,t=new Te,n=new Te){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Te){let n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Y1(e,r.x,i.x,a.x),Y1(e,r.y,i.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},yy=class extends Ga{constructor(e=new q,t=new q,n=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new q){let n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Y1(e,r.x,i.x,a.x),Y1(e,r.y,i.y,a.y),Y1(e,r.z,i.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},fd=class extends Ga{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Te){let n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),s=i-a,o=r[0===a?a:a-1],l=r[a],h=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(bae(s,o.x,l.x,h.x,u.x),bae(s,o.y,l.y,h.y,u.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let n=e.points[t];this.points.push((new Te).fromArray(n))}return this}},Ow=Object.freeze({__proto__:null,ArcCurve:hd,CatmullRomCurve3:Pw,CubicBezierCurve:my,CubicBezierCurve3:Iw,EllipseCurve:su,LineCurve:gy,LineCurve3:Dw,QuadraticBezierCurve:vy,QuadraticBezierCurve3:yy,SplineCurve:fd}),Lw=class extends Ga{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new Ow[n](t,e))}return this}getPoint(e,t){let n=e*this.getLength(),r=this.getCurveLengths(),i=0;for(;i<r.length;){if(r[i]>=n){let e=r[i]-n,a=this.curves[i],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t,n=[];for(let r=0,i=this.curves;r<i.length;r++){let a=i[r],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){let r=o[e];t&&t.equals(r)||(n.push(r),t=r)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let n=e.curves[t];this.curves.push((new Ow[n.type]).fromJSON(n))}return this}},$l=class extends Lw{constructor(e){super(),this.type="Path",this.currentPoint=new Te,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new gy(this.currentPoint.clone(),new Te(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){let i=new vy(this.currentPoint.clone(),new Te(e,t),new Te(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,a){let s=new my(this.currentPoint.clone(),new Te(e,t),new Te(n,r),new Te(i,a));return this.curves.push(s),this.currentPoint.set(i,a),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new fd(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,n,r,i,a),this}absarc(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}ellipse(e,t,n,r,i,a,s,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,n,r,i,a,s,o),this}absellipse(e,t,n,r,i,a,s,o){let l=new su(e,t,n,r,i,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},dd=class extends Nt{constructor(e=[new Te(0,-.5),new Te(.5,0),new Te(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=xi(r,0,2*Math.PI);let i=[],a=[],s=[],o=[],l=[],h=1/t,u=new q,c=new Te,d=new q,p=new q,f=new q,m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let i=0;i<=t;i++){let d=n+i*h*r,p=Math.sin(d),f=Math.cos(d);for(let n=0;n<=e.length-1;n++){u.x=e[n].x*p,u.y=e[n].y,u.z=e[n].x*f,a.push(u.x,u.y,u.z),c.x=i/t,c.y=n/(e.length-1),s.push(c.x,c.y);let r=o[3*n+0]*p,h=o[3*n+1],d=o[3*n+0]*f;l.push(r,h,d)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){let r=t+n*e.length,a=r,s=r+e.length,o=r+e.length+1,l=r+1;i.push(a,s,l),i.push(o,l,s)}this.setIndex(i),this.setAttribute("position",new Wt(a,3)),this.setAttribute("uv",new Wt(s,2)),this.setAttribute("normal",new Wt(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dd(e.points,e.segments,e.phiStart,e.phiLength)}},ig=class extends dd{constructor(e=1,t=1,n=4,r=8){let i=new $l;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new ig(e.radius,e.length,e.capSegments,e.radialSegments)}},sg=class extends Nt{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);let i=[],a=[],s=[],o=[],l=new q,h=new Te;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let i=0,u=3;i<=t;i++,u+=3){let c=n+i/t*r;l.x=e*Math.cos(c),l.y=e*Math.sin(c),a.push(l.x,l.y,l.z),s.push(0,0,1),h.x=(a[u]/e+1)/2,h.y=(a[u+1]/e+1)/2,o.push(h.x,h.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(s,3)),this.setAttribute("uv",new Wt(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sg(e.radius,e.segments,e.thetaStart,e.thetaLength)}},hh=class extends Nt{constructor(e=1,t=1,n=1,r=32,i=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o};let l=this;r=Math.floor(r),i=Math.floor(i);let h=[],u=[],c=[],d=[],p=0,f=[],m=n/2,g=0;function v(n){let i=p,a=new Te,f=new q,v=0,y=!0===n?e:t,x=!0===n?1:-1;for(let e=1;e<=r;e++)u.push(0,m*x,0),c.push(0,x,0),d.push(.5,.5),p++;let b=p;for(let e=0;e<=r;e++){let t=e/r*o+s,n=Math.cos(t),i=Math.sin(t);f.x=y*i,f.y=m*x,f.z=y*n,u.push(f.x,f.y,f.z),c.push(0,x,0),a.x=.5*n+.5,a.y=.5*i*x+.5,d.push(a.x,a.y),p++}for(let e=0;e<r;e++){let t=i+e,r=b+e;!0===n?h.push(r,r+1,t):h.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}(function(){let a=new q,v=new q,y=0,x=(t-e)/n;for(let l=0;l<=i;l++){let h=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){let t=e/r,i=t*o+s,l=Math.sin(i),f=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*f,u.push(v.x,v.y,v.z),a.set(l,x,f).normalize(),c.push(a.x,a.y,a.z),d.push(t,1-g),h.push(p++)}f.push(h)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){let n=f[t][e],r=f[t+1][e],i=f[t+1][e+1],a=f[t][e+1];h.push(n,r,a),h.push(r,i,a),y+=6}l.addGroup(g,y,0),g+=y})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new Wt(u,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ag=class extends hh{constructor(e=1,t=1,n=32,r=1,i=!1,a=0,s=2*Math.PI){super(0,e,t,n,r,i,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:s}}static fromJSON(e){return new ag(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Zl=class extends Nt{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};let i=[],a=[];function s(e,t,n,r){let i=r+1,a=[];for(let r=0;r<=i;r++){a[r]=[];let s=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)a[r][e]=0===e&&r===i?s:s.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){let n=Math.floor(t/2);t%2==0?(o(a[e][n+1]),o(a[e+1][n]),o(a[e][n])):(o(a[e][n+1]),o(a[e+1][n+1]),o(a[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){let r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function u(e){return Math.atan2(e.z,-e.x)}function c(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let n=new q,r=new q,i=new q;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],r),l(t[a+2],i),s(n,r,i,e)})(r),function(e){let t=new q;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){let e=new q;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];let n=u(e)/2/Math.PI+.5,r=c(e)/Math.PI+.5;a.push(n,1-r)}(function(){let e=new q,t=new q,n=new q,r=new q,s=new Te,o=new Te,l=new Te;for(let c=0,d=0;c<i.length;c+=9,d+=6){e.set(i[c+0],i[c+1],i[c+2]),t.set(i[c+3],i[c+4],i[c+5]),n.set(i[c+6],i[c+7],i[c+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),r.copy(e).add(t).add(n).divideScalar(3);let p=u(r);h(s,d+0,e,p),h(o,d+2,t,p),h(l,d+4,n,p)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Wt(i,3)),this.setAttribute("normal",new Wt(i.slice(),3)),this.setAttribute("uv",new Wt(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Zl(e.vertices,e.indices,e.radius,e.details)}},og=class extends Zl{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new og(e.radius,e.detail)}},IS=new q,DS=new q,Ek=new q,OS=new Pr,fh=class extends Nt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){let n=Math.pow(10,4),r=Math.cos(ed*t),i=e.getIndex(),a=e.getAttribute("position"),s=i?i.count:a.count,o=[0,0,0],l=["a","b","c"],h=new Array(3),u={},c=[];for(let e=0;e<s;e+=3){i?(o[0]=i.getX(e),o[1]=i.getX(e+1),o[2]=i.getX(e+2)):(o[0]=e,o[1]=e+1,o[2]=e+2);let{a:t,b:s,c:d}=OS;if(t.fromBufferAttribute(a,o[0]),s.fromBufferAttribute(a,o[1]),d.fromBufferAttribute(a,o[2]),OS.getNormal(Ek),h[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,h[1]=`${Math.round(s.x*n)},${Math.round(s.y*n)},${Math.round(s.z*n)}`,h[2]=`${Math.round(d.x*n)},${Math.round(d.y*n)},${Math.round(d.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){let t=(e+1)%3,n=h[e],i=h[t],a=OS[l[e]],s=OS[l[t]],d=`${n}_${i}`,p=`${i}_${n}`;p in u&&u[p]?(Ek.dot(u[p].normal)<=r&&(c.push(a.x,a.y,a.z),c.push(s.x,s.y,s.z)),u[p]=null):d in u||(u[d]={index0:o[e],index1:o[t],normal:Ek.clone()})}}for(let e in u)if(u[e]){let{index0:t,index1:n}=u[e];IS.fromBufferAttribute(a,t),DS.fromBufferAttribute(a,n),c.push(IS.x,IS.y,IS.z),c.push(DS.x,DS.y,DS.z)}this.setAttribute("position",new Wt(c,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}},ki=class extends $l{constructor(e){super(e),this.uuid=qa(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let n=e.holes[t];this.holes.push((new $l).fromJSON(n))}return this}},oit={triangulate:function(e,t,n=2){let r,i,a,s,o,l,h,u=t&&t.length,c=u?t[0]*n:e.length,d=nle(e,0,c,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=fit(e,t,d,n)),e.length>80*n){r=a=e[0],i=s=e[1];for(let t=n;t<c;t+=n)o=e[t],l=e[t+1],o<r&&(r=o),l<i&&(i=l),o>a&&(a=o),l>s&&(s=l);h=Math.max(a-r,s-i),h=0!==h?32767/h:0}return xy(d,p,n,r,i,h,0),p}};function nle(e,t,n,r,i){let a,s;if(i===Tit(e,t,n,r)>0)for(a=t;a<n;a+=r)s=Eae(a,e[a],e[a+1],s);else for(a=n-r;a>=t;a-=r)s=Eae(a,e[a],e[a+1],s);return s&&pM(s,s.next)&&(Ey(s),s=s.next),s}function pd(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!pM(r,r.next)&&0!==hi(r.prev,r,r.next))r=r.next;else{if(Ey(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function xy(e,t,n,r,i,a,s){if(!e)return;!s&&a&&vit(e,r,i,a);let o,l,h=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?cit(e,r,i,a):lit(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Ey(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?xy(e=uit(pd(e),t,n),t,n,r,i,a,2):2===s&&hit(e,t,n,r,i,a):xy(pd(e),t,n,r,i,a,1);break}}function lit(e){let t=e.prev,n=e,r=e.next;if(hi(t,n,r)>=0)return!1;let i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,h=r.y,u=i<a?i<s?i:s:a<s?a:s,c=o<l?o<h?o:h:l<h?l:h,d=i>a?i>s?i:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&jm(i,o,a,l,s,h,f.x,f.y)&&hi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function cit(e,t,n,r){let i=e.prev,a=e,s=e.next;if(hi(i,a,s)>=0)return!1;let o=i.x,l=a.x,h=s.x,u=i.y,c=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,v=t6(p,f,t,n,r),y=t6(m,g,t,n,r),x=e.prevZ,b=e.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&jm(o,u,l,c,h,d,x.x,x.y)&&hi(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&jm(o,u,l,c,h,d,b.x,b.y)&&hi(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&jm(o,u,l,c,h,d,x.x,x.y)&&hi(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&jm(o,u,l,c,h,d,b.x,b.y)&&hi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function uit(e,t,n){let r=e;do{let i=r.prev,a=r.next.next;!pM(i,a)&&rle(i,r,r.next,a)&&by(i,a)&&by(a,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(a.i/n|0),Ey(r),Ey(r.next),r=e=a),r=r.next}while(r!==e);return pd(r)}function hit(e,t,n,r,i,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&bit(s,e)){let o=ile(s,e);return s=pd(s,s.next),o=pd(o,o.next),xy(s,t,n,r,i,a,0),void xy(o,t,n,r,i,a,0)}e=e.next}s=s.next}while(s!==e)}function fit(e,t,n,r){let i,a,s,o,l,h=[];for(i=0,a=t.length;i<a;i++)s=t[i]*r,o=i<a-1?t[i+1]*r:e.length,l=nle(e,s,o,r,!1),l===l.next&&(l.steiner=!0),h.push(xit(l));for(h.sort(dit),i=0;i<h.length;i++)n=pit(h[i],n);return n}function dit(e,t){return e.x-t.x}function pit(e,t){let n=mit(e,t);if(!n)return t;let r=ile(n,e);return pd(r,r.next),pd(n,n.next)}function mit(e,t){let n,r=t,i=-1/0,a=e.x,s=e.y;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let e=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=a&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===a))return n}r=r.next}while(r!==t);if(!n)return null;let o,l=n,h=n.x,u=n.y,c=1/0;r=n;do{a>=r.x&&r.x>=h&&a!==r.x&&jm(s<u?a:i,s,h,u,s<u?i:a,s,r.x,r.y)&&(o=Math.abs(s-r.y)/(a-r.x),by(r,e)&&(o<c||o===c&&(r.x>n.x||r.x===n.x&&git(n,r)))&&(n=r,c=o)),r=r.next}while(r!==l);return n}function git(e,t){return hi(e.prev,e,t.prev)<0&&hi(t.next,e,e.next)<0}function vit(e,t,n,r){let i=e;do{0===i.z&&(i.z=t6(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,yit(i)}function yit(e){let t,n,r,i,a,s,o,l,h=1;do{for(n=e,e=null,a=null,s=0;n;){for(s++,r=n,o=0,t=0;t<h&&(o++,r=r.nextZ,r);t++);for(l=h;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,h*=2}while(s>1);return e}function t6(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xit(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function jm(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function bit(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Eit(e,t)&&(by(e,t)&&by(t,e)&&_it(e,t)&&(hi(e.prev,e,t.prev)||hi(e,t.prev,t))||pM(e,t)&&hi(e.prev,e,e.next)>0&&hi(t.prev,t,t.next)>0)}function hi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function pM(e,t){return e.x===t.x&&e.y===t.y}function rle(e,t,n,r){let i=kS(hi(e,t,n)),a=kS(hi(e,t,r)),s=kS(hi(n,r,e)),o=kS(hi(n,r,t));return!!(i!==a&&s!==o||0===i&&LS(e,n,t)||0===a&&LS(e,r,t)||0===s&&LS(n,e,r)||0===o&&LS(n,t,r))}function LS(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function kS(e){return e>0?1:e<0?-1:0}function Eit(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&rle(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function by(e,t){return hi(e.prev,e,e.next)<0?hi(e,t,e.next)>=0&&hi(e,e.prev,t)>=0:hi(e,t,e.prev)<0||hi(e,e.next,t)<0}function _it(e,t){let n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function ile(e,t){let n=new n6(e.i,e.x,e.y),r=new n6(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Eae(e,t,n,r){let i=new n6(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ey(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function n6(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tit(e,t,n,r){let i=0;for(let a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}var Ds=class{static area(e){let t=e.length,n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return Ds.area(e)<0}static triangulateShape(e,t){let n=[],r=[],i=[];_ae(e),Tae(n,e);let a=e.length;t.forEach(_ae);for(let e=0;e<t.length;e++)r.push(a),a+=t[e].length,Tae(n,t[e]);let s=oit.triangulate(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}};function _ae(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Tae(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var rs=class extends Nt{constructor(e=new ki([new Te(.5,.5),new Te(-.5,.5),new Te(-.5,-.5),new Te(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){a(e[t])}function a(e){let a,s,o,l,h,u=[],c=void 0!==t.curveSegments?t.curveSegments:12,d=void 0!==t.steps?t.steps:1,p=void 0!==t.depth?t.depth:1,f=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.bevelThickness?t.bevelThickness:.2,g=void 0!==t.bevelSize?t.bevelSize:m-.1,v=void 0!==t.bevelOffset?t.bevelOffset:0,y=void 0!==t.bevelSegments?t.bevelSegments:3,x=t.extrudePath,b=void 0!==t.UVGenerator?t.UVGenerator:Sit,_=!1;x&&(a=x.getSpacedPoints(d),_=!0,f=!1,s=x.computeFrenetFrames(d,!1),o=new q,l=new q,h=new q),f||(y=0,m=0,g=0,v=0);let w=e.extractPoints(c),S=w.shape,M=w.holes;if(!Ds.isClockWise(S)){S=S.reverse();for(let e=0,t=M.length;e<t;e++){let t=M[e];Ds.isClockWise(t)&&(M[e]=t.reverse())}}let T=Ds.triangulateShape(S,M),E=S;for(let e=0,t=M.length;e<t;e++){let t=M[e];S=S.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,n)}let C=S.length,P=T.length;function I(e,t,n){let r,i,a,s=e.x-t.x,o=e.y-t.y,l=n.x-e.x,h=n.y-e.y,u=s*s+o*o,c=s*h-o*l;if(Math.abs(c)>Number.EPSILON){let c=Math.sqrt(u),d=Math.sqrt(l*l+h*h),p=t.x-o/c,f=t.y+s/c,m=((n.x-h/d-p)*h-(n.y+l/d-f)*l)/(s*h-o*l);r=p+s*m-e.x,i=f+o*m-e.y;let g=r*r+i*i;if(g<=2)return new Te(r,i);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(h)&&(e=!0),e?(r=-o,i=s,a=Math.sqrt(u)):(r=s,i=o,a=Math.sqrt(u/2))}return new Te(r/a,i/a)}let R=[];for(let e=0,t=E.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),R[e]=I(E[e],E[n],E[r]);let L,O=[],D=R.concat();for(let e=0,t=M.length;e<t;e++){let t=M[e];L=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[e]=I(t[e],t[r],t[i]);O.push(L),D=D.concat(L)}for(let e=0;e<y;e++){let t=e/y,n=m*Math.cos(t*Math.PI/2),r=g*Math.sin(t*Math.PI/2)+v;for(let e=0,t=E.length;e<t;e++){let t=A(E[e],R[e],r);F(t.x,t.y,-n)}for(let e=0,t=M.length;e<t;e++){let t=M[e];L=O[e];for(let e=0,i=t.length;e<i;e++){let i=A(t[e],L[e],r);F(i.x,i.y,-n)}}}let k=g+v;for(let e=0;e<C;e++){let t=f?A(S[e],D[e],k):S[e];_?(l.copy(s.normals[0]).multiplyScalar(t.x),o.copy(s.binormals[0]).multiplyScalar(t.y),h.copy(a[0]).add(l).add(o),F(h.x,h.y,h.z)):F(t.x,t.y,0)}for(let e=1;e<=d;e++)for(let t=0;t<C;t++){let n=f?A(S[t],D[t],k):S[t];_?(l.copy(s.normals[e]).multiplyScalar(n.x),o.copy(s.binormals[e]).multiplyScalar(n.y),h.copy(a[e]).add(l).add(o),F(h.x,h.y,h.z)):F(n.x,n.y,p/d*e)}for(let e=y-1;e>=0;e--){let t=e/y,n=m*Math.cos(t*Math.PI/2),r=g*Math.sin(t*Math.PI/2)+v;for(let e=0,t=E.length;e<t;e++){let t=A(E[e],R[e],r);F(t.x,t.y,p+n)}for(let e=0,t=M.length;e<t;e++){let t=M[e];L=O[e];for(let e=0,i=t.length;e<i;e++){let i=A(t[e],L[e],r);_?F(i.x,i.y+a[d-1].y,a[d-1].x+n):F(i.x,i.y,p+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){let r=n,i=n-1;i<0&&(i=e.length-1);for(let e=0,n=d+2*y;e<n;e++){let n=C*e,a=C*(e+1);B(t+r+n,t+i+n,t+i+a,t+r+a)}}}function F(e,t,n){u.push(e),u.push(t),u.push(n)}function U(e,t,i){z(e),z(t),z(i);let a=r.length/3,s=b.generateTopUV(n,r,a-3,a-2,a-1);H(s[0]),H(s[1]),H(s[2])}function B(e,t,i,a){z(e),z(t),z(a),z(t),z(i),z(a);let s=r.length/3,o=b.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);H(o[0]),H(o[1]),H(o[3]),H(o[1]),H(o[2]),H(o[3])}function z(e){r.push(u[3*e+0]),r.push(u[3*e+1]),r.push(u[3*e+2])}function H(e){i.push(e.x),i.push(e.y)}(function(){let e=r.length/3;if(f){let e=0,t=C*e;for(let e=0;e<P;e++){let n=T[e];U(n[2]+t,n[1]+t,n[0]+t)}e=d+2*y,t=C*e;for(let e=0;e<P;e++){let n=T[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<P;e++){let t=T[e];U(t[2],t[1],t[0])}for(let e=0;e<P;e++){let t=T[e];U(t[0]+C*d,t[1]+C*d,t[2]+C*d)}}n.addGroup(e,r.length/3-e,0)})(),function(){let e=r.length/3,t=0;N(E,t),t+=E.length;for(let e=0,n=M.length;e<n;e++){let n=M[e];N(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new Wt(r,3)),this.setAttribute("uv",new Wt(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return wit(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let n=[];for(let r=0,i=e.shapes.length;r<i;r++){let i=t[e.shapes[r]];n.push(i)}let r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new Ow[r.type]).fromJSON(r)),new rs(n,e.options)}},Sit={generateTopUV:function(e,t,n,r,i){let a=t[3*n],s=t[3*n+1],o=t[3*r],l=t[3*r+1],h=t[3*i],u=t[3*i+1];return[new Te(a,s),new Te(o,l),new Te(h,u)]},generateSideWallUV:function(e,t,n,r,i,a){let s=t[3*n],o=t[3*n+1],l=t[3*n+2],h=t[3*r],u=t[3*r+1],c=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(o-u)<Math.abs(s-h)?[new Te(s,1-l),new Te(h,1-c),new Te(d,1-f),new Te(m,1-v)]:[new Te(o,1-l),new Te(u,1-c),new Te(p,1-f),new Te(g,1-v)]}};function wit(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){let r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);return n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}var lg=class extends Zl{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new lg(e.radius,e.detail)}},md=class extends Zl{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new md(e.radius,e.detail)}},cg=class extends Nt{constructor(e=.5,t=1,n=32,r=1,i=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},n=Math.max(3,n);let s=[],o=[],l=[],h=[],u=e,c=(t-e)/(r=Math.max(1,r)),d=new q,p=new Te;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){let r=i+e/n*a;d.x=u*Math.cos(r),d.y=u*Math.sin(r),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,h.push(p.x,p.y)}u+=c}for(let e=0;e<r;e++){let t=e*(n+1);for(let e=0;e<n;e++){let r=e+t,i=r,a=r+n+1,o=r+n+2,l=r+1;s.push(i,a,l),s.push(a,o,l)}}this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cg(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}},Mo=class extends Nt{constructor(e=new ki([new Te(0,.5),new Te(-.5,-.5),new Te(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],r=[],i=[],a=[],s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){let s=r.length/3,l=e.extractPoints(t),h=l.shape,u=l.holes;!1===Ds.isClockWise(h)&&(h=h.reverse());for(let e=0,t=u.length;e<t;e++){let t=u[e];!0===Ds.isClockWise(t)&&(u[e]=t.reverse())}let c=Ds.triangulateShape(h,u);for(let e=0,t=u.length;e<t;e++){let t=u[e];h=h.concat(t)}for(let e=0,t=h.length;e<t;e++){let t=h[e];r.push(t.x,t.y,0),i.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=c.length;e<t;e++){let t=c[e],r=t[0]+s,i=t[1]+s,a=t[2]+s;n.push(r,i,a),o+=3}}this.setIndex(n),this.setAttribute("position",new Wt(r,3)),this.setAttribute("normal",new Wt(i,3)),this.setAttribute("uv",new Wt(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return Mit(this.parameters.shapes,e)}static fromJSON(e,t){let n=[];for(let r=0,i=e.shapes.length;r<i;r++){let i=t[e.shapes[r]];n.push(i)}return new Mo(n,e.curveSegments)}};function Mit(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){let r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}var gd=class extends Nt{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));let o=Math.min(a+s,Math.PI),l=0,h=[],u=new q,c=new q,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){let g=[],v=d/n,y=0;0===d&&0===a?y=.5/t:d===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){let o=n/t;u.x=-e*Math.cos(r+o*i)*Math.sin(a+v*s),u.y=e*Math.cos(a+v*s),u.z=e*Math.sin(r+o*i)*Math.sin(a+v*s),p.push(u.x,u.y,u.z),c.copy(u).normalize(),f.push(c.x,c.y,c.z),m.push(o+y,1-v),g.push(l++)}h.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){let t=h[e][r+1],i=h[e][r],s=h[e+1][r],l=h[e+1][r+1];(0!==e||a>0)&&d.push(t,i,l),(e!==n-1||o<Math.PI)&&d.push(i,s,l)}this.setIndex(d),this.setAttribute("position",new Wt(p,3)),this.setAttribute("normal",new Wt(f,3)),this.setAttribute("uv",new Wt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gd(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},ug=class extends Zl{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ug(e.radius,e.detail)}},hg=class extends Nt{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);let a=[],s=[],o=[],l=[],h=new q,u=new q,c=new q;for(let a=0;a<=n;a++)for(let d=0;d<=r;d++){let p=d/r*i,f=a/n*Math.PI*2;u.x=(e+t*Math.cos(f))*Math.cos(p),u.y=(e+t*Math.cos(f))*Math.sin(p),u.z=t*Math.sin(f),s.push(u.x,u.y,u.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),c.subVectors(u,h).normalize(),o.push(c.x,c.y,c.z),l.push(d/r),l.push(a/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){let n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,o=(r+1)*e+t;a.push(n,i,o),a.push(i,s,o)}this.setIndex(a),this.setAttribute("position",new Wt(s,3)),this.setAttribute("normal",new Wt(o,3)),this.setAttribute("uv",new Wt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hg(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},fg=class extends Nt{constructor(e=1,t=.4,n=64,r=8,i=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},n=Math.floor(n),r=Math.floor(r);let s=[],o=[],l=[],h=[],u=new q,c=new q,d=new q,p=new q,f=new q,m=new q,g=new q;for(let s=0;s<=n;++s){let y=s/n*i*Math.PI*2;v(y,i,a,e,d),v(y+.01,i,a,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){let i=e/r*Math.PI*2,a=-t*Math.cos(i),p=t*Math.sin(i);u.x=d.x+(a*g.x+p*f.x),u.y=d.y+(a*g.y+p*f.y),u.z=d.z+(a*g.z+p*f.z),o.push(u.x,u.y,u.z),c.subVectors(u,d).normalize(),l.push(c.x,c.y,c.z),h.push(s/n),h.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){let n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,o=(r+1)*(e-1)+t;s.push(n,i,o),s.push(i,a,o)}function v(e,t,n,r,i){let a=Math.cos(e),s=Math.sin(e),o=n/t*e,l=Math.cos(o);i.x=r*(2+l)*.5*a,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fg(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},dg=class extends Nt{constructor(e=new yy(new q(-1,-1,0),new q(-1,1,0),new q(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};let a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let s=new q,o=new q,l=new Te,h=new q,u=[],c=[],d=[],p=[];function f(i){h=e.getPointAt(i/t,h);let l=a.normals[i],d=a.binormals[i];for(let e=0;e<=r;e++){let t=e/r*Math.PI*2,i=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+i*d.x,o.y=a*l.y+i*d.y,o.z=a*l.z+i*d.z,o.normalize(),c.push(o.x,o.y,o.z),s.x=h.x+n*o.x,s.y=h.y+n*o.y,s.z=h.z+n*o.z,u.push(s.x,s.y,s.z)}}(function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){let n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),a=(r+1)*e+t,s=(r+1)*(e-1)+t;p.push(n,i,s),p.push(i,a,s)}}()})(),this.setIndex(p),this.setAttribute("position",new Wt(u,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new dg((new Ow[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},kw=class extends Nt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let t=[],n=new Set,r=new q,i=new q;if(null!==e.index){let a=e.attributes.position,s=e.index,o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){let l=o[e],h=l.start;for(let e=h,o=h+l.count;e<o;e+=3)for(let o=0;o<3;o++){let l=s.getX(e+o),h=s.getX(e+(o+1)%3);r.fromBufferAttribute(a,l),i.fromBufferAttribute(a,h),!0===Sae(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{let a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let s=0;s<3;s++){let o=3*e+s,l=3*e+(s+1)%3;r.fromBufferAttribute(a,o),i.fromBufferAttribute(a,l),!0===Sae(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new Wt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}};function Sae(e,t,n){let r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var wae=Object.freeze({__proto__:null,BoxGeometry:ru,CapsuleGeometry:ig,CircleGeometry:sg,ConeGeometry:ag,CylinderGeometry:hh,DodecahedronGeometry:og,EdgesGeometry:fh,ExtrudeGeometry:rs,IcosahedronGeometry:lg,LatheGeometry:dd,OctahedronGeometry:md,PlaneGeometry:ys,PolyhedronGeometry:Zl,RingGeometry:cg,ShapeGeometry:Mo,SphereGeometry:gd,TetrahedronGeometry:ug,TorusGeometry:hg,TorusKnotGeometry:fg,TubeGeometry:dg,WireframeGeometry:kw}),Fw=class extends Ir{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ot(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}},Nw=class extends fr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}},_y=class extends Ir{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ot(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},Bw=class extends _y{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Te(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return xi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ot(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ot(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ot(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}},pg=class extends Ir{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ot(16777215),this.specular=new Ot(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fi,this.combine=Iy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},Uw=class extends Ir{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ot(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Hw=class extends Ir{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}},Vw=class extends Ir{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ot(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ot(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fi,this.combine=Iy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},zw=class extends Ir{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ot(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}},Kl=class extends gr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};function Zf(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function sle(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ale(e){let t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n}function r6(e,t,n){let r=e.length,i=new e.constructor(r);for(let a=0,s=0;s!==r;++a){let r=n[a]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i}function Q6(e,t,n,r){let i=1,a=e[0];for(;void 0!==a&&void 0===a[r];)a=e[i++];if(void 0===a)return;let s=a[r];if(void 0!==s)if(Array.isArray(s))do{s=a[r],void 0!==s&&(t.push(a.time),n.push.apply(n,s)),a=e[i++]}while(void 0!==a);else if(void 0!==s.toArray)do{s=a[r],void 0!==s&&(t.push(a.time),s.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{s=a[r],void 0!==s&&(t.push(a.time),n.push(s)),a=e[i++]}while(void 0!==a)}function Ait(e,t,n,r,i=30){let a=e.clone();a.name=t;let s=[];for(let e=0;e<a.tracks.length;++e){let t=a.tracks[e],o=t.getValueSize(),l=[],h=[];for(let e=0;e<t.times.length;++e){let a=t.times[e]*i;if(!(a<n||a>=r)){l.push(t.times[e]);for(let n=0;n<o;++n)h.push(t.values[e*o+n])}}0!==l.length&&(t.times=Zf(l,t.times.constructor),t.values=Zf(h,t.values.constructor),s.push(t))}a.tracks=s;let o=1/0;for(let e=0;e<a.tracks.length;++e)o>a.tracks[e].times[0]&&(o=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*o);return a.resetDuration(),a}function Cit(e,t=0,n=e,r=30){r<=0&&(r=30);let i=n.tracks.length,a=t/r;for(let t=0;t<i;++t){let r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;let s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let o=0,l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0,u=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let c,d=r.times.length-1;if(a<=r.times[0]){let e=o,t=l-o;c=r.values.slice(e,t)}else if(a>=r.times[d]){let e=d*l+o,t=e+l-o;c=r.values.slice(e,t)}else{let e=r.createInterpolant(),t=o,n=l-o;e.evaluate(a),c=e.resultBuffer.slice(t,n)}"quaternion"===i&&(new Ci).fromArray(c).normalize().conjugate().toArray(c);let p=s.times.length;for(let e=0;e<p;++e){let t=e*u+h;if("quaternion"===i)Ci.multiplyQuaternionsFlat(s.values,t,c,0,s.values,t);else{let e=u-2*h;for(let n=0;n<e;++n)s.values[t+n]-=c[n]}}}return e.blendMode=Y6,e}var Rit={convertArray:Zf,isTypedArray:sle,getKeyframeOrder:ale,sortedArray:r6,flattenJSON:Q6,subclip:Ait,makeClipAdditive:Cit},vd=class{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let a;n:{r:if(!(e<r)){for(let a=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(i=r,r=t[++n],e<r)break t}a=t.length;break n}if(e>=i)break e;{let s=t[1];e<s&&(n=2,i=s);for(let a=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(r=i,i=t[--n-1],e>=i)break t}a=n,n=0}}for(;n<a;){let r=n+a>>>1;e<t[r]?a=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},qw=class extends vd{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Yf,endingEnd:Yf}}intervalChanged_(e,t,n){let r=this.parameterPositions,i=e-2,a=e+1,s=r[i],o=r[a];if(void 0===s)switch(this.getSettings_().endingStart){case $f:i=e,s=2*t-n;break;case Q1:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===o)switch(this.getSettings_().endingEnd){case $f:a=e,o=2*n-t;break;case Q1:a=1,o=n+r[1]-r[0];break;default:a=e-1,o=t}let l=.5*(n-t),h=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-n),this._offsetPrev=i*h,this._offsetNext=a*h}interpolate_(e,t,n,r){let i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=this._offsetPrev,u=this._offsetNext,c=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-c*m+2*c*f-c*p,v=(1+c)*m+(-1.5-2*c)*f+(-.5+c)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==s;++e)i[e]=g*a[h+e]+v*a[l+e]+y*a[o+e]+x*a[u+e];return i}},Ty=class extends vd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){let i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=(n-t)/(r-t),u=1-h;for(let e=0;e!==s;++e)i[e]=a[l+e]*u+a[o+e]*h;return i}},Gw=class extends vd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Wa=class{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Zf(t,this.TimeBufferType),this.values=Zf(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Zf(e.times,Array),values:Zf(e.values,Array)};let n=e.getInterpolation();n!==e.DefaultInterpolation&&(t.interpolation=n)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new Gw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ty(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case sd:t=this.InterpolantFactoryMethodDiscrete;break;case Km:t=this.InterpolantFactoryMethodLinear;break;case qS:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return sd;case this.InterpolantFactoryMethodLinear:return Km;case this.InterpolantFactoryMethodSmooth:return qS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){let n=this.times,r=n.length,i=0,a=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(a=Math.max(a,1),i=a-1);let e=this.getValueSize();this.times=n.slice(i,a),this.values=this.values.slice(i*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==i;t++){let r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==a&&a>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,a),e=!1;break}a=r}if(void 0!==r&&sle(r))for(let t=0,n=r.length;t!==n;++t){let n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===qS,i=e.length-1,a=1;for(let s=1;s<i;++s){let i=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(r)i=!0;else{let e=s*n,r=e-n,a=e+n;for(let s=0;s!==n;++s){let n=t[e+s];if(n!==t[r+s]||n!==t[a+s]){i=!0;break}}}if(i){if(s!==a){e[a]=e[s];let r=s*n,i=a*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++a}}if(i>0){e[a]=e[i];for(let e=i*n,r=a*n,s=0;s!==n;++s)t[r+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}};Wa.prototype.TimeBufferType=Float32Array,Wa.prototype.ValueBufferType=Float32Array,Wa.prototype.DefaultInterpolation=Km;var au=class extends Wa{constructor(e,t,n){super(e,t,n)}};au.prototype.ValueTypeName="bool",au.prototype.ValueBufferType=Array,au.prototype.DefaultInterpolation=sd,au.prototype.InterpolantFactoryMethodLinear=void 0,au.prototype.InterpolantFactoryMethodSmooth=void 0;var Sy=class extends Wa{};Sy.prototype.ValueTypeName="color";var yd=class extends Wa{};yd.prototype.ValueTypeName="number";var Ww=class extends vd{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){let i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(n-t)/(r-t),l=e*s;for(let e=l+s;l!==e;l+=4)Ci.slerpFlat(i,0,a,l-s,a,l,o);return i}},xd=class extends Wa{InterpolantFactoryMethodLinear(e){return new Ww(this.times,this.values,this.getValueSize(),e)}};xd.prototype.ValueTypeName="quaternion",xd.prototype.InterpolantFactoryMethodSmooth=void 0;var ou=class extends Wa{constructor(e,t,n){super(e,t,n)}};ou.prototype.ValueTypeName="string",ou.prototype.ValueBufferType=Array,ou.prototype.DefaultInterpolation=sd,ou.prototype.InterpolantFactoryMethodLinear=void 0,ou.prototype.InterpolantFactoryMethodSmooth=void 0;var bd=class extends Wa{};bd.prototype.ValueTypeName="vector";var Ed=class{constructor(e="",t=-1,n=[],r=uM){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=qa(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Iit(n[e]).scale(r));let i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){let t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Wa.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){let i=t.length,a=[];for(let e=0;e<i;e++){let s=[],o=[];s.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);let l=ale(s);s=r6(s,1,l),o=r6(o,1,l),!r&&0===s[0]&&(s.push(i),o.push(o[0])),a.push(new yd(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){let n=e[t],a=n.name.match(i);if(a&&a.length>1){let e=a[1],t=r[e];t||(r[e]=t=[]),t.push(n)}}let a=[];for(let e in r)a.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(e,t,n,r,i){if(0!==n.length){let a=[],s=[];Q6(n,a,s,r),0!==a.length&&i.push(new e(t,a,s))}},r=[],i=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){let e,t={};for(e=0;e<i.length;e++)if(i[e].morphTargets)for(let n=0;n<i[e].morphTargets.length;n++)t[i[e].morphTargets[n]]=-1;for(let n in t){let t=[],a=[];for(let r=0;r!==i[e].morphTargets.length;++r){let r=i[e];t.push(r.time),a.push(r.morphTarget===n?1:0)}r.push(new yd(".morphTargetInfluence["+n+"]",t,a))}o=t.length*a}else{let a=".bones["+t[e].name+"]";n(bd,a+".position",i,"pos",r),n(xd,a+".quaternion",i,"rot",r),n(bd,a+".scale",i,"scl",r)}}return 0===r.length?null:new this(i,o,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){let n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Pit(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return yd;case"vector":case"vector2":case"vector3":case"vector4":return bd;case"color":return Sy;case"quaternion":return xd;case"bool":case"boolean":return au;case"string":return ou}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Iit(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=Pit(e.type);if(void 0===e.times){let t=[],n=[];Q6(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Jc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},wy=class{constructor(e,t,n){let r,i=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===a&&void 0!==i.onStart&&i.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==i.onProgress&&i.onProgress(e,s,o),s===o&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){let n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}},ole=new wy,Ri=class{constructor(e){this.manager=void 0!==e?e:ole,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};Ri.DEFAULT_MATERIAL_NAME="__DEFAULT";var Zc={},i6=class extends Error{constructor(e,t){super(e),this.response=t}},Ls=class extends Ri{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let i=Jc.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==Zc[e])return void Zc[e].push({onLoad:t,onProgress:n,onError:r});Zc[e]=[],Zc[e].push({onLoad:t,onProgress:n,onError:r});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let n=Zc[e],r=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),a=i?parseInt(i):0,s=0!==a,o=0,l=new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:i})=>{if(r)e.close();else{o+=i.byteLength;let r=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:a});for(let e=0,t=n.length;e<t;e++){let t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}}),(t=>{e.error(t)}))}()}});return new Response(l)}throw new i6(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{Jc.add(e,t);let n=Zc[e];delete Zc[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{let n=Zc[e];if(void 0===n)throw this.manager.itemError(e),t;delete Zc[e];for(let e=0,r=n.length;e<r;e++){let r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},s6=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=new Ls(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){let t=[];for(let n=0;n<e.length;n++){let r=Ed.parse(e[n]);t.push(r)}return t}},a6=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=[],s=new Yl,o=new Ls(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials);let l=0;function h(h){o.load(e[h],(function(e){let n=i.parse(e,!0);a[h]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=Dr),s.image=a,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)h(t);else o.load(e,(function(e){let n=i.parse(e,!0);if(n.isCubemap){let e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}s.image=a}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=Dr),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}},_d=class extends Ri{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,a=Jc.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;let s=sy("img");function o(){h(),Jc.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){h(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function h(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}},o6=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=new od;i.colorSpace=yi;let a=new _d(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function o(n){a.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)o(t);return i}},My=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=new ba,s=new Ls(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){let n;try{n=i.parse(e)}catch(e){if(void 0===r)return void console.error(e);r(e)}void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:xa,a.wrapT=void 0!==n.wrapT?n.wrapT:xa,a.magFilter=void 0!==n.magFilter?n.magFilter:Dr,a.minFilter=void 0!==n.minFilter?n.minFilter:Dr,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(a.colorSpace=n.colorSpace),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Eo),1===n.mipmapCount&&(a.minFilter=Dr),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n)}),n,r),a}},dh=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=new ei,a=new _d(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}},Jl=class extends Cn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ot(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}},mg=class extends Jl{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ot(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},_k=new At,Mae=new q,Aae=new q,Ay=class{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Te(512,512),this.map=null,this.mapPass=null,this.matrix=new At,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ul,this._frameExtents=new Te(1,1),this._viewportCount=1,this._viewports=[new hr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;Mae.setFromMatrixPosition(e.matrixWorld),t.position.copy(Mae),Aae.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Aae),t.updateMatrixWorld(),_k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_k),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(_k)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},l6=class extends Ay{constructor(){super(new ui(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,n=2*Jm*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;(n!==t.fov||r!==t.aspect||i!==t.far)&&(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},jw=class extends Jl{constructor(e,t,n=0,r=Math.PI/3,i=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.target=new Cn,this.distance=n,this.angle=r,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new l6}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Cae=new At,B1=new q,Tk=new q,c6=class extends Ay{constructor(){super(new ui(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Te(4,2),this._viewportCount=6,this._viewports=[new hr(2,1,1,1),new hr(0,1,1,1),new hr(3,1,1,1),new hr(1,1,1,1),new hr(3,0,1,1),new hr(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),B1.setFromMatrixPosition(e.matrixWorld),n.position.copy(B1),Tk.copy(n.position),Tk.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Tk),n.updateMatrixWorld(),r.makeTranslation(-B1.x,-B1.y,-B1.z),Cae.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cae)}},Xw=class extends Jl{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new c6}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},u6=class extends Ay{constructor(){super(new To(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},gg=class extends Jl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.target=new Cn,this.shadow=new u6}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},vg=class extends Jl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}},Yw=class extends Jl{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}},$w=class{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new q)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){let n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){let n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){let n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}},Zw=class extends Jl{constructor(e=new $w,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}},yg=class extends Ri{constructor(e){super(e),this.textures={}}load(e,t,n,r){let i=this,a=new Ls(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){let t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}let r=yg.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new Ot).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let t in e.uniforms){let i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Ot).setHex(i.value);break;case"v2":r.uniforms[t].value=(new Te).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new q).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new hr).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new Tn).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new At).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(let t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Te).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Te).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Fw,SpriteMaterial:dy,RawShaderMaterial:Nw,ShaderMaterial:fr,PointsMaterial:Wi,MeshPhysicalMaterial:Bw,MeshStandardMaterial:_y,MeshPhongMaterial:pg,MeshToonMaterial:Uw,MeshNormalMaterial:Hw,MeshLambertMaterial:Vw,MeshDepthMaterial:hy,MeshDistanceMaterial:fy,MeshBasicMaterial:mr,MeshMatcapMaterial:zw,LineDashedMaterial:Kl,LineBasicMaterial:gr,Material:Ir}[e]}},Cy=class{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}},Kw=class extends Nt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},Jw=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=new Ls(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){let t={},n={};function r(e,r){if(void 0!==t[r])return t[r];let i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];let r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=Gm(i.type,a),o=new cd(s,i.stride);return o.uuid=i.uuid,t[r]=o,o}let i=e.isInstancedBufferGeometry?new Kw:new Nt,a=e.data.index;if(void 0!==a){let e=Gm(a.type,a.array);i.setIndex(new vn(e,1))}let s=e.data.attributes;for(let t in s){let n,a=s[t];if(a.isInterleavedBufferAttribute){let t=r(e.data,a.data);n=new So(t,a.itemSize,a.offset,a.normalized)}else{let e=Gm(a.type,a.array);n=new(a.isInstancedBufferAttribute?iu:vn)(e,a.itemSize,a.normalized)}void 0!==a.name&&(n.name=a.name),void 0!==a.usage&&n.setUsage(a.usage),i.setAttribute(t,n)}let o=e.data.morphAttributes;if(o)for(let t in o){let n=o[t],a=[];for(let t=0,i=n.length;t<i;t++){let i,s=n[t];if(s.isInterleavedBufferAttribute){let t=r(e.data,s.data);i=new So(t,s.itemSize,s.offset,s.normalized)}else{let e=Gm(s.type,s.array);i=new vn(e,s.itemSize,s.normalized)}void 0!==s.name&&(i.name=s.name),a.push(i)}i.morphAttributes[t]=a}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){let t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}let h=e.data.boundingSphere;if(void 0!==h){let e=new q;void 0!==h.center&&e.fromArray(h.center),i.boundingSphere=new ir(e,h.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}},h6=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=""===this.path?Cy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let s=new Ls(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let a=null;try{a=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}let s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);i.parse(a,t)}),n,r)}loadAsync(e,t){return Et(this,null,(function*(){let n=""===this.path?Cy.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;let r=new Ls(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);let i=yield r.loadAsync(e,t),a=JSON.parse(i),s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return yield this.parseAsync(a)}))}parse(e,t){let n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,i,o,s,n),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),this.bindLightTargets(l),void 0!==t){let e=!1;for(let t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseAsync(e){return Et(this,null,(function*(){let t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=yield this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,r,s,a,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}))}parseShapes(e){let t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){let r=(new ki).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){let n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){let i=(new rg).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){let n={};if(void 0!==e){let r=new Jw;for(let i=0,a=e.length;i<a;i++){let a,s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;default:s.type in wae?a=wae[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}}return n}parseMaterials(e,t){let n={},r={};if(void 0!==e){let i=new yg;i.setTextures(t);for(let t=0,a=e.length;t<a;t++){let a=e[t];void 0===n[a.uuid]&&(n[a.uuid]=i.parse(a)),r[a.uuid]=n[a.uuid]}}return r}parseAnimations(e){let t={};if(void 0!==e)for(let n=0;n<e.length;n++){let r=e[n],i=Ed.parse(r);t[i.uuid]=i}return t}parseImages(e,t){let n,r=this,i={};function a(e){if("string"==typeof e){let t=e;return function(e){return r.manager.itemStart(e),n.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:Gm(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){let r=new wy(t);n=new _d(r),n.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){let n=e[t],r=n.url;if(Array.isArray(r)){let e=[];for(let t=0,n=r.length;t<n;t++){let n=a(r[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new ba(n.data,n.width,n.height)))}i[n.uuid]=new ll(e)}else{let e=a(n.url);i[n.uuid]=new ll(e)}}}return i}parseImagesAsync(e){return Et(this,null,(function*(){let t,n=this,r={};function i(e){return Et(this,null,(function*(){if("string"==typeof e){let r=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:n.resourcePath+r;return yield t.loadAsync(i)}return e.data?{data:Gm(e.type,e.data),width:e.width,height:e.height}:null}))}if(void 0!==e&&e.length>0){t=new _d(this.manager),t.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){let n=e[t],a=n.url;if(Array.isArray(a)){let e=[];for(let t=0,n=a.length;t<n;t++){let n=a[t],r=yield i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new ba(r.data,r.width,r.height)))}r[n.uuid]=new ll(e)}else{let e=yield i(n.url);r[n.uuid]=new ll(e)}}}return r}))}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}let r={};if(void 0!==e)for(let i=0,a=e.length;i<a;i++){let a=e[i];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let s,o=t[a.image],l=o.data;Array.isArray(l)?(s=new od,6===l.length&&(s.needsUpdate=!0)):(s=l&&l.data?new ba:new ei,l&&(s.needsUpdate=!0)),s.source=o,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,Dit)),void 0!==a.channel&&(s.channel=a.channel),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],Rae),s.wrapT=n(a.wrap[1],Rae)),void 0!==a.format&&(s.format=a.format),void 0!==a.internalFormat&&(s.internalFormat=a.internalFormat),void 0!==a.type&&(s.type=a.type),void 0!==a.colorSpace&&(s.colorSpace=a.colorSpace),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,Pae)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,Pae)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.generateMipmaps&&(s.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(s.compareFunction=a.compareFunction),void 0!==a.userData&&(s.userData=a.userData),r[a.uuid]=s}return r}parseObject(e,t,n,r,i){let a,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function h(e){if(void 0!==e){if(Array.isArray(e)){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":a=new ea,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new Ot(e.background):a.background=u(e.background)),void 0!==e.environment&&(a.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new ng(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new tg(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&a.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(a.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new ui(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new To(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new vg(e.color,e.intensity);break;case"DirectionalLight":a=new gg(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Xw(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Yw(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new jw(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new mg(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new Zw).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),o=h(e.material),a=new ww(s,o),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),o=h(e.material),a=new Jt(s,o);break;case"InstancedMesh":s=l(e.geometry),o=h(e.material);let t=e.count,n=e.instanceMatrix,r=e.instanceColor;a=new wo(s,o,t),a.instanceMatrix=new iu(new Float32Array(n.array),16),void 0!==r&&(a.instanceColor=new iu(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=h(e.material),a=new Mw(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),a.geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map((e=>{let t=new Ft;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);let n=new ir;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}})),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=u(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(a._colorsTexture=u(e.colorsTexture.uuid));break;case"LOD":a=new Sw;break;case"Line":a=new ti(l(e.geometry),h(e.material));break;case"LineLoop":a=new Rw(l(e.geometry),h(e.material));break;case"LineSegments":a=new ni(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":a=new Ni(l(e.geometry),h(e.material));break;case"Sprite":a=new Tw(h(e.material));break;case"Group":a=new Ai;break;case"Bone":a=new py;break;default:a=new Cn}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(a.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let s=e.children;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,n,r,i))}if(void 0!==e.animations){let t=e.animations;for(let e=0;e<t.length;e++){let n=t[e];a.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let t=e.levels;for(let e=0;e<t.length;e++){let n=t[e],r=a.getObjectByProperty("uuid",n.object);void 0!==r&&a.addLevel(r,n.distance,n.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}bindLightTargets(e){e.traverse((function(t){if(t.isDirectionalLight||t.isSpotLight){let n=t.target,r=e.getObjectByProperty("uuid",n);t.target=void 0!==r?r:new Cn}}))}},Dit={UVMapping:rM,CubeReflectionMapping:tu,CubeRefractionMapping:ch,EquirectangularReflectionMapping:K1,EquirectangularRefractionMapping:J1,CubeUVReflectionMapping:_g},Rae={RepeatWrapping:td,ClampToEdgeWrapping:xa,MirroredRepeatWrapping:nd},Pae={NearestFilter:Li,NearestMipmapNearestFilter:Dy,NearestMipmapLinearFilter:lh,LinearFilter:Dr,LinearMipmapNearestFilter:Jf,LinearMipmapLinearFilter:Eo},f6=class extends Ri{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,a=Jc.get(e);if(void 0!==a)return i.manager.itemStart(e),a.then?void a.then((n=>{t&&t(n),i.manager.itemEnd(e)})).catch((e=>{r&&r(e)})):(setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a);let s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader;let o=fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){return Jc.add(e,n),t&&t(n),i.manager.itemEnd(e),n})).catch((function(t){r&&r(t),Jc.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)}));Jc.add(e,o),i.manager.itemStart(e)}},FS,Ry=class{static getContext(){return void 0===FS&&(FS=new(window.AudioContext||window.webkitAudioContext)),FS}static setContext(e){FS=e}},d6=class extends Ri{constructor(e){super(e)}load(e,t,n,r){let i=this,a=new Ls(this.manager);function s(t){r?r(t):console.error(t),i.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){try{let n=e.slice(0);Ry.getContext().decodeAudioData(n,(function(e){t(e)})).catch(s)}catch(e){s(e)}}),n,r)}},Iae=new At,Dae=new At,Hf=new At,p6=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ui,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ui,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Hf.copy(e.projectionMatrix);let n,r,i=t.eyeSep/2,a=i*t.near/t.focus,s=t.near*Math.tan(ed*t.fov*.5)/t.zoom;Dae.elements[12]=-i,Iae.elements[12]=i,n=-s*t.aspect+a,r=s*t.aspect+a,Hf.elements[0]=2*t.near/(r-n),Hf.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(Hf),n=-s*t.aspect-a,r=s*t.aspect-a,Hf.elements[0]=2*t.near/(r-n),Hf.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(Hf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Dae),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Iae)}},ph=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Oae(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Oae();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Oae(){return("undefined"==typeof performance?Date:performance).now()}var Vf=new q,Lae=new Ci,Oit=new q,zf=new q,m6=class extends Cn{constructor(){super(),this.type="AudioListener",this.context=Ry.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ph}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Vf,Lae,Oit),zf.set(0,0,-1).applyQuaternion(Lae),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Vf.x,e),t.positionY.linearRampToValueAtTime(Vf.y,e),t.positionZ.linearRampToValueAtTime(Vf.z,e),t.forwardX.linearRampToValueAtTime(zf.x,e),t.forwardY.linearRampToValueAtTime(zf.y,e),t.forwardZ.linearRampToValueAtTime(zf.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Vf.x,Vf.y,Vf.z),t.setOrientation(zf.x,zf.y,zf.z,n.x,n.y,n.z)}},Qw=class extends Cn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},qf=new q,kae=new Ci,Lit=new q,Gf=new q,g6=class extends Qw{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(qf,kae,Lit),Gf.set(0,0,1).applyQuaternion(kae);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(qf.x,e),t.positionY.linearRampToValueAtTime(qf.y,e),t.positionZ.linearRampToValueAtTime(qf.z,e),t.orientationX.linearRampToValueAtTime(Gf.x,e),t.orientationY.linearRampToValueAtTime(Gf.y,e),t.orientationZ.linearRampToValueAtTime(Gf.z,e)}else t.setPosition(qf.x,qf.y,qf.z),t.setOrientation(Gf.x,Gf.y,Gf.z)}},v6=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},eM=class{constructor(e,t,n){let r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==r;++e)n[i+e]=n[e];a=t}else{a+=t;let e=t/a;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=a}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){let e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){Ci.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){let a=this._workIndex*i;Ci.multiplyQuaternionsFlat(e,a,e,t,e,n),Ci.slerpFlat(e,t,e,t,e,a,r)}_lerp(e,t,n,r,i){let a=1-r;for(let s=0;s!==i;++s){let i=t+s;e[i]=e[i]*a+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let a=0;a!==i;++a){let i=t+a;e[i]=e[i]+e[n+a]*r}}},e5="\\[\\]\\.:\\/",kit=new RegExp("["+e5+"]","g"),t5="[^"+e5+"]",Fit="[^"+e5.replace("\\.","")+"]",Nit=/((?:WC+[\/:])*)/.source.replace("WC",t5),Bit=/(WCOD+)?/.source.replace("WCOD",Fit),Uit=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",t5),Hit=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",t5),Vit=new RegExp("^"+Nit+Bit+Uit+Hit+"$"),zit=["material","materials","bones","map"],y6=class{constructor(e,t,n){let r=n||Wn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Wn=class{constructor(e,t,n){this.path=t,this.parsedPath=n||Wn.parseTrackName(t),this.node=Wn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Wn.Composite(e,t,n):new Wn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(kit,"")}static parseTrackName(e){let t=Vit.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){let e=n.nodeName.substring(r+1);-1!==zit.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){let n=function(e){for(let r=0;r<e.length;r++){let i=e[r];if(i.name===t||i.uuid===t)return i;let a=n(i.children);if(a)return a}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=Wn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}let a=e[r];if(void 0===a){let n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Wn.Composite=y6,Wn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Wn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Wn.prototype.GetterByBindingType=[Wn.prototype._getValue_direct,Wn.prototype._getValue_array,Wn.prototype._getValue_arrayElement,Wn.prototype._getValue_toArray],Wn.prototype.SetterByBindingTypeAndVersioning=[[Wn.prototype._setValue_direct,Wn.prototype._setValue_direct_setNeedsUpdate,Wn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Wn.prototype._setValue_array,Wn.prototype._setValue_array_setNeedsUpdate,Wn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Wn.prototype._setValue_arrayElement,Wn.prototype._setValue_arrayElement_setNeedsUpdate,Wn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Wn.prototype._setValue_fromArray,Wn.prototype._setValue_fromArray_setNeedsUpdate,Wn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var x6=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=qa(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e,t=this._objects,n=this._indicesByUUID,r=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length,o=t.length,l=this.nCachedObjects_;for(let h=0,u=arguments.length;h!==u;++h){let u=arguments[h],c=u.uuid,d=n[c];if(void 0===d){d=o++,n[c]=d,t.push(u);for(let e=0,t=s;e!==t;++e)a[e].push(new Wn(u,r[e],i[e]))}else if(d<l){e=t[d];let o=--l,h=t[o];n[h.uuid]=d,t[d]=h,n[c]=o,t[o]=u;for(let e=0,t=s;e!==t;++e){let t=a[e],n=t[o],s=t[d];t[d]=n,void 0===s&&(s=new Wn(u,r[e],i[e])),t[o]=s}}else t[d]!==e&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){let s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=i){let a=i++,h=e[a];t[h.uuid]=l,e[l]=h,t[o]=a,e[a]=s;for(let e=0,t=r;e!==t;++e){let t=n[e],r=t[a],i=t[l];t[l]=r,t[a]=i}}}this.nCachedObjects_=i}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,a=e.length;for(let s=0,o=arguments.length;s!==o;++s){let o=arguments[s].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<i){let s=--i,o=e[s],h=--a,u=e[h];t[o.uuid]=l,e[l]=o,t[u.uuid]=s,e[s]=u,e.pop();for(let e=0,t=r;e!==t;++e){let t=n[e],r=t[s],i=t[h];t[l]=r,t[s]=i,t.pop()}}else{let i=--a,s=e[i];i>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=r;e!==t;++e){let t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){let n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];let a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,u=new Array(l);r=i.length,n[e]=r,a.push(e),s.push(t),i.push(u);for(let n=h,r=o.length;n!==r;++n){let r=o[n];u[n]=new Wn(r,e,t)}return u}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){let r=this._paths,i=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=n,a[n]=o,a.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}},tM=class{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;let i=t.tracks,a=i.length,s=new Array(a),o={endingStart:Yf,endingEnd:Yf};for(let e=0;e!==a;++e){let t=i[e].createInterpolant(null);s[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Poe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let n=this._clip.duration,r=e._clip.duration,i=r/n,a=n/r;e.warp(1,i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let r=this._mixer,i=r.time,a=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=i,o[1]=i+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);let i=this._startTime;if(null!==i){let r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);let a=this._updateTime(t),s=this._updateWeight(e);if(s>0){let e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Y6)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(null!==n){let r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,r=this.time+e,i=this._loopCount,a=n===Ioe;if(0===e)return-1===i?r:a&&1==(1&i)?t-r:r;if(n===Roe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){let n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);let s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(a&&1==(1&i))return t-r}return r}_setEndings(e,t,n){let r=this._interpolantSettings;n?(r.endingStart=$f,r.endingEnd=$f):(r.endingStart=e?this.zeroSlopeAtStart?$f:Yf:Q1,r.endingEnd=t?this.zeroSlopeAtEnd?$f:Yf:Q1)}_scheduleFading(e,t,n){let r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);let s=a.parameterPositions,o=a.sampleValues;return s[0]=i,o[0]=t,s[1]=i+e,o[1]=n,this}},qit=new Float32Array(1),b6=class extends cl{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,s=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName,h=l[o];void 0===h&&(h={},l[o]=h);for(let e=0;e!==i;++e){let i=r[e],l=i.name,u=h[l];if(void 0!==u)++u.referenceCount,a[e]=u;else{if(u=a[e],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,o,l));continue}let r=t&&t._propertyBindings[e].binding.parsedPath;u=new eM(Wn.create(n,l,r),i.ValueTypeName,i.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,o,l),a[e]=u}s[e].resultBuffer=u.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}let t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){let n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){let n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){let r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{let t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;let i=e._clip.uuid,a=this._actionsByClip,s=a[i],o=s.knownActions,l=o[o.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete a[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){let n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){let r=this._bindingsByRootAndName,i=this._bindings,a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,s=a[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[i],0===Object.keys(s).length&&delete a[r]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&(n=new Ty(new Float32Array(2),new Float32Array(2),1,qit),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){let r=t||this._root,i=r.uuid,a="string"==typeof e?Ed.findByName(r,e):e,s=null!==a?a.uuid:e,o=this._actionsByClip[s],l=null;if(void 0===n&&(n=null!==a?a.blendMode:uM),void 0!==o){let e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;let h=new tM(this,a,t,n);return this._bindAction(h,l),this._addInactiveAction(h,s,i),h}existingAction(e,t){let n=t||this._root,r=n.uuid,i="string"==typeof e?Ed.findByName(n,e):e,a=i?i.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){let e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1;for(let s=0;s!==n;++s)t[s]._update(r,e,i,a);let s=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)s[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){let e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){let r=e[n];this._deactivateAction(r);let i=r._cacheIndex,a=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,a._cacheIndex=i,t[i]=a,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let e in n){let r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}let r=this._bindingsByRootAndName[t];if(void 0!==r)for(let e in r){let t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},Td=class{constructor(e){this.value=e}clone(){return new Td(void 0===this.value.clone?this.value:this.value.clone())}},Git=0,E6=class extends cl{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Git++}),this.name="",this.usage=ry,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;let t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++){let n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<n.length;e++)this.uniforms.push(n[e].clone())}return this}clone(){return(new this.constructor).copy(this)}},_6=class extends cd{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},T6=class{constructor(e,t,n,r,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},Fae=new At,Sd=class{constructor(e,t,n=0,r=1/0){this.ray=new _o(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new uh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Fae.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Fae),this}intersectObject(e,t=!0,n=[]){return S6(e,this,n,t),n.sort(Nae),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)S6(e[r],this,n,t);return n.sort(Nae),n}};function Nae(e,t){return e.distance-t.distance}function S6(e,t,n,r){let i=!0;if(e.layers.test(t.layers)&&!1===e.raycast(t,n)&&(i=!1),!0===i&&!0===r){let r=e.children;for(let e=0,i=r.length;e<i;e++)S6(r[e],t,n,!0)}}var w6=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(xi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},M6=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Py=class{constructor(e,t,n,r){Py.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){let i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}},Bae=new Te,Vr=class{constructor(e=new Te(1/0,1/0),t=new Te(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=Bae.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Bae).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Uae=new q,NS=new q,xs=class{constructor(e=new q,t=new q){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Uae.subVectors(e,this.start),NS.subVectors(this.end,this.start);let n=NS.dot(NS),r=NS.dot(Uae)/n;return t&&(r=xi(r,0,1)),r}closestPointToPoint(e,t,n){let r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},Hae=new q,A6=class extends Cn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let n=new Nt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){let i=e/n*Math.PI*2,a=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(a),Math.sin(a),1)}n.setAttribute("position",new Wt(r,3));let i=new gr({fog:!1,toneMapped:!1});this.cone=new ni(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Hae.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Hae),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},ah=new q,BS=new At,Sk=new At,C6=class extends ni{constructor(e){let t=lle(e),n=new Nt,r=[],i=[],a=new Ot(0,0,1),s=new Ot(0,1,0);for(let e=0;e<t.length;e++){let n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new Wt(r,3)),n.setAttribute("color",new Wt(i,3)),super(n,new gr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,r=n.getAttribute("position");Sk.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){let i=t[e];i.parent&&i.parent.isBone&&(BS.multiplyMatrices(Sk,i.matrixWorld),ah.setFromMatrixPosition(BS),r.setXYZ(n,ah.x,ah.y,ah.z),BS.multiplyMatrices(Sk,i.parent.matrixWorld),ah.setFromMatrixPosition(BS),r.setXYZ(n+1,ah.x,ah.y,ah.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}};function lle(e){let t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,lle(e.children[n]));return t}var R6=class extends Jt{constructor(e,t,n){super(new gd(t,4,2),new mr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Wit=new q,Vae=new Ot,zae=new Ot,P6=class extends Cn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";let r=new md(t);r.rotateY(.5*Math.PI),this.material=new mr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new vn(a,3)),this.add(new Jt(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");Vae.copy(this.light.color),zae.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){let r=e<n/2?Vae:zae;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Wit.setFromMatrixPosition(this.light.matrixWorld).negate())}},I6=class extends ni{constructor(e=10,t=10,n=4473924,r=8947848){n=new Ot(n),r=new Ot(r);let i=t/2,a=e/t,s=e/2,o=[],l=[];for(let e=0,h=0,u=-s;e<=t;e++,u+=a){o.push(-s,0,u,s,0,u),o.push(u,0,-s,u,0,s);let t=e===i?n:r;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}let h=new Nt;h.setAttribute("position",new Wt(o,3)),h.setAttribute("color",new Wt(l,3)),super(h,new gr({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},D6=class extends ni{constructor(e=10,t=16,n=8,r=64,i=4473924,a=8947848){i=new Ot(i),a=new Ot(a);let s=[],o=[];if(t>1)for(let n=0;n<t;n++){let r=n/t*(2*Math.PI),l=Math.sin(r)*e,h=Math.cos(r)*e;s.push(0,0,0),s.push(l,0,h);let u=1&n?i:a;o.push(u.r,u.g,u.b),o.push(u.r,u.g,u.b)}for(let t=0;t<n;t++){let l=1&t?i:a,h=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*h,i=Math.cos(t)*h;s.push(n,0,i),o.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*h,i=Math.cos(t)*h,s.push(n,0,i),o.push(l.r,l.g,l.b)}}let l=new Nt;l.setAttribute("position",new Wt(s,3)),l.setAttribute("color",new Wt(o,3)),super(l,new gr({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},qae=new q,US=new q,Gae=new q,xg=class extends Cn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new Nt;r.setAttribute("position",new Wt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let i=new gr({fog:!1,toneMapped:!1});this.lightPlane=new ti(r,i),this.add(this.lightPlane),r=new Nt,r.setAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new ti(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),qae.setFromMatrixPosition(this.light.matrixWorld),US.setFromMatrixPosition(this.light.target.matrixWorld),Gae.subVectors(US,qae),this.lightPlane.lookAt(US),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(US),this.targetLine.scale.z=Gae.length()}},HS=new q,vi=new ad,bg=class extends ni{constructor(e){let t=new Nt,n=new gr({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],a={};function s(e,t){o(e),o(t)}function o(e){r.push(0,0,0),i.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new Wt(r,3)),t.setAttribute("color",new Wt(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new Ot(16755200),h=new Ot(16711680),u=new Ot(43775),c=new Ot(16777215),d=new Ot(3355443);this.setColors(l,h,u,c,d)}setColors(e,t,n,r,i){let a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,i.r,i.g,i.b),a.setXYZ(41,i.r,i.g,i.b),a.setXYZ(42,i.r,i.g,i.b),a.setXYZ(43,i.r,i.g,i.b),a.setXYZ(44,i.r,i.g,i.b),a.setXYZ(45,i.r,i.g,i.b),a.setXYZ(46,i.r,i.g,i.b),a.setXYZ(47,i.r,i.g,i.b),a.setXYZ(48,i.r,i.g,i.b),a.setXYZ(49,i.r,i.g,i.b),a.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;vi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Mi("c",t,e,vi,0,0,-1),Mi("t",t,e,vi,0,0,1),Mi("n1",t,e,vi,-1,-1,-1),Mi("n2",t,e,vi,1,-1,-1),Mi("n3",t,e,vi,-1,1,-1),Mi("n4",t,e,vi,1,1,-1),Mi("f1",t,e,vi,-1,-1,1),Mi("f2",t,e,vi,1,-1,1),Mi("f3",t,e,vi,-1,1,1),Mi("f4",t,e,vi,1,1,1),Mi("u1",t,e,vi,.7,1.1,-1),Mi("u2",t,e,vi,-.7,1.1,-1),Mi("u3",t,e,vi,0,2,-1),Mi("cf1",t,e,vi,-1,0,1),Mi("cf2",t,e,vi,1,0,1),Mi("cf3",t,e,vi,0,-1,1),Mi("cf4",t,e,vi,0,1,1),Mi("cn1",t,e,vi,-1,0,-1),Mi("cn2",t,e,vi,1,0,-1),Mi("cn3",t,e,vi,0,-1,-1),Mi("cn4",t,e,vi,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Mi(e,t,n,r,i,a,s){HS.set(i,a,s).unproject(r);let o=t[e];if(void 0!==o){let e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],HS.x,HS.y,HS.z)}}var VS=new Ft,O6=class extends ni{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Nt;i.setIndex(new vn(n,1)),i.setAttribute("position",new vn(r,3)),super(i,new gr({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&VS.setFromObject(this.object),VS.isEmpty())return;let t=VS.min,n=VS.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},L6=class extends ni{constructor(e,t=16776960){let n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Nt;r.setIndex(new vn(n,1)),r.setAttribute("position",new Wt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new gr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},k6=class extends ti{constructor(e,t=1,n=16776960){let r=n,i=new Nt;i.setAttribute("position",new Wt([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new gr({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;let a=new Nt;a.setAttribute("position",new Wt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new Jt(a,new mr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},Wae=new q,zS,wk,wd=class extends Cn{constructor(e=new q(0,0,1),t=new q(0,0,0),n=1,r=16776960,i=.2*n,a=.2*i){super(),this.type="ArrowHelper",void 0===zS&&((zS=new Nt).setAttribute("position",new Wt([0,0,0,0,1,0],3)),(wk=new hh(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ti(zS,new gr({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Jt(wk,new mr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Wae.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Wae,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},F6=class extends ni{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Nt;n.setAttribute("position",new Wt(t,3)),n.setAttribute("color",new Wt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new gr({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){let r=new Ot,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Md=class{constructor(){this.type="ShapePath",this.color=new Ot,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new $l,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){let n=t.length,r=!1;for(let i=n-1,a=0;a<n;i=a++){let n=t[i],s=t[a],o=s.x-n.x,l=s.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],o=-o,s=t[i],l=-l),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{let t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}let n=Ds.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,a,s,o=[];if(1===r.length)return a=r[0],s=new ki,s.curves=a.curves,o.push(s),o;let l=!n(r[0].getPoints());l=e?!l:l;let h,u,c=[],d=[],p=[],f=0;d[f]=void 0,p[f]=[];for(let t=0,s=r.length;t<s;t++)a=r[t],h=a.getPoints(),i=n(h),i=e?!i:i,i?(!l&&d[f]&&f++,d[f]={s:new ki,p:h},d[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:h[0]});if(!d[0])return function(e){let t=[];for(let n=0,r=e.length;n<r;n++){let r=e[n],i=new ki;i.curves=r.curves,t.push(i)}return t}(r);if(d.length>1){let e=!1,n=0;for(let e=0,t=d.length;e<t;e++)c[e]=[];for(let r=0,i=d.length;r<i;r++){let i=p[r];for(let a=0;a<i.length;a++){let s=i[a],o=!0;for(let i=0;i<d.length;i++)t(s.p,d[i].p)&&(r!==i&&n++,o?(o=!1,c[i].push(s)):e=!0);o&&c[r].push(s)}}n>0&&!1===e&&(p=c)}for(let e=0,t=d.length;e<t;e++){s=d[e].s,o.push(s),u=p[e];for(let e=0,t=u.length;e<t;e++)s.holes.push(u[e].h)}return o}},N6=class extends Qs{constructor(e=1,t=1,n=1,r={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,Ki(oi({},r),{count:n})),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Eg}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Eg);var Ql=new ir,cle=new q,ule=new q,hle=new q,fle=new q;function mM(e,t,n,r,i,a,s){if(cle.fromBufferAttribute(t,r).applyMatrix4(e.matrixWorld),ule.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),n.ray.distanceSqToSegment(cle,ule,fle,hle)>a)return!1;let o=n.ray.origin.distanceTo(fle);return!(o<n.near||o>n.far)&&(s.push({distance:o,point:hle.clone(),index:r,object:e}),!0)}ti.prototype.raycast=function(e,t){let n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Ql.copy(n.boundingSphere),Ql.applyMatrix4(r),Ql.radius+=i,!1===e.ray.intersectsSphere(Ql))return;let s=i*i,o=this.isLineSegments?2:1,l=n.index,h=n.attributes.position,u=t.length;if(null!==l){let n=this.userData.batches;if(n&&n.length>0&&n[0].boundingSphere)for(let i=0;i<n.length;i++){let a=n[i];if(Ql.copy(a.boundingSphere),Ql.applyMatrix4(r),!1!==e.ray.intersectsSphere(Ql))for(let n=a.indexStart,r=a.indexStart+a.indexCount-1;n<r;n+=o){if(mM(this,h,e,l.getX(n),l.getX(n+1),s,t)&&(t[t.length-1].index=n,t.length-u>=1))return}}else{for(let n=Math.max(0,a.start),r=Math.min(l.count,a.start+a.count)-1;n<r;n+=o){if(mM(this,h,e,l.getX(n),l.getX(n+1),s,t)&&(t[t.length-1].index=n,t.length-u>=1))return}}}else{let n=this.userData.batches;if(n&&n.length>0&&n[0].boundingSphere)for(let i=0;i<n.length;i++){let a=n[i];if(Ql.copy(a.boundingSphere),Ql.applyMatrix4(r),!1!==e.ray.intersectsSphere(Ql))for(let n=a.positionStart,r=a.positionStart+a.positionCount-1;n<r;n+=o)if(mM(this,h,e,n,n+1,s,t)&&t.length-u>=1)return}else{for(let n=Math.max(0,a.start),r=Math.min(h.count,a.start+a.count)-1;n<r;n+=o)if(mM(this,h,e,n,n+1,s,t)&&t.length-u>=1)return}}};var dle=Math.pow(2,-24),Cd=class{constructor(){}};function Ao(e,t,n){return n.min.x=t[e],n.min.y=t[e+1],n.min.z=t[e+2],n.max.x=t[e+3],n.max.y=t[e+4],n.max.z=t[e+5],n}function n5(e){let t=-1,n=-1/0;for(let r=0;r<3;r++){let i=e[r+3]-e[r];i>n&&(n=i,t=r)}return t}function r5(e,t){t.set(e)}function i5(e,t,n){let r,i;for(let a=0;a<3;a++){let s=a+3;r=e[a],i=t[a],n[a]=r<i?r:i,r=e[s],i=t[s],n[s]=r>i?r:i}}function ky(e,t,n){for(let r=0;r<3;r++){let i=t[e+2*r],a=t[e+2*r+1],s=i-a,o=i+a;s<n[r]&&(n[r]=s),o>n[r+3]&&(n[r+3]=o)}}function wg(e){let t=e[3]-e[0],n=e[4]-e[1],r=e[5]-e[2];return 2*(t*n+n*r+r*t)}function Yit(e,t){if(!e.index){let n,r=e.attributes.position.count,i=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;n=r>65535?new Uint32Array(new i(4*r)):new Uint16Array(new i(2*r)),e.setIndex(new vn(n,1));for(let e=0;e<r;e++)n[e]=e}}function $it(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],n=new Set;for(let t of e.groups)n.add(t.start),n.add(t.start+t.count);let r=Array.from(n.values()).sort(((e,t)=>e-t));for(let e=0;e<r.length-1;e++){let n=r[e],i=r[e+1];t.push({offset:n/3,count:(i-n)/3})}return t}function a5(e,t,n,r,i=null){let a=1/0,s=1/0,o=1/0,l=-1/0,h=-1/0,u=-1/0,c=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==i;for(let r=6*t,i=6*(t+n);r<i;r+=6){let t=e[r+0],n=e[r+1],i=t-n,y=t+n;i<a&&(a=i),y>l&&(l=y),v&&t<c&&(c=t),v&&t>f&&(f=t);let x=e[r+2],b=e[r+3],_=x-b,w=x+b;_<s&&(s=_),w>h&&(h=w),v&&x<d&&(d=x),v&&x>m&&(m=x);let S=e[r+4],M=e[r+5],T=S-M,E=S+M;T<o&&(o=T),E>u&&(u=E),v&&S<p&&(p=S),v&&S>g&&(g=S)}r[0]=a,r[1]=s,r[2]=o,r[3]=l,r[4]=h,r[5]=u,v&&(i[0]=c,i[1]=d,i[2]=p,i[3]=f,i[4]=m,i[5]=g)}function Zit(e,t,n,r){let i=1/0,a=1/0,s=1/0,o=-1/0,l=-1/0,h=-1/0;for(let r=6*t,u=6*(t+n);r<u;r+=6){let t=e[r+0];t<i&&(i=t),t>o&&(o=t);let n=e[r+2];n<a&&(a=n),n>l&&(l=n);let u=e[r+4];u<s&&(s=u),u>h&&(h=u)}r[0]=i,r[1]=a,r[2]=s,r[3]=o,r[4]=l,r[5]=h}function Kit(e,t,n,r,i){let a=n,s=n+r-1,o=i.pos,l=2*i.axis;for(;;){for(;a<=s&&t[6*a+l]<o;)a++;for(;a<=s&&t[6*s+l]>=o;)s--;if(!(a<s))return a;for(let n=0;n<3;n++){let r=e[3*a+n];e[3*a+n]=e[3*s+n],e[3*s+n]=r;let i=t[6*a+2*n+0];t[6*a+2*n+0]=t[6*s+2*n+0],t[6*s+2*n+0]=i;let o=t[6*a+2*n+1];t[6*a+2*n+1]=t[6*s+2*n+1],t[6*s+2*n+1]=o}a++,s--}}var lu=32,Jit=(e,t)=>e.candidate-t.candidate,gh=new Array(lu).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),gM=new Float32Array(6);function Qit(e,t,n,r,i,a){let s=-1,o=0;if(0===a)s=n5(t),-1!==s&&(o=(t[s]+t[s+3])/2);else if(1===a)s=n5(e),-1!==s&&(o=est(n,r,i,s));else if(2===a){let a=wg(e),l=1.25*i,h=6*r,u=6*(r+i);for(let e=0;e<3;e++){let r=t[e],c=(t[e+3]-r)/lu;if(i<lu/4){let t=[...gh];t.length=i;let r=0;for(let i=h;i<u;i+=6,r++){let a=t[r];a.candidate=n[i+2*e],a.count=0;let{bounds:s,leftCacheBounds:o,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;ky(i,n,s)}t.sort(Jit);let c=i;for(let e=0;e<c;e++){let n=t[e];for(;e+1<c&&t[e+1].candidate===n.candidate;)t.splice(e+1,1),c--}for(let r=h;r<u;r+=6){let i=n[r+2*e];for(let e=0;e<c;e++){let a=t[e];i>=a.candidate?ky(r,n,a.rightCacheBounds):(ky(r,n,a.leftCacheBounds),a.count++)}}for(let n=0;n<c;n++){let r=t[n],h=r.count,u=i-r.count,c=r.leftCacheBounds,d=r.rightCacheBounds,p=0;0!==h&&(p=wg(c)/a);let f=0;0!==u&&(f=wg(d)/a);let m=1+1.25*(p*h+f*u);m<l&&(s=e,l=m,o=r.candidate)}}else{for(let e=0;e<lu;e++){let t=gh[e];t.count=0,t.candidate=r+c+e*c;let n=t.bounds;for(let e=0;e<3;e++)n[e]=1/0,n[e+3]=-1/0}for(let t=h;t<u;t+=6){let i=~~((n[t+2*e]-r)/c);i>=lu&&(i=lu-1);let a=gh[i];a.count++,ky(t,n,a.bounds)}let t=gh[lu-1];r5(t.bounds,t.rightCacheBounds);for(let e=lu-2;e>=0;e--){let t=gh[e],n=gh[e+1];i5(t.bounds,n.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<lu-1;t++){let n=gh[t],r=n.count,h=n.bounds,u=gh[t+1].rightCacheBounds;0!==r&&(0===d?r5(h,gM):i5(h,gM,gM)),d+=r;let c=0,p=0;0!==d&&(c=wg(gM)/a);let f=i-d;0!==f&&(p=wg(u)/a);let m=1+1.25*(c*d+p*f);m<l&&(s=e,l=m,o=n.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:s,pos:o}}function est(e,t,n,r){let i=0;for(let a=t,s=t+n;a<s;a++)i+=e[6*a+2*r];return i/n}function tst(e,t){let n=e.attributes.position,r=e.index.array,i=r.length/3,a=new Float32Array(6*i),s=n.normalized,o=n.array,l=n.offset||0,h=3;n.isInterleavedBufferAttribute&&(h=n.data.stride);let u=["getX","getY","getZ"];for(let e=0;e<i;e++){let i,c,d,p=3*e,f=6*e;s?(i=r[p+0],c=r[p+1],d=r[p+2]):(i=r[p+0]*h+l,c=r[p+1]*h+l,d=r[p+2]*h+l);for(let e=0;e<3;e++){let r,l,h;s?(r=n[u[e]](i),l=n[u[e]](c),h=n[u[e]](d)):(r=o[i+e],l=o[c+e],h=o[d+e]);let p=r;l<p&&(p=l),h<p&&(p=h);let m=r;l>m&&(m=l),h>m&&(m=h);let g=(m-p)/2,v=2*e;a[f+v+0]=p+g,a[f+v+1]=g+(Math.abs(p)+g)*dle,p<t[e]&&(t[e]=p),m>t[e+3]&&(t[e+3]=m)}}return a}function nst(e,t){function n(e){d&&d(e/p)}function r(t,i,d,p=null,m=0){if(!f&&m>=l&&(f=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),d<=u||m>=l)return n(i+d),t.offset=i,t.count=d,t;let g=Qit(t.boundingData,p,s,i,d,c);if(-1===g.axis)return n(i+d),t.offset=i,t.count=d,t;let v=Kit(o,s,i,d,g);if(v===i||v===i+d)n(i+d),t.offset=i,t.count=d;else{t.splitAxis=g.axis;let e=new Cd,n=i,o=v-i;t.left=e,e.boundingData=new Float32Array(6),a5(s,n,o,e.boundingData,a),r(e,n,o,a,m+1);let l=new Cd,h=v,u=d-o;t.right=l,l.boundingData=new Float32Array(6),a5(s,h,u,l.boundingData,a),r(l,h,u,a,m+1)}return t}Yit(e,t);let i=new Float32Array(6),a=new Float32Array(6),s=tst(e,i),o=e.index.array,l=t.maxDepth,h=t.verbose,u=t.maxLeafTris,c=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=$it(e);if(1===g.length){let e=g[0],t=new Cd;t.boundingData=i,Zit(s,e.offset,e.count,a),r(t,e.offset,e.count,a),m.push(t)}else for(let e of g){let t=new Cd;t.boundingData=new Float32Array(6),a5(s,e.offset,e.count,t.boundingData,a),r(t,e.offset,e.count,a),m.push(t)}return m}function gle(e,t){let n,r,i,a=nst(e,t),s=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<a.length;e++){let t=a[e],u=new o(32*l(t));n=new Float32Array(u),r=new Uint32Array(u),i=new Uint16Array(u),h(0,t),s.push(u)}return s;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function h(e,t){let a=e/4,s=e/2,o=!!t.count,l=t.boundingData;for(let e=0;e<6;e++)n[a+e]=l[e];if(o){let n=t.offset,o=t.count;return r[a+6]=n,i[s+14]=o,i[s+15]=65535,e+32}{let n,i=t.left,s=t.right,o=t.splitAxis;if(n=h(e+32,i),n/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[a+6]=n/4,n=h(n,s),r[a+7]=o,n}}}var Ea=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let i=0,a=e.length;i<a;i++){let a=e[i][t];n=a<n?a:n,r=a>r?a:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let i=0,a=t.length;i<a;i++){let a=t[i],s=e.dot(a);n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Ea.prototype.setFromBox=function(){let e=new q;return function(t,n){let r=n.min,i=n.max,a=1/0,s=-1/0;for(let n=0;n<=1;n++)for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){e.x=r.x*n+i.x*(1-n),e.y=r.y*o+i.y*(1-o),e.z=r.z*l+i.z*(1-l);let h=t.dot(e);a=Math.min(h,a),s=Math.max(h,s)}this.min=a,this.max=s}}();var dAt=function(){let e=new Ea;return function(t,n){let r=t.points,i=t.satAxes,a=t.satBounds,s=n.points,o=n.satAxes,l=n.satBounds;for(let t=0;t<3;t++){let n=a[t],r=i[t];if(e.setFromPoints(r,s),n.isSeparated(e))return!1}for(let t=0;t<3;t++){let n=l[t],i=o[t];if(e.setFromPoints(i,r),n.isSeparated(e))return!1}}}(),rst=function(){let e=new q,t=new q,n=new q;return function(r,i,a){let s=r.start,o=e,l=i.start,h=t;n.subVectors(s,l),e.subVectors(r.end,r.start),t.subVectors(i.end,i.start);let u,c,d=n.dot(h),p=h.dot(o),f=h.dot(h),m=n.dot(o),g=o.dot(o)*f-p*p;u=0!==g?(d*p-m*f)/g:0,c=(d+u*p)/f,a.x=u,a.y=c}}(),Fy=function(){let e=new Te,t=new q,n=new q;return function(r,i,a,s){rst(r,i,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return r.at(o,a),void i.at(l,s);if(o>=0&&o<=1)return l<0?i.at(0,s):i.at(1,s),void r.closestPointToPoint(s,!0,a);if(l>=0&&l<=1)return o<0?r.at(0,a):r.at(1,a),void i.closestPointToPoint(a,!0,s);{let e,h;e=o<0?r.start:r.end,h=l<0?i.start:i.end;let u=t,c=n;return r.closestPointToPoint(h,!0,t),i.closestPointToPoint(e,!0,n),u.distanceToSquared(h)<=c.distanceToSquared(e)?(a.copy(u),void s.copy(h)):(a.copy(e),void s.copy(c))}}}(),vle=function(){let e=new q,t=new q,n=new Oi,r=new xs;return function(i,a){let{radius:s,center:o}=i,{a:l,b:h,c:u}=a;if(r.start=l,r.end=h,r.closestPointToPoint(o,!0,e).distanceTo(o)<=s||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=s)||(r.start=h,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=s))return!0;let c=a.getPlane(n);if(Math.abs(c.distanceToPoint(o))<=s){let e=c.projectPoint(o,t);if(a.containsPoint(e))return!0}return!1}}(),ist=1e-15;function Mg(e){return Math.abs(e)<ist}var _a=class extends Pr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new q)),this.satBounds=new Array(4).fill().map((()=>new Ea)),this.points=[this.a,this.b,this.c],this.sphere=new ir,this.plane=new Oi,this.needsUpdate=!0}intersectsSphere(e){return vle(e,this)}update(){let e=this.a,t=this.b,n=this.c,r=this.points,i=this.satAxes,a=this.satBounds,s=i[0],o=a[0];this.getNormal(s),o.setFromPoints(s,r);let l=i[1],h=a[1];l.subVectors(e,t),h.setFromPoints(l,r);let u=i[2],c=a[2];u.subVectors(t,n),c.setFromPoints(u,r);let d=i[3],p=a[3];d.subVectors(n,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}};_a.prototype.closestPointToSegment=function(){let e=new q,t=new q,n=new xs;return function(r,i=null,a=null){let s,{start:o,end:l}=r,h=this.points,u=1/0;for(let o=0;o<3;o++){let l=(o+1)%3;n.start.copy(h[o]),n.end.copy(h[l]),Fy(n,r,e,t),s=e.distanceToSquared(t),s<u&&(u=s,i&&i.copy(e),a&&a.copy(t))}return this.closestPointToPoint(o,e),s=o.distanceToSquared(e),s<u&&(u=s,i&&i.copy(e),a&&a.copy(o)),this.closestPointToPoint(l,e),s=l.distanceToSquared(e),s<u&&(u=s,i&&i.copy(e),a&&a.copy(l)),Math.sqrt(u)}}(),_a.prototype.intersectsTriangle=function(){let e=new _a,t=new Array(3),n=new Array(3),r=new Ea,i=new Ea,a=new q,s=new q,o=new q,l=new q,h=new xs,u=new xs,c=new xs;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;n[0]=d.a,n[1]=d.b,n[2]=d.c;for(let t=0;t<4;t++){let i=e[t],a=s[t];if(r.setFromPoints(a,n),i.isSeparated(r))return!1}let o=d.satBounds,l=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let n=o[e],i=l[e];if(r.setFromPoints(i,t),n.isSeparated(r))return!1}for(let e=0;e<4;e++){let o=s[e];for(let e=0;e<4;e++){let s=l[e];if(a.crossVectors(o,s),r.setFromPoints(a,t),i.setFromPoints(a,n),r.isSeparated(i))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let e=this.points,t=!1,n=0;for(let r=0;r<3;r++){let i=e[r],a=e[(r+1)%3];h.start.copy(i),h.end.copy(a),h.delta(s);let o=t?u.start:u.end,l=Mg(g.distanceToPoint(i));if(Mg(g.normal.dot(s))&&l){u.copy(h),n=2;break}if((g.intersectLine(h,o)||l)&&!Mg(o.distanceTo(a))){if(n++,t)break;t=!0}}if(1===n&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==n)return!1;let r=d.points,i=!1,a=0;for(let e=0;e<3;e++){let t=r[e],n=r[(e+1)%3];h.start.copy(t),h.end.copy(n),h.delta(o);let s=i?c.start:c.end,l=Mg(m.distanceToPoint(t));if(Mg(m.normal.dot(o))&&l){c.copy(h),a=2;break}if((m.intersectLine(h,s)||l)&&!Mg(s.distanceTo(n))){if(a++,i)break;i=!0}}if(1===a&&this.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(2!==a)return!1;if(u.delta(s),c.delta(o),s.dot(o)<0){let e=c.start;c.start=c.end,c.end=e}let f=u.start.dot(s),v=u.end.dot(s),y=c.start.dot(s),x=c.end.dot(s);return(f===x||y===v||v<y!==f<x)&&(p&&(l.subVectors(u.start,c.start),l.dot(s)>0?p.start.copy(u.start):p.start.copy(c.start),l.subVectors(u.end,c.end),l.dot(s)<0?p.end.copy(u.end):p.end.copy(c.end)),!0)}}}(),_a.prototype.distanceToPoint=function(){let e=new q;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),_a.prototype.distanceToTriangle=function(){let e=new q,t=new q,n=["a","b","c"],r=new xs,i=new xs;return function(a,s=null,o=null){let l=s||o?r:null;if(this.intersectsTriangle(a,l))return(s||o)&&(s&&l.getCenter(s),o&&l.getCenter(o)),0;let h=1/0;for(let t=0;t<3;t++){let r,i=n[t],l=a[i];this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<h&&(h=r,s&&s.copy(e),o&&o.copy(l));let u=this[i];a.closestPointToPoint(u,e),r=u.distanceToSquared(e),r<h&&(h=r,s&&s.copy(u),o&&o.copy(e))}for(let l=0;l<3;l++){let u=n[l],c=n[(l+1)%3];r.set(this[u],this[c]);for(let l=0;l<3;l++){let u=n[l],c=n[(l+1)%3];i.set(a[u],a[c]),Fy(r,i,e,t);let d=e.distanceToSquared(t);d<h&&(h=d,s&&s.copy(e),o&&o.copy(t))}}return Math.sqrt(h)}}();var Ta=class{constructor(e,t,n){this.isOrientedBox=!0,this.min=new q,this.max=new q,this.matrix=new At,this.invMatrix=new At,this.points=new Array(8).fill().map((()=>new q)),this.satAxes=new Array(3).fill().map((()=>new q)),this.satBounds=new Array(3).fill().map((()=>new Ea)),this.alignedSatBounds=new Array(3).fill().map((()=>new Ea)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Ta.prototype.update=function(){let e=this.matrix,t=this.min,n=this.max,r=this.points;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let s=0;s<=1;s++){let o=r[1*i|2*a|4*s];o.x=i?n.x:t.x,o.y=a?n.y:t.y,o.z=s?n.z:t.z,o.applyMatrix4(e)}let i=this.satBounds,a=this.satAxes,s=r[0];for(let e=0;e<3;e++){let t=a[e],n=i[e],o=r[1<<e];t.subVectors(s,o),n.setFromPoints(t,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Ta.prototype.intersectsBox=function(){let e=new Ea;return function(t){this.needsUpdate&&this.update();let n=t.min,r=t.max,i=this.satBounds,a=this.satAxes,s=this.alignedSatBounds;if(e.min=n.x,e.max=r.x,s[0].isSeparated(e)||(e.min=n.y,e.max=r.y,s[1].isSeparated(e))||(e.min=n.z,e.max=r.z,s[2].isSeparated(e)))return!1;for(let n=0;n<3;n++){let r=a[n],s=i[n];if(e.setFromBox(r,t),s.isSeparated(e))return!1}return!0}}(),Ta.prototype.intersectsTriangle=function(){let e=new _a,t=new Array(3),n=new Ea,r=new Ea,i=new q;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);let s=this.satBounds,o=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let e=0;e<3;e++){let r=s[e],i=o[e];if(n.setFromPoints(i,t),r.isSeparated(n))return!1}let l=a.satBounds,h=a.satAxes,u=this.points;for(let e=0;e<3;e++){let t=l[e],r=h[e];if(n.setFromPoints(r,u),t.isSeparated(n))return!1}for(let e=0;e<3;e++){let a=o[e];for(let e=0;e<4;e++){let s=h[e];if(i.crossVectors(a,s),n.setFromPoints(i,t),r.setFromPoints(i,u),n.isSeparated(r))return!1}}return!0}}(),Ta.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Ta.prototype.distanceToPoint=function(){let e=new q;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Ta.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map((()=>new xs)),n=new Array(12).fill().map((()=>new xs)),r=new q,i=new q;return function(a,s=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(i),this.closestPointToPoint(i,r),a.closestPointToPoint(r,i),o&&o.copy(r),l&&l.copy(i)),0;let h=s*s,u=a.min,c=a.max,d=this.points,p=1/0;for(let e=0;e<8;e++){let t=d[e];i.copy(t).clamp(u,c);let n=t.distanceToSquared(i);if(n<p&&(p=n,o&&o.copy(t),l&&l.copy(i),n<h))return Math.sqrt(n)}let f=0;for(let r=0;r<3;r++)for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){let s=(r+1)%3,o=(r+2)%3,l=1<<r|i<<s|a<<o,h=d[i<<s|a<<o],p=d[l];t[f].set(h,p);let m=e[r],g=e[s],v=e[o],y=n[f],x=y.start,b=y.end;x[m]=u[m],x[g]=i?u[g]:c[g],x[v]=a?u[v]:c[g],b[m]=c[m],b[g]=i?u[g]:c[g],b[v]=a?u[v]:c[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let n=0;n<=1;n++){i.x=e?c.x:u.x,i.y=t?c.y:u.y,i.z=n?c.z:u.z,this.closestPointToPoint(i,r);let a=i.distanceToSquared(r);if(a<p&&(p=a,o&&o.copy(r),l&&l.copy(i),a<h))return Math.sqrt(a)}for(let e=0;e<12;e++){let a=t[e];for(let e=0;e<12;e++){let t=n[e];Fy(a,t,r,i);let s=r.distanceToSquared(i);if(s<p&&(p=s,o&&o.copy(r),l&&l.copy(i),s<h))return Math.sqrt(s)}}return Math.sqrt(p)}}();var yM=new q,xM=new q,bM=new q,yle=new Te,xle=new Te,ble=new Te,Ele=new q;function sst(e,t,n,r,i,a){let s;return s=a===zi?e.intersectTriangle(r,n,t,!0,i):e.intersectTriangle(t,n,r,a!==Mr,i),null===s?null:{distance:e.origin.distanceTo(i),point:i.clone()}}function ast(e,t,n,r,i,a,s){yM.fromBufferAttribute(t,r),xM.fromBufferAttribute(t,i),bM.fromBufferAttribute(t,a);let o=sst(e,yM,xM,bM,Ele,s);if(o){n&&(yle.fromBufferAttribute(n,r),xle.fromBufferAttribute(n,i),ble.fromBufferAttribute(n,a),o.uv=Pr.getUV(Ele,yM,xM,bM,yle,xle,ble,new Te));let e={a:r,b:i,c:a,normal:new q,materialIndex:0};Pr.getNormal(yM,xM,bM,e.normal),o.face=e,o.faceIndex=r}return o}function l5(e,t,n,r,i){let a=3*r,s=e.index.getX(a),o=e.index.getX(a+1),l=e.index.getX(a+2),h=ast(n,e.attributes.position,e.attributes.uv,s,o,l,t);return h?(h.faceIndex=r,i&&i.push(h),h):null}function _le(e,t,n,r,i,a){for(let s=r,o=r+i;s<o;s++)l5(e,t,n,s,a)}function Tle(e,t,n,r,i){let a=1/0,s=null;for(let o=r,l=r+i;o<l;o++){let r=l5(e,t,n,o);r&&r.distance<a&&(s=r,a=r.distance)}return s}function c5(e,t,n){return null===e||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(n.ray.origin),e.object=t,e.distance<n.near||e.distance>n.far)?null:e}function Co(e,t,n,r){let i=e.a,a=e.b,s=e.c,o=t,l=t+1,h=t+2;n&&(o=n.getX(t),l=n.getX(t+1),h=n.getX(t+2)),i.x=r.getX(o),i.y=r.getY(o),i.z=r.getZ(o),a.x=r.getX(l),a.y=r.getY(l),a.z=r.getZ(l),s.x=r.getX(h),s.y=r.getY(h),s.z=r.getZ(h)}function u5(e,t,n,r,i,a,s){let o=n.index,l=n.attributes.position;for(let n=e,h=t+e;n<h;n++)if(Co(s,3*n,o,l),s.needsUpdate=!0,r(s,n,i,a))return!0;return!1}var Ag=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function cu(e,t){return 65535===t[e+15]}function Rd(e,t){return t[e+6]}function Cg(e,t){return t[e+14]}function Rg(e){return e+8}function Pg(e,t){return t[e+6]}function Sle(e,t){return t[e+7]}var Ig=new Ft,_M=new q,lst=["x","y","z"];function TM(e,t,n,r,i){let a=2*e,s=Dg,o=vh,l=yh;if(cu(a,o)){_le(t,n,r,Rd(e,l),Cg(a,o),i)}else{let a=Rg(e);wM(a,s,r,_M)&&TM(a,t,n,r,i);let o=Pg(e,l);wM(o,s,r,_M)&&TM(o,t,n,r,i)}}function SM(e,t,n,r){let i=2*e,a=Dg,s=vh,o=yh;if(cu(i,s)){return Tle(t,n,r,Rd(e,o),Cg(i,s))}{let i,s,l=Sle(e,o),h=lst[l],u=r.direction[h]>=0;u?(i=Rg(e),s=Pg(e,o)):(i=Pg(e,o),s=Rg(e));let c=wM(i,a,r,_M)?SM(i,t,n,r):null;if(c){let e=c.point[h];if(u?e<=a[s+l]:e>=a[s+l+3])return c}let d=wM(s,a,r,_M)?SM(s,t,n,r):null;return c&&d?c.distance<=d.distance?c:d:c||d||null}}var wle=function(){let e,t,n=[],r=new Ag((()=>new Ft));return function(...a){e=r.getPrimitive(),t=r.getPrimitive(),n.push(e,t);let s=i(...a);r.releasePrimitive(e),r.releasePrimitive(t),n.pop(),n.pop();let o=n.length;return o>0&&(t=n[o-1],e=n[o-2]),s};function i(n,r,a,s,o=null,l=0,h=0){function u(e){let t=2*e,n=vh,r=yh;for(;!cu(t,n);)t=2*(e=Rg(e));return Rd(e,r)}function c(e){let t=2*e,n=vh,r=yh;for(;!cu(t,n);)t=2*(e=Pg(e,r));return Rd(e,r)+Cg(t,n)}let d=2*n,p=Dg,f=vh,m=yh;if(cu(d,f)){let t=Rd(n,m),r=Cg(d,f);return Ao(n,p,e),s(t,r,!1,h,l+n,e)}{let d,g,v,y,x=Rg(n),b=Pg(n,m),_=x,w=b;if(o&&(v=e,y=t,Ao(_,p,v),Ao(w,p,y),d=o(v),g=o(y),g<d)){_=b,w=x;let e=d;d=g,g=e,v=y}v||(v=e,Ao(_,p,v));let S,M=a(v,cu(2*_,f),d,h+1,l+_);if(2===M){let e=u(_);S=s(e,c(_)-e,!0,h+1,l+_,v)}else S=M&&i(_,r,a,s,o,l,h+1);if(S)return!0;y=t,Ao(w,p,y);let T,E=a(y,cu(2*w,f),g,h+1,l+w);if(2===E){let e=u(w);T=s(e,c(w)-e,!0,h+1,l+w,y)}else T=E&&i(w,r,a,s,o,l,h+1);return!!T}}}(),Mle=function(){let e=new _a,t=new _a,n=new At,r=new Ta,i=new Ta;return function a(s,o,l,h,u=null){let c=2*s,d=Dg,p=vh,f=yh;if(null===u&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,h),u=r),!cu(c,p)){let e=s+8,t=f[s+6];return Ao(e,d,Ig),!!(u.intersectsBox(Ig)&&a(e,o,l,h,u)||(Ao(t,d,Ig),u.intersectsBox(Ig)&&a(t,o,l,h,u)))}{let r=o,a=r.index,u=r.attributes.position,m=l.index,g=l.attributes.position,v=Rd(s,f),y=Cg(c,p);if(n.copy(h).invert(),l.boundsTree)return Ao(s,d,i),i.matrix.copy(n),i.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>i.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(h),e.b.applyMatrix4(h),e.c.applyMatrix4(h),e.needsUpdate=!0;for(let n=3*v,r=3*(y+v);n<r;n+=3)if(Co(t,n,a,u),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(let r=3*v,i=y+3*v;r<i;r+=3){Co(e,r,a,u),e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let n=0,r=m.count;n<r;n+=3)if(Co(t,n,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function wM(e,t,n,r){return Ao(e,t,Ig),n.intersectBox(Ig,r)}var h5=[],EM,Dg,vh,yh;function Og(e){EM&&h5.push(EM),EM=e,Dg=new Float32Array(e),vh=new Uint16Array(e),yh=new Uint32Array(e)}function Ny(){EM=null,Dg=null,vh=null,yh=null,h5.length&&Og(h5.pop())}var f5=Symbol("skip tree generation"),d5=new Ft,p5=new Ft,Lg=new At,Pd=new Ta,By=new Ta,Uy=new q,MM=new q,cst=new q,ust=new q,hst=new q,Ale=new Ft,ec=new Ag((()=>new _a)),dl=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),dl.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t=oi({cloneBuffers:!0},t);let n,r=e.geometry,i=e._roots,a=r.getIndex();return n=t.cloneBuffers?{roots:i.map((e=>e.slice())),index:a.array.slice()}:{roots:i,index:a.array},n}static deserialize(e,t,n={}){if("boolean"==typeof n)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),dl.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});n=oi({setIndex:!0},n);let{index:r,roots:i}=e,a=new dl(t,Ki(oi({},n),{[f5]:!0}));if(a._roots=i,n.setIndex){let n=t.getIndex();if(null===n){let n=new vn(e.index,1,!1);t.setIndex(n)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[f5]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[f5]||(this._roots=gle(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ft))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t,n,r,i,a=this.geometry,s=a.index.array,o=a.attributes.position,l=0,h=this._roots;for(let e=0,a=h.length;e<a;e++)t=h[e],n=new Uint32Array(t),r=new Uint16Array(t),i=new Float32Array(t),u(0,l),l+=t.byteLength;function u(t,a,l=!1){let h=2*t;if(65535===r[h+15]){let e=n[t+6],a=1/0,l=1/0,u=1/0,c=-1/0,d=-1/0,p=-1/0;for(let t=3*e,n=3*(e+r[h+14]);t<n;t++){let e=s[t],n=o.getX(e),r=o.getY(e),i=o.getZ(e);n<a&&(a=n),n>c&&(c=n),r<l&&(l=r),r>d&&(d=r),i<u&&(u=i),i>p&&(p=i)}return(i[t+0]!==a||i[t+1]!==l||i[t+2]!==u||i[t+3]!==c||i[t+4]!==d||i[t+5]!==p)&&(i[t+0]=a,i[t+1]=l,i[t+2]=u,i[t+3]=c,i[t+4]=d,i[t+5]=p,!0)}{let r=t+8,s=n[t+6],o=r+a,h=s+a,c=l,d=!1,p=!1;e?c||(d=e.has(o),p=e.has(h),c=!d&&!p):(d=!0,p=!0);let f=c||p,m=!1;(c||d)&&(m=u(r,a,c));let g=!1;f&&(g=u(s,a,c));let v=m||g;if(v)for(let e=0;e<3;e++){let n=r+e,a=s+e,o=i[n],l=i[n+3],h=i[a],u=i[a+3];i[t+e]=o<h?o:h,i[t+e+3]=l>u?l:u}return v}}}traverse(e,t=0){let n=this._roots[t],r=new Uint32Array(n),i=new Uint16Array(n);!function t(a,s=0){let o=2*a,l=65535===i[o+15];if(l){let t=r[a+6],h=i[o+14];e(s,l,new Float32Array(n,4*a,6),t,h)}else{let i=a+8,o=r[a+6],h=r[a+7];e(s,l,new Float32Array(n,4*a,6),h)||(t(i,s+1),t(o,s+1))}}(0)}raycast(e,t=Os){let n=this._roots,r=this.geometry,i=[],a=t.isMaterial,s=Array.isArray(t),o=r.groups,l=a?t.side:t;for(let a=0,h=n.length;a<h;a++){let h=s?t[o[a].materialIndex].side:l,u=i.length;if(Og(n[a]),TM(0,r,h,e,i),Ny(),s){let e=o[a].materialIndex;for(let t=u,n=i.length;t<n;t++)i[t].face.materialIndex=e}}return i}raycastFirst(e,t=Os){let n=this._roots,r=this.geometry,i=t.isMaterial,a=Array.isArray(t),s=null,o=r.groups,l=i?t.side:t;for(let i=0,h=n.length;i<h;i++){let h=a?t[o[i].materialIndex].side:l;Og(n[i]);let u=SM(0,r,h,e);Ny(),null!=u&&(null==s||u.distance<s.distance)&&(s=u,a&&(u.face.materialIndex=o[i].materialIndex))}return s}intersectsGeometry(e,t){let n=this.geometry,r=!1;for(let i of this._roots)if(Og(i),r=Mle(0,n,e,t),Ny(),r)break;return r}shapecast(e,t,n){let r=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,n,r,i)=>{let a=3*n;return e(t,a,a+1,a+2,r,i)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let i=ec.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:s,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let e=o;o=(t,n,a,s,o)=>!!e(t,n,a,s,o)||u5(t,n,r,l,a,s,i)}else o||(o=l?(e,t,n,a)=>u5(e,t,r,l,n,a,i):(e,t,n)=>n);let h=!1,u=0;for(let e of this._roots){if(Og(e),h=wle(0,r,s,o,a,u),Ny(),h)break;u+=e.byteLength}return ec.releasePrimitive(i),h}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:i}=n,a=this.geometry.index,s=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Lg.copy(t).invert();let h=ec.getPrimitive(),u=ec.getPrimitive();if(i){let e=function(e,n,r,c,d,p,f,m){for(let g=r,v=r+c;g<v;g++){Co(u,3*g,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=e,r=e+n;t<r;t++)if(Co(h,3*t,a,s),h.needsUpdate=!0,i(h,u,t,g,d,p,f,m))return!0}return!1};if(r){let t=r;r=function(n,r,i,a,s,o,l,h){return!!t(n,r,i,a,s,o,l,h)||e(n,r,i,a,s,o,l,h)}}else r=e}e.getBoundingBox(p5),p5.applyMatrix4(t);let c=this.shapecast({intersectsBounds:e=>p5.intersectsBox(e),intersectsRange:(t,n,i,a,s,o)=>(d5.copy(o),d5.applyMatrix4(Lg),e.shapecast({intersectsBounds:e=>d5.intersectsBox(e),intersectsRange:(e,i,o,l,h)=>r(t,n,e,i,a,s,l,h)}))});return ec.releasePrimitive(h),ec.releasePrimitive(u),c}intersectsBox(e,t){return Pd.set(e.min,e.max,t),Pd.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Pd.intersectsBox(e),intersectsTriangle:e=>Pd.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},i=0,a=1/0){e.boundingBox||e.computeBoundingBox(),Pd.set(e.boundingBox.min,e.boundingBox.max,t),Pd.needsUpdate=!0;let s=this.geometry,o=s.attributes.position,l=s.index,h=e.attributes.position,u=e.index,c=ec.getPrimitive(),d=ec.getPrimitive(),p=MM,f=cst,m=null,g=null;r&&(m=ust,g=hst);let v=1/0,y=null,x=null;return Lg.copy(t).invert(),By.matrix.copy(Lg),this.shapecast({boundsTraverseOrder:e=>Pd.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a&&(t&&(By.min.copy(e.min),By.max.copy(e.max),By.needsUpdate=!0),!0),intersectsRange:(n,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>By.distanceToBox(e),intersectsBounds:(e,t,n)=>n<v&&n<a,intersectsRange:(e,a)=>{for(let s=3*e,b=3*(e+a);s<b;s+=3){Co(d,s,u,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let e=3*n,t=3*(n+r);e<t;e+=3){Co(c,e,l,o),c.needsUpdate=!0;let t=c.distanceToTriangle(d,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,x=s/3),t<i)return!0}}}});for(let e=0,a=u?u.count:h.count;e<a;e+=3){Co(d,e,u,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=3*n,a=3*(n+r);t<a;t+=3){Co(c,t,l,o),c.needsUpdate=!0;let n=c.distanceToTriangle(d,p,m);if(n<v&&(f.copy(p),g&&g.copy(m),v=n,y=t/3,x=e/3),n<i)return!0}}}}),ec.releasePrimitive(c),ec.releasePrimitive(d),v===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=v,n.faceIndex=y,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(Lg),f.applyMatrix4(Lg),r.distance=f.sub(r.point).length(),r.faceIndex=x),n)}closestPointToPoint(e,t={},n=0,r=1/0){let i=n*n,a=r*r,s=1/0,o=null;if(this.shapecast({boundsTraverseOrder:t=>(Uy.copy(e).clamp(t.min,t.max),Uy.distanceToSquared(e)),intersectsBounds:(e,t,n)=>n<s&&n<a,intersectsTriangle:(t,n)=>{t.closestPointToPoint(e,Uy);let r=e.distanceToSquared(Uy);return r<s&&(MM.copy(Uy),s=r,o=n),r<i}}),s===1/0)return null;let l=Math.sqrt(s);return t.point?t.point.copy(MM):t.point=MM.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{Ao(0,new Float32Array(t),Ale),e.union(Ale)})),e}},m5=new _o,Cle=new At,fst=Jt.prototype.raycast;function g5(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;Cle.copy(this.matrixWorld).invert(),m5.copy(e.ray).applyMatrix4(Cle);let n=this.geometry.boundsTree;if(!0===e.firstHitOnly){let r=c5(n.raycastFirst(m5,this.material),this,e);r&&t.push(r)}else{let r=n.raycast(m5,this.material);for(let n=0,i=r.length;n<i;n++){let i=c5(r[n],this,e);i&&t.push(i)}}}else fst.call(this,e,t)}var Rle=new At,kg=new _o,v5=new ir,xh=new q,bh=new q,Eh=new q,y5=new q,x5=new q,b5=new q,AM=new q,CM=new q,RM=new q,PM=new Te,IM=new Te,DM=new Te,E5=new q,OM=new q;function dst(e,t,n,r,i,a,s,o){let l;if(l=t.side===zi?r.intersectTriangle(s,a,i,!0,o):r.intersectTriangle(i,a,s,t.side!==Mr,o),null===l)return null;OM.copy(o),OM.applyMatrix4(e.matrixWorld);let h=n.ray.origin.distanceTo(OM);return h<n.near||h>n.far?null:{distance:h,point:OM.clone(),object:e}}function LM(e,t,n,r,i,a,s,o,l,h,u,c){xh.fromBufferAttribute(i,h),bh.fromBufferAttribute(i,u),Eh.fromBufferAttribute(i,c);let d=e.morphTargetInfluences;if(a&&d){AM.set(0,0,0),CM.set(0,0,0),RM.set(0,0,0);for(let e=0,t=a.length;e<t;e++){let t=d[e],n=a[e];0!==t&&(y5.fromBufferAttribute(n,h),x5.fromBufferAttribute(n,u),b5.fromBufferAttribute(n,c),s?(AM.addScaledVector(y5,t),CM.addScaledVector(x5,t),RM.addScaledVector(b5,t)):(AM.addScaledVector(y5.sub(xh),t),CM.addScaledVector(x5.sub(bh),t),RM.addScaledVector(b5.sub(Eh),t)))}xh.add(AM),bh.add(CM),Eh.add(RM)}e.isSkinnedMesh&&(e.boneTransform(h,xh),e.boneTransform(u,bh),e.boneTransform(c,Eh));let p=dst(e,t,n,r,xh,bh,Eh,E5);if(p){o&&(PM.fromBufferAttribute(o,h),IM.fromBufferAttribute(o,u),DM.fromBufferAttribute(o,c),p.uv=Pr.getUV(E5,xh,bh,Eh,PM,IM,DM,new Te)),l&&(PM.fromBufferAttribute(l,h),IM.fromBufferAttribute(l,u),DM.fromBufferAttribute(l,c),p.uv2=Pr.getUV(E5,xh,bh,Eh,PM,IM,DM,new Te));let e={a:h,b:u,c:c,normal:new q,materialIndex:0};Pr.getNormal(xh,bh,Eh,e.normal),p.face=e}return p}Jt.prototype.raycast=function(e,t){let n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r||(null===n.boundingSphere&&n.computeBoundingSphere(),v5.copy(n.boundingSphere),v5.applyMatrix4(i),!1===e.ray.intersectsSphere(v5))||(Rle.copy(i).invert(),kg.copy(e.ray).applyMatrix4(Rle),null!==n.boundingBox&&!1===kg.intersectsBox(n.boundingBox)))return;let a,s=n.index,o=n.attributes.position,l=n.morphAttributes.position,h=n.morphTargetsRelative,u=n.attributes.uv,c=n.attributes.uv2,d=n.groups,p=n.drawRange;if(null!==s)if(Array.isArray(r))for(let n=0,i=d.length;n<i;n++){let i=d[n],f=r[i.materialIndex];for(let n=Math.max(i.start,p.start),r=Math.min(s.count,Math.min(i.start+i.count,p.start+p.count));n<r;n+=3){let r=s.getX(n),d=s.getX(n+1),p=s.getX(n+2);a=LM(this,f,e,kg,o,l,h,u,c,r,d,p),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=i.materialIndex,t.push(a))}}else{for(let n=Math.max(0,p.start),i=Math.min(s.count,p.start+p.count);n<i;n+=3){let i=s.getX(n),d=s.getX(n+1),p=s.getX(n+2);a=LM(this,r,e,kg,o,l,h,u,c,i,d,p),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}else if(void 0!==o)if(Array.isArray(r))for(let n=0,i=d.length;n<i;n++){let i=d[n],s=r[i.materialIndex];for(let n=Math.max(i.start,p.start),r=Math.min(o.count,Math.min(i.start+i.count,p.start+p.count));n<r;n+=3){a=LM(this,s,e,kg,o,l,h,u,c,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=i.materialIndex,t.push(a))}}else{for(let n=Math.max(0,p.start),i=Math.min(o.count,p.start+p.count);n<i;n+=3){a=LM(this,r,e,kg,o,l,h,u,c,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}}},Jt.prototype.raycast=g5;var kM=new ir,FM=new q;function Ple(e,t,n,r,i,a){let s=r.ray.distanceSqToPoint(e);if(s<n){let n=new q;r.ray.closestPointToPoint(e,n);let o=r.ray.origin.distanceTo(n);if(o<r.near||o>r.far)return;i.push({distance:o,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}Ni.prototype.raycast=function(e,t){let n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),kM.copy(n.boundingSphere),kM.applyMatrix4(r),kM.radius+=i,!1===e.ray.intersectsSphere(kM))return;let s=i*i,o=n.index,l=n.attributes.position,h=t.length;if(null!==o){for(let n=Math.max(0,a.start),i=Math.min(o.count,a.start+a.count);n<i;n++){let i=o.getX(n);if(FM.fromBufferAttribute(l,i).applyMatrix4(r),Ple(FM,i,s,e,t,this),t.length-h>=1)return}}else{for(let n=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count);n<i;n++)if(FM.fromBufferAttribute(l,n).applyMatrix4(r),Ple(FM,n,s,e,t,this),t.length-h>=1)return}};var Ile=class{constructor(e){let t=new Promise(((e,t)=>{this.cancelReject=t}));this.promise=Promise.race([t,e])}cancel(){this.cancelReject&&this.cancelReject({type:"cancel"})}},pst=ca(Ole(),1),fe=pst;fe.setLevel("warn");var Lle=e=>{try{fe.setLevel(e)}catch(e){fe.setLevel("error"),fe.error(e)}},_5=class{static isTouchScreenDevice(){return"ontouchstart"in window}static printDeviceInfo(){let e=navigator.userAgent,t=/(?:Android)/.test(e),n=/(?:Firefox)/.test(e),r=/(?:Chrome|CriOS)/.test(e),i=/(?:iPad|PlayBook)/.test(e)||t&&!/(?:Mobile)/.test(e)||n&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!i,s=!a&&!t,o=_5.isTouchScreenDevice();t&&fe.debug("[DI] is android"),n&&fe.debug("[DI] is fireFox"),r&&fe.debug("[DI] is chrome"),i&&fe.debug("[DI] is tablet"),a&&fe.debug("[DI] is iPhone"),s&&fe.debug("[DI] is PC"),o&&fe.debug("[DI] is touch device")}static creatReactNativeCanvas(e){let t=e.drawingBufferWidth||e.width||0,n=e.drawingBufferHeight||e.height||0;return{style:{},width:t,height:n,clientWidth:Math.ceil(t/(window.devicePixelRatio||1)),clientHeight:Math.ceil(n/(window.devicePixelRatio||1)),addEventListener:()=>{},removeEventListener:()=>{}}}},Bn=_5;Bn.isMobile=/mobile/i.test(navigator.userAgent),Bn.isBrowser="undefined"!=typeof document,Bn.isNode="undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process);var Hy=class{static isFullScreen(){return!(!document.fullscreenElement&&!document.mozFullScreenElement)}static fullScreen(e=document.documentElement){(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen).call(e)}static exitFullscreen(){(document.exitFullscreen||document.mozCancelFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document)}static joinStrings(...e){return e.join("")}static numberToString(e){let t=2;return Math.abs(e)<1e-6?t=2:Math.abs(e)<1e-5?t=7:Math.abs(e)<1e-4?t=6:Math.abs(e)<.001?t=5:Math.abs(e)<.01?t=4:Math.abs(e)<.1&&(t=3),e.toFixed(t)}static byteCountToString(e){let t=e;return e>1e9?(t=e/1e9,this.numberToString(t)+" G"):e>1e6?(t=e/1e6,this.numberToString(t)+" M"):e>1e3?(t=e/1e3,this.numberToString(t)+" K"):this.numberToString(t)}static hexToBase64(e){return btoa((e.match(/\w{2}/g)||[]).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))}static vectorToString(e){return Array.isArray(e)?`(${this.numberToString(e[0])}, ${this.numberToString(e[1])}, ${this.numberToString(e[2])})`:e instanceof q?`(${this.numberToString(e.x)}, ${this.numberToString(e.y)}, ${this.numberToString(e.z)})`:`(${this.numberToString(e.x)}, ${this.numberToString(e.y)})`}static arrayToVector2(e){return e?e instanceof Te?e:Array.isArray(e)&&e.length>=2?new Te(e[0],e[1]):void 0:e}static arrayToVector3(e){return e?e instanceof q?e:Array.isArray(e)&&e.length>=2?new q(e[0],e[1],e.length>2?e[2]:0):void 0:e}static arrayToEuler(e){return e?e instanceof Fi?e:Array.isArray(e)&&e.length>=3?new Fi(e[0],e[1],e[2]):void 0:e}static arrayOrObjectToVector3(e){if(!e)return e;if(e instanceof q)return e;if(e instanceof Te)return new q(e.x,e.y,0);if(Array.isArray(e)&&e.length>=2)return new q(e[0],e[1],e[2]||0);let t=e;return null!=t.x&&null!=t.y?new q(t.x,t.y,t.z||0):void 0}static isVectorValid(e){let t=e&&!isNaN(e.x)&&!isNaN(e.y)&&isFinite(e.x)&&isFinite(e.y);return t&&e instanceof q&&(t=!isNaN(e.z)&&isFinite(e.z)),t}static isBoxValid(e){return e&&!e.isEmpty()&&this.isVectorValid(e.min)&&this.isVectorValid(e.max)}static isMatrixValid(e){let t=e&&e.elements;if(!t||t.length<16)return!1;for(let e=0;e<16;++e){let n=t[e];if(Number.isNaN(n))return!1}return!0}static guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static expandBoxByScale(e,t){let n=new q;e.getCenter(n);let r=(e.max.x-e.min.x)*t,i=(e.max.y-e.min.y)*t,a=(e.max.z-e.min.z)*t,s=new q(n.x-r/2,n.y-i/2,n.z-a/2),o=new q(n.x+r/2,n.y+i/2,n.z+a/2);e.set(s,o)}static expandBoxByMinSize(e,t){let n=new q;e.getCenter(n);let r=e.max.x-e.min.x,i=e.max.y-e.min.y,a=e.max.z-e.min.z;r<t&&(e.min.setX(n.x-t/2),e.max.setX(n.x+t/2)),i<t&&(e.min.setY(n.y-t/2),e.max.setY(n.y+t/2)),a<t&&(e.min.setZ(n.z-t/2),e.max.setZ(n.z+t/2))}static generateRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}static convertDecimalToHex(e){return null==e?"#ffffff":`#${e.toString(16).padStart(6,"0")}`}static canvasToImage(e){let t=e.toDataURL(),n=new Image;return n.src=t,new Promise((e=>{n.onload=function(){e(n)}}))}static renderingContextToImage(e,t,n="image/png",r=.8){if(t){let i=Math.max(t.min.x,0),a=Math.max(t.min.y,0),s=Math.max(t.max.x-i,0),o=Math.max(t.max.y-a,0),l=e.getImageData(i,a,s,o),h=document.createElement("canvas");return h.width=s,h.height=o,h.getContext("2d").putImageData(l,0,0),h.toDataURL(n,r)}return e.canvas.toDataURL(n,r)}static printMemory(e){if(!Bn.isBrowser)return;let t=performance.memory;if(!t)return void fe.warn("[Util] performance.memory is not available in this browser");let n=(t.jsHeapSizeLimit/1048576).toFixed(2),r=(t.totalJSHeapSize/1048576).toFixed(2),i=(t.usedJSHeapSize/1048576).toFixed(2);fe.info(`[Util] ${e}. jsHeapSizeLimit: ${n}M , totalJSHeapSize: ${r}M , usedJSHeapSize: ${i}M `)}static printGpuInfo(e){if(!Bn.isBrowser)return;let t=e.getExtension("webgl_debug_renderer_info"),n=e.getParameter(t.UNMASKED_RENDERER_WEBGL);fe.info("[Util] gpu:",n)}static getExtension(e){return e.substring(e.lastIndexOf(".")+1)}static isBinaryFile(e){return"bin"===Hy.getExtension(e)}static isGizp(e){return!(e.length<=3)&&(31==e[0]&&139==e[1]&&8==e[2])}static sleep(e){return Et(this,null,(function*(){let t;return new Promise((n=>{t=setTimeout((()=>{n("")}),e)})).then((()=>{clearTimeout(t)}))}))}static twinkle(e,t=500){return Et(this,null,(function*(){let n=this.twinklingObjectIds;n[e.id]||(n[e.id]=!0,e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,delete n[e.id])}))}static getUpdateProgressFunc(e){return t=>{e&&e(new ProgressEvent("",{loaded:t,total:100}))}}static getUpdateProgressFuncAsync(e){let t=Date.now();return n=>Et(this,null,(function*(){if(e){e(new ProgressEvent("",{loaded:n,total:100}));let r=500,i=Date.now();i-t>r&&(yield Hy.sleep(0),t=i)}}))}static getUpdateProgressFuncForLoop(e,t){let n=Math.round(Math.pow(e,.5)),r=Date.now();return i=>Et(this,null,(function*(){if(t&&(i%n==0||i===e-1)){t(new ProgressEvent("",{loaded:i+1,total:e}));let n=500,a=Date.now();(a-r>n||i===e-1)&&(yield Hy.sleep(0),r=a)}}))}static getUpdateSubProgressFunc(e,t,n){let r=!1;return i=>{let a=100*i.loaded/i.total;a=a*(t-e)/100+e,a>t&&(r||(fe.warn("[Progress] Invalid ProgressEvent:",i),r=!0),a=t),n&&n(new ProgressEvent(i.type,{loaded:a,total:100}))}}},Ct=Hy;Ct.twinklingObjectIds={};var BM=(e,t,n)=>{let{default:r,active:i}=t;n?(e.remove(r),e.add(i||r)):(i&&e.remove(i),e.add(r))},cn=class{static color2rgba(e){let t,n=[0,0,0,1];if(t=/^(\w+)\(([^)]*)\)/.exec(e)){let r,i=t[1],a=t[2];switch(i){case"rgb":case"rgba":(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(n=[Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,Number(r[4]||1)]),(r=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(n=[Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,Number(r[4]||1)]);break;case"hsl":case"hsla":(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(n=[parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,Number(r[4]||1)]);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^#([A-Fa-f\d]+)$/.exec(e)){let r=t[1],i=r.length;if(3===i)n=[parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,1];else if(6===i){let e=parseInt(r,16);n=[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]}else console.warn("THREE.Color: Invalid hex color "+e)}return n}static rgba2Color(e){return`rgba(${this.to255(e[0])},${this.to255(e[1])},${this.to255(e[2])},${null!=e[3]?e[3]:1})`}static colorStr2Rgba(e){let t=e.replace("rgba(","");t=t.replace(")","");let n=t.split(","),r=[];return r.push(this.to1(parseInt(n[0]))),r.push(this.to1(parseInt(n[1]))),r.push(this.to1(parseInt(n[2]))),null!=n[3]&&r.push(parseFloat(n[3])),r}static rgb2Hex(e){return(this.to255(e[0])<<16)+(this.to255(e[1])<<8)+this.to255(e[2])}static to255(e){let t=Math.max(e,0);return t=Math.min(e,1),255*t}static to1(e){let t=Math.max(e,0);return t=Math.min(e,255),t/255}},mn=class{static getScreenCoordinateByEvent(e,t){let n=new Te,{left:r,top:i}=t.getBoundingClientRect();return n.x=e.clientX-r,n.y=e.clientY-i,n}static getScreenCoordinateByTouchEvent(e,t){let n=new Te,{left:r,top:i}=t.getBoundingClientRect();return n.x=e.touches[0].clientX-r,n.y=e.touches[0].clientY-i,n}static world2Screen(e,t,n){let{clientWidth:r,clientHeight:i}=n,a=e.clone(),s=new Te;return a.project(t),s.x=Math.round((.5+a.x/2)*r),s.y=Math.round((.5-a.y/2)*i),s}static worldBBox2Screen(e,t,n){let r=new Vr,i=e.min,a=e.max,s=(e,i,a)=>{let s=new q(e,i,a),o=this.world2Screen(s,t,n);r.expandByPoint(o)};return s(i.x,i.y,i.z),s(i.x,i.y,a.z),s(i.x,a.y,i.z),s(i.x,a.y,a.z),s(a.x,i.y,i.z),s(a.x,i.y,a.z),s(a.x,a.y,i.z),s(a.x,a.y,a.z),r}static screen2World(e,t,n){let r=mn.screen2Ndc(e,t,n);return new q(r.x,r.y,1).unproject(t)}static screen2Ndc(e,t,n){let{clientWidth:r,clientHeight:i}=n,a=new Te;return a.x=e.x/r*2-1,a.y=-e.y/i*2+1,a}static world2NormalizedScreen(e,t,n){let r=new q,i=e instanceof Te?0:e.z;r.set(e.x,e.y,i);let a=mn.world2Screen(r,t,n);return a.x/=n.clientWidth,a.y/=n.clientHeight,a}},Ng=class extends Cn{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Te(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}},Fg=new q,kle=new At,Fle=new At,Nle=new q,Ble=new q,Bg=class{constructor(e={}){let t,n,r,i,a=this,s={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function l(e){e.isCSS2DObject&&(e.element.style.display="none");for(let t=0,n=e.children.length;t<n;t++)l(e.children[t])}function h(e,t,n){if(!1!==e.visible){if(e.isCSS2DObject){Fg.setFromMatrixPosition(e.matrixWorld),Fg.applyMatrix4(Fle);let l=Fg.z>=-1&&Fg.z<=1&&!0===e.layers.test(n.layers),h=e.element;h.style.display=!0===l?"":"none",!0===l&&(e.onBeforeRender(a,t,n),h.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(Fg.x*r+r)+"px,"+(-Fg.y*i+i)+"px)",h.parentNode!==o&&o.appendChild(h),e.onAfterRender(a,t,n));let c={distanceToCameraSquared:u(n,e)};s.objects.set(e,c)}for(let r=0,i=e.children.length;r<i;r++)h(e.children[r],t,n)}else l(e)}function u(e,t){return Nle.setFromMatrixPosition(e.matrixWorld),Ble.setFromMatrixPosition(t.matrixWorld),Nle.distanceToSquared(Ble)}o.style.overflow="hidden",this.domElement=o,this.getSize=function(){return{width:t,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),kle.copy(t.matrixWorldInverse),Fle.multiplyMatrices(t.projectionMatrix,kle),h(e,e,t),function(e){let t=function(e){let t=[];return e.traverseVisible((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared})),n=t.length;for(let e=0,r=t.length;e<r;e++)t[e].element.style.zIndex=n-e}(e)},this.setSize=function(e,a){t=e,n=a,r=t/2,i=n/2,o.style.width=e+"px",o.style.height=a+"px"}}},UM=class{static createCSS2DObject(e){let t=new Ng(e);return e.dataset.objectId=t.id.toString(),t}static createDefaultHotpoint(e=12){let t=document.createElement("div"),n=t.style;return n.width=`${e}px`,n.height=`${e}px`,n.opacity="0.8",n.cursor="pointer",n.top=-e/2+"px",n.left=-e/2+"px",n.backgroundColor="#ffffff",n.border="2px solid #00DAB7",n.borderRadius="50%",this.createCSS2DObject(t)}static createHotpoint(e){if(e){let t=document.createElement("div"),n=t.style;return n.top="0px",n.left="0px",t.innerHTML=e,this.createCSS2DObject(t)}return this.createDefaultHotpoint()}static createLabel(e,t=""){let n=document.createElement("div");if(n.innerHTML=e,t)n.classList.add(t);else{let e=n.style;e.padding="5px 9px",e.color="#ffffffdd",e.fontSize="12px",e.position="absolute",e.backgroundColor="rgba(0, 0, 0, 0.3)",e.borderRadius="12px",e.cursor="pointer",e.top="0px",e.left="0px"}return this.createCSS2DObject(n)}static tryFindObjectId(e){if(null!=e.dataset.objectId)return parseInt(e.dataset.objectId);let t=e.parentElement;return!t||t instanceof HTMLBodyElement?void 0:this.tryFindObjectId(t)}},Ule={"Precision from file":99,"0(1)":0,"0.1(1/2)":1,"0.01(1/4)":2,"0.001(1/8)":3,"0.0001(1/16)":4,"0.00001(1/32)":5,"0.000001(1/64)":6},tc=(e,t)=>e.toFixed(t===Ule["Precision from file"]?2:t),is=!1,HM=10,ss=11,_h=12,Hle=583902,zCt=[.031,.906,.867,.5],qCt=[.3,.3,.3,.8],GCt=.5,VM=.1,zM=5e3,Vle=45,qM="dxf-viewer-iconfont",Th="dxf-viewer-iconfont2",GM=10,zle=new q,qle=new q,Gle=new q,Vy=new q,uu=new q,Wle=new Pr;function mst(e,t,n,r,i){let a,s,o,l,h,u,c=[],d={},p=Math.pow(10,4),f=0;for(h=0,u=e.length;h<u;h+=3)a=e[h],s=e[h+1],o=e[h+2],l=Math.round(a*p)+"_"+Math.round(s*p)+"_"+Math.round(o*p),d[l]||(d[l]=f/3,n[f++]=a,n[f++]=s,n[f++]=o),c[h/3]=d[l];for(h=0,u=t.length;h<u;h++)i[h]=c[t[h]],r[i[h]]=t[h]}function gst(e,t,n,r){for(let i=0,a=e;i<a;i+=3){let e=3*t[i],a=3*t[i+1],s=3*t[i+2];zle.set(n[e],n[e+1],n[e+2]),qle.set(n[a],n[a+1],n[a+2]),Gle.set(n[s],n[s+1],n[s+2]),Pr.getNormal(zle,qle,Gle,Vy),r.push({normal:Vy.clone()})}}var T5=[new q(1,0,0),new q(0,1,0),new q(0,0,1),new q(1,1,0),new q(0,1,1),new q(1,0,1),new q(1,1,1),new q(0,0,0)];function vst(e,t){return uu.addVectors(e,t),0===uu.x||0===uu.y||0===uu.z}var WM=class{static buildEdge(e,t,n=GM){let r=[],i=[],a=[];mst(e,t,r,i,a);let s=[];gst(t.length,a,r,s);let o,l,h,u,c,d,p,f,m,g,v=[],y=Math.cos(zr.DEG2RAD*n),x={},b=!1;for(let e=0,n=t.length;e<n;e+=3){let t=e/3;for(let n=0;n<3;n++)o=a[e+n],l=a[e+(n+1)%3],h=Math.min(o,l),u=Math.max(o,l),c=h+","+u,void 0===x[c]?x[c]={index1:h,index2:u,face1:t,face2:void 0}:x[c].face2=t}for(c in x)d=x[c],!(void 0!==d.face2&&(p=s[d.face1].normal,f=s[d.face2].normal,p.dot(f)>y))&&(m=i[d.index1],g=i[d.index2],(!b&&m>65535||g>65535)&&(b=!0),v.push(m),v.push(g));return b?new Uint32Array(v):new Uint16Array(v)}static buildBarycentrics(e){let t=e.getAttribute("position");if(!t||0===t.count)return console.warn(" no positions in geometry!"),!1;let n=Math.pow(10,4),r=Math.cos(20*zr.DEG2RAD),i=e.getIndex(),a=i?i.count:t.count,s=[0,0,0],o=new Array(3),l=T5.length,h=[];for(let e=0;e<t.count;e++)h.push({point:new q(1,1,1),inited:!1,barycentricIndex:-1});let u={},c={},d={},p={};for(let e=0;e<a;e+=3){i?(s[0]=i.getX(e),s[1]=i.getX(e+1),s[2]=i.getX(e+2)):(s[0]=e,s[1]=e+1,s[2]=e+2);let{a:a,b:l,c:h}=Wle;if(a.fromBufferAttribute(t,s[0]),l.fromBufferAttribute(t,s[1]),h.fromBufferAttribute(t,s[2]),Wle.getNormal(Vy),d[s[0]]?o[0]=d[s[0]]:(o[0]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,d[s[0]]=o[0]),d[s[1]]?o[1]=d[s[1]]:(o[1]=`${Math.round(l.x*n)},${Math.round(l.y*n)},${Math.round(l.z*n)}`,d[s[1]]=o[1]),d[s[2]]?o[2]=d[s[2]]:(o[2]=`${Math.round(h.x*n)},${Math.round(h.y*n)},${Math.round(h.z*n)}`,d[s[2]]=o[2]),o[0]===o[1]||o[1]===o[2]||o[2]===o[0]){fe.warn(" skip degenerate triangles in geometry!");continue}let f={a:s[0],b:s[1],c:s[2]};c[s[0]]||(c[s[0]]=[]),c[s[0]].push(f),c[s[1]]||(c[s[1]]=[]),c[s[1]].push(f),c[s[2]]||(c[s[2]]=[]),c[s[2]].push(f);for(let e=0;e<3;e++){let t=(e+1)%3,n=o[e],i=o[t],a=s[e],l=s[t];u[a]||(u[a]=new Set),u[a].add(l),u[l]||(u[l]=new Set),u[l].add(a);let h=`${n}_${i}`,c=`${i}_${n}`;if(c in p&&p[c]){if(p[c].outer){fe.warn(`[Edge] edge: ${c} is already outer!`);continue}Vy.dot(p[c].normal)<=r?p[c].outer=!0:p[c].find=!0}else h in p?fe.warn(`[Edge] ${h} has existed  in geometry!`):p[h]={startIndex:a,endIndex:l,normal:Vy.clone(),outer:!1,find:!1}}}for(let e in p)p[e]&&!p[e].find&&!p[e].outer&&(p[e].outer=!0);let f=[],m=[];for(let e in c)m.push(c[e]);let g=new Set;for(let e of m[0])g.add(e.a),g.add(e.b),g.add(e.c);let v=0;for(m.splice(v,1);;){let e=!1;for(let t=0;t<m.length&&!e;t++)for(let n of m[t])if(g.has(n.a)||g.has(n.b)||g.has(n.c)){v=t,e=!0;break}if(e){for(let e of m[v])g.add(e.a),g.add(e.b),g.add(e.c);if(m.splice(v,1),v=0,0===m.length){f.push(g);break}}else if(!e){if(f.push(g),!(m.length>0))break;g=new Set;for(let e of m[v])g.add(e.a),g.add(e.b),g.add(e.c);m.splice(v,1),v=0}}let y=new Set;for(let e=0;e<f.length;e++)f[e].forEach((e=>{y.has(e)?fe.warn(`[Edge] ${e} is already in positionIndexSet!`):y.add(e)}));let x=(e,t)=>{let n=!1,r=d[e];if(!r)return console.warn(`${e} is not in positionIndexHash!`),n;let i=d[t];if(!i)return console.warn(`${t} is not in positionIndexHash!`),n;let a=`${r}_${i}`;if(p[a])n=p[a].outer;else{let e=`${i}_${r}`;p[e]&&(n=p[e].outer)}return n},b=(e,t,n)=>{let r=[];return r.push(x(e,t)),r.push(x(t,n)),r.push(x(n,e)),r.filter((e=>!0===e)).length>=2},_=(e,t)=>{if(!u[e])return fe.warn(`[Edge] ${e} position isn't used!`),!0;let n=u[e];for(let r of n){let n=x(e,r),i=h[r];if(!i.inited)continue;let a=vst(t,i.point);if(n&&!a||!n&&a)return!1}let r=c[e];for(let n of r){let r=t,i=h[n.b],a=h[n.c];if(n.b===e?i=h[n.a]:n.c===e&&(a=h[n.a]),b(n.a,n.b,n.c)&&(i.inited&&r.equals(i.point)||a.inited&&r.equals(a.point)))return!1;if(i.inited&&a.inited&&(uu.addVectors(r,i.point),uu.add(a.point),uu.x+uu.y+uu.z<2))return!1}return!0},w=!1;for(let e=0;e<f.length;e++){let t=Array.from(f[e]);w=!1;let n=0,r=0;for(;r>=0;){n=t[r];let e=h[n].inited?h[n].barycentricIndex+1:0;for(;e<l&&!_(n,T5[e]);e++);if(e<l){if(h[n].inited=!0,h[n].barycentricIndex=e,h[n].point.copy(T5[e]),r==t.length-1){w=!0,fe.debug("[Edge]",h);break}r++}else h[n].inited=!1,r--}if(!w){fe.warn(`[Edge] no result: ${t}!`);break}}if(w){let t=[];for(let e=0;e<h.length;e++){h[e].inited||fe.warn(`[Edge] ${e} is not initialized !`);let n=0;n|=h[e].point.x,n|=h[e].point.y<<1,n|=h[e].point.z<<2,t.push(n)}let n=new oy(t,1,!1);e.setAttribute("barycentric",n)}else fe.warn("[Edge] No suitable barycentric found!");return w}},as=class{constructor(){this.map=new Map}addEventListener(e,t){let n=this.map.get(e);n||(n=new Set,this.map.set(e,n)),n.add(t)}dispatchEvent(e,t={}){let n=this.map.get(e);n&&[...n].forEach((e=>e(t)))}hasEventListener(e){return!!this.map.get(e)}removeEventListener(e,t){if(!e)return void this.map.clear();if(!t)return void this.map.delete(e);let n=this.map.get(e);n&&n.delete(t)}},ks=class{parse(e,t={}){if(t=Object.assign({decodeSpeed:5,encodeSpeed:5,encoderMethod:ks.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1},t),void 0===DracoEncoderModule)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");let n,r,i=e.geometry,a=DracoEncoderModule(),s=new a.Encoder;if(!0===e.isMesh){n=new a.MeshBuilder,r=new a.Mesh;let e=i.getAttribute("position");n.AddFloatAttributeToMesh(r,a.POSITION,e.count,e.itemSize,e.array);let s=i.getIndex();if(null!==s)n.AddFacesToMesh(r,s.count/3,s.array);else{let t=new(e.count>65535?Uint32Array:Uint16Array)(e.count);for(let e=0;e<t.length;e++)t[e]=e;n.AddFacesToMesh(r,e.count,t)}if(!0===t.exportNormals){let e=i.getAttribute("normal");void 0!==e&&n.AddFloatAttributeToMesh(r,a.NORMAL,e.count,e.itemSize,e.array)}if(!0===t.exportUvs){let e=i.getAttribute("uv");void 0!==e&&n.AddFloatAttributeToMesh(r,a.TEX_COORD,e.count,e.itemSize,e.array)}if(!0===t.exportColor){let e=i.getAttribute("color");if(void 0!==e){let t=jle(e);n.AddFloatAttributeToMesh(r,a.COLOR,e.count,e.itemSize,t)}}}else{if(!0!==e.isPoints)throw new Error("DRACOExporter: Unsupported object type.");{n=new a.PointCloudBuilder,r=new a.PointCloud;let e=i.getAttribute("position");if(n.AddFloatAttribute(r,a.POSITION,e.count,e.itemSize,e.array),!0===t.exportColor){let e=i.getAttribute("color");if(void 0!==e){let t=jle(e);n.AddFloatAttribute(r,a.COLOR,e.count,e.itemSize,t)}}}}let o,l=new a.DracoInt8Array,h=void 0!==t.encodeSpeed?t.encodeSpeed:5,u=void 0!==t.decodeSpeed?t.decodeSpeed:5;if(s.SetSpeedOptions(h,u),void 0!==t.encoderMethod&&s.SetEncodingMethod(t.encoderMethod),void 0!==t.quantization)for(let e=0;e<5;e++)void 0!==t.quantization[e]&&s.SetAttributeQuantization(e,t.quantization[e]);if(o=!0===e.isMesh?s.EncodeMeshToDracoBuffer(r,l):s.EncodePointCloudToDracoBuffer(r,!0,l),a.destroy(r),0===o)throw new Error("THREE.DRACOExporter: Draco encoding failed.");let c=new Int8Array(new ArrayBuffer(o));for(let e=0;e<o;e++)c[e]=l.GetValue(e);return a.destroy(l),a.destroy(s),a.destroy(n),c}},zy,S5,Ug,jM;function jle(e){let t=new Ot,n=e.count,r=e.itemSize,i=new Float32Array(n*r);for(let a=0,s=n;a<s;a++)t.fromBufferAttribute(e,a).convertLinearToSRGB(),i[a*r]=t.r,i[a*r+1]=t.g,i[a*r+2]=t.b,4===r&&(i[a*r+3]=e.getW(a));return i}function XM(e,t=1/0,n=null){S5||(S5=new ys(2,2,1,1)),Ug||(Ug=new fr({uniforms:{blitTexture:new Td(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"})),Ug.uniforms.blitTexture.value=e,Ug.defines.IS_SRGB=e.colorSpace==yi,Ug.needsUpdate=!0,jM||((jM=new Jt(S5,Ug)).frustumCulled=!1);let r=new ui,i=new ea;i.add(jM),null===n&&(n=zy=new hl({antialias:!1}));let a=Math.min(e.image.width,t),s=Math.min(e.image.height,t);n.setSize(a,s),n.clear(),n.render(i,r);let o=document.createElement("canvas"),l=o.getContext("2d");o.width=a,o.height=s,l.drawImage(n.domElement,0,0,a,s);let h=new ud(o);return h.minFilter=e.minFilter,h.magFilter=e.magFilter,h.wrapS=e.wrapS,h.wrapT=e.wrapT,h.name=e.name,zy&&(zy.forceContextLoss(),zy.dispose(),zy=null),h}ks.MESH_EDGEBREAKER_ENCODING=1,ks.MESH_SEQUENTIAL_ENCODING=0,ks.POINT_CLOUD=0,ks.TRIANGULAR_MESH=1,ks.INVALID=-1,ks.POSITION=0,ks.NORMAL=1,ks.COLOR=2,ks.TEX_COORD=3,ks.GENERIC=4;var Xle={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]},Hg=class{constructor(){this.pluginCallbacks=[],this.register((function(e){return new C5(e)})),this.register((function(e){return new R5(e)})),this.register((function(e){return new O5(e)})),this.register((function(e){return new L5(e)})),this.register((function(e){return new k5(e)})),this.register((function(e){return new F5(e)})),this.register((function(e){return new P5(e)})),this.register((function(e){return new I5(e)})),this.register((function(e){return new D5(e)})),this.register((function(e){return new N5(e)})),this.register((function(e){return new B5(e)})),this.register((function(e){return new U5(e)})),this.register((function(e){return new H5(e)})),this.register((function(e){return new V5(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i=new A5,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](i));i.setPlugins(a),i.write(e,t,r).catch(n)}parseAsync(e,t){let n=this;return new Promise((function(r,i){n.parse(e,r,i,t)}))}},Qn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},w5="KHR_mesh_quantization",Xa={};Xa[Li]=Qn.NEAREST,Xa[Dy]=Qn.NEAREST_MIPMAP_NEAREST,Xa[lh]=Qn.NEAREST_MIPMAP_LINEAR,Xa[Dr]=Qn.LINEAR,Xa[Jf]=Qn.LINEAR_MIPMAP_NEAREST,Xa[Eo]=Qn.LINEAR_MIPMAP_LINEAR,Xa[xa]=Qn.CLAMP_TO_EDGE,Xa[td]=Qn.REPEAT,Xa[nd]=Qn.MIRRORED_REPEAT;var Yle={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},yst=new Ot,$le=12,xst=1179937895,bst=2,Zle=8,Est=1313821514,_st=5130562;function qy(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function Tst(e){return(new TextEncoder).encode(e).buffer}function Sst(e){return qy(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function wst(e,t,n){let r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+n;i++)for(let t=0;t<e.itemSize;t++){let n;e.itemSize>4?n=e.array[i*e.itemSize+t]:(0===t?n=e.getX(i):1===t?n=e.getY(i):2===t?n=e.getZ(i):3===t&&(n=e.getW(i)),!0===e.normalized&&(n=zr.normalize(n,e.array))),r.min[t]=Math.min(r.min[t],n),r.max[t]=Math.max(r.max[t],n)}return r}function Qle(e){return 4*Math.ceil(e/4)}function M5(e,t=0){let n=Qle(e.byteLength);if(n!==e.byteLength){let r=new Uint8Array(n);if(r.set(new Uint8Array(e)),0!==t)for(let i=e.byteLength;i<n;i++)r[i]=t;return r.buffer}return e}function Kle(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function Jle(e,t){if(void 0!==e.toBlob)return new Promise((n=>e.toBlob(n,t)));let n;return"image/jpeg"===t?n=.92:"image/webp"===t&&(n=.8),e.convertToBlob({type:t,quality:n})}var A5=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+Eg}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t){return Et(this,arguments,(function*(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),yield Promise.all(this.pending);let r=this,i=r.buffers,a=r.json;n=r.options;let s=r.extensionsUsed,o=r.extensionsRequired,l=new Blob(i,{type:"application/octet-stream"}),h=Object.keys(s),u=Object.keys(o);if(h.length>0&&(a.extensionsUsed=h),u.length>0&&(a.extensionsRequired=u),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===n.binary){let e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){let n=M5(e.result),r=new DataView(new ArrayBuffer(Zle));r.setUint32(0,n.byteLength,!0),r.setUint32(4,_st,!0);let i=M5(Tst(JSON.stringify(a)),32),s=new DataView(new ArrayBuffer(Zle));s.setUint32(0,i.byteLength,!0),s.setUint32(4,Est,!0);let o=new ArrayBuffer($le),l=new DataView(o);l.setUint32(0,xst,!0),l.setUint32(4,bst,!0);let h=$le+s.byteLength+i.byteLength+r.byteLength+n.byteLength;l.setUint32(8,h,!0);let u=new Blob([o,s,i,r,n],{type:"application/octet-stream"}),c=new FileReader;c.readAsArrayBuffer(u),c.onloadend=function(){t(c.result)}}}else if(a.buffers&&a.buffers.length>0){let e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){let n=e.result;a.buffers[0].uri=n,t(a)}}else t(a)}))}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let n=this.options,r=this.extensionsUsed;try{let i=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&i.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(let e in i.gltfExtensions)t.extensions[e]=i.gltfExtensions[e],r[e]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(t.extras=i)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let t=new q;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let n=e.clone(),r=new q;for(let e=0,t=n.count;e<t;e++)r.fromBufferAttribute(n,e),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(e,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1,r={};(0!==t.offset.x||0!==t.offset.y)&&(r.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(r.rotation=t.rotation,n=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(e){return e.colorSpace===yi?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof Yl&&(e=XM(e)),t instanceof Yl&&(t=XM(t));let r=e?e.image:null,i=t?t.image:null,a=Math.max(r?r.width:0,i?i.width:0),s=Math.max(r?r.height:0,i?i.height:0),o=Kle();o.width=a,o.height=s;let l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,a,s);let h=l.getImageData(0,0,a,s);if(r){l.drawImage(r,0,0,a,s);let t=n(e),i=l.getImageData(0,0,a,s).data;for(let e=2;e<i.length;e+=4)h.data[e]=256*t(i[e]/256)}if(i){l.drawImage(i,0,0,a,s);let e=n(t),r=l.getImageData(0,0,a,s).data;for(let t=1;t<r.length;t+=4)h.data[t]=256*e(r[t]/256)}l.putImageData(h,0,0);let u=(e||t).clone();return u.source=new ll(o),u.colorSpace=ol,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),u}processBuffer(e){let t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,i){let a,s=this.json;switch(s.bufferViews||(s.bufferViews=[]),t){case Qn.BYTE:case Qn.UNSIGNED_BYTE:a=1;break;case Qn.SHORT:case Qn.UNSIGNED_SHORT:a=2;break;default:a=4}let o=e.itemSize*a;i===Qn.ARRAY_BUFFER&&(o=4*Math.ceil(o/4));let l=Qle(r*o),h=new DataView(new ArrayBuffer(l)),u=0;for(let i=n;i<n+r;i++){for(let n=0;n<e.itemSize;n++){let r;e.itemSize>4?r=e.array[i*e.itemSize+n]:(0===n?r=e.getX(i):1===n?r=e.getY(i):2===n?r=e.getZ(i):3===n&&(r=e.getW(i)),!0===e.normalized&&(r=zr.normalize(r,e.array))),t===Qn.FLOAT?h.setFloat32(u,r,!0):t===Qn.INT?h.setInt32(u,r,!0):t===Qn.UNSIGNED_INT?h.setUint32(u,r,!0):t===Qn.SHORT?h.setInt16(u,r,!0):t===Qn.UNSIGNED_SHORT?h.setUint16(u,r,!0):t===Qn.BYTE?h.setInt8(u,r):t===Qn.UNSIGNED_BYTE&&h.setUint8(u,r),u+=a}u%o!=0&&(u+=o-u%o)}let c={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return void 0!==i&&(c.target=i),i===Qn.ARRAY_BUFFER&&(c.byteStride=o),this.byteOffset+=l,s.bufferViews.push(c),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(r){let i=new FileReader;i.readAsArrayBuffer(e),i.onloadend=function(){let e=M5(i.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,r(n.bufferViews.push(a)-1)}}))}processAccessor(e,t,n,r){let i,a=this.json;if(e.array.constructor===Float32Array)i=Qn.FLOAT;else if(e.array.constructor===Int32Array)i=Qn.INT;else if(e.array.constructor===Uint32Array)i=Qn.UNSIGNED_INT;else if(e.array.constructor===Int16Array)i=Qn.SHORT;else if(e.array.constructor===Uint16Array)i=Qn.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)i=Qn.BYTE;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);i=Qn.UNSIGNED_BYTE}if(void 0===n&&(n=0),(void 0===r||r===1/0)&&(r=e.count),0===r)return null;let s,o=wst(e,n,r);void 0!==t&&(s=e===t.index?Qn.ELEMENT_ARRAY_BUFFER:Qn.ARRAY_BUFFER);let l=this.processBufferView(e,i,n,r,s),h={bufferView:l.id,byteOffset:l.byteOffset,componentType:i,count:r,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(h.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(h)-1}processImage(e,t,n,r="image/png"){if(null!==e){let i=this,a=i.cache,s=i.json,o=i.options,l=i.pending;a.images.has(e)||a.images.set(e,{});let h=a.images.get(e),u=r+":flipY/"+n.toString();if(void 0!==h[u])return h[u];s.images||(s.images=[]);let c={mimeType:r},d=Kle();d.width=Math.min(e.width,o.maxTextureSize),d.height=Math.min(e.height,o.maxTextureSize);let p=d.getContext("2d",{willReadFrequently:!0});if(!0===n&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){t!==vs&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let n=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<n.length;t+=4)n[t+0]=e.data[t+0],n[t+1]=e.data[t+1],n[t+2]=e.data[t+2],n[t+3]=e.data[t+3];p.putImageData(new ImageData(n,e.width,e.height),0,0)}else{if(!("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");p.drawImage(e,0,0,d.width,d.height)}!0===o.binary?l.push(Jle(d,r).then((e=>i.processBufferViewImage(e))).then((e=>{c.bufferView=e}))):void 0!==d.toDataURL?c.uri=d.toDataURL(r):l.push(Jle(d,r).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{c.uri=e})));let f=s.images.push(c)-1;return h[u]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let n={magFilter:Xa[e.magFilter],minFilter:Xa[e.minFilter],wrapS:Xa[e.wrapS],wrapT:Xa[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){let t=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);r.textures||(r.textures=[]),e instanceof Yl&&(e=XM(e,t.maxTextureSize));let i=e.userData.mimeType;"image/webp"===i&&(i="image/png");let a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(a.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,a)}));let s=r.textures.push(a)-1;return n.textures.set(e,s),s}processMaterial(e){let t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);let r={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let i=e.color.toArray().concat([e.opacity]);if(qy(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),n={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(n,t),r.pbrMetallicRoughness.metallicRoughnessTexture=n}if(e.map){let t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),r.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(r.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),r.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),r.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),r.occlusionTexture=t}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===Mr&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,r)}));let a=n.materials.push(r)-1;return t.materials.set(e,a),a}processMesh(e){let t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,n=e.material.length;t<n;t++)r.push(e.material[t].uuid);else r.push(e.material.uuid);let i=r.join(":");if(t.meshes.has(i))return t.meshes.get(i);let a,s=e.geometry;a=e.isLineSegments?Qn.LINES:e.isLineLoop?Qn.LINE_LOOP:e.isLine?Qn.LINE_STRIP:e.isPoints?Qn.POINTS:e.material.wireframe?Qn.LINES:Qn.TRIANGLES;let o={},l={},h=[],u=[],c={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=s.getAttribute("normal");void 0!==d&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in s.attributes){if("morph"===e.slice(0,5))continue;let n=s.attributes[e];if(e=c[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(n))){l[e]=t.attributes.get(this.getUID(n));continue}p=null;let r=n.array;"JOINTS_0"===e&&!(r instanceof Uint16Array)&&!(r instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new vn(new Uint16Array(r),n.itemSize,n.normalized));let i=this.processAccessor(p||n,s);null!==i&&(e.startsWith("_")||this.detectMeshQuantization(e,n),l[e]=i,t.attributes.set(this.getUID(n),i))}if(void 0!==d&&s.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let n=[],r=[],i={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)i[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){let o={},l=!1;for(let e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}let n=s.morphAttributes[e][a],r=e.toUpperCase(),i=s.attributes[e];if(t.attributes.has(this.getUID(n,!0))){o[r]=t.attributes.get(this.getUID(n,!0));continue}let h=n.clone();if(!s.morphTargetsRelative)for(let e=0,t=n.count;e<t;e++)for(let t=0;t<n.itemSize;t++)0===t&&h.setX(e,n.getX(e)-i.getX(e)),1===t&&h.setY(e,n.getY(e)-i.getY(e)),2===t&&h.setZ(e,n.getZ(e)-i.getZ(e)),3===t&&h.setW(e,n.getW(e)-i.getW(e));o[r]=this.processAccessor(h,s),t.attributes.set(this.getUID(i,!0),o[r])}u.push(o),n.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&r.push(i[a])}o.weights=n,r.length>0&&(o.extras={},o.extras.targetNames=r)}let f=Array.isArray(e.material);if(f&&0===s.groups.length)return null;let m=!1;if(f&&null===s.index){let e=[];for(let t=0,n=s.attributes.position.count;t<n;t++)e[t]=t;s.setIndex(e),m=!0}let g=f?e.material:[e.material],v=f?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,n=v.length;e<n;e++){let n={mode:a,attributes:l};if(this.serializeUserData(s,n),u.length>0&&(n.targets=u),null!==s.index){let r=this.getUID(s.index);(void 0!==v[e].start||void 0!==v[e].count)&&(r+=":"+v[e].start+":"+v[e].count),t.attributes.has(r)?n.indices=t.attributes.get(r):(n.indices=this.processAccessor(s.index,s,v[e].start,v[e].count),t.attributes.set(r,n.indices)),null===n.indices&&delete n.indices}let r=this.processMaterial(g[v[e].materialIndex]);null!==r&&(n.material=r),h.push(n)}!0===m&&s.setIndex(null),o.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,o)}));let y=n.meshes.push(o)-1;return t.meshes.set(i,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[w5])return;let n;switch(t.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}t.normalized&&(n+=" normalized");let r=e.split("_",1)[0];Xle[r]&&Xle[r].includes(n)&&(this.extensionsUsed[w5]=!0,this.extensionsRequired[w5]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:zr.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){let n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);let i=(e=Hg.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[];for(let e=0;e<i.length;++e){let n=i[e],o=Wn.parseTrackName(n.name),l=Wn.findNode(t,o.nodeName),h=Yle[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!h){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',n.name);continue}let u,c=1,d=n.values.length/n.times.length;h===Yle.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(u="CUBICSPLINE",d/=3):u=n.getInterpolation()===sd?"STEP":"LINEAR",s.push({input:this.processAccessor(new vn(n.times,c)),output:this.processAccessor(new vn(n.values,d)),interpolation:u}),a.push({sampler:s.length-1,target:{node:r.get(l),path:h}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:s,channels:a}),n.animations.length-1}processSkin(e){let t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],i=e.skeleton;if(void 0===i)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let s=[],o=new Float32Array(16*i.bones.length),l=new At;for(let t=0;t<i.bones.length;++t)s.push(n.get(i.bones[t])),l.copy(i.boneInverses[t]),l.multiply(e.bindMatrix).toArray(o,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new vn(o,16)),joints:s,skeleton:n.get(a)}),r.skin=t.skins.length-1}processNode(e){let t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);let i={};if(n.trs){let t=e.quaternion.toArray(),n=e.position.toArray(),r=e.scale.toArray();qy(t,[0,0,0,1])||(i.rotation=t),qy(n,[0,0,0])||(i.translation=n),qy(r,[1,1,1])||(i.scale=r)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===Sst(e.matrix)&&(i.matrix=e.matrix.elements);if(""!==e.name&&(i.name=String(e.name)),this.serializeUserData(e,i),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(i.mesh=t)}else e.isCamera&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let r=0,i=e.children.length;r<i;r++){let i=e.children[r];if(i.visible||!1===n.onlyVisible){let e=this.processNode(i);null!==e&&t.push(e)}}t.length>0&&(i.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,i)}));let a=t.nodes.push(i)-1;return r.set(e,a),a}processScene(e){let t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);let r={};""!==e.name&&(r.name=e.name),t.scenes.push(r);let i=[];for(let t=0,r=e.children.length;t<r;t++){let r=e.children[t];if(r.visible||!1===n.onlyVisible){let e=this.processNode(r);null!==e&&i.push(e)}}i.length>0&&(r.nodes=i),this.serializeUserData(e,r)}processObjects(e){let t=new ea;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));let n=[];for(let t=0;t<e.length;t++)e[t]instanceof ea?this.processScene(e[t]):n.push(e[t]);n.length>0&&this.processObjects(n);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let n=0;n<t.animations.length;++n)this.processAnimation(t.animations[n],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}},C5=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);let n=this.writer,r=n.json,i=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);let s=r.extensions[this.name].lights;s.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:s.length-1}}},R5=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},P5=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;let n=this.writer,r=n.extensionsUsed,i={};if(i.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:n.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};n.applyTextureTransform(t,e.clearcoatMap),i.clearcoatTexture=t}if(i.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:n.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};n.applyTextureTransform(t,e.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:n.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),n.applyTextureTransform(t,e.clearcoatNormalMap),i.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},I5=class{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;let n=this.writer.extensionsUsed,r={};r.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}},D5=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;let n=this.writer,r=n.extensionsUsed,i={};if(i.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:n.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};n.applyTextureTransform(t,e.iridescenceMap),i.iridescenceTexture=t}if(i.iridescenceIor=e.iridescenceIOR,i.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],i.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:n.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};n.applyTextureTransform(t,e.iridescenceThicknessMap),i.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},O5=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let n=this.writer,r=n.extensionsUsed,i={};if(i.transmissionFactor=e.transmission,e.transmissionMap){let t={index:n.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};n.applyTextureTransform(t,e.transmissionMap),i.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},L5=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let n=this.writer,r=n.extensionsUsed,i={};if(i.thicknessFactor=e.thickness,e.thicknessMap){let t={index:n.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};n.applyTextureTransform(t,e.thicknessMap),i.thicknessTexture=t}i.attenuationDistance=e.attenuationDistance,i.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},k5=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;let n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}},F5=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(yst)&&!e.specularIntensityMap&&!e.specularColorMap)return;let n=this.writer,r=n.extensionsUsed,i={};if(e.specularIntensityMap){let t={index:n.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};n.applyTextureTransform(t,e.specularIntensityMap),i.specularTexture=t}if(e.specularColorMap){let t={index:n.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};n.applyTextureTransform(t,e.specularColorMap),i.specularColorTexture=t}i.specularFactor=e.specularIntensity,i.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},N5=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;let n=this.writer,r=n.extensionsUsed,i={};if(e.sheenRoughnessMap){let t={index:n.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};n.applyTextureTransform(t,e.sheenRoughnessMap),i.sheenRoughnessTexture=t}if(e.sheenColorMap){let t={index:n.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};n.applyTextureTransform(t,e.sheenColorMap),i.sheenColorTexture=t}i.sheenRoughnessFactor=e.sheenRoughness,i.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},B5=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;let n=this.writer,r=n.extensionsUsed,i={};if(e.anisotropyMap){let t={index:n.processTexture(e.anisotropyMap)};n.applyTextureTransform(t,e.anisotropyMap),i.anisotropyTexture=t}i.anisotropyStrength=e.anisotropy,i.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},U5=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;let n=this.writer.extensionsUsed,r={};r.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}},H5=class{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;let n=this.writer,r=n.extensionsUsed,i={};if(e.bumpMap){let t={index:n.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};n.applyTextureTransform(t,e.bumpMap),i.bumpTexture=t}i.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},V5=class{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;let n=this.writer,r=e,i=new Float32Array(3*r.count),a=new Float32Array(4*r.count),s=new Float32Array(3*r.count),o=new At,l=new q,h=new Ci,u=new q;for(let e=0;e<r.count;e++)r.getMatrixAt(e,o),o.decompose(l,h,u),l.toArray(i,3*e),h.toArray(a,4*e),u.toArray(s,3*e);let c={TRANSLATION:n.processAccessor(new vn(i,3)),ROTATION:n.processAccessor(new vn(a,4)),SCALE:n.processAccessor(new vn(s,3))};r.instanceColor&&(c._COLOR_0=n.processAccessor(r.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:c},n.extensionsUsed[this.name]=!0,n.extensionsRequired[this.name]=!0}};Hg.Utils={insertKeyframe:function(e,t){let n,r=e.getValueSize(),i=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+r),s=e.createInterpolant(new e.ValueBufferType(r));if(0===e.times.length){i[0]=t;for(let e=0;e<r;e++)a[e]=0;n=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;i[0]=t,i.set(e.times,1),a.set(s.evaluate(t),0),a.set(e.values,r),n=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;i[i.length-1]=t,i.set(e.times,0),a.set(e.values,0),a.set(s.evaluate(t),e.values.length),n=i.length-1}else for(let o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){i.set(e.times.slice(0,o+1),0),i[o+1]=t,i.set(e.times.slice(o+1),o+2),a.set(e.values.slice(0,(o+1)*r),0),a.set(s.evaluate(t),(o+1)*r),a.set(e.values.slice((o+1)*r),(o+2)*r),n=o+1;break}}return e.times=i,e.values=a,n},mergeMorphTargetTracks:function(e,t){let n=[],r={},i=e.tracks;for(let e=0;e<i.length;++e){let a=i[e],s=Wn.parseTrackName(a.name),o=Wn.findNode(t,s.nodeName);if("morphTargetInfluences"!==s.propertyName||void 0===s.propertyIndex){n.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(Km)}let l,h=o.morphTargetInfluences.length,u=o.morphTargetDictionary[s.propertyIndex];if(void 0===u)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0===r[o.uuid]){l=a.clone();let e=new l.ValueBufferType(h*l.times.length);for(let t=0;t<l.times.length;t++)e[t*h+u]=l.values[t];l.name=(s.nodeName||"")+".morphTargetInfluences",l.values=e,r[o.uuid]=l,n.push(l);continue}let c=a.createInterpolant(new a.ValueBufferType(1));l=r[o.uuid];for(let e=0;e<l.times.length;e++)l.values[e*h+u]=c.evaluate(l.times[e]);for(let e=0;e<a.times.length;e++){let t=this.insertKeyframe(l,a.times[e]);l.values[t*h+u]=a.values[e]}}return e.tracks=n,e}};var YM=class{parse(e){let t="",n=0,r=0,i=0,a=new q,s=new Ot,o=new q,l=new Te,h=[];return e.traverse((function(e){!0===e.isMesh&&function(e){let s=0,u=0,c=0,d=e.geometry,p=new Tn,f=d.getAttribute("position"),m=d.getAttribute("normal"),g=d.getAttribute("uv"),v=d.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==f)for(let n=0,r=f.count;n<r;n++,s++)a.fromBufferAttribute(f,n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if(void 0!==g)for(let e=0,n=g.count;e<n;e++,c++)l.fromBufferAttribute(g,e),t+="vt "+l.x+" "+l.y+"\n";if(void 0!==m){p.getNormalMatrix(e.matrixWorld);for(let e=0,n=m.count;e<n;e++,u++)o.fromBufferAttribute(m,e),o.applyMatrix3(p).normalize(),t+="vn "+o.x+" "+o.y+" "+o.z+"\n"}if(null!==v)for(let e=0,a=v.count;e<a;e+=3){for(let t=0;t<3;t++){let a=v.getX(e+t)+1;h[t]=n+a+(m||g?"/"+(g?r+a:"")+(m?"/"+(i+a):""):"")}t+="f "+h.join(" ")+"\n"}else for(let e=0,a=f.count;e<a;e+=3){for(let t=0;t<3;t++){let a=e+t+1;h[t]=n+a+(m||g?"/"+(g?r+a:"")+(m?"/"+(i+a):""):"")}t+="f "+h.join(" ")+"\n"}n+=s,r+=c,i+=u}(e),!0===e.isLine&&function(e){let r=0,i=e.geometry,s=e.type,o=i.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==o)for(let n=0,i=o.count;n<i;n++,r++)a.fromBufferAttribute(o,n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if("Line"===s){t+="l ";for(let e=1,r=o.count;e<=r;e++)t+=n+e+" ";t+="\n"}if("LineSegments"===s)for(let e=1,r=e+1,i=o.count;e<i;e+=2,r=e+1)t+="l "+(n+e)+" "+(n+r)+"\n";n+=r}(e),!0===e.isPoints&&function(e){let r=0,i=e.geometry,o=i.getAttribute("position"),l=i.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==o){for(let n=0,i=o.count;n<i;n++,r++)a.fromBufferAttribute(o,n),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z,void 0!==l&&(s.fromBufferAttribute(l,n).convertLinearToSRGB(),t+=" "+s.r+" "+s.g+" "+s.b),t+="\n";t+="p ";for(let e=1,r=o.count;e<=r;e++)t+=n+e+" ";t+="\n"}n+=r}(e)})),t}},$M=class{parse(e,t={}){let n=(t=Object.assign({binary:!1},t)).binary,r=[],i=0;e.traverse((function(e){if(e.isMesh){let t=e.geometry,n=t.index,a=t.getAttribute("position");i+=null!==n?n.count/3:a.count/3,r.push({object3d:e,geometry:t})}}));let a,s=80;if(!0===n){let e=new ArrayBuffer(2*i+3*i*4*4+80+4);a=new DataView(e),a.setUint32(s,i,!0),s+=4}else a="",a+="solid exported\n";let o=new q,l=new q,h=new q,u=new q,c=new q,d=new q;for(let e=0,t=r.length;e<t;e++){let t=r[e].object3d,n=r[e].geometry,i=n.index,a=n.getAttribute("position");if(null!==i)for(let e=0;e<i.count;e+=3){p(i.getX(e+0),i.getX(e+1),i.getX(e+2),a,t)}else for(let e=0;e<a.count;e+=3){p(e+0,e+1,e+2,a,t)}}return!1===n&&(a+="endsolid exported\n"),a;function p(e,t,r,i,p){o.fromBufferAttribute(i,e),l.fromBufferAttribute(i,t),h.fromBufferAttribute(i,r),!0===p.isSkinnedMesh&&(p.applyBoneTransform(e,o),p.applyBoneTransform(t,l),p.applyBoneTransform(r,h)),o.applyMatrix4(p.matrixWorld),l.applyMatrix4(p.matrixWorld),h.applyMatrix4(p.matrixWorld),function(e,t,r){u.subVectors(r,t),c.subVectors(e,t),u.cross(c).normalize(),d.copy(u).normalize(),!0===n?(a.setFloat32(s,d.x,!0),s+=4,a.setFloat32(s,d.y,!0),s+=4,a.setFloat32(s,d.z,!0),s+=4):(a+="\tfacet normal "+d.x+" "+d.y+" "+d.z+"\n",a+="\t\touter loop\n")}(o,l,h),f(o),f(l),f(h),!0===n?(a.setUint16(s,0,!0),s+=2):(a+="\t\tendloop\n",a+="\tendfacet\n")}function f(e){!0===n?(a.setFloat32(s,e.x,!0),s+=4,a.setFloat32(s,e.y,!0),s+=4,a.setFloat32(s,e.z,!0),s+=4):a+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n"}}},Ar=class{static exportToGltf(e,t){Ar.exportToGltfOrGlb(e,t,{binary:!1})}static exportToGlb(e,t){Ar.exportToGltfOrGlb(e,t,{binary:!0})}static exportToGltfOrGlb(e,t,n={}){if(!e||!t)throw new Error("Invalid input or filename!");let r=new Hg;n=Object.assign({},{binary:!0,onlyVisible:!1,includeCustomExtensions:!1},n),r.parse(e,(e=>{if(n.binary){t=Ar.addExtention(t,Ar.EXTENSION_GLB);let n=e;Ar.saveArrayBuffer(n,t)}else t=Ar.addExtention(t,Ar.EXTENSION_GLTF),Ar.saveJson(e,t)}),(e=>console.log(e)),n)}static exportToObj(e,t){if(!e||!t)throw new Error("Invalid input or filename!");t=Ar.addExtention(t,Ar.EXTENSION_OBJ);let n=(new YM).parse(e);Ar.saveString(n,t)}static exportToDraco(e,t,n={}){if(!e||!t)throw new Error("Invalid input or filename!");t=Ar.addExtention(t,Ar.EXTENSION_DRACO);let r=new ks;n=Object.assign({},{encodeSpeed:5},n);let i=r.parse(e,n);Ar.saveArrayBuffer(i,t)}static exportToStl(e,t,n=!1){if(!e||!t)throw new Error("Invalid input or filename!");t=Ar.addExtention(t,Ar.EXTENSION_STL);let r=new $M;if(n){let n={binary:!0},i=r.parse(e,n);Ar.saveDataView(i,t)}else{let n=r.parse(e);Ar.saveString(n,t)}}static exportToThreeJsJson(e,t){let n=e.toJSON();t.toLowerCase().endsWith(Ar.EXTENSION_JSON)||(t+=Ar.EXTENSION_JSON),Ar.saveJson(n,t)}static save(e,t){let n=Ar.downloadLink;n||(n=document.createElement("a"),n.style.display="none",document.body.appendChild(n),Ar.downloadLink=n),n.href=URL.createObjectURL(e),n.download=t,n.click()}static saveArrayBuffer(e,t){Ar.save(new Blob([e],{type:"application/octet-stream"}),t)}static saveJson(e,t){Ar.saveJsonString(JSON.stringify(e),t)}static saveJsonString(e,t){Ar.save(new Blob([e],{type:"application/json"}),t)}static saveString(e,t){Ar.save(new Blob([e],{type:"text/plain"}),t)}static saveDataView(e,t){Ar.save(new Blob([e],{type:"application/octet-stream"}),t)}static addExtention(e,t){return e.toLowerCase().endsWith(t.toLowerCase())||(e+=t),e}},Sh=Ar;Sh.EXTENSION_GLTF=".gltf",Sh.EXTENSION_GLB=".glb",Sh.EXTENSION_OBJ=".obj",Sh.EXTENSION_DRACO=".drc",Sh.EXTENSION_JSON=".json",Sh.EXTENSION_STL=".stl";var ece=class{constructor(){this.prevTime=(performance||Date).now(),this.beginTime=(performance||Date).now(),this.frames=0,this.fps=Number.NaN}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;let e=(performance||Date).now();return e>=this.prevTime+1e3&&(this.fps=Math.round(1e3*this.frames/(e-this.prevTime)),this.frames=0,this.prevTime=e),e}update(){this.beginTime=this.end()}},X5={exports:{}};function JM(e,t,n){n=n||2;var r,i,a,s,o,l,h,u=t&&t.length,c=u?t[0]*n:e.length,d=ace(e,0,c,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=Pst(e,t,d,n)),e.length>80*n){r=a=e[0],i=s=e[1];for(var f=n;f<c;f+=n)(o=e[f])<r&&(r=o),(l=e[f+1])<i&&(i=l),o>a&&(a=o),l>s&&(s=l);h=0!==(h=Math.max(a-r,s-i))?32767/h:0}return Gy(d,p,n,r,i,h,0),p}function ace(e,t,n,r,i){var a,s;if(i===j5(e,t,n,r)>0)for(a=t;a<n;a+=r)s=tce(a,e[a],e[a+1],s);else for(a=n-r;a>=t;a-=r)s=tce(a,e[a],e[a+1],s);return s&&QM(s,s.next)&&(jy(s),s=s.next),s}function Id(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!QM(r,r.next)&&0!==fi(r.prev,r,r.next))r=r.next;else{if(jy(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Gy(e,t,n,r,i,a,s){if(e){!s&&a&&kst(e,r,i,a);for(var o,l,h=e;e.prev!==e.next;)if(o=e.prev,l=e.next,a?Ast(e,r,i,a):Mst(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),jy(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?Gy(e=Cst(Id(e),t,n),t,n,r,i,a,2):2===s&&Rst(e,t,n,r,i,a):Gy(Id(e),t,n,r,i,a,1);break}}}function Mst(e){var t=e.prev,n=e,r=e.next;if(fi(t,n,r)>=0)return!1;for(var i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,h=r.y,u=i<a?i<s?i:s:a<s?a:s,c=o<l?o<h?o:h:l<h?l:h,d=i>a?i>s?i:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=r.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&Vg(i,o,a,l,s,h,f.x,f.y)&&fi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ast(e,t,n,r){var i=e.prev,a=e,s=e.next;if(fi(i,a,s)>=0)return!1;for(var o=i.x,l=a.x,h=s.x,u=i.y,c=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,v=G5(p,f,t,n,r),y=G5(m,g,t,n,r),x=e.prevZ,b=e.nextZ;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&Vg(o,u,l,c,h,d,x.x,x.y)&&fi(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&Vg(o,u,l,c,h,d,b.x,b.y)&&fi(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&Vg(o,u,l,c,h,d,x.x,x.y)&&fi(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&Vg(o,u,l,c,h,d,b.x,b.y)&&fi(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Cst(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!QM(i,a)&&oce(i,r,r.next,a)&&Wy(i,a)&&Wy(a,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(a.i/n|0),jy(r),jy(r.next),r=e=a),r=r.next}while(r!==e);return Id(r)}function Rst(e,t,n,r,i,a){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Bst(s,o)){var l=lce(s,o);return s=Id(s,s.next),l=Id(l,l.next),Gy(s,t,n,r,i,a,0),void Gy(l,t,n,r,i,a,0)}o=o.next}s=s.next}while(s!==e)}function Pst(e,t,n,r){var i,a,s,o=[];for(i=0,a=t.length;i<a;i++)(s=ace(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),o.push(Nst(s));for(o.sort(Ist),i=0;i<o.length;i++)n=Dst(o[i],n);return n}function Ist(e,t){return e.x-t.x}function Dst(e,t){var n=Ost(e,t);if(!n)return t;var r=lce(n,e);return Id(r,r.next),Id(n,n.next)}function Ost(e,t){var n,r=t,i=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>s&&(s=o,n=r.x<r.next.x?r:r.next,o===i))return n}r=r.next}while(r!==t);if(!n)return null;var l,h=n,u=n.x,c=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&Vg(a<c?i:s,a,u,c,a<c?s:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),Wy(r,e)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&Lst(n,r)))&&(n=r,d=l)),r=r.next}while(r!==h);return n}function Lst(e,t){return fi(e.prev,e,t.prev)<0&&fi(t.next,e,e.next)<0}function kst(e,t,n,r){var i=e;do{0===i.z&&(i.z=G5(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,Fst(i)}function Fst(e){var t,n,r,i,a,s,o,l,h=1;do{for(n=e,e=null,a=null,s=0;n;){for(s++,r=n,o=0,t=0;t<h&&(o++,r=r.nextZ);t++);for(l=h;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,h*=2}while(s>1);return e}function G5(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Nst(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Vg(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function Bst(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Ust(e,t)&&(Wy(e,t)&&Wy(t,e)&&Hst(e,t)&&(fi(e.prev,e,t.prev)||fi(e,t.prev,t))||QM(e,t)&&fi(e.prev,e,e.next)>0&&fi(t.prev,t,t.next)>0)}function fi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function QM(e,t){return e.x===t.x&&e.y===t.y}function oce(e,t,n,r){var i=KM(fi(e,t,n)),a=KM(fi(e,t,r)),s=KM(fi(n,r,e)),o=KM(fi(n,r,t));return!!(i!==a&&s!==o||0===i&&ZM(e,n,t)||0===a&&ZM(e,r,t)||0===s&&ZM(n,e,r)||0===o&&ZM(n,t,r))}function ZM(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function KM(e){return e>0?1:e<0?-1:0}function Ust(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&oce(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Wy(e,t){return fi(e.prev,e,e.next)<0?fi(e,t,e.next)>=0&&fi(e,e.prev,t)>=0:fi(e,t,e.prev)<0||fi(e,e.next,t)<0}function Hst(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function lce(e,t){var n=new W5(e.i,e.x,e.y),r=new W5(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function tce(e,t,n,r){var i=new W5(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function jy(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function W5(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function j5(e,t,n,r){for(var i=0,a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}X5.exports=JM,X5.exports.default=JM,JM.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,s=Math.abs(j5(e,0,a,n));if(i)for(var o=0,l=t.length;o<l;o++){var h=t[o]*n,u=o<l-1?t[o+1]*n:e.length;s-=Math.abs(j5(e,h,u,n))}var c=0;for(o=0;o<r.length;o+=3){var d=r[o]*n,p=r[o+1]*n,f=r[o+2]*n;c+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},JM.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var s=0;s<t;s++)n.vertices.push(e[i][a][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n};var mRt=X5.exports;function nce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Vst(e,t){var n=t[0],r=t[1],i=t[2],a=Math.sqrt(n*n+r*r+i*i)||1;return e[0]=n/a,e[1]=r/a,e[2]=i/a,e}function zst(e,t,n){var r=t[0],i=t[1],a=t[2],s=n[0],o=n[1],l=n[2];return e[0]=i*l-a*o,e[1]=a*s-r*l,e[2]=r*o-i*s,e}function qst(e,t){function n(e,t,n,r){e[0]=t,e[1]=n,e[2]=r}for(var r=[],i=[],a=[],s=[],o=[],l=[],h=e.length,u=new Float32Array(t.length),c=0;c<h;){var d=3*e[c],p=3*e[c+1],f=3*e[c+2];n(r,t[d],t[d+1],t[d+2]),n(i,t[p],t[p+1],t[p+2]),n(a,t[f],t[f+1],t[f+2]),nce(o,a,i),nce(s,r,i),zst(l,o,s);for(var m=0;m<3;m++)u[d+m]+=l[m],u[p+m]+=l[m],u[f+m]+=l[m];c+=3}for(var g=0,v=u.length;g<v;)n(l,u[g],u[g+1],u[g+2]),Vst(l,l),u[g]=l[0]||0,u[g+1]=l[1]||0,u[g+2]=l[2]||0,g+=3;return u}function Gst(e){if(1===e.length)return{position:e[0].position,normal:e[0].normal,uv:e[0].uv,indices:e[0].indices,results:e};for(var t=0,n=0,r=0,i=e.length;r<i;r++){var a=e[r],s=a.position,o=a.indices;t+=s.length,n+=o.length}for(var l={position:new Float32Array(t),normal:new Float32Array(t),uv:new Float32Array(t/3*2),indices:new Uint32Array(n),results:e},h=0,u=0,c=0,d=0,p=0,f=e.length;p<f;p++){var m=e[p],g=m.position,v=m.indices,y=m.normal,x=m.uv;l.position.set(g,h),l.normal.set(y,h),l.uv.set(x,d);for(var b=0,_=v.length;b<_;){var w=v[b]+u;l.indices[c]=w,c++,b++}d+=x.length,h+=g.length,u+=g.length/3}return l}function Wst(e){return 180*e/Math.PI}function rce(e){return e/180*Math.PI}function jst(e,t,n,r,i,a){var s=3*n,o=3*r,l=3*i,h=3*a,u=t[s],c=t[s+1],d=t[s+2],p=t[o],f=t[o+1],m=t[o+2],g=t[l],v=t[l+1],y=t[l+2],x=t[h],b=t[h+1],_=t[h+2];Math.abs(c-f)<Math.abs(u-p)?(e.push(u,1-d),e.push(p,1-m),e.push(g,1-y),e.push(x,1-_)):(e.push(c,1-d),e.push(f,1-m),e.push(v,1-y),e.push(b,1-_))}function cce(e,t){t=Object.assign({},{depth:2,lineWidth:1},t);var n=Gst(e.map((function(e){var n=$st(e,t);return n.line=e,Xst(n,t),Yst(n,t),n.position=new Float32Array(n.points),n.indices=new Uint32Array(n.index),n.uv=new Float32Array(n.uvs),n.normal=qst(n.indices,n.position),n})));return n.lines=e,n}function Xst(e,t){for(var n=t.depth,r=[],i=[],a=[],s=e.leftPoints,o=e.rightPoints,l=0,h=s.length;l<h;){var u=3*l,c=s[l],d=c[0],p=c[1],f=c[2];r[u]=d,r[u+1]=p,r[u+2]=n+f;var m=o[l],g=m[0],v=m[1],y=m[2],x=3*h+u;r[x]=g,r[x+1]=v,r[x+2]=n+y;var b=2*h*3+u;r[b]=d,r[b+1]=p,r[b+2]=f;var _=2*h*3+3*h+u;r[_]=g,r[_+1]=v,r[_+2]=y,l++}for(l=0,h=r.length;l<h;){var w=r[l],S=r[l+1];a.push(w,S),l+=3}for(l=0,h=s.length;l<h-1;){var M=l,T=l+1,E=M+h,A=T+h;i.push(M,E,T),i.push(E,A,T);var C=l+2*h,P=C+1,I=C+h,R=P+h;i.push(C,I,P),i.push(I,R,P),l++}e.index=i,e.points=r,e.uvs=a}function Yst(e,t){var n=e.points,r=e.index,i=e.leftPoints,a=e.rightPoints,s=e.uvs,o=t.depth,l=[i,a];function h(e,t){var i=n.length/3;n.push(e[0],e[1],o+e[2],t[0],t[1],o+t[2],e[0],e[1],e[2],t[0],t[1],t[2]);var a=i+2,l=i+3,h=i,u=i+1;r.push(a,h,l,h,u,l),jst(s,n,a,l,h,u)}for(var u=0,c=l.length;u<c;u++){var d=l[u];u>0&&(d=(d=d.map((function(e){return e}))).reverse());for(var p=0,f=d.length-1;p<f;){h(d[p],d[p+1]),p++}}for(var m=i.length,g=[a[0],i[0],i[m-1],a[m-1]],v=0;v<g.length;v+=2){h(g[v],g[v+1])}}var z5={x:0,y:0},q5={x:0,y:0};function $st(e,t){for(var n=0,r=t.lineWidth/2,i=[],a=[],s=[],o=e.length,l=0;l<o-1;){var h=e[l],u=e[l+1],c=u[1]-h[1],d=u[0]-h[0],p=0,f=Wst(Math.atan(c/d));if(n=f,0===l)p=f,p-=90;else{var m=e[l-1];z5.x=m[0]-h[0],z5.y=m[1]-h[1],q5.x=u[0]-h[0],q5.y=u[1]-h[1],p=f-Zst(z5,q5)/2}var g=ice(rce(p),r,h),v=g[0],y=g[1];i.push(v,y),sce(v,h,u)?(a.push(v),s.push(y)):(a.push(y),s.push(v)),l++}var x=n,b=rce(x-=90),_=e[o-2],w=e[o-1],S=ice(b,r,w),M=S[0],T=S[1];return i.push(M,T),sce(M,_,w)?(a.push(M),s.push(T)):(a.push(T),s.push(M)),{offsetPoints:i,leftPoints:a,rightPoints:s}}function ice(e,t,n){var r=n[0],i=n[1],a=n[2]||0,s=[r+Math.cos(e)*t,i+Math.sin(e)*t,a],o=e+=Math.PI;return[s,[r+Math.cos(o)*t,i+Math.sin(o)*t,a]]}var Zst=function(e,t){var n=e.x,r=e.y,i=t.x,a=t.y,s=n*i+r*a,o=n*a-r*i;return(Math.atan2(o,s)/Math.PI*180+360)%360};function sce(e,t,n){var r=t[0],i=t[1],a=n[0],s=n[1];return(i-s)*e[0]+(a-r)*e[1]+r*s-a*i>0}var Y5=1e-15,uce=(new At).set(0,0,-1,0,1,0,0,0,0,1,0,0,0,0,0,1),hce=(new At).set(0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1),Bt=class{static roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}static floorNumber(e,t){return Math.floor(e*Math.pow(10,t))/Math.pow(10,t)}static areNumbersEqual(e,t,n=1e-7){return Math.abs(e-t)<n*Math.max(1,Math.abs(e),Math.abs(t))}static areVector2sEqual(e,t,n=1e-7){return Bt.areNumbersEqual(e.x,t.x,n)&&Bt.areNumbersEqual(e.y,t.y,n)}static areVector3sEqual(e,t,n=1e-7){return Bt.areNumbersEqual(e.x,t.x,n)&&Bt.areNumbersEqual(e.y,t.y,n)&&Bt.areNumbersEqual(e.z,t.z,n)}static areNumbersClose(e,t,n=1e-9,r=1e-12){return Math.abs(e-t)<=Math.max(n*Math.max(Math.abs(e),Math.abs(t)),r)}static areVector2sClose(e,t,n=1e-9,r=1e-12){return this.areNumbersClose(e.x,t.x,n,r)&&this.areNumbersClose(e.y,t.y,n,r)}static areVectorsClose(e,t,n=1e-9,r=1e-12){return this.areNumbersClose(e.x,t.x,n,r)&&this.areNumbersClose(e.y,t.y,n,r)&&this.areNumbersClose(e.z,t.z,n,r)}static getArcAngleSpanInRadian(e,t){let n=2*Math.PI;return Bt.areNumbersClose(e,t,Y5)?0:(e%=n,Bt.areNumbersClose(e,t%n,Y5)?n:(Bt.areNumbersClose(t,n,Y5)&&(t%=n),t<e&&(t+=n),t-e))}static getIntegerPartLength(e){return(e=Math.abs(e))<1?0:Math.ceil(Math.log10(Math.abs(e)+1))}static getRelativeEps(e,t=1e-7){let n=Bt.getIntegerPartLength(e);return Math.max(Math.pow(10,n)*t,t)}static getVector2RelativeEps(e,t=1e-7){return Math.min(Bt.getRelativeEps(e.x,t),Bt.getRelativeEps(e.y,t))}static getControlPointByTwoPoints(e,t){let n=(new Te).subVectors(t,e),r=n.angle(),i=n.length(),a=zr.degToRad(45),s=i/2/Math.cos(a);return new Te(e.x+s*Math.cos(a-r),e.y-s*Math.sin(a-r))}static convertPointFromUEToGltf(e){let t=new q(e.x,e.y,e.z);return t.applyMatrix4(uce.clone().invert()),t}static convertPointFromGltfToUE(e){let t=new q(e.x,e.y,e.z);return t.applyMatrix4(uce),t}static convertPointFromUEToRevit(e){let t=new q(e.x,e.y,e.z);return t.applyMatrix4(hce.clone().invert()),t}static convertPointFromRevitToUE(e){let t=new q(e.x,e.y,e.z);return t.applyMatrix4(hce),t}static getBox(e,t){return[...[Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z)],...[Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z)]]}static getCenter(e){let t=new q(e.min.x,e.min.y,e.min.z),n=new q(e.max.x,e.max.y,e.max.z),r=(new q).addVectors(t,n).multiplyScalar(.5);return{x:r.x,y:r.y,z:r.z}}static convertBoxFromGltfToUE(e){let t=Bt.convertPointFromGltfToUE(e.min),n=Bt.convertPointFromGltfToUE(e.max);return Bt.getBox(t,n)}static convertBoxFromUEToGltf(e){let t=Bt.convertPointFromUEToGltf(e.min),n=Bt.convertPointFromUEToGltf(e.max);return Bt.getBox(t,n)}static convertBoxFromRevitToUE(e){let t=Bt.convertPointFromRevitToUE(e.min),n=Bt.convertPointFromRevitToUE(e.max);return Bt.getBox(t,n)}static convertBoxFromUEToRevit(e){let t=Bt.convertPointFromUEToRevit(e.min),n=Bt.convertPointFromUEToRevit(e.max);return Bt.getBox(t,n)}static clamp(e,t,n){return Math.max(t,Math.min(n,e))}static getLookAtMatrix(e,t,n){let r=new At,i=new q(e.x,e.y,e.z),a=new q(t.x,t.y,t.z),s=new q(n.x,n.y,n.z);r.lookAt(i,a,s),r.transpose();let o=[];return r.toArray(o),o}static getLocationFromMatrix(e){let t=new q;return t.setFromMatrixPosition(e),t}static toDegrees(e){return zr.radToDeg(e)}static toRadians(e){return zr.degToRad(e)}static signNotZero(e){return e<0?-1:1}static fromSnorm(e,t){return Bt.clamp(e*(1/t),-1,1)}static OctDecode(e,t,n){if(t.x=Bt.fromSnorm(e.x,n),t.y=Bt.fromSnorm(e.y,n),t.z=1-(Math.abs(t.x)+Math.abs(t.y)),t.z<0){let e=t.x;t.x=(1-Math.abs(t.y))*Bt.signNotZero(e),t.y=(1-Math.abs(e))*Bt.signNotZero(t.y)}}},$5=1e7,fce=new Vr,dce=new Vr,pce=new q,mce=new q,gce=new q,wh=new Pr,Gt=class{static geometriesEqual(e,t){return e===t||e.type===t.type&&e.name===t.name&&e.morphTargetsRelative===t.morphTargetsRelative&&this.equal(e.boundingBox,t.boundingBox)&&this.equal(e.boundingSphere,t.boundingSphere)&&this.attributesEqual(e.attributes,t.attributes)&&this.bufferAttributesEqual(e.index,t.index)}static equal(e,t){return e===t||!e&&!t||!(!e||!t)&&e.equals(t)}static attributesEqual(e,t){if(e===t)return!0;let n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(let i=0;i<n.length;++i){if(n[i]!==r[i])return!1;let a=e[n[i]],s=t[r[i]];if(!this.bufferAttributesEqual(a,s))return!1}return!0}static bufferAttributesEqual(e,t){if(e===t)return!0;if(!e||!t||e.name!==t.name||e.itemSize!==t.itemSize||e.count!==t.count||e.normalized!==t.normalized)return!1;if(e.array&&t.array){if(e.array.length!==t.array.length)return!1;for(let n=0;n<e.array.length;++n)if(e.array[n]!==t.array[n])return!1}else if(e.array||t.array)return!1;let n=e.data,r=t.data;if(n&&r){if(n.length!==r.length)return!1;for(let e=0;e<n.length;++e)if(n[e]!==r[e])return!1}else if(n||r)return!1;return!0}static tryConvertInterleavedBufferAttributes(e){!e||!e.attributes||Object.keys(e.attributes).forEach((t=>{let n=e.attributes[t];if(n instanceof So){let r=n.clone();e.attributes[t]=r}}))}static isPointInPolygon(e,t,n=!1){let r=e.x,i=e.y,a=!1,s=t.length;for(let e=0,o=s-1;e<s;o=e++){let s=t[e].x,l=t[e].y,h=t[o].x,u=t[o].y,c=l>i!=u>i;n&&(c=l>=i!=u>=i),c&&r<(h-s)*(i-l)/(u-l)+s&&(a=!a)}return a}static caculateGeometryCenter(e){if(!e.hasAttribute("position"))return null;let t=e.getAttribute("position");if(0===t.count)return null;let n=new q,r=t.itemSize,i=t.array,a=[0,0,0];for(let e=0;e<t.count;e++)for(let t=0;t<r;t++)a[t]+=i[e*r+t];for(let e=0;e<r;e++)n.setComponent(e,a[e]/t.count);return n}static isConvex(e){let t=e.length,n=0,r=0,i=new Te,a=new Te;for(let s=0;s<t;++s){let o=e[s],l=e[(s+1)%t],h=e[(s+2)%t];if(i.subVectors(l,o),a.subVectors(h,l),r=i.cross(a),0!=r){if(r>0&&n<0||r<0&&n>0)return!1;n=r}}return!0}static areLineSegmentsIntersecting(e,t){let{start:n,end:r}=e,{start:i,end:a}=t,s=i.clone().sub(n),o=r.clone().sub(n),l=a.clone().sub(n),h=s.cross(o).dot(l.cross(o)),u=n.clone().sub(i),c=a.clone().sub(i),d=r.clone().sub(i),p=u.cross(c).dot(d.cross(c));return h<0&&p<0}static getLineSegmentsIntersectingPoint(e,t){let{start:n,end:r}=e,{start:i,end:a}=t,s=pce.subVectors(r,n).normalize(),o=mce.subVectors(a,i).normalize();if(1===s.dot(o))return null;let l=gce.subVectors(i,n),h=s.clone().cross(o),u=l.clone().cross(o),c=l.clone().dot(h);if(c>=1e-5||c<=-1e-5)return null;let d=h.lengthSq();if(Bt.areNumbersEqual(0,d))return;let p=u.clone().dot(h)/d,f=n.clone().add(s.multiplyScalar(p));return f.equals(n)||f.equals(r)?null:f}static isPointOnLineSegment(e,t,n=.001){let{start:r,end:i}=t,a=pce.subVectors(r,i).length(),s=mce.subVectors(e,r).length(),o=gce.subVectors(e,i).length();return Math.abs(a-(s+o))<=n}static isPointOnLineSegments(e,t,n=.001){let r=!1;for(let i=0;i<t.length-1;i+=2){let a=t[i],s=t[i+1];if(r=this.isPointOnLineSegment(e,{start:a,end:s},n),r)break}return r}static checkAndRebasePositionsOnRTC(e,t){if(0===e.length)return!1;let n=e[0]instanceof q;e.forEach((e=>{n?t.add(e):(t.x+=e.x,t.y+=e.y)})),t.divideScalar(e.length);let r=!1;if(Gt.shouldRebasePositionOnRTC(t)){r=!0;for(let r=0;r<e.length;r++){let i=e[r].x-t.x,a=e[r].y-t.y;e[r]=n?new q(i,a,e[r].z-t.z):new Te(i,a)}}else t.setScalar(0);return r}static shouldRebasePositionOnRTC(e){return Math.abs(e.x)>$5||Math.abs(e.y)>$5||e instanceof q&&Math.abs(e.z)>$5}static calculateSurfaceArea(e){let t=0,n=e.getAttribute("position"),r=e.index;if(r)for(let e=0;e<r.count;e+=3)wh.a.fromBufferAttribute(n,r.getX(e)),wh.b.fromBufferAttribute(n,r.getX(e+1)),wh.c.fromBufferAttribute(n,r.getX(e+2)),t+=wh.getArea();else for(let e=0;e<n.count;e+=3)wh.a.fromBufferAttribute(n,e),wh.b.fromBufferAttribute(n,e+1),wh.c.fromBufferAttribute(n,e+2),t+=wh.getArea();return t}static convertLineStripToLine(e,t=!1){let n=e.getIndex();if(!n)return;let r=n.array.constructor,i=n.count,a=i;i>2&&(a=t?2*i:2*i-2);let s=new r(a),o=0;for(let e=0;e<i;e++){let t=n.getX(e);s[o++]=t,e>0&&e<i-1&&(s[o++]=t)}t&&(s[o++]=n.getX(i-1),s[o++]=n.getX(0)),e.setIndex(s)}static convertGeometryWithIndexedToNonIndexed(e){if(!e.index)return e;let t=new Nt,n=e.index;for(let r in e.attributes)t.setAttribute(r,Gt.createGeometryAttributeByIndex(e.attributes[r],n));return t}static createGeometryAttributeByIndex(e,t){let n=t.count,r=e.itemSize,i=new(0,e.array.constructor)(n*r);for(let a=0;a<n;a++){let n=t.getX(a)*r;for(let t=0;t<r;t++)i[a*r+t]=e.array[n+t]}return new vn(i,r,e.normalized)}static getLineEndPointsByIndex(e,t){var n,r,i;let a=t=>{let n=e.geometry.attributes.position.array;return e.localToWorld(new q(n[3*t],n[3*t+1],n[3*t+2]))};e.updateWorldMatrix(!0,!1);let s=(null==(n=e.geometry.getIndex())?void 0:n.array)||[],o=null!=(r=s[t])?r:t,l=null!=(i=s[t+1])?i:t+1;return[a(o),a(l)]}static arePolygonsIntersect(e,t){if(0===e.length||0===t.length||(fce.setFromPoints(e),dce.setFromPoints(t),!fce.intersectsBox(dce)))return!1;for(let n=0;n<e.length;){if(this.isPointInPolygon(e[n],t,!0))return!0;n<e.length-1&&Bt.areVector2sEqual(e[n+1],e[n])&&++n,++n}return!1}static getLineLineIntersectionPoint(e,t,n,r,i=.001){let a=t.clone().sub(e).normalize(),s=r.clone().sub(n).normalize();if(Math.abs(a.dot(s))>1-i)return;let o=t.y-e.y,l=e.x-t.x,h=o*e.x+l*e.y,u=r.y-n.y,c=n.x-r.x,d=u*n.x+c*n.y,p=o*c-u*l;return Math.abs(p)<i?void 0:new Te((c*h-l*d)/p,(o*d-u*h)/p)}static getOffsetPoint(e,t,n){let r=t.x-e.x,i=t.y-e.y,a=n/Math.sqrt(r*r+i*i);return new Te(-a*i,a*r)}static convertSimpleWidthLineToMeshGeometry(e,t){let n,r,i,a=!1,s=!1,o=[],l=[],h=new Te,u=new Te,c=new Te,d=new Te,p=[],f=t/2;for(let t=0,m=e.length-1;t<m;t++)a=!t,s=t===e.length-2,n=this.getOffsetPoint(e[t],e[t+1],f),h=new Te(e[t].x+n.x,e[t].y+n.y),u=new Te(e[t+1].x+n.x,e[t+1].y+n.y),c=new Te(e[t].x-n.x,e[t].y-n.y),d=new Te(e[t+1].x-n.x,e[t+1].y-n.y),a||(r=this.getLineLineIntersectionPoint(o[0],o[1],h,u),void 0!==r?p.unshift(r):p.unshift(h),i=this.getLineLineIntersectionPoint(l[0],l[1],c,d),void 0!==i?p.push(i):p.push(c)),a&&(p.unshift(h),p.push(c)),s&&(p.unshift(u),p.push(d)),s||(o=[h,u],l=[c,d]);if(p.length<3)return;let m=Ds.triangulateShape(p,[]),g=[];for(let e=0;e<m.length;e++)g.push(...m[e]);let v=(new Nt).setFromPoints(p);return v.setIndex(g),v}static convertWidthLineToMeshGeometry(e,t){if(e.length<2)return;let n=[];e.forEach((e=>{n.push([e.x,e.y])}));try{let{indices:e,position:r}=cce([n],{lineWidth:t,depth:1}),i=new Nt;return i.setAttribute("position",new Wt(r,3)),i.setIndex(Array.from(e)),i}catch(e){return}}static releaseGeometryManually(e){e.index=null,e.attributes={}}static getAdjacentNonRepeatPoints(e,t=1e-7){let n=[],r=e.length;for(let i=0;i<r-1;i++)Bt.areVector3sEqual(e[i],e[i+1],t)||n.push(e[i]);return n.push(e[r-1]),n}static mergeBBoxes(e){let t=[...e];if(t.length<2)return t;let n=[],r=[];for(let e=0;e<t.length;e++){let i=t[e];if(!r.includes(e)){for(let e=0;e<t.length;e++){let n=t[e];i.equals(n)||i.intersectsBox(n)&&(i.union(n),r.push(e))}n.push(i)}}return n}},vce={NavCube:{front:"Front",back:"Back",top:"Top",bottom:"Bottom",left:"Left",right:"Right"},ContextMenu:{viewFitAll:"View Fit All",hideAll:"Hide All",showAll:"Show All",xRayAll:"X-Ray",xRayNone:"X-Ray None",selectNone:"Select None",resetView:"Reset View",viewFitEntity:"View Fit",hideEntity:"Hide",hideOthers:"Hide Others",xRayEntity:"X-Ray",xRayOthers:"X-Ray Others",select:"Select",deselect:"Undo Select",showSectionPlane:"Show Section Plane",showSectionBox:"Show Section Box",showAxisSection:"Show Axis Section",hideSectionPlane:"Hide Section Plane",hideSectionBox:"Hide Section Box",hideAxisSection:"Hide Axis Section",undoSection:"Undo Section"},ProgressBar:{Loading:"Loading",Comparing:"Comparing"},Toolbar:{homeView:"Home",orthoView:"Ortho View",measurement:"Measure",distanceMeasurement:"Distance",areaMeasurement:"Area",angleMeasurement:"Angle",coordinateMeasurement:"Coordinate",clearMeasurement:"Clear",markupVisibility:"Markup Visibility",markup:"Markup",markupArrow:"Arrow",markupRect:"Rect",markupCloudRect:"CloudRect",markupPolyLine:"PolyLine",markupCloudLine:"CloudLine",markupEllipse:"Ellipse",markupCircle:"Circle",markupDot:"Dot",markupText:"Text",markupX:"X",markupStroke:"Stroke Style",markupLineWidth:"Line Width",markupLineWidth2:"Line Width 2",markupLineWidth5:"Line Width 5",markupLineWidth10:"Line Width 10",markupFontSize:"Font Size",markupFontSize14:"14",markupFontSize18:"18",markupFontSize24:"24",clearMarkup:"Clear Markup",quitMarkup:"Quit markup",section:"Section",axisSection:"Axis Section",pickSectionPlane:"Pick Section Plane",sectionBox:"Section Box",bimTree:"BIM Tree",viewpoint:"Viewpoint",annotation:"Annotation",property:"Property",settings:"Settings",compared:"Compared",quitCompare:"Quit compare",fullscreen:"Full Screen",layers:"Layers",zoomToRectangle:"Zoom",screenshot:"Screenshot"},Tooltip:{measure:"Pick a point to continue, pressing ESC to exit",areaMeasurement:"Pick a point to continue, pressing ESC to exit, click start point to finish",section:"Click to pick a section plane",boxSelect:"Box select an area to confirm the screenshot range",pickMarkup:"Click on a markup to confirm the screenshot range"},PopPanel:{reset:"Reset"}},yce={NavCube:{front:"å",back:"å",top:"ä¸",bottom:"ä¸",left:"å·¦",right:"å³"},ContextMenu:{viewFitAll:"ç¼©æ¾è§å£å°æææ¨¡å",hideAll:"å¨é¨éè",showAll:"å¨é¨æ¾ç¤º",xRayAll:"å¨é¨åºç¨ X åæ¨¡å¼",xRayNone:"æ¸é¤ X åæ¨¡å¼",selectNone:"æ¸ç©ºéæ©",resetView:"éç½®è§å¾",viewFitEntity:"ç¼©æ¾è§å£å°å®ä½",hideEntity:"éè",hideOthers:"éèå¶ä» (éç¦»)",xRayEntity:"åºç¨ X åæ¨¡å¼",xRayOthers:"å¯¹å¶ä»å®ä½åºç¨ X åæ¨¡å¼",select:"éæ©",deselect:"åæ¶éæ©",showSectionPlane:"æ¾ç¤ºååé¢",showSectionBox:"æ¾ç¤ºååç",showAxisSection:"æ¾ç¤ºè½´ååå",hideSectionPlane:"éèååé¢",hideSectionBox:"éèååç",hideAxisSection:"éèè½´ååå",undoSection:"åæ¶åå"},ProgressBar:{Loading:"æ­£å¨å è½½",Comparing:"æ­£å¨å¯¹æ¯"},Toolbar:{homeView:"ä¸»è§å¾",orthoView:"æ­£äº¤è§å¾",measurement:"æµé",distanceMeasurement:"è·ç¦»æµé",areaMeasurement:"é¢ç§¯æµé",angleMeasurement:"è§åº¦æµé",coordinateMeasurement:"åæ æµé",clearMeasurement:"æ¸é¤æµé",markupVisibility:"æ¹æ³¨æ¾é",markup:"æ¹æ³¨",markupArrow:"ç®­å¤´",markupRect:"ç©å½¢æ¡",markupCloudRect:"äºçº¿æ¡",markupPolyLine:"å¤æ®µçº¿",markupCloudLine:"äºçº¿",markupEllipse:"æ¤­å",markupCircle:"å",markupDot:"ç¹",markupText:"æå­",markupX:"åå·",markupStroke:"ç»ç¬é¢è²",markupLineWidth:"çº¿å®½",markupLineWidth2:"çº¿å®½ 2",markupLineWidth5:"çº¿å®½ 5",markupLineWidth10:"çº¿å®½ 10",markupFontSize:"å­å·",markupFontSize14:"14",markupFontSize18:"18",markupFontSize24:"24",clearMarkup:"æ¸é¤æ¹æ³¨",quitMarkup:"éåºæ¹æ³¨",section:"åå",axisSection:"è½´ååå",pickSectionPlane:"é¢åå",sectionBox:"ååç",bimTree:"BIMæ ",viewpoint:"è§ç¹",annotation:"æ¹æ³¨",property:"å±æ§",settings:"è®¾ç½®",compared:"å¾çº¸å¯¹æ¯",quitCompare:"éåºå¾çº¸å¯¹æ¯",fullscreen:"å¨å±",layers:"å¾å±",zoomToRectangle:"æ¡éæ¾å¤§",screenshot:"æªå±"},Tooltip:{measure:"ç¹å»ç»§ç»­æµé, ESC åæ¶æµé",areaMeasurement:"ç¹å»ç»§ç»­æµé, ESC åæ¶æµéï¼ç¹å»èµ·ç¹å®ææµé",section:"ç¹å»ç¡®å®ååé¢",boxSelect:"æ¡éä¸ä¸ªåºåä»¥ç¡®å®æªå¾èå´",pickMarkup:"ç¹å»ä¸ä¸ªæ¹æ³¨ä»¥ç¡®å®æªå¾èå´"},PopPanel:{reset:"éç½®"}},Fs=class{static materialEquals(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(e instanceof Ir&&t instanceof Ir){let n=e,r=t;return e.alphaTest===t.alphaTest&&e.opacity===t.opacity&&e.side===t.side&&e.visible===t.visible&&e.name===t.name&&e.transparent===t.transparent&&this.colorEquals(n.color,r.color)&&this.colorEquals(n.emissive,r.emissive)&&n.roughness===r.roughness&&n.metalness===r.metalness&&n.alphaMap===r.alphaMap&&n.uniforms===r.uniforms&&n.defines===r.defines&&n.vertexShader===r.vertexShader&&n.fragmentShader===r.fragmentShader&&n.clippingPlanes===r.clippingPlanes&&n.map===r.map&&n.clipIntersection===r.clipIntersection}return!1}static materialsEquals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(let n=0;n<e.length;++n)if(!this.materialEquals(e[n],t[n]))return!1;return!0}return e instanceof Ir&&t instanceof Ir&&this.materialEquals(e,t)}static colorEquals(e,t){return e===t||e instanceof Ot&&t instanceof Ot&&e.equals(t)}static clonedHighlightMaterials(e,t={}){if(!e||!e.material)return;let n=e.material;if(Array.isArray(n)&&n.length>0){let e=[];return n.forEach((n=>{e.push(this.clonedHighlightMaterial(n,t))})),e}if(n instanceof Ir)return this.clonedHighlightMaterial(n,t);console.warn(`[MaterialUtils] Invalid material: ${n}`)}static clonedHighlightMaterial(e,t={}){let{depthTest:n,highlightColor:r=new Ot(583902),opacity:i=.7}=t,a=e.clone();return this.setMaterialColor(a,r),a.opacity=i,a.transparent=!0,void 0!==n&&(a.depthTest=n,a.side=Mr),a}static cloneMaterial(e){if(!e)return e;if(Array.isArray(e)){let t=[];return e.forEach((e=>{t.push(e.clone())})),t}return e.clone()}static getMaterialColor(e){let t=new Ot(16777215);return e instanceof Wi||e instanceof gr||e instanceof mr?t=e.color:e instanceof fr&&e.uniforms.u_color&&(t=e.uniforms.u_color.value),t}static setMaterialColor(e,t){var n,r,i;let a=e;null==(n=a.color)||n.set(t),null==(r=a.emissive)||r.set(t),null!=(i=a.uniforms)&&i.u_color&&a.uniforms.u_color.value.set(t)}static setMaterialOpacity(e,t){var n;let r=e;r.transparent=!0,r.opacity=t,null!=(n=r.uniforms)&&n.opacity&&(r.uniforms.opacity.value=t)}static cloneMaterials(e){let t=new Map;e.traverse((e=>{e.material&&(e.material=(e=>{let n;return Array.isArray(e)?(n=[],e.forEach((e=>{if(t.has(e))n.push(t.get(e));else{let r=e.clone();t.set(e,r),n.push(r)}}))):e&&(t.has(e)?n=t.get(e):(n=e.clone(),t.set(e,n))),n})(e.material))}))}};function ri(e,t=!1){let n=null!==e[0].index,r=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},s={},o=e[0].morphTargetsRelative,l=new Nt,h=0;for(let u=0;u<e.length;++u){let c=e[u],d=0;if(n!==(null!==c.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in c.attributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(c.attributes[e]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in c.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(c.morphAttributes[e])}if(t){let e;if(n)e=c.index.count;else{if(void 0===c.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;e=c.attributes.position.count}l.addGroup(h,e,u),h+=e}}if(n){let t=0,n=[];for(let r=0;r<e.length;++r){let i=e[r].index;for(let e=0;e<i.count;++e)n.push(i.getX(e)+t);t+=e[r].attributes.position.count}l.setIndex(n)}for(let e in a){let t=xce(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(let e in s){let t=s[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let n=0;n<t;++n){let t=[];for(let r=0;r<s[e].length;++r)t.push(s[e][r][n]);let r=xce(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(r)}}return l}function xce(e){let t,n,r,i=-1,a=0;for(let s=0;s<e.length;++s){let o=e[s];if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===n&&(n=o.itemSize),n!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===r&&(r=o.normalized),r!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===i&&(i=o.gpuType),i!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;a+=o.count*n}let s=new t(a),o=new vn(s,n,r),l=0;for(let t=0;t<e.length;++t){let r=e[t];if(r.isInterleavedBufferAttribute){let e=l/n;for(let t=0,i=r.count;t<i;t++)for(let i=0;i<n;i++){let n=r.getComponent(t,i);o.setComponent(t+e,i,n)}}else s.set(r.array,l);l+=r.count*n}return void 0!==i&&(o.gpuType=i),o}function bce(e,t=1e-4){t=Math.max(t,Number.EPSILON);let n={},r=e.getIndex(),i=e.getAttribute("position"),a=r?r.count:i.count,s=0,o=Object.keys(e.attributes),l={},h={},u=[],c=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let t=0,n=o.length;t<n;t++){let n=o[t],r=e.attributes[n];l[n]=new r.constructor(new r.array.constructor(r.count*r.itemSize),r.itemSize,r.normalized);let i=e.morphAttributes[n];i&&(h[n]||(h[n]=[]),i.forEach(((e,t)=>{let r=new e.array.constructor(e.count*e.itemSize);h[n][t]=new e.constructor(r,e.itemSize,e.normalized)})))}let p=.5*t,f=Math.log10(1/t),m=Math.pow(10,f),g=p*m;for(let t=0;t<a;t++){let i=r?r.getX(t):t,a="";for(let t=0,n=o.length;t<n;t++){let n=o[t],r=e.getAttribute(n),s=r.itemSize;for(let e=0;e<s;e++)a+=~~(r[c[e]](i)*m+g)+","}if(a in n)u.push(n[a]);else{for(let t=0,n=o.length;t<n;t++){let n=o[t],r=e.getAttribute(n),a=e.morphAttributes[n],u=r.itemSize,p=l[n],f=h[n];for(let e=0;e<u;e++){let t=c[e],n=d[e];if(p[n](s,r[t](i)),a)for(let e=0,r=a.length;e<r;e++)f[e][n](s,a[e][t](i))}}n[a]=s,u.push(s),s++}}let v=e.clone();for(let t in e.attributes){let e=l[t];if(v.setAttribute(t,new e.constructor(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)),t in h)for(let e=0;e<h[t].length;e++){let n=h[t][e];v.morphAttributes[t][e]=new n.constructor(n.array.slice(0,s*n.itemSize),n.itemSize,n.normalized)}}return v.setIndex(u),v}var Jst=new q(0,1,0),pl=class{static resetObjectStyle(e){this.revertWireframeMode(e),this.revertObjectOpacity(e,[]),this.revertAppliedMaterialToObject(e),this.revertVisibleForFloors(e)}static resetObjectStyleById(e,t){let n=this.getObjectById(e,t);this.resetObjectStyle(n)}static setObjectOpacity(e,t=.3,n,r){let i=[],a=e=>{i.find((t=>t.id===e.id))||(i.push({id:e.id,opacity:e.opacity,transparent:e.transparent,side:e.side}),e.opacity*=t,e.transparent=!0,e.side=Mr)},s=e=>{let n=i.find((t=>t.id===e.id));if(!n){let n=e.clone();return i.push({id:e.id,opacity:e.opacity,transparent:e.transparent,side:e.side,material:e,clonedMaterial:n}),n.opacity*=t,n.transparent=!0,n}return n.clonedMaterial};return e.traverse((e=>{if((!r||-1===r.indexOf(e.id))&&(!n||-1!==n.indexOf(e.id))&&e instanceof Jt){let t=e;if(n||r){if(Array.isArray(t.material)){let e=[];t.material.forEach((t=>{let n=s(t);n&&e.push(n)})),t.material=e}else if(t.material){let e=s(t.material);e&&(t.material=e)}}else if(Array.isArray(t.material))t.material.forEach((e=>{a(e)}));else if(t.material){let e=t.material;a(e)}}})),i}static revertObjectOpacity(e,t,n,r){let i=new Set,a=e=>{if(!e||null==e.id||i.has(e.id))return;i.add(e.id);let n=t.find((t=>t.id===e.id));n&&(e.opacity=n.opacity,e.transparent=n.transparent,e.side=n.side,0===e.opacity&&fe.warn(`[ObjectUtils] Material '${e.name}'s opacity is 0, you may not be able to see your objects!`))},s=e=>{let n=t.find((t=>t.clonedMaterial&&t.clonedMaterial.id===e.id));if(n)return n.material};e.traverse((e=>{if((!r||-1===r.indexOf(e.id))&&(!n||-1!==n.indexOf(e.id))&&e instanceof Jt)if(Array.isArray(e.material)){let t=[];e.material.forEach((e=>{let n=s(e);n?t.push(n):a(e)})),e.material=t}else if(e.material){let t=s(e.material);t?e.material=t:a(e.material)}}))}static setObjectOpacityById(e,t,n=.3,r,i){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);return pl.setObjectOpacity(a,n,r,i)}static revertObjectOpacityById(e,t,n,r,i){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);pl.revertObjectOpacity(a,n,r,i)}static applyMaterialToObject(e,t,n,r){e.traverse((e=>{r&&-1!==r.indexOf(e.id)||n&&-1===n.indexOf(e.id)||e instanceof Jt&&(e.userData.originalMaterial||(e.userData.originalMaterial=e.material),e.material=t)}))}static revertAppliedMaterialToObject(e,t,n){e.traverse((e=>{n&&-1!==n.indexOf(e.id)||t&&-1===t.indexOf(e.id)||e.userData.originalMaterial&&(e.material=e.userData.originalMaterial,e.userData.originalMaterial=void 0)}))}static applyMaterialToObjectById(e,t,n,r,i){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);this.applyMaterialToObject(a,n,r,i)}static revertAppliedMaterialToObjectById(e,t,n,r){let i=e.getObjectById(t);if(!i)throw new Error(`Failed to find object by id: ${t}`);this.revertAppliedMaterialToObject(i,n,r)}static applyOpacityMaterialToObject(e,t,n){let r=new mr({color:0,transparent:!0,opacity:.05});this.applyMaterialToObject(e,r,t,n)}static setDoubleSidedMaterialToObject(e){let t=e=>{e.side!==Mr&&(null==e.userData.originalSide&&(e.userData.originalSide=e.side),e.side=Mr)};e.traverse((e=>{e instanceof Jt&&(Array.isArray(e.material)?e.material.forEach((e=>{t(e)})):e.material instanceof Ir&&t(e.material))}))}static revertDoubleSidedMaterialToObject(e){let t=e=>{null!=e.userData.originalSide&&(e.side=e.userData.originalSide,e.userData.originalSide=void 0)};e.traverse((e=>{e instanceof Jt&&(Array.isArray(e.material)?e.material.forEach((e=>{t(e)})):e.material instanceof Ir&&t(e.material))}))}static setWireframeMode(e){let t=new mr({color:16732160,wireframe:!0,transparent:!0,opacity:.8});e.traverseVisible((e=>{if(e instanceof Jt){let n=e;n.userData.materialForWireframe=n.material,n.material=t}}))}static setWireframeModeById(e,t){let n=e.getObjectById(t);if(!n)throw new Error(`Failed to find object by id: ${t}`);pl.setWireframeMode(n)}static revertWireframeMode(e){e.traverseVisible((e=>{e instanceof Jt&&e.userData.materialForWireframe&&(e.material=e.userData.materialForWireframe,e.userData.materialForWireframe=void 0)}))}static revertWireframeModeById(e,t){let n=e.getObjectById(t);if(!n)throw new Error(`Failed to find object by id: ${t}`);pl.revertWireframeMode(n)}static findInner(e,t,n=[],r=!1){let i=t.toLowerCase(),a=[],s=e=>-1!==e.toLowerCase().indexOf(i),o=e=>-1!==e.toString().indexOf(i),l=e=>{if(e.name&&-1!==e.name.toLowerCase().indexOf(i))return!0;if(e.gltfExtensions){let t=e.gltfExtensions,n=t.objectId&&t.objectId.Value||t.elementId&&t.elementId.Value;if(n&&-1!==n.toLowerCase().indexOf(i))return!0}return!1};if(n.length>0)for(let t=0;t<n.length;++t){let i=n[t],h=e.getObjectById(i);if(h&&h.traverse((e=>{(s(e.name)||o(e.id)||l(e.userData))&&a.push(e)})),r&&a.length>0)return[a[0]]}else if(e.traverse((e=>{(s(e.name)||o(e.id)||l(e.userData))&&a.push(e)})),r&&a.length>0)return[a[0]];return a}static find(e,t,n=[],r=!1){return this.findInner(e,t,n,r)}static findFirst(e,t,n=[],r=!1){let i=this.findInner(e,t,n,r);if(i.length>0)return i[0]}static getFloorsFromString(e){let t=[],n=new RegExp(/(?:-?(?:\d+(?:\.5)?)F)(?=\W|$)/,"g").exec(e);return n&&n.length>0&&n.forEach((e=>{if(e){let n=e.replace("F",""),r=Number(n);r?t.push(r):console.log(`[OU] invalid floor: ${e}`)}})),t}static matchFloor(e,t){return-1!==this.getFloorsFromString(e).findIndex((e=>e===t))}static matchFloors(e,t){return-1!==this.getFloorsFromString(e).findIndex((e=>-1!==t.findIndex((t=>t===e))))}static distinctFloors(e,t){let n=[],r=e=>{this.getFloorsFromString(e).forEach((e=>{n[e]=!0}))};return t.forEach((t=>{let n=e.getObjectById(t);n&&n.traverse((e=>{if(r(e.name),e.userData.gltfExtensions){let t=e.userData.gltfExtensions;t.level&&t.level.Value&&r(t.level.Value)}}))})),Object.keys(n).sort()}static traverseObjectByFloors(e,t,n,r,i){let a=e.getObjectById(t);if(!a)return[];a.traverse((e=>{let t=this.matchFloors(e.name,n);if(!t&&e.userData&&e.userData.gltfExtensions){let r=e.userData.gltfExtensions;r.level&&r.level.Value&&(t=this.matchFloors(r.level.Value,n))}t&&r&&r(e),!t&&i&&i(e)}))}static setVisibleForFloors(e,t,n,r=!0){this.traverseObjectByFloors(e,t,n,(e=>{let t=e;for(;t;)t.visible=!0,t=t.parent||void 0}),(e=>{r&&(e.visible=!1)}))}static revertVisibleForFloors(e){e.traverse((e=>{e.visible=!0}))}static revertVisibleForFloorsById(e,t){let n=this.getObjectById(e,t);this.revertVisibleForFloors(n)}static getObjectById(e,t){let n=e.getObjectById(t);if(!n)throw new Error(`Failed to find object by id: ${t}`);return n}static createOutlines(e){return Et(this,arguments,(function*(e,t={onlyVisible:!0,meshOnly:!0},n){if(!e)return[];if(0===e.children.length&&(t.onlyVisible&&!e.visible||t.meshOnly&&!(e instanceof Jt)))return[];let r=[],i=e,a=i.children.length,s=Math.round(Math.pow(a,.5)),o=Ct.getUpdateProgressFuncAsync(n);for(let e=a-1;e>=0;--e){let o,l=a-e-1;if(n&&(l%s==0||0===l||l===a-1)){let e=90*l/a,t=90*(l+1)/a;o=Ct.getUpdateSubProgressFunc(e,t,n)}let h=i.children[e],u=yield this.createOutlines(h,t,o);r.push(...u)}if(!i.geometry)return yield o(100),r;if(i instanceof Jt&&!this.hasOutline(i,!1)){yield o(50);let e=this.createOutline(i.geometry);i.add(e),e.updateWorldMatrix(!0,!1),r.push(e)}return yield o(100),r}))}static removeOutlines(e){if(e&&Array.isArray(e.children))for(let t=e.children.length-1;t>=0;--t){let n=e.children[t];n.children.length>0&&this.removeOutlines(n),n.userData.isOutline&&e.remove(n)}}static hasOutline(e,t=!0){let n=!1;for(let r=0;r<e.children.length;++r){let i=e.children[r];if(i.userData.isOutline){n=!0;break}if(t&&i.children.length>0&&(n=this.hasOutline(i),n))break}return n}static setOutlinesVisibility(e,t){e.traverse((e=>{e.userData.isOutline&&(e.visible=t)}))}static createOutline(e,t=this.OUTLINE_MATERIAL,n){let r=new fh(e,GM),i=new ni(r,t);return i.layers.enableAll(),pl.disableLayerChannels(i,[12,11]),i.userData.isOutline=!0,i.matrixAutoUpdate=!1,n&&i.applyMatrix4(n),i}static cloneObject(e,t=!0){let n=e.clone();return t&&n.traverse((e=>{(e instanceof Jt||e instanceof ti)&&(e.material=Fs.cloneMaterial(e.material))})),n}static createBox(e,t,n,r=pl.BOX_FACE_MATERIAL,i=!0){let a=[],s=(e,t,n)=>{a.push(new q(e,t,n))};s(0,0,0),s(e,0,0),s(e,t,0),s(0,t,0),s(0,0,n),s(e,0,n),s(e,t,n),s(0,t,n);let o=new Nt;o.setFromPoints(a);let l=[0,3,2,0,2,1,4,6,7,4,5,6,0,7,3,0,4,7,3,6,2,3,7,6,1,6,5,1,2,6];return i&&l.push(0,5,4,0,1,5),o.setIndex(l),o.computeVertexNormals(),new Jt(o,r)}static rebaseObjectOnRTC(e){let t=e;if(!((t.isMesh||t.isLine||t.isPoints)&&t.geometry&&t.geometry instanceof Nt))return e;let n=t.geometry;if(!n.hasAttribute("position"))return e;let r=n.getAttribute("position");if(0===r.count)return e;let i=r.itemSize,a=r.array,s=[];for(let e=0;e<i;e++)s.push(a[e]);for(let e=0;e<r.count;e++)for(let t=0;t<i;t++)a[e*i+t]-=s[t];e.updateMatrix();let o=e.matrix.clone();e.matrix.makeTranslation(s[0],s[1],s.length>2?s[2]:0);let l=e.matrixAutoUpdate;return e.matrixAutoUpdate=!1,e.applyMatrix4(o),e.matrixAutoUpdate=l,e}static isEmptyObject(e){if(0===e.children.length){let t=e.geometry;if(!t||!t.hasAttribute("position")||0===t.getAttribute("position").count)return!0}return!1}static removeEmptyObjects(e){for(let t=0;t<e.children.length;)this.removeEmptyObjects(e.children[t])||++t;return!!this.isEmptyObject(e)&&(e.removeFromParent(),!0)}static removeEmptyObjectsFromRemovingObjects(e,t){0!==e.length&&(e.forEach((e=>{e.removeFromParent()})),this.removeEmptyObjects(t))}static setSharedVariablesOfObject(e){e.uuid="",e.up=Jst;let t=e;t.material&&(Array.isArray(t.material)?t.material.forEach((e=>{e.uuid&&(e.uuid="")})):t.material.uuid&&(t.material.uuid=""))}static isLeafObject(e){return(e instanceof Jt||e instanceof ti||e instanceof Ni)&&!!e.geometry}static enableLayerChannels(e,t,n=!0){for(let n=0,r=t.length;n<r;n++)e.layers.enable(t[n]);if(n){let n=e.children;for(let e=0,r=n.length;e<r;e++)pl.enableLayerChannels(n[e],t,!0)}}static disableLayerChannels(e,t,n=!0){for(let n=0,r=t.length;n<r;n++)e.layers.disable(t[n]);if(n){let n=e.children;for(let e=0,r=n.length;e<r;e++)pl.disableLayerChannels(n[e],t,!0)}}static setLayerChannels(e,t,n=!0){e.layers.disableAll();for(let n=0,r=t.length;n<r;n++)e.layers.enable(t[n]);if(n){let n=e.children;for(let e=0,r=n.length;e<r;e++)pl.setLayerChannels(n[e],t,!0)}}static isObjectHittable(e){return e.layers.isEnabled(10)}static isObjectSnapable(e){return e.layers.isEnabled(11)}static isObjectSelectable(e){return e.layers.isEnabled(12)}},yr=pl;yr.OUTLINE_MATERIAL=new gr({name:"outline",color:0,transparent:!0,opacity:.2}),yr.BOX_FACE_MATERIAL=new pg({color:11648971,transparent:!0,opacity:.3,side:Os});var eA=new At,Qst=new At,tA=class{static resetMergeInfo(){this.MergeInfo.removedObjects=0,this.MergeInfo.mergedMeshes=0,this.MergeInfo.mergedLines=0,this.MergeInfo.mergedPoints=0,this.MergeInfo.mergedUnknownTypeObjects=0,this.MergeInfo.elapsedTime=0}static merge(e,t=!0){let n=Date.now();this.mergeInner(e,t),this.MergeInfo.elapsedTime+=Date.now()-n}static mergeInner(e,t=!0){if(!e.children||e.children.length<1)return;let n=e.children.length,r={},i=[];for(let a=0;a<n;++a){let n=e.children[a];if(n.children.length>0){this.mergeInner(n,t);continue}if(n.isInstancedMesh||!n.geometry||!(n.geometry instanceof Nt))continue;let s=!1,o=Object.values(r);for(let t=o.length-1;t>=0;--t){let n=o[t].indexes[0];if(s=this.tryHandleMergeableObjects(e,a,n,r,i),s)break}for(let t=i.length-1;!s&&t>=0;--t){let n=i[t];if(s=this.tryHandleMergeableObjects(e,a,n,r,i),s)break}s||i.push(a)}if(Object.keys(r).length<=0)return;let a=[],s=[],o=[],l=[];Object.values(r).forEach((n=>{let r,i=n.indexes,h=e.children[i[0]],u=[],c=0,d=0,p=0,f=[];if(i.forEach((n=>{var r,i,a;let s=e.children[n],o=s.geometry.clone();if(o.applyMatrix4(s.matrix),Gt.tryConvertInterleavedBufferAttributes(o),o.userData.isLineSegments=!0===s.isLineSegments,u.push(o),t){let e=s.name,t=null==(i=null==(r=o.attributes)?void 0:r.position)?void 0:i.count,n=(null==(a=o.index)?void 0:a.count)||0,l={batchId:c,name:e,positionStart:d,positionCount:t,indexStart:p,indexCount:n};0!==Object.keys(s.userData).length&&(l.userData=s.userData),f.push(l),d+=t,p+=n,c++}})),0!==u.length){if(h.isMesh){let e=ri(u);if(!e)return;e.userData={},r=new Jt(e,h.material),a.push(r)}else if(h.isLine){let e=this.mergeLineGeometries(u,t,h.material instanceof Kl||h.material instanceof fr,f);if(!e)return;r=new ni(e,h.material),s.push(r)}else if(h.isPoints){let e=ri(u);if(!e)return;e.userData={},r=new Ni(e,h.material),o.push(r)}r&&(t?r.userData.batches=f:(r.userData=h.userData,r.userData.batches=void 0),r.userData.layerName=h.userData.layerName,r.name=`[Merged] ${h.name}`,r.matrixAutoUpdate=!1,r.renderOrder=h.renderOrder,r.layers.mask=h.layers.mask,r.visible=h.visible,l.push(...i)),u.forEach((e=>{e.dispose(),Gt.releaseGeometryManually(e)})),u=[]}})),l.sort(((e,t)=>t-e)),l.forEach((t=>{let n=e.children[t];e.remove(n)})),[...a,...s,...o].forEach((t=>{e.add(t)})),e.updateMatrix(),this.MergeInfo.removedObjects+=l.length,this.MergeInfo.mergedMeshes+=a.length,this.MergeInfo.mergedLines+=s.length,this.MergeInfo.mergedPoints+=o.length}static tryHandleMergeableObjects(e,t,n,r,i){let a=!1,s=Array.isArray(e),o=s?e.length:e.children.length;if(t===n||t>=o||n>=o)return a;let l=s?e[t]:e.children[t],h=s?e[n]:e.children[n];return this.areObjectsMergeable(l,h)&&this.areGeometriesMergeable(l.geometry,h.geometry)&&Fs.materialsEquals(l.material,h.material)&&(r[n]||(r[n]={indexes:[n]},this.removeFromArray(i,n)),r[n].indexes.push(t),a=!0),a}static deepMerge(e,t=void 0,n=!0,r=!0,i=!0){let a={added:[],removed:[]};if(e.length<=1)return a;let s=Date.now(),o={},l=[];for(let t=0;t<e.length;++t){let n=e[t];if(n.isInstancedMesh||!n.geometry||!(n.geometry instanceof Nt))continue;let r=!1,i=Object.values(o);for(let n=i.length-1;n>=0;--n){let a=i[n].indexes[0];if(r=this.tryHandleMergeableObjects(e,t,a,o,l),r)break}for(let n=l.length-1;!r&&n>=0;--n){let i=l[n];if(r=this.tryHandleMergeableObjects(e,t,i,o,l),r)break}r||l.push(t)}if(Object.keys(o).length<=0)return a;fe.debug(`[Merge] Built merged indexes for ${e.length} objects in ${(Date.now()-s)/1e3}s`),s=Date.now();let h=[],u=[],c=[],d=[];Object.values(o).forEach((n=>{let r=n.indexes;if(r.length<2)return;let a,s=e[r[0]],o=[],l=0,p=0,f=0,m=[];if(r.forEach((n=>{var r,a,h;let u=e[n],c=u.geometry.clone();if(s.material instanceof gr&&c.deleteAttribute("lineDistance"),this.applyMatrix(c,u,t),c.userData.isLineSegments=!0===u.isLineSegments,o.push(c),i){let e,t=u.name,n=null==(a=null==(r=c.attributes)?void 0:r.position)?void 0:a.count,i=(null==(h=c.index)?void 0:h.count)||0;s.isLine&&(c.boundingSphere||c.computeBoundingSphere(),e=c.boundingSphere.clone());let o={batchId:l,name:t,positionStart:p,positionCount:n,indexStart:f,indexCount:i,boundingSphere:e};!u.parent.geometry&&0!==Object.keys(u.parent.userData).length&&(o.parentUserData=u.parent.userData),0!==Object.keys(u.userData).length&&(o.userData=u.userData),m.push(o),p+=n,f+=i,l++}})),0!==o.length){if(s.isMesh){let e=ri(o);if(!e)return;e.userData={},a=new Jt(e,s.material),h.push(a)}else if(s.isLine){let e=this.mergeLineGeometries(o,i,s.material instanceof Kl||s.material instanceof fr,m);if(!e)return;a=new ni(e,s.material),u.push(a)}else if(s.isPoints){let e=ri(o);if(!e)return;e.userData={},a=new Ni(e,s.material),c.push(a)}a&&(i?a.userData.batches=m:(a.userData=s.userData,a.userData.batches=void 0),a.userData.layerName=s.userData.layerName,a.name=`[Merged] ${s.name}`,a.matrixAutoUpdate=!1,a.renderOrder=s.renderOrder,a.layers.mask=s.layers.mask,a.visible=s.visible,r.forEach((e=>d.push(e)))),o.forEach((e=>{e.dispose(),Gt.releaseGeometryManually(e)})),o=[]}})),fe.debug(`[Merge] Ran deepMerge() in ${(Date.now()-s)/1e3}s`);let p=a.removed;d.forEach((t=>{let r=e[t];p.push(r),n&&r.removeFromParent()}));let f=a.added;return[...h,...u,...c].forEach((e=>{f.push(e),n&&t&&(t.add(e),e.updateWorldMatrix(!1,!1))})),this.MergeInfo.removedObjects+=d.length,this.MergeInfo.mergedMeshes+=h.length,this.MergeInfo.mergedLines+=u.length,this.MergeInfo.mergedPoints+=c.length,r&&t&&yr.removeEmptyObjects(t),a}static applyMatrix(e,t,n){let r=t;for(eA.identity();r&&r!==n&&(eA.premultiply(r.matrix),r.parent);)r=r.parent;return eA.equals(Qst)?e:e.applyMatrix4(eA)}static mergeLineGeometries(e,t,n,r){let i;if(n)i=tA.mergeBufferGeometriesWithLinesToLineSegments(e,t,r);else{if(i=ri(e),!i)return;i.userData={};let n=[],a=0;e.forEach(((e,i)=>{let s=e.attributes.position;if(!s)return;let o=e.index,l=!0===e.userData.isLineSegments,h=n.length;if(o)for(let e=0;e<o.count;e++){let t=o.array[e];l?n.push(a+t):e>0&&n.push(a+o.array[e-1],a+t)}else for(let e=0;e<s.count;e++)e>0&&(l?e%2==1&&n.push(a+e-1,a+e):n.push(a+e-1,a+e));a+=s.count,t&&r&&(r[i].indexStart=h,r[i].indexCount=n.length-h)})),i.setIndex(n)}return i}static mergeBufferGeometriesWithLinesToLineSegments(e,t,n){let r=new Set(Object.keys(e[0].attributes)),i={},a=new Nt,s=[],o=0;for(let a=0;a<e.length;++a){let l=e[a],h=!0===l.userData.isLineSegments;s.push(h),l.index&&(fe.debug(`[Merge] Geometry '${a}' contains index buffer, going to convert it to non-indexed.`),l=Gt.convertGeometryWithIndexedToNonIndexed(l));let u=0;for(let e in l.attributes){if(!r.has(e))return void fe.error(`[Merge] mergeGeometries() failed with geometry at index ${a}. All geometries must have compatible attributes; make sure ${e} attribute exists among all geometries, or in none of them`);i[e]||(i[e]=[]),i[e].push(l.attributes[e]),u++}if(u!==r.size)return void fe.error(`[Merge] mergeGeometries() failed with geometry at index ${a}. Make sure all geometries have the same number of attributes.`);if(t&&n){let e=l.attributes.position;n[a].indexStart=0,n[a].indexCount=0;let t=h?e.count:2*e.count-2;n[a].positionStart=o,n[a].positionCount=t,o+=t}}for(let e in i){let t=tA.mergeBufferAttributesWithLinesToLineSegments(i[e],s);if(!t)return void fe.error(`[Merge] mergeGeometries() failed while trying to merge the ${e} attribute.`);a.setAttribute(e,t)}return a}static mergeBufferAttributesWithLinesToLineSegments(e,t){let n,r,i,a=0;for(let s=0;s<e.length;++s){let o=e[s];if(void 0===n&&(n=o.array.constructor),n!==o.array.constructor)return void fe.error("[Merge] mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes.");if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return void fe.error("[Merge] mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes.");if(void 0===i&&(i=o.normalized),i!==o.normalized)return void fe.error("[Merge]  mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes.");let l=t[s]?0:o.count-2;a+=(o.count+l)*r}let s=new n(a),o=0;for(let r=0;r<e.length;++r){let i=t[r],a=e[r],l=i?0:a.count-2,h=a.count+l,u=a.itemSize,c=new n(h*u),d=0;for(let e=0;e<a.count;e++){let t=e*u,n=0!==e&&e!==a.count-1&&!i;for(let e=0;e<u;e++)c[d+e]=a.array[t+e],n&&(c[d+u+e]=a.array[t+e]);d+=n?2*u:u}s.set(c,o),o+=h*u}return new vn(s,r,i)}static removeFromArray(e,t){for(let n=e.length-1;n>=0;--n)if(e[n]===t)return void e.splice(n,1)}static removeObjectFromArray(e,t){for(let n=e.length-1;n>=0;--n)if(e[n]===t)return void e.splice(n,1)}static areGeometriesMergeable(e,t){if(!e||!t||"InstancedBufferGeometry"===e.type||"InstancedBufferGeometry"===t.type||!!e.index!=!!t.index)return!1;let n=Object.keys(e.attributes);if(n.length!==Object.keys(t.attributes).length)return!1;for(let e of n)if(!t.attributes[e])return!1;return!0}static areObjectsMergeable(e,t){if(e.layers.mask!==t.layers.mask||e.renderOrder!==t.renderOrder||e.visible!==t.visible||e.userData.layerName!==t.userData.layerName)return!1;if(e.type===t.type)return!0;let n=e,r=t;return n.isMesh&&r.isMesh||n.isLine&&r.isLine||n.isPoints&&r.isPoints}static isMergedMesh(e){return!(!e||!e.userData.batches)}static isFaceIndexInBatch(e,t,n){if(e.boundsTree){let r=e.index.getX(3*n);if(r>=t.positionStart&&r<t.positionStart+t.positionCount)return!0}else if(e.index){let e=t.indexStart/3,r=(t.indexStart+t.indexCount)/3-1;if(n>=e&&n<=r)return!0}else{let e=3*n;if(e>=t.positionStart&&e<t.positionStart+t.positionCount)return!0}return!1}static getBatchByFaceIndex(e,t){if(t<0)return void fe.error(`[Merge]: Invalid faceIndex: ${t}`);let n=e&&e.geometry&&e.userData.batches;if(n)for(let r=0;r<n.length;++r){let i=n[r];if(this.isFaceIndexInBatch(e.geometry,i,t))return i}}static getBatchByLineIndex(e,t){if(t<0)return void fe.error(`[Merge]: Invalid index: ${t}`);let n=e&&e.geometry&&e.userData.batches;if(!n)return;let r=e.geometry.index;for(let e=0;e<n.length;++e){let i=n[e];if(r){if(t>=i.indexStart&&t<i.indexStart+i.indexCount)return i}else if(t>=i.positionStart&&t<i.positionStart+i.positionCount)return i}}static getBatchIdByFaceIndex(e,t){let n=this.getBatchByFaceIndex(e,t);return n?n.batchId:-1}static getBatchByBatchId(e,t){let n=e&&e.geometry&&e.userData.batches;if(n)for(let e=0;e<n.length;++e){let r=n[e];if(r.batchId===t)return r}}static cloneGeometryForBatch(e,t){var n;let r=e&&e.geometry;if(!r)return;let i=r.attributes.position,a=null==i?void 0:i.array,s=null==(n=r.index)?void 0:n.array;if(!a||!s)return void fe.warn(`[Merge]: Unexpected position: ${a}, or index: ${s}!`);let o=new Nt,l=t.positionStart,h=t.positionStart+t.positionCount,u=r.attributes;for(let e in u){let t=u[e],n=t.itemSize,r=t.array.slice(l*n,h*n);o.setAttribute(e,new vn(r,n,t.normalized))}if(r.boundsTree&&(s=r.userData.originalIndex,!s))return void fe.warn("[Merge] After building bvh, the original index data is not preserved !");let c=t.indexStart,d=t.indexStart+t.indexCount,p=[],f=0;for(let e=c;e<d&&e<s.length;++e)p[f++]=s[e]-t.positionStart;return o.setIndex(p),r.boundingBox&&o.computeBoundingBox(),r.boundingSphere&&o.computeBoundingSphere(),o}},bi=tA;bi.MergeInfo={removedObjects:0,mergedMeshes:0,mergedLines:0,mergedPoints:0,mergedUnknownTypeObjects:0,elapsedTime:0};var jce=ca(Hce(),1),zce={triangulate:function(e,t,n=2){let r,i,a,s,o,l,h,u=t&&t.length,c=u?t[0]*n:e.length,d=qce(e,0,c,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=Lat(e,t,d,n)),e.length>80*n){r=a=e[0],i=s=e[1];for(let t=n;t<c;t+=n)o=e[t],l=e[t+1],o<r&&(r=o),l<i&&(i=l),o>a&&(a=o),l>s&&(s=l);h=Math.max(a-r,s-i),h=0!==h?32767/h:0}return Ky(d,p,n,r,i,h,0),p}};function qce(e,t,n,r,i){let a,s;if(i===Wat(e,t,n,r)>0)for(a=t;a<n;a+=r)s=Vce(a,e[a],e[a+1],s);else for(a=n-r;a>=t;a-=r)s=Vce(a,e[a],e[a+1],s);return s&&uA(s,s.next)&&(Qy(s),s=s.next),s}function Od(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!uA(r,r.next)&&0!==di(r.prev,r,r.next))r=r.next;else{if(Qy(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Ky(e,t,n,r,i,a,s){if(!e)return;!s&&a&&Uat(e,r,i,a);let o,l,h=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?Iat(e,r,i,a):Pat(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Qy(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?Ky(e=Dat(Od(e),t,n),t,n,r,i,a,2):2===s&&Oat(e,t,n,r,i,a):Ky(Od(e),t,n,r,i,a,1);break}}function Pat(e){let t=e.prev,n=e,r=e.next;if(di(t,n,r)>=0)return!1;let i=t.x,a=n.x,s=r.x,o=t.y,l=n.y,h=r.y,u=i<a?i<s?i:s:a<s?a:s,c=o<l?o<h?o:h:l<h?l:h,d=i>a?i>s?i:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=c&&f.y<=p&&zg(i,o,a,l,s,h,f.x,f.y)&&di(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Iat(e,t,n,r){let i=e.prev,a=e,s=e.next;if(di(i,a,s)>=0)return!1;let o=i.x,l=a.x,h=s.x,u=i.y,c=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=u<c?u<d?u:d:c<d?c:d,m=o>l?o>h?o:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,v=nF(p,f,t,n,r),y=nF(m,g,t,n,r),x=e.prevZ,b=e.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&zg(o,u,l,c,h,d,x.x,x.y)&&di(x.prev,x,x.next)>=0||(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&zg(o,u,l,c,h,d,b.x,b.y)&&di(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==s&&zg(o,u,l,c,h,d,x.x,x.y)&&di(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==i&&b!==s&&zg(o,u,l,c,h,d,b.x,b.y)&&di(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Dat(e,t,n){let r=e;do{let i=r.prev,a=r.next.next;!uA(i,a)&&Gce(i,r,r.next,a)&&Jy(i,a)&&Jy(a,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(a.i/n|0),Qy(r),Qy(r.next),r=e=a),r=r.next}while(r!==e);return Od(r)}function Oat(e,t,n,r,i,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&zat(s,e)){let o=Wce(s,e);return s=Od(s,s.next),o=Od(o,o.next),Ky(s,t,n,r,i,a,0),void Ky(o,t,n,r,i,a,0)}e=e.next}s=s.next}while(s!==e)}function Lat(e,t,n,r){let i,a,s,o,l,h=[];for(i=0,a=t.length;i<a;i++)s=t[i]*r,o=i<a-1?t[i+1]*r:e.length,l=qce(e,s,o,r,!1),l===l.next&&(l.steiner=!0),h.push(Vat(l));for(h.sort(kat),i=0;i<h.length;i++)n=Fat(h[i],n);return n}function kat(e,t){return e.x-t.x}function Fat(e,t){let n=Nat(e,t);if(!n)return t;let r=Wce(n,e);return Od(r,r.next),Od(n,n.next)}function Nat(e,t){let n,r=t,i=-1/0,a=e.x,s=e.y;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let e=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=a&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===a))return n}r=r.next}while(r!==t);if(!n)return null;let o,l=n,h=n.x,u=n.y,c=1/0;r=n;do{a>=r.x&&r.x>=h&&a!==r.x&&zg(s<u?a:i,s,h,u,s<u?i:a,s,r.x,r.y)&&(o=Math.abs(s-r.y)/(a-r.x),Jy(r,e)&&(o<c||o===c&&(r.x>n.x||r.x===n.x&&Bat(n,r)))&&(n=r,c=o)),r=r.next}while(r!==l);return n}function Bat(e,t){return di(e.prev,e,t.prev)<0&&di(t.next,e,e.next)<0}function Uat(e,t,n,r){let i=e;do{0===i.z&&(i.z=nF(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,Hat(i)}function Hat(e){let t,n,r,i,a,s,o,l,h=1;do{for(n=e,e=null,a=null,s=0;n;){for(s++,r=n,o=0,t=0;t<h&&(o++,r=r.nextZ,r);t++);for(l=h;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,h*=2}while(s>1);return e}function nF(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Vat(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function zg(e,t,n,r,i,a,s,o){return(i-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(r-o)>=(n-s)*(t-o)&&(n-s)*(a-o)>=(i-s)*(r-o)}function zat(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!qat(e,t)&&(Jy(e,t)&&Jy(t,e)&&Gat(e,t)&&(di(e.prev,e,t.prev)||di(e,t.prev,t))||uA(e,t)&&di(e.prev,e,e.next)>0&&di(t.prev,t,t.next)>0)}function di(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function uA(e,t){return e.x===t.x&&e.y===t.y}function Gce(e,t,n,r){let i=cA(di(e,t,n)),a=cA(di(e,t,r)),s=cA(di(n,r,e)),o=cA(di(n,r,t));return!!(i!==a&&s!==o||0===i&&lA(e,n,t)||0===a&&lA(e,r,t)||0===s&&lA(n,e,r)||0===o&&lA(n,t,r))}function lA(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function cA(e){return e>0?1:e<0?-1:0}function qat(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Gce(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Jy(e,t){return di(e.prev,e,e.next)<0?di(e,t,e.next)>=0&&di(e,e.prev,t)>=0:di(e,t,e.prev)<0||di(e,e.next,t)<0}function Gat(e,t){let n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function Wce(e,t){let n=new rF(e.i,e.x,e.y),r=new rF(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Vce(e,t,n,r){let i=new rF(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Qy(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function rF(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wat(e,t,n,r){let i=0;for(let a=t,s=n-r;a<n;a+=r)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}var jat=.01,Ld=class{static getFaces(e){let t=e.map((e=>e.toArray())).reduce(((e,t)=>(e.push(...t),e)),[]),n=[];return zce.triangulate(t,[],3).forEach((e=>n.push(e))),n}static arePointsCoplanar(e){if(e.length<4)return!0;let t=e[1].clone().sub(e[0]),n=e[2].clone().sub(e[0]).cross(t).normalize();for(let t=3;t<e.length;t++)if(e[t].clone().sub(e[0]).projectOnVector(n).length()>jat)return!1;return!0}static isSelfIntersecting(e){let t=e.map((e=>e.toArray().slice(0,-1)));return(0,jce.default)(t).length>0}},nc=class{static getVisibleObjectBoundingBox(e){let t=new Ft;return e.traverse((e=>{e.visible&&(e instanceof Jt||e instanceof ti)&&yr.isObjectSelectable(e)&&t.expandByObject(e)})),t}static getObjectsBoundingBox(e,t,n){let r=new Ft;return t.forEach((t=>{let i=e.getObjectById(t);if(i){let e=nc.getBoundingBox(i,n);e.isEmpty()||r.union(e)}})),r}static getBoundingBox(e,t=!0){let n=new Ft;if(e instanceof wo)return nc.getInstancedMeshBoundingBox(e);if(0===e.children.length)return n.expandByObject(e),n;let r=e.children.length,i=1;r>20&&(i=3),r>100&&(i=5),r>200&&(i=10),r>1e3&&(i=100),e.updateMatrixWorld(!1);for(let a=0;a<r;++a){let r=e.children[a];if(!t||a%i==0)if(r.updateMatrix(),r instanceof wo){let e=nc.getInstancedMeshBoundingBox(r);e.isEmpty()||n.union(e)}else if(Ct.isMatrixValid(r.matrixWorld)){let e=nc.getBoundingBox(r);e.isEmpty()||n.union(e)}else console.warn(`[SceneUtils] Found object(${r.type}) with invalid matrix: ${r.matrixWorld.elements}`)}return e.geometry&&n.expandByObject(e),n}static getInstancedMeshBoundingBox(e){let t=new Ft,n=new At;for(let r=0;r<e.count;++r){e.getMatrixAt(r,n);let i=e.geometry.clone();if(i.boundingBox){let e=i.boundingBox.applyMatrix4(n);!e.isEmpty()&&Ct.isBoxValid(e)&&t.union(e)}}return t.applyMatrix4(e.matrixWorld),t}static getObjectCenter(e,t){let n=nc.getBoundingBox(e);n.getCenter(t),t.y=n.min.y}},rc=class{static setMaterialSection(e,t,n=!1,r=!1){let i=n&&e.clippingPlanes?e.clippingPlanes:[];i.push(...t),e.clippingPlanes=i,e.clipIntersection=r}static removeSection(e){e&&e.traverse((e=>{let t=e.material;Array.isArray(t)?t.forEach((e=>{e.clippingPlanes=[]})):t&&(t.clippingPlanes=[])}))}static addSection(e,t,n=!1,r=!1){e&&e.traverse((e=>{let i=e.material;Array.isArray(i)?i.forEach((e=>{rc.setMaterialSection(e,t,n,r)})):i&&rc.setMaterialSection(i,t,n,r)}))}static generateSectionPlanesByBox(e){let t=e.min,n=e.max;return[new Oi(new q(0,-1,0),n.y),new Oi(new q(0,1,0),-t.y),new Oi(new q(1,0,0),-t.x),new Oi(new q(-1,0,0),n.x)]}static generateSectionPlanesByPoints(e,t=!0){let n=e.length;if(n<2)return;let r=[];for(let i=0;i<n-1;i++){let a=e[i],s=e[(i+1)%n],o=new Oi;o.setFromCoplanarPoints(new q(a.x,a.y,-1),new q(a.x,a.y,0),new q(s.x,s.y,0)),t||o.negate(),r.push(o)}return r}},iF=new q,Xce=new q,hA=class{modify(e,t){delete(e=e.clone()).morphAttributes.position,delete e.morphAttributes.normal;let n=e.attributes;for(let t in n)"position"!==t&&"uv"!==t&&"normal"!==t&&"tangent"!==t&&"color"!==t&&e.deleteAttribute(t);let r=[],i=[],a=(e=bce(e)).getAttribute("position"),s=e.getAttribute("uv"),o=e.getAttribute("normal"),l=e.getAttribute("tangent"),h=e.getAttribute("color"),u=null,c=null,d=null,p=null;for(let e=0;e<a.count;e++){let t=(new q).fromBufferAttribute(a,e);s&&(c=(new Te).fromBufferAttribute(s,e)),o&&(d=(new q).fromBufferAttribute(o,e)),l&&(u=(new hr).fromBufferAttribute(l,e)),h&&(p=(new Ot).fromBufferAttribute(h,e));let n=new sF(t,c,d,u,p);r.push(n)}let f=e.getIndex();if(null!==f)for(let e=0;e<f.count;e+=3){let t=f.getX(e),n=f.getX(e+1),a=f.getX(e+2),s=new fA(r[t],r[n],r[a],t,n,a);i.push(s)}else for(let e=0;e<a.count;e+=3){let t=e,n=e+1,a=e+2,s=new fA(r[t],r[n],r[a],t,n,a);i.push(s)}for(let e=0,t=r.length;e<t;e++)$ce(r[e]);let m,g=t;for(;g--;){if(m=Kat(r),!m){console.log("THREE.SimplifyModifier: No next vertex");break}Zat(r,i,m,m.collapseNeighbor)}let v=new Nt,y=[],x=[],b=[],_=[],w=[];f=[];for(let e=0;e<r.length;e++){let t=r[e];y.push(t.position.x,t.position.y,t.position.z),t.uv&&x.push(t.uv.x,t.uv.y),t.normal&&b.push(t.normal.x,t.normal.y,t.normal.z),t.tangent&&_.push(t.tangent.x,t.tangent.y,t.tangent.z,t.tangent.w),t.color&&w.push(t.color.r,t.color.g,t.color.b),t.id=e}for(let e=0;e<i.length;e++){let t=i[e];f.push(t.v1.id,t.v2.id,t.v3.id)}return v.setAttribute("position",new Wt(y,3)),x.length>0&&v.setAttribute("uv",new Wt(x,2)),b.length>0&&v.setAttribute("normal",new Wt(b,3)),_.length>0&&v.setAttribute("tangent",new Wt(_,4)),w.length>0&&v.setAttribute("color",new Wt(w,3)),v.setIndex(f),v}};function Xat(e,t){-1===e.indexOf(t)&&e.push(t)}function kd(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}function Yat(e,t){let n=t.position.distanceTo(e.position),r=0,i=[];for(let n=0,r=e.faces.length;n<r;n++){let r=e.faces[n];r.hasVertex(t)&&i.push(r)}for(let t=0,n=e.faces.length;t<n;t++){let n=1,a=e.faces[t];for(let e=0;e<i.length;e++){let t=i[e],r=a.normal.dot(t.normal);n=Math.min(n,(1.001-r)/2)}r=Math.max(r,n)}return i.length<2&&(r=1),n*r+0}function $ce(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(let t=0;t<e.neighbors.length;t++){let n=Yat(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=n,e.minCost=n,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=n,n<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=n)}e.collapseCost=e.totalCost/e.costCount}function Yce(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){kd(e.neighbors.pop().neighbors,e)}kd(t,e)}function $at(e,t){kd(t,e),e.v1&&kd(e.v1.faces,e),e.v2&&kd(e.v2.faces,e),e.v3&&kd(e.v3.faces,e);let n=[e.v1,e.v2,e.v3];for(let e=0;e<3;e++){let t=n[e],r=n[(e+1)%3];!t||!r||(t.removeIfNonNeighbor(r),r.removeIfNonNeighbor(t))}}function Zat(e,t,n,r){if(!r)return void Yce(n,e);r.uv&&n.uv.copy(r.uv),r.normal&&r.normal.add(n.normal).normalize(),r.tangent&&r.tangent.add(n.tangent).normalize();let i=[];for(let e=0;e<n.neighbors.length;e++)i.push(n.neighbors[e]);for(let e=n.faces.length-1;e>=0;e--)n.faces[e]&&n.faces[e].hasVertex(r)&&$at(n.faces[e],t);for(let e=n.faces.length-1;e>=0;e--)n.faces[e].replaceVertex(n,r);Yce(n,e);for(let e=0;e<i.length;e++)$ce(i[e])}function Kat(e){let t=e[0];for(let n=0;n<e.length;n++)e[n].collapseCost<t.collapseCost&&(t=e[n]);return t}var fA=class{constructor(e,t,n,r,i,a){this.a=r,this.b=i,this.c=a,this.v1=e,this.v2=t,this.v3=n,this.normal=new q,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(n),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(n),n.faces.push(this),n.addUniqueNeighbor(e),n.addUniqueNeighbor(t)}computeNormal(){let e=this.v1.position,t=this.v2.position,n=this.v3.position;iF.subVectors(n,t),Xce.subVectors(e,t),iF.cross(Xce).normalize(),this.normal.copy(iF)}hasVertex(e){return e===this.v1||e===this.v2||e===this.v3}replaceVertex(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),kd(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}},sF=class{constructor(e,t,n,r,i){this.position=e,this.uv=t,this.normal=n,this.tangent=r,this.color=i,this.id=-1,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(e){Xat(this.neighbors,e)}removeIfNonNeighbor(e){let t=this.neighbors,n=this.faces,r=t.indexOf(e);if(-1!==r){for(let t=0;t<n.length;t++)if(n[t].hasVertex(e))return;t.splice(r,1)}}},Zce=class{static simplifyGeometry(e,t){let n=this.getNumberOfVerticesToRemove(e,t);return n>0?(new hA).modify(e,n):e}static getNumberOfVerticesToRemove(e,t){let n=0;e instanceof Nt&&e.index&&(n=e.attributes.position.count);let r=Math.floor(n*t);return n<20?0:r}},dA=class extends Cn{constructor(e){super(),this.isSVGObject=!0,this.node=e}},c3t=10,Jce=(e=>(e.TripleCross="TripleCross",e.Square="Square",e.Triangle="Triangle",e.CircleWithCross="CircleWithCross",e.Cross="Cross",e.Perpendicular="Perpendicular",e))(Jce||{}),Kce=class{static createSVGObject(e){return new dA(e)}},pA=class extends My{constructor(e){super(e),this.type=ja}parse(e){let t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},n=function(e,t,n){t=t||1024;let r=e.pos,i=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(i=o.indexOf("\n"))&&a<t&&r<e.byteLength;)s+=o,a+=o.length,r+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return-1<i&&(!1!==n&&(e.pos+=a+i+1),s+o.slice(0,i))},r=function(e,t,n,r){let i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=e[t+0]*a,n[r+1]=e[t+1]*a,n[r+2]=e[t+2]*a,n[r+3]=1},i=function(e,t,n,r){let i=e[t+3],a=Math.pow(2,i-128)/255;n[r+0]=Tg.toHalfFloat(Math.min(e[t+0]*a,65504)),n[r+1]=Tg.toHalfFloat(Math.min(e[t+1]*a,65504)),n[r+2]=Tg.toHalfFloat(Math.min(e[t+2]*a,65504)),n[r+3]=Tg.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;let s,o,l,h=function(e){let r,i,a=/^#\?(\S+)/,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,h=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for((e.pos>=e.byteLength||!(r=n(e)))&&t(1,"no header found"),(i=r.match(a))||t(3,"bad initial token"),u.valid|=1,u.programtype=i[1],u.string+=r+"\n";r=n(e),!1!==r;)if(u.string+=r+"\n","#"!==r.charAt(0)){if((i=r.match(s))&&(u.gamma=parseFloat(i[1])),(i=r.match(o))&&(u.exposure=parseFloat(i[1])),(i=r.match(l))&&(u.valid|=2,u.format=i[1]),(i=r.match(h))&&(u.valid|=4,u.height=parseInt(i[1],10),u.width=parseInt(i[2],10)),2&u.valid&&4&u.valid)break}else u.comments+=r+"\n";return 2&u.valid||t(3,"missing format specifier"),4&u.valid||t(3,"missing image size specifier"),u}(a),u=h.width,c=h.height,d=function(e,n,r){let i=n;if(i<8||i>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);i!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");let a=new Uint8Array(4*n*r);a.length||t(4,"unable to allocate buffer space");let s=0,o=0,l=4*i,h=new Uint8Array(4),u=new Uint8Array(l),c=r;for(;c>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),h[0]=e[o++],h[1]=e[o++],h[2]=e[o++],h[3]=e[o++],(2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=i)&&t(3,"bad rgbe scanline format");let n,r=0;for(;r<l&&o<e.byteLength;){n=e[o++];let i=n>128;if(i&&(n-=128),(0===n||r+n>l)&&t(3,"bad scanline data"),i){let t=e[o++];for(let e=0;e<n;e++)u[r++]=t}else u.set(e.subarray(o,o+n),r),r+=n,o+=n}let d=i;for(let e=0;e<d;e++){let t=0;a[s]=u[e+t],t+=i,a[s+1]=u[e+t],t+=i,a[s+2]=u[e+t],t+=i,a[s+3]=u[e+t],s+=4}c--}return a}(a.subarray(a.pos),u,c);switch(this.type){case ns:l=d.length/4;let e=new Float32Array(4*l);for(let t=0;t<l;t++)r(d,4*t,e,4*t);s=e,o=ns;break;case ja:l=d.length/4;let t=new Uint16Array(4*l);for(let e=0;e<l;e++)i(d,4*e,t,4*e);s=t,o=ja;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:u,height:c,data:s,header:h.string,gamma:h.gamma,exposure:h.exposure,type:o}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,(function(e,n){switch(e.type){case ns:case ja:e.colorSpace=fl,e.minFilter=Dr,e.magFilter=Dr,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)}),n,r)}},qg=class{static createEnvTexture(e,t){return Et(this,null,(function*(){let n=new pA;return new Promise((r=>{n.load(t,(t=>{if(e){let n=e.fromEquirectangular(t).texture;e.dispose(),r(n)}}))}))}))}static createEnvTextureFromDataArray(e){return Et(this,arguments,(function*(e,t=this.HDR_CITY_STREET_64x32,n=64,r=32){if(e){let i=new ba(t,n,r);i.flipY=!0,i.magFilter=Dr,i.minFilter=Dr,i.type=ja,i.version=1;let a=e.fromEquirectangular(i).texture;return e.dispose(),Promise.resolve(a)}return Promise.reject("Invalid pmremGenerator!")}))}};function Jat(){if(Bn.isBrowser){let e=document.createElement("div");return e.setAttribute("style","height: 1in; visibility: hidden; position: absolute; margin: 0; padding: 0;"),document.body.appendChild(e),.0254/e.clientHeight}return.0254/96}qg.HDR_CITY_STREET_64x32=Uint16Array.from([11910,12340,12797,15360,11926,12348,12806,15360,11958,12364,12814,15360,11974,12380,12830,15360,11958,12364,12822,15360,11926,12348,12797,15360,11878,12324,12773,15360,11830,12308,12749,15360,11798,12292,12733,15360,11782,12279,12725,15360,11765,12263,12709,15360,11749,12247,12701,15360,11733,12231,12701,15360,11701,12215,12693,15360,11685,12199,12685,15360,11685,12199,12685,15360,11701,12215,12693,15360,11717,12231,12701,15360,11733,12247,12709,15360,11749,12263,12717,15360,11749,12279,12717,15360,11765,12279,12725,15360,11765,12279,12725,15360,11765,12292,12725,15360,11798,12300,12733,15360,11830,12316,12749,15360,11846,12324,12757,15360,11894,12340,12781,15360,11926,12356,12797,15360,11942,12356,12797,15360,11926,12348,12789,15360,11926,12348,12789,15360,11942,12356,12797,15360,11942,12356,12797,15360,11942,12348,12806,15360,11942,12356,12806,15360,11942,12356,12814,15360,11958,12372,12830,15360,11974,12372,12830,15360,11974,12372,12838,15360,11990,12388,12854,15360,12055,12420,12886,15360,12119,12452,12918,15360,12167,12476,12950,15360,12231,12500,12982,15360,12263,12516,12998,15360,12231,12500,12974,15360,12199,12484,12958,15360,12199,12484,12958,15360,12199,12492,12966,15360,12247,12508,12982,15360,12247,12508,12990,15360,12231,12500,12982,15360,12199,12484,12966,15360,12167,12468,12942,15360,12119,12444,12918,15360,12087,12436,12902,15360,12055,12420,12886,15360,12055,12412,12878,15360,12039,12412,12878,15360,12022,12396,12862,15360,12006,12388,12846,15360,11958,12364,12830,15360,11910,12340,12806,15360,12119,12508,13103,15360,12087,12484,13071,15360,12055,12468,13046,15360,12006,12436,13006,15360,11926,12396,12958,15360,11878,12364,12926,15360,11846,12348,12894,15360,11782,12308,12854,15360,11749,12292,12830,15360,11717,12263,12814,15360,11685,12247,12806,15360,11669,12215,12789,15360,11685,12231,12789,15360,11701,12247,12797,15360,11701,12247,12806,15360,11717,12263,12814,15360,11749,12292,12822,15360,11782,12308,12838,15360,11798,12316,12846,15360,11814,12332,12862,15360,11846,12340,12870,15360,11862,12348,12878,15360,11846,12340,12870,15360,11846,12340,12862,15360,11878,12356,12886,15360,11910,12372,12910,15360,11942,12396,12934,15360,11958,12412,12958,15360,12039,12452,12998,15360,12071,12468,13022,15360,12039,12452,12998,15360,12039,12452,12998,15360,12006,12444,13006,15360,11974,12436,12998,15360,11942,12412,12982,15360,11926,12396,12974,15360,11926,12404,12974,15360,11958,12420,12998,15360,12006,12452,13038,15360,12055,12476,13071,15360,12039,12476,13079,15360,12087,12508,13127,15360,12247,12597,13231,15360,12388,12693,13332,15360,12420,12741,13364,15360,12436,12757,13372,15360,12468,12773,13380,15360,12500,12806,13388,15360,12516,12822,13404,15360,12629,12934,13452,15360,12741,13046,13508,15360,12806,13095,13532,15360,12757,13046,13516,15360,12645,12950,13460,15360,12565,12870,13428,15360,12532,12838,13412,15360,12549,12854,13412,15360,12516,12838,13396,15360,12452,12757,13356,15360,12420,12725,13340,15360,12404,12709,13332,15360,12372,12677,13316,15360,12279,12589,13207,15360,12135,12516,13119,15360,12388,12709,13348,15360,12247,12581,13223,15360,12055,12476,13087,15360,11910,12388,12982,15360,11733,12308,12886,15360,11669,12247,12846,15360,11621,12199,12814,15360,11541,12103,12765,15360,11492,12055,12733,15360,11508,12055,12733,15360,11476,12022,12717,15360,11525,12055,12725,15360,11589,12135,12757,15360,11669,12199,12765,15360,11765,12292,12814,15360,11862,12348,12886,15360,11910,12372,12910,15360,12006,12420,12966,15360,12071,12452,12998,15360,12119,12476,13022,15360,12167,12492,13046,15360,12183,12500,13063,15360,12199,12524,13079,15360,12308,12589,13151,15360,12300,12581,13151,15360,12167,12516,13087,15360,12087,12468,13030,15360,12022,12444,13014,15360,11990,12420,12990,15360,11974,12420,12990,15360,11974,12420,12990,15360,11990,12436,13014,15360,11990,12444,13030,15360,12103,12500,13103,15360,12087,12508,13111,15360,12039,12484,13103,15360,12039,12476,13103,15360,11942,12436,13054,15360,11974,12452,13087,15360,12039,12492,13135,15360,12103,12532,13199,15360,12183,12581,13263,15360,12308,12661,13340,15360,12484,12822,13436,15360,12613,12918,13484,15360,12725,13046,13540,15360,13046,13332,13677,15360,13143,13380,13717,15360,13223,13420,13741,15360,13396,13540,13862,15360,13436,13589,13902,15360,13484,13629,13942,15360,13468,13621,13934,15360,13412,13564,13878,15360,13372,13524,13846,15360,13287,13452,13781,15360,13223,13428,13749,15360,13340,13492,13805,15360,13239,13428,13749,15360,13095,13364,13685,15360,12918,13223,13597,15360,12822,13111,13556,15360,12613,12934,13468,15360,12532,12854,13428,15360,12565,12870,13444,15360,12468,12789,13396,15360,12372,12693,13340,15360,12087,12492,13111,15360,11846,12364,12958,15360,11717,12300,12878,15360,11557,12135,12781,15360,11476,12055,12741,15360,11460,12022,12725,15360,11476,12022,12725,15360,11476,12022,12709,15360,11476,11958,12605,15360,11364,11733,12332,15360,11111,11412,11661,15360,11223,11476,11773,15360,11388,11669,12095,15360,11765,12119,12492,15360,12388,12613,13079,15360,12661,12902,13356,15360,12998,13255,13564,15360,13372,13508,13797,15360,13412,13548,13846,15360,13287,13436,13725,15360,13271,13428,13709,15360,13287,13428,13717,15360,13014,13287,13597,15360,12709,12998,13460,15360,12452,12741,13332,15360,12364,12653,13271,15360,12404,12693,13316,15360,12420,12709,13316,15360,12420,12709,13332,15360,12263,12589,13231,15360,12332,12661,13312,15360,12300,12629,13295,15360,12263,12605,13287,15360,12231,12597,13279,15360,12247,12613,13303,15360,12231,12597,13295,15360,12231,12605,13312,15360,12199,12597,13324,15360,12231,12613,13340,15360,12516,12870,13468,15360,12725,13063,13564,15360,12741,13079,13573,15360,12854,13175,13613,15360,12902,13223,13629,15360,13046,13348,13693,15360,13356,13516,13846,15360,13605,13765,14078,15360,13717,13870,14191,15360,13765,13918,14255,15360,13765,13910,14247,15360,13701,13854,14191,15360,13573,13733,14070,15360,13508,13677,14006,15360,13380,13548,13886,15360,13111,13380,13741,15360,13063,13348,13709,15360,12886,13207,13629,15360,12725,13046,13548,15360,12645,12966,13508,15360,12677,12982,13508,15360,12629,12950,13492,15360,12452,12789,13412,15360,12324,12661,13332,15360,12356,12677,13340,15360,12388,12693,13348,15360,12279,12597,13247,15360,11894,12396,12998,15360,11637,12231,12846,15360,11573,12135,12789,15360,11589,12151,12797,15360,11621,12167,12797,15360,11637,12119,12677,15360,11079,11404,11693,15360,10517,10701,10653,15360,10252,10348,10007,15360,9902,9999,9428,15360,9846,9886,9047,15360,10135,10260,9685,15360,10412,10533,10412,15360,11268,11436,11549,15360,12364,12605,13087,15360,12444,12709,13255,15360,12549,12822,13348,15360,12613,12886,13396,15360,12597,12886,13412,15360,12581,12870,13404,15360,12661,12950,13460,15360,12725,13014,13492,15360,13079,13332,13645,15360,12757,13046,13500,15360,12677,12982,13476,15360,12854,13143,13556,15360,12693,12982,13492,15360,12581,12886,13452,15360,12709,13030,13508,15360,12372,12709,13364,15360,12324,12661,13348,15360,12292,12645,13340,15360,12292,12645,13348,15360,12468,12806,13436,15360,12532,12854,13460,15360,12500,12854,13468,15360,12500,12854,13484,15360,12725,13063,13589,15360,12982,13324,13701,15360,13111,13388,13741,15360,13014,13340,13709,15360,13014,13332,13717,15360,13287,13476,13862,15360,13436,13621,13974,15360,13532,13717,14095,15360,13725,13902,14295,15360,13942,14103,14420,15360,13974,14135,14436,15360,13862,14022,14388,15360,13725,13894,14295,15360,13789,13958,14336,15360,13830,13990,14348,15360,13372,13548,13942,15360,13014,13332,13733,15360,12886,13239,13661,15360,12854,13207,13637,15360,12757,13095,13589,15360,12757,13079,13573,15360,12645,12982,13516,15360,12629,12966,13532,15360,12549,12870,13468,15360,12356,12693,13372,15360,12151,12549,13231,15360,12215,12573,13247,15360,12199,12565,13231,15360,12071,12492,13135,15360,12055,12468,13087,15360,11878,12372,12958,15360,11685,12199,12781,15360,10774,11159,11412,15360,9533,9621,8870,15360,9308,9340,8071,15360,9276,9300,7878,15360,9324,9332,8420,15360,9191,9216,7991,15360,8950,8983,7766,15360,9493,9525,8677,15360,10252,10332,10007,15360,10661,10846,10894,15360,10701,10926,10998,15360,10950,11276,11428,15360,11364,11637,12063,15360,11958,12388,12926,15360,12183,12540,13175,15360,12340,12645,13295,15360,12420,12693,13316,15360,12757,13030,13460,15360,13046,13324,13645,15360,13095,13348,13677,15360,13303,13460,13781,15360,13207,13404,13741,15360,13127,13372,13717,15360,13372,13524,13862,15360,12693,13030,13540,15360,12725,13046,13548,15360,12468,12822,13436,15360,12263,12629,13348,15360,12436,12773,13428,15360,12693,12998,13524,15360,12725,13046,13564,15360,12645,12982,13556,15360,12613,12966,13556,15360,12886,13255,13685,15360,13436,13629,14022,15360,13637,13813,14231,15360,13621,13789,14215,15360,13878,14038,14412,15360,14022,14183,14468,15360,13926,14119,14452,15360,14054,14231,14508,15360,14135,14311,14540,15360,14348,14436,14669,15360,14460,14540,14749,15360,14404,14484,14709,15360,14420,14500,14709,15360,14653,14717,14894,15360,14119,14279,14508,15360,13484,13669,14078,15360,13063,13380,13773,15360,12677,13079,13613,15360,12484,12886,13516,15360,12436,12822,13476,15360,12468,12838,13476,15360,12039,12532,13316,15360,12231,12613,13340,15360,12468,12789,13436,15360,12388,12725,13396,15360,12135,12557,13287,15360,12151,12557,13271,15360,12039,12484,13175,15360,11878,12396,13038,15360,11814,12348,12950,15360,11492,11894,12460,15360,9950,10103,9621,15360,8830,8838,7220,15360,8565,8533,7015,15360,8541,8501,6919,15360,8332,8300,6822,15360,8412,8372,7220,15360,8710,8701,7686,15360,9372,9404,8549,15360,9533,9621,9079,15360,9268,9292,8196,15360,9452,9460,8167,15360,9533,9581,8533,15360,9742,9870,9316,15360,11460,11814,12348,15360,11942,12388,12902,15360,11749,12167,12573,15360,11300,11492,11621,15360,11974,12332,12669,15360,12436,12741,13364,15360,12597,12886,13460,15360,12966,13271,13653,15360,12998,13303,13669,15360,13476,13629,13974,15360,13733,13886,14239,15360,13364,13524,13894,15360,13063,13356,13725,15360,12982,13287,13669,15360,12484,12806,13444,15360,12565,12902,13500,15360,12950,13287,13693,15360,12934,13271,13677,15360,12693,13046,13589,15360,12661,13030,13605,15360,12870,13271,13717,15360,13348,13548,13966,15360,13621,13813,14271,15360,13797,13974,14412,15360,13942,14119,14484,15360,14263,14388,14629,15360,14420,14508,14733,15360,14460,14548,14773,15360,14982,15046,15231,15360,15564,15580,15669,15360,15974,15982,16078,15360,15805,15821,15926,15360,15460,15476,15572,15360,15436,15460,15556,15360,14781,14862,15127,15360,13621,13813,14348,15360,12789,13207,13757,15360,12452,12886,13581,15360,12263,12709,13476,15360,12039,12597,13396,15360,11942,12516,13340,15360,11846,12468,13271,15360,11733,12380,13127,15360,11926,12460,13191,15360,12055,12524,13263,15360,11878,12428,13159,15360,11605,12231,12886,15360,11412,11990,12709,15360,11508,12103,12789,15360,11637,12231,12854,15360,10661,11079,11380,15360,9541,9685,9252,15360,8573,8605,7493,15360,8404,8388,7348,15360,8830,8822,8212,15360,9308,9324,9095,15360,9324,9364,9220,15360,9047,9119,8653,15360,9023,9055,8404,15360,9055,9063,8167,15360,8870,8846,7541,15360,8862,8806,7380,15360,8950,8910,7252,15360,9268,9284,7557,15360,10316,10468,10380,15360,11239,11476,11677,15360,10653,10942,11047,15360,9661,9814,9324,15360,10693,10958,11047,15360,11396,11653,11990,15360,11878,12292,12597,15360,12468,12789,13396,15360,12773,13095,13589,15360,13364,13516,13894,15360,13894,14054,14380,15360,13717,13870,14247,15360,13420,13589,13958,15360,13255,13452,13830,15360,12806,13143,13637,15360,13159,13412,13830,15360,13629,13813,14215,15360,13303,13500,13910,15360,13079,13396,13805,15360,13191,13452,13878,15360,13412,13621,14062,15360,14103,14279,14540,15360,14773,14854,15086,15360,14717,14805,15046,15360,14295,14420,14685,15360,14380,14476,14733,15360,14572,14661,14902,15360,15596,15612,15701,15360,16351,16335,16384,15360,16484,16476,16492,15360,16516,16500,16516,15360,16388,16375,16404,15360,16054,16054,16118,15360,15918,15926,16006,15360,15556,15572,15669,15360,14653,14725,14982,15360,13637,13838,14319,15360,13412,13613,14054,15360,12870,13287,13789,15360,12404,12838,13524,15360,12199,12677,13428,15360,12324,12741,13452,15360,11942,12516,13324,15360,11765,12380,13111,15360,11428,11942,12589,15360,10886,11388,11902,15360,10372,10717,11006,15360,9846,10240,10191,15360,10252,10549,10766,15360,10613,11079,11484,15360,10581,10998,11388,15360,9613,9846,9629,15360,8525,8557,7541,15360,8605,8613,7814,15360,9292,9324,9079,15360,9388,9396,9220,15360,10709,10846,11031,15360,9894,9966,9854,15360,9252,9236,8774,15360,8822,8790,8183,15360,8292,8260,6533,15360,8111,8007,6324,15360,8228,8183,6405,15360,8501,8501,6565,15360,8814,8878,7172,15360,9260,9364,8244,15360,8902,9095,8252,15360,9444,9581,9047,15360,9509,9637,8790,15360,9477,9613,8806,15360,10725,11063,11079,15360,11508,11910,12356,15360,12484,12789,13380,15360,12838,13159,13629,15360,13428,13589,13974,15360,14135,14279,14484,15360,13942,14087,14396,15360,13677,13846,14247,15360,13436,13613,14006,15360,13597,13781,14183,15360,14183,14340,14540,15360,14022,14215,14484,15360,13637,13838,14271,15360,14038,14231,14508,15360,14380,14476,14701,15360,14757,14854,15078,15360,15030,15111,15343,15360,15420,15452,15556,15360,15476,15500,15588,15360,15351,15388,15492,15360,15572,15596,15677,15360,15653,15669,15717,15360,15821,15821,15853,15360,15845,15845,15869,15360,15998,15990,16022,15360,15926,15926,15974,15360,15653,15669,15733,15360,15661,15677,15749,15360,15612,15629,15717,15360,15271,15335,15452,15360,14484,14572,14821,15360,14215,14372,14588,15360,13468,13677,14167,15360,12773,13175,13653,15360,12725,13143,13637,15360,12452,12886,13532,15360,12263,12709,13444,15360,11894,12436,13103,15360,10252,10533,10661,15360,8613,8693,7445,15360,8742,8782,7047,15360,8420,8412,6565,15360,7926,7910,6405,15360,8806,8854,7300,15360,9127,9228,8007,15360,8685,8750,7300,15360,8348,8356,6758,15360,8380,8340,7300,15360,8991,8918,8388,15360,9838,9790,9549,15360,10055,10127,10047,15360,9501,9493,9268,15360,9332,9292,8902,15360,9079,9007,8509,15360,8300,8260,7252,15360,8693,8701,8196,15360,8228,8212,7111,15360,8469,8501,7380,15360,8420,8501,6919,15360,8549,8645,6983,15360,8581,8661,6951,15360,9268,9332,7718,15360,9063,9207,7445,15360,9284,9380,7718,15360,9412,9557,8693,15360,10276,10517,10103,15360,11830,12279,12589,15360,12725,13079,13589,15360,13127,13396,13773,15360,14087,14231,14460,15360,13974,14119,14412,15360,13677,13854,14247,15360,14119,14279,14500,15360,13990,14167,14460,15360,14364,14452,14653,15360,14564,14653,14837,15360,14404,14492,14701,15360,14870,14942,15135,15360,15388,15420,15500,15360,15207,15287,15420,15360,14797,14894,15127,15360,15271,15335,15452,15360,15926,15942,15990,15360,16207,16207,16231,15360,16118,16110,16126,15360,15741,15733,15741,15360,16239,16207,16175,15360,16444,16460,16484,15360,16046,16022,16006,15360,15942,15950,15966,15360,15773,15789,15829,15360,15789,15797,15845,15360,15693,15709,15757,15360,15540,15564,15653,15360,15303,15364,15468,15360,14733,14813,15014,15360,13862,14054,14420,15360,12838,13255,13725,15360,12789,13207,13693,15360,12468,12918,13564,15360,12404,12838,13500,15360,11428,11862,12412,15360,9143,9276,8388,15360,8541,8533,6726,15360,8444,8428,6629,15360,8212,8183,6597,15360,8388,8380,7015,15360,8726,8710,6758,15360,8332,8316,6437,15360,8453,8428,6565,15360,8597,8605,7814,15360,8701,8661,8151,15360,9452,9396,9015,15360,10581,10557,10380,15360,10950,10974,10846,15360,10380,10356,10252,15360,10749,10741,10685,15360,9870,9854,9693,15360,9023,9039,8669,15360,8790,8854,8509,15360,8196,8167,7332,15360,7975,8015,7079,15360,8589,8750,7445,15360,9095,9260,7111,15360,8983,9135,7188,15360,8902,8991,7252,15360,8862,9007,7015,15360,8967,9111,7300,15360,8742,8878,7493,15360,9557,9999,9549,15360,11292,11613,11862,15360,12135,12468,12982,15360,12215,12460,12878,15360,13356,13468,13685,15360,13821,13934,14199,15360,13548,13701,14022,15360,14103,14263,14468,15360,14279,14388,14572,15360,14364,14452,14645,15360,14709,14789,14950,15360,15143,15199,15327,15360,15388,15412,15468,15360,15476,15500,15548,15360,15420,15444,15492,15360,15436,15460,15516,15360,15612,15637,15685,15360,16086,16086,16110,15360,16396,16388,16396,15360,16094,16094,16110,15360,15869,15861,15861,15360,16135,16110,16070,15360,16428,16420,16404,15360,15588,15556,15524,15360,15484,15500,15508,15360,15335,15364,15396,15360,15677,15685,15717,15360,15604,15621,15661,15360,15420,15444,15500,15360,15303,15372,15452,15360,14717,14805,14998,15360,14412,14508,14701,15360,13548,13765,14199,15360,13271,13508,13942,15360,12661,13159,13709,15360,12468,12854,13436,15360,10260,10484,10509,15360,8613,8669,6951,15360,8151,8143,6469,15360,8653,8629,7814,15360,8469,8444,7541,15360,8718,8693,7814,15360,8372,8332,6597,15360,8356,8308,7111,15360,9047,8983,8396,15360,8822,8798,8308,15360,9372,9348,8967,15360,10364,10364,10183,15360,10268,10260,9894,15360,10541,10533,10468,15360,10380,10364,10276,15360,10621,10613,10549,15360,9910,9942,9758,15360,8364,8380,7621,15360,8581,8637,8135,15360,8252,8300,7573,15360,8119,8175,7300,15360,8372,8453,7493,15360,8420,8501,6983,15360,8742,8822,7573,15360,8782,8854,8151,15360,8581,8661,7079,15360,9220,9268,8340,15360,9549,9645,8854,15360,11717,11950,12127,15360,12468,12741,13207,15360,12709,12966,13388,15360,12300,12508,12886,15360,12492,12709,13063,15360,13239,13372,13548,15360,12476,12597,12814,15360,13581,13685,13878,15360,14476,14548,14685,15360,14556,14629,14773,15360,14765,14829,14966,15360,15159,15207,15303,15360,15372,15396,15444,15360,15516,15532,15572,15360,15653,15661,15693,15360,15829,15837,15853,15360,16022,16014,16022,15360,16311,16295,16279,15360,16343,16319,16303,15360,16412,16388,16359,15360,15813,15797,15773,15360,13063,13151,13183,15360,11484,11701,11798,15360,12300,12412,12468,15360,14613,14637,14653,15360,11974,12215,12316,15360,14135,14215,14303,15360,15604,15629,15677,15360,15524,15548,15596,15360,15351,15380,15428,15360,14797,14894,15054,15360,13990,14231,14500,15360,13492,13709,14070,15360,12886,13316,13701,15360,12613,13207,13749,15360,11525,11974,12428,15360,9284,9412,8629,15360,8597,8653,6951,15360,7806,7790,6292,15360,7589,7541,6437,15360,7485,7437,6597,15360,7453,7404,6180,15360,7774,7686,6565,15360,8300,8260,7332,15360,9918,9942,9862,15360,10348,10372,10231,15360,9725,9709,9228,15360,10613,10621,10509,15360,10199,10175,9838,15360,10380,10388,10340,15360,11207,11255,11284,15360,10661,10717,10725,15360,10103,10135,9950,15360,8444,8436,7669,15360,8469,8501,7445,15360,8950,9111,8854,15360,9485,9798,10071,15360,8364,8501,8039,15360,7959,7951,6806,15360,8597,8605,8039,15360,8501,8533,7557,15360,8758,8830,7509,15360,10758,10830,10693,15360,11508,11605,11621,15360,13524,13669,13886,15360,13830,14022,14327,15360,13926,14103,14364,15360,13460,13621,13886,15360,12854,13191,13420,15360,13597,13733,13926,15360,13846,13990,14223,15360,13773,13942,14199,15360,13910,14087,14356,15360,13813,14022,14319,15360,14247,14396,14540,15360,14693,14765,14878,15360,15223,15279,15343,15360,15508,15524,15540,15360,15540,15548,15564,15360,15327,15335,15319,15360,15303,15311,15303,15360,15918,15910,15886,15360,16247,16207,16151,15360,16175,16143,16086,15360,14436,14452,14436,15360,12263,12380,12404,15360,11476,11701,11773,15360,12380,12492,12532,15360,14797,14797,14757,15360,11372,11589,11677,15360,12597,12934,13356,15360,13990,14364,14725,15360,14183,14444,14773,15360,14231,14444,14717,15360,14412,14532,14709,15360,14054,14199,14380,15360,12372,12500,12605,15360,12199,12565,13006,15360,12581,13175,13653,15360,10055,10380,10324,15360,8557,8573,6726,15360,8167,8196,6533,15360,7517,7485,6119,15360,7244,7172,5798,15360,7071,6959,5718,15360,7669,7581,6260,15360,8661,8605,7975,15360,10942,11079,11151,15360,12573,12741,13014,15360,11902,12030,12191,15360,10308,10332,10135,15360,11255,11300,11284,15360,11276,11348,11396,15360,10055,10215,10292,15360,12183,12332,12468,15360,9918,9966,9798,15360,8734,8742,8196,15360,8967,8950,8469,15360,10260,10276,10039,15360,9734,9758,9605,15360,9388,9404,9308,15360,7943,7878,7095,15360,7726,7637,6645,15360,8047,7983,7204,15360,9284,9236,8693,15360,9621,9565,9143,15360,11255,11268,11047,15360,13175,13332,13420,15360,13773,13934,14175,15360,13854,14022,14271,15360,13870,14038,14279,15360,13388,13516,13677,15360,12279,12629,12966,15360,13348,13452,13564,15360,13821,13918,14054,15360,13701,13846,14022,15360,13460,13605,13781,15360,13492,13637,13821,15360,13709,13821,13950,15360,14372,14428,14476,15360,14516,14572,14613,15360,14741,14789,14813,15360,14725,14749,14749,15360,13452,13484,13468,15360,13476,13500,13492,15360,14990,15022,15022,15360,14556,14572,14564,15360,15094,15111,15094,15360,13231,13287,13215,15360,11255,11380,11175,15360,10677,10886,10492,15360,11846,12006,11934,15360,14327,14340,14279,15360,10766,11039,10862,15360,12918,13255,13452,15360,14231,14548,14886,15360,13878,14380,14765,15360,13444,13862,14412,15360,12151,12404,12621,15360,12637,12902,13215,15360,11549,11749,11870,15360,12279,12653,13119,15360,13223,13404,13516,15360,9228,9260,8276,15360,8087,7991,6308,15360,7918,7814,6919,15360,7469,7364,6148,15360,7485,7380,6212,15360,8228,7991,7204,15360,9276,8967,8212,15360,9806,9573,8742,15360,10135,10087,9621,15360,11452,11452,11452,15360,10629,10637,10509,15360,10693,10733,10637,15360,11095,11111,10982,15360,11292,11348,11372,15360,10199,10244,10167,15360,10814,10926,10846,15360,8669,8774,7493,15360,7870,7910,6244,15360,8204,8183,6919,15360,9806,9758,9159,15360,9460,9436,8629,15360,9159,9087,8260,15360,7637,7509,6790,15360,7758,7629,6838,15360,7967,7918,6774,15360,10854,10749,10501,15360,11508,11412,11316,15360,12372,12300,12151,15360,12030,12119,12063,15360,12781,12910,12982,15360,13476,13581,13661,15360,13484,13589,13677,15360,12404,12428,12380,15360,11605,11765,11798,15360,11492,11533,11452,15360,11838,11886,11798,15360,12263,12372,12380,15360,12151,12231,12175,15360,11492,11508,11412,15360,11119,11111,10838,15360,12508,12581,12573,15360,12621,12693,12677,15360,12573,12629,12589,15360,12292,12324,12231,15360,12476,12565,12573,15360,11998,12159,12215,15360,12950,13071,13159,15360,12263,12372,12428,15360,12380,12428,12444,15360,11300,11308,11143,15360,10199,10244,9734,15360,9709,9701,9252,15360,10492,10581,10404,15360,11476,11516,11388,15360,9477,9517,8790,15360,11717,11854,11838,15360,14247,14420,14524,15360,14054,14311,14436,15360,13597,13805,13982,15360,11364,11533,11597,15360,12263,12428,12549,15360,11436,11605,11653,15360,13079,13324,13444,15360,12516,12613,12605,15360,10039,10015,9605,15360,8693,8621,7878,15360,7951,7862,6902,15360,8196,8204,7015,15360,8677,8589,7637,15360,9284,9031,8340,15360,9814,9605,8902,15360,10685,10428,9910,15360,10492,10260,9685,15360,9404,9252,7943,15360,8830,8766,7220,15360,9220,9047,7943,15360,9693,9669,9015,15360,11412,11468,11372,15360,11135,11159,11023,15360,10087,10055,9428,15360,9910,10007,9621,15360,9236,9300,8934,15360,9597,9557,8902,15360,10669,10549,9782,15360,9926,9870,9127,15360,9894,9918,9047,15360,8685,8742,7910,15360,9958,10167,10284,15360,10215,10332,10396,15360,11396,11428,11452,15360,11223,11255,11300,15360,11814,11862,11958,15360,10685,10846,10870,15360,10340,10380,10007,15360,11175,11207,10894,15360,12103,12207,12215,15360,11143,11103,10902,15360,9910,9966,9613,15360,10015,10079,9493,15360,10806,10846,10517,15360,10862,10934,10637,15360,10838,10942,10661,15360,10958,11087,10878,15360,10709,10838,10701,15360,10669,10741,10589,15360,10581,10669,10525,15360,10252,10348,9974,15360,11396,11500,11525,15360,11207,11255,11264,15360,10878,10910,10934,15360,11031,11063,11159,15360,11292,11324,11396,15360,11223,11255,11300,15360,10693,10685,10645,15360,10428,10420,10324,15360,10300,10252,9991,15360,10838,10846,10798,15360,10428,10428,10364,15360,9669,9605,9380,15360,10167,10244,10087,15360,11709,11854,11910,15360,11223,11284,11268,15360,10231,10244,9878,15360,10199,10244,9862,15360,10183,10260,9942,15360,10525,10653,10541,15360,12500,12597,12621,15360,11814,11741,11597,15360,11533,11460,11175,15360,11103,11006,10557,15360,10444,10396,9846,15360,10007,10023,9228,15360,9653,9790,8469,15360,9316,9372,8039,15360,9557,9830,8071,15360,9621,9918,8071,15360,9677,10015,8167,15360,9991,10284,8420,15360,10215,10436,8581,15360,10260,10484,8645,15360,10292,10476,8902,15360,10324,10468,9252,15360,9910,9894,8886,15360,10525,10573,9701,15360,9782,10039,8581,15360,9565,9814,8167,15360,9950,10039,8934,15360,10749,10758,10199,15360,10669,10685,10244,15360,10838,10838,10460,15360,11215,10910,10087,15360,11492,11364,10806,15360,11095,11159,11055,15360,11364,11388,11356,15360,11023,11039,10990,15360,11653,11653,11613,15360,11798,11725,11557,15360,11974,11862,11637,15360,12039,11942,11765,15360,12119,12047,11934,15360,12151,12071,11950,15360,12087,12006,11886,15360,12047,11966,11838,15360,11990,11926,11790,15360,11974,11910,11798,15360,11998,11934,11814,15360,12111,12039,11886,15360,12231,12143,11998,15360,12292,12199,12039,15360,12039,11974,11846,15360,11822,11782,11653,15360,11862,11838,11765,15360,11798,11765,11701,15360,11782,11733,11669,15360,11798,11749,11685,15360,11838,11790,11725,15360,11870,11822,11749,15360,11741,11701,11621,15360,11565,11541,11452,15360,11533,11500,11412,15360,11621,11581,11484,15360,11605,11557,11460,15360,11516,11468,11372,15360,11565,11533,11444,15360,11677,11637,11541,15360,11725,11661,11557,15360,11725,11661,11557,15360,11733,11669,11573,15360,11838,11773,11677,15360,11998,11926,11814,15360,12014,11926,11798,15360,11460,11404,11332,15360,11637,11557,11428,15360,12014,11894,11693,15360,12167,12022,11765,15360,12119,11982,11709,15360,11926,11806,11516,15360,11685,11589,11300,15360,11476,11404,10886,15360,11239,11151,10468,15360,10766,10733,9894,15360,10565,10565,9589,15360,10436,10444,9332,15360,10308,10308,9031,15360,10308,10316,8999,15360,10199,10244,8774,15360,9725,9645,8549,15360,10244,10276,8967,15360,10878,10838,10183,15360,11055,10966,10348,15360,11119,11006,10404,15360,11264,11135,10565,15360,11404,11316,10822,15360,11492,11388,10982,15360,11798,11613,11223,15360,12047,11830,11412,15360,12039,11894,11597,15360,12127,11990,11693,15360,12127,11990,11725,15360,12191,12055,11806,15360,12191,12055,11830,15360,11870,11773,11613,15360,11573,11516,11428,15360,11533,11484,11412,15360,11541,11492,11420,15360,11565,11516,11452,15360,11589,11541,11476,15360,11605,11557,11500,15360,11637,11589,11533,15360,11669,11621,11557,15360,11701,11645,11573,15360,11733,11669,11589,15360,11798,11717,11605,15360,11838,11749,11621,15360,11878,11782,11661,15360,11894,11798,11661,15360,11926,11806,11653,15360,11958,11822,11661,15360,11982,11846,11677,15360,12006,11870,11685,15360,12095,11950,11765,15360,12047,11910,11741,15360,11886,11765,11605,15360,11838,11733,11589,15360,11814,11717,11589,15360,11814,11709,11573,15360,11790,11693,11565,15360,11741,11677,11589,15360,11733,11677,11613,15360,11733,11685,11629,15360,11717,11669,11621,15360,11685,11645,11589,15360,11629,11589,11533,15360,11573,11525,11468,15360,11492,11444,11380,15360,11316,11255,11111,15360,11348,11292,11143,15360,11516,11436,11316,15360,11854,11749,11589,15360,12127,11990,11765,15360,12199,12055,11782,15360,12340,12231,11910,15360,12372,12292,11958,15360,12380,12300,11974,15360,12348,12247,11910,15360,12324,12215,11878,15360,12247,12103,11773,15360,12095,11958,11637,15360,12055,11926,11613,15360,11974,11854,11541,15360,11870,11765,11468,15360,11966,11854,11541,15360,12300,12151,11846,15360,12396,12316,12006,15360,12388,12308,11990,15360,12388,12308,12006,15360,12396,12316,12022,15360,12396,12308,12022,15360,12396,12308,12022,15360,12364,12279,11974,15360,12340,12247,11942,15360,12340,12231,11926,15360,12215,12071,11806,15360,12095,11966,11749,15360,11741,11645,11500,15360,11420,11356,11255,15360,11364,11308,11207,15360,11356,11300,11175,15360,11348,11292,11191,15360,11372,11324,11255,15360,11412,11364,11308,15360,11420,11372,11316,15360,11428,11380,11324,15360,11444,11388,11332,15360,11484,11428,11364,15360,11508,11460,11396,15360,11557,11500,11436,15360,11589,11533,11460,15360,11613,11557,11484,15360,11621,11557,11492,15360,11613,11557,11500,15360,11621,11557,11500,15360,11629,11573,11508,15360,11629,11573,11508,15360,11605,11557,11484,15360,11589,11533,11468,15360,11557,11508,11436,15360,11549,11500,11428,15360,11557,11500,11436,15360,11549,11492,11436,15360,11533,11484,11428,15360,11525,11476,11428,15360,11516,11476,11428,15360,11525,11484,11444,15360,11516,11476,11428,15360,11468,11428,11380,15360,11428,11388,11332,15360,11356,11308,11239,15360,11308,11255,11127,15360,11167,11071,10926,15360,11223,11119,10966,15360,11276,11175,10998,15360,11404,11332,11191,15360,11773,11693,11557,15360,11926,11798,11613,15360,12207,12039,11773,15360,12348,12231,11894,15360,12308,12151,11846,15360,12332,12215,11894,15360,12364,12279,11958,15360,12380,12292,11974,15360,12396,12316,12022,15360,12404,12316,12039,15360,12412,12332,12087,15360,12412,12332,12103,15360,12436,12356,12135,15360,12372,12292,12039,15360,12420,12332,12087,15360,12396,12316,12055,15360,12356,12263,11990,15360,12340,12231,11942,15360,12271,12127,11854,15360,12215,12071,11814,15360,12292,12135,11878,15360,12288,12135,11870,15360,12111,11982,11765,15360,11990,11886,11717,15360,11637,11557,11428,15360,11364,11300,11143,15360,11316,11239,11079,15360,11300,11207,11047,15360,11268,11159,11015,15360,11268,11159,11015,15360,11268,11159,11031,15360,11300,11223,11095,15360,11340,11292,11191,15360,11348,11300,11223,15360,11372,11324,11255,15360,11380,11332,11255,15360,11372,11316,11239,15360,11396,11340,11268,15360,11468,11404,11300,15360,11460,11404,11324,15360,11484,11428,11356,15360,11492,11436,11372,15360,11500,11444,11388,15360,11508,11460,11404,15360,11500,11452,11396,15360,11492,11436,11380,15360,11468,11412,11356,15360,11444,11388,11324,15360,11444,11388,11324,15360,11428,11380,11316,15360,11412,11356,11300,15360,11404,11348,11300,15360,11404,11356,11308,15360,11396,11356,11308,15360,11388,11348,11308,15360,11372,11340,11292,15360,11348,11308,11255,15360,11284,11223,11111,15360,11231,11143,11023,15360,11199,11111,10974,15360,11047,10958,10814,15360,11127,11023,10870,15360,11119,11006,10846,15360,11175,11055,10886,15360,11292,11191,10998,15360,11525,11404,11284,15360,11822,11637,11476,15360,11878,11733,11549,15360,11918,11790,11573,15360,12063,11918,11653,15360,12223,12063,11765,15360,12300,12151,11846,15360,12255,12103,11814,15360,12271,12127,11846,15360,12271,12127,11862,15360,12271,12127,11886,15360,12308,12183,11942,15360,12175,12039,11814,15360,12063,11934,11709,15360,12159,12014,11765,15360,12215,12063,11798,15360,12143,11998,11757,15360,12071,11934,11693,15360,11998,11870,11661,15360,11974,11870,11685,15360,11998,11910,11757,15360,11846,11765,11629,15360,11468,11396,11284,15360,11308,11223,11031,15360,11215,11103,10934,15360,11207,11095,10942,15360,11215,11103,10950,15360,11191,11087,10942,15360,11175,11079,10942,15360,11167,11063,10934,15360,11143,11031,10902,15360,11247,11143,11015,15360,11284,11191,11079,15360,11300,11223,11095,15360,11316,11268,11127,15360,11340,11284,11143,15360,11340,11284,11159,15360,11356,11300,11191,15360,11372,11316,11239,15360,11380,11324,11255,15360,11372,11316,11255,15360,11380,11324,11276,15360,11380,11324,11268,15360,11372,11316,11255,15360,11364,11316,11255,15360,11364,11308,11239,15360,11348,11292,11207,15360,11340,11284,11191,15360,11348,11292,11191,15360,11348,11292,11207,15360,11340,11292,11207,15360,11340,11292,11207,15360,11324,11276,11207,15360,11308,11255,11175,15360,11264,11175,11079,15360,11119,11039,10934,15360,11103,11015,10902,15360,11095,11006,10878,15360,11031,10942,10806,15360,10990,10902,10766,15360,11047,10942,10814,15360,11031,10926,10790,15360,11055,10942,10806,15360,11119,10998,10846,15360,11151,11015,10830,15360,11268,11095,10886,15360,11484,11396,11268,15360,11790,11701,11549,15360,11886,11790,11637,15360,11838,11741,11581,15360,11838,11725,11541,15360,11902,11782,11581,15360,11966,11838,11629,15360,11974,11846,11629,15360,11958,11838,11629,15360,11950,11838,11637,15360,11814,11701,11525,15360,11581,11492,11332,15360,11645,11541,11380,15360,11806,11701,11533,15360,11902,11806,11637,15360,11950,11862,11717,15360,12014,11934,11790,15360,11942,11862,11725,15360,11565,11492,11388,15360,11292,11191,11015,15360,11231,11111,10950,15360,11159,11047,10894,15360,11119,11006,10854,15360,11127,11023,10878,15360,11159,11055,10902,15360,11135,11031,10894,15360,11111,11006,10878,15360,11095,10990,10870,15360,11095,10998,10886,15360,11071,10966,10846,15360,11111,11006,10902,15360,11191,11095,10974,15360,11268,11159,11031,15360,11284,11191,11063,15360,11292,11207,11063,15360,11300,11223,11079,15360,11332,11268,11143,15360,11316,11255,11127,15360,11316,11255,11143,15360,11308,11239,11127,15360,11316,11255,11159,15360,11300,11223,11127,15360,11292,11207,11095,15360,11300,11223,11111,15360,11300,11223,11095,15360,11300,11223,11095,15360,11308,11239,11111,15360,11300,11223,11111,15360,11292,11207,11111,15360,11264,11167,11071,15360,11215,11127,11047,15360,11135,11055,10966,15360,11015,10934,10846,15360,10918,10838,10733,15360,10982,10894,10782,15360,10974,10886,10766,15360,10982,10894,10766,15360,10958,10862,10749,15360,10982,10886,10774,15360,10958,10862,10758,15360,10958,10862,10749,15360,11015,10910,10790,15360,11023,10910,10774,15360,11079,10958,10806,15360,11103,10974,10798,15360,11191,11047,10846,15360,11468,11388,11276,15360,11846,11765,11637,15360,12006,11918,11782,15360,11998,11910,11782,15360,11902,11822,11693,15360,11838,11749,11637,15360,11782,11709,11605,15360,11806,11741,11645,15360,11782,11717,11629,15360,11773,11717,11621,15360,11870,11806,11701,15360,11942,11862,11757,15360,12183,12103,11974,15360,11974,11894,11765,15360,11476,11404,11308,15360,11268,11143,10966,15360,11183,11063,10902,15360,11111,10998,10854,15360,11055,10942,10806,15360,11023,10910,10766,15360,11047,10934,10782,15360,11039,10926,10782,15360,11079,10966,10830,15360,11031,10918,10782,15360,11031,10926,10806,15360,10990,10894,10782,15360,10974,10886,10790,15360,10966,10870,10774,15360,11006,10902,10806,15360,11039,10942,10838,15360,11127,11023,10910,15360,11175,11079,10958,15360,11191,11087,10958,15360,11207,11095,10958,15360,11268,11143,11015,15360,11276,11175,11047,15360,11284,11191,11079,15360,11292,11191,11079,15360,11276,11175,11079,15360,11239,11135,11031,15360,11268,11159,11047,15360,11215,11111,11006,15360,11239,11127,11015,15360,11255,11143,11031,15360,11223,11119,11015,15360,11199,11103,10998,15360,11175,11087,10982,15360,11143,11047,10958,15360,11031,10942,10854,15360,10958,10878,10790,15360,10910,10830,10741,15360,10942,10862,10758,15360,10926,10838,10733,15360,10854,10758,10637,15360,10918,10830,10709,15360,10910,10822,10717,15360,10942,10846,10749,15360,10942,10854,10741,15360,10942,10854,10749,15360,10966,10870,10758,15360,10966,10870,10758,15360,10958,10854,10733,15360,10998,10886,10741,15360,10942,10830,10677,15360,11039,10918,10749,15360,11095,10974,10806,15360,11308,11223,11031,15360,11468,11396,11292,15360,11605,11533,11428,15360,11701,11621,11525,15360,11693,11629,11541,15360,11685,11621,11549,15360,11685,11629,11549,15360,11629,11565,11484,15360,11589,11533,11444,15360,11364,11308,11191,15360,11191,11087,10958,15360,11135,11031,10902,15360,11135,11031,10894,15360,11055,10950,10830,15360,11015,10910,10782,15360,10958,10854,10733,15360,10942,10838,10717,15360,10974,10870,10733,15360,10982,10878,10749,15360,10990,10886,10758,15360,11015,10910,10798,15360,10966,10862,10758,15360,10950,10854,10758,15360,10910,10822,10733,15360,10894,10798,10709,15360,10902,10814,10725,15360,10934,10846,10758,15360,10910,10822,10733,15360,10950,10854,10749,15360,10974,10878,10766,15360,11047,10942,10830,15360,11095,10990,10878,15360,11167,11055,10942,15360,11199,11103,10990,15360,11191,11087,10982,15360,11151,11047,10950,15360,11135,11031,10934,15360,11095,10998,10902,15360,11143,11047,10950,15360,11079,10990,10894,15360,11079,10990,10902,15360,11103,11006,10910,15360,11079,10982,10886,15360,11023,10926,10822,15360,10982,10894,10798,15360,10958,10870,10782,15360,10910,10814,10725,15360,10926,10838,10741,15360,10934,10838,10733,15360,10950,10854,10749,15360,10886,10798,10709,15360,10910,10814,10709,15360,10926,10830,10725,15360,10910,10814,10701,15360,10862,10774,10677,15360,10950,10854,10733,15360,10926,10830,10717,15360,10926,10838,10725,15360,10926,10830,10725,15360,10894,10798,10685,15360,10926,10830,10701,15360,10958,10854,10717,15360,10934,10830,10685,15360,10950,10846,10709,15360,10974,10862,10717,15360,10942,10830,10685,15360,10958,10846,10701,15360,11006,10894,10749,15360,10950,10846,10725,15360,10958,10862,10741,15360,10894,10806,10701,15360,10854,10774,10669,15360,10886,10806,10701,15360,10862,10790,10693,15360,10878,10806,10717,15360,10982,10902,10798,15360,10990,10902,10798,15360,10950,10862,10758,15360,10942,10846,10733,15360,10870,10774,10669,15360,10894,10798,10693,15360,10918,10830,10725,15360,10894,10806,10701,15360,10926,10830,10733,15360,10902,10830,10725,15360,10870,10790,10693,15360,10886,10814,10725,15360,10814,10741,10661,15360,10838,10766,10677,15360,10822,10741,10661,15360,10822,10741,10669,15360,10862,10790,10709,15360,10846,10758,10669,15360,10894,10798,10693,15360,10974,10878,10766,15360,10966,10870,10766,15360,11023,10926,10814,15360,11079,10974,10862,15360,11006,10910,10814,15360,10950,10862,10766,15360,10982,10894,10798,15360,10958,10862,10774,15360,10958,10870,10782,15360,10910,10830,10741,15360,10950,10862,10766,15360,10982,10886,10790,15360,10918,10822,10725,15360,10886,10798,10701,15360,10854,10766,10669,15360,10894,10806,10709,15360,10926,10830,10725,15360,10926,10830,10725,15360,10958,10862,10749,15360,10958,10862,10749,15360,10894,10806,10717,15360,10902,10814,10717,15360,10878,10790,10677,15360,10942,10838,10717,15360,10918,10814,10701,15360,10886,10790,10661,15360,10942,10838,10717,15360,10950,10854,10725,15360,10950,10854,10725,15360,10910,10814,10693,15360,10910,10814,10685,15360,10942,10838,10709,15360,10894,10790,10661,15360,10910,10806,10669,15360,10822,10725,10597,15360,10749,10661,10541,15360,10830,10733,10613,15360,10838,10741,10629,15360,10806,10709,10597,15360,10854,10766,10653,15360,10862,10774,10669,15360,10798,10725,10629,15360,10822,10749,10653,15360,10854,10782,10693,15360,10806,10741,10661,15360,10862,10790,10701,15360,10870,10790,10685,15360,10870,10790,10693,15360,10878,10790,10677,15360,10862,10782,10677,15360,10870,10790,10693,15360,10870,10782,10685,15360,10894,10814,10709,15360,10886,10814,10709,15360,10846,10782,10685,15360,10741,10669,10573,15360,10766,10693,10589,15360,10709,10637,10541,15360,10741,10669,10589,15360,10741,10677,10589,15360,10709,10637,10557,15360,10774,10701,10613,15360,10862,10774,10677,15360,11006,10918,10806,15360,11006,10902,10782,15360,10974,10870,10749,15360,10958,10854,10733,15360,10934,10838,10725,15360,10934,10838,10733,15360,10934,10838,10725,15360,10886,10790,10685,15360,10854,10766,10661,15360,10886,10798,10701,15360,10838,10749,10645,15360,10878,10782,10661,15360,10822,10725,10613,15360,10822,10717,10605,15360,10846,10749,10629,15360,10854,10749,10637,15360,10950,10854,10733,15360,10958,10854,10741,15360,10910,10806,10693,15360,10926,10822,10693,15360,10934,10838,10725,15360,10910,10822,10709,15360,10910,10822,10709,15360,10886,10782,10661,15360,10910,10814,10677,15360,10910,10806,10677,15360,10926,10822,10685,15360,10958,10854,10717,15360,10974,10870,10725,15360,10926,10830,10693,15360,10926,10830,10693,15360,10918,10822,10693,15360,10934,10838,10701,15360,10918,10814,10685,15360,10878,10782,10653,15360,10870,10774,10645,15360,10838,10749,10629,15360,10806,10717,10605,15360,10822,10733,10621,15360,10822,10733,10621,15360,10846,10758,10653,15360,10846,10766,10653,15360,10822,10741,10629,15360,10806,10733,10629,15360,10806,10725,10621,15360,10790,10709,10605,15360,10766,10693,10589,15360,10814,10741,10629,15360,10846,10766,10653,15360,10838,10758,10653,15360,10878,10790,10677,15360,10894,10798,10685,15360,10830,10741,10629,15360,10830,10758,10653,15360,10798,10725,10629,15360,10806,10733,10629,15360,10717,10637,10525,15360,10661,10581,10476,15360,10701,10621,10517,15360,10733,10661,10565,15360,10782,10685,10557,15360,10862,10758,10613,15360,10974,10862,10725,15360,10958,10846,10709,15360,11006,10902,10766,15360,11006,10902,10774,15360,11039,10934,10814,15360,11006,10902,10790,15360,11006,10910,10790,15360,10950,10854,10741,15360,10934,10830,10709,15360,10918,10814,10701,15360,10854,10758,10653,15360,10918,10814,10701,15360,10870,10766,10645,15360,10830,10733,10621,15360,10934,10830,10709,15360,10990,10886,10758,15360,10950,10838,10717,15360,10910,10814,10701,15360,10926,10822,10693,15360,10934,10830,10709,15360,10878,10774,10653,15360,10934,10830,10701,15360,10926,10822,10693,15360,10878,10782,10661,15360,10878,10782,10661,15360,10862,10766,10621,15360,10886,10782,10645,15360,10886,10782,10653,15360,10926,10822,10701,15360,10902,10806,10685,15360,10926,10822,10701,15360,10918,10814,10685,15360,10878,10782,10645,15360,10910,10806,10669,15360,10854,10758,10621,15360,10886,10790,10645,15360,10854,10758,10629,15360,10830,10741,10613,15360,10918,10814,10685,15360,10862,10766,10645,15360,10830,10741,10613,15360,10806,10717,10597,15360,10741,10661,10557,15360,10774,10693,10581,15360,10749,10669,10557,15360,10774,10693,10581,15360,10766,10685,10573,15360,10790,10709,10597,15360,10782,10701,10589,15360,10790,10709,10597,15360,10838,10749,10621,15360,10870,10774,10645,15360,10894,10790,10661,15360,10878,10782,10653,15360,10846,10741,10613,15360,10790,10693,10557,15360,10814,10717,10597,15360,10790,10701,10581,15360,10741,10645,10525,15360,10717,10629,10509,15360,10774,10685,10573,15360,10725,10637,10525,15360,10854,10749,10621,15360,10950,10846,10701,15360,10966,10854,10709,15360,10934,10814,10677,15360,10926,10822,10701,15360,10982,10878,10766,15360,10998,10894,10782,15360,10990,10878,10766,15360,10998,10894,10782,15360,10998,10886,10774,15360,10998,10886,10758,15360,11006,10894,10774,15360,10942,10838,10733,15360,10958,10854,10741,15360,10958,10854,10749,15360,11006,10902,10790,15360,11015,10902,10798,15360,10982,10870,10758,15360,10998,10894,10782,15360,10974,10870,10758,15360,11006,10902,10790,15360,10998,10894,10774,15360,10974,10870,10758,15360,10950,10854,10741,15360,10878,10790,10693,15360,10902,10814,10701,15360,10918,10822,10709,15360,10838,10733,10613,15360,10878,10782,10661,15360,10934,10838,10717,15360,10902,10806,10693,15360,10918,10822,10709,15360,10926,10830,10709,15360,10838,10733,10605,15360,10910,10806,10661,15360,10942,10838,10693,15360,10886,10782,10645,15360,10886,10782,10637,15360,10854,10749,10621,15360,10926,10830,10709,15360,10966,10862,10741,15360,10846,10749,10629,15360,10830,10733,10605,15360,10854,10758,10637,15360,10822,10725,10605,15360,10886,10790,10661,15360,10902,10806,10669,15360,10918,10814,10677,15360,10830,10733,10605,15360,10806,10717,10589,15360,10870,10774,10645,15360,10934,10838,10709,15360,10958,10862,10733,15360,10886,10790,10661,15360,10894,10798,10661,15360,10958,10854,10709,15360,10934,10830,10709,15360,10814,10717,10581,15360,10862,10758,10613,15360,10854,10741,10589,15360,10814,10717,10573,15360,10886,10782,10645,15360,10814,10725,10597,15360,10862,10766,10637,15360,10910,10806,10669,15360,10942,10838,10709,15360,10966,10862,10733,15360,10974,10870,10741,15360,10974,10870,10749,15360,10958,10862,10749,15360,11031,10934,10822,15360,10998,10894,10782,15360,10974,10870,10766,15360,11023,10918,10814,15360,11039,10926,10822,15360,10958,10846,10741,15360,10918,10814,10693,15360,10966,10870,10741,15360,10982,10886,10766,15360,10982,10878,10766,15360,10942,10846,10733,15360,10958,10862,10758,15360,10950,10854,10758,15360,10934,10830,10717,15360,10966,10862,10733,15360,10942,10846,10725,15360,10934,10846,10733,15360,10934,10846,10733,15360,10878,10798,10693,15360,10886,10798,10693,15360,10910,10814,10709,15360,10942,10846,10733,15360,10838,10733,10597,15360,10878,10774,10645,15360,10918,10822,10701,15360,10878,10782,10653,15360,10894,10790,10661,15360,10934,10838,10725,15360,10958,10854,10725,15360,10966,10862,10733,15360,10910,10806,10685,15360,10982,10878,10758,15360,10942,10854,10749,15360,10934,10838,10733,15360,10918,10814,10701,15360,10894,10798,10669,15360,10894,10798,10669,15360,10814,10725,10605,15360,10902,10798,10669,15360,10814,10725,10605,15360,10894,10798,10685,15360,10958,10862,10749,15360,10910,10814,10701,15360,10910,10806,10685,15360,10918,10814,10693,15360,10926,10822,10709,15360,10894,10790,10661,15360,10902,10806,10677,15360,10902,10806,10685,15360,10934,10838,10717,15360,10934,10838,10701,15360,10934,10838,10717,15360,10950,10854,10725,15360,10894,10798,10661,15360,10862,10749,10597,15360,10894,10798,10677,15360,10878,10782,10661,15360,10926,10838,10717,15360,10926,10838,10717,15360,10918,10822,10709,15360,10934,10838,10733,15360,10926,10838,10733,15360,10958,10870,10766,15360,10942,10854,10749,15360,10958,10870,10774,15360,10974,10878,10774,15360,10958,10854,10741,15360,10950,10846,10741,15360,10950,10854,10758,15360,10934,10838,10733,15360,10942,10846,10725,15360,10966,10862,10741,15360,10926,10838,10733,15360,10958,10862,10749,15360,10910,10822,10709,15360,10942,10854,10758,15360,10926,10838,10733,15360,10910,10822,10717,15360,10934,10838,10733,15360,10934,10846,10733,15360,10902,10814,10709,15360,10926,10830,10717,15360,10918,10822,10709,15360,10838,10749,10637,15360,10878,10790,10677,15360,10942,10846,10733,15360,10926,10822,10701,15360,10958,10862,10749,15360,10886,10790,10685,15360,10918,10814,10693,15360,10910,10814,10693,15360,10902,10806,10701,15360,10878,10774,10637,15360,10798,10693,10565,15360,10822,10725,10597,15360,10934,10838,10709,15360,10958,10854,10725,15360,10886,10790,10669,15360,10910,10806,10677,15360,10886,10782,10645,15360,10830,10725,10597,15360,10822,10717,10581,15360,10862,10758,10637,15360,10878,10782,10669,15360,10926,10822,10709,15360,10974,10878,10774,15360,10966,10870,10758,15360,10918,10822,10709,15360,10846,10749,10645,15360,10894,10798,10693,15360,10918,10822,10709,15360,10974,10878,10774,15360,10918,10822,10717,15360,10982,10886,10774,15360,10974,10878,10758,15360,10950,10854,10741,15360,10958,10854,10725,15360,10982,10886,10766,15360,10918,10822,10701,15360,10878,10782,10669,15360,10886,10790,10669,15360,10934,10838,10717,15360,10950,10854,10741,15360,10934,10838,10733,15360,10982,10886,10782,15360,10886,10798,10701,15360,10870,10782,10685,15360,10894,10814,10717,15360,10910,10822,10725,15360,10934,10838,10733,15360,10950,10846,10741,15360,10934,10838,10725,15360,10934,10846,10749,15360,10902,10814,10717,15360,10878,10790,10677,15360,10878,10782,10669,15360,10854,10766,10645,15360,10838,10749,10629,15360,10902,10814,10701,15360,10910,10814,10693,15360,10902,10798,10669,15360,10910,10806,10677,15360,10886,10782,10653,15360,10854,10749,10629,15360,10870,10774,10653,15360,10974,10870,10758,15360,10990,10878,10758,15360,10918,10822,10709,15360,10926,10838,10725,15360,10958,10854,10733,15360,10894,10790,10653,15360,10822,10725,10605,15360,10878,10782,10661,15360,10974,10870,10749,15360,10902,10806,10677,15360,10934,10838,10725,15360,10870,10774,10653,15360,10798,10701,10581,15360,10854,10749,10621,15360,10894,10798,10669,15360,10934,10822,10685,15360,10942,10830,10701,15360,10910,10806,10669,15360,10870,10758,10629,15360,10886,10774,10645,15360,10950,10838,10701,15360,10966,10870,10749,15360,10886,10790,10685,15360,10870,10782,10677,15360,10934,10838,10733,15360,10934,10838,10725,15360,10822,10725,10621,15360,10878,10790,10677,15360,10894,10798,10693,15360,10822,10733,10629,15360,10894,10798,10685,15360,10998,10902,10790,15360,11015,10918,10806,15360,10950,10854,10741,15360,10950,10846,10741,15360,10934,10838,10733,15360,10942,10846,10749,15360,10910,10822,10725,15360,10846,10758,10653,15360,10878,10790,10685,15360,10894,10798,10701,15360,10862,10774,10669,15360,10814,10725,10621,15360,10846,10758,10645,15360,10870,10774,10661,15360,10870,10774,10677,15360,10878,10790,10693,15360,10878,10782,10677,15360,10830,10741,10637,15360,10870,10782,10677,15360,10966,10870,10766,15360,11015,10918,10814,15360,10910,10814,10701,15360,10942,10846,10725,15360,10950,10846,10725,15360,10942,10838,10725,15360,10934,10830,10701,15360,10910,10798,10677,15360,10886,10782,10653,15360,10838,10733,10597,15360,10902,10806,10669,15360,10830,10733,10613,15360,10838,10741,10621,15360,10838,10741,10621,15360,10894,10798,10669,15360,10934,10830,10685,15360,10886,10790,10669,15360,10902,10806,10685,15360,10854,10749,10637,15360]);var Qce={file:1,m:1,mm:.001,cm:.01,ft:.3048,in:.0254,pt:Jat()},Qat={file:"m",m:"m",mm:"mm",cm:"cm",ft:"ft",in:"in",pt:"pt"},eue=e=>2===e?"Â²":3===e?"Â³":"",ex=(e,t=1)=>Qat[e]+eue(t),v3t=(e,t,n,r=1)=>(null==n&&(n=t),n===t?{value:e,unit:ex(n)}:{value:e*Math.pow(Qce[t]/Qce[n],r),unit:ex(n)+eue(r)}),os=(e=>(e.MouseClick="mouseclick",e.LayoutChange="layoutchange",e.ModelLoad="modelload",e.BeforeRender="beforerender",e.AfterRender="afterrender",e.OnAnimate="onanimate",e.CameraChange="camerachange",e.ControlChange="controlchange",e.BoxSelectActivate="boxselectactivate",e.BoxSelectDeactivate="boxselectdeactivate",e.PickMarkupActivate="pickmarkupactivate",e.PickMarkupDeactivate="pickmarkupdeactivate",e.MarkupActivate="markupactivate",e.MarkupDeactivate="markupdeactivate",e.MarkupAdd="markupadd",e.MarkupUpdate="markupupdate",e.MarkupRemove="markupremove",e.BeforeRemoveMarkup="beforeremovemarkup",e.MeasurementActivate="measurementactivate",e.MeasurementDeactivate="measurementdeactivate",e.MeasurementAdd="measurementadd",e.MeasurementRemove="measurementremove",e.HotpointClick="hotpointclick",e))(os||{}),tue={},xn=class extends as{constructor(e){super(),this.drawableLists=[],this.frustum=new ul,this.projScreenMatrix=new At,this.viewer=e,this.init()}static _registerDrawableClass(e){tue[e.prototype.getClassType()]=e}static createDrawable(e){let t=tue[e.type];if(!t)throw new Error(`Invalid drawable type: ${t}`);let n=e.points.map((e=>new q(e[0],e[1],e[2]||0))),r=new t(e.id,n);return r.setData(e),r}get is3d(){return this.viewer.is3d()}get container(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}init(){this.initCanvas(),this.viewer.addEventListener("afterrender",(()=>{this.projScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromProjectionMatrix(this.projScreenMatrix),this.render()}))}initCanvas(){let e=this.viewer.getViewerConfig();if(Bn.isBrowser&&!e.context2d){let e=this.canvas=document.createElement("canvas"),t=this.viewer.viewerContainer;t.appendChild(e),e.classList.add("overlay-renderer"),e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.userSelect="none",this.context=e.getContext("2d",{willReadFrequently:!0});let{clientWidth:n,clientHeight:r}=t;this.setSize(n,r)}else e.context2d&&(this.context=e.context2d,this.canvas=Bn.creatReactNativeCanvas(this.context),this.context.canvas||(this.context.canvas=this.canvas))}toHighDpr(e,t,n){let r=Math.max(window.devicePixelRatio||1,1),i=this.canvas;return i.width=t*r,i.height=n*r,e.scale(r,r),i.style.width=`${t}px`,i.style.height=`${n}px`,e}clearCanvas(){var e,t,n;null==(n=this.context)||n.clearRect(0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height)}addDrawableList(e){this.drawableLists.push(e)}render(){if(!this.canvas||!this.context||this.drawableLists.length<1)return;this.clearCanvas();let e=this.getSortedDrawables(!1);if(0===e.length)return;let t=new ir,n=this.viewer.getPixelSizeInWorldCoord();for(let r=0;r<e.length;r++){let i=e[r];i.setTolerance(n),i.visible&&(i.getBounds().getBoundingSphere(t),!i.needsFrustumCulled||this.frustum.intersectsSphere(t))&&i.render(this.context,this.camera)}}setSize(e,t){let n=this.canvas;n.width=e,n.height=t,n.style.width=`${e}px`,n.style.height=`${t}px`,this.toHighDpr(this.context,e,t)}getSortedDrawables(e=!1){let t=[];return this.drawableLists.forEach((n=>{let r=Array.from(n.getDrawables().values());e&&(r=r.filter((e=>e.visible))),r.length>0&&t.push(...r)})),t.sort(((e,t)=>e.renderOrder===t.renderOrder?t.getCenter().distanceTo(this.camera.position)-e.getCenter().distanceTo(this.camera.position):e.renderOrder-t.renderOrder)),t}getDrawablesByDrawableListAndPosition(e,t){return this.is3d||(t.z=0),e.getDrawableByPosition(t,this.raycaster)}getDrawablesByPosition(e){this.is3d||(e.z=0);let t=this.getSortedDrawables(),n=[];for(let r=0;r<t.length;r++){let i=t[r];i.isPointInPath(e,this.raycaster)&&n.push(i)}return n}getDrawableById(e){return this.getSortedDrawables().find((t=>t.id===e))}measureTextLength(e,t){let n=this.context,r=e.split("\n"),i=0;for(let e=0;e<r.length;e++){let a=r[e];n.save(),n.font=t;let s=n.measureText(a).width;n.restore(),i=Math.max(i,s)}return i}getImage(e){this.clearCanvas();let t=this.getSortedDrawables();for(let n=0;n<t.length;n++){let r=t[n];e(r)&&r.render(this.context,this.camera)}return Ct.canvasToImage(this.canvas)}getCanvas(){return this.canvas}destroy(){var e;this.drawableLists.forEach((e=>e.clear())),this.drawableLists=[],this.canvas&&(null==(e=this.viewer.viewerContainer)||e.removeChild(this.canvas),this.canvas=void 0)}},$a=class extends as{constructor(e){super(),this.drawableMap=new Map,this.category=e}addDrawable(e){this.drawableMap.set(e.id,e),this.dispatchEvent("add",e.getData())}updateDrawable(e,t){e.setData(t),this.dispatchEvent("update",e.getData())}removeDrawable(e){this.drawableMap.delete(e.id),this.dispatchEvent("remove",e.getData())}getDrawableById(e){return this.drawableMap.get(e)}clear(){this.drawableMap.forEach((e=>this.removeDrawable(e)))}getDrawables(){return this.drawableMap}getDrawableDatas(){return Array.from(this.drawableMap).map((([e,t])=>t.getData()))}setDrawableDatas(e){for(let t=0;t<e.length;t++){let n=e[t],r=xn.createDrawable(n);this.addDrawable(r)}}getDrawableByPosition(e,t){let n;for(let[r,i]of this.drawableMap)if(i.visible&&i.isPointInPath(e,t)){n=i;break}return n}},eot=!1,Ei=class extends as{constructor(e){super(),this.DEFAULT_LINE_WIDTH=1,this.DEFAULT_STROKE_STYLE=[0,0,0,1],this.DEFAULT_FILL_STYLE=[0,0,0,1],this.lineWidth=this.DEFAULT_LINE_WIDTH,this.lineColor=this.DEFAULT_STROKE_STYLE,this.fillColor=this.DEFAULT_FILL_STYLE,this.x=0,this.y=0,this.width=0,this.height=0,this.points=[],this.userData={},this.tolerance=1,this.visible=!0,this.selected=!1,this.renderOrder=1,this.needsFrustumCulled=!0,this.editPointSize=3,this.editPointFillColor="#ffffff",this.editPointStrokeColor="#939ea4",this.matrix=new At,this.id=e||Ct.guid()}setTolerance(e){this.tolerance=e}render(e,t){this.ctx=e,this.draw(e,t),this.selected&&this.drawSelect(e,t),eot&&(this.drawBounds(e,t),this.drawCenter(e,t))}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.getClassType()}}setData(e){this.id=e.id,this.setLineWidth(e.lineWidth),this.setLineColor(e.lineColor),this.setFillColor(e.fillColor)}getVertexes(){return[new q(this.x,this.y,0),new q(this.x+this.width,this.y,0),new q(this.x+this.width,this.y-this.height,0),new q(this.x,this.y-this.height,0)]}setLineWidth(e){this.lineWidth=e||this.DEFAULT_LINE_WIDTH}setLineColor(e){this.lineColor=e||this.DEFAULT_STROKE_STYLE}setFillColor(e){this.fillColor=e||this.DEFAULT_FILL_STYLE}isSelected(){return this.selected}getCenter(){return this.getBounds().getCenter(new q)}transToScreenCoord(e,t){return this.ctx?mn.world2Screen(e,t,this.ctx.canvas):new Te}drawBounds(e,t){let{min:n,max:r}=this.getBounds(),i=[],a=(e,t,n)=>i.push(new q(e,t,n));a(r.x,r.y,r.z),a(n.x,r.y,r.z),a(n.x,n.y,r.z),a(r.x,n.y,r.z),a(r.x,r.y,n.z),a(n.x,r.y,n.z),a(n.x,n.y,n.z),a(r.x,n.y,n.z),a(n.x,r.y,r.z),a(n.x,n.y,r.z),a(r.x,r.y,r.z),a(r.x,n.y,r.z),a(r.x,r.y,n.z),a(r.x,n.y,n.z),a(n.x,r.y,n.z),a(n.x,n.y,n.z),a(n.x,r.y,r.z),a(n.x,r.y,n.z),a(r.x,r.y,r.z),a(r.x,r.y,n.z),a(n.x,n.y,r.z),a(n.x,n.y,n.z),a(r.x,n.y,r.z),a(r.x,n.y,n.z),e.save(),e.strokeStyle="yellow",e.beginPath(),i.forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);r%2==0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),e.closePath(),e.stroke(),e.restore()}drawCenter(e,t){let n=this.transToScreenCoord(this.getCenter(),t);e.save(),e.fillStyle="yellow",e.beginPath(),e.arc(n.x,n.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}getBounds(){let e=this.getVertexes();return(new Ft).setFromPoints(e)}},tot=new Ft,qr=class extends Ei{constructor(e){super(e),this.editPointSize=3,this.editPointFillColor="#ffffff",this.editPointStrokeColor="#939ea4",this.id=e||Ct.guid()}isSelected(){return this.selected}drawSelect(e,t){let n=this.getVertexes();this.drawPoints(e,t,n)}drawPoints(e,t,n){e.save(),e.fillStyle=this.editPointFillColor,e.strokeStyle=this.editPointStrokeColor,e.beginPath(),n.forEach((n=>{let r=this.transToScreenCoord(n,t);e.moveTo(r.x,r.y),e.arc(r.x,r.y,this.editPointSize,0,2*Math.PI)})),e.closePath(),e.stroke(),e.fill(),e.restore()}setEditPointSize(e){this.editPointSize=e}setEditPointFillColor(e){this.editPointFillColor=e}setEditPointStrokeColor(e){this.editPointStrokeColor=e}getCenter(){return this.getBounds().getCenter(new q)}isPointInPath(e){let t=this.getVertexes().map((e=>new Te(e.x,e.y)));return Gt.isPointInPolygon(new Te(e.x,e.y),t,!0)}setData(e){super.setData(e),this.update(e.points.map((e=>new q(e[0],e[1],0))))}setParent(e){this.parent=e}setLeaderText(e){this.leaderText=e,e.setParent(this)}update(e){let{min:t,max:n}=tot.setFromPoints(e);return this.x=t.x,this.y=n.y,this.width=Math.abs(n.x-t.x),this.height=Math.abs(n.y-t.y),this.points=e,this}translate(e,t){let n=new q(e,t,0);return this.points.forEach((e=>e.add(n))),this.update(this.points),this}rotate(){return this}scale(){return this}},ta=(e=>(e.Arrow="ArrowMarkup",e.Circle="CircleMarkup",e.CloudLine="CloudLineMarkup",e.CloudLineRectangle="CloudRectMarkup",e.CloudRectWithText="CloudRectWithTextMarkup",e.Dot="DotMarkup",e.Ellipse="EllipseMarkup",e.LeaderLine="LeaderLineMarkup",e.PolyLine="PolylineMarkup",e.Rectangle="RectMarkup",e.Text="TextMarkup",e.X="XMarkup",e))(ta||{}),aF=class extends qr{constructor(e,t){super(e),this.type="ArrowMarkup",this.update(t)}draw(e,t){let n=this.points.map((e=>this.transToScreenCoord(e,t))),[r,i]=this.points,a=(new q).subVectors(r,i).length()/10/this.tolerance;this.drawArrowLine(e,n,a),this.drawArrowHead(e,n[0],n[1],10,a)}drawArrowLine(e,t,n){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor);let[r,i]=t,a=(new Te).subVectors(i,r).normalize();e.beginPath(),e.moveTo(r.x,r.y);let s=i.clone().sub(a.multiplyScalar(n));e.lineTo(s.x,s.y),e.closePath(),e.stroke(),e.restore()}drawArrowHead(e,t,n,r,i){let a=180*Math.atan2(t.y-n.y,t.x-n.x)/Math.PI,s=(a+r)*Math.PI/180,o=(a-r)*Math.PI/180,l=i*Math.cos(s),h=i*Math.sin(s),u=i*Math.cos(o),c=i*Math.sin(o),d=new Te(n.x+l,n.y+h),p=new Te(n.x+u,n.y+c);e.save(),e.fillStyle=cn.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(d.x,d.y),e.lineTo(p.x,p.y),e.closePath(),e.fill(),e.restore()}getVertexes(){return this.points}update(e){let[t,n]=e;return this.points=e,this.x=Math.min(t.x,n.x),this.y=Math.max(t.y,n.y),this.width=Math.abs(n.x-t.x),this.height=Math.abs(n.y-t.y),this}isPointInPath(e){return Gt.isPointOnLineSegments(e,this.points,this.tolerance)}getClassType(){return"ArrowMarkup"}};xn._registerDrawableClass(aF);var not=new Te,nue=new q,oF=class extends qr{constructor(e,t){super(e),this.radius=1,this.type="CircleMarkup",this.update(t)}draw(e,t){let[n,r]=this.points.map((e=>this.transToScreenCoord(e,t)));this.radius=not.subVectors(r,n).length(),e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath(),e.arc(n.x,n.y,this.radius,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}update(e){let[t,n]=e,r=nue.subVectors(n,t).length();return this.width=2*r,this.height=2*r,this.x=t.x-this.width/2,this.y=t.y+this.height/2,this.points=e,this}isPointInPath(e){let[t,n]=this.points,r=nue.subVectors(t,n).length();return Math.abs(e.distanceTo(t)-r)<=2*this.tolerance}getClassType(){return"CircleMarkup"}};xn._registerDrawableClass(oF);var rue=new Ft,ml=class extends qr{constructor(e,t){super(e),this.type="CloudLineMarkup",this.update(t)}draw(e,t){let n=this.points,r=[];e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath();for(let i=0;i<n.length-1;i++){let a=this.transToScreenCoord(n[i],t),s=this.transToScreenCoord(n[i+1],t),o=ml.getControlPointByTwoPoints(a,s);0===i&&e.moveTo(a.x,a.y),e.quadraticCurveTo(o.x,o.y,s.x,s.y),r.push(n[i],n[i+1],mn.screen2World(o,t,this.ctx.canvas))}e.stroke(),e.restore(),rue.setFromPoints(r);let{min:i,max:a}=rue;this.width=Math.abs(a.x-i.x),this.height=Math.abs(a.y-i.y),this.x=i.x,this.y=a.y}static getControlPointByTwoPoints(e,t){let n=(new Te).subVectors(t,e),r=n.angle(),i=n.length(),a=zr.degToRad(45),s=i/2/Math.cos(a);return new Te(e.x+s*Math.cos(a-r),e.y-s*Math.sin(a-r))}getClassType(){return"CloudLineMarkup"}};xn._registerDrawableClass(ml);var lF=class extends qr{constructor(e,t){super(e),this.type="CloudRectMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath();let n=this.getVertexes();n.push(n[0]);let r,i=[],a=new q;for(let e=0;e<n.length-1;e++){let t=n[e],s=n[e+1];a.subVectors(s,t),r||(r=a.length()/10);let o=a.length(),l=a.normalize(),h=Math.round(o/r);for(let e=0;e<h;e++)i.push(t.clone().add(l.clone().multiplyScalar(r*e)))}i.push(i[0]),this.vertexes=[];for(let n=0;n<i.length-1;n++){let r=i[n],a=i[n+1],s=this.transToScreenCoord(r,t),o=this.transToScreenCoord(a,t),l=ml.getControlPointByTwoPoints(s,o);this.vertexes.push(r,a,mn.screen2World(l,t,this.ctx.canvas)),0===n&&e.moveTo(s.x,s.y),e.quadraticCurveTo(l.x,l.y,o.x,o.y)}e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let t=this.getVertexes(),n=[];for(let e=0;e<t.length;e++){let r=t[e],i=t[e+1]||t[0];n.push(r,i)}return Gt.isPointOnLineSegments(e,n,3*this.tolerance)}getClassType(){return"CloudRectMarkup"}};xn._registerDrawableClass(lF);var cF=class extends qr{constructor(e,t){super(e),this.radius=8,this.update(t)}draw(e,t){let n=this.transToScreenCoord(this.points[0],t);this.width=2*this.radius*this.tolerance,this.height=2*this.radius*this.tolerance,this.x=this.points[0].x-this.radius*this.tolerance,this.y=this.points[0].y+this.radius*this.tolerance,e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath(),e.arc(n.x,n.y,this.radius,0,2*Math.PI),e.closePath(),e.fill(),e.stroke(),e.restore()}update(e){let t=e[0];return this.width=2*this.radius*this.tolerance,this.height=2*this.radius*this.tolerance,this.x=t.x-this.radius*this.tolerance,this.y=t.y+this.radius*this.tolerance,this.points=e,this}getClassType(){return"DotMarkup"}};xn._registerDrawableClass(cF);var uF=class extends qr{constructor(e,t){super(e),this.radiusX=1,this.radiusY=1,this.type="EllipseMarkup",this.update(t)}draw(e,t){let[n,r]=this.points.map((e=>this.transToScreenCoord(e,t))),i=(new Te).lerpVectors(n,r,.5);this.radiusX=Math.abs(r.x-n.x)/2,this.radiusY=Math.abs(r.y-n.y)/2,e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath(),e.ellipse(i.x,i.y,this.radiusX,this.radiusY,0,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let[t,n]=this.points,r=(new q).lerpVectors(t,n,.5),i=Math.pow(e.x-r.x,2),a=Math.pow(e.y-r.y,2),s=2*this.tolerance,o=Math.abs(n.x-t.x)/2-s,l=Math.abs(n.y-t.y)/2-s,h=i/(o*o),u=a/(l*l),c=Math.abs(n.x-t.x)/2+s,d=Math.abs(n.y-t.y)/2+s;return h+u>=1&&i/(c*c)+a/(d*d)<=1}getClassType(){return"EllipseMarkup"}};xn._registerDrawableClass(uF);var iue=(e=>(e.EnterEditing="enterediting",e.ExitEditing="exitediting",e))(iue||{}),tx=class extends qr{constructor(e,t,n){super(e),this.text="",this.fontSize=12,this.type="TextMarkup",this.padding=300,this.inputStatus="CHAR_TYPING",this.isEditing=!1,this.handleClick=()=>{},this.handleKeydown=e=>{if(this.textInput)if("Enter"===e.key){let e=parseInt(this.textInput.style.height);this.textInput.style.height=`${Math.round(e+this.fontSize/this.tolerance)}px`}else"Escape"===e.code&&this.exitEditing()},this.handleInput=()=>{var e;if(!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus)return;let t=this.textInput.value,n=(null==(e=this.manager.overlayRender)?void 0:e.measureTextLength(t,this.fontSize/this.tolerance+"px Arial"))||0;n>tx.DEFAULT_INPUT_WIDTH&&(this.textInput.style.width=`${Math.round(n+this.padding/this.tolerance*2)}px`),this.inputStatus="CHAR_TYPING",this.text=t},this.handleCompositionStart=()=>{this.inputStatus="CHINESE_TYPING"},this.handleCompositionEnd=()=>{var e;if(!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus)return;let t=this.textInput.value,n=(null==(e=this.manager.overlayRender)?void 0:e.measureTextLength(t,this.fontSize/this.tolerance+"px Arial"))||0;n>tx.DEFAULT_INPUT_WIDTH&&(this.textInput.style.width=`${Math.round(n+this.padding/this.tolerance*2)}px`),this.text=t,this.inputStatus="CHAR_TYPING"},this.handleBlur=()=>{this.exitEditing()},this.handleFoucs=()=>{},this.update(t),this.text=n}draw(e,t){this.isEditing||this.drawText(e,t,this.text)}drawText(e,t,n){let r=this.transToScreenCoord(new q(this.x,this.y,0),t),i=n.split("\n"),a=this.fontSize/this.tolerance,s=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${a}px Arial`;for(let t=0;t<i.length;t++){let n=i[t],r=e.measureText(n).width;r>s&&(s=r)}let o=this.padding/this.tolerance,l=new Te(r.x,r.y);for(let t=0;t<i.length;t++){let n=i[t];e.fillText(n,l.x+o,l.y+o+t*a,s+2*o)}e.strokeRect(l.x,l.y,s+2*o,i.length*a+2*o),e.restore(),this.width=(s+2*o)*this.tolerance,this.height=(i.length*a+2*o)*this.tolerance}setFontSize(e){this.fontSize=e,this.padding=e/2}update(e){let t=e[0];return this.x=t.x,this.y=t.y,this.points=[t],this}setData(e){super.setData(e),this.text=e.text||"",this.setFontSize(e.fontSize||12),this.padding=e.fontSize/2}updateText(e){this.text=e}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),text:this.text,lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,type:this.getClassType()}}getClassType(){return"TextMarkup"}addInput(e,t,n){var r;this.textInput||(this.textInput=document.createElement("textarea"),this.textInput.style.cssText=`\n                position: absolute;\n                border: ${this.lineWidth}px solid ${cn.rgba2Color(this.lineColor)};\n                background: transparent;\n                outline: none;\n                resize: none;\n                overflow: hidden;\n                z-index: 1000;\n                box-sizing: content-box;\n                display: inline-block;\n                padding: ${this.padding/this.tolerance}px;\n                whiteSpace: 'nowrap';\n                color: ${this.lineColor}`,this.textInput.style.display="inline-block",null==(r=e.viewerCanvas.parentElement)||r.appendChild(this.textInput),this.addInputEvents()),this.manager=e,this.enterEditing(),this.textInput.style.left=`${t}px`,this.textInput.style.top=`${n}px`,this.textInput.style.width=`${tx.DEFAULT_INPUT_WIDTH}px`,this.textInput.style.height=this.fontSize/this.tolerance+"px",this.textInput.style.lineHeight=this.fontSize/this.tolerance+"px",this.textInput.style.fontSize=this.fontSize/this.tolerance+"px",this.textInput.style.color=cn.rgba2Color(this.lineColor)}addInputEvents(){var e,t,n,r,i,a,s;null==(e=this.textInput)||e.addEventListener("click",this.handleClick),null==(t=this.textInput)||t.addEventListener("blur",this.handleBlur),null==(n=this.textInput)||n.addEventListener("foucs",this.handleFoucs),null==(r=this.textInput)||r.addEventListener("keydown",this.handleKeydown),null==(i=this.textInput)||i.addEventListener("input",this.handleInput),null==(a=this.textInput)||a.addEventListener("compositionstart",this.handleCompositionStart),null==(s=this.textInput)||s.addEventListener("compositionend",this.handleCompositionEnd)}enterEditing(){this.textInput&&(this.textInput.value=this.text,this.textInput.focus(),this.isEditing=!0,this.dispatchEvent("enterediting"))}exitEditing(){var e,t,n,r,i,a,s,o;null==(e=this.textInput)||e.removeEventListener("click",this.handleClick),null==(t=this.textInput)||t.removeEventListener("blur",this.handleBlur),null==(n=this.textInput)||n.removeEventListener("foucs",this.handleFoucs),null==(r=this.textInput)||r.removeEventListener("keydown",this.handleKeydown),null==(i=this.textInput)||i.removeEventListener("input",this.handleInput),null==(a=this.textInput)||a.removeEventListener("compositionstart",this.handleCompositionStart),null==(s=this.textInput)||s.removeEventListener("compositionend",this.handleCompositionEnd),null==(o=this.textInput)||o.remove(),this.textInput=void 0,this.isEditing=!1,this.dispatchEvent("exitediting")}},Po=tx;Po.DEFAULT_INPUT_WIDTH=50,xn._registerDrawableClass(Po);var sue=new Te,aue=new Te(1,0),oue=new Te(0,-1),hF=class extends Po{constructor(e,t,n){super(e,t,n),this.type="LeaderLineMarkup",this.text="LeaderLine",this.fontSize=12,this.textBounds=new Ft,this.handleInput=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus||(this.text=this.textInput.value,this.calcuTextInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")},this.handleCompositionEnd=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus||(this.text=this.textInput.value,this.calcuTextInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")}}draw(e,t){if(this.points.length<2)return;let n=this.points.map((e=>this.transToScreenCoord(e,t))),[r,i]=this.points,a=(new q).subVectors(r,i).length()/10/this.tolerance;this.drawArrowLine(e,n,a),this.drawArrowHead(e,n[1],n[0],10,a),!this.isEditing&&this.text.length>0&&this.drawText(e,t,this.text)}drawArrowHead(e,t,n,r,i){let a=180*Math.atan2(t.y-n.y,t.x-n.x)/Math.PI,s=(a+r)*Math.PI/180,o=(a-r)*Math.PI/180,l=i*Math.cos(s),h=i*Math.sin(s),u=i*Math.cos(o),c=i*Math.sin(o),d=new Te(n.x+l,n.y+h),p=new Te(n.x+u,n.y+c);e.save(),e.fillStyle=cn.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(d.x,d.y),e.lineTo(p.x,p.y),e.closePath(),e.fill(),e.restore()}drawArrowLine(e,t,n){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor);let[r,i]=t,a=(new Te).subVectors(r,i).normalize();e.beginPath(),e.moveTo(i.x,i.y);let s=r.clone().sub(a.multiplyScalar(n));e.lineTo(s.x,s.y),e.closePath(),e.stroke(),e.restore()}drawText(e,t,n){let[r,i]=this.points.map((e=>this.transToScreenCoord(e,t))),a=(new Te).subVectors(i,r).normalize(),s=a.cross(oue)<0,o=a.cross(aue)<0,l=n.split("\n"),h=this.fontSize/this.tolerance,u=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${h}px Arial`;for(let t=0;t<l.length;t++){let n=l[t],r=e.measureText(n).width;r>u&&(u=r)}let c=this.padding/this.tolerance,d=c+h/2,p=l.length*h+2*c,f=new Te(s?i.x:i.x-u-2*c,o?i.y-d:i.y-p+(p-d));for(let t=0;t<l.length;t++){let n=l[t];e.fillText(n,f.x+c,f.y+c+t*h,u+2*c)}e.strokeRect(f.x,f.y,u+2*c,l.length*h+2*c),e.restore();let m=mn.screen2World(sue.set(f.x,f.y),t,this.ctx.canvas);m.z=0;let g=mn.screen2World(sue.set(f.x+u+2*c,f.y+p),t,this.ctx.canvas);g.z=0,this.textBounds.setFromPoints([m,g])}getVertexes(){return this.points}update(e){let[t,n]=e;return this.points=e,this.x=Math.min(t.x,n.x),this.y=Math.max(t.y,n.y),this.width=Math.abs(n.x-t.x),this.height=Math.abs(n.y-t.y),this}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),text:this.text,lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,type:this.getClassType()}}isPointInPath(e){return Gt.isPointOnLineSegments(e,this.points,this.tolerance)||this.textBounds.containsPoint(e)}updateText(e){this.text=e}getClassType(){return"LeaderLineMarkup"}addInput(e,t,n){let[r,i]=this.points.map((t=>mn.world2Screen(t,e.camera,e.viewerCanvas))),a=(new Te).subVectors(i,r).normalize(),s=a.cross(oue)<0,o=a.cross(aue)<0,l=this.fontSize/this.tolerance,h=this.padding/this.tolerance,u=h+l/2,c=Po.DEFAULT_INPUT_WIDTH,d=l;super.addInput(e,s?t:t-c-2*h,o?n-u:n-d+(d-u))}calcuTextInputPositionByText(e){var t;if(!this.textInput||!this.manager)return;let n=(null==(t=this.manager.overlayRender)?void 0:t.measureTextLength(e,this.fontSize/this.tolerance+"px Arial"))||0;if(n>Po.DEFAULT_INPUT_WIDTH){let e=this.points[1],t=mn.world2Screen(this.points[0],this.manager.camera,this.manager.viewerCanvas),r=mn.world2Screen(e,this.manager.camera,this.manager.viewerCanvas).clone().sub(t).normalize().cross(new Te(0,-1))<0,i=mn.world2Screen(e,this.manager.camera,this.manager.viewerCanvas);r||(this.textInput.style.left=i.x-n-this.padding/this.tolerance*2+"px"),this.textInput.style.width=`${Math.round(n)}px`}}};xn._registerDrawableClass(hF);var fF=class extends qr{constructor(e,t){super(e),this.type="PolylineMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor);let n=this.points;e.beginPath(),n.forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),e.stroke(),e.restore()}isPointInPath(e){let t=this.points,n=[];for(let e=0;e<t.length-1;e++)n.push(t[e],t[e+1]);return Gt.isPointOnLineSegments(e,n,1*this.tolerance)}getVertexes(){return this.points}getClassType(){return"PolylineMarkup"}};xn._registerDrawableClass(fF);var dF=class extends qr{constructor(e,t){super(e),this.type="RectMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath(),this.getVertexes().forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let t=this.getVertexes(),n=[];for(let e=0;e<t.length;e++){let r=t[e],i=t[e+1]||t[0];n.push(r,i)}return Gt.isPointOnLineSegments(e,n,2*this.tolerance)}getClassType(){return"RectMarkup"}};xn._registerDrawableClass(dF);var pF=class extends qr{constructor(e,t){super(e),this.type="XMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.beginPath();let[n,r,i,a]=this.getVertexes().map((e=>this.transToScreenCoord(e,t)));e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let[t,n,r,i]=this.getVertexes();return Gt.isPointOnLineSegments(e,[t,r,n,i],.1)}getClassType(){return"XMarkup"}};xn._registerDrawableClass(pF);var lue=new Ft,mF=new q,gF=new Te,rot=new Te(1,0),iot=new Te(0,-1),vF=class extends Po{constructor(e,t,n=""){super(e,t,n),this.type="CloudRectWithTextMarkup",this.textPosition=new q,this.textBounds=new Ft,this.text="CloudRectWithText",this.fontSize=12,this.handleClick=()=>{var e;null==(e=this.textInput)||e.blur()},this.handleInput=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus||(this.text=this.textInput.value,this.calcInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")},this.handleCompositionEnd=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus||(this.text=this.textInput.value,this.calcInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")}}draw(e,t){this.drawCloudRect(e,t),(this.isEditing||this.text.length>0)&&this.drawLeaderLine(e,t),!this.isEditing&&this.text.length>0&&this.drawText(e,t,this.text)}drawCloudRect(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor),e.beginPath();let n=this.getCloudPoints();n.push(n[0]);let r,i=[];for(let e=0;e<n.length-1;e++){let t=n[e],a=n[e+1],s=mF.subVectors(a,t);r||(r=s.length()/10);let o=s.length(),l=s.normalize(),h=Math.round(o/r);for(let e=0;e<h;e++)i.push(t.clone().add(l.clone().multiplyScalar(r*e)))}i.push(i[0]),this.controlPoints=[],this.vertexes=[];for(let n=0;n<i.length-1;n++){let r=i[n],a=i[n+1],s=this.transToScreenCoord(r,t),o=this.transToScreenCoord(a,t),l=ml.getControlPointByTwoPoints(s,o);this.controlPoints.push(s,o),this.vertexes.push(r,a,mn.screen2World(l,t,this.ctx.canvas)),0===n&&e.moveTo(s.x,s.y),e.quadraticCurveTo(l.x,l.y,o.x,o.y)}e.closePath(),e.stroke(),e.restore()}drawLeaderLine(e,t){if(!this.controlPoints)return;let n=this.transToScreenCoord(this.textPosition,t);this.controlPoints.sort(((e,t)=>n.distanceTo(e)-n.distanceTo(t)));let r=this.controlPoints[0];e.save(),e.lineWidth=vF.LEADER_LINE_WIDTH,e.strokeStyle=cn.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke(),e.restore()}drawText(e,t,n){let r=this.transToScreenCoord(this.points[0],t),i=this.transToScreenCoord(this.textPosition,t),a=gF.subVectors(i,r).normalize(),s=a.cross(rot)<0,o=a.cross(iot)<0,l=n.split("\n"),h=this.fontSize/this.tolerance,u=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${h}px Arial`;for(let t=0;t<l.length;t++){let n=l[t],r=e.measureText(n).width;r>u&&(u=r)}let c=this.padding/this.tolerance,d=c+h/2,p=l.length*h+2*c,f=new Te(o?i.x:i.x-u-2*c,s?i.y-d:i.y-p+(p-d));for(let t=0;t<l.length;t++){let n=l[t];e.fillText(n,f.x+c,f.y+c+t*h,u+2*c)}e.strokeRect(f.x,f.y,u+2*c,l.length*h+2*c),e.restore();let m=mn.screen2World(gF.set(f.x,f.y),t,this.ctx.canvas);m.z=0;let g=mn.screen2World(gF.set(f.x+u+2*c,f.y+p),t,this.ctx.canvas);g.z=0,this.textBounds.setFromPoints([m,g])}translate(e,t){let n=mF.set(e,t,0);this.points.forEach((e=>e.add(n))),this.textPosition.add(n);let[r,i]=this.points;return this.x=Math.min(r.x,i.x),this.y=Math.max(r.y,i.y),this.width=Math.abs(i.x-r.x),this.height=Math.abs(i.y-r.y),this}update(e){let[t,n]=e;return this.points=e,this.x=Math.min(t.x,n.x),this.y=Math.max(t.y,n.y),this.width=Math.abs(n.x-t.x),this.height=Math.abs(n.y-t.y),this.textPosition||(this.textPosition=new q),this.textPosition.set(Math.max(t.x,n.x),Math.max(t.y,n.y),0),this}getCloudPoints(){return[new q(this.x,this.y,0),new q(this.x+this.width,this.y,0),new q(this.x+this.width,this.y-this.height,0),new q(this.x,this.y-this.height,0)]}getBounds(){return lue.setFromPoints([...this.points,...this.vertexes||[]]),lue.union(this.textBounds)}getVertexes(){let e=this.getBounds(),t=e.min,n=e.getSize(mF);return[new q(t.x,t.y,0),new q(t.x+n.x,t.y,0),new q(t.x+n.x,t.y+n.y,0),new q(t.x,t.y+n.y,0)]}isLeaderTextSelected(e){return this.textBounds.containsPoint(e)}translateLeaderText(e,t){let n=new q(e,t,0);return this.textPosition.add(n),this}isPointInPath(e){let t=this.getCloudPoints(),n=[];for(let e=0;e<t.length;e++){let r=t[e],i=t[(e+1)%t.length];n.push(r,i)}return Gt.isPointOnLineSegments(e,n,3*this.tolerance)||this.textBounds.containsPoint(e)}setData(e){super.setData(e);let t=e.textPosition||[0,0];this.textPosition.set(t[0],t[1],0)}updateText(e){this.text=e}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,text:this.text,textPosition:[this.textPosition.x,this.textPosition.y],type:this.getClassType()}}getClassType(){return"CloudRectWithTextMarkup"}addInput(e,t,n){let r=this.padding/this.tolerance+this.fontSize/this.tolerance/2;super.addInput(e,t,n-r)}updateInputPosition(e,t){var n;if(!this.manager||!this.textInput)return;let r=t.clone().sub(e).normalize().cross(new Te(0,-1))<0,i=this.textInput.value,a=(null==(n=this.manager.overlayRender)?void 0:n.measureTextLength(i,this.fontSize/this.tolerance+"px Arial"))||Po.DEFAULT_INPUT_WIDTH,s=this.padding/this.tolerance+this.fontSize/this.tolerance/2;this.textInput.style.left=`${r?t.x:t.x-this.padding/this.tolerance*2-a}px`,this.textInput.style.top=t.y-s+"px",this.textPosition.copy(mn.screen2World(t,this.manager.camera,this.manager.viewerCanvas))}calcInputPositionByText(e){var t;if(!this.textInput||!this.manager)return;let n=(null==(t=this.manager.overlayRender)?void 0:t.measureTextLength(e,this.fontSize/this.tolerance+"px Arial"))||0;if(n>Po.DEFAULT_INPUT_WIDTH){let e=mn.world2Screen(this.points[0],this.manager.camera,this.manager.viewerCanvas),t=mn.world2Screen(this.textPosition,this.manager.camera,this.manager.viewerCanvas).clone().sub(e).normalize().cross(new Te(0,-1))<0,r=mn.world2Screen(this.textPosition,this.manager.camera,this.manager.viewerCanvas);t||(this.textInput.style.left=r.x-n-this.padding/this.tolerance*2+"px"),this.textInput.style.width=`${Math.round(n)}px`}}},Fd=vF;Fd.LEADER_LINE_WIDTH=1,xn._registerDrawableClass(Fd);var Io=class{constructor(e){this.name=e}},nx=class extends Io{constructor(e,t){super("AddMarkup"),this.manager=e,this.data=t}undo(){let e=this.manager.getMarkupById(this.data.id);return!!e&&(this.manager.removeMarkup(e),!0)}redo(){let e=this.manager.createMarkup(this.data);return!!e&&(this.manager.addMarkup(e),!0)}},rx=class extends Io{constructor(e,t){super("RemoveMarkup"),this.manager=e,this.data=t}undo(){let e=this.manager.createMarkup(this.data);return!!e&&(this.manager.addMarkup(e),!0)}redo(){let e=this.manager.getMarkupById(this.data.id);return!!e&&(this.manager.removeMarkup(e),!0)}},mA=class extends Io{constructor(e,t,n){super("UpdateMarkup"),this.manager=e,this.oldData=t,this.newData=n}undo(){let e=this.manager.getMarkupById(this.oldData.id);return!!e&&(this.manager.updateMarkup(e,this.oldData),!0)}redo(){let e=this.manager.getMarkupById(this.newData.id);return!!e&&(this.manager.updateMarkup(e,this.newData),!0)}},ix=(e=>(e.BaseViewer="BaseViewer",e.Viewer2d="Viewer2d",e))(ix||{});function Ns(e){return(Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Do(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yF(e,t){if("object"!=Ns(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Ns(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function sx(e){var t=yF(e,"string");return"symbol"==Ns(t)?t:String(t)}function cue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,sx(r.key),r)}}function Oo(e,t,n){return t&&cue(e.prototype,t),n&&cue(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function gl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ax(e,t){return(ax=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Gg(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ax(e,t)}function Nd(e,t){if(t&&("object"===Ns(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return gl(e)}function Lo(e){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ic(e,t,n){return(t=sx(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xF(e){if(Array.isArray(e))return e}function bF(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function gA(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function EF(e,t){if(e){if("string"==typeof e)return gA(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gA(e,t)}}function _F(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function TF(e){return xF(e)||bF(e)||EF(e)||_F()}function uue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sot={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},aot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Do(this,e),this.init(t,n)}return Oo(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||sot,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,r){return r&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,hue(hue({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}(),ac=new aot,Ch=function(){function e(){Do(this,e),this.observers={}}return Oo(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e]=this.observers[e].filter((function(e){return e!==t}))}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function ox(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.resolve=e,n.reject=t,n}function fue(e){return null==e?"":""+e}function oot(e,t,n){e.forEach((function(e){t[e]&&(n[e]=t[e])}))}function wF(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var a="string"!=typeof t?[].concat(t):t.split(".");a.length>1;){if(i())return{};var s=r(a.shift());!e[s]&&n&&(e[s]=new n),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return i()?{}:{obj:e,k:r(a.shift())}}function due(e,t,n){var r=wF(e,t,Object);r.obj[r.k]=n}function lot(e,t,n,r){var i=wF(e,t,Object),a=i.obj,s=i.k;a[s]=a[s]||[],r&&(a[s]=a[s].concat(n)),r||a[s].push(n)}function xA(e,t){var n=wF(e,t),r=n.obj,i=n.k;if(r)return r[i]}function pue(e,t,n){var r=xA(e,n);return void 0!==r?r:xA(t,n)}function Mue(e,t,n){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"==typeof e[r]||e[r]instanceof String||"string"==typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):Mue(e[r],t[r],n):e[r]=t[r]);return e}function Wg(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var cot={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function uot(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return cot[e]})):e}var EA="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,hot=[" ",",","?","!",";"];function fot(e,t,n){t=t||"",n=n||"";var r=hot.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===r.length)return!0;var i=new RegExp("(".concat(r.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),a=!i.test(e);if(!a){var s=e.indexOf(n);s>0&&!i.test(e.substring(0,s))&&(a=!0)}return a}function mue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dot(e){var t=pot();return function(){var n,r=Lo(e);if(t){var i=Lo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nd(this,n)}}function pot(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Aue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var r=t.split(n),i=e,a=0;a<r.length;++a){if(!i||"string"==typeof i[r[a]]&&a+1<r.length)return;if(void 0===i[r[a]]){for(var s=2,o=r.slice(a,a+s).join(n),l=i[o];void 0===l&&r.length>a+s;)s++,l=i[o=r.slice(a,a+s).join(n)];if(void 0===l)return;if(null===l)return null;if(t.endsWith(o)){if("string"==typeof l)return l;if(o&&"string"==typeof l[o])return l[o]}var h=r.slice(a+s).join(n);return h?Aue(l,h,n):void 0}i=i[r[a]]}return i}}var mot=function(e){Gg(n,Ch);var t=dot(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Do(this,n),r=t.call(this),EA&&Ch.call(gl(r)),r.data=e||{},r.options=i,void 0===r.options.keySeparator&&(r.options.keySeparator="."),void 0===r.options.ignoreJSONStructure&&(r.options.ignoreJSONStructure=!0),r}return Oo(n,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,a=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(s=e.split("."));var o=xA(this.data,s);return o||!a||"string"!=typeof n?o:Aue(this.data&&this.data[e]&&this.data[e][t],n,i)}},{key:"addResource",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},a=this.options.keySeparator;void 0===a&&(a=".");var s=[e,t];n&&(s=s.concat(a?n.split(a):n)),e.indexOf(".")>-1&&(r=t,t=(s=e.split("."))[1]),this.addNamespaces(t),due(this.data,s,r),i.silent||this.emit("added",e,t,n,r)}},{key:"addResources",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)("string"==typeof n[i]||"[object Array]"===Object.prototype.toString.apply(n[i]))&&this.addResource(e,t,i,n[i],{silent:!0});r.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(r=n,n=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var o=xA(this.data,s)||{};r?Mue(o,n,i):o=vA(vA({},o),n),due(this.data,s,o),a.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?vA(vA({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),n}(),Cue={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,r,i){var a=this;return e.forEach((function(e){a.processors[e]&&(t=a.processors[e].process(t,n,r,i))})),t}};function gue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function got(e){var t=vot();return function(){var n,r=Lo(e);if(t){var i=Lo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nd(this,n)}}function vot(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var vue={},yue=function(e){Gg(n,Ch);var t=got(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Do(this,n),r=t.call(this),EA&&Ch.call(gl(r)),oot(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,gl(r)),r.options=i,void 0===r.options.keySeparator&&(r.options.keySeparator="."),r.logger=ac.create("translator"),r}return Oo(n,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS||[],a=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||fot(e,n,r));if(a&&!s){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:i};var l=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(l[0])>-1)&&(i=l.shift()),e=l.join(r)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,t,r){var i=this;if("object"!==Ns(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,o=this.extractFromKey(e[e.length-1],t),l=o.key,h=o.namespaces,u=h[h.length-1],c=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(d){var p=t.nsSeparator||this.options.nsSeparator;return a?(f.res="".concat(u).concat(p).concat(l),f):"".concat(u).concat(p).concat(l)}return a?(f.res=l,f):l}var f=this.resolve(e,t),m=f&&f.res,g=f&&f.usedKey||l,v=f&&f.exactUsedKey||l,y=Object.prototype.toString.apply(m),x=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,b=!this.i18nFormat||this.i18nFormat.handleAsObject;if(b&&m&&("string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(y)<0&&("string"!=typeof x||"[object Array]"!==y)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var _=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,m,na(na({},t),{},{ns:h})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return a?(f.res=_,f):_}if(s){var w="[object Array]"===y,S=w?[]:{},M=w?v:g;for(var T in m)if(Object.prototype.hasOwnProperty.call(m,T)){var E="".concat(M).concat(s).concat(T);S[T]=this.translate(E,na(na({},t),{joinArrays:!1,ns:h})),S[T]===E&&(S[T]=m[T])}m=S}}else if(b&&"string"==typeof x&&"[object Array]"===y)(m=m.join(x))&&(m=this.extendTranslation(m,e,t,r));else{var A=!1,C=!1,P=void 0!==t.count&&"string"!=typeof t.count,I=n.hasDefaultValue(t),R=P?this.pluralResolver.getSuffix(c,t.count,t):"",L=t["defaultValue".concat(R)]||t.defaultValue;!this.isValidLookup(m)&&I&&(A=!0,m=L),this.isValidLookup(m)||(C=!0,m=l);var O=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&C?void 0:m,D=I&&L!==m&&this.options.updateMissing;if(C||A||D){if(this.logger.log(D?"updateKey":"missingKey",c,u,l,D?L:m),s){var k=this.resolve(l,na(na({},t),{},{keySeparator:!1}));k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var N=[],F=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&F&&F[0])for(var U=0;U<F.length;U++)N.push(F[U]);else"all"===this.options.saveMissingTo?N=this.languageUtils.toResolveHierarchy(t.lng||this.language):N.push(t.lng||this.language);var B=function(e,n,r){var a=I&&r!==m?r:O;i.options.missingKeyHandler?i.options.missingKeyHandler(e,u,n,a,D,t):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,u,n,a,D,t),i.emit("missingKey",e,u,n,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&P?N.forEach((function(e){i.pluralResolver.getSuffixes(e,t).forEach((function(n){B([e],l+n,t["defaultValue".concat(n)]||L)}))})):B(N,l,L))}m=this.extendTranslation(m,e,t,f,r),C&&m===l&&this.options.appendNamespaceToMissingKey&&(m="".concat(u,":").concat(l)),(C||A)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(l):l,A?m:void 0):this.options.parseMissingKeyHandler(m))}return a?(f.res=m,f):m}},{key:"extendTranslation",value:function(e,t,n,r,i){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,na(na({},this.options.interpolation.defaultVariables),n),r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(na(na({},n),{interpolation:na(na({},this.options.interpolation),n.interpolation)}));var s,o="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){var l=e.match(this.interpolator.nestingRegexp);s=l&&l.length}var h=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(h=na(na({},this.options.interpolation.defaultVariables),h)),e=this.interpolator.interpolate(e,h,n.lng||this.language,n),o){var u=e.match(this.interpolator.nestingRegexp);s<(u&&u.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return i&&i[0]===r[0]&&!n.context?(a.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):a.translate.apply(a,r.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var c=n.postProcess||this.options.postProcess,d="string"==typeof c?[c]:c;return null!=e&&d&&d.length&&!1!==n.applyPostProcessor&&(e=Cue.handle(d,e,t,this.options&&this.options.postProcessPassResolved?na({i18nResolved:r},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,r,i,a,s=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,o),h=l.key;n=h;var u=l.namespaces;s.options.fallbackNS&&(u=u.concat(s.options.fallbackNS));var c=void 0!==o.count&&"string"!=typeof o.count,d=c&&!o.ordinal&&0===o.count&&s.pluralResolver.shouldUseIntlApi(),p=void 0!==o.context&&("string"==typeof o.context||"number"==typeof o.context)&&""!==o.context,f=o.lngs?o.lngs:s.languageUtils.toResolveHierarchy(o.lng||s.language,o.fallbackLng);u.forEach((function(e){s.isValidLookup(t)||(a=e,!vue["".concat(f[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(a)&&(vue["".concat(f[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(n,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(a,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(n){if(!s.isValidLookup(t)){i=n;var a,l=[h];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(l,h,n,e,o);else{var u;c&&(u=s.pluralResolver.getSuffix(n,o.count,o));var f="".concat(s.options.pluralSeparator,"zero");if(c&&(l.push(h+u),d&&l.push(h+f)),p){var m="".concat(h).concat(s.options.contextSeparator).concat(o.context);l.push(m),c&&(l.push(m+u),d&&l.push(m+f))}}for(;a=l.pop();)s.isValidLookup(t)||(r=a,t=s.getResource(n,e,a,o))}})))}))}})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:a}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}]),n}();function SF(e){return e.charAt(0).toUpperCase()+e.slice(1)}var yot=function(){function e(t){Do(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ac.create("languageUtils")}return Oo(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=SF(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=SF(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=SF(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var r=n.formatLanguageCode(e);(!n.options.supportedLngs||n.isSupportedCode(r))&&(t=r)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var r=n.getLanguagePartFromCode(e);if(n.isSupportedCode(r))return t=r;t=n.options.supportedLngs.find((function(e){if(0===e.indexOf(r))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],a=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&a(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&a(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&a(this.getLanguagePartFromCode(e))):"string"==typeof e&&a(this.formatLanguageCode(e)),r.forEach((function(e){i.indexOf(e)<0&&a(n.formatLanguageCode(e))})),i}}]),e}(),xot=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],bot={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},Eot=["v1","v2","v3"],xue={zero:0,one:1,two:2,few:3,many:4,other:5};function _ot(){var e={};return xot.forEach((function(t){t.lngs.forEach((function(n){e[n]={numbers:t.nr,plurals:bot[t.fc]}}))})),e}var Tot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Do(this,e),this.languageUtils=t,this.options=n,this.logger=ac.create("pluralResolver"),(!this.options.compatibilityJSON||"v4"===this.options.compatibilityJSON)&&("undefined"==typeof Intl||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=_ot()}return Oo(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((function(e,t){return xue[e]-xue[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):r.numbers.map((function(r){return t.getSuffix(e,r,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(r.select(t)):this.getSuffixRetroCompatible(r,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),i=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var a=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_".concat(i.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?a():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}},{key:"shouldUseIntlApi",value:function(){return!Eot.includes(this.options.compatibilityJSON)}}]),e}();function bue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Sot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Do(this,e),this.logger=ac.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return Oo(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:uot,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?Wg(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?Wg(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?Wg(t.nestingPrefix):t.nestingPrefixEscaped||Wg("$t("),this.nestingSuffix=t.nestingSuffix?Wg(t.nestingSuffix):t.nestingSuffixEscaped||Wg(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,r){var i,a,s,o=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function h(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(o.formatSeparator)<0){var i=pue(t,l,e);return o.alwaysFormat?o.format(i,void 0,n,vl(vl(vl({},r),t),{},{interpolationkey:e})):i}var a=e.split(o.formatSeparator),s=a.shift().trim(),h=a.join(o.formatSeparator).trim();return o.format(pue(t,l,s),h,n,vl(vl(vl({},r),t),{},{interpolationkey:s}))};this.resetRegExp();var c=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return h(e)}},{regex:this.regexp,safeValue:function(e){return o.escapeValue?h(o.escape(e)):h(e)}}].forEach((function(t){for(s=0;i=t.regex.exec(e);){var n=i[1].trim();if(void 0===(a=u(n)))if("function"==typeof c){var l=c(e,i,r);a="string"==typeof l?l:""}else if(r&&r.hasOwnProperty(n))a="";else{if(d){a=i[0];continue}o.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),a=""}else"string"!=typeof a&&!o.useRawValueToEscape&&(a=fue(a));var h=t.safeValue(a);if(e=e.replace(i[0],h),d?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,++s>=o.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,r,i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=vl({},a);function o(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var r=e.split(new RegExp("".concat(n,"[ ]*{"))),i="{".concat(r[1]);e=r[0];var a=(i=this.interpolate(i,s)).match(/'/g),o=i.match(/"/g);(a&&a.length%2==0&&!o||o.length%2!=0)&&(i=i.replace(/'/g,'"'));try{s=JSON.parse(i),t&&(s=vl(vl({},t),s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(i)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;n=this.nestingRegexp.exec(e);){var l=[],h=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=u.shift(),l=u,h=!0}if((r=t(o.call(this,n[1].trim(),s),s))&&n[0]===e&&"string"!=typeof r)return r;"string"!=typeof r&&(r=fue(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),r=""),h&&(r=l.reduce((function(e,t){return i.format(e,t,a.lng,vl(vl({},a),{},{interpolationkey:n[1].trim()}))}),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}]),e}();function Eue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ah(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Eue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wot(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var r=e.split("(");t=r[0].toLowerCase().trim();var i=r[1].substring(0,r[1].length-1);if("currency"===t&&i.indexOf(":")<0)n.currency||(n.currency=i.trim());else if("relativetime"===t&&i.indexOf(":")<0)n.range||(n.range=i.trim());else{i.split(";").forEach((function(e){if(e){var t=TF(e.split(":")),r=t[0],i=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[r.trim()]||(n[r.trim()]=i),"false"===i&&(n[r.trim()]=!1),"true"===i&&(n[r.trim()]=!0),isNaN(i)||(n[r.trim()]=parseInt(i,10))}}))}}return{formatName:t,formatOptions:n}}function jg(e){var t={};return function(n,r,i){var a=r+JSON.stringify(i),s=t[a];return s||(s=e(r,i),t[a]=s),s(n)}}var Mot=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Do(this,e),this.logger=ac.create("formatter"),this.options=t,this.formats={number:jg((function(e,t){var n=new Intl.NumberFormat(e,t);return function(e){return n.format(e)}})),currency:jg((function(e,t){var n=new Intl.NumberFormat(e,Ah(Ah({},t),{},{style:"currency"}));return function(e){return n.format(e)}})),datetime:jg((function(e,t){var n=new Intl.DateTimeFormat(e,Ah({},t));return function(e){return n.format(e)}})),relativetime:jg((function(e,t){var n=new Intl.RelativeTimeFormat(e,Ah({},t));return function(e){return n.format(e,t.range||"day")}})),list:jg((function(e,t){var n=new Intl.ListFormat(e,Ah({},t));return function(e){return n.format(e)}}))},this.init(t)}return Oo(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=jg(t)}},{key:"format",value:function(e,t,n,r){var i=this;return t.split(this.formatSeparator).reduce((function(e,t){var a=wot(t),s=a.formatName,o=a.formatOptions;if(i.formats[s]){var l=e;try{var h=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},u=h.locale||h.lng||r.locale||r.lng||n;l=i.formats[s](e,u,Ah(Ah(Ah({},o),r),h))}catch(e){i.logger.warn(e)}return l}return i.logger.warn("there was no format function for ".concat(s)),e}),e)}}]),e}();function _ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_ue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Aot(e){var t=Cot();return function(){var n,r=Lo(e);if(t){var i=Lo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nd(this,n)}}function Cot(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Rot(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}var Pot=function(e){Gg(n,Ch);var t=Aot(n);function n(e,r,i){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Do(this,n),a=t.call(this),EA&&Ch.call(gl(a)),a.backend=e,a.store=r,a.services=i,a.languageUtils=i.languageUtils,a.options=s,a.logger=ac.create("backendConnector"),a.waitingReads=[],a.maxParallelReads=s.maxParallelReads||10,a.readingCalls=0,a.maxRetries=s.maxRetries>=0?s.maxRetries:5,a.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(i,s.backend,s),a}return Oo(n,[{key:"queueLoad",value:function(e,t,n,r){var i=this,a={},s={},o={},l={};return e.forEach((function(e){var r=!0;t.forEach((function(t){var o="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[o]=2:i.state[o]<0||(1===i.state[o]?void 0===s[o]&&(s[o]=!0):(i.state[o]=1,r=!1,void 0===s[o]&&(s[o]=!0),void 0===a[o]&&(a[o]=!0),void 0===l[t]&&(l[t]=!0)))})),r||(o[e]=!0)})),(Object.keys(a).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(a),pending:Object.keys(s),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,n){var r=e.split("|"),i=r[0],a=r[1];t&&this.emit("failedLoading",i,a,t),n&&this.store.addResourceBundle(i,a,n),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(n){lot(n.loaded,[i],a),Rot(n,e),t&&n.errors.push(t),0===n.pendingCount&&!n.done&&(Object.keys(n.loaded).forEach((function(e){s[e]||(s[e]={});var t=n.loaded[e];t.length&&t.forEach((function(t){void 0===s[e][t]&&(s[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:a,callback:s}):(this.readingCalls++,this.backend[n](e,t,(function(o,l){if(r.readingCalls--,r.waitingReads.length>0){var h=r.waitingReads.shift();r.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}o&&l&&i<r.maxRetries?setTimeout((function(){r.read.call(r,e,t,n,i+1,2*a,s)}),a):s(o,l)}))):s(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var a=this.queueLoad(e,t,r,i);if(!a.toLoad.length)return a.pending.length||i(),null;a.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),i=r[0],a=r[1];this.read(i,a,"read",void 0,void 0,(function(r,s){r&&t.logger.warn("".concat(n,"loading namespace ").concat(a," for language ").concat(i," failed"),r),!r&&s&&t.logger.log("".concat(n,"loaded namespace ").concat(a," for language ").concat(i),s),t.loaded(e,r,s)}))}},{key:"saveMissing",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null==n||""===n||(this.backend&&this.backend.create&&this.backend.create(e,t,n,r,null,Tue(Tue({},a),{},{isUpdate:i})),e&&e[0]&&this.store.addResource(e[0],t,n,r))}}]),n}();function Iot(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===Ns(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===Ns(e[2])||"object"===Ns(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Sue(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function wue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wue(Object(n),!0).forEach((function(t){ic(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Dot(e){var t=Oot();return function(){var n,r=Lo(e);if(t){var i=Lo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nd(this,n)}}function Oot(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function yA(){}function Lot(e){Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(t){"function"==typeof e[t]&&(e[t]=e[t].bind(e))}))}var bA=function(e){Gg(n,Ch);var t=Dot(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(Do(this,n),e=t.call(this),EA&&Ch.call(gl(e)),e.options=Sue(r),e.services={},e.logger=ac,e.modules={external:[]},Lot(gl(e)),i&&!e.isInitialized&&!r.isClone){if(!e.options.initImmediate)return e.init(r,i),Nd(e,gl(e));setTimeout((function(){e.init(r,i)}),0)}return e}return Oo(n,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var r=Iot();function i(e){return e?"function"==typeof e?new e:e:null}if(this.options=sc(sc(sc({},r),this.options),Sue(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=sc(sc({},r.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var a;this.modules.logger?ac.init(i(this.modules.logger),this.options):ac.init(null,this.options),this.modules.formatter?a=this.modules.formatter:"undefined"!=typeof Intl&&(a=Mot);var s=new yot(this.options);this.store=new mot(this.options.resources,this.options);var o=this.services;o.logger=ac,o.resourceStore=this.store,o.languageUtils=s,o.pluralResolver=new Tot(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),a&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(o.formatter=i(a),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new Sot(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new Pot(i(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.languageDetector&&(o.languageDetector=i(this.modules.languageDetector),o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=i(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new yue(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,n||(n=yA),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var h=ox(),u=function(){var t=function(t,r){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),h.resolve(r),n(t,r)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),h}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yA,r="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return n();var i=[],a=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};if(r)a(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return a(e)}));this.options.preload&&this.options.preload.forEach((function(e){return a(e)})),this.services.backendConnector.load(i,this.options.ns,(function(e){!e&&!t.resolvedLanguage&&t.language&&t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var r=ox();return e||(e=this.languages),t||(t=this.options.ns),n||(n=yA),this.services.backendConnector.reload(e,t,(function(e){r.resolve(),n(e)})),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&Cue.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var r=ox();this.emit("languageChanging",e);var i=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},a=function(a){!e&&!a&&n.services.languageDetector&&(a=[]);var s="string"==typeof a?a:n.services.languageUtils.getBestMatchFromCodes(a);s&&(n.language||i(s),n.translator.language||n.translator.changeLanguage(s),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(s)),n.loadResources(s,(function(e){!function(e,a){a?(i(a),n.translator.changeLanguage(a),n.isLanguageChangingTo=void 0,n.emit("languageChanged",a),n.logger.log("languageChanged",a)):n.isLanguageChangingTo=void 0,r.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,s)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(a):a(e):a(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(e,t,n){var r=this,i=function e(t,i){var a;if("object"!==Ns(i)){for(var s=arguments.length,o=new Array(s>2?s-2:0),l=2;l<s;l++)o[l-2]=arguments[l];a=r.options.overloadTranslationOptionHandler([t,i].concat(o))}else a=sc({},i);a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns,a.keyPrefix=a.keyPrefix||n||e.keyPrefix;var h=r.options.keySeparator||".",u=a.keyPrefix?"".concat(a.keyPrefix).concat(h).concat(t):t;return r.t(u,a)};return"string"==typeof e?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,a=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var s=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};if(n.precheck){var o=n.precheck(this,s);if(void 0!==o)return o}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(r,e)&&(!i||s(a,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,r=ox();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=ox();"string"==typeof e&&(e=[e]);var r=this.options.preload||[],i=e.filter((function(e){return r.indexOf(e)<0}));return i.length?(this.options.preload=r.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yA,i=sc(sc(sc({},this.options),t),{isClone:!0}),a=new n(i);(void 0!==t.debug||void 0!==t.prefix)&&(a.logger=a.logger.clone(t));return["store","services","language"].forEach((function(t){a[t]=e[t]})),a.services=sc({},this.services),a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a.translator=new yue(a.services,a.options),a.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e].concat(n))})),a.init(i,r),a.translator.options=a.options,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),n}();ic(bA,"createInstance",(function(){return new bA(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var ra=bA.createInstance();ra.createInstance=bA.createInstance;var fIt=ra.createInstance,dIt=ra.init,pIt=ra.loadResources,mIt=ra.reloadResources,gIt=ra.use,vIt=ra.changeLanguage,yIt=ra.getFixedT,Gr=ra.t,xIt=ra.exists,bIt=ra.setDefaultNamespace,EIt=ra.hasLoadedNamespace,_It=ra.loadNamespaces,TIt=ra.loadLanguages,Bd=ra,_A=class{constructor(e){var t;this.jobCount=0;let n=document.createElement("div");n.classList.add("x-spinner"),n.appendChild(document.createElement("span")),n.appendChild(document.createElement("span")),n.appendChild(document.createElement("span")),n.appendChild(document.createElement("span")),null==(t=e.widgetContainer)||t.appendChild(n),this.element=n,this.setSpinnerVisibility(this.jobCount>0)}setSpinnerVisibility(e){e?this.element.classList.remove("hidden"):this.element.classList.add("hidden")}increaseJobCount(){this.setSpinnerVisibility(++this.jobCount>0)}decreaseJobCount(){this.jobCount<=0?fe.warn("[Viewer] jobCount should be at least 1 here!"):this.setSpinnerVisibility(--this.jobCount>0)}destroy(){this.element.remove(),this.jobCount=0}},Xg=class{constructor(e){this.width=0,this.height=0;let t=document.getElementById(e);t||(fe.warn("[Container] containerId:",e,"is not found in dom tree! will append to document body"),t=document.body);let n=document.createElement("div");n.classList.add("x-container"),n.style.cssText="width: 100%; height: 100%; position: relative;",t.appendChild(n),this.container=n,this.width=t.clientWidth,this.height=t.clientHeight,this.initViewerContainer(),this.initWidgetContainer()}initViewerContainer(){let e=this.container;if(!e)return;let t=document.createElement("div");t.classList.add("dxf-viewer-container"),t.style.cssText="width: 100%; height: 100%; display: inline-block; position: relative; overflow: hidden;",e.appendChild(t),this.viewerContainer=t}initWidgetContainer(){let e=this.container;if(!e)return;let t=document.createElement("div");t.classList.add("x-widget-container"),e.appendChild(t),this.widgetContainer=t}get needResize(){let e=this.width!==this.container.clientWidth||this.height!==this.container.clientHeight;return e&&(this.width=this.container.clientWidth,this.height=this.container.clientHeight),e}destroy(){this.widgetContainer&&(this.widgetContainer.remove(),this.widgetContainer=void 0),this.viewerContainer&&(this.viewerContainer.remove(),this.viewerContainer=void 0),this.container.remove()}},Yg=class{constructor(e){var t;this.progressItems=new Map,this.replaceReg=new RegExp(/<em>[\s\S]*<\/em>/,"g");let n=document.createElement("div");n.classList.add("progress-bar"),null==(t=e.widgetContainer)||t.appendChild(n),this.element=n}addProgressItem(e,t="ProgressBar.Loading",n){this.progressItems.get(e)&&fe.error(`[Viewer] ProgressItem with id ${e} already exists!`);let r=document.createElement("div");r.classList.add("progress-bar-item"),r.innerHTML=`${Gr(t)}: <em></em>`,this.element.append(r),this.progressItems.set(e,{div:r,onProgress:n})}removeProgressItem(e){let t=this.progressItems.get(e);null==t||t.div.remove(),this.progressItems.delete(e),0===this.progressItems.size&&this.setVisible(!1)}updateProgress(e,t,n){let r=this.progressItems.get(e);if(!r)return;let i=t?`${t}`:"";t&&null!=n&&(i+=": "),null!=n&&(n<0||n>100?(console.warn(`[ProgressBar] Invalid progress value: ${n}`),i+="--%"):i+=`${n.toFixed(2)}%`),r.div.innerHTML=i}updateProgressBar(e,t,n=0,r=100){var i;let a=this.progressItems.get(e);if(!a)return;let s=100*(t instanceof ProgressEvent?t.loaded:t)/(t instanceof ProgressEvent?t.total:100)*(r-n)/100+n;a.div.innerHTML=a.div.innerHTML.replace(this.replaceReg,`<em>${s<0||s>100?"--":s.toFixed(2)}%</em>`),null==(i=a.onProgress)||i.call(a,new ProgressEvent("LoadProgress",{loaded:s,total:100}))}setVisible(e){e?this.element.classList.remove("hidden"):this.element.classList.add("hidden")}delayRemoveProgressItem(e,t=3e3){setTimeout((()=>{let t=this.progressItems.get(e);null==t||t.div.remove(),this.progressItems.delete(e)}),t)}destroy(){this.progressItems.forEach((e=>{e.div.remove()})),this.progressItems.clear(),this.element.remove()}},MF=(e=>(e.Perspective="Perspective",e.Orthographic="Orthographic",e))(MF||{}),Pn={LEFT:1,RIGHT:2,MIDDLE:4},yt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768});function Sa(e){return e.isPerspectiveCamera}function ji(e){return e.isOrthographicCamera}var Ud=2*Math.PI,AF=Math.PI/2,$g=Math.PI/180;function Hd(e,t,n){return Math.max(t,Math.min(n,e))}function Yr(e,t=1e-5){return Math.abs(e)<t}function $r(e,t,n=1e-5){return Yr(e-t,n)}function CF(e,t){return Math.round(e/t)*t}function Zg(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Kg(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function lx(e,t,n,r,i=1/0,a){let s=2/(r=Math.max(1e-4,r)),o=s*a,l=1/(1+o+.48*o*o+.235*o*o*o),h=e-t,u=t,c=i*r;h=Hd(h,-c,c),t=e-h;let d=(n.value+s*h)*a;n.value=(n.value-s*d)*l;let p=t+(h+d)*l;return u-e>0==p>u&&(p=u,n.value=(p-u)/a),p}function RF(e,t,n,r,i=1/0,a,s){let o=2/(r=Math.max(1e-4,r)),l=o*a,h=1/(1+l+.48*l*l+.235*l*l*l),u=t.x,c=t.y,d=t.z,p=e.x-u,f=e.y-c,m=e.z-d,g=u,v=c,y=d,x=i*r,b=p*p+f*f+m*m;if(b>x*x){let e=Math.sqrt(b);p=p/e*x,f=f/e*x,m=m/e*x}u=e.x-p,c=e.y-f,d=e.z-m;let _=(n.x+o*p)*a,w=(n.y+o*f)*a,S=(n.z+o*m)*a;n.x=(n.x-o*_)*h,n.y=(n.y-o*w)*h,n.z=(n.z-o*S)*h,s.x=u+(p+_)*h,s.y=c+(f+w)*h,s.z=d+(m+S)*h;let M=g-e.x,T=v-e.y,E=y-e.z;return M*(s.x-g)+T*(s.y-v)+E*(s.z-y)>0&&(s.x=g,s.y=v,s.z=y,n.x=(s.x-g)/a,n.y=(s.y-v)/a,n.z=(s.z-y)/a),s}function TA(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function SA(e,t){return!!ji(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}var wA=class{constructor(){this._listeners={}}addEventListener(e,t){let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){let n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){let n=this._listeners[e];if(void 0!==n){let e=n.indexOf(t);-1!==e&&n.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e)}}},MA=1/8,kot=Bn.isBrowser&&/Mac/.test(navigator.platform),Fot=!(Bn.isBrowser&&"PointerEvent"in window),In,Rue,AA,PF,wa,On,Or,Jg,oc,lc,Vd,Pue,Iue,yl,cx,Qg,Due,IF,Oue,DF,OF,CA,cc=class extends wA{constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=0,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=yt.NONE,this._viewport=null,this._dollyControlAmount=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=Bn.isBrowser?new DOMRect:{x:0,y:0,width:0,height:0,left:0,right:0,top:0,bottom:0},this._activePointers=[],this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new In.Vector3,this._focalOffsetVelocity=new In.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,n)=>{if(Sa(this._camera)){let r=On.copy(this._camera.position).sub(this._target),i=this._camera.getEffectiveFOV()*$g,a=r.length()*Math.tan(.5*i),s=this.truckSpeed*e*a/this._elementRect.height,o=this.truckSpeed*t*a/this._elementRect.height;this.verticalDragToForward?(n?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(s,0,!0),this.forward(-o,!0)):n?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y+o,this._focalOffsetEnd.z,!0):this.truck(s,o,!0)}else if(ji(this._camera)){let r=this._camera,i=this.truckSpeed*e*(r.right-r.left)/r.zoom/this._elementRect.width,a=this.truckSpeed*t*(r.top-r.bottom)/r.zoom/this._elementRect.height;n?this.setFocalOffset(this._focalOffsetEnd.x+i,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(i,a,!0)}},this._rotateInternal=(e,t)=>{let n=Ud*this.azimuthRotateSpeed*e/this._elementRect.height,r=Ud*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(n,r,!0)},this._dollyInternal=(e,t,n)=>{let r=Math.pow(.95,-e*this.dollySpeed),i=this._sphericalEnd.radius*r,a=this._sphericalEnd.radius,s=a*(e>=0?-1:1);this.dollyTo(i),this.infinityDolly&&(i<this.minDistance||this.maxDistance===this.minDistance)&&(this._camera.getWorldDirection(On),this._targetEnd.add(On.normalize().multiplyScalar(s)),this._target.add(On.normalize().multiplyScalar(s))),this.dollyToCursor&&(this._dollyControlAmount+=this._sphericalEnd.radius-a,this.infinityDolly&&(i<this.minDistance||this.maxDistance===this.minDistance)&&(this._dollyControlAmount-=s),this._dollyControlCoord.set(t,n))},this._zoomInternal=(e,t,n)=>{let r=Math.pow(.95,e*this.dollySpeed),i=this._zoomEnd;this.zoomTo(this._zoom*r),this.dollyToCursor&&(this._dollyControlAmount+=this._zoomEnd-i,this._dollyControlCoord.set(t,n))},void 0===In&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=(new In.Quaternion).setFromUnitVectors(this._camera.up,AA),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=yt.NONE,this._target=new In.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new In.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new In.Spherical).setFromVector3(On.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._nearPlaneCorners=[new In.Vector3,new In.Vector3,new In.Vector3,new In.Vector3],this._updateNearPlaneCorners(),this._boundary=new In.Box3(new In.Vector3(-1/0,-1/0,-1/0),new In.Vector3(1/0,1/0,1/0)),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlAmount=0,this._dollyControlCoord=new In.Vector2,this.mouseButtons={left:yt.ROTATE,middle:yt.DOLLY,right:yt.TRUCK,wheel:Sa(this._camera)?yt.DOLLY:ji(this._camera)?yt.ZOOM:yt.NONE},this.touches={one:yt.TOUCH_ROTATE,two:Sa(this._camera)?yt.TOUCH_DOLLY_TRUCK:ji(this._camera)?yt.TOUCH_ZOOM_TRUCK:yt.NONE,three:yt.TOUCH_TRUCK};let n=new In.Vector2,r=new In.Vector2,i=new In.Vector2,a=e=>{if(!this._enabled||!this._domElement)return;let t="mouse"!==e.pointerType?null:(e.buttons&Pn.LEFT)===Pn.LEFT?Pn.LEFT:(e.buttons&Pn.MIDDLE)===Pn.MIDDLE?Pn.MIDDLE:(e.buttons&Pn.RIGHT)===Pn.RIGHT?Pn.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._activePointers.splice(this._activePointers.indexOf(e),1)}let n={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(n),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("pointerup",h),this._domElement.addEventListener("pointermove",o),this._domElement.addEventListener("pointerup",h),f(e)},s=e=>{if(!this._enabled||!this._domElement)return;let t=(e.buttons&Pn.LEFT)===Pn.LEFT?Pn.LEFT:(e.buttons&Pn.MIDDLE)===Pn.MIDDLE?Pn.MIDDLE:(e.buttons&Pn.RIGHT)===Pn.RIGHT?Pn.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._activePointers.splice(this._activePointers.indexOf(e),1)}let n={pointerId:0,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:(e.buttons&Pn.LEFT)===Pn.LEFT?Pn.LEFT:(e.buttons&Pn.MIDDLE)===Pn.LEFT?Pn.MIDDLE:(e.buttons&Pn.RIGHT)===Pn.LEFT?Pn.RIGHT:null};this._activePointers.push(n),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("mouseup",u),this._domElement.addEventListener("mousemove",l),this._domElement.addEventListener("mouseup",u),f(e)},o=e=>{let t=e.pointerId,n=this._findPointerById(t);if(n){if(n.clientX=e.clientX,n.clientY=e.clientY,n.deltaX=e.movementX,n.deltaY=e.movementY,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(e.buttons&Pn.LEFT)===Pn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&Pn.MIDDLE)===Pn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&Pn.RIGHT)===Pn.RIGHT&&(this._state=this._state|this.mouseButtons.right);m()}},l=e=>{let t=this._findPointerById(0);t&&(t.clientX=e.clientX,t.clientY=e.clientY,t.deltaX=e.movementX,t.deltaY=e.movementY,this._state=0,(e.buttons&Pn.LEFT)===Pn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&Pn.MIDDLE)===Pn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&Pn.RIGHT)===Pn.RIGHT&&(this._state=this._state|this.mouseButtons.right),m())},h=e=>{let t=e.pointerId,n=this._findPointerById(t);if(n&&this._activePointers.splice(this._activePointers.indexOf(n),1),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=yt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=yt.NONE;g()},u=()=>{let e=this._findPointerById(0);e&&this._activePointers.splice(this._activePointers.indexOf(e),1),this._state=yt.NONE,g()},c=-1,d=e=>{if(!this._enabled||this.mouseButtons.wheel===yt.NONE)return;if(this.dollyToCursor||this.mouseButtons.wheel===yt.ROTATE||this.mouseButtons.wheel===yt.TRUCK){let e=performance.now();c-e<1e3&&this._getClientRect(this._elementRect),c=e}let t=kot?-1:-3,n=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),r=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,i=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case yt.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case yt.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1),this._isUserControllingTruck=!0;break;case yt.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0),this._isUserControllingOffset=!0;break;case yt.DOLLY:this._dollyInternal(-n,r,i),this._isUserControllingDolly=!0;break;case yt.ZOOM:this._zoomInternal(-n,r,i),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},p=e=>{if(this._domElement&&this._enabled&&this.mouseButtons.right===cc.ACTION.NONE){let t=e instanceof PointerEvent?e.pointerId:(MouseEvent,0),n=this._findPointerById(t);return n&&this._activePointers.splice(this._activePointers.indexOf(n),1),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mousemove",l),void this._domElement.removeEventListener("mouseup",u)}},f=e=>{if(this._enabled){if(TA(this._activePointers,wa),this._getClientRect(this._elementRect),n.copy(wa),r.copy(wa),this._activePointers.length>=2){let e=wa.x-this._activePointers[1].clientX,t=wa.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t);i.set(0,n);let a=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),s=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);r.set(a,s)}if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(e.buttons&Pn.LEFT)===Pn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&Pn.MIDDLE)===Pn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&Pn.RIGHT)===Pn.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&yt.ROTATE)===yt.ROTATE||(this._state&yt.TOUCH_ROTATE)===yt.TOUCH_ROTATE||(this._state&yt.TOUCH_DOLLY_ROTATE)===yt.TOUCH_DOLLY_ROTATE||(this._state&yt.TOUCH_ZOOM_ROTATE)===yt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&yt.TRUCK)===yt.TRUCK||(this._state&yt.TOUCH_TRUCK)===yt.TOUCH_TRUCK||(this._state&yt.TOUCH_DOLLY_TRUCK)===yt.TOUCH_DOLLY_TRUCK||(this._state&yt.TOUCH_ZOOM_TRUCK)===yt.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&yt.DOLLY)===yt.DOLLY||(this._state&yt.TOUCH_DOLLY)===yt.TOUCH_DOLLY||(this._state&yt.TOUCH_DOLLY_TRUCK)===yt.TOUCH_DOLLY_TRUCK||(this._state&yt.TOUCH_DOLLY_OFFSET)===yt.TOUCH_DOLLY_OFFSET||(this._state&yt.TOUCH_DOLLY_ROTATE)===yt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&yt.ZOOM)===yt.ZOOM||(this._state&yt.TOUCH_ZOOM)===yt.TOUCH_ZOOM||(this._state&yt.TOUCH_ZOOM_TRUCK)===yt.TOUCH_ZOOM_TRUCK||(this._state&yt.TOUCH_ZOOM_OFFSET)===yt.TOUCH_ZOOM_OFFSET||(this._state&yt.TOUCH_ZOOM_ROTATE)===yt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&yt.OFFSET)===yt.OFFSET||(this._state&yt.TOUCH_OFFSET)===yt.TOUCH_OFFSET||(this._state&yt.TOUCH_DOLLY_OFFSET)===yt.TOUCH_DOLLY_OFFSET||(this._state&yt.TOUCH_ZOOM_OFFSET)===yt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},m=()=>{if(!this._enabled)return;TA(this._activePointers,wa);let e=!!Bn.isBrowser&&(this._domElement&&document.pointerLockElement===this._domElement),t=e?-this._activePointers[0].deltaX:r.x-wa.x,a=e?-this._activePointers[0].deltaY:r.y-wa.y;if(r.copy(wa),((this._state&yt.ROTATE)===yt.ROTATE||(this._state&yt.TOUCH_ROTATE)===yt.TOUCH_ROTATE||(this._state&yt.TOUCH_DOLLY_ROTATE)===yt.TOUCH_DOLLY_ROTATE||(this._state&yt.TOUCH_ZOOM_ROTATE)===yt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,a),this._isUserControllingRotate=!0),(this._state&yt.DOLLY)===yt.DOLLY||(this._state&yt.ZOOM)===yt.ZOOM){let e=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&yt.DOLLY)===yt.DOLLY?(this._dollyInternal(a*MA,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(a*MA,e,t),this._isUserControllingZoom=!0)}if((this._state&yt.TOUCH_DOLLY)===yt.TOUCH_DOLLY||(this._state&yt.TOUCH_ZOOM)===yt.TOUCH_ZOOM||(this._state&yt.TOUCH_DOLLY_TRUCK)===yt.TOUCH_DOLLY_TRUCK||(this._state&yt.TOUCH_ZOOM_TRUCK)===yt.TOUCH_ZOOM_TRUCK||(this._state&yt.TOUCH_DOLLY_OFFSET)===yt.TOUCH_DOLLY_OFFSET||(this._state&yt.TOUCH_ZOOM_OFFSET)===yt.TOUCH_ZOOM_OFFSET||(this._state&yt.TOUCH_DOLLY_ROTATE)===yt.TOUCH_DOLLY_ROTATE||(this._state&yt.TOUCH_ZOOM_ROTATE)===yt.TOUCH_ZOOM_ROTATE){let e=wa.x-this._activePointers[1].clientX,t=wa.y-this._activePointers[1].clientY,n=Math.sqrt(e*e+t*t),a=i.y-n;i.set(0,n);let s=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&yt.TOUCH_DOLLY)===yt.TOUCH_DOLLY||(this._state&yt.TOUCH_DOLLY_ROTATE)===yt.TOUCH_DOLLY_ROTATE||(this._state&yt.TOUCH_DOLLY_TRUCK)===yt.TOUCH_DOLLY_TRUCK||(this._state&yt.TOUCH_DOLLY_OFFSET)===yt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(a*MA,s,o),this._isUserControllingDolly=!0):(this._zoomInternal(a*MA,s,o),this._isUserControllingZoom=!0)}((this._state&yt.TRUCK)===yt.TRUCK||(this._state&yt.TOUCH_TRUCK)===yt.TOUCH_TRUCK||(this._state&yt.TOUCH_DOLLY_TRUCK)===yt.TOUCH_DOLLY_TRUCK||(this._state&yt.TOUCH_ZOOM_TRUCK)===yt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,a,!1),this._isUserControllingTruck=!0),((this._state&yt.OFFSET)===yt.OFFSET||(this._state&yt.TOUCH_OFFSET)===yt.TOUCH_OFFSET||(this._state&yt.TOUCH_DOLLY_OFFSET)===yt.TOUCH_DOLLY_OFFSET||(this._state&yt.TOUCH_ZOOM_OFFSET)===yt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,a,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{TA(this._activePointers,wa),r.copy(wa),0===this._activePointers.length&&this._domElement&&(this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mouseup",u),this.dispatchEvent({type:"controlend"}))};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),Fot&&this._domElement.addEventListener("mousedown",s),this._domElement.addEventListener("pointercancel",h),this._domElement.addEventListener("wheel",d),this._domElement.addEventListener("contextmenu",p)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("mousedown",s),this._domElement.removeEventListener("pointercancel",h),this._domElement.removeEventListener("wheel",d),this._domElement.removeEventListener("contextmenu",p),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mouseup",u))},this.cancel=()=>{this._state!==yt.NONE&&(this._state=yt.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}static install(e){In=e.THREE,Rue=Object.freeze(new In.Vector3(0,0,0)),AA=Object.freeze(new In.Vector3(0,1,0)),PF=Object.freeze(new In.Vector3(0,0,1)),wa=new In.Vector2,On=new In.Vector3,Or=new In.Vector3,Jg=new In.Vector3,oc=new In.Vector3,lc=new In.Vector3,Vd=new In.Vector3,Pue=new In.Vector3,Iue=new In.Vector3,yl=new In.Spherical,cx=new In.Spherical,Qg=new In.Box3,Due=new In.Box3,IF=new In.Sphere,Oue=new In.Quaternion,DF=new In.Quaternion,OF=new In.Matrix4,CA=new In.Raycaster}static get ACTION(){return yt}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,n=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,n)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,n=!1){this._isUserControllingRotate=!1;let r=Hd(e,this.minAzimuthAngle,this.maxAzimuthAngle),i=Hd(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!n||$r(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$r(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){this._isUserControllingDolly=!1;let n=this._sphericalEnd.radius,r=Hd(e,this.minDistance,this.maxDistance);if(this.colliderMeshes.length>=1){let e=this._collisionTest(),t=$r(e,this._spherical.radius);if(!(n>r)&&t)return Promise.resolve();this._sphericalEnd.radius=Math.min(r,e)}else this._sphericalEnd.radius=r;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let i=!t||$r(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Hd(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let n=!t||$r(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(n)}truck(e,t,n=!1){this._camera.updateMatrix(),oc.setFromMatrixColumn(this._camera.matrix,0),lc.setFromMatrixColumn(this._camera.matrix,1),oc.multiplyScalar(e),lc.multiplyScalar(-t);let r=On.copy(oc).add(lc),i=Or.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)}forward(e,t=!1){On.setFromMatrixColumn(this._camera.matrix,0),On.crossVectors(this._camera.up,On),On.multiplyScalar(e);let n=Or.copy(this._targetEnd).add(On);return this.moveTo(n.x,n.y,n.z,t)}elevate(e,t=!1){return On.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+On.x,this._targetEnd.y+On.y,this._targetEnd.z+On.z,t)}moveTo(e,t,n,r=!1){this._isUserControllingTruck=!1;let i=On.set(e,t,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);let a=!r||$r(this._target.x,this._targetEnd.x,this.restThreshold)&&$r(this._target.y,this._targetEnd.y,this.restThreshold)&&$r(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,n,r=!1){let i=On.set(e,t,n).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(i.x,i.y,i.z,r)}fitToBox(e,t,{cover:n=!1,paddingLeft:r=0,paddingRight:i=0,paddingBottom:a=0,paddingTop:s=0}={}){let o=[],l=e.isBox3?Qg.copy(e):Qg.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let h=CF(this._sphericalEnd.theta,AF),u=CF(this._sphericalEnd.phi,AF);o.push(this.rotateTo(h,u,t));let c=On.setFromSpherical(this._sphericalEnd).normalize(),d=Oue.setFromUnitVectors(c,PF),p=$r(Math.abs(c.y),1);p&&d.multiply(DF.setFromAxisAngle(AA,h)),d.multiply(this._yAxisUpSpaceInverse);let f=Due.makeEmpty();Or.copy(l.min).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.min).setX(l.max.x).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.min).setY(l.max.y).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.max).setZ(l.min.z).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.min).setZ(l.max.z).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.max).setY(l.min.y).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.max).setX(l.min.x).applyQuaternion(d),f.expandByPoint(Or),Or.copy(l.max).applyQuaternion(d),f.expandByPoint(Or),f.min.x-=r,f.min.y-=a,f.max.x+=i,f.max.y+=s,d.setFromUnitVectors(PF,c),p&&d.premultiply(DF.invert()),d.premultiply(this._yAxisUpSpace);let m=f.getSize(On),g=f.getCenter(Or).applyQuaternion(d);if(Sa(this._camera)){let e=this.getDistanceToFitBox(m.x,m.y,m.z,n);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(ji(this._camera)){let e=this._camera,r=e.right-e.left,i=e.top-e.bottom,a=n?Math.max(r/m.x,i/m.y):Math.min(r/m.x,i/m.y);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.zoomTo(a,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(e,t){let n=[],r=e instanceof In.Sphere?IF.copy(e):cc.createBoundingSphere(e,IF);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,t)),Sa(this._camera)){let e=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(e,t))}else if(ji(this._camera)){let e=this._camera.right-this._camera.left,i=this._camera.top-this._camera.bottom,a=2*r.radius,s=Math.min(e/a,i/a);n.push(this.zoomTo(s,t))}return n.push(this.setFocalOffset(0,0,0,t)),Promise.all(n)}setLookAt(e,t,n,r,i,a,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1;let o=Or.set(r,i,a),l=On.set(e,t,n);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let h=!s||$r(this._target.x,this._targetEnd.x,this.restThreshold)&&$r(this._target.y,this._targetEnd.y,this.restThreshold)&&$r(this._target.z,this._targetEnd.z,this.restThreshold)&&$r(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$r(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&$r(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,n,r,i,a,s,o,l,h,u,c,d,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1;let f=On.set(r,i,a),m=Or.set(e,t,n);yl.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));let g=Jg.set(h,u,c),v=Or.set(s,o,l);cx.setFromVector3(v.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(g,d));let y=cx.theta-yl.theta,x=cx.phi-yl.phi,b=cx.radius-yl.radius;this._sphericalEnd.set(yl.radius+b*d,yl.phi+x*d,yl.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let _=!p||$r(this._target.x,this._targetEnd.x,this.restThreshold)&&$r(this._target.y,this._targetEnd.y,this.restThreshold)&&$r(this._target.z,this._targetEnd.z,this.restThreshold)&&$r(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&$r(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&$r(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(_)}setPosition(e,t,n,r=!1){return this.setLookAt(e,t,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(e,t,n,r=!1){let i=this.getPosition(On),a=this.setLookAt(i.x,i.y,i.z,e,t,n,r);return this._sphericalEnd.phi=Hd(this.polarAngle,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,n,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);let i=!r||$r(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&$r(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&$r(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}setOrbitPoint(e,t,n){this._camera.updateMatrixWorld(),oc.setFromMatrixColumn(this._camera.matrixWorldInverse,0),lc.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Vd.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let r=On.set(e,t,n),i=r.distanceTo(this._camera.position),a=r.sub(this._camera.position);oc.multiplyScalar(a.x),lc.multiplyScalar(a.y),Vd.multiplyScalar(a.z),On.copy(oc).add(lc).add(Vd),On.z=On.z+i,this.dollyTo(i,!1),this.setFocalOffset(-On.x,On.y,-On.z,!1),this.moveTo(e,t,n,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,n,r){null!==e?(this._viewport=this._viewport||new In.Vector4,"number"==typeof e?this._viewport.set(e,t,n,r):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,n,r=!1){if(SA(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let i=e/t,a=this._camera.getEffectiveFOV()*$g,s=this._camera.aspect;return.5*((r?i>s:i<s)?t:e/s)/Math.tan(.5*a)+.5*n}getDistanceToFitSphere(e){if(SA(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*$g,n=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),r=1<this._camera.aspect?t:n;return e/Math.sin(.5*r)}getTarget(e){return(e&&e.isVector3?e:new In.Vector3).copy(this._targetEnd)}getPosition(e){return(e&&e.isVector3?e:new In.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)}getFocalOffset(e){return(e&&e.isVector3?e:new In.Vector3).copy(this._focalOffsetEnd)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Ud,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Ud),this._spherical.theta+=Ud*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Ud)}reset(e=!1){let t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,AA),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,n=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,i=Pue.subVectors(this._targetEnd,this._target),a=Iue.subVectors(this._focalOffsetEnd,this._focalOffset),s=this._zoomEnd-this._zoom;if(Yr(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=lx(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(Yr(n))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=lx(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(Yr(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=lx(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(Yr(i.x)&&Yr(i.y)&&Yr(i.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;RF(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(Yr(a.x)&&Yr(a.y)&&Yr(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;RF(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(0!==this._dollyControlAmount){if(Sa(this._camera)){let e=this._camera,t=On.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),n=Or.copy(t).cross(e.up).normalize();0===n.lengthSq()&&(n.x=1);let r=Jg.crossVectors(n,t),i=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*$g*.5),a=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,s=On.copy(this._targetEnd).add(n.multiplyScalar(this._dollyControlCoord.x*i*e.aspect)).add(r.multiplyScalar(this._dollyControlCoord.y*i));this._targetEnd.lerp(s,a)}else if(ji(this._camera)){let e=this._camera,t=On.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),n=Or.set(0,0,-1).applyQuaternion(e.quaternion),r=Jg.copy(t).add(n.multiplyScalar(-t.dot(e.up))),i=-(this._zoom-this._dollyControlAmount-this._zoomEnd)/this._zoom,a=On.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),s=this._targetEnd.dot(a);this._targetEnd.lerp(r,i);let o=this._targetEnd.dot(a),l=a.multiplyScalar(o-s);this._targetEnd.sub(l)}this._target.copy(this._targetEnd),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._dollyControlAmount=0}if(Yr(s))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=lx(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);let o=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,o),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!Yr(this._focalOffset.x)||!Yr(this._focalOffset.y)||!Yr(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),oc.setFromMatrixColumn(this._camera.matrix,0),lc.setFromMatrixColumn(this._camera.matrix,1),Vd.setFromMatrixColumn(this._camera.matrix,2),oc.multiplyScalar(this._focalOffset.x),lc.multiplyScalar(-this._focalOffset.y),Vd.multiplyScalar(this._focalOffset.z),On.copy(oc).add(lc).add(Vd),this._camera.position.add(On)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),On.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),Yr(t,this.restThreshold)&&Yr(n,this.restThreshold)&&Yr(r,this.restThreshold)&&Yr(i.x,this.restThreshold)&&Yr(i.y,this.restThreshold)&&Yr(i.z,this.restThreshold)&&Yr(a.x,this.restThreshold)&&Yr(a.y,this.restThreshold)&&Yr(a.z,this.restThreshold)&&Yr(s,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Zg(this.maxDistance),minZoom:this.minZoom,maxZoom:Zg(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Zg(this.maxPolarAngle),minAzimuthAngle:Zg(this.minAzimuthAngle),maxAzimuthAngle:Zg(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:On.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let n=JSON.parse(e),r=On.fromArray(n.position);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Kg(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Kg(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Kg(n.maxPolarAngle),this.minAzimuthAngle=Kg(n.minAzimuthAngle),this.maxAzimuthAngle=Kg(n.maxAzimuthAngle),this.smoothTime=n.smoothTime,this.draggingSmoothTime=n.draggingSmoothTime,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],t),yl.setFromVector3(r.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(yl.theta,yl.phi,t),this.zoomTo(n.zoom,t),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):this._addAllEventListeners(e)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_encloseToBoundary(e,t,n){let r=t.lengthSq();if(0===r)return e;let i=Or.copy(t).add(e),a=this._boundary.clampPoint(i,Jg).sub(i),s=a.lengthSq();if(0===s)return e.add(t);if(s===r)return e;if(0===n)return e.add(t).add(a);{let r=1+n*s/t.dot(a);return e.add(Or.copy(t).multiplyScalar(r)).add(a.multiplyScalar(1-n))}}_updateNearPlaneCorners(){if(Sa(this._camera)){let e=this._camera,t=e.near,n=e.getEffectiveFOV()*$g,r=Math.tan(.5*n)*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(ji(this._camera)){let e=this._camera,t=1/e.zoom,n=e.left*t,r=e.right*t,i=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(n,i,0),this._nearPlaneCorners[1].set(r,i,0),this._nearPlaneCorners[2].set(r,a,0),this._nearPlaneCorners[3].set(n,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||SA(this._camera,"_collisionTest"))return e;let t=On.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);OF.lookAt(Rue,t,this._camera.up);for(let n=0;n<4;n++){let r=Or.copy(this._nearPlaneCorners[n]);r.applyMatrix4(OF);let i=Jg.addVectors(this._target,r);CA.set(i,t),CA.far=this._spherical.radius+1;let a=CA.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}static createBoundingSphere(e,t=new In.Sphere){let n=t,r=n.center;Qg.makeEmpty(),e.traverseVisible((e=>{e.isMesh&&Qg.expandByObject(e)})),Qg.getCenter(r);let i=0;return e.traverseVisible((e=>{if(!e.isMesh)return;let t=e,n=t.geometry.clone();if(n.applyMatrix4(t.matrixWorld),n.isBufferGeometry){let e=n.attributes.position;for(let t=0,n=e.count;t<n;t++)On.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(On))}else{let e=n.attributes.position;for(let t=0,n=e.count;t<n;t++)On.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(On))}})),n.radius=Math.sqrt(i),n}},xr=cc,ux=(e=>(e[e.Orbit=0]="Orbit",e[e.FirstPerson=1]="FirstPerson",e[e.Plan=2]="Plan",e))(ux||{}),RA=class{constructor(e){this.mode=0,this.cameraManager=e}setupControl(){let e=this.cameraManager.camera,t=this.cameraManager.cameraControls;t.mouseButtons={left:xr.ACTION.ROTATE,middle:xr.ACTION.DOLLY,right:xr.ACTION.TRUCK,wheel:Sa(e)?xr.ACTION.DOLLY:ji(e)?xr.ACTION.ZOOM:xr.ACTION.NONE},t.touches={one:xr.ACTION.TOUCH_ROTATE,two:Sa(e)?xr.ACTION.TOUCH_DOLLY_TRUCK:ji(e)?xr.ACTION.TOUCH_ZOOM_TRUCK:xr.ACTION.NONE,three:xr.ACTION.TOUCH_TRUCK},t.dollyToCursor=!0,t.azimuthRotateSpeed=1,t.polarRotateSpeed=1,t.minDistance=1,t.maxDistance=300,t.minZoom=3,this.cameraManager.cameraControls.truckSpeed=2}adjustCameraByBBox(e){let t=this.cameraManager.cameraControls,n=new q;e.getSize(n);let r=n.length();t.minDistance=1,t.maxDistance=10*r,t.minZoom=3}},PA=class{constructor(e){this.mode=2,this.cameraManager=e}setupControl(){let e=this.cameraManager.camera,t=this.cameraManager.cameraControls;t.mouseButtons={left:xr.ACTION.TRUCK,middle:xr.ACTION.TRUCK,right:xr.ACTION.TRUCK,wheel:Sa(e)?xr.ACTION.DOLLY:ji(e)?xr.ACTION.ZOOM:xr.ACTION.NONE},t.touches={one:xr.ACTION.TOUCH_TRUCK,two:Sa(e)?xr.ACTION.TOUCH_DOLLY_TRUCK:ji(e)?xr.ACTION.TOUCH_ZOOM_TRUCK:xr.ACTION.NONE,three:xr.ACTION.NONE},t.dollyToCursor=!0,t.azimuthRotateSpeed=0,t.polarRotateSpeed=0,t.truckSpeed=1,t.maxZoom=1/0,t.minZoom=-1/0}adjustCameraByBBox(e){}},Rh=50,LF=new q,IA=class{constructor(e){this.previousDistance=-1,this.previousAzimuthRotateSpeed=1,this.previousPolarRotateSpeed=1,this.previousDollySpeed=1,this.previousTruckSpeed=2,this.previousMouseLeft=xr.ACTION.NONE,this.enableKeyDown=!0,this.projection="Perspective",this.onKeyDown=e=>{if(!this.enableKeyDown)return;let t=this.cameraControls,n=10*this.viewer.getPixelSizeInWorldCoord(),r="Viewer2d"!==this.viewer.name;switch(e.code){case"ArrowLeft":r?t.rotate(.1,0,!0):"Viewer2d"===this.viewer.name&&t.truck(n,0,!0);break;case"ArrowRight":r?t.rotate(-.1,0,!0):"Viewer2d"===this.viewer.name&&t.truck(-n,0,!0);break;case"ArrowUp":r?t.rotate(0,.1,!0):"Viewer2d"===this.viewer.name&&t.truck(0,n,!0);break;case"ArrowDown":r?t.rotate(0,-.1,!0):"Viewer2d"===this.viewer.name&&t.truck(0,-n,!0);break;case"KeyW":r&&(ji(this.activeCamera)?t.zoom(.01,!0):t.dolly(1,!0));break;case"KeyA":r&&t.truck(-n,0,!0);break;case"KeyS":r&&(ji(this.activeCamera)?t.zoom(-.01,!0):t.dolly(-1,!0));break;case"KeyD":r&&t.truck(n,0,!0);break;case"KeyQ":r&&t.truck(0,-n,!0);break;case"KeyE":r&&t.truck(0,n,!0)}},this.onChange=()=>{this.viewer.enableRender()},this.viewer=e;let t=e.viewerContainer,n=t.clientWidth/t.clientHeight;this.perspectiveCamera=new ui(Vle,n,VM,zM),this.orthographicCamera=new To(Rh*n/-2,Rh*n/2,Rh/2,Rh/-2,VM,zM),this.activeCamera=this.perspectiveCamera,this.setupCameras(),xr.install({THREE:$t}),this.cameraControls=new xr(this.perspectiveCamera,e.getInputManager()),this.controlsMap={0:new RA(this),2:new PA(this)},this.activeControls=this.controlsMap[0],this.setupControls(),this.setProjection("Perspective"),this.anchor=this.createAnchor()}get viewerContainer(){return this.viewer.viewerContainer}get inputManager(){return this.viewer.getInputManager()}createAnchor(){var e;let t=document.createElement("div");return t.className="anchor",null==(e=this.viewerContainer)||e.appendChild(t),this.cameraControls.addEventListener("control",(()=>{if(this.isOrbitPointVisible()){let e=this.getTarget(),t=mn.world2Screen(e,this.activeCamera,this.viewerContainer);this.setAnchorPosition(t.x,t.y)}})),t}setAnchorPosition(e,t){this.anchor.style.left=`${e}px`,this.anchor.style.top=`${t}px`}setOrbitPointVisible(e){e?this.anchor.classList.add("active"):this.anchor.classList.remove("active")}isOrbitPointVisible(){return this.anchor.classList.contains("active")}setOrthoCameraAspect(e,t){let n=e/t;this.orthographicCamera.left=-Rh*n/2,this.orthographicCamera.right=Rh*n/2,this.orthographicCamera.top=Rh/2,this.orthographicCamera.bottom=-Rh/2,this.orthographicCamera.updateProjectionMatrix()}setupCameras(){this.setCameraPositionAndTarget(this.perspectiveCamera)}setCameraPositionAndTarget(e){e.position.z=10,e.position.y=10,e.position.x=10,e.lookAt(new q(0,0,0))}setupControls(){let e=this.cameraControls;e.smoothTime=.1,e.draggingSmoothTime=0,e.infinityDolly=!0,e.setTarget(0,0,0),e.addEventListener("controlend",(()=>this.onChange)),e.addEventListener("update",(()=>this.viewer.dispatchEvent("controlchange"))),e.addEventListener("rest",(()=>this.onChange)),this.inputManager.addEventListener("keydown",this.onKeyDown)}setOrthoCamera(){if(1===this.activeControls.mode)return;this.previousDistance=this.cameraControls.distance,this.cameraControls.distance=200;let{width:e,height:t}=this.getDims();this.setupOrthoCamera(t,e),this.activeCamera=this.orthographicCamera,this.projection="Orthographic"}getDims(){let e=new q;this.perspectiveCamera.getWorldDirection(e);let t=new q;this.cameraControls.getTarget(t);let n=t.clone().sub(this.perspectiveCamera.position).dot(e),{clientWidth:r,clientHeight:i}=this.viewer.viewerContainer,a=r/i,s=this.perspectiveCamera.fov,o=2*n*Math.atan(s*(Math.PI/180)/2);return{width:o*a,height:o}}setupOrthoCamera(e,t){this.cameraControls.mouseButtons.wheel=xr.ACTION.ZOOM;let n=this.perspectiveCamera,r=this.orthographicCamera;r.zoom=1,r.left=t/-2,r.right=t/2,r.top=e/2,r.bottom=e/-2,r.updateProjectionMatrix(),r.position.copy(n.position),r.quaternion.copy(n.quaternion),this.cameraControls.camera=r}setPerspectiveCamera(){let e=this.cameraControls;e.mouseButtons.wheel=xr.ACTION.DOLLY;let t=this.perspectiveCamera,n=this.orthographicCamera;t.position.copy(n.position),t.quaternion.copy(n.quaternion),t.updateProjectionMatrix(),e.camera=t,e.mouseButtons.wheel=xr.ACTION.DOLLY,this.activeCamera=t,this.projection="Perspective",e.distance=this.previousDistance,e.zoomTo(1)}update(e){return this.cameraControls.update(e)}updateAspect(){let{clientWidth:e,clientHeight:t}=this.viewer.viewerContainer;this.perspectiveCamera.aspect=e/t,this.perspectiveCamera.updateProjectionMatrix(),this.setOrthoCameraAspect(e,t)}get camera(){return this.activeCamera}enableKeyControl(e){this.enableKeyDown=e}getTarget(){return this.cameraControls.getTarget(LF)}getPosition(){return this.cameraControls.getPosition(LF)}adjustCameraByBBox(e){let t=this.camera.near,n=this.camera.far,r=new q;e.getSize(r);let i=r.length(),a=i/5,s=5*i;if(t>a||n<s){let e=e=>Ct.numberToString(e);fe.info(`[Viewer] BBox's longest side is: ${e(i)}`),t>a&&(fe.warn(`[Viewer] camera.near(${e(t)}) shouldn't bigger than ${e(a)}, will change it!`),this.camera.near=a),n<s&&(fe.warn(`[Viewer] camera.far(${e(n)}) shouldn't smaller than ${e(s)}, will change it!`),this.camera.far=s)}this.activeControls.adjustCameraByBBox(e),this.cameraControls.update(0)}enableControl(e){this.cameraControls.enabled=e}get enableRotate(){let e=this.cameraControls;return!!e.azimuthRotateSpeed||!!e.polarRotateSpeed}set enableRotate(e){let t=this.cameraControls;e?(t.azimuthRotateSpeed=this.previousAzimuthRotateSpeed,t.polarRotateSpeed=this.previousPolarRotateSpeed):(this.previousAzimuthRotateSpeed=t.azimuthRotateSpeed,this.previousPolarRotateSpeed=t.polarRotateSpeed,t.azimuthRotateSpeed=0,t.polarRotateSpeed=0)}enableZoom(e){let t=this.cameraControls;e?t.dollySpeed=this.previousDollySpeed:(this.previousDollySpeed=t.dollySpeed,t.dollySpeed=0)}enablePan(e){let t=this.cameraControls;e?t.truckSpeed=this.previousTruckSpeed:(this.previousTruckSpeed=t.dollySpeed,t.truckSpeed=0)}enableMouseLeft(e){let t=this.cameraControls;e?t.mouseButtons.left=this.previousMouseLeft:(this.previousMouseLeft=t.mouseButtons.left,t.mouseButtons.left=xr.ACTION.NONE)}setCameraPosition(e){this.cameraControls.setPosition(e.x,e.y,e.z)}setCameraTarget(e){this.cameraControls.setTarget(e.x,e.y,e.z)}flyTo(e,t){let n=this.cameraControls;n.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z,!0),n.setFocalOffset(0,0,0,!0)}flyToPosition(e,t,n){this.cameraControls.moveTo(e,t,n,!0)}flyToBox(e){let t=new ir;e.getBoundingSphere(t),this.cameraControls.fitToSphere(t,!0)}fitToSphere(e){this.cameraControls.fitToSphere(e,!0)}flyToObject(e){let t=(new Ft).setFromObject(e),n=new ir;t.getBoundingSphere(n),this.cameraControls.fitToSphere(n,!0)}flyToViewpoint(e){this.flyTo(e.eye,e.look),null!=e.zoom&&(this.orthographicCamera.zoom=e.zoom)}getDistanceToFitSphere(e){return this.cameraControls.getDistanceToFitSphere(e)}setNavigationMode(e){this.activeControls.mode!==e&&(this.activeControls=this.controlsMap[e],this.activeControls.setupControl())}getProjection(){return this.projection}setProjection(e){this.projection!==e&&(this.projection=e,"Orthographic"===e?this.setOrthoCamera():this.setPerspectiveCamera())}setOrbitPoint(e){this.cameraControls.setOrbitPoint(e.x,e.y,e.z)}getCameraDirection(){return this.activeCamera.getWorldDirection(LF)}getCameraConfig(){return{eye:this.activeCamera.position,look:this.getTarget(),up:this.activeCamera.up,near:this.activeCamera.near,far:this.activeCamera.far,zoom:this.activeCamera.zoom}}getCurrentViewpoint(){return{eye:this.activeCamera.position,look:this.getTarget(),up:this.activeCamera.up,zoom:this.activeCamera.zoom}}setCameraConfig(e){let t=this.cameraControls,{near:n=VM,far:r=zM,up:i=new q(0,1,0),zoom:a=1,eye:s,look:o}=e;this.activeCamera.near=n,this.activeCamera.far=r,this.activeCamera.up.set(i.x,i.y,i.z),this.activeCamera.updateProjectionMatrix(),t.updateCameraUp(),t.zoomTo(a),t.setLookAt(s.x,s.y,s.z,o.x,o.y,o.z,!0),t.setFocalOffset(0,0,0,!0)}destroy(){this.anchor.remove(),this.inputManager.removeEventListener("keydown",this.onKeyDown),this.perspectiveCamera.removeFromParent(),this.orthographicCamera.removeFromParent()}},DA=class extends rs{constructor(e,t={}){let n=t.font;if(void 0===n)super();else{let r=n.generateShapes(e,t.size);void 0===t.depth&&void 0!==t.height&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=void 0!==t.depth?t.depth:void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(r,t)}this.type="TextGeometry"}};String.prototype.codePointAt||function(){var e=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(e){}return n}(),t=function(e){if(null==this)throw TypeError();var t=String(this),n=t.length,r=e?Number(e):0;if(r!=r&&(r=0),!(r<0||r>=n)){var i,a=t.charCodeAt(r);return a>=55296&&a<=56319&&n>r+1&&((i=t.charCodeAt(r+1))>=56320&&i<=57343)?1024*(a-55296)+i-56320+65536:a}};e?e(String.prototype,"codePointAt",{value:t,configurable:!0,writable:!0}):String.prototype.codePointAt=t}();var QF=0,xhe=-3;function dx(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Not(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new dx,this.dtree=new dx}var bhe=new dx,Ehe=new dx,eN=new Uint8Array(30),tN=new Uint16Array(30),_he=new Uint8Array(30),The=new Uint16Array(30),Bot=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lue=new dx,uc=new Uint8Array(320);function She(e,t,n,r){var i,a;for(i=0;i<n;++i)e[i]=0;for(i=0;i<30-n;++i)e[i+n]=i/n|0;for(a=r,i=0;i<30;++i)t[i]=a,a+=1<<e[i]}function Uot(e,t){var n;for(n=0;n<7;++n)e.table[n]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,n=0;n<24;++n)e.trans[n]=256+n;for(n=0;n<144;++n)e.trans[24+n]=n;for(n=0;n<8;++n)e.trans[168+n]=280+n;for(n=0;n<112;++n)e.trans[176+n]=144+n;for(n=0;n<5;++n)t.table[n]=0;for(t.table[5]=32,n=0;n<32;++n)t.trans[n]=n}var kue=new Uint16Array(16);function kF(e,t,n,r){var i,a;for(i=0;i<16;++i)e.table[i]=0;for(i=0;i<r;++i)e.table[t[n+i]]++;for(e.table[0]=0,a=0,i=0;i<16;++i)kue[i]=a,a+=e.table[i];for(i=0;i<r;++i)t[n+i]&&(e.trans[kue[t[n+i]]++]=i)}function Hot(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function hc(e,t,n){if(!t)return n;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,r+n}function GF(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=0,r=0,i=0,a=e.tag;do{r=2*r+(1&a),a>>>=1,++i,n+=t.table[i],r-=t.table[i]}while(r>=0);return e.tag=a,e.bitcount-=i,t.trans[n+r]}function Vot(e,t,n){var r,i,a,s,o,l;for(r=hc(e,5,257),i=hc(e,5,1),a=hc(e,4,4),s=0;s<19;++s)uc[s]=0;for(s=0;s<a;++s){var h=hc(e,3,0);uc[Bot[s]]=h}for(kF(Lue,uc,0,19),o=0;o<r+i;){var u=GF(e,Lue);switch(u){case 16:var c=uc[o-1];for(l=hc(e,2,3);l;--l)uc[o++]=c;break;case 17:for(l=hc(e,3,3);l;--l)uc[o++]=0;break;case 18:for(l=hc(e,7,11);l;--l)uc[o++]=0;break;default:uc[o++]=u}}kF(t,uc,0,r),kF(n,uc,r,i)}function Fue(e,t,n){for(;;){var r,i,a,s,o=GF(e,t);if(256===o)return QF;if(o<256)e.dest[e.destLen++]=o;else for(r=hc(e,eN[o-=257],tN[o]),i=GF(e,n),s=a=e.destLen-hc(e,_he[i],The[i]);s<a+r;++s)e.dest[e.destLen++]=e.dest[s]}}function zot(e){for(var t,n;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return xhe;for(e.sourceIndex+=4,n=t;n;--n)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,QF}function qot(e,t){var n,r,i=new Not(e,t);do{switch(n=Hot(i),hc(i,2,0)){case 0:r=zot(i);break;case 1:r=Fue(i,bhe,Ehe);break;case 2:Vot(i,i.ltree,i.dtree),r=Fue(i,i.ltree,i.dtree);break;default:r=xhe}if(r!==QF)throw new Error("Data error")}while(!n);return i.destLen<i.dest.length?"function"==typeof i.dest.slice?i.dest.slice(0,i.destLen):i.dest.subarray(0,i.destLen):i.dest}Uot(bhe,Ehe),She(eN,tN,4,3),She(_he,The,2,1),eN[28]=0,tN[28]=258;var Got=qot;function e0(e,t,n,r,i){return Math.pow(1-i,3)*e+3*Math.pow(1-i,2)*i*t+3*(1-i)*Math.pow(i,2)*n+Math.pow(i,3)*r}function Fh(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function Xi(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function whe(e){throw new Error(e)}function Nue(e,t){e||whe(t)}Fh.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Fh.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},Fh.prototype.addX=function(e){this.addPoint(e,null)},Fh.prototype.addY=function(e){this.addPoint(null,e)},Fh.prototype.addBezier=function(e,t,n,r,i,a,s,o){var l=[e,t],h=[n,r],u=[i,a],c=[s,o];this.addPoint(e,t),this.addPoint(s,o);for(var d=0;d<=1;d++){var p=6*l[d]-12*h[d]+6*u[d],f=-3*l[d]+9*h[d]-9*u[d]+3*c[d],m=3*h[d]-3*l[d];if(0!==f){var g=Math.pow(p,2)-4*m*f;if(!(g<0)){var v=(-p+Math.sqrt(g))/(2*f);0<v&&v<1&&(0===d&&this.addX(e0(l[d],h[d],u[d],c[d],v)),1===d&&this.addY(e0(l[d],h[d],u[d],c[d],v)));var y=(-p-Math.sqrt(g))/(2*f);0<y&&y<1&&(0===d&&this.addX(e0(l[d],h[d],u[d],c[d],y)),1===d&&this.addY(e0(l[d],h[d],u[d],c[d],y)))}}else{if(0===p)continue;var x=-m/p;0<x&&x<1&&(0===d&&this.addX(e0(l[d],h[d],u[d],c[d],x)),1===d&&this.addY(e0(l[d],h[d],u[d],c[d],x)))}}},Fh.prototype.addQuad=function(e,t,n,r,i,a){var s=e+.6666666666666666*(n-e),o=t+2/3*(r-t),l=s+1/3*(i-e),h=o+1/3*(a-t);this.addBezier(e,t,s,o,l,h,i,a)},Xi.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},Xi.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},Xi.prototype.curveTo=Xi.prototype.bezierCurveTo=function(e,t,n,r,i,a){this.commands.push({type:"C",x1:e,y1:t,x2:n,y2:r,x:i,y:a})},Xi.prototype.quadTo=Xi.prototype.quadraticCurveTo=function(e,t,n,r){this.commands.push({type:"Q",x1:e,y1:t,x:n,y:r})},Xi.prototype.close=Xi.prototype.closePath=function(){this.commands.push({type:"Z"})},Xi.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof Fh){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},Xi.prototype.getBoundingBox=function(){for(var e=new Fh,t=0,n=0,r=0,i=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":e.addPoint(s.x,s.y),t=r=s.x,n=i=s.y;break;case"L":e.addPoint(s.x,s.y),r=s.x,i=s.y;break;case"Q":e.addQuad(r,i,s.x1,s.y1,s.x,s.y),r=s.x,i=s.y;break;case"C":e.addBezier(r,i,s.x1,s.y1,s.x2,s.y2,s.x,s.y),r=s.x,i=s.y;break;case"Z":r=t,i=n;break;default:throw new Error("Unexpected path command "+s.type)}}return e.isEmpty()&&e.addPoint(0,0),e},Xi.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var n=this.commands[t];"M"===n.type?e.moveTo(n.x,n.y):"L"===n.type?e.lineTo(n.x,n.y):"C"===n.type?e.bezierCurveTo(n.x1,n.y1,n.x2,n.y2,n.x,n.y):"Q"===n.type?e.quadraticCurveTo(n.x1,n.y1,n.x,n.y):"Z"===n.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},Xi.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function n(){for(var e=arguments,n="",r=0;r<arguments.length;r+=1){var i=e[r];i>=0&&r>0&&(n+=" "),n+=t(i)}return n}e=void 0!==e?e:2;for(var r="",i=0;i<this.commands.length;i+=1){var a=this.commands[i];"M"===a.type?r+="M"+n(a.x,a.y):"L"===a.type?r+="L"+n(a.x,a.y):"C"===a.type?r+="C"+n(a.x1,a.y1,a.x2,a.y2,a.x,a.y):"Q"===a.type?r+="Q"+n(a.x1,a.y1,a.x,a.y):"Z"===a.type&&(r+="Z")}return r},Xi.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},Xi.prototype.toDOMElement=function(e){var t=this.toPathData(e),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n};var Mn={fail:whe,argument:Nue,assert:Nue},Bue=32768,Uue=2147483648,n0={},jt={},Rn={};function _l(e){return function(){return e}}jt.BYTE=function(e){return Mn.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},Rn.BYTE=_l(1),jt.CHAR=function(e){return[e.charCodeAt(0)]},Rn.CHAR=_l(1),jt.CHARARRAY=function(e){void 0===e&&(e="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var t=[],n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t},Rn.CHARARRAY=function(e){return void 0===e?0:e.length},jt.USHORT=function(e){return[e>>8&255,255&e]},Rn.USHORT=_l(2),jt.SHORT=function(e){return e>=Bue&&(e=-(2*Bue-e)),[e>>8&255,255&e]},Rn.SHORT=_l(2),jt.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},Rn.UINT24=_l(3),jt.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},Rn.ULONG=_l(4),jt.LONG=function(e){return e>=Uue&&(e=-(2*Uue-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},Rn.LONG=_l(4),jt.FIXED=jt.ULONG,Rn.FIXED=Rn.ULONG,jt.FWORD=jt.SHORT,Rn.FWORD=Rn.SHORT,jt.UFWORD=jt.USHORT,Rn.UFWORD=Rn.USHORT,jt.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},Rn.LONGDATETIME=_l(8),jt.TAG=function(e){return Mn.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},Rn.TAG=_l(4),jt.Card8=jt.BYTE,Rn.Card8=Rn.BYTE,jt.Card16=jt.USHORT,Rn.Card16=Rn.USHORT,jt.OffSize=jt.BYTE,Rn.OffSize=Rn.BYTE,jt.SID=jt.USHORT,Rn.SID=Rn.USHORT,jt.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?jt.NUMBER16(e):jt.NUMBER32(e)},Rn.NUMBER=function(e){return jt.NUMBER(e).length},jt.NUMBER16=function(e){return[28,e>>8&255,255&e]},Rn.NUMBER16=_l(3),jt.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},Rn.NUMBER32=_l(5),jt.REAL=function(e){var t=e.toString(),n=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(n){var r=parseFloat("1e"+((n[2]?+n[2]:0)+n[1].length));t=(Math.round(e*r)/r).toString()}for(var i="",a=0,s=t.length;a<s;a+=1){var o=t[a];i+="e"===o?"-"===t[++a]?"c":"b":"."===o?"a":"-"===o?"e":o}for(var l=[30],h=0,u=(i+=1&i.length?"f":"ff").length;h<u;h+=2)l.push(parseInt(i.substr(h,2),16));return l},Rn.REAL=function(e){return jt.REAL(e).length},jt.NAME=jt.CHARARRAY,Rn.NAME=Rn.CHARARRAY,jt.STRING=jt.CHARARRAY,Rn.STRING=Rn.CHARARRAY,n0.UTF8=function(e,t,n){for(var r=[],i=n,a=0;a<i;a++,t+=1)r[a]=e.getUint8(t);return String.fromCharCode.apply(null,r)},n0.UTF16=function(e,t,n){for(var r=[],i=n/2,a=0;a<i;a++,t+=2)r[a]=e.getUint16(t);return String.fromCharCode.apply(null,r)},jt.UTF16=function(e){for(var t=[],n=0;n<e.length;n+=1){var r=e.charCodeAt(n);t[t.length]=r>>8&255,t[t.length]=255&r}return t},Rn.UTF16=function(e){return 2*e.length};var WF={"x-mac-croatian":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Å â¢Â´Â¨â Å½ÃâÂ±â¤â¥âÂµâââÅ¡â«ÂªÂºÎ©Å¾Ã¸Â¿Â¡Â¬âÆâÄÂ«Äâ¦Â ÃÃÃÅÅÄâââââÃ·âï£¿Â©ââ¬â¹âºÃÂ»âÂ·âââ°ÃÄÃÄÃÃÃÃÃÃÃÄÃÃÃÃÄ±ËËÂ¯ÏÃËÂ¸ÃÃ¦Ë","x-mac-cyrillic":"ÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐÐ Ð¡Ð¢Ð£Ð¤Ð¥Ð¦Ð§Ð¨Ð©ÐªÐ«Ð¬Ð­Ð®Ð¯â Â°ÒÂ£Â§â¢Â¶ÐÂ®Â©â¢ÐÑâ ÐÑâÂ±â¤â¥ÑÂµÒÐÐÑÐÑÐÑÐÑÑÐÂ¬âÆââÂ«Â»â¦Â ÐÑÐÑÑââââââÃ·âÐÑÐÑâÐÑÑÐ°Ð±Ð²Ð³Ð´ÐµÐ¶Ð·Ð¸Ð¹ÐºÐ»Ð¼Ð½Ð¾Ð¿ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ","x-mac-gaelic":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃá¸Â±â¤â¥á¸ÄÄá¸á¸á¸á¸Ä Ä¡á¹Ã¦Ã¸á¹á¹á¹É¼ÆÅ¿á¹ Â«Â»â¦Â ÃÃÃÅÅââââââá¹¡áºÃ¿Å¸á¹ªâ¬â¹âºÅ¶Å·á¹«Â·á»²á»³âÃÃÃÃÃÃÃÃÃÃÃâ£ÃÃÃÃÄ±ÃÃ½Å´Åµáºáºáºáºáºáº","x-mac-greek":"ÃÂ¹Â²ÃÂ³ÃÃÎÃ Ã¢Ã¤ÎÂ¨Ã§Ã©Ã¨ÃªÃ«Â£â¢Ã®Ã¯â¢Â½â°Ã´Ã¶Â¦â¬Ã¹Ã»Ã¼â ÎÎÎÎÎÎ ÃÂ®Â©Î£ÎªÂ§â Â°Â·ÎÂ±â¤â¥Â¥ÎÎÎÎÎÎÎÎ¦Î«Î¨Î©Î¬ÎÂ¬ÎÎ¡âÎ¤Â«Â»â¦Â Î¥Î§ÎÎÅââââââÃ·ÎÎÎÎÎ­Î®Î¯ÏÎÏÎ±Î²ÏÎ´ÎµÏÎ³Î·Î¹Î¾ÎºÎ»Î¼Î½Î¿ÏÏÏÏÏÎ¸ÏÏÏÏÎ¶ÏÏÎÎ°Â­","x-mac-icelandic":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼ÃÂ°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬ÃÃ°ÃÃ¾Ã½Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-inuit":"ááááááá±á²á³á´á¸á¹áááááááá¦á­á®á¯á°á²á³áááááááÂ°á¡á¥á¦â¢Â¶á§Â®Â©â¢á¨áªá«á»áááááááá¯á°á±á²á´áµááááááááªá¨á©áªá«á­â¦Â á®á¾áááââââââáááááááááááá¿áááááááááááááá±á²á³á´áµá¶áá á¡á¢á£á¤á¥á¦á¼ÅÅ","x-mac-ce":"ÃÄÄÃÄÃÃÃ¡ÄÄÃ¤ÄÄÄÃ©Å¹ÅºÄÃ­ÄÄÄÄÃ³ÄÃ´Ã¶ÃµÃºÄÄÃ¼â Â°ÄÂ£Â§â¢Â¶ÃÂ®Â©â¢ÄÂ¨â Ä£Ä®Ä¯Äªâ¤â¥Ä«Ä¶ââÅÄ»Ä¼Ä½Ä¾Ä¹ÄºÅÅÅÂ¬âÅÅâÂ«Â»â¦Â ÅÅÃÅÅââââââÃ·âÅÅÅÅâ¹âºÅÅÅÅ ââÅ¡ÅÅÃÅ¤Å¥ÃÅ½Å¾ÅªÃÃÅ«Å®ÃÅ¯Å°Å±Å²Å³ÃÃ½Ä·Å»ÅÅ¼Ä¢Ë",macintosh:"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬â¹âºï¬ï¬â¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-romanian":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÄÈâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©ÄÈÂ¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ââ¬â¹âºÈÈâ¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃÄ±ËËÂ¯ËËËÂ¸ËËË","x-mac-turkish":"ÃÃÃÃÃÃÃÃ¡Ã Ã¢Ã¤Ã£Ã¥Ã§Ã©Ã¨ÃªÃ«Ã­Ã¬Ã®Ã¯Ã±Ã³Ã²Ã´Ã¶ÃµÃºÃ¹Ã»Ã¼â Â°Â¢Â£Â§â¢Â¶ÃÂ®Â©â¢Â´Â¨â ÃÃâÂ±â¤â¥Â¥ÂµâââÏâ«ÂªÂºÎ©Ã¦Ã¸Â¿Â¡Â¬âÆââÂ«Â»â¦Â ÃÃÃÅÅââââââÃ·âÃ¿Å¸ÄÄÄ°Ä±ÅÅâ¡Â·âââ°ÃÃÃÃÃÃÃÃÃÃÃï£¿ÃÃÃÃï¢ ËËÂ¯ËËËÂ¸ËËË"};n0.MACSTRING=function(e,t,n,r){var i=WF[r];if(void 0!==i){for(var a="",s=0;s<n;s++){var o=e.getUint8(t+s);a+=o<=127?String.fromCharCode(o):i[127&o]}return a}};var LA="function"==typeof WeakMap&&new WeakMap,kA,Wot=function(e){if(!kA)for(var t in kA={},WF)kA[t]=new String(t);var n=kA[e];if(void 0!==n){if(LA){var r=LA.get(n);if(void 0!==r)return r}var i=WF[e];if(void 0!==i){for(var a={},s=0;s<i.length;s++)a[i.charCodeAt(s)]=s+128;return LA&&LA.set(n,a),a}}};function jF(e){return e>=-128&&e<=127}function jot(e,t,n){for(var r=0,i=e.length;t<i&&r<64&&0===e[t];)++t,++r;return n.push(128|r-1),t}function Xot(e,t,n){for(var r=0,i=e.length,a=t;a<i&&r<64;){var s=e[a];if(!jF(s)||0===s&&a+1<i&&0===e[a+1])break;++a,++r}n.push(r-1);for(var o=t;o<a;++o)n.push(e[o]+256&255);return a}function Yot(e,t,n){for(var r=0,i=e.length,a=t;a<i&&r<64;){var s=e[a];if(0===s||jF(s)&&a+1<i&&jF(e[a+1]))break;++a,++r}n.push(64|r-1);for(var o=t;o<a;++o){var l=e[o];n.push(l+65536>>8&255,l+256&255)}return a}jt.MACSTRING=function(e,t){var n=Wot(t);if(void 0!==n){for(var r=[],i=0;i<e.length;i++){var a=e.charCodeAt(i);if(a>=128&&void 0===(a=n[a]))return;r[i]=a}return r}},Rn.MACSTRING=function(e,t){var n=jt.MACSTRING(e,t);return void 0!==n?n.length:0},jt.VARDELTAS=function(e){for(var t=0,n=[];t<e.length;){var r=e[t];t=0===r?jot(e,t,n):r>=-128&&r<=127?Xot(e,t,n):Yot(e,t,n)}return n},jt.INDEX=function(e){for(var t=1,n=[t],r=[],i=0;i<e.length;i+=1){var a=jt.OBJECT(e[i]);Array.prototype.push.apply(r,a),t+=a.length,n.push(t)}if(0===r.length)return[0,0];for(var s=[],o=1+Math.floor(Math.log(t)/Math.log(2))/8|0,l=[void 0,jt.BYTE,jt.USHORT,jt.UINT24,jt.ULONG][o],h=0;h<n.length;h+=1){var u=l(n[h]);Array.prototype.push.apply(s,u)}return Array.prototype.concat(jt.Card16(e.length),jt.OffSize(o),s,r)},Rn.INDEX=function(e){return jt.INDEX(e).length},jt.DICT=function(e){for(var t=[],n=Object.keys(e),r=n.length,i=0;i<r;i+=1){var a=parseInt(n[i],0),s=e[a];t=(t=t.concat(jt.OPERAND(s.value,s.type))).concat(jt.OPERATOR(a))}return t},Rn.DICT=function(e){return jt.DICT(e).length},jt.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},jt.OPERAND=function(e,t){var n=[];if(Array.isArray(t))for(var r=0;r<t.length;r+=1)Mn.argument(e.length===t.length,"Not enough arguments given for type"+t),n=n.concat(jt.OPERAND(e[r],t[r]));else if("SID"===t)n=n.concat(jt.NUMBER(e));else if("offset"===t)n=n.concat(jt.NUMBER32(e));else if("number"===t)n=n.concat(jt.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);n=n.concat(jt.REAL(e))}return n},jt.OP=jt.BYTE,Rn.OP=Rn.BYTE;var FA="function"==typeof WeakMap&&new WeakMap;function ls(e,t,n){if(t.length&&("coverageFormat"!==t[0].name||1===t[0].value))for(var r=0;r<t.length;r+=1){var i=t[r];this[i.name]=i.value}if(this.tableName=e,this.fields=t,n)for(var a=Object.keys(n),s=0;s<a.length;s+=1){var o=a[s],l=n[o];void 0!==this[o]&&(this[o]=l)}}function px(e,t,n){void 0===n&&(n=t.length);var r=new Array(t.length+1);r[0]={name:e+"Count",type:"USHORT",value:n};for(var i=0;i<t.length;i++)r[i+1]={name:e+i,type:"USHORT",value:t[i]};return r}function XF(e,t,n){var r=t.length,i=new Array(r+1);i[0]={name:e+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)i[a+1]={name:e+a,type:"TABLE",value:n(t[a],a)};return i}function mx(e,t,n){var r=t.length,i=[];i[0]={name:e+"Count",type:"USHORT",value:r};for(var a=0;a<r;a++)i=i.concat(n(t[a],a));return i}function VA(e){1===e.format?ls.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(px("glyph",e.glyphs))):2===e.format?ls.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(mx("rangeRecord",e.ranges,(function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]})))):Mn.assert(!1,"Coverage format must be 1 or 2.")}function zA(e){ls.call(this,"scriptListTable",mx("scriptRecord",e,(function(e,t){var n=e.script,r=n.defaultLangSys;return Mn.assert(!!r,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new ls("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new ls("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(px("featureIndex",r.featureIndexes)))}].concat(mx("langSys",n.langSysRecords,(function(e,t){var n=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new ls("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(px("featureIndex",n.featureIndexes)))}]}))))}]})))}function qA(e){ls.call(this,"featureListTable",mx("featureRecord",e,(function(e,t){var n=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new ls("featureTable",[{name:"featureParams",type:"USHORT",value:n.featureParams}].concat(px("lookupListIndex",n.lookupListIndexes)))}]})))}function GA(e,t){ls.call(this,"lookupListTable",XF("lookup",e,(function(e){var n=t[e.lookupType];return Mn.assert(!!n,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new ls("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(XF("subtable",e.subtables,n)))})))}jt.CHARSTRING=function(e){if(FA){var t=FA.get(e);if(void 0!==t)return t}for(var n=[],r=e.length,i=0;i<r;i+=1){var a=e[i];n=n.concat(jt[a.type](a.value))}return FA&&FA.set(e,n),n},Rn.CHARSTRING=function(e){return jt.CHARSTRING(e).length},jt.OBJECT=function(e){var t=jt[e.type];return Mn.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},Rn.OBJECT=function(e){var t=Rn[e.type];return Mn.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},jt.TABLE=function(e){for(var t=[],n=e.fields.length,r=[],i=[],a=0;a<n;a+=1){var s=e.fields[a],o=jt[s.type];Mn.argument(void 0!==o,"No encoding function for field type "+s.type+" ("+s.name+")");var l=e[s.name];void 0===l&&(l=s.value);var h=o(l);"TABLE"===s.type?(i.push(t.length),t=t.concat([0,0]),r.push(h)):t=t.concat(h)}for(var u=0;u<r.length;u+=1){var c=i[u],d=t.length;Mn.argument(d<65536,"Table "+e.tableName+" too big."),t[c]=d>>8,t[c+1]=255&d,t=t.concat(r[u])}return t},Rn.TABLE=function(e){for(var t=0,n=e.fields.length,r=0;r<n;r+=1){var i=e.fields[r],a=Rn[i.type];Mn.argument(void 0!==a,"No sizeOf function for field type "+i.type+" ("+i.name+")");var s=e[i.name];void 0===s&&(s=i.value),t+=a(s),"TABLE"===i.type&&(t+=2)}return t},jt.RECORD=jt.TABLE,Rn.RECORD=Rn.TABLE,jt.LITERAL=function(e){return e},Rn.LITERAL=function(e){return e.length},ls.prototype.encode=function(){return jt.TABLE(this)},ls.prototype.sizeOf=function(){return Rn.TABLE(this)},VA.prototype=Object.create(ls.prototype),VA.prototype.constructor=VA,zA.prototype=Object.create(ls.prototype),zA.prototype.constructor=zA,qA.prototype=Object.create(ls.prototype),qA.prototype.constructor=qA,GA.prototype=Object.create(ls.prototype),GA.prototype.constructor=GA;var Qt={Table:ls,Record:ls,Coverage:VA,ScriptList:zA,FeatureList:qA,LookupList:GA,ushortList:px,tableList:XF,recordList:mx};function Hue(e,t){return e.getUint8(t)}function WA(e,t){return e.getUint16(t,!1)}function $ot(e,t){return e.getInt16(t,!1)}function nN(e,t){return e.getUint32(t,!1)}function Mhe(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}function Zot(e,t){for(var n="",r=t;r<t+4;r+=1)n+=String.fromCharCode(e.getInt8(r));return n}function Kot(e,t,n){for(var r=0,i=0;i<n;i+=1)r<<=8,r+=e.getUint8(t+i);return r}function Jot(e,t,n){for(var r=[],i=t;i<n;i+=1)r.push(e.getUint8(i));return r}function Qot(e){for(var t="",n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return t}var elt={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function pt(e,t){this.data=e,this.offset=t,this.relativeOffset=0}pt.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},pt.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},pt.prototype.parseCard8=pt.prototype.parseByte,pt.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},pt.prototype.parseCard16=pt.prototype.parseUShort,pt.prototype.parseSID=pt.prototype.parseUShort,pt.prototype.parseOffset16=pt.prototype.parseUShort,pt.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},pt.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},pt.prototype.parseULong=function(){var e=nN(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},pt.prototype.parseOffset32=pt.prototype.parseULong,pt.prototype.parseFixed=function(){var e=Mhe(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},pt.prototype.parseString=function(e){var t=this.data,n=this.offset+this.relativeOffset,r="";this.relativeOffset+=e;for(var i=0;i<e;i++)r+=String.fromCharCode(t.getUint8(n+i));return r},pt.prototype.parseTag=function(){return this.parseString(4)},pt.prototype.parseLongDateTime=function(){var e=nN(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},pt.prototype.parseVersion=function(e){var t=WA(this.data,this.offset+this.relativeOffset),n=WA(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+n/e/10},pt.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=elt[e]*t},pt.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint32(r),r+=4;return this.relativeOffset+=4*e,t},pt.prototype.parseOffset16List=pt.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint16(r),r+=2;return this.relativeOffset+=2*e,t},pt.prototype.parseShortList=function(e){for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getInt16(r),r+=2;return this.relativeOffset+=2*e,t},pt.prototype.parseByteList=function(e){for(var t=new Array(e),n=this.data,r=this.offset+this.relativeOffset,i=0;i<e;i++)t[i]=n.getUint8(r++);return this.relativeOffset+=e,t},pt.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),r=0;r<e;r++)n[r]=t.call(this);return n},pt.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),r=0;r<e;r++)n[r]=t.call(this);return n},pt.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var n=new Array(e),r=Object.keys(t),i=0;i<e;i++){for(var a={},s=0;s<r.length;s++){var o=r[s],l=t[o];a[o]=l.call(this)}n[i]=a}return n},pt.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var n=new Array(e),r=Object.keys(t),i=0;i<e;i++){for(var a={},s=0;s<r.length;s++){var o=r[s],l=t[o];a[o]=l.call(this)}n[i]=a}return n},pt.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),n={},r=0;r<t.length;r++){var i=t[r],a=e[i];n[i]=a.call(this)}return n},pt.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},pt.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),n=new Array(t),r=0;r<t;r++)n[r]=this.parseValueRecord(e);return n},pt.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new pt(this.data,this.offset+t).parseStruct(e)},pt.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new pt(this.data,this.offset+t).parseStruct(e)},pt.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),n=t.length,r=this.relativeOffset,i=new Array(n),a=0;a<n;a++){var s=t[a];if(0!==s)if(this.relativeOffset=s,e){for(var o=this.parseOffset16List(),l=new Array(o.length),h=0;h<o.length;h++)this.relativeOffset=s+o[h],l[h]=e.call(this);i[a]=l}else i[a]=this.parseUShortList();else i[a]=void 0}return this.relativeOffset=r,i},pt.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),n=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(n)};if(2===t){for(var r=new Array(n),i=0;i<n;i++)r[i]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:r}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},pt.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:pt.uShort,end:pt.uShort,classId:pt.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},pt.list=function(e,t){return function(){return this.parseList(e,t)}},pt.list32=function(e,t){return function(){return this.parseList32(e,t)}},pt.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},pt.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},pt.pointer=function(e){return function(){return this.parsePointer(e)}},pt.pointer32=function(e){return function(){return this.parsePointer32(e)}},pt.tag=pt.prototype.parseTag,pt.byte=pt.prototype.parseByte,pt.uShort=pt.offset16=pt.prototype.parseUShort,pt.uShortList=pt.prototype.parseUShortList,pt.uLong=pt.offset32=pt.prototype.parseULong,pt.uLongList=pt.prototype.parseULongList,pt.struct=pt.prototype.parseStruct,pt.coverage=pt.prototype.parseCoverage,pt.classDef=pt.prototype.parseClassDef;var Vue={reserved:pt.uShort,reqFeatureIndex:pt.uShort,featureIndexes:pt.uShortList};pt.prototype.parseScriptList=function(){return this.parsePointer(pt.recordList({tag:pt.tag,script:pt.pointer({defaultLangSys:pt.pointer(Vue),langSysRecords:pt.recordList({tag:pt.tag,langSys:pt.pointer(Vue)})})}))||[]},pt.prototype.parseFeatureList=function(){return this.parsePointer(pt.recordList({tag:pt.tag,feature:pt.pointer({featureParams:pt.offset16,lookupListIndexes:pt.uShortList})}))||[]},pt.prototype.parseLookupList=function(e){return this.parsePointer(pt.list(pt.pointer((function(){var t=this.parseUShort();Mn.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var n=this.parseUShort(),r=16&n;return{lookupType:t,lookupFlag:n,subtables:this.parseList(pt.pointer(e[t])),markFilteringSet:r?this.parseUShort():void 0}}))))||[]},pt.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return Mn.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:pt.offset32,featureTableSubstitutionOffset:pt.offset32})}))||[]};var an={getByte:Hue,getCard8:Hue,getUShort:WA,getCard16:WA,getShort:$ot,getULong:nN,getFixed:Mhe,getTag:Zot,getOffset:Kot,getBytes:Jot,bytesToString:Qot,Parser:pt};function tlt(e,t){var n;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=n=t.parseULong(),e.glyphIndexMap={};for(var r=0;r<n;r+=1)for(var i=t.parseULong(),a=t.parseULong(),s=t.parseULong(),o=i;o<=a;o+=1)e.glyphIndexMap[o]=s,s++}function nlt(e,t,n,r,i){var a;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=a=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var s=new an.Parser(n,r+i+14),o=new an.Parser(n,r+i+16+2*a),l=new an.Parser(n,r+i+16+4*a),h=new an.Parser(n,r+i+16+6*a),u=r+i+16+8*a,c=0;c<a-1;c+=1)for(var d=void 0,p=s.parseUShort(),f=o.parseUShort(),m=l.parseShort(),g=h.parseUShort(),v=f;v<=p;v+=1)0!==g?(u=h.offset+h.relativeOffset-2,u+=g,u+=2*(v-f),0!==(d=an.getUShort(n,u))&&(d=d+m&65535)):d=v+m&65535,e.glyphIndexMap[v]=d}function rlt(e,t){var n={};n.version=an.getUShort(e,t),Mn.argument(0===n.version,"cmap table version should be 0."),n.numTables=an.getUShort(e,t+2);for(var r=-1,i=n.numTables-1;i>=0;i-=1){var a=an.getUShort(e,t+4+8*i),s=an.getUShort(e,t+4+8*i+2);if(3===a&&(0===s||1===s||10===s)||0===a&&(0===s||1===s||2===s||3===s||4===s)){r=an.getULong(e,t+4+8*i+4);break}}if(-1===r)throw new Error("No valid cmap sub-tables found.");var o=new an.Parser(e,t+r);if(n.format=o.parseUShort(),12===n.format)tlt(n,o);else{if(4!==n.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+n.format+").");nlt(n,o,e,t,r)}return n}function ilt(e,t,n){e.segments.push({end:t,start:t,delta:-(t-n),offset:0,glyphIndex:n})}function slt(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function alt(e){var t,n=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),n=!1;break}}var r=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:n?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:n?12:20}];n||(r=r.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),r=r.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var i=new Qt.Table("cmap",r);for(i.segments=[],t=0;t<e.length;t+=1){for(var a=e.get(t),s=0;s<a.unicodes.length;s+=1)ilt(i,a.unicodes[s],t);i.segments=i.segments.sort((function(e,t){return e.start-t.start}))}slt(i);var o=i.segments.length,l=0,h=[],u=[],c=[],d=[],p=[],f=[];for(t=0;t<o;t+=1){var m=i.segments[t];m.end<=65535&&m.start<=65535?(h=h.concat({name:"end_"+t,type:"USHORT",value:m.end}),u=u.concat({name:"start_"+t,type:"USHORT",value:m.start}),c=c.concat({name:"idDelta_"+t,type:"SHORT",value:m.delta}),d=d.concat({name:"idRangeOffset_"+t,type:"USHORT",value:m.offset}),void 0!==m.glyphId&&(p=p.concat({name:"glyph_"+t,type:"USHORT",value:m.glyphId}))):l+=1,!n&&void 0!==m.glyphIndex&&(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:m.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:m.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:m.glyphIndex}))}if(i.segCountX2=2*(o-l),i.searchRange=2*Math.pow(2,Math.floor(Math.log(o-l)/Math.log(2))),i.entrySelector=Math.log(i.searchRange/2)/Math.log(2),i.rangeShift=i.segCountX2-i.searchRange,i.fields=i.fields.concat(h),i.fields.push({name:"reservedPad",type:"USHORT",value:0}),i.fields=i.fields.concat(u),i.fields=i.fields.concat(c),i.fields=i.fields.concat(d),i.fields=i.fields.concat(p),i.cmap4Length=14+2*h.length+2+2*u.length+2*c.length+2*d.length+2*p.length,!n){var g=16+4*f.length;i.cmap12Offset=20+i.cmap4Length,i.fields=i.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:g},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),i.fields=i.fields.concat(f)}return i}var Ahe={parse:rlt,make:alt},UA=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],olt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],llt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],qd=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function Che(e){this.font=e}function Rhe(e){this.cmap=e}function jA(e,t){this.encoding=e,this.charset=t}function rN(e){switch(e.version){case 1:this.names=qd.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<qd.length?this.names[t]=qd[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-qd.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var n=0;n<e.numberOfGlyphs;n++)this.names[n]=qd[n+e.glyphNameIndex[n]];break;default:this.names=[]}}function clt(e){for(var t,n=e.tables.cmap.glyphIndexMap,r=Object.keys(n),i=0;i<r.length;i+=1){var a=r[i],s=n[a];(t=e.glyphs.get(s)).addUnicode(parseInt(a))}for(var o=0;o<e.glyphs.length;o+=1)t=e.glyphs.get(o),e.cffEncoding?e.isCIDFont?t.name="gid"+o:t.name=e.cffEncoding.charset[o]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(o))}function ult(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,n=Object.keys(t),r=0;r<n.length;r+=1){var i=n[r],a=t[i];void 0===e._IndexToUnicodeMap[a]?e._IndexToUnicodeMap[a]={unicodes:[parseInt(i)]}:e._IndexToUnicodeMap[a].unicodes.push(parseInt(i))}}function hlt(e,t){t.lowMemory?ult(e):clt(e)}function flt(e,t,n,r,i){e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.stroke()}Che.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.font.glyphs;if(n)for(var r=0;r<n.length;r+=1)for(var i=n.get(r),a=0;a<i.unicodes.length;a+=1)if(i.unicodes[a]===t)return r;return null},Rhe.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},jA.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),n=this.encoding[t];return this.charset.indexOf(n)},rN.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},rN.prototype.glyphIndexToName=function(e){return this.names[e]};var zd={line:flt};function dlt(e,t){var n=t||new Xi;return{configurable:!0,get:function(){return"function"==typeof n&&(n=n()),n},set:function(e){n=e}}}function ko(e){this.bindConstructorValues(e)}function NA(e,t,n){Object.defineProperty(e,t,{get:function(){return e.path,e[n]},set:function(t){e[n]=t},enumerable:!0,configurable:!0})}function iN(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];r.path.unitsPerEm=e.unitsPerEm,this.glyphs[n]=r}this.length=t&&t.length||0}function plt(e,t){return new ko({index:t,font:e})}function mlt(e,t,n,r,i,a){return function(){var s=new ko({index:t,font:e});return s.path=function(){n(s,r,i);var t=a(e.glyphs,s);return t.unitsPerEm=e.unitsPerEm,t},NA(s,"xMin","_xMin"),NA(s,"xMax","_xMax"),NA(s,"yMin","_yMin"),NA(s,"yMax","_yMax"),s}}function glt(e,t,n,r){return function(){var i=new ko({index:t,font:e});return i.path=function(){var t=n(e,i,r);return t.unitsPerEm=e.unitsPerEm,t},i}}ko.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",dlt(this,e.path))},ko.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},ko.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},ko.prototype.getPath=function(e,t,n,r,i){var a,s;e=void 0!==e?e:0,t=void 0!==t?t:0,n=void 0!==n?n:72,r||(r={});var o=r.xScale,l=r.yScale;if(r.hinting&&i&&i.hinting&&(s=this.path&&i.hinting.exec(this,n)),s)a=i.hinting.getCommands(s),e=Math.round(e),t=Math.round(t),o=l=1;else{a=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*n;void 0===o&&(o=h),void 0===l&&(l=h)}for(var u=new Xi,c=0;c<a.length;c+=1){var d=a[c];"M"===d.type?u.moveTo(e+d.x*o,t+-d.y*l):"L"===d.type?u.lineTo(e+d.x*o,t+-d.y*l):"Q"===d.type?u.quadraticCurveTo(e+d.x1*o,t+-d.y1*l,e+d.x*o,t+-d.y*l):"C"===d.type?u.curveTo(e+d.x1*o,t+-d.y1*l,e+d.x2*o,t+-d.y2*l,e+d.x*o,t+-d.y*l):"Z"===d.type&&u.closePath()}return u},ko.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],n=0;n<this.points.length;n+=1){var r=this.points[n];t.push(r),r.lastPointOfContour&&(e.push(t),t=[])}return Mn.argument(0===t.length,"There are still points left in the current contour."),e},ko.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],n=[],r=0;r<e.length;r+=1){var i=e[r];"Z"!==i.type&&(t.push(i.x),n.push(i.y)),("Q"===i.type||"C"===i.type)&&(t.push(i.x1),n.push(i.y1)),"C"===i.type&&(t.push(i.x2),n.push(i.y2))}var a={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,n),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a},ko.prototype.draw=function(e,t,n,r,i){this.getPath(t,n,r,i).draw(e)},ko.prototype.drawPoints=function(e,t,n,r){function i(t,n,r,i){e.beginPath();for(var a=0;a<t.length;a+=1)e.moveTo(n+t[a].x*i,r+t[a].y*i),e.arc(n+t[a].x*i,r+t[a].y*i,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:24;for(var a=1/this.path.unitsPerEm*r,s=[],o=[],l=this.path,h=0;h<l.commands.length;h+=1){var u=l.commands[h];void 0!==u.x&&s.push({x:u.x,y:-u.y}),void 0!==u.x1&&o.push({x:u.x1,y:-u.y1}),void 0!==u.x2&&o.push({x:u.x2,y:-u.y2})}e.fillStyle="blue",i(s,t,n,a),e.fillStyle="red",i(o,t,n,a)},ko.prototype.drawMetrics=function(e,t,n,r){var i;t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:24,i=1/this.path.unitsPerEm*r,e.lineWidth=1,e.strokeStyle="black",zd.line(e,t,-1e4,t,1e4),zd.line(e,-1e4,n,1e4,n);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,h=this.advanceWidth||0;e.strokeStyle="blue",zd.line(e,t+a*i,-1e4,t+a*i,1e4),zd.line(e,t+o*i,-1e4,t+o*i,1e4),zd.line(e,-1e4,n+-s*i,1e4,n+-s*i),zd.line(e,-1e4,n+-l*i,1e4,n+-l*i),e.strokeStyle="green",zd.line(e,t+h*i,-1e4,t+h*i,1e4)},iN.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],n=this.font._IndexToUnicodeMap[e];if(n)for(var r=0;r<n.unicodes.length;r++)t.addUnicode(n.unicodes[r]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},iN.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var dc={GlyphSet:iN,glyphLoader:plt,ttfGlyphLoader:mlt,cffGlyphLoader:glt};function Phe(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n+=1)if(!Phe(e[n],t[n]))return!1;return!0}return!1}function YF(e){return e.length<1240?107:e.length<33900?1131:32768}function Dh(e,t,n){var r,i,a=[],s=[],o=an.getCard16(e,t);if(0!==o){var l=an.getByte(e,t+2);r=t+(o+1)*l+2;for(var h=t+3,u=0;u<o+1;u+=1)a.push(an.getOffset(e,h,l)),h+=l;i=r+a[o]}else i=t+2;for(var c=0;c<a.length-1;c+=1){var d=an.getBytes(e,r+a[c],r+a[c+1]);n&&(d=n(d)),s.push(d)}return{objects:s,startOffset:t,endOffset:i}}function vlt(e,t){var n,r,i=[],a=an.getCard16(e,t);if(0!==a){var s=an.getByte(e,t+2);n=t+(a+1)*s+2;for(var o=t+3,l=0;l<a+1;l+=1)i.push(an.getOffset(e,o,s)),o+=s;r=n+i[a]}else r=t+2;return{offsets:i,startOffset:t,endOffset:r}}function ylt(e,t,n,r,i){var a=an.getCard16(n,r),s=0;0!==a&&(s=r+(a+1)*an.getByte(n,r+2)+2);var o=an.getBytes(n,s+t[e],s+t[e+1]);return i&&(o=i(o)),o}function xlt(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=e.parseByte(),i=r>>4,a=15&r;if(15===i||(t+=n[i],15===a))break;t+=n[a]}return parseFloat(t)}function blt(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return xlt(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function Elt(e){for(var t={},n=0;n<e.length;n+=1){var r=e[n][0],i=e[n][1],a=void 0;if(a=1===i.length?i[0]:i,t.hasOwnProperty(r)&&!isNaN(t[r]))throw new Error("Object "+t+" already has key "+r);t[r]=a}return t}function Ihe(e,t,n){t=void 0!==t?t:0;var r=new an.Parser(e,t),i=[],a=[];for(n=void 0!==n?n:e.length;r.relativeOffset<n;){var s=r.parseByte();s<=21?(12===s&&(s=1200+r.parseByte()),i.push([s,a]),a=[]):a.push(blt(r,s))}return Elt(i)}function fx(e,t){return t=t<=390?UA[t]:e[t-391]}function Dhe(e,t,n){for(var r,i={},a=0;a<t.length;a+=1){var s=t[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)void 0===(r=void 0!==e[s.op]?e[s.op][l]:void 0)&&(r=void 0!==s.value&&void 0!==s.value[l]?s.value[l]:null),"SID"===s.type[l]&&(r=fx(n,r)),o[l]=r;i[s.name]=o}else void 0===(r=e[s.op])&&(r=void 0!==s.value?s.value:null),"SID"===s.type&&(r=fx(n,r)),i[s.name]=r}return i}function _lt(e,t){var n={};return n.formatMajor=an.getCard8(e,t),n.formatMinor=an.getCard8(e,t+1),n.size=an.getCard8(e,t+2),n.offsetSize=an.getCard8(e,t+3),n.startOffset=t,n.endOffset=t+4,n}var Ohe=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],Lhe=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function Tlt(e,t){return Dhe(Ihe(e,0,e.byteLength),Ohe,t)}function khe(e,t,n,r){return Dhe(Ihe(e,t,n),Lhe,r)}function zue(e,t,n,r){for(var i=[],a=0;a<n.length;a+=1){var s=Tlt(new DataView(new Uint8Array(n[a]).buffer),r);s._subrs=[],s._subrsBias=0,s._defaultWidthX=0,s._nominalWidthX=0;var o=s.private[0],l=s.private[1];if(0!==o&&0!==l){var h=khe(e,l+t,o,r);if(s._defaultWidthX=h.defaultWidthX,s._nominalWidthX=h.nominalWidthX,0!==h.subrs){var u=Dh(e,l+h.subrs+t);s._subrs=u.objects,s._subrsBias=YF(s._subrs)}s._privateDict=h}i.push(s)}return i}function Slt(e,t,n,r){var i,a,s=new an.Parser(e,t);n-=1;var o=[".notdef"],l=s.parseCard8();if(0===l)for(var h=0;h<n;h+=1)i=s.parseSID(),o.push(fx(r,i));else if(1===l)for(;o.length<=n;){i=s.parseSID(),a=s.parseCard8();for(var u=0;u<=a;u+=1)o.push(fx(r,i)),i+=1}else{if(2!==l)throw new Error("Unknown charset format "+l);for(;o.length<=n;){i=s.parseSID(),a=s.parseCard16();for(var c=0;c<=a;c+=1)o.push(fx(r,i)),i+=1}}return o}function wlt(e,t,n){var r,i={},a=new an.Parser(e,t),s=a.parseCard8();if(0===s)for(var o=a.parseCard8(),l=0;l<o;l+=1)i[r=a.parseCard8()]=l;else{if(1!==s)throw new Error("Unknown encoding format "+s);var h=a.parseCard8();r=1;for(var u=0;u<h;u+=1)for(var c=a.parseCard8(),d=a.parseCard8(),p=c;p<=c+d;p+=1)i[p]=r,r+=1}return new jA(i,n)}function que(e,t,n){var r,i,a,s,o,l,h,u,c=new Xi,d=[],p=0,f=!1,m=!1,g=0,v=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],x=e.tables.cff.topDict._fdArray[y];o=x._subrs,l=x._subrsBias,h=x._defaultWidthX,u=x._nominalWidthX}else o=e.tables.cff.topDict._subrs,l=e.tables.cff.topDict._subrsBias,h=e.tables.cff.topDict._defaultWidthX,u=e.tables.cff.topDict._nominalWidthX;var b=h;function _(e,t){m&&c.closePath(),c.moveTo(e,t),m=!0}function w(){d.length%2!=0&&!f&&(b=d.shift()+u),p+=d.length>>1,d.length=0,f=!0}return function n(h){for(var y,x,S,M,T,E,A,C,P,I,R,L,O=0;O<h.length;){var D=h[O];switch(O+=1,D){case 1:case 3:case 18:case 23:w();break;case 4:d.length>1&&!f&&(b=d.shift()+u,f=!0),v+=d.pop(),_(g,v);break;case 5:for(;d.length>0;)g+=d.shift(),v+=d.shift(),c.lineTo(g,v);break;case 6:for(;d.length>0&&(g+=d.shift(),c.lineTo(g,v),0!==d.length);)v+=d.shift(),c.lineTo(g,v);break;case 7:for(;d.length>0&&(v+=d.shift(),c.lineTo(g,v),0!==d.length);)g+=d.shift(),c.lineTo(g,v);break;case 8:for(;d.length>0;)r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s+d.shift(),c.curveTo(r,i,a,s,g,v);break;case 10:T=d.pop()+l,(E=o[T])&&n(E);break;case 11:return;case 12:switch(D=h[O],O+=1,D){case 35:r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),A=a+d.shift(),C=s+d.shift(),P=A+d.shift(),I=C+d.shift(),R=P+d.shift(),L=I+d.shift(),g=R+d.shift(),v=L+d.shift(),d.shift(),c.curveTo(r,i,a,s,A,C),c.curveTo(P,I,R,L,g,v);break;case 34:r=g+d.shift(),i=v,a=r+d.shift(),s=i+d.shift(),A=a+d.shift(),C=s,P=A+d.shift(),I=s,R=P+d.shift(),L=v,g=R+d.shift(),c.curveTo(r,i,a,s,A,C),c.curveTo(P,I,R,L,g,v);break;case 36:r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),A=a+d.shift(),C=s,P=A+d.shift(),I=s,R=P+d.shift(),L=I+d.shift(),g=R+d.shift(),c.curveTo(r,i,a,s,A,C),c.curveTo(P,I,R,L,g,v);break;case 37:r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),A=a+d.shift(),C=s+d.shift(),P=A+d.shift(),I=C+d.shift(),R=P+d.shift(),L=I+d.shift(),Math.abs(R-g)>Math.abs(L-v)?g=R+d.shift():v=L+d.shift(),c.curveTo(r,i,a,s,A,C),c.curveTo(P,I,R,L,g,v);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+D),d.length=0}break;case 14:d.length>0&&!f&&(b=d.shift()+u,f=!0),m&&(c.closePath(),m=!1);break;case 19:case 20:w(),O+=p+7>>3;break;case 21:d.length>2&&!f&&(b=d.shift()+u,f=!0),v+=d.pop(),_(g+=d.pop(),v);break;case 22:d.length>1&&!f&&(b=d.shift()+u,f=!0),_(g+=d.pop(),v);break;case 24:for(;d.length>2;)r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s+d.shift(),c.curveTo(r,i,a,s,g,v);g+=d.shift(),v+=d.shift(),c.lineTo(g,v);break;case 25:for(;d.length>6;)g+=d.shift(),v+=d.shift(),c.lineTo(g,v);r=g+d.shift(),i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s+d.shift(),c.curveTo(r,i,a,s,g,v);break;case 26:for(d.length%2&&(g+=d.shift());d.length>0;)r=g,i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a,v=s+d.shift(),c.curveTo(r,i,a,s,g,v);break;case 27:for(d.length%2&&(v+=d.shift());d.length>0;)r=g+d.shift(),i=v,a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s,c.curveTo(r,i,a,s,g,v);break;case 28:y=h[O],x=h[O+1],d.push((y<<24|x<<16)>>16),O+=2;break;case 29:T=d.pop()+e.gsubrsBias,(E=e.gsubrs[T])&&n(E);break;case 30:for(;d.length>0&&(r=g,i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s+(1===d.length?d.shift():0),c.curveTo(r,i,a,s,g,v),0!==d.length);)r=g+d.shift(),i=v,a=r+d.shift(),s=i+d.shift(),v=s+d.shift(),g=a+(1===d.length?d.shift():0),c.curveTo(r,i,a,s,g,v);break;case 31:for(;d.length>0&&(r=g+d.shift(),i=v,a=r+d.shift(),s=i+d.shift(),v=s+d.shift(),g=a+(1===d.length?d.shift():0),c.curveTo(r,i,a,s,g,v),0!==d.length);)r=g,i=v+d.shift(),a=r+d.shift(),s=i+d.shift(),g=a+d.shift(),v=s+(1===d.length?d.shift():0),c.curveTo(r,i,a,s,g,v);break;default:D<32?console.log("Glyph "+t.index+": unknown operator "+D):D<247?d.push(D-139):D<251?(y=h[O],O+=1,d.push(256*(D-247)+y+108)):D<255?(y=h[O],O+=1,d.push(256*-(D-251)-y-108)):(y=h[O],x=h[O+1],S=h[O+2],M=h[O+3],O+=4,d.push((y<<24|x<<16|S<<8|M)/65536))}}}(n),t.advanceWidth=b,c}function Mlt(e,t,n,r){var i,a=[],s=new an.Parser(e,t),o=s.parseCard8();if(0===o)for(var l=0;l<n;l++){if((i=s.parseCard8())>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+r+")");a.push(i)}else{if(3!==o)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);var h=s.parseCard16(),u=s.parseCard16();if(0!==u)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+u);for(var c,d=0;d<h;d++){if(i=s.parseCard8(),c=s.parseCard16(),i>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+i+" (FD count "+r+")");if(c>n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+c);for(;u<c;u++)a.push(i);u=c}if(c!==n)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+c)}return a}function Alt(e,t,n,r){n.tables.cff={};var i=_lt(e,t),a=Dh(e,i.endOffset,an.bytesToString),s=Dh(e,a.endOffset),o=Dh(e,s.endOffset,an.bytesToString),l=Dh(e,o.endOffset);n.gsubrs=l.objects,n.gsubrsBias=YF(n.gsubrs);var h=zue(e,t,s.objects,o.objects);if(1!==h.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var u=h[0];if(n.tables.cff.topDict=u,u._privateDict&&(n.defaultWidthX=u._privateDict.defaultWidthX,n.nominalWidthX=u._privateDict.nominalWidthX),void 0!==u.ros[0]&&void 0!==u.ros[1]&&(n.isCIDFont=!0),n.isCIDFont){var c=u.fdArray,d=u.fdSelect;if(0===c||0===d)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=Dh(e,c+=t),f=zue(e,t,p.objects,o.objects);u._fdArray=f,d+=t,u._fdSelect=Mlt(e,d,n.numGlyphs,f.length)}var m,g=t+u.private[1],v=khe(e,g,u.private[0],o.objects);if(n.defaultWidthX=v.defaultWidthX,n.nominalWidthX=v.nominalWidthX,0!==v.subrs){var y=g+v.subrs,x=Dh(e,y);n.subrs=x.objects,n.subrsBias=YF(n.subrs)}else n.subrs=[],n.subrsBias=0;r.lowMemory?(m=vlt(e,t+u.charStrings),n.nGlyphs=m.offsets.length):(m=Dh(e,t+u.charStrings),n.nGlyphs=m.objects.length);var b=Slt(e,t+u.charset,n.nGlyphs,o.objects);if(0===u.encoding?n.cffEncoding=new jA(olt,b):1===u.encoding?n.cffEncoding=new jA(llt,b):n.cffEncoding=wlt(e,t+u.encoding,b),n.encoding=n.encoding||n.cffEncoding,n.glyphs=new dc.GlyphSet(n),r.lowMemory)n._push=function(r){var i=ylt(r,m.offsets,e,t+u.charStrings);n.glyphs.push(r,dc.cffGlyphLoader(n,r,que,i))};else for(var _=0;_<n.nGlyphs;_+=1){var w=m.objects[_];n.glyphs.push(_,dc.cffGlyphLoader(n,_,que,w))}}function Fhe(e,t){var n,r=UA.indexOf(e);return r>=0&&(n=r),(r=t.indexOf(e))>=0?n=r+UA.length:(n=UA.length+t.length,t.push(e)),n}function Clt(){return new Qt.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function Rlt(e){var t=new Qt.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var n=0;n<e.length;n+=1)t.names.push({name:"name_"+n,type:"NAME",value:e[n]});return t}function Nhe(e,t,n){for(var r={},i=0;i<e.length;i+=1){var a=e[i],s=t[a.name];void 0!==s&&!Phe(s,a.value)&&("SID"===a.type&&(s=Fhe(s,n)),r[a.op]={name:a.name,type:a.type,value:s})}return r}function Gue(e,t){var n=new Qt.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Nhe(Ohe,e,t),n}function Wue(e){var t=new Qt.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function Plt(e){var t=new Qt.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var n=0;n<e.length;n+=1)t.strings.push({name:"string_"+n,type:"STRING",value:e[n]});return t}function Ilt(){return new Qt.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function Dlt(e,t){for(var n=new Qt.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<e.length;r+=1){var i=Fhe(e[r],t);n.fields.push({name:"glyph_"+r,type:"SID",value:i})}return n}function Olt(e){var t=[],n=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var r=0,i=0,a=0;a<n.commands.length;a+=1){var s=void 0,o=void 0,l=n.commands[a];if("Q"===l.type){var h=.3333333333333333,u=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(h*r+u*l.x1),y1:Math.round(h*i+u*l.y1),x2:Math.round(h*l.x+u*l.x1),y2:Math.round(h*l.y+u*l.y1)}}if("M"===l.type)s=Math.round(l.x-r),o=Math.round(l.y-i),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(l.x),i=Math.round(l.y);else if("L"===l.type)s=Math.round(l.x-r),o=Math.round(l.y-i),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),r=Math.round(l.x),i=Math.round(l.y);else if("C"===l.type){var c=Math.round(l.x1-r),d=Math.round(l.y1-i),p=Math.round(l.x2-l.x1),f=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:c}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:p}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(l.x),i=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function Llt(e){for(var t=new Qt.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),n=0;n<e.length;n+=1){var r=e.get(n),i=Olt(r);t.charStrings.push({name:r.name,type:"CHARSTRING",value:i})}return t}function klt(e,t){var n=new Qt.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return n.dict=Nhe(Lhe,e,t),n}function Flt(e,t){for(var n,r=new Qt.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),i=1/t.unitsPerEm,a={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[i,0,0,i,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s=[],o=1;o<e.length;o+=1)n=e.get(o),s.push(n.name);var l=[];r.header=Clt(),r.nameIndex=Rlt([t.postScriptName]);var h=Gue(a,l);r.topDictIndex=Wue(h),r.globalSubrIndex=Ilt(),r.charsets=Dlt(s,l),r.charStringsIndex=Llt(e),r.privateDict=klt({},l),r.stringIndex=Plt(l);var u=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return a.charset=u,a.encoding=0,a.charStrings=a.charset+r.charsets.sizeOf(),a.private[1]=a.charStrings+r.charStringsIndex.sizeOf(),h=Gue(a,l),r.topDictIndex=Wue(h),r}var Bhe={parse:Alt,make:Flt};function Nlt(e,t){var n={},r=new an.Parser(e,t);return n.version=r.parseVersion(),n.fontRevision=Math.round(1e3*r.parseFixed())/1e3,n.checkSumAdjustment=r.parseULong(),n.magicNumber=r.parseULong(),Mn.argument(1594834165===n.magicNumber,"Font header has wrong magic number."),n.flags=r.parseUShort(),n.unitsPerEm=r.parseUShort(),n.created=r.parseLongDateTime(),n.modified=r.parseLongDateTime(),n.xMin=r.parseShort(),n.yMin=r.parseShort(),n.xMax=r.parseShort(),n.yMax=r.parseShort(),n.macStyle=r.parseUShort(),n.lowestRecPPEM=r.parseUShort(),n.fontDirectionHint=r.parseShort(),n.indexToLocFormat=r.parseShort(),n.glyphDataFormat=r.parseShort(),n}function Blt(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,n=t;return e.createdTimestamp&&(n=e.createdTimestamp+2082844800),new Qt.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:n},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var Uhe={parse:Nlt,make:Blt};function Ult(e,t){var n={},r=new an.Parser(e,t);return n.version=r.parseVersion(),n.ascender=r.parseShort(),n.descender=r.parseShort(),n.lineGap=r.parseShort(),n.advanceWidthMax=r.parseUShort(),n.minLeftSideBearing=r.parseShort(),n.minRightSideBearing=r.parseShort(),n.xMaxExtent=r.parseShort(),n.caretSlopeRise=r.parseShort(),n.caretSlopeRun=r.parseShort(),n.caretOffset=r.parseShort(),r.relativeOffset+=8,n.metricDataFormat=r.parseShort(),n.numberOfHMetrics=r.parseUShort(),n}function Hlt(e){return new Qt.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var Hhe={parse:Ult,make:Hlt};function Vlt(e,t,n,r,i){for(var a,s,o=new an.Parser(e,t),l=0;l<r;l+=1){l<n&&(a=o.parseUShort(),s=o.parseShort());var h=i.get(l);h.advanceWidth=a,h.leftSideBearing=s}}function zlt(e,t,n,r,i){e._hmtxTableData={};for(var a,s,o=new an.Parser(t,n),l=0;l<i;l+=1)l<r&&(a=o.parseUShort(),s=o.parseShort()),e._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function qlt(e,t,n,r,i,a,s){s.lowMemory?zlt(e,t,n,r,i):Vlt(t,n,r,i,a)}function Glt(e){for(var t=new Qt.Table("hmtx",[]),n=0;n<e.length;n+=1){var r=e.get(n),i=r.advanceWidth||0,a=r.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+n,type:"USHORT",value:i}),t.fields.push({name:"leftSideBearing_"+n,type:"SHORT",value:a})}return t}var Vhe={parse:qlt,make:Glt};function Wlt(e){for(var t=new Qt.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),n="",r=12+4*e.length,i=0;i<e.length;++i){var a=n.indexOf(e[i]);a<0&&(a=n.length,n+=e[i]),t.fields.push({name:"offset "+i,type:"USHORT",value:r+a}),t.fields.push({name:"length "+i,type:"USHORT",value:e[i].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),t}function jlt(e,t){var n=new an.Parser(e,t),r=n.parseULong();Mn.argument(1===r,"Unsupported ltag table version."),n.skip("uLong",1);for(var i=n.parseULong(),a=[],s=0;s<i;s++){for(var o="",l=t+n.parseUShort(),h=n.parseUShort(),u=l;u<l+h;++u)o+=String.fromCharCode(e.getInt8(u));a.push(o)}return a}var zhe={make:Wlt,parse:jlt};function Xlt(e,t){var n={},r=new an.Parser(e,t);return n.version=r.parseVersion(),n.numGlyphs=r.parseUShort(),1===n.version&&(n.maxPoints=r.parseUShort(),n.maxContours=r.parseUShort(),n.maxCompositePoints=r.parseUShort(),n.maxCompositeContours=r.parseUShort(),n.maxZones=r.parseUShort(),n.maxTwilightPoints=r.parseUShort(),n.maxStorage=r.parseUShort(),n.maxFunctionDefs=r.parseUShort(),n.maxInstructionDefs=r.parseUShort(),n.maxStackElements=r.parseUShort(),n.maxSizeOfInstructions=r.parseUShort(),n.maxComponentElements=r.parseUShort(),n.maxComponentDepth=r.parseUShort()),n}function Ylt(e){return new Qt.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var qhe={parse:Xlt,make:Ylt},Ghe=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Whe={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},$lt={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},jhe={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Zlt(e,t,n){switch(e){case 0:if(65535===t)return"und";if(n)return n[t];break;case 1:return Whe[t];case 3:return jhe[t]}}var $F="utf-16",Klt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Jlt={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Xhe(e,t,n){switch(e){case 0:return $F;case 1:return Jlt[n]||Klt[t];case 3:if(1===t||10===t)return $F}}function Qlt(e,t,n){for(var r={},i=new an.Parser(e,t),a=i.parseUShort(),s=i.parseUShort(),o=i.offset+i.parseUShort(),l=0;l<s;l++){var h=i.parseUShort(),u=i.parseUShort(),c=i.parseUShort(),d=i.parseUShort(),p=Ghe[d]||d,f=i.parseUShort(),m=i.parseUShort(),g=Zlt(h,c,n),v=Xhe(h,u,c);if(void 0!==v&&void 0!==g){var y=void 0;if(y=v===$F?n0.UTF16(e,o+m,f):n0.MACSTRING(e,o+m,f,v)){var x=r[p];void 0===x&&(x=r[p]={}),x[g]=y}}}return 1===a&&i.parseUShort(),r}function FF(e){var t={};for(var n in e)t[e[n]]=parseInt(n);return t}function jue(e,t,n,r,i,a){return new Qt.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:n},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:i},{name:"offset",type:"USHORT",value:a}])}function ect(e,t){var n=e.length,r=t.length-n+1;e:for(var i=0;i<r;i++)for(;i<r;i++){for(var a=0;a<n;a++)if(t[i+a]!==e[a])continue e;return i}return-1}function Xue(e,t){var n=ect(e,t);if(n<0){n=t.length;for(var r=0,i=e.length;r<i;++r)t.push(e[r])}return n}function tct(e,t){var n,r=[],i={},a=FF(Ghe);for(var s in e){var o=a[s];if(void 0===o&&(o=s),n=parseInt(o),isNaN(n))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');i[n]=e[s],r.push(n)}for(var l=FF(Whe),h=FF(jhe),u=[],c=[],d=0;d<r.length;d++){var p=i[n=r[d]];for(var f in p){var m=p[f],g=1,v=l[f],y=$lt[v],x=Xhe(g,y,v),b=jt.MACSTRING(m,x);void 0===b&&(g=0,(v=t.indexOf(f))<0&&(v=t.length,t.push(f)),y=4,b=jt.UTF16(m));var _=Xue(b,c);u.push(jue(g,y,v,n,b.length,_));var w=h[f];if(void 0!==w){var S=jt.UTF16(m),M=Xue(S,c);u.push(jue(3,1,w,n,S.length,M))}}}u.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var T=new Qt.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:u.length},{name:"stringOffset",type:"USHORT",value:6+12*u.length}]),E=0;E<u.length;E++)T.fields.push({name:"record_"+E,type:"RECORD",value:u[E]});return T.fields.push({name:"strings",type:"LITERAL",value:c}),T}var Yhe={parse:Qlt,make:tct},ZF=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function nct(e){for(var t=0;t<ZF.length;t+=1){var n=ZF[t];if(e>=n.begin&&e<n.end)return t}return-1}function rct(e,t){var n={},r=new an.Parser(e,t);n.version=r.parseUShort(),n.xAvgCharWidth=r.parseShort(),n.usWeightClass=r.parseUShort(),n.usWidthClass=r.parseUShort(),n.fsType=r.parseUShort(),n.ySubscriptXSize=r.parseShort(),n.ySubscriptYSize=r.parseShort(),n.ySubscriptXOffset=r.parseShort(),n.ySubscriptYOffset=r.parseShort(),n.ySuperscriptXSize=r.parseShort(),n.ySuperscriptYSize=r.parseShort(),n.ySuperscriptXOffset=r.parseShort(),n.ySuperscriptYOffset=r.parseShort(),n.yStrikeoutSize=r.parseShort(),n.yStrikeoutPosition=r.parseShort(),n.sFamilyClass=r.parseShort(),n.panose=[];for(var i=0;i<10;i++)n.panose[i]=r.parseByte();return n.ulUnicodeRange1=r.parseULong(),n.ulUnicodeRange2=r.parseULong(),n.ulUnicodeRange3=r.parseULong(),n.ulUnicodeRange4=r.parseULong(),n.achVendID=String.fromCharCode(r.parseByte(),r.parseByte(),r.parseByte(),r.parseByte()),n.fsSelection=r.parseUShort(),n.usFirstCharIndex=r.parseUShort(),n.usLastCharIndex=r.parseUShort(),n.sTypoAscender=r.parseShort(),n.sTypoDescender=r.parseShort(),n.sTypoLineGap=r.parseShort(),n.usWinAscent=r.parseUShort(),n.usWinDescent=r.parseUShort(),n.version>=1&&(n.ulCodePageRange1=r.parseULong(),n.ulCodePageRange2=r.parseULong()),n.version>=2&&(n.sxHeight=r.parseShort(),n.sCapHeight=r.parseShort(),n.usDefaultChar=r.parseUShort(),n.usBreakChar=r.parseUShort(),n.usMaxContent=r.parseUShort()),n}function ict(e){return new Qt.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var KF={parse:rct,make:ict,unicodeRanges:ZF,getUnicodeRange:nct};function sct(e,t){var n={},r=new an.Parser(e,t);switch(n.version=r.parseVersion(),n.italicAngle=r.parseFixed(),n.underlinePosition=r.parseShort(),n.underlineThickness=r.parseShort(),n.isFixedPitch=r.parseULong(),n.minMemType42=r.parseULong(),n.maxMemType42=r.parseULong(),n.minMemType1=r.parseULong(),n.maxMemType1=r.parseULong(),n.version){case 1:n.names=qd.slice();break;case 2:n.numberOfGlyphs=r.parseUShort(),n.glyphNameIndex=new Array(n.numberOfGlyphs);for(var i=0;i<n.numberOfGlyphs;i++)n.glyphNameIndex[i]=r.parseUShort();n.names=[];for(var a=0;a<n.numberOfGlyphs;a++)if(n.glyphNameIndex[a]>=qd.length){var s=r.parseChar();n.names.push(r.parseString(s))}break;case 2.5:n.numberOfGlyphs=r.parseUShort(),n.offset=new Array(n.numberOfGlyphs);for(var o=0;o<n.numberOfGlyphs;o++)n.offset[o]=r.parseChar()}return n}function act(){return new Qt.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var $he={parse:sct,make:act},xl=new Array(9);xl[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(pt.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(pt.coverage),substitute:this.parseOffset16List()}:void Mn.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},xl[2]=function(){var e=this.parseUShort();return Mn.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(pt.coverage),sequences:this.parseListOfLists()}},xl[3]=function(){var e=this.parseUShort();return Mn.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(pt.coverage),alternateSets:this.parseListOfLists()}},xl[4]=function(){var e=this.parseUShort();return Mn.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(pt.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var t0={sequenceIndex:pt.uShort,lookupListIndex:pt.uShort};function oct(e,t){var n=new pt(e,t=t||0),r=n.parseVersion(1);return Mn.argument(1===r||1.1===r,"Unsupported GSUB table version."),1===r?{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(xl)}:{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(xl),variations:n.parseFeatureVariationsList()}}xl[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(pt.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,t0)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(pt.coverage),classDef:this.parsePointer(pt.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,t0)}}))};if(3===t){var n=this.parseUShort(),r=this.parseUShort();return{substFormat:t,coverages:this.parseList(n,pt.pointer(pt.coverage)),lookupRecords:this.parseRecordList(r,t0)}}Mn.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},xl[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(pt.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(t0)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(pt.coverage),backtrackClassDef:this.parsePointer(pt.classDef),inputClassDef:this.parsePointer(pt.classDef),lookaheadClassDef:this.parsePointer(pt.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(t0)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(pt.pointer(pt.coverage)),inputCoverage:this.parseList(pt.pointer(pt.coverage)),lookaheadCoverage:this.parseList(pt.pointer(pt.coverage)),lookupRecords:this.parseRecordList(t0)}:void Mn.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},xl[7]=function(){var e=this.parseUShort();Mn.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),n=new pt(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:xl[t].call(n)}},xl[8]=function(){var e=this.parseUShort();return Mn.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(pt.coverage),backtrackCoverage:this.parseList(pt.pointer(pt.coverage)),lookaheadCoverage:this.parseList(pt.pointer(pt.coverage)),substitutes:this.parseUShortList()}};var r0=new Array(9);function lct(e){return new Qt.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Qt.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Qt.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Qt.LookupList(e.lookups,r0)}])}r0[1]=function(e){return 1===e.substFormat?new Qt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Qt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)}].concat(Qt.ushortList("substitute",e.substitute)))},r0[2]=function(e){return Mn.assert(1===e.substFormat,"Lookup type 2 substFormat must be 1."),new Qt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)}].concat(Qt.tableList("seqSet",e.sequences,(function(e){return new Qt.Table("sequenceSetTable",Qt.ushortList("sequence",e))}))))},r0[3]=function(e){return Mn.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new Qt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)}].concat(Qt.tableList("altSet",e.alternateSets,(function(e){return new Qt.Table("alternateSetTable",Qt.ushortList("alternate",e))}))))},r0[4]=function(e){return Mn.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new Qt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)}].concat(Qt.tableList("ligSet",e.ligatureSets,(function(e){return new Qt.Table("ligatureSetTable",Qt.tableList("ligature",e,(function(e){return new Qt.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(Qt.ushortList("component",e.components,e.components.length+1)))})))}))))},r0[6]=function(e){if(1===e.substFormat)return new Qt.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Qt.Coverage(e.coverage)}].concat(Qt.tableList("chainRuleSet",e.chainRuleSets,(function(e){return new Qt.Table("chainRuleSetTable",Qt.tableList("chainRule",e,(function(e){var t=Qt.ushortList("backtrackGlyph",e.backtrack,e.backtrack.length).concat(Qt.ushortList("inputGlyph",e.input,e.input.length+1)).concat(Qt.ushortList("lookaheadGlyph",e.lookahead,e.lookahead.length)).concat(Qt.ushortList("substitution",[],e.lookupRecords.length));return e.lookupRecords.forEach((function(e,n){t=t.concat({name:"sequenceIndex"+n,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+n,type:"USHORT",value:e.lookupListIndex})})),new Qt.Table("chainRuleTable",t)})))}))));if(2===e.substFormat)Mn.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(3===e.substFormat){var t=[{name:"substFormat",type:"USHORT",value:e.substFormat}];return t.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach((function(e,n){t.push({name:"backtrackCoverage"+n,type:"TABLE",value:new Qt.Coverage(e)})})),t.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach((function(e,n){t.push({name:"inputCoverage"+n,type:"TABLE",value:new Qt.Coverage(e)})})),t.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach((function(e,n){t.push({name:"lookaheadCoverage"+n,type:"TABLE",value:new Qt.Coverage(e)})})),t.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach((function(e,n){t=t.concat({name:"sequenceIndex"+n,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+n,type:"USHORT",value:e.lookupListIndex})})),new Qt.Table("chainContextTable",t)}Mn.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};var Zhe={parse:oct,make:lct};function cct(e,t){var n=new an.Parser(e,t),r=n.parseULong();Mn.argument(1===r,"Unsupported META table version."),n.parseULong(),n.parseULong();for(var i=n.parseULong(),a={},s=0;s<i;s++){var o=n.parseTag(),l=n.parseULong(),h=n.parseULong(),u=n0.UTF8(e,t+l,h);a[o]=u}return a}function uct(e){var t=Object.keys(e).length,n="",r=16+12*t,i=new Qt.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:r},{name:"numTags",type:"ULONG",value:t}]);for(var a in e){var s=n.length;n+=e[a],i.fields.push({name:"tag "+a,type:"TAG",value:a}),i.fields.push({name:"offset "+a,type:"ULONG",value:r+s}),i.fields.push({name:"length "+a,type:"ULONG",value:e[a].length})}return i.fields.push({name:"stringPool",type:"CHARARRAY",value:n}),i}var Khe={parse:cct,make:uct};function Yue(e){return Math.log(e)/Math.log(2)|0}function sN(e){for(;e.length%4!=0;)e.push(0);for(var t=0,n=0;n<e.length;n+=4)t+=(e[n]<<24)+(e[n+1]<<16)+(e[n+2]<<8)+e[n+3];return t%=Math.pow(2,32)}function $ue(e,t,n,r){return new Qt.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==n?n:0},{name:"length",type:"ULONG",value:void 0!==r?r:0}])}function Jhe(e){var t=new Qt.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var n=Math.pow(2,Yue(t.numTables));t.searchRange=16*n,t.entrySelector=Yue(n),t.rangeShift=16*t.numTables-t.searchRange;for(var r=[],i=[],a=t.sizeOf()+$ue().sizeOf()*t.numTables;a%4!=0;)a+=1,i.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<e.length;s+=1){var o=e[s];Mn.argument(4===o.tableName.length,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),h=$ue(o.tableName,sN(o.encode()),a,l);for(r.push({name:h.tag+" Table Record",type:"RECORD",value:h}),i.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,Mn.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!=0;)a+=1,i.push({name:"padding",type:"BYTE",value:0})}return r.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(r),t.fields=t.fields.concat(i),t}function Zue(e,t,n){for(var r=0;r<t.length;r+=1){var i=e.charToGlyphIndex(t[r]);if(i>0)return e.glyphs.get(i).getMetrics()}return n}function hct(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length}function fct(e){for(var t,n=[],r=[],i=[],a=[],s=[],o=[],l=[],h=0,u=0,c=0,d=0,p=0,f=0;f<e.glyphs.length;f+=1){var m=e.glyphs.get(f),g=0|m.unicode;if(isNaN(m.advanceWidth))throw new Error("Glyph "+m.name+" ("+f+"): advanceWidth is not a number.");(t>g||void 0===t)&&g>0&&(t=g),h<g&&(h=g);var v=KF.getUnicodeRange(g);if(v<32)u|=1<<v;else if(v<64)c|=1<<v-32;else if(v<96)d|=1<<v-64;else{if(!(v<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");p|=1<<v-96}if(".notdef"!==m.name){var y=m.getMetrics();n.push(y.xMin),r.push(y.yMin),i.push(y.xMax),a.push(y.yMax),o.push(y.leftSideBearing),l.push(y.rightSideBearing),s.push(m.advanceWidth)}}var x={xMin:Math.min.apply(null,n),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,i),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:hct(s),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,l)};x.ascender=e.ascender,x.descender=e.descender;var b=Uhe.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:x.xMin,yMin:x.yMin,xMax:x.xMax,yMax:x.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),_=Hhe.make({ascender:x.ascender,descender:x.descender,advanceWidthMax:x.advanceWidthMax,minLeftSideBearing:x.minLeftSideBearing,minRightSideBearing:x.minRightSideBearing,xMaxExtent:x.maxLeftSideBearing+(x.xMax-x.xMin),numberOfHMetrics:e.glyphs.length}),w=qhe.make(e.glyphs.length),S=KF.make(Object.assign({xAvgCharWidth:Math.round(x.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:h,ulUnicodeRange1:u,ulUnicodeRange2:c,ulUnicodeRange3:d,ulUnicodeRange4:p,sTypoAscender:x.ascender,sTypoDescender:x.descender,sTypoLineGap:0,usWinAscent:x.yMax,usWinDescent:Math.abs(x.yMin),ulCodePageRange1:1,sxHeight:Zue(e,"xyvw",{yMax:Math.round(x.ascender/2)}).yMax,sCapHeight:Zue(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",x).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),M=Vhe.make(e.glyphs),T=Ahe.make(e.glyphs),E=e.getEnglishName("fontFamily"),A=e.getEnglishName("fontSubfamily"),C=E+" "+A,P=e.getEnglishName("postScriptName");P||(P=E.replace(/\s/g,"")+"-"+A);var I={};for(var R in e.names)I[R]=e.names[R];I.uniqueID||(I.uniqueID={en:e.getEnglishName("manufacturer")+":"+C}),I.postScriptName||(I.postScriptName={en:P}),I.preferredFamily||(I.preferredFamily=e.names.fontFamily),I.preferredSubfamily||(I.preferredSubfamily=e.names.fontSubfamily);var L=[],O=Yhe.make(I,L),D=L.length>0?zhe.make(L):void 0,k=$he.make(),N=Bhe.make(e.glyphs,{version:e.getEnglishName("version"),fullName:C,familyName:E,weightName:A,postScriptName:P,unitsPerEm:e.unitsPerEm,fontBBox:[0,x.yMin,x.ascender,x.advanceWidthMax]}),F=e.metas&&Object.keys(e.metas).length>0?Khe.make(e.metas):void 0,U=[b,_,w,S,O,T,k,N,M];D&&U.push(D),e.tables.gsub&&U.push(Zhe.make(e.tables.gsub)),F&&U.push(F);for(var B=Jhe(U),z=sN(B.encode()),H=B.fields,V=!1,j=0;j<H.length;j+=1)if("head table"===H[j].name){H[j].value.checkSumAdjustment=2981146554-z,V=!0;break}if(!V)throw new Error("Could not find head table with checkSum to adjust.");return B}var dct={make:Jhe,fontToTable:fct,computeCheckSum:sN};function NF(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+r>>>1,a=e[i].tag;if(a===t)return i;a<t?n=i+1:r=i-1}return-n-1}function Kue(e,t){for(var n=0,r=e.length-1;n<=r;){var i=n+r>>>1,a=e[i];if(a===t)return i;a<t?n=i+1:r=i-1}return-n-1}function Jue(e,t){for(var n,r=0,i=e.length-1;r<=i;){var a=r+i>>>1,s=(n=e[a]).start;if(s===t)return n;s<t?r=a+1:i=a-1}if(r>0)return t>(n=e[r-1]).end?0:n}function vx(e,t){this.font=e,this.tableName=t}function yx(e){vx.call(this,e,"gpos")}function Za(e){vx.call(this,e,"gsub")}function pct(e,t){var n=e.length;if(n!==t.length)return!1;for(var r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function aN(e,t,n){for(var r=e.subtables,i=0;i<r.length;i++){var a=r[i];if(a.substFormat===t)return a}if(n)return r.push(n),n}function mct(){return"undefined"!=typeof window}function gct(e){for(var t=new Buffer(e.byteLength),n=new Uint8Array(e),r=0;r<t.length;++r)t[r]=n[r];return t}function hx(e,t){if(!e)throw t}function Que(e,t,n,r,i){var a;return(t&r)>0?(a=e.parseByte(),t&i||(a=-a),a=n+a):a=(t&i)>0?n:n+e.parseShort(),a}function Qhe(e,t,n){var r,i,a=new an.Parser(t,n);if(e.numberOfContours=a.parseShort(),e._xMin=a.parseShort(),e._yMin=a.parseShort(),e._xMax=a.parseShort(),e._yMax=a.parseShort(),e.numberOfContours>0){for(var s=e.endPointIndices=[],o=0;o<e.numberOfContours;o+=1)s.push(a.parseUShort());e.instructionLength=a.parseUShort(),e.instructions=[];for(var l=0;l<e.instructionLength;l+=1)e.instructions.push(a.parseByte());var h=s[s.length-1]+1;r=[];for(var u=0;u<h;u+=1)if(i=a.parseByte(),r.push(i),(8&i)>0)for(var c=a.parseByte(),d=0;d<c;d+=1)r.push(i),u+=1;if(Mn.argument(r.length===h,"Bad flags."),s.length>0){var p,f=[];if(h>0){for(var m=0;m<h;m+=1)i=r[m],(p={}).onCurve=!!(1&i),p.lastPointOfContour=s.indexOf(m)>=0,f.push(p);for(var g=0,v=0;v<h;v+=1)i=r[v],(p=f[v]).x=Que(a,i,g,2,16),g=p.x;for(var y=0,x=0;x<h;x+=1)i=r[x],(p=f[x]).y=Que(a,i,y,4,32),y=p.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var b=!0;b;){r=a.parseUShort();var _={glyphIndex:a.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&r)>0?(2&r)>0?(_.dx=a.parseShort(),_.dy=a.parseShort()):_.matchedPoints=[a.parseUShort(),a.parseUShort()]:(2&r)>0?(_.dx=a.parseChar(),_.dy=a.parseChar()):_.matchedPoints=[a.parseByte(),a.parseByte()],(8&r)>0?_.xScale=_.yScale=a.parseF2Dot14():(64&r)>0?(_.xScale=a.parseF2Dot14(),_.yScale=a.parseF2Dot14()):(128&r)>0&&(_.xScale=a.parseF2Dot14(),_.scale01=a.parseF2Dot14(),_.scale10=a.parseF2Dot14(),_.yScale=a.parseF2Dot14()),e.components.push(_),b=!!(32&r)}if(256&r){e.instructionLength=a.parseUShort(),e.instructions=[];for(var w=0;w<e.instructionLength;w+=1)e.instructions.push(a.parseByte())}}}function BF(e,t){for(var n=[],r=0;r<e.length;r+=1){var i=e[r],a={x:t.xScale*i.x+t.scale01*i.y+t.dx,y:t.scale10*i.x+t.yScale*i.y+t.dy,onCurve:i.onCurve,lastPointOfContour:i.lastPointOfContour};n.push(a)}return n}function vct(e){for(var t=[],n=[],r=0;r<e.length;r+=1){var i=e[r];n.push(i),i.lastPointOfContour&&(t.push(n),n=[])}return Mn.argument(0===n.length,"There are still points left in the current contour."),t}function efe(e){var t=new Xi;if(!e)return t;for(var n=vct(e),r=0;r<n.length;++r){var i=n[r],a=null,s=i[i.length-1],o=i[0];if(s.onCurve)t.moveTo(s.x,s.y);else if(o.onCurve)t.moveTo(o.x,o.y);else{var l={x:.5*(s.x+o.x),y:.5*(s.y+o.y)};t.moveTo(l.x,l.y)}for(var h=0;h<i.length;++h)if(a=s,s=o,o=i[(h+1)%i.length],s.onCurve)t.lineTo(s.x,s.y);else{var u=o;a.onCurve||{x:.5*(s.x+a.x),y:.5*(s.y+a.y)},o.onCurve||(u={x:.5*(s.x+o.x),y:.5*(s.y+o.y)}),t.quadraticCurveTo(s.x,s.y,u.x,u.y)}t.closePath()}return t}function tfe(e,t){if(t.isComposite)for(var n=0;n<t.components.length;n+=1){var r=t.components[n],i=e.get(r.glyphIndex);if(i.getPath(),i.points){var a=void 0;if(void 0===r.matchedPoints)a=BF(i.points,r);else{if(r.matchedPoints[0]>t.points.length-1||r.matchedPoints[1]>i.points.length-1)throw Error("Matched points out of range in "+t.name);var s=t.points[r.matchedPoints[0]],o=i.points[r.matchedPoints[1]],l={xScale:r.xScale,scale01:r.scale01,scale10:r.scale10,yScale:r.yScale,dx:0,dy:0};o=BF([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=BF(i.points,l)}t.points=t.points.concat(a)}}return efe(t.points)}function yct(e,t,n,r){for(var i=new dc.GlyphSet(r),a=0;a<n.length-1;a+=1){var s=n[a];s!==n[a+1]?i.push(a,dc.ttfGlyphLoader(r,a,Qhe,e,t+s,tfe)):i.push(a,dc.glyphLoader(r,a))}return i}function xct(e,t,n,r){var i=new dc.GlyphSet(r);return r._push=function(a){var s=n[a];s!==n[a+1]?i.push(a,dc.ttfGlyphLoader(r,a,Qhe,e,t+s,tfe)):i.push(a,dc.glyphLoader(r,a))},i}function bct(e,t,n,r,i){return i.lowMemory?xct(e,t,n,r):yct(e,t,n,r)}vx.prototype={searchTag:NF,binSearch:Kue,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,n=0;n<e.scripts.length;n++){var r=e.scripts[n].tag;if("DFLT"===r)return r;"latn"===r&&(t=!0)}if(t)return"latn"}},getScriptTable:function(e,t){var n=this.getTable(t);if(n){e=e||"DFLT";var r=n.scripts,i=NF(n.scripts,e);if(i>=0)return r[i].script;if(t){var a={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return r.splice(-1-i,0,a),a.script}}},getLangSysTable:function(e,t,n){var r=this.getScriptTable(e,n);if(r){if(!t||"dflt"===t||"DFLT"===t)return r.defaultLangSys;var i=NF(r.langSysRecords,t);if(i>=0)return r.langSysRecords[i].langSys;if(n){var a={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return r.langSysRecords.splice(-1-i,0,a),a.langSys}}},getFeatureTable:function(e,t,n,r){var i=this.getLangSysTable(e,t,r);if(i){for(var a,s=i.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if((a=o[s[l]]).tag===n)return a.feature;if(r){var h=o.length;return Mn.assert(0===h||n>=o[h-1].tag,"Features must be added in alphabetical order."),a={tag:n,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(h),a.feature}}},getLookupTables:function(e,t,n,r,i){var a=this.getFeatureTable(e,t,n,i),s=[];if(a){for(var o,l=a.lookupListIndexes,h=this.font.tables[this.tableName].lookups,u=0;u<l.length;u++)(o=h[l[u]]).lookupType===r&&s.push(o);if(0===s.length&&i){o={lookupType:r,lookupFlag:0,subtables:[],markFilteringSet:void 0};var c=h.length;return h.push(o),l.push(c),[o]}}return s},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var n=Jue(e.ranges,t);return n?n.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var n=Kue(e.glyphs,t);return n>=0?n:-1;case 2:var r=Jue(e.ranges,t);return r?r.index+t-r.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],n=e.ranges,r=0;r<n.length;r++)for(var i=n[r],a=i.start,s=i.end,o=a;o<=s;o++)t.push(o);return t}},yx.prototype=vx.prototype,yx.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},yx.prototype.getKerningValue=function(e,t,n){for(var r=0;r<e.length;r++)for(var i=e[r].subtables,a=0;a<i.length;a++){var s=i[a],o=this.getCoverageIndex(s.coverage,t);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],h=0;h<l.length;h++){var u=l[h];if(u.secondGlyph===n)return u.value1&&u.value1.xAdvance||0}break;case 2:var c=this.getGlyphClass(s.classDef1,t),d=this.getGlyphClass(s.classDef2,n),p=s.classRecords[c][d];return p.value1&&p.value1.xAdvance||0}}return 0},yx.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},Za.prototype=vx.prototype,Za.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Za.prototype.getSingle=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,1),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],h=this.expandCoverage(l.coverage),u=void 0;if(1===l.substFormat){var c=l.deltaGlyphId;for(u=0;u<h.length;u++){var d=h[u];r.push({sub:d,by:d+c})}}else{var p=l.substitute;for(u=0;u<h.length;u++)r.push({sub:h[u],by:p[u]})}}return r},Za.prototype.getMultiple=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,2),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++){var l=s[o],h=this.expandCoverage(l.coverage),u=void 0;for(u=0;u<h.length;u++){var c=h[u],d=l.sequences[u];r.push({sub:c,by:d})}}return r},Za.prototype.getAlternates=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,3),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],h=this.expandCoverage(l.coverage),u=l.alternateSets,c=0;c<h.length;c++)r.push({sub:h[c],by:u[c]});return r},Za.prototype.getLigatures=function(e,t,n){for(var r=[],i=this.getLookupTables(t,n,e,4),a=0;a<i.length;a++)for(var s=i[a].subtables,o=0;o<s.length;o++)for(var l=s[o],h=this.expandCoverage(l.coverage),u=l.ligatureSets,c=0;c<h.length;c++)for(var d=h[c],p=u[c],f=0;f<p.length;f++){var m=p[f];r.push({sub:[d].concat(m.components),by:m.ligGlyph})}return r},Za.prototype.addSingle=function(e,t,n,r){var i=aN(this.getLookupTables(n,r,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});Mn.assert(1===i.coverage.format,"Single: unable to modify coverage table format "+i.coverage.format);var a=t.sub,s=this.binSearch(i.coverage.glyphs,a);s<0&&(s=-1-s,i.coverage.glyphs.splice(s,0,a),i.substitute.splice(s,0,0)),i.substitute[s]=t.by},Za.prototype.addMultiple=function(e,t,n,r){Mn.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var i=aN(this.getLookupTables(n,r,e,2,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});Mn.assert(1===i.coverage.format,"Multiple: unable to modify coverage table format "+i.coverage.format);var a=t.sub,s=this.binSearch(i.coverage.glyphs,a);s<0&&(s=-1-s,i.coverage.glyphs.splice(s,0,a),i.sequences.splice(s,0,0)),i.sequences[s]=t.by},Za.prototype.addAlternate=function(e,t,n,r){var i=aN(this.getLookupTables(n,r,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});Mn.assert(1===i.coverage.format,"Alternate: unable to modify coverage table format "+i.coverage.format);var a=t.sub,s=this.binSearch(i.coverage.glyphs,a);s<0&&(s=-1-s,i.coverage.glyphs.splice(s,0,a),i.alternateSets.splice(s,0,0)),i.alternateSets[s]=t.by},Za.prototype.addLigature=function(e,t,n,r){var i=this.getLookupTables(n,r,e,4,!0)[0],a=i.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},i.subtables[0]=a),Mn.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=t.sub[0],o=t.sub.slice(1),l={ligGlyph:t.by,components:o},h=this.binSearch(a.coverage.glyphs,s);if(h>=0){for(var u=a.ligatureSets[h],c=0;c<u.length;c++)if(pct(u[c].components,o))return;u.push(l)}else h=-1-h,a.coverage.glyphs.splice(h,0,s),a.ligatureSets.splice(h,0,[l])},Za.prototype.getFeature=function(e,t,n){if(/ss\d\d/.test(e))return this.getSingle(e,t,n);switch(e){case"aalt":case"salt":return this.getSingle(e,t,n).concat(this.getAlternates(e,t,n));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,n);case"ccmp":return this.getMultiple(e,t,n).concat(this.getLigatures(e,t,n));case"stch":return this.getMultiple(e,t,n)}},Za.prototype.add=function(e,t,n,r){if(/ss\d\d/.test(e))return this.addSingle(e,t,n,r);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,n,r):this.addAlternate(e,t,n,r);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,n,r);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,n,r):this.addLigature(e,t,n,r)}};var nfe={getPath:efe,parse:bct},rfe,Wd,ife,JF;function sfe(e){this.font=e,this.getCommands=function(e){return nfe.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function Ect(e){return e}function afe(e){return Math.sign(e)*Math.round(Math.abs(e))}function _ct(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function Tct(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function Sct(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function wct(e){return Math.sign(e)*Math.floor(Math.abs(e))}var ofe=function(e){var t=this.srPeriod,n=this.srPhase,r=1;return e<0&&(e=-e,r=-1),e+=this.srThreshold-n,e=Math.trunc(e/t)*t,(e+=n)<0?n*r:e*r},fc={x:1,y:0,axis:"x",distance:function(e,t,n,r){return(n?e.xo:e.x)-(r?t.xo:t.x)},interpolate:function(e,t,n,r){var i,a,s,o,l,h,u;if(!r||r===this)return i=e.xo-t.xo,a=e.xo-n.xo,l=t.x-t.xo,h=n.x-n.xo,0===(u=(s=Math.abs(i))+(o=Math.abs(a)))?void(e.x=e.xo+(l+h)/2):void(e.x=e.xo+(l*o+h*s)/u);i=r.distance(e,t,!0,!0),a=r.distance(e,n,!0,!0),l=r.distance(t,t,!1,!0),h=r.distance(n,n,!1,!0),0!==(u=(s=Math.abs(i))+(o=Math.abs(a)))?fc.setRelative(e,e,(l*o+h*s)/u,r,!0):fc.setRelative(e,e,(l+h)/2,r,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,n,r,i){if(r&&r!==this){var a=i?t.xo:t.x,s=i?t.yo:t.y,o=a+n*r.x,l=s+n*r.y;e.x=o+(e.y-l)/r.normalSlope}else e.x=(i?t.xo:t.x)+n},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},hu={x:0,y:1,axis:"y",distance:function(e,t,n,r){return(n?e.yo:e.y)-(r?t.yo:t.y)},interpolate:function(e,t,n,r){var i,a,s,o,l,h,u;if(!r||r===this)return i=e.yo-t.yo,a=e.yo-n.yo,l=t.y-t.yo,h=n.y-n.yo,0===(u=(s=Math.abs(i))+(o=Math.abs(a)))?void(e.y=e.yo+(l+h)/2):void(e.y=e.yo+(l*o+h*s)/u);i=r.distance(e,t,!0,!0),a=r.distance(e,n,!0,!0),l=r.distance(t,t,!1,!0),h=r.distance(n,n,!1,!0),0!==(u=(s=Math.abs(i))+(o=Math.abs(a)))?hu.setRelative(e,e,(l*o+h*s)/u,r,!0):hu.setRelative(e,e,(l+h)/2,r,!0)},normalSlope:0,setRelative:function(e,t,n,r,i){if(r&&r!==this){var a=i?t.xo:t.x,s=i?t.yo:t.y,o=a+n*r.x,l=s+n*r.y;e.y=l+r.normalSlope*(e.x-o)}else e.y=(i?t.yo:t.y)+n},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function xx(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function bx(e,t){var n=Math.sqrt(e*e+t*t);return t/=n,1===(e/=n)&&0===t?fc:0===e&&1===t?hu:new xx(e,t)}function fu(e,t,n,r){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=n,this.onCurve=r,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(fc),Object.freeze(hu),xx.prototype.distance=function(e,t,n,r){return this.x*fc.distance(e,t,n,r)+this.y*hu.distance(e,t,n,r)},xx.prototype.interpolate=function(e,t,n,r){var i,a,s,o,l,h,u;s=r.distance(e,t,!0,!0),o=r.distance(e,n,!0,!0),i=r.distance(t,t,!1,!0),a=r.distance(n,n,!1,!0),0!==(u=(l=Math.abs(s))+(h=Math.abs(o)))?this.setRelative(e,e,(i*h+a*l)/u,r,!0):this.setRelative(e,e,(i+a)/2,r,!0)},xx.prototype.setRelative=function(e,t,n,r,i){r=r||this;var a=i?t.xo:t.x,s=i?t.yo:t.y,o=a+n*r.x,l=s+n*r.y,h=r.normalSlope,u=this.slope,c=e.x,d=e.y;e.x=(u*c-h*o+l-d)/(u-h),e.y=u*(e.x-c)+d},xx.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},fu.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},fu.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var gx=Object.freeze(new fu(0,0)),Mct={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Oh(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=fc,this.round=afe}}function XA(e){for(var t=e.tZone=new Array(e.gZone.length),n=0;n<t.length;n++)t[n]=new fu(0,0)}function lfe(e,t){var n,r=e.prog,i=e.ip,a=1;do{if(88===(n=r[++i]))a++;else if(89===n)a--;else if(64===n)i+=r[i+1]+1;else if(65===n)i+=2*r[i+1]+1;else if(n>=176&&n<=183)i+=n-176+1;else if(n>=184&&n<=191)i+=2*(n-184+1);else if(t&&1===a&&27===n)break}while(a>0);e.ip=i}function ehe(e,t){exports.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function the(e,t){exports.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function nhe(e,t){exports.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function rhe(e,t){var n,r,i=t.stack,a=i.pop(),s=i.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log("SPVTL["+e+"]",a,s),e?(n=o.y-l.y,r=l.x-o.x):(n=l.x-o.x,r=l.y-o.y),t.pv=t.dpv=bx(n,r)}function ihe(e,t){var n,r,i=t.stack,a=i.pop(),s=i.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log("SFVTL["+e+"]",a,s),e?(n=o.y-l.y,r=l.x-o.x):(n=l.x-o.x,r=l.y-o.y),t.fv=bx(n,r)}function Act(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",n,r),e.pv=e.dpv=bx(r,n)}function Cct(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",n,r),e.fv=bx(r,n)}function Rct(e){var t=e.stack,n=e.pv;exports.DEBUG&&console.log(e.step,"GPV[]"),t.push(16384*n.x),t.push(16384*n.y)}function Pct(e){var t=e.stack,n=e.fv;exports.DEBUG&&console.log(e.step,"GFV[]"),t.push(16384*n.x),t.push(16384*n.y)}function Ict(e){e.fv=e.pv,exports.DEBUG&&console.log(e.step,"SFVTPV[]")}function Dct(e){var t=e.stack,n=t.pop(),r=t.pop(),i=t.pop(),a=t.pop(),s=t.pop(),o=e.z0,l=e.z1,h=o[n],u=o[r],c=l[i],d=l[a],p=e.z2[s];exports.DEBUG&&console.log("ISECT[], ",n,r,i,a,s);var f=h.x,m=h.y,g=u.x,v=u.y,y=c.x,x=c.y,b=d.x,_=d.y,w=(f-g)*(x-_)-(m-v)*(y-b),S=f*v-m*g,M=y*_-x*b;p.x=(S*(y-b)-M*(f-g))/w,p.y=(S*(x-_)-M*(m-v))/w}function Oct(e){e.rp0=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)}function Lct(e){e.rp1=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)}function kct(e){e.rp2=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)}function Fct(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||XA(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Nct(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||XA(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Bct(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||XA(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Uct(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||XA(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Hct(e){e.loop=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)}function Vct(e){exports.DEBUG&&console.log(e.step,"RTG[]"),e.round=afe}function zct(e){exports.DEBUG&&console.log(e.step,"RTHG[]"),e.round=Tct}function qct(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64}function Gct(e){exports.DEBUG&&console.log(e.step,"ELSE[]"),lfe(e,!1)}function Wct(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1}function jct(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64}function Xct(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])}function UF(e){exports.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function Yct(e){exports.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0}function $ct(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"SWAP[]"),t.push(n),t.push(r)}function Zct(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)}function Kct(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"LOOPCALL[]",n,r);var i=e.ip,a=e.prog;e.prog=e.funcs[n];for(var s=0;s<r;s++)Wd(e),exports.DEBUG&&console.log(++e.step,s+1<r?"next loopcall":"done loopcall",s);e.ip=i,e.prog=a}function Jct(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"CALL[]",t);var n=e.ip,r=e.prog;e.prog=e.funcs[t],Wd(e),e.ip=n,e.prog=r,exports.DEBUG&&console.log(++e.step,"returning from",t)}function Qct(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"CINDEX[]",n),t.push(t[t.length-n])}function eut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"MINDEX[]",n),t.push(t.splice(t.length-n,1)[0])}function tut(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,n=e.prog,r=e.ip,i=t.pop(),a=r;for(exports.DEBUG&&console.log(e.step,"FDEF[]",i);45!==n[++r];);e.ip=r,e.funcs[i]=n.slice(a+1,r)}function she(e,t){var n=t.stack.pop(),r=t.z0[n],i=t.fv,a=t.pv;exports.DEBUG&&console.log(t.step,"MDAP["+e+"]",n);var s=a.distance(r,gx);e&&(s=t.round(s)),i.setRelative(r,gx,s,a),i.touch(r),t.rp0=t.rp1=n}function ahe(e,t){var n,r,i,a=t.z2,s=a.length-2;exports.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var o=0;o<s;o++)n=a[o],!e.touched(n)&&((r=n.prevTouched(e))!==n&&(r===(i=n.nextTouched(e))&&e.setRelative(n,n,e.distance(r,r,!1,!0),e,!0),e.interpolate(n,r,i,e)))}function ohe(e,t){for(var n=t.stack,r=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[r],a=t.fv,s=t.pv,o=t.loop,l=t.z2;o--;){var h=n.pop(),u=l[h],c=s.distance(i,i,!1,!0);a.setRelative(u,u,c,s),a.touch(u),exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",h)}t.loop=1}function lhe(e,t){var n=t.stack,r=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[r],a=t.fv,s=t.pv,o=n.pop(),l=t.z2[t.contours[o]],h=l;exports.DEBUG&&console.log(t.step,"SHC["+e+"]",o);var u=s.distance(i,i,!1,!0);do{h!==i&&a.setRelative(h,h,u,s),h=h.nextPointOnContour}while(h!==l)}function che(e,t){var n,r=t.stack,i=e?t.rp1:t.rp2,a=(e?t.z0:t.z1)[i],s=t.fv,o=t.pv,l=r.pop();switch(exports.DEBUG&&console.log(t.step,"SHZ["+e+"]",l),l){case 0:n=t.tZone;break;case 1:n=t.gZone;break;default:throw new Error("Invalid zone")}for(var h,u=o.distance(a,a,!1,!0),c=n.length-2,d=0;d<c;d++)h=n[d],s.setRelative(h,h,u,o)}function nut(e){for(var t=e.stack,n=e.loop,r=e.fv,i=t.pop()/64,a=e.z2;n--;){var s=t.pop(),o=a[s];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"SHPIX[]",s,i),r.setRelative(o,o,i),r.touch(o)}e.loop=1}function rut(e){for(var t=e.stack,n=e.rp1,r=e.rp2,i=e.loop,a=e.z0[n],s=e.z1[r],o=e.fv,l=e.dpv,h=e.z2;i--;){var u=t.pop(),c=h[u];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"IP[]",u,n,"<->",r),o.interpolate(c,a,s,l),o.touch(c)}e.loop=1}function uhe(e,t){var n=t.stack,r=n.pop()/64,i=n.pop(),a=t.z1[i],s=t.z0[t.rp0],o=t.fv,l=t.pv;o.setRelative(a,s,r,l),o.touch(a),exports.DEBUG&&console.log(t.step,"MSIRP["+e+"]",r,i),t.rp1=t.rp0,t.rp2=i,e&&(t.rp0=i)}function iut(e){for(var t=e.stack,n=e.rp0,r=e.z0[n],i=e.loop,a=e.fv,s=e.pv,o=e.z1;i--;){var l=t.pop(),h=o[l];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"ALIGNRP[]",l),a.setRelative(h,r,0,s),a.touch(h)}e.loop=1}function sut(e){exports.DEBUG&&console.log(e.step,"RTDG[]"),e.round=_ct}function hhe(e,t){var n=t.stack,r=n.pop(),i=n.pop(),a=t.z0[i],s=t.fv,o=t.pv,l=t.cvt[r];exports.DEBUG&&console.log(t.step,"MIAP["+e+"]",r,"(",l,")",i);var h=o.distance(a,gx);e&&(Math.abs(h-l)<t.cvCutIn&&(h=l),h=t.round(h)),s.setRelative(a,gx,h,o),0===t.zp0&&(a.xo=a.x,a.yo=a.y),s.touch(a),t.rp0=t.rp1=i}function aut(e){var t=e.prog,n=e.ip,r=e.stack,i=t[++n];exports.DEBUG&&console.log(e.step,"NPUSHB[]",i);for(var a=0;a<i;a++)r.push(t[++n]);e.ip=n}function out(e){var t=e.ip,n=e.prog,r=e.stack,i=n[++t];exports.DEBUG&&console.log(e.step,"NPUSHW[]",i);for(var a=0;a<i;a++){var s=n[++t]<<8|n[++t];32768&s&&(s=-(1+(65535^s))),r.push(s)}e.ip=t}function lut(e){var t=e.stack,n=e.store;n||(n=e.store=[]);var r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"WS",r,i),n[i]=r}function cut(e){var t=e.stack,n=e.store,r=t.pop();exports.DEBUG&&console.log(e.step,"RS",r);var i=n&&n[r]||0;t.push(i)}function uut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"WCVTP",n,r),e.cvt[r]=n/64}function hut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"RCVT",n),t.push(64*e.cvt[n])}function fhe(e,t){var n=t.stack,r=n.pop(),i=t.z2[r];exports.DEBUG&&console.log(t.step,"GC["+e+"]",r),n.push(64*t.dpv.distance(i,gx,e,!1))}function dhe(e,t){var n=t.stack,r=n.pop(),i=n.pop(),a=t.z1[r],s=t.z0[i],o=t.dpv.distance(s,a,e,e);exports.DEBUG&&console.log(t.step,"MD["+e+"]",r,i,"->",o),t.stack.push(Math.round(64*o))}function fut(e){exports.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)}function dut(e){exports.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0}function put(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"LT[]",n,r),t.push(r<n?1:0)}function mut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"LTEQ[]",n,r),t.push(r<=n?1:0)}function gut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"GT[]",n,r),t.push(r>n?1:0)}function vut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"GTEQ[]",n,r),t.push(r>=n?1:0)}function yut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"EQ[]",n,r),t.push(n===r?1:0)}function xut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"NEQ[]",n,r),t.push(n!==r?1:0)}function but(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"ODD[]",n),t.push(Math.trunc(n)%2?1:0)}function Eut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"EVEN[]",n),t.push(Math.trunc(n)%2?0:1)}function _ut(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"IF[]",t),t||(lfe(e,!0),exports.DEBUG&&console.log(e.step,"EIF[]"))}function Tut(e){exports.DEBUG&&console.log(e.step,"EIF[]")}function Sut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"AND[]",n,r),t.push(n&&r?1:0)}function wut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"OR[]",n,r),t.push(n||r?1:0)}function Mut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"NOT[]",n),t.push(n?0:1)}function HF(e,t){var n=t.stack,r=n.pop(),i=t.fv,a=t.pv,s=t.ppem,o=t.deltaBase+16*(e-1),l=t.deltaShift,h=t.z0;exports.DEBUG&&console.log(t.step,"DELTAP["+e+"]",r,n);for(var u=0;u<r;u++){var c=n.pop(),d=n.pop();if(o+((240&d)>>4)===s){var p=(15&d)-8;p>=0&&p++,exports.DEBUG&&console.log(t.step,"DELTAPFIX",c,"by",p*l);var f=h[c];i.setRelative(f,f,p*l,a)}}}function Aut(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDB[]",t),e.deltaBase=t}function Cut(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDS[]",t),e.deltaShift=Math.pow(.5,t)}function Rut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"ADD[]",n,r),t.push(r+n)}function Put(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"SUB[]",n,r),t.push(r-n)}function Iut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"DIV[]",n,r),t.push(64*r/n)}function Dut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"MUL[]",n,r),t.push(r*n/64)}function Out(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"ABS[]",n),t.push(Math.abs(n))}function Lut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"NEG[]",n),t.push(-n)}function kut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"FLOOR[]",n),t.push(64*Math.floor(n/64))}function Fut(e){var t=e.stack,n=t.pop();exports.DEBUG&&console.log(e.step,"CEILING[]",n),t.push(64*Math.ceil(n/64))}function BA(e,t){var n=t.stack,r=n.pop();exports.DEBUG&&console.log(t.step,"ROUND[]"),n.push(64*t.round(r/64))}function Nut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"WCVTF[]",n,r),e.cvt[r]=n*e.ppem/e.font.unitsPerEm}function VF(e,t){var n=t.stack,r=n.pop(),i=t.ppem,a=t.deltaBase+16*(e-1),s=t.deltaShift;exports.DEBUG&&console.log(t.step,"DELTAC["+e+"]",r,n);for(var o=0;o<r;o++){var l=n.pop(),h=n.pop();if(a+((240&h)>>4)===i){var u=(15&h)-8;u>=0&&u++;var c=u*s;exports.DEBUG&&console.log(t.step,"DELTACFIX",l,"by",c),t.cvt[l]+=c}}}function But(e){var t,n=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SROUND[]",n),e.round=ofe,192&n){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*t}function Uut(e){var t,n=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"S45ROUND[]",n),e.round=ofe,192&n){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&n){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}n&=15,e.srThreshold=0===n?0:(n/8-.5)*t}function Hut(e){exports.DEBUG&&console.log(e.step,"ROFF[]"),e.round=Ect}function Vut(e){exports.DEBUG&&console.log(e.step,"RUTG[]"),e.round=Sct}function zut(e){exports.DEBUG&&console.log(e.step,"RDTG[]"),e.round=wct}function qut(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANCTRL[]",t)}function phe(e,t){var n,r,i=t.stack,a=i.pop(),s=i.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",a,s),e?(n=o.y-l.y,r=l.x-o.x):(n=l.x-o.x,r=l.y-o.y),t.dpv=bx(n,r)}function Gut(e){var t=e.stack,n=t.pop(),r=0;exports.DEBUG&&console.log(e.step,"GETINFO[]",n),1&n&&(r=35),32&n&&(r|=4096),t.push(r)}function Wut(e){var t=e.stack,n=t.pop(),r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"ROLL[]"),t.push(r),t.push(n),t.push(i)}function jut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"MAX[]",n,r),t.push(Math.max(r,n))}function Xut(e){var t=e.stack,n=t.pop(),r=t.pop();exports.DEBUG&&console.log(e.step,"MIN[]",n,r),t.push(Math.min(r,n))}function Yut(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANTYPE[]",t)}function $ut(e){var t=e.stack.pop(),n=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"INSTCTRL[]",t,n),t){case 1:return void(e.inhibitGridFit=!!n);case 2:return void(e.ignoreCvt=!!n);default:throw new Error("invalid INSTCTRL[] selector")}}function Ph(e,t){var n=t.stack,r=t.prog,i=t.ip;exports.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var a=0;a<e;a++)n.push(r[++i]);t.ip=i}function Ih(e,t){var n=t.ip,r=t.prog,i=t.stack;exports.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var a=0;a<e;a++){var s=r[++n]<<8|r[++n];32768&s&&(s=-(1+(65535^s))),i.push(s)}t.ip=n}function sn(e,t,n,r,i,a){var s,o,l,h,u=a.stack,c=e&&u.pop(),d=u.pop(),p=a.rp0,f=a.z0[p],m=a.z1[d],g=a.minDis,v=a.fv,y=a.dpv;l=(o=s=y.distance(m,f,!0,!0))>=0?1:-1,o=Math.abs(o),e&&(h=a.cvt[c],r&&Math.abs(o-h)<a.cvCutIn&&(o=h)),n&&o<g&&(o=g),r&&(o=a.round(o)),v.setRelative(m,f,l*o,y),v.touch(m),exports.DEBUG&&console.log(a.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(n?">":"_")+(r?"R":"_")+(0===i?"Gr":1===i?"Bl":2===i?"Wh":"")+"]",e?c+"("+a.cvt[c]+","+h+")":"",d,"(d =",s,"->",l*o,")"),a.rp1=a.rp0,a.rp2=d,t&&(a.rp0=d)}function i0(e){this.char=e,this.state={},this.activeState=null}function oN(e,t,n){this.contextName=n,this.startIndex=e,this.endOffset=t}function Zut(e,t,n){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=n}function bl(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function YA(e){this.eventId=e,this.subscribers=[]}function Kut(e){var t=this,n=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];n.forEach((function(e){Object.defineProperty(t.events,e,{value:new YA(e)})})),e&&n.forEach((function(n){var r=e[n];"function"==typeof r&&t.events[n].subscribe(r)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function _i(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],Kut.call(this,e)}function Lh(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function cfe(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function kh(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function HA(e){return/[A-z]/.test(e)}function Jut(e){return/\s/.test(e)}function Ka(e){this.font=e,this.features={}}function Gd(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function Ex(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var n=t.ranges,r=0;r<n.length;r++){var i=n[r];if(e>=i.start&&e<=i.end){var a=e-i.start;return i.index+a}}break;default:return-1}return-1}function Qut(e,t){return-1===Ex(e,t.coverage)?null:e+t.deltaGlyphId}function eht(e,t){var n=Ex(e,t.coverage);return-1===n?null:t.substitute[n]}function zF(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],a=t.current,s=Ex(a=Array.isArray(a)?a[0]:a,i);-1!==s&&n.push(s)}return n.length!==e.length?-1:n}function tht(e,t){var n=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<n)return[];var r=zF(t.inputCoverage,e);if(-1===r)return[];var i=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var a=e.lookahead.slice(i);a.length&&kh(a[0].char);)a.shift();var s=new bl(a,0),o=zF(t.lookaheadCoverage,s),l=[].concat(e.backtrack);for(l.reverse();l.length&&kh(l[0].char);)l.shift();if(l.length<t.backtrackCoverage.length)return[];var h=new bl(l,0),u=zF(t.backtrackCoverage,h),c=[];if(r.length===t.inputCoverage.length&&o.length===t.lookaheadCoverage.length&&u.length===t.backtrackCoverage.length)for(var d=0;d<t.lookupRecords.length;d++)for(var p=t.lookupRecords[d].lookupListIndex,f=this.getLookupByIndex(p),m=0;m<f.subtables.length;m++){var g=f.subtables[m],v=this.getLookupMethod(f,g);if("12"===this.getSubstitutionType(f,g))for(var y=0;y<r.length;y++){var x=v(e.get(y));x&&c.push(x)}}return c}function nht(e,t){var n=Ex(e.current,t.coverage);if(-1===n)return null;for(var r,i=t.ligatureSets[n],a=0;a<i.length;a++){r=i[a];for(var s=0;s<r.components.length;s++){if(e.lookahead[s]!==r.components[s])break;if(s===r.components.length-1)return r}}return null}function rht(e,t){var n=Ex(e,t.coverage);return-1===n?null:t.sequences[n]}function iht(e){var t=e.current,n=e.get(-1);return null===n&&Lh(t)||!Lh(n)&&Lh(t)}function sht(e){var t=e.get(1);return null===t||!Lh(t)}sfe.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var n=this.font,r=this._prepState;if(!r||r.ppem!==t){var i=this._fpgmState;if(!i){Oh.prototype=Mct,(i=this._fpgmState=new Oh("fpgm",n.tables.fpgm)).funcs=[],i.font=n,exports.DEBUG&&(console.log("---EXEC FPGM---"),i.step=-1);try{Wd(i)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}Oh.prototype=i,(r=this._prepState=new Oh("prep",n.tables.prep)).ppem=t;var a=n.tables.cvt;if(a)for(var s=r.cvt=new Array(a.length),o=t/n.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else r.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),r.step=-1);try{Wd(r)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return ife(e,r)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},ife=function(e,t){var n,r,i,a=t.ppem/t.font.unitsPerEm,s=a,o=e.components;if(Oh.prototype=t,o){var l=t.font;r=[],n=[];for(var h=0;h<o.length;h++){var u=o[h],c=l.glyphs.get(u.glyphIndex);i=new Oh("glyf",c.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+h+"---"),i.step=-1),JF(c,i,a,s);for(var d=Math.round(u.dx*a),p=Math.round(u.dy*s),f=i.gZone,m=i.contours,g=0;g<f.length;g++){var v=f[g];v.xTouched=v.yTouched=!1,v.xo=v.x=v.x+d,v.yo=v.y=v.y+p}var y=r.length;r.push.apply(r,f);for(var x=0;x<m.length;x++)n.push(m[x]+y)}e.instructions&&!i.inhibitGridFit&&((i=new Oh("glyf",e.instructions)).gZone=i.z0=i.z1=i.z2=r,i.contours=n,r.push(new fu(0,0),new fu(Math.round(e.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),i.step=-1),Wd(i),r.length-=2)}else i=new Oh("glyf",e.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),i.step=-1),JF(e,i,a,s),r=i.gZone;return r},JF=function(e,t,n,r){for(var i,a=e.points||[],s=a.length,o=t.gZone=t.z0=t.z1=t.z2=[],l=t.contours=[],h=0;h<s;h++)i=a[h],o[h]=new fu(i.x*n,i.y*r,i.lastPointOfContour,i.onCurve);for(var u,c,d=0;d<s;d++)i=o[d],u||(u=i,l.push(d)),i.lastPointOfContour?(i.nextPointOnContour=u,u.prevPointOnContour=i,u=void 0):(c=o[d+1],i.nextPointOnContour=c,c.prevPointOnContour=i);if(!t.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var p=0;p<s;p++)console.log(p,o[p].x,o[p].y)}if(o.push(new fu(0,0),new fu(Math.round(e.advanceWidth*n),0)),Wd(t),o.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var f=0;f<s;f++)console.log(f,o[f].x,o[f].y)}}},Wd=function(e){var t=e.prog;if(t){var n,r=t.length;for(e.ip=0;e.ip<r;e.ip++){if(exports.DEBUG&&e.step++,!(n=rfe[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));n(e)}}},rfe=[ehe.bind(void 0,hu),ehe.bind(void 0,fc),the.bind(void 0,hu),the.bind(void 0,fc),nhe.bind(void 0,hu),nhe.bind(void 0,fc),rhe.bind(void 0,0),rhe.bind(void 0,1),ihe.bind(void 0,0),ihe.bind(void 0,1),Act,Cct,Rct,Pct,Ict,Dct,Oct,Lct,kct,Fct,Nct,Bct,Uct,Hct,Vct,zct,qct,Gct,Wct,jct,void 0,void 0,Xct,UF,Yct,$ct,Zct,Qct,eut,void 0,void 0,void 0,Kct,Jct,tut,void 0,she.bind(void 0,0),she.bind(void 0,1),ahe.bind(void 0,hu),ahe.bind(void 0,fc),ohe.bind(void 0,0),ohe.bind(void 0,1),lhe.bind(void 0,0),lhe.bind(void 0,1),che.bind(void 0,0),che.bind(void 0,1),nut,rut,uhe.bind(void 0,0),uhe.bind(void 0,1),iut,sut,hhe.bind(void 0,0),hhe.bind(void 0,1),aut,out,lut,cut,uut,hut,fhe.bind(void 0,0),fhe.bind(void 0,1),void 0,dhe.bind(void 0,0),dhe.bind(void 0,1),fut,void 0,dut,void 0,void 0,put,mut,gut,vut,yut,xut,but,Eut,_ut,Tut,Sut,wut,Mut,HF.bind(void 0,1),Aut,Cut,Rut,Put,Iut,Dut,Out,Lut,kut,Fut,BA.bind(void 0,0),BA.bind(void 0,1),BA.bind(void 0,2),BA.bind(void 0,3),void 0,void 0,void 0,void 0,Nut,HF.bind(void 0,2),HF.bind(void 0,3),VF.bind(void 0,1),VF.bind(void 0,2),VF.bind(void 0,3),But,Uut,void 0,void 0,Hut,void 0,Vut,zut,UF,UF,void 0,void 0,void 0,void 0,void 0,qut,phe.bind(void 0,0),phe.bind(void 0,1),Gut,void 0,Wut,jut,Xut,Yut,$ut,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ph.bind(void 0,1),Ph.bind(void 0,2),Ph.bind(void 0,3),Ph.bind(void 0,4),Ph.bind(void 0,5),Ph.bind(void 0,6),Ph.bind(void 0,7),Ph.bind(void 0,8),Ih.bind(void 0,1),Ih.bind(void 0,2),Ih.bind(void 0,3),Ih.bind(void 0,4),Ih.bind(void 0,5),Ih.bind(void 0,6),Ih.bind(void 0,7),Ih.bind(void 0,8),sn.bind(void 0,0,0,0,0,0),sn.bind(void 0,0,0,0,0,1),sn.bind(void 0,0,0,0,0,2),sn.bind(void 0,0,0,0,0,3),sn.bind(void 0,0,0,0,1,0),sn.bind(void 0,0,0,0,1,1),sn.bind(void 0,0,0,0,1,2),sn.bind(void 0,0,0,0,1,3),sn.bind(void 0,0,0,1,0,0),sn.bind(void 0,0,0,1,0,1),sn.bind(void 0,0,0,1,0,2),sn.bind(void 0,0,0,1,0,3),sn.bind(void 0,0,0,1,1,0),sn.bind(void 0,0,0,1,1,1),sn.bind(void 0,0,0,1,1,2),sn.bind(void 0,0,0,1,1,3),sn.bind(void 0,0,1,0,0,0),sn.bind(void 0,0,1,0,0,1),sn.bind(void 0,0,1,0,0,2),sn.bind(void 0,0,1,0,0,3),sn.bind(void 0,0,1,0,1,0),sn.bind(void 0,0,1,0,1,1),sn.bind(void 0,0,1,0,1,2),sn.bind(void 0,0,1,0,1,3),sn.bind(void 0,0,1,1,0,0),sn.bind(void 0,0,1,1,0,1),sn.bind(void 0,0,1,1,0,2),sn.bind(void 0,0,1,1,0,3),sn.bind(void 0,0,1,1,1,0),sn.bind(void 0,0,1,1,1,1),sn.bind(void 0,0,1,1,1,2),sn.bind(void 0,0,1,1,1,3),sn.bind(void 0,1,0,0,0,0),sn.bind(void 0,1,0,0,0,1),sn.bind(void 0,1,0,0,0,2),sn.bind(void 0,1,0,0,0,3),sn.bind(void 0,1,0,0,1,0),sn.bind(void 0,1,0,0,1,1),sn.bind(void 0,1,0,0,1,2),sn.bind(void 0,1,0,0,1,3),sn.bind(void 0,1,0,1,0,0),sn.bind(void 0,1,0,1,0,1),sn.bind(void 0,1,0,1,0,2),sn.bind(void 0,1,0,1,0,3),sn.bind(void 0,1,0,1,1,0),sn.bind(void 0,1,0,1,1,1),sn.bind(void 0,1,0,1,1,2),sn.bind(void 0,1,0,1,1,3),sn.bind(void 0,1,1,0,0,0),sn.bind(void 0,1,1,0,0,1),sn.bind(void 0,1,1,0,0,2),sn.bind(void 0,1,1,0,0,3),sn.bind(void 0,1,1,0,1,0),sn.bind(void 0,1,1,0,1,1),sn.bind(void 0,1,1,0,1,2),sn.bind(void 0,1,1,0,1,3),sn.bind(void 0,1,1,1,0,0),sn.bind(void 0,1,1,1,0,1),sn.bind(void 0,1,1,1,0,2),sn.bind(void 0,1,1,1,0,3),sn.bind(void 0,1,1,1,1,0),sn.bind(void 0,1,1,1,1,1),sn.bind(void 0,1,1,1,1,2),sn.bind(void 0,1,1,1,1,3)],i0.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},i0.prototype.getState=function(e){return this.state[e]||null},_i.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},_i.prototype.composeRUD=function(e){var t=this,n=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),r=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(n.every(r))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:n.filter(r)};this.dispatch("composeRUD",[n.filter((function(e){return!r(e)}))])},_i.prototype.replaceRange=function(e,t,n,r){t=null!==t?t:this.tokens.length;var i=n.every((function(e){return e instanceof i0}));if(!isNaN(e)&&this.inboundIndex(e)&&i){var a=this.tokens.splice.apply(this.tokens,[e,t].concat(n));return r||this.dispatch("replaceToken",[e,t,n]),[a,n]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},_i.prototype.replaceToken=function(e,t,n){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof i0){var r=this.tokens.splice(e,1,t);return n||this.dispatch("replaceToken",[e,t]),[r[0],t]}return{FAIL:"replaceToken: invalid token or index."}},_i.prototype.removeRange=function(e,t,n){t=isNaN(t)?this.tokens.length:t;var r=this.tokens.splice(e,t);return n||this.dispatch("removeRange",[r,e,t]),r},_i.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var n=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[n,e]),n}return{FAIL:"removeToken: invalid token index."}},_i.prototype.insertToken=function(e,t,n){return e.every((function(e){return e instanceof i0}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),n||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},_i.prototype.registerModifier=function(e,t,n){this.events.newToken.subscribe((function(r,i){var a=[r,i],s=[r,i];if(null===t||!0===t.apply(this,a)){var o=n.apply(this,s);r.setState(e,o)}})),this.registeredModifiers.push(e)},YA.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},YA.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},bl.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},bl.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},_i.prototype.rangeToText=function(e){if(e instanceof oN)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},_i.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},_i.prototype.getContext=function(e){return this.registeredContexts[e]||null},_i.prototype.on=function(e,t){var n=this.events[e];return n?n.subscribe(t):null},_i.prototype.dispatch=function(e,t){var n=this,r=this.events[e];r instanceof YA&&r.subscribers.forEach((function(e){e.apply(n,t||[])}))},_i.prototype.registerContextChecker=function(e,t,n){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof n)return{FAIL:"missing context end check."};var r=new Zut(e,t,n);return this.registeredContexts[e]=r,this.contextCheckers.push(r),r},_i.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},_i.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},_i.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)if(e.hasOwnProperty(t)){e[t].ranges=[]}},_i.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var n=new bl(e,t);this.runContextCheck(n)}this.dispatch("updateContextsRanges",[this.registeredContexts])},_i.prototype.setEndOffset=function(e,t){var n=new oN(this.getContext(t).openRange.startIndex,e,t),r=this.getContext(t).ranges;return n.rangeId=t+"."+r.length,r.push(n),this.getContext(t).openRange=null,n},_i.prototype.runContextCheck=function(e){var t=this,n=e.index;this.contextCheckers.forEach((function(r){var i=r.contextName,a=t.getContext(i).openRange;if(!a&&r.checkStart(e)&&(a=new oN(n,null,i),t.getContext(i).openRange=a,t.dispatch("contextStart",[i,n])),a&&r.checkEnd(e)){var s=n-a.startIndex+1,o=t.setEndOffset(s,i);t.dispatch("contextEnd",[i,o])}}))},_i.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var n=0;n<t.length;n++){var r=t[n],i=new bl(t,n);this.dispatch("next",[i]),this.runContextCheck(i);var a=new i0(r);this.tokens.push(a),this.dispatch("newToken",[a,i])}return this.dispatch("end",[this.tokens]),this.tokens},Ka.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var n=e[t];if("DFLT"===n.tag)return n.script.defaultLangSys.featureIndexes}return[]},Ka.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,n=0;n<t.length;n++){var r=t[n];if(r.tag===e&&r.script.defaultLangSys)return r.script.defaultLangSys.featureIndexes;var i=r.langSysRecords;if(i)for(var a=0;a<i.length;a++){var s=i[a];if(s.tag===e)return s.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Ka.prototype.mapTagsToFeatures=function(e,t){for(var n={},r=0;r<e.length;r++){var i=e[r].tag,a=e[r].feature;n[i]=a}this.features[t].tags=n},Ka.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var n=this.getScriptFeaturesIndexes(e);if(!n)return null;var r=this.font.tables.gsub;return t=n.map((function(e){return r.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},Ka.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},Ka.prototype.getLookupMethod=function(e,t){var n=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return Qut.apply(n,[e,t])};case"12":return function(e){return eht.apply(n,[e,t])};case"63":return function(e){return tht.apply(n,[e,t])};case"41":return function(e){return nht.apply(n,[e,t])};case"21":return function(e){return rht.apply(n,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},Ka.prototype.lookupFeature=function(e){var t=e.contextParams,n=t.index,r=this.getFeature({tag:e.tag,script:e.script});if(!r)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var i=this.getFeatureLookups(r),a=[].concat(t.context),s=0;s<i.length;s++)for(var o=i[s],l=this.getLookupSubtables(o),h=0;h<l.length;h++){var u=l[h],c=this.getSubstitutionType(o,u),d=this.getLookupMethod(o,u),p=void 0;switch(c){case"11":(p=d(t.current))&&a.splice(n,1,new Gd({id:11,tag:e.tag,substitution:p}));break;case"12":(p=d(t.current))&&a.splice(n,1,new Gd({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&a.splice(n,1,new Gd({id:63,tag:e.tag,substitution:p}));break;case"41":(p=d(t))&&a.splice(n,1,new Gd({id:41,tag:e.tag,substitution:p}));break;case"21":(p=d(t.current))&&a.splice(n,1,new Gd({id:21,tag:e.tag,substitution:p}))}t=new bl(a,n),(!Array.isArray(p)||p.length)&&(p=null)}return a.length?a:null},Ka.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var n=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&n},Ka.prototype.getLookupSubtables=function(e){return e.subtables||null},Ka.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},Ka.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Ka.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var aht={startCheck:iht,endCheck:sht};function oht(e){var t=e.current,n=e.get(-1);return(Lh(t)||kh(t))&&!Lh(n)}function lht(e){var t=e.get(1);switch(!0){case null===t:return!0;case!Lh(t)&&!kh(t):var n=Jut(t);if(!n)return!0;if(n){if(!e.lookahead.some((function(e){return Lh(e)||kh(e)})))return!0}break;default:return!1}}var cht={startCheck:oht,endCheck:lht};function uht(e,t,n){t[n].setState(e.tag,e.substitution)}function hht(e,t,n){t[n].setState(e.tag,e.substitution)}function fht(e,t,n){e.substitution.forEach((function(r,i){t[n+i].setState(e.tag,r)}))}function dht(e,t,n){var r=t[n];r.setState(e.tag,e.substitution.ligGlyph);for(var i=e.substitution.components.length,a=0;a<i;a++)(r=t[n+a+1]).setState("deleted",!0)}var mhe={11:uht,12:hht,63:fht,41:dht};function lN(e,t,n){e instanceof Gd&&mhe[e.id]&&mhe[e.id](e,t,n)}function pht(e){for(var t=[].concat(e.backtrack),n=t.length-1;n>=0;n--){var r=t[n],i=cfe(r),a=kh(r);if(!i&&!a)return!0;if(i)return!1}return!1}function mht(e){if(cfe(e.current))return!1;for(var t=0;t<e.lookahead.length;t++){if(!kh(e.lookahead[t]))return!0}return!1}function ght(e){var t=this,n="arab",r=this.featuresTags[n],i=this.tokenizer.getRangeTokens(e);if(1!==i.length){var a=new bl(i.map((function(e){return e.getState("glyphIndex")})),0),s=new bl(i.map((function(e){return e.char})),0);i.forEach((function(e,o){if(!kh(e.char)){a.setCurrentIndex(o),s.setCurrentIndex(o);var l,h=0;switch(pht(s)&&(h|=1),mht(s)&&(h|=2),h){case 1:l="fina";break;case 2:l="init";break;case 3:l="medi"}if(-1!==r.indexOf(l)){var u=t.query.lookupFeature({tag:l,script:n,contextParams:a});if(u instanceof Error)return console.info(u.message);u.forEach((function(e,t){e instanceof Gd&&(lN(e,i,t),a.context[t]=e.substitution)}))}}}))}}function ghe(e,t){return new bl(e.map((function(e){return e.activeState.value})),t||0)}function vht(e){var t=this,n=this.tokenizer.getRangeTokens(e),r=ghe(n);r.context.forEach((function(e,i){r.setCurrentIndex(i);var a=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:r});a.length&&(a.forEach((function(e){return lN(e,n,i)})),r=ghe(n))}))}function yht(e){var t=e.current,n=e.get(-1);return null===n&&HA(t)||!HA(n)&&HA(t)}function xht(e){var t=e.get(1);return null===t||!HA(t)}var bht={startCheck:yht,endCheck:xht};function vhe(e,t){return new bl(e.map((function(e){return e.activeState.value})),t||0)}function Eht(e){var t=this,n=this.tokenizer.getRangeTokens(e),r=vhe(n);r.context.forEach((function(e,i){r.setCurrentIndex(i);var a=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:r});a.length&&(a.forEach((function(e){return lN(e,n,i)})),r=vhe(n))}))}function Tl(e){this.baseDir=e||"ltr",this.tokenizer=new _i,this.featuresTags={}}function qF(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function _ht(){return qF.call(this,"latinWord"),qF.call(this,"arabicWord"),qF.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Tht(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var n=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,n.reverse())}))}function cN(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Sht(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(cN.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){ght.call(e,t)})))}function wht(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("rlig")&&(cN.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){vht.call(e,t)}))))}function Mht(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("liga")&&(cN.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){Eht.call(e,t)}))))}function kr(e){(e=e||{}).tables=e.tables||{},e.empty||(hx(e.familyName,"When creating a new Font object, familyName is required."),hx(e.styleName,"When creating a new Font object, styleName is required."),hx(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),hx(e.ascender,"When creating a new Font object, ascender is required."),hx(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new dc.GlyphSet(this,e.glyphs||[]),this.encoding=new Che(this),this.position=new yx(this),this.substitution=new Za(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new sfe(this):void 0}})}function ufe(e,t){var n=JSON.stringify(e),r=256;for(var i in t){var a=parseInt(i);if(a&&!(a<256)){if(JSON.stringify(t[i])===n)return a;r<=a&&(r=a+1)}}return t[r]=e,r}function Aht(e,t,n){var r=ufe(t.name,n);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:r}]}function Cht(e,t,n){var r={},i=new an.Parser(e,t);return r.tag=i.parseTag(),r.minValue=i.parseFixed(),r.defaultValue=i.parseFixed(),r.maxValue=i.parseFixed(),i.skip("uShort",1),r.name=n[i.parseUShort()]||{},r}function Rht(e,t,n,r){for(var i=[{name:"nameID_"+e,type:"USHORT",value:ufe(t.name,r)},{name:"flags_"+e,type:"USHORT",value:0}],a=0;a<n.length;++a){var s=n[a].tag;i.push({name:"axis_"+e+" "+s,type:"FIXED",value:t.coordinates[s]<<16})}return i}function Pht(e,t,n,r){var i={},a=new an.Parser(e,t);i.name=r[a.parseUShort()]||{},a.skip("uShort",1),i.coordinates={};for(var s=0;s<n.length;++s)i.coordinates[n[s].tag]=a.parseFixed();return i}function Iht(e,t){var n=new Qt.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);n.offsetToData=n.sizeOf();for(var r=0;r<e.axes.length;r++)n.fields=n.fields.concat(Aht(r,e.axes[r],t));for(var i=0;i<e.instances.length;i++)n.fields=n.fields.concat(Rht(i,e.instances[i],e.axes,t));return n}function Dht(e,t,n){var r=new an.Parser(e,t),i=r.parseULong();Mn.argument(65536===i,"Unsupported fvar table version.");var a=r.parseOffset16();r.skip("uShort",1);for(var s=r.parseUShort(),o=r.parseUShort(),l=r.parseUShort(),h=r.parseUShort(),u=[],c=0;c<s;c++)u.push(Cht(e,t+a+c*o,n));for(var d=[],p=t+a+s*o,f=0;f<l;f++)d.push(Pht(e,p+f*h,u,n));return{axes:u,instances:d}}Tl.prototype.setText=function(e){this.text=e},Tl.prototype.contextChecks={latinWordCheck:bht,arabicWordCheck:aht,arabicSentenceCheck:cht},Tl.prototype.registerFeatures=function(e,t){var n=this,r=t.filter((function(t){return n.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(r):this.featuresTags[e]=r},Tl.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Ka(e));for(var n=0;n<t.length;n++){var r=t[n];this.query.supports({script:r.script})&&this.registerFeatures(r.script,r.tags)}},Tl.prototype.registerModifier=function(e,t,n){this.tokenizer.registerModifier(e,t,n)},Tl.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Tl.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Sht.call(this),wht.call(this)),this.checkContextReady("latinWord")&&Mht.call(this),this.checkContextReady("arabicSentence")&&Tht.call(this)},Tl.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),_ht.call(this),this.applyFeaturesToContexts())},Tl.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Tl.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],n=0;n<this.tokenizer.tokens.length;n++){var r=this.tokenizer.tokens[n];if(!r.state.deleted){var i=r.activeState.value;t.push(Array.isArray(i)?i[0]:i)}}return t},kr.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},kr.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},kr.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),n=this.glyphs.get(t);return n||(n=this.glyphs.get(0)),n},kr.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},kr.prototype.stringToGlyphs=function(e,t){var n=this,r=new Tl;r.registerModifier("glyphIndex",null,(function(e){return n.charToGlyphIndex(e.char)}));var i=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;r.applyFeatures(this,i);for(var a=r.getTextGlyphs(e),s=a.length,o=new Array(s),l=this.glyphs.get(0),h=0;h<s;h+=1)o[h]=this.glyphs.get(a[h])||l;return o},kr.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},kr.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),n=this.glyphs.get(t);return n||(n=this.glyphs.get(0)),n},kr.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},kr.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var n=this.position.defaultKerningTables;return n?this.position.getKerningValue(n,e,t):this.kerningPairs[e+","+t]||0},kr.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},kr.prototype.forEachGlyph=function(e,t,n,r,i,a){t=void 0!==t?t:0,n=void 0!==n?n:0,r=void 0!==r?r:72,i=Object.assign({},this.defaultRenderOptions,i);var s,o=1/this.unitsPerEm*r,l=this.stringToGlyphs(e,i);if(i.kerning){var h=i.script||this.position.getDefaultScriptName();s=this.position.getKerningTables(h,i.language)}for(var u=0;u<l.length;u+=1){var c=l[u];if(a.call(this,c,t,n,r,i),c.advanceWidth&&(t+=c.advanceWidth*o),i.kerning&&u<l.length-1)t+=(s?this.position.getKerningValue(s,c.index,l[u+1].index):this.getKerningValue(c,l[u+1]))*o;i.letterSpacing?t+=i.letterSpacing*r:i.tracking&&(t+=i.tracking/1e3*r)}return t},kr.prototype.getPath=function(e,t,n,r,i){var a=new Xi;return this.forEachGlyph(e,t,n,r,i,(function(e,t,n,r){var s=e.getPath(t,n,r,i,this);a.extend(s)})),a},kr.prototype.getPaths=function(e,t,n,r,i){var a=[];return this.forEachGlyph(e,t,n,r,i,(function(e,t,n,r){var s=e.getPath(t,n,r,i,this);a.push(s)})),a},kr.prototype.getAdvanceWidth=function(e,t,n){return this.forEachGlyph(e,0,0,t,n,(function(){}))},kr.prototype.draw=function(e,t,n,r,i,a){this.getPath(t,n,r,i,a).draw(e)},kr.prototype.drawPoints=function(e,t,n,r,i,a){this.forEachGlyph(t,n,r,i,a,(function(t,n,r,i){t.drawPoints(e,n,r,i)}))},kr.prototype.drawMetrics=function(e,t,n,r,i,a){this.forEachGlyph(t,n,r,i,a,(function(t,n,r,i){t.drawMetrics(e,n,r,i)}))},kr.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},kr.prototype.validate=function(){var e=this;function t(t){var n=e.getEnglishName(t);n&&n.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},kr.prototype.toTables=function(){return dct.fontToTable(this)},kr.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},kr.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e[r];return t},kr.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),n=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+n+".otf";var r=this.toArrayBuffer();if(mct())if(window.URL=window.URL||window.webkitURL,window.URL){var i=new DataView(r),a=new Blob([i],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=e;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=OA(),h=gct(r);l.writeFileSync(e,h)}},kr.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},kr.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},kr.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Oht={make:Iht,parse:Dht},Lht=function(){return{coverage:this.parsePointer(pt.coverage),attachPoints:this.parseList(pt.pointer(pt.uShortList))}},kht=function(){var e=this.parseUShort();return Mn.argument(1===e||2===e||3===e,"Unsupported CaretValue table version."),1===e?{coordinate:this.parseShort()}:2===e?{pointindex:this.parseShort()}:3===e?{coordinate:this.parseShort()}:void 0},Fht=function(){return this.parseList(pt.pointer(kht))},Nht=function(){return{coverage:this.parsePointer(pt.coverage),ligGlyphs:this.parseList(pt.pointer(Fht))}},Bht=function(){return this.parseUShort(),this.parseList(pt.pointer(pt.coverage))};function Uht(e,t){var n=new pt(e,t=t||0),r=n.parseVersion(1);Mn.argument(1===r||1.2===r||1.3===r,"Unsupported GDEF table version.");var i={version:r,classDef:n.parsePointer(pt.classDef),attachList:n.parsePointer(Lht),ligCaretList:n.parsePointer(Nht),markAttachClassDef:n.parsePointer(pt.classDef)};return r>=1.2&&(i.markGlyphSets=n.parsePointer(Bht)),i}var Hht={parse:Uht},El=new Array(10);function Vht(e,t){var n=new pt(e,t=t||0),r=n.parseVersion(1);return Mn.argument(1===r||1.1===r,"Unsupported GPOS table version "+r),1===r?{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(El)}:{version:r,scripts:n.parseScriptList(),features:n.parseFeatureList(),lookups:n.parseLookupList(El),variations:n.parseFeatureVariationsList()}}El[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(pt.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(pt.coverage),values:this.parseValueRecordList()}:void Mn.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},El[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();Mn.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var n=this.parsePointer(pt.coverage),r=this.parseUShort(),i=this.parseUShort();if(1===t)return{posFormat:t,coverage:n,valueFormat1:r,valueFormat2:i,pairSets:this.parseList(pt.pointer(pt.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(r),value2:this.parseValueRecord(i)}}))))};if(2===t){var a=this.parsePointer(pt.classDef),s=this.parsePointer(pt.classDef),o=this.parseUShort(),l=this.parseUShort();return{posFormat:t,coverage:n,valueFormat1:r,valueFormat2:i,classDef1:a,classDef2:s,class1Count:o,class2Count:l,classRecords:this.parseList(o,pt.list(l,(function(){return{value1:this.parseValueRecord(r),value2:this.parseValueRecord(i)}})))}}},El[3]=function(){return{error:"GPOS Lookup 3 not supported"}},El[4]=function(){return{error:"GPOS Lookup 4 not supported"}},El[5]=function(){return{error:"GPOS Lookup 5 not supported"}},El[6]=function(){return{error:"GPOS Lookup 6 not supported"}},El[7]=function(){return{error:"GPOS Lookup 7 not supported"}},El[8]=function(){return{error:"GPOS Lookup 8 not supported"}},El[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var zht=new Array(10);function qht(e){return new Qt.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Qt.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Qt.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Qt.LookupList(e.lookups,zht)}])}var Ght={parse:Vht,make:qht};function Wht(e){var t={};e.skip("uShort");var n=e.parseUShort();Mn.argument(0===n,"Unsupported kern sub-table version."),e.skip("uShort",2);var r=e.parseUShort();e.skip("uShort",3);for(var i=0;i<r;i+=1){var a=e.parseUShort(),s=e.parseUShort(),o=e.parseShort();t[a+","+s]=o}return t}function jht(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var n=255&e.parseUShort();if(e.skip("uShort"),0===n){var r=e.parseUShort();e.skip("uShort",3);for(var i=0;i<r;i+=1){var a=e.parseUShort(),s=e.parseUShort(),o=e.parseShort();t[a+","+s]=o}}return t}function Xht(e,t){var n=new an.Parser(e,t),r=n.parseUShort();if(0===r)return Wht(n);if(1===r)return jht(n);throw new Error("Unsupported kern table version ("+r+").")}var Yht={parse:Xht};function $ht(e,t,n,r){for(var i=new an.Parser(e,t),a=r?i.parseUShort:i.parseULong,s=[],o=0;o<n+1;o+=1){var l=a.call(i);r&&(l*=2),s.push(l)}return s}var Zht={parse:$ht};function yhe(e,t){for(var n=[],r=12,i=0;i<t;i+=1){var a=an.getTag(e,r),s=an.getULong(e,r+4),o=an.getULong(e,r+8),l=an.getULong(e,r+12);n.push({tag:a,checksum:s,offset:o,length:l,compression:!1}),r+=16}return n}function Kht(e,t){for(var n=[],r=44,i=0;i<t;i+=1){var a=an.getTag(e,r),s=an.getULong(e,r+4),o=an.getULong(e,r+8),l=an.getULong(e,r+12),h=void 0;h=o<l&&"WOFF",n.push({tag:a,offset:s,compression:h,compressedLength:o,length:l}),r+=20}return n}function Pi(e,t){if("WOFF"===t.compression){var n=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),r=new Uint8Array(t.length);if(Got(n,r),r.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(r.buffer,0),offset:0}}return{data:e,offset:t.offset}}function hfe(e,t){t=null==t?{}:t;var n,r,i,a=new kr({empty:!0}),s=new DataView(e,0),o=[],l=an.getTag(s,0);if(l===String.fromCharCode(0,1,0,0)||"true"===l||"typ1"===l)a.outlinesFormat="truetype",o=yhe(s,i=an.getUShort(s,4));else if("OTTO"===l)a.outlinesFormat="cff",o=yhe(s,i=an.getUShort(s,4));else{if("wOFF"!==l)throw new Error("Unsupported OpenType signature "+l);var h=an.getTag(s,4);if(h===String.fromCharCode(0,1,0,0))a.outlinesFormat="truetype";else{if("OTTO"!==h)throw new Error("Unsupported OpenType flavor "+l);a.outlinesFormat="cff"}o=Kht(s,i=an.getUShort(s,12))}for(var u,c,d,p,f,m,g,v,y,x,b,_,w=0;w<i;w+=1){var S=o[w],M=void 0;switch(S.tag){case"cmap":M=Pi(s,S),a.tables.cmap=Ahe.parse(M.data,M.offset),a.encoding=new Rhe(a.tables.cmap);break;case"cvt ":M=Pi(s,S),_=new an.Parser(M.data,M.offset),a.tables.cvt=_.parseShortList(S.length/2);break;case"fvar":c=S;break;case"fpgm":M=Pi(s,S),_=new an.Parser(M.data,M.offset),a.tables.fpgm=_.parseByteList(S.length);break;case"head":M=Pi(s,S),a.tables.head=Uhe.parse(M.data,M.offset),a.unitsPerEm=a.tables.head.unitsPerEm,n=a.tables.head.indexToLocFormat;break;case"hhea":M=Pi(s,S),a.tables.hhea=Hhe.parse(M.data,M.offset),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":g=S;break;case"ltag":M=Pi(s,S),r=zhe.parse(M.data,M.offset);break;case"maxp":M=Pi(s,S),a.tables.maxp=qhe.parse(M.data,M.offset),a.numGlyphs=a.tables.maxp.numGlyphs;break;case"name":x=S;break;case"OS/2":M=Pi(s,S),a.tables.os2=KF.parse(M.data,M.offset);break;case"post":M=Pi(s,S),a.tables.post=$he.parse(M.data,M.offset),a.glyphNames=new rN(a.tables.post);break;case"prep":M=Pi(s,S),_=new an.Parser(M.data,M.offset),a.tables.prep=_.parseByteList(S.length);break;case"glyf":d=S;break;case"loca":y=S;break;case"CFF ":u=S;break;case"kern":v=S;break;case"GDEF":p=S;break;case"GPOS":f=S;break;case"GSUB":m=S;break;case"meta":b=S}}var T=Pi(s,x);if(a.tables.name=Yhe.parse(T.data,T.offset,r),a.names=a.tables.name,d&&y){var E=0===n,A=Pi(s,y),C=Zht.parse(A.data,A.offset,a.numGlyphs,E),P=Pi(s,d);a.glyphs=nfe.parse(P.data,P.offset,C,a,t)}else{if(!u)throw new Error("Font doesn't contain TrueType or CFF outlines.");var I=Pi(s,u);Bhe.parse(I.data,I.offset,a,t)}var R=Pi(s,g);if(Vhe.parse(a,R.data,R.offset,a.numberOfHMetrics,a.numGlyphs,a.glyphs,t),hlt(a,t),v){var L=Pi(s,v);a.kerningPairs=Yht.parse(L.data,L.offset)}else a.kerningPairs={};if(p){var O=Pi(s,p);a.tables.gdef=Hht.parse(O.data,O.offset)}if(f){var D=Pi(s,f);a.tables.gpos=Ght.parse(D.data,D.offset),a.position.init()}if(m){var k=Pi(s,m);a.tables.gsub=Zhe.parse(k.data,k.offset)}if(c){var N=Pi(s,c);a.tables.fvar=Oht.parse(N.data,N.offset,a.names)}if(b){var F=Pi(s,b);a.tables.meta=Khe.parse(F.data,F.offset),a.metas=a.tables.meta}return a}var $A=class{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){let n=[],r=Jht(e,t,this.data);for(let e=0,t=r.length;e<t;e++)n.push(...r[e].toShapes());return n}};function Jht(e,t,n){let r=Array.from(e),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,s=[],o=0,l=0;for(let e=0;e<r.length;e++){let t=r[e];if("\n"===t)o=0,l-=a;else{let e=Qht(t,i,o,l,n);o+=e.offsetX,s.push(e.path)}}return s}function Qht(e,t,n,r,i){let a=i.glyphs[e]||i.glyphs["?"];if(!a)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".");let s,o,l,h,u,c,d,p,f=new Md;if(a.o){let e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let i=0,a=e.length;i<a;)switch(e[i++]){case"m":s=e[i++]*t+n,o=e[i++]*t+r,f.moveTo(s,o);break;case"l":s=e[i++]*t+n,o=e[i++]*t+r,f.lineTo(s,o);break;case"q":l=e[i++]*t+n,h=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,f.quadraticCurveTo(u,c,l,h);break;case"b":l=e[i++]*t+n,h=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,d=e[i++]*t+n,p=e[i++]*t+r,f.bezierCurveTo(u,c,d,p,l,h)}}return{offsetX:a.ha*t,path:f}}var _x="0.5.0",ffe="VERSION",eft=()=>window.localStorage.getItem(ffe),tft=()=>{window.localStorage.setItem(ffe,_x)},dfe=()=>eft()!==_x&&(tft(),!0),s0=class{constructor(){this.DATABASE_NAME="x_viewer",this.DEFAULT_TABLES=[{name:"dxf_data",options:{keyPath:"dxfDataId",autoIncrement:!1}},{name:"fonts",options:{keyPath:"fileName",autoIncrement:!0}}],this.db=void 0,this.tables=this.DEFAULT_TABLES}static instance(){return s0._instance||(s0._instance=new s0),s0._instance}setTables(e){this.tables=e}getTables(){return this.tables}getDatabase(){return Et(this,null,(function*(){let e=yield this.getDB(this.DATABASE_NAME);return this.db||(e.close(),dfe()&&(yield this.deleteDataBase(this.DATABASE_NAME)),e=yield this.getUpgradedDB(e)),e.onclose=()=>{this.db=void 0,fe.debug(`[DB] Db ${e.name} is closed.`)},e.onerror=t=>{this.db=void 0,fe.debug(`[DB] Db ${e.name} encountered error.`,t)},e.onabort=t=>{this.db=void 0,fe.debug(`[DB] Db ${e.name} aborted.`,t)},e.onversionchange=e=>{fe.debug("onversionchange",e)},this.db=e,Promise.resolve(this.db)}))}closeDatabase(){this.db&&this.db.close()}deleteDataBase(e){return new Promise(((t,n)=>{let r=window.indexedDB.deleteDatabase(e);r.onerror=e=>{fe.debug(e),n(e)},r.onsuccess=n=>{let r=n.target;fe.debug(`[DB] Db ${e} delete old version ${n.oldVersion}.`),t(r)}}))}getDB(e){return Et(this,null,(function*(){return new Promise(((t,n)=>{let r=window.indexedDB.open(e);r.onerror=n,r.onsuccess=e=>{let n=e.target.result;fe.debug(`[DB] Db ${n.name} opened (version ${n.version}).`),t(n)}}))}))}getUpgradedDB(e){return Et(this,null,(function*(){return new Promise(((t,n)=>{fe.debug(`[DB] Upgrading db ${e.name} (version ${e.version})`);let r=window.indexedDB.open(e.name,e.version+1);r.onerror=n,r.onblocked=e=>{fe.debug("onblocked",e)},r.onupgradeneeded=e=>{e.target.transaction.oncomplete=()=>{fe.debug(`[DB] Upgrade is done (new version: ${t.version}).`)};let t=e.target.result,n=[];for(let e=0;e<this.tables.length;++e){let r=this.tables[e];if(!t.objectStoreNames.contains(r.name)){fe.debug(`[DB] Creating table ${r.name}...`);let e=this.createTable(t,r.name,r.options,r.indexArray);n.push(e)}}n.length>0&&Promise.all(n).then((()=>{fe.debug(`[DB] All(${n.length}) tables created.`)}))},r.onsuccess=e=>{let n=e.target.result;fe.debug(`[DB] Db ${n.name} opened (version ${n.version}).`),t(n)}}))}))}createTable(e,t,n,r){return Et(this,null,(function*(){return new Promise((i=>{let a=e.createObjectStore(t,n);r&&r.forEach((e=>{a.createIndex(e.name,e.fields,{unique:e.unique})})),fe.debug(`[DB] Table ${t} created.`),i(e)}))}))}},pi=s0;pi._instance=void 0;var a0=class{constructor(){if(this.db=void 0,this.isCreatingTable=!1,-1===pi.instance().getTables().findIndex((e=>e.name===this.tableName())))throw new Error(`Failed to find table '${this.tableName()}' from indexeddb!`)}tableName(){throw new Error("Derived class have to override 'tableName', and set a proper table name!")}add(e,t,n){let r=this.tableName();pi.instance().getDatabase().then((i=>{let a=i.transaction([r],"readwrite").objectStore(r).add(e);a.onsuccess=t,a.onerror=n})).finally((()=>{pi.instance().closeDatabase()})).catch((e=>{n&&n(e)}))}save(e,t,n){let r=this.tableName();pi.instance().getDatabase().then((i=>{let a=i.transaction([r],"readwrite").objectStore(r).put(e);a.onsuccess=t,a.onerror=n})).finally((()=>{pi.instance().closeDatabase()}))}delete(e,t,n){let r=this.tableName();pi.instance().getDatabase().then((i=>{let a=i.transaction([r],"readwrite").objectStore(r).delete(e);a.onsuccess=t,a.onerror=n})).finally((()=>{pi.instance().closeDatabase()}))}update(){pi.instance().getDatabase().then((()=>{}))}query(e,t){let n=this.tableName();pi.instance().getDatabase().then((r=>{let i=r.transaction([n],"readonly").objectStore(n).openCursor();i.onsuccess=t=>{let n=t.target.result;n&&n.continue(),e&&e(n)},i.onerror=t})).finally((()=>{pi.instance().closeDatabase()}))}queryByIndex(e,t,n,r){let i=this.tableName();pi.instance().getDatabase().then((a=>{let s=a.transaction([i],"readonly").objectStore(i).index(e).get(t);s.onerror=r,s.onsuccess=function(e){var t;let r=null==(t=e.target)?void 0:t.result;n&&n(r)}})).finally((()=>{pi.instance().closeDatabase()}))}queryAll(e,t){let n=this.tableName();pi.instance().getDatabase().then((r=>{let i=r.transaction([n],"readonly").objectStore(n).getAll();i.onsuccess=t=>{e&&e(i.result)},i.onerror=t})).finally((()=>{pi.instance().closeDatabase()}))}clearAll(e,t){let n=this.tableName();pi.instance().getDatabase().then((r=>{let i=r.transaction([n],"readwrite").objectStore(n).clear();i.onsuccess=t=>{e&&e(t)},i.onerror=e=>{t&&t(e)}})).finally((()=>{pi.instance().closeDatabase()}))}},o0=class extends a0{tableName(){return"dxf_data"}static instance(){return o0._instance||(o0._instance=new o0),o0._instance}query(e,t,n){let r=[],i=this.tableName();pi.instance().getDatabase().then((a=>{let s=a.transaction([i],"readonly").objectStore(i).get(e);s.onerror=e=>{n&&n(e),fe.info("[DxfDataTable] Failed to query !",e)},s.onsuccess=()=>{s.result&&r.push(s.result),t&&t(r)}})).finally((()=>{pi.instance().closeDatabase()}))}},l0=o0;l0._instance=void 0;var jd=class extends a0{tableName(){return"fonts"}static instance(){return jd._instance||(jd._instance=new jd),jd._instance}query(e){let t;return new Promise(((n,r)=>{super.query((r=>{r?!r.value||r.value.fileName!==e||(t=r.value):n(t)}),(e=>{r(e)}))}))}queryAll(){return Et(this,null,(function*(){return new Promise(((e,t)=>{ZU(jd.prototype,this,"queryAll").call(this,(t=>{e(t)}),(e=>{t(e)}))}))}))}},du=jd;du._instance=void 0;var c0=class extends $A{constructor(e,t){super(t),this.info="",this.orientation=0,this.baseUp=0,this.baseDown=0,this.fileHeader="",this.fileVersion="",this.order=0,this.unsupportedChars={},this.fileName=e}addUnsupportedChar(e){this.unsupportedChars[e]||(this.unsupportedChars[e]=0),this.unsupportedChars[e]++}getFontFile(){return{order:this.order,data:this.data,info:this.info,orientation:this.orientation,baseUp:this.baseUp,baseDown:this.baseDown,fileName:this.fileName,fileHeader:this.fileHeader,fileVersion:this.fileVersion}}setFontFile(e){this.fileName=e.fileName,this.data=e.data,this.info=e.info,this.order=e.order,this.orientation=e.orientation,this.baseUp=e.baseUp,this.baseDown=e.baseDown,this.fileHeader=e.fileHeader,this.fileVersion=e.fileVersion}setFontDataToIndexedDb(){return Et(this,null,(function*(){let e=this.getFontFile();return new Promise(((t,n)=>{du.instance().save(e,(()=>{console.log(`[FontFile] Saved '${this.fileName}' (${this.fileHeader}) to indexedDb`),t()}),(e=>n(`[FontFile] Failed to save '${this.fileName}' (${this.fileHeader}) to indexedDb! ${e}`)))}))}))}getFontDataByIndexedDb(){return Et(this,null,(function*(){return du.instance().query(this.fileName)}))}releaseFontData(){this.data={}}},Nh=class extends c0{constructor(e,t){super(e,t),this.reversed=!1,t instanceof ArrayBuffer?this.data=this.parseTTF(t):t.fileName?this.setFontFile(t):this.data=t,this.type="MeshFont"}generateShapes(e,t){return super.generateShapes(e,t)}getCharShape(e,t){var n;let r=null==(n=pfe(e,t,0,0,this.data))?void 0:n.path;return r||this.addUnsupportedChar(e),r}getNotFoundTextShape(e){var t;return null==(t=pfe("?",e,0,0,this.data))?void 0:t.path}parseTTF(e){function t(e){let t,n=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],n.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));let r=[];return n.forEach((function(e){let t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};r.push(t);for(let t=e.length-1;t>0;t--){let n=e[t],i={type:n.type};void 0!==n.x2&&void 0!==n.y2?(i.x1=n.x2,i.y1=n.y2,i.x2=n.x1,i.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(i.x1=n.x1,i.y1=n.y1),i.x=e[t-1].x,i.y=e[t-1].y,r.push(i)}})),r}return function(e,n){let r=Math.round,i={},a=1e5/(72*(e.unitsPerEm||2048)),s=e.encoding.cmap.glyphIndexMap,o=Object.keys(s);for(let l=0;l<o.length;l++){let h=o[l],u=e.glyphs.glyphs[s[h]];if(void 0!==h){let e={ha:r(u.advanceWidth*a),x_min:r(u.xMin*a),x_max:r(u.xMax*a),o:""};n&&(u.path.commands=t(u.path.commands)),u.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=r(t.x*a)+" "+r(t.y*a)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=r(t.x1*a)+" "+r(t.y1*a)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=r(t.x2*a)+" "+r(t.y2*a)+" ")})),i[String.fromCodePoint(u.unicode)]=e}}return{glyphs:i,familyName:e.getEnglishName("fullName"),ascender:r(e.ascender*a),descender:r(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(hfe(e),this.reversed)}};function pfe(e,t,n,r,i){let a=i.glyphs[e];if(!a)return;let s,o,l,h,u,c,d,p,f=new Md;if(a.o){let e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let i=0,a=e.length;i<a;)switch(e[i++]){case"m":s=e[i++]*t+n,o=e[i++]*t+r,f.moveTo(s,o);break;case"l":s=e[i++]*t+n,o=e[i++]*t+r,f.lineTo(s,o);break;case"q":l=e[i++]*t+n,h=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,f.quadraticCurveTo(u,c,l,h);break;case"b":l=e[i++]*t+n,h=e[i++]*t+r,u=e[i++]*t+n,c=e[i++]*t+r,d=e[i++]*t+n,p=e[i++]*t+r,f.bezierCurveTo(u,c,d,p,l,h)}}return{offsetX:a.ha*t,path:f}}var ZA={130:[[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],131:[[[3,0],[7,0]],[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],132:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],133:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[3,9.5],[7,9.5]]],134:[[[3,0],[7,0]],[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],135:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],136:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[3,9.5],[7,9.5]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],178:[[[1.142,9.285],[1.142,9.428],[1.285,9.714],[1.428,9.857],[1.714,10],[2.285,10],[2.571,9.857],[2.714,9.714],[2.857,9.428],[2.857,9.142],[2.714,8.857],[2.428,8.428],[1,7],[3,7]]],8960:[[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]],[[0,0],[8,8]]],20393:[[[0,0],[0,6.666]],[[0,4.761],[1.428,6.19],[2.38,6.666],[3.809,6.666],[4.761,6.19],[5.238,4.761],[5.238,0]],[[5.238,4.761],[6.666,6.19],[7.619,6.666],[9.047,6.666],[10,6.19],[10.476,4.761],[10.476,0]],[[11.142,9.285],[11.142,9.428],[11.285,9.714],[11.428,9.857],[11.714,10],[12.285,10],[12.571,9.857],[12.714,9.714],[12.857,9.428],[12.857,9.142],[12.714,8.857],[12.428,8.428],[11,7],[13,7]]],41123:[],55714:[[[2,5.9],[2.6,6.1],[3.4,7],[3.4,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],55970:[[[2.3,5.6],[2.3,5.9],[2.6,6.4],[2.9,6.7],[3.4,7],[4.6,7],[5.1,6.7],[5.4,6.4],[5.7,5.9],[5.7,5.3],[5.4,4.7],[4.9,3.9],[2,1],[6,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56226:[[[2.6,7],[5.7,7],[4,4.7],[4.9,4.7],[5.4,4.4],[5.7,4.1],[6,3.3],[6,2.7],[5.7,1.9],[5.1,1.3],[4.3,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56482:[[[4.9,7],[2,3],[6.3,3]],[[4.9,7],[4.9,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56738:[[[5.4,7],[2.6,7],[2.3,4.4],[2.6,4.7],[3.4,5],[4.3,5],[5.1,4.7],[5.7,4.1],[6,3.3],[6,2.7],[5.7,1.9],[5.1,1.3],[4.3,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56994:[[[5.4,6.1],[5.1,6.7],[4.3,7],[3.7,7],[2.9,6.7],[2.3,5.9],[2,4.4],[2,3],[2.3,1.9],[2.9,1.3],[3.7,1],[4,1],[4.9,1.3],[5.4,1.9],[5.7,2.7],[5.7,3],[5.4,3.9],[4.9,4.4],[4,4.7],[3.7,4.7],[2.9,4.4],[2.3,3.9],[2,3]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57250:[[[2,7],[6,7],[3.1,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57506:[[[3.4,7],[2.6,6.7],[2.3,6.1],[2.3,5.6],[2.6,5],[3.1,4.7],[4.3,4.4],[5.1,4.1],[5.7,3.6],[6,3],[6,2.1],[5.7,1.6],[5.4,1.3],[4.6,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1],[2,3],[2.3,3.6],[2.9,4.1],[3.7,4.4],[4.9,4.7],[5.4,5],[5.7,5.6],[5.7,6.1],[5.4,6.7],[4.6,7],[3.4,7]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57762:[[[5.7,5],[5.4,4.1],[4.9,3.6],[4,3.3],[3.7,3.3],[2.9,3.6],[2.3,4.1],[2,5],[2,5.3],[2.3,6.1],[2.9,6.7],[3.7,7],[4,7],[4.9,6.7],[5.4,6.1],[5.7,5],[5.7,3.6],[5.4,2.1],[4.9,1.3],[4,1],[3.4,1],[2.6,1.3],[2.3,1.9]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],60070:[[[0,6],[10,6],[10,4]]],60326:[[[0,7],[0,5],[10,5]]]},nft=!1,rft=new Te,pu=class extends ki{constructor(e,t){super(),this.width=0,this.bounds=new Vr,this.lastPoint=e,this.polylines=t,this.width=this.calcWidth(t)}offset(e){let t=[];for(let n=0;n<this.polylines.length;n++){let r=this.polylines[n],i=[];for(let t=0;t<r.length;t++){let n=r[t];i.push(n.clone().add(e))}t.push(i)}return new pu(this.lastPoint,t)}transform(e){let t=[];for(let n=0;n<this.polylines.length;n++){let r=this.polylines[n],i=[];for(let t=0;t<r.length;t++){let n=r[t];i.push(n.clone().applyMatrix3(e))}t.push(i)}return new pu(this.lastPoint.clone().applyMatrix3(e),t)}calcWidth(e){let t=this.bounds;for(let n=0;n<e.length;n++){let r=e[n];for(let e=0;e<r.length;e++){let n=r[e];t.expandByPoint(n)}}let n=t.min.x||0;return(t.max.x||0)-n}toThreeGeometry(){let e=this.polylines;if(nft&&e.length>0){let t=this.bounds.min,n=this.bounds.getSize(rft),r=new Te(t.x,t.y),i=new Te(t.x+n.width,t.y),a=new Te(t.x+n.width,t.y+n.height),s=new Te(t.x,t.y+n.height);e.push([r,i],[i,a],[a,s],[s,r])}let t=[],n=[],r=0,i=new Nt;for(let i=0;i<e.length;i++){let a=e[i];for(let e=0;e<a.length;e++){let i=a[e];t.push(i.x,i.y,0),e===a.length-1||n.push(r,r+1),r++}}return i.setAttribute("position",new Wt(t,3)),i.setIndex(n),i}},KA;function ift(){let e=[[161,169,161,254],[176,247,161,254],[129,160,64,254],[170,254,64,160],[168,169,64,160],[170,175,161,254],[248,254,161,254],[161,167,64,160]],t=new Uint16Array(23940),n=0;for(let[r,i,a,s]of e)for(let e=a;e<=s;e++)if(127!==e)for(let a=r;a<=i;a++)t[n++]=e<<8|a;let r=new TextDecoder("gbk").decode(t);for(KA=new Uint16Array(65536),n=0;n<r.length;n++)KA[r.charCodeAt(n)]=t[n]}function mfe(e){KA||ift();let t=new Uint8Array(2*e.length),n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i<128)t[n++]=i;else{let e=KA[i];t[n++]=255&e,t[n++]=e>>8}}return t.subarray(0,n)}var sft="åé¿åæ¨åååççè¼ç®è¾ç¢ç±ééæ°¨å®ä¿ºææå²¸èºæ¡è®æçå¹æç¬ç¿±è¢å²å¥¥ææ¾³è­ææå­å§ç¬å«ç¤å·´æè·é¶æèåé¸ç½¢ç¸ç½æç¾æä½°è´¥æç¨æç­æ¬æ³è¬é¢æ¿çæ®æä¼´ç£ååç»é¦å¸®æ¢æ¦èç»æ£ç£èéåè°¤èèåè¤å¥èé¹ä¿å ¡é¥±å®æ±æ¥æ´è±¹é²çæ¯ç¢æ²ååè¾èè´é¡åçå¤æ«çè¢«å¥è¯æ¬ç¬¨å´©ç»·ç­æ³µè¹¦è¿¸é¼é¼»æ¯éç¬å½¼ç¢§èè½æ¯æ¯æ¯å¸åºç¹é­æå¼å¿è¾å£èé¿éé­è¾¹ç¼è´¬æä¾¿ååè¾¨è¾©è¾«éæ å½ªèè¡¨é³æå«çªå½¬ææ¿æ»¨å®¾æåµå°æä¸ç§é¥¼ç³çå¹¶ç»è æ­æ¨éµæ³¢ååæéç®ä¼¯å¸è¶èèæ¸¤æ³é©³æååºè¡¥å ä¸å¸æ­¥ç°¿é¨ææ¦çè£ææè´¢ç¬è¸©éå½©èè¡é¤åèæ®æ­æ¨ç¿èè±ä»æ²§èæç³æ§½æ¹èåç­ä¾§åæµå±è¹­æåè¬è¶æ¥ç¢´æ½å¯å²å·®è¯§ææ´è±ºææºèé¦è°ç¼ é²äº§éé¢¤æçåºå°å¸¸é¿å¿è åæçå±å¡è¶æéæå²æ½®å·¢åµçè½¦æ¯æ¤æ£å½»æ¾é´è£è¾°å°æ¨å¿±æ²éè¶è¡¬æç§°åæ©æåä¹ç¨æ©æ¾è¯æ¿ééªç§¤åç´æåæ± è¿å¼é©°è»é½¿ä¾å°ºèµ¤ç¿æ¥ç½åå²è«å´å® æ½é¬ç´è¸ç¨ æç­¹ä»ç»¸çä¸è­ååºæ©±å¨èºééæ»é¤æ¥ç¡å¨çæè§¦å¤æ£å·ç©¿æ¤½ä¼ è¹åä¸²ç®çªå¹¢åºé¯åå¹çæ¶é¤åæ¥æ¤¿éåæ·³çº¯è ¢æ³ç»°çµè¨ç£éè¾æç·è¯æ­¤åºèµæ¬¡èªè±å±åä»ä¸åç²éç°ä¿è¹¿ç¯¡çªæ§å´å¬èçç²¹æ·¬ç¿ æå­å¯¸ç£æ®ææªæ«éæ­è¾¾ç­ç©æå¤§åæ­¹å£æ´å¸¦æ®ä»£è´·è¢å¾é®æ è½æä¸¹åé¸æ¸èæ¦æ°®ä½æ®æ·¡è¯å¼¹èå½æ¡åè¡æ¡£åæ£è¹åå²ç¥·å¯¼å°ç¨»æ¼éçå¾·å¾çè¹¬ç¯ç»ç­çªå³éå ¤ä½æ»´è¿ªæç¬çæ¶¤ç¿å«¡æµåºå°èç¬¬å¸å¼éç¼é¢ ææ»ç¢ç¹å¸éå«çµä½ç¸åºæ¦å¥ æ·æ®¿ç¢å¼éååæåéè°è·ç¹ç¢è¶è¿­è°å ä¸ç¯å®éé¡¶é¼é­å®è®¢ä¸¢ä¸å¬è£æå¨æ ä¾æ«å»æ´åææé¡è±éçé½ç£æ¯çç¬è¯»å µç¹èµæéèåº¦æ¸¡å¦ç«¯ç­é»æ®µæ­ç¼å åéå¯¹å¢©å¨è¹²æ¦é¡¿å¤éç¾éæåå¤å¤ºåèº²æµè·ºèµåæ°å è¾å³¨é¹ä¿é¢è®¹å¨¥æ¶åæ¼ééé¥¿æ©èå¿è³å°é¥µæ´±äºè´°åç½ç­ä¼ä¹éæ³çè©å¸çªç¿»æ¨ç¾éç¹å¡ç¦åè¿èè´©ç¯é¥­æ³åè³æ¹èªæ¿é²å¦¨ä»¿è®¿çººæ¾è²éå¡é£è¥åªè¯½å èºåºæ²¸è´¹è¬éå©æ°åçº·åçæ±¾ç²å¥ä»½å¿¿æ¤ç²ªä¸°å°æ«èå³°éé£ç¯ç½é¢å¯ç¼è®½å¥å¤ä½å¦å¤«æ·è¤å­µæ¶æè¾å¹æ°ç¬¦ä¼ä¿ææµ®æ¶ªç¦è¢±å¼ç«æè¾ä¿¯éæ§è¯èåºèèµ´å¯è¦èµå¤åä»éç¶è¹è´å¯è®£éå¦ç¼åå¶åè¯¥æ¹æ¦éçæºå¹²çææç«¿èèµ¶æç§æ¢èµ£ååé¢ç¼¸èçº²å²æ¸¯æ ç¯çé«èç¾ç³æéç¨¿åå¥æ­ææé¸½è³çå²é©èæ ¼è¤ééé¬ä¸ªåç»æ ¹è·èæ´åºç¾¹åè¿æ¢å·¥æ»åæ­é¾ä¾èº¬å¬å®«å¼å·©æ±æ±è´¡å±é©å¾æ²èçå¢æè´­å¤è¾èåç®ä¼°æ²½å­¤å§é¼å¤èéª¨è°·è¡æé¡¾åºéå®çåå¯¡æè¤ä¹ææªæ£ºå³å®å è§ç®¡é¦ç½æ¯çè´¯åå¹¿éç°è§å­ç¡å½é¾éºè½¨é¬¼è¯¡ç¸æ¡æè·ªè´µå½è¾æ»æ£éé­å½æè£¹è¿åéª¸å­©æµ·æ°¦äº¥å®³éªé£æ¨é¯é©å«æ¶µå¯å½åç½ç¿°æ¼ææ±æ¾æçæ±æ±å¤¯æ­èªå£åè±ªæ¯«éå¥½èå·æµ©åµåè·èæ ¸ç¦¾åä½åçè²éæ²³æ¶¸èµ«è¤é¹¤è´ºå¿é»çå¾ç æ¨å¼äº¨æ¨ªè¡¡æè½°åçè¹é¸¿æ´ªå®å¼çº¢åä¾¯ç´å¼åååå¼ä¹å¿½çå£¶è«è¡è´çç³æ¹å¼§èå¬æ¤äºæ²ªæ·è±ååç¾æ»ç»ååè¯æ§å¾ææ·®åæ¬¢ç¯æ¡è¿ç¼æ¢æ£å¤çªè±¢çæ¶£å®¦å¹»èæé»ç£ºèç°§çå°æ¶çæå¹æè°ç°æ¥è¾å¾½æ¢èåæ¯ææ§åæ æ¦è´¿ç§½ä¼ç©æ±è®³è¯²ç»è¤æå©é­æµæ··è±æ´»ä¼ç«è·ææéè´§ç¥¸å»å¾åºæºç¸ç¨½ç§¯ç®èé¥¥è¿¹æ¿è®¥é¸¡å§¬ç»©ç¼åææ£è¾ç±éåæ¥ç¾æ±²å³å«çº§æ¤å èå·±èæåå­£ä¼ç¥­åæ¸æµå¯å¯è®¡è®°æ¢å¿éç»§çºªåæ·å¤¹ä½³å®¶å èé¢è´¾ç²é¾åç¨¼ä»·æ¶é©¾å«æ­¼çåå°ç¬ºé´çå¼è©è°å¥¸ç¼è§æ£æ¬ç¢±ç¡·æ£æ¡ç®ä¿­åªåèæ§é´è·µè´±è§é®ç®­ä»¶å¥è°åé¥¯æ¸æºæ¶§å»ºåµå§å°æµæ±çèæ¡¨å¥è®²å é±éèæ¤ç¤ç¦è¶äº¤éæµéªå¨å¼æé°ç«ä¾¥èç¡è§é¥ºç¼´ç»å¿æéµè½¿è¾å«çªæ­æ¥çç§¸è¡é¶æªå«èèçæ¶é²¸äº¬æç²¾ç²³ç»äºè­¦æ¯é¢éå¢æ¬éå¾çéç«ç«åç¯çªæªç©¶çº çé­ä¹ç¸ä¹éå©ææ§è¼èåå°±çé æçç½å±é©¹èå±åç©ä¸¾æ²®èææ®å·¨å·è·è¸é¯ä¿±å¥æ§ç¬å§æé¹å¨å¦ç·å·ç»¢ææ«ææåçµæ¡æ°æ·ç«ç«­æ´ç»è§£å§æèè¥çåä»ç¥è¯«å±å·¾ç­æ¤éä»æ´¥è¥ç´§é¦ä»è°¨è¿é³æç¦è¿ç¬æµ¸å°½å²èå¢è§å³è¯ç»åèé§ååå³»ä¿ç«£æµé¡éªååå¡å¯å¼æ©æ¥·å¯æ¨åå ªååç çåº·æ·ç³ ææäº¢çèæ·ç¤é å·èæ¯æ£µç£é¢ç§å£³å³å¯æ¸´åå»å®¢è¯¾è¯åå¦æ³åå­ç©ºæå­æ§æ å£æ£å¯æ¯å­çªè¦é·åºè£¤å¤¸å®æè·¨è¯åç­·ä¾©å¿«å®½æ¬¾å¡ç­çæ¡ç¿ç¶æ·åµäºçå²¿çª¥èµå¥é­åé¦æ§æºå¤ææå°æ¬æ©å»éåæåè¡èè¾£å¦è±æ¥èµèå©ªæ æ¦ç¯®éå°æ¾è°°æ½è§æç¼çæ»¥çæ¦ç¼å»éææµªæå³ç¢èä½¬å§¥éªçæ¶åä¹é·é­è¾ç£ç´¯å¡åæèç±»æ³ªæ£±æ¥å·åæ¢¨çé»ç¯±ç¸ç¦»æ¼çæéé²¤ç¤¼èèåæ ä¸½åå±ç ¾åå©åä¾ä¿ç¢ç«ç²æ²¥é¶åçå©ä¿©èè²è¿é°å»ææ¶å¸æè¸é¾æç¼ç»ç²®åæ¢ç²±è¯ä¸¤è¾éæ¾äº®è°æ©èåççå¯¥è¾½æ½¦äºæé£å»æåè£çå£çç³æç£·éä¸´é»é³æ·åèµåæç²è±é¶é¾éä¼¶ç¾åçµéµå²­é¢å¦ä»¤æºçæ¦´ç¡«é¦çåç¤æµæ³å­é¾èåç¬¼çª¿éåæ¢éæ¥¼å¨æç¯æ¼éè¦å¢é¢åºçæ³å¤èé²éºç¢é²è·¯èµé¹¿æ½ç¦å½éæ®é©´åéä¾£æå±¥å±¡ç¼èæ°¯å¾çæ»¤ç»¿å³¦æå­ªæ»¦åµä¹±æ ç¥æ¡è½®ä¼¦ä»æ²¦çº¶è®ºèèºç½é»é£ç®©éª¡è£¸è½æ´éªç»å¦éº»çç èé©¬éªåååä¹°éº¦åè¿èçé¦è®æ»¡èæ¼æ¢æ¼«è°©èè«ç²æ°å¿è½ç«èéæ¯çéå¯èåå¸½è²è´¸ä¹ç«ææ¢é¶éç¤æ²¡çåªéæ¯ç¾æ§å¯å¦¹åªé¨é·ä»¬èèæª¬çé°çæ¢¦å­ç¯éé¡ç³è¿·è°å¼¥ç±³ç§è§æ³èå¯å¹æ£ç ç»µåååå¨©ç¼é¢èæçèç§æ¸ºåºå¦èç­æ°æ¿ç¿ææ¯é½æèé¸£é­åå½è°¬æ¸æ¹èæ¨¡èç£¨æ©é­æ¹æ«è«å¢¨é»æ²«æ¼ å¯éè°çææç¡äº©å§æ¯å¢æ®å¹åææ¨ç®ç¦ç§ç©æ¿åªåé é£å¨çº³æ°ä¹å¥¶èå¥åç·é¾åæ èæ¼é¹æ·å¢é¦åå«©è½å¦®éåªæ³¥å°¼æä½ å¿è»éæººè«æå¹´ç¢¾æµæ»å¿µå¨é¿é¸å°¿æèå­½å®ééæ¶æ¨æ çåå®æ§æ³çæ­é®çº½èæµåå¼å¥´åªæå¥³æèçæªæ¦ç³¯è¯ºå¦æ¬§é¸¥æ®´èåå¶æ²¤åªè¶´ç¬å¸æç¶ææçå¾æ¹æ´¾ææ½çç£ç¼çå¤åä¹åºæèªèæåå¨ç®è¢è·æ³¡å¸èå¹è£´èµéªéä½©æ²å·çç °æ¨ç¹æ¾å½­è¬æ£ç¡¼ç¯·è¨æé¹æ§ç¢°å¯ç é¹æ¹æ«åçµæ¯å¤è¾ç²ç®å¹çå»å±è­¬ç¯åçéªé£æ¼ç¢ç¥¨æç¥æ¼é¢è´«åèä¹åªè¹èå¹³å­ç¶è¯å±å¡æ³¼é¢å©ç ´é­è¿«ç²åæéºä»èè¡è©è²åæ´åæ®æµ¦è°±æçææ¬ºæ æå¦»ä¸åæ¼ææ²å¶æ£å¥æ­§ç¦å´èé½æç¥ç¥éªèµ·å²ä¹ä¼å¯å¥ç å¨æ°è¿å¼æ±½æ³£è®«ææ´½çµæ¦ééåè¿ç­¾ä»è°¦ä¹¾é»é±é³åæ½é£æµè°´å åµæ¬ æ­æªåèç¾å¢è·å¼ºæ¢æ©é¹æ²ææ¡¥ç§ä¹ä¾¨å·§éæ¬ç¿å³­ä¿çªåèä¸æ¯çªé¦ä¾µäº²ç§¦ç´å¤è¹æç¦½å¯æ²éè½»æ°¢å¾å¿æ¸ææ´æ°°æé¡·è¯·åºç¼ç©·ç§ä¸é±çæ±åéæ³è¶åºèæ²èº¯å±é©±æ¸ åå¨¶é¾è¶£å»åé¢§æéæ³å¨çæ³ç¬å¸åç¼ºçç¸å´é¹æ¦·ç¡®éè£ç¾¤ç¶çåæç¤å£¤æå·è®©é¥¶æ°ç»æ¹ç­å£¬ä»äººå¿é§ä»»è®¤åå¦çº«æä»æ¥æè¸èè£èçæº¶å®¹ç»åææèè¹è åå­ºå¦è¾±ä¹³æ±å¥è¤¥è½¯é®èçéé°æ¶¦è¥å¼±ææ´è¨è®é³å¡èµä¸åä¼æ£æ¡åä¸§æéªæ«å«çè²æ¶©æ£®å§èç æå¹æ²çº±å»å¥çç­æçè«æå±±å ç½è¡«éªéæèµ¡è³åæ±æç¼®å¢ä¼¤åèµæä¸å°è£³æ¢¢æç¨ç§èåºé¶å°å¨éµç»å¥¢èµèèèèµ¦æå°ææ¶ç¤¾è®¾ç ·ç³å»ä¼¸èº«æ·±å¨ ç»ç¥æ²å®¡å©¶çè¾ææ¸å£°çç¥ç²åç»³ççå©èå£å¸å¤±ç®æ½æ¹¿è¯å°¸è±åç³æ¾æ¶ä»é£èå®è¯å²ç¢ä½¿å±é©¶å§å¼ç¤ºå£«ä¸æ¿äºæ­èªéå¿æ¯åå¬éä»ä¾éé¥°æ°å¸æå®¤è§è¯æ¶æé¦å®å¯¿æå®åç¦å½è¬æ¢æ¢³æ®æè¾åèæ·çä¹¦èµå­°çè¯ææç½²èé»é¼ å±æ¯è¿°æ ææç«å¢åº¶æ°æ¼±æå·èæè¡°ç©å¸æ æ´éåç½è°æ°´ç¡ç¨å®ç¬é¡ºèè¯´ç¡æçæ¯æå¶æç§å¸ä¸æ­»èå¯ºå£åä¼ºä¼¼é¥²å·³æ¾è¸æé¢éå®è®¼è¯µæèæå½èé¥ä¿ç´ éç²å³å¡æº¯å®¿è¯èé¸èç®è½ééç»¥é«ç¢å²ç©éé§ç¥å­æç¬èæ¢­åç¼©çç´¢éæå¡ä»å®å¥¹å¡ç­æè¹è¸èèæ¬å°æ³°éå¤ªææ±°åæè´ªç«æ»©åæªç°æ½­è°­è°å¦æ¯¯è¢ç¢³æ¢å¹ç­æ±¤å¡æªå æ£ èåç³åèººæ·è¶ç«ææ¶æ»ç»¦èæ¡éæ·é¶è®¨å¥ç¹è¤è¾ç¼èªæ¢¯åè¸¢éæé¢è¹å¼ä½æ¿åææ¶åå±å¤©æ·»å¡«ç°çæ¬èèææ¡è¿¢çºè·³è´´éå¸åå¬çæ±å»·åäº­åº­æºèéæ¡é®ç³åéå½¤ç«¥æ¡¶æç­ç»çå·æå¤´éå¸ç§çªå¾å¾éæ¶å± åååæ¹å¢æ¨é¢è¿èè¤ªéåå±¯èææè±é¸µéé©®é©¼æ¤­å¦¥æå¾æåèæ´¼å¨ç¦è¢æ­ªå¤è±å¼¯æ¹¾ç©é¡½ä¸¸ç·å®ç¢æ½æçæå®å©ä¸èæ±ªçäº¡æç½å¾æºæå¿å¦å¨å·å¾®å±é¦è¿æ¡å´å¯æä¸ºæ½ç»´èèå§ä¼ä¼ªå°¾çº¬æªèå³çèåé­ä½æ¸­è°å°æ°å«çæ¸©èæé»çº¹å»ç¨³ç´é®å¡ç¿ç®æèæ¶¡çªææ¡å§æ¡æ²å·«åé¨ä¹æ±¡è¯¬å±æ èæ¢§å¾å´æ¯æ­¦äºæåèä¼ä¾®åæé¾æ¤ç©å¿å¡æè¯¯æçæè¥¿ç¡ç½æ°å»å¸é¡çºç¨æ¯å¸æèå¤æçç¯æºªæ±çæªè¢­å¸­ä¹ åª³åé£æ´ç³»éæç»çè¾å£éè¾æå³¡ä¾ ç­ä¸å¦å¤åæé¨åä»é²çº¤å¸è´¤è¡è·é²æ¶å¼¦å«æ¾é©ç°ç®å¿èºé¦ç¾¡å®ªé·éçº¿ç¸å¢é¶é¦ç®±è¥æ¹ä¹¡ç¿ç¥¥è¯¦æ³åäº«é¡¹å··æ©¡ååè±¡è§ç¡éåå®å£éæ¶å®µæ·æå°å­æ ¡èå¸ç¬ææ¥äºæ­èéåææºéªæèè°åæ¢°å¸è¹ææ³æ³»è°¢å±èªè¯éæ¬£è¾æ°å¿»å¿ä¿¡è¡æè¥ç©æºå´ååå½¢é¢è¡éå¹¸ææ§å§åå¶è¸åæ±¹éçä¼ä¿®ç¾æ½åéç§è¢ç»£å¢æéèåé¡»å¾è®¸èéåæ­åºçæ¤çµ®å©¿ç»ªç»­è½©å§å®£æ¬æçéç£ç©ç»é´èå­¦ç©´éªè¡åçå¾ªæ¬è¯¢å¯»é©¯å·¡æ®æ±è®­è®¯éè¿åæ¼é¸¦é¸­åä¸«è½çèå´è¡æ¶¯éåäºè®¶çå½éçæ·¹çä¸¥ç èå²©å»¶è¨é¢éçæ²¿å¥æ©ç¼è¡æ¼è³å °çåç éåå½¦ç°å®´è°éªæ®å¤®é¸¯ç§§æ¨æ¬ä½¯ç¡ç¾æ´é³æ°§ä»°çå»æ ·æ¼¾éè°å¦ç¶æå°§é¥çªè°£å§å¬èè¯è¦èæ¤°åè¶ç·éå¶ä¹é¡µæä¸å¶æ³èå¤æ¶²ä¸å£¹å»æé±ä¾ä¼è¡£é¢å¤·éç§»ä»ªè°çæ²å®å§¨å½æ¤èåå·²ä¹ç£ä»¥èºææéå±¹äº¿å½¹èé¸èç«äº¦è£ææ¯å¿ä¹çæº¢è¯£è®®è°è¯å¼ç¿¼ç¿ç»èµè«å æ®·é³é´å§»åé¶æ·«å¯é¥®å°¹å¼éå°è±æ¨±å©´é¹°åºç¼¨è¹è¤è¥è§èè¿èµ¢çå½±é¢ç¡¬æ åæ¥ä½£èçåº¸éè¸è¹åæ³³æ¶æ°¸æ¿åç¨å¹½ä¼æ å¿§å°¤ç±é®éç¹æ²¹æ¸¸éæåå³ä½éè¯±åå¹¼è¿æ·¤äºçæ¦èæèä½ä¿é¾é±¼ææ¸æ¸éäºå¨±é¨ä¸å±¿ç¦¹å®è¯­ç¾½çåèéåéå»å³ªå¾¡ææ¬²ç±è²èªæµ´å¯è£é¢è±«é©­é¸³æ¸å¤åå£è¢åæ´è¾å­ååç¿æºç¼è¿èæ¿æ¨é¢æ°çº¦è¶è·é¥å²³ç²¤ææ¦éèäºé§åé¨åè¿è´éæéµå­åç ¸ææ ½åç¾å®°è½½åå¨å±ææèµèµèè¬é­ç³å¿è»æ£æ©æ¾¡è¤èºåªé çç¶ç¥è´£æ©åæ³½è´¼æå¢ææ¾èµ æå³æ¸£æ­è½§é¡é¸ç¨æ æ¦¨åä¹ç¸è¯ææå®çªåºå¯¨ç»æ¯¡è©¹ç²æ²¾çæ©è¾å´­å±è¸æ å æç«æ¹ç»½æ¨ç« å½°æ¼³å¼ ææ¶¨æä¸å¸è´¦ä»èç´éææ­æ¾æ²¼èµµç§ç½©åèå¬é®æå²è°è¾èéèè¿æµçæççç §è»è´éä¾¦æç¹è¯éæ¯ééµè¸æ£çå¾ç°äºææ´æ¯æ­£æ¿å¸§çéè¯èææ¯å±èç¥è¢èæ±ä¹ç»èç´æ¤æ®æ§å¼ä¾åææ­¢è¶¾åªæ¨çº¸å¿ææ·è³è´ç½®å¸å³å¶æºç§©ç¨è´¨ççæ»æ²»çªä¸­çå¿ éè¡·ç»ç§è¿éä»²ä¼èå¨å·æ´²è¯ç²¥è½´èå¸åç±å®æ¼éª¤ç æ ªèæ±çªè¯¸è¯éç«¹çç®æç©å±ä¸»èæ±å©èè´®é¸ç­ä½æ³¨ç¥é©»æçªæ½ä¸ç è½¬æ°èµç¯æ¡©åºè£å¦æå£®ç¶æ¤é¥è¿½èµå ç¼è°åææåæ¡ç¢èéåçç¼æµå¹å¨èµå§¿æ»æ·å­ç´«ä»ç±½æ»å­èªæ¸å­é¬æ£è¸ªå®ç»¼æ»çºµé¹èµ°å¥æç§è¶³åæç¥è¯é»ç»é»çºå´éæç½ªå°éµæ¨å·¦ä½æåä½ååº§éå³å«ç·æ§é­è°éµé¹åªªéªé³é¯åé£é¸¨é¾é¹è´²éèåæ»éç­è·¸èç¼ç¬¾éª é£é£éé³é³å§ç¼¤æ§æ®¡èéé«é¬ç¦é¥½é¹é¹é¸éªé»ªæ»é¸ä¾ªéåè°è°¶èå¿å©µéª£è§ç¦é¡ä¼¥èæéé²³ç ä¼§è°æ¦ç¢é¾æ¨æ½ééé¥¬é¸±é³ä¿¦å¸±é åç»è¹°éæç¼é¹è¾é¾é¹èéª¢æè¾æºéé¹¾åééªç»æ®èµçç®ªè° ç è£çé«ç±´è¯è°ç»¨è§éå·é¿ç«é«é²·é²½é¤é¥å²½é¸«çª¦æ¸æ¤çç¬é»©ç°æ¼é¦çè¶¸éè°å©éè½­éé·é¹é¢é¢é³è¯¶è¿©éé¸¸é²é«é²ç»¯éé²±å¾æ²£å«é©¸ç»ç»èµéº¸é²é³éèµå°´æç»æç¾è¯°ç¼éçº¥éé¢äºèµç» é² è¯ç¼è§è¯æ¯é´é¢é¸ªé¹é¹é¸¹æ´è¯æ¼é¹³é³ç·å¦å¿å¦«æ¡§é²é³è¡®ç»²é²§ååå¸¼æ¤èéªéç»é¢çé¢¢è¯éèé»è®§è­é³é²æµé¹éªæ¡¦é§å¥ç¼³é¾é²©é³è¯èåæµç¼ç²æè¯¨é¦éé¬é¬è®¦è¯è å½åéª¥çè§é½ç¶ç¾è¿è·»éé²é²«éæµééè²è°ç¼£ææ¬çé¹£ç¬é²£é¯ç»ç¼°æ¢å³¤é¹ªé²çé¢é²åºè©é¦ç¼èµè§å­æ³¾è¿³å¼ªè«ééé¸ é¹«è®µå±¦æ¦é£ééçª­é¾é©éé½è°²çç²åå²å¿¾æºé é´é¾é¶éªééªç¼è½²é¶éé¢é¾é¿å¾éåèç¯é«è¯è¯³éå¹çº©è´¶å®èæ¦è©ç¯ééé²²è´å´å¾æ¶æ¿èµçé¼çç±å²æ¦æé§è¤´ééå å´éé¹ç¨é³è¯ç¼§ä¿ªé¦åèèè åé¦éªç¼¡æ¥æ è½¹ç ºéé¹ç ç²è·é³é²¡é³¢è¹å¥æ½çæ®è£¢è££é²¢é­ç¼­éé¹©èºå»ªæª©è¾èºç»«æ£èé²®æµéªç»ºéé¹¨èæ³·çæ è§ç »å»èå½åµéçè§è¼é«åæ¸åé¾æ³¸æ¸æ æ©¹è½³è¾è¾æ°èªé¸¬é¹­è»é²èå¨æ ¾é¸¾é®åµè¦ç¡æ³ºæ¤¤è¶éæ¦è¤éååå¬·æ©å¢ç¼¦éé¢¡é³éº½æªçæéèè°§çç¥¢æ¸è¼é»¾ç¼ç¼ªéµç¼è°è¦é¦æ®éé¼éè®·éé²µè¾é²¶èè¢é§èå«é¢è¹èåèä¾¬åé©½éå©è®´æç¯è¹ç±è¾çº°ç½´éè°éªç¼¥å«éé¤é¨è²éªç»®æ¡¤ç¢é¢é¢é³ä½¥è¨æ­éªç¼±æ¤ é¤å«±æ¨¯æçééµéªç¾è·è¯®è°¯èç¼²ç¡è··æ¬é²ç®§éæ¿é²­èè±å·¯èµè®é³è¯å²éè§é¸²è¯ ç»»è¾é¨ééæ«èå¨æ¡¡é¥ªè½«åµè¾ç¼é·é¢¦è¬é£æ¯µç³ç¼«å¬é¯ç©é©é²¨é¾è®ªå§éªéé³å§æ®è§åæ» ç²è¯è°æ¸è°¥åè³å¼è½¼è´³éé²¥ç»¶æçº¾é©éå®é©·ç¼é¶é¸¶è®é¦é£é¼è°¡ç¨£è°èªç²å¢çé¼éé³éé²æé½é¬é¡¸å¥é¥§é´éé¬é½ç¼é¹éç²é¾é²¦æ¸é­éæé¥¨ç®¨é¼å¨²è½çº¨ç»¾è¾è¯¿å¸é±æ²©æ¶ ç®éªçé²éè´é¾é¬åºæå¦©éªé¹é¹é¥©éçºè§ç¡èè¶èå²çå¨´é¹ç«èç±¼è·¹èé¥·éª§ç¼é£¨åæ½éªç»¡æ­ç®«äºµæ·ç»ç¼¬éè¥é¦é¸ºè¯©é¡¼è°ééè°æ³¶é³åæµé²å­å¨æ¡ æ°©å£èµä¿¨åè°³æ¹é«é½é­é¤é¼¹çè½ºé¹é³é¥è°éºæç¨è¯åå³é¥´æ¿é©¿ç¼¢è½¶è´»ééé±çè£éç¾èèºè¦è¥æå¤æ»¢æ½çé¹¦ç¿é¢ç½éè¸éé±¿ä¼ä¿£è°è°è£åµé¥«éå¦ªçº¡è§æ¬¤é°é¹é¹¬é¾æ©¼é¸¢é¼éºéè¸æ½æ çº­é«æ®æ°²çè¶±é¾é©µèµå§å¸»ç®¦è°®ç¼¯è°µè¯éè°ªè¾é¹§æµç¼æ¡¢è½¸èµç¥¯é¸©è¯¤å³¥é²é®ç­éªæ æ è½µè½¾è´½é¸·è³çµ·è¸¬è¸¯è§¯éºçº£ç»ä¼«æ§ é¢å­é¦é¢éªç¼è¯¼é¯è°ç¼è¾èµç¦é±é¾é²»å¬è¯¹é©ºé²°éç¼µèºé³è® è°«éåå¼ååå´å¯åèè¬è®èè¼è°èæ¸åå£ååå´åå¼å¯å¹å²åµ´å½·å¾¼ç¸çé¦é¦é¦é¦æ£æ·æä¸¬æºæ»æº·æ¼¤æ½´æ¾¹ç¯çºç»ç»±çæ§æ¡æ¡æ§æ©¥è½±è½·èµè·è¨é£ç³ççææ·¼ç ç£çéé·éééééééééªé«é¿ééé¢é¥é©é²ç¨é¹é¹é¹±ç¬ç´çç¯è£¥è¥è¢é¢¥è¨éº´é²é²é²é²é²´é²ºé²¼é³é³é³é³éé´é½",gfe="åé¿åæ¨åååççè¹ç®è¾ç¤æééæ°¨å®ä¿ºææå²¸èºæ¡éª¯æçå¹æç¬ç¿ºè¥å²å¥§ææ¾³è­ææå­å§ç¬å«ç¤å·´æè·é¶æèå£©é¸ç½·ç¸ç½æç¾æºä½°ææç¨æç­æ¬æ³è¬é æ¿çæ®æä¼´ç£åè¾¦çµé¦å¹«æ¢æ¦èç¶æ£ç£èéåè¬èèåè¤åèé¹ä¿å ¡é£½å¯¶æ±å ±æ´è±¹é®çæ¯ç¢æ²ååè¼©èè²éåç½åæçè¢«å¥è¯æ¬ç¬¨å´©ç¹ç­æ³µè¹¦è¿¸é¼é¼»æ¯éç­å½¼ç¢§èè½ç¢ææ¯å¹£åºç¹éæå¼å¿è¾å£èé¿éé­éç·¨è²¶æä¾¿è®åè¾¨è¾¯è¾®éæ¨å½ªèè¡¨é±æå¥çå½¬æçæ¿±è³æ¯åµå°æä¸ç§é¤ç³çä¸¦ç»è æ­æ¥ç¼½æ³¢ååæéç®ä¼¯å¸è¶èèæ¸¤æ³é§æèåºè£å ä¸å¸æ­¥ç°¿é¨ææ¦çè£ææè²¡ç¬è¸©éå½©èè¡é¤åè ¶æ®ææç¦è¼èåæ»èæç³æ§½æ¹èå»ç­å´åæ¸¬å±¤è¹­æåè¬è¶æ¥ç¢´æ½å¯å²å·®è©«ææ´è±ºææ»è¬é¥è®çºéç¢é¡é¡«æçå ´åå¸¸é·åè¸å» ææ¢å±å¡è¶æéæå²æ½®å·¢åµçè»æ¯æ¤æ£å¾¹æ¾é´è£è¾°å¡µæ¨å¿±æ²é³è¶è¥¯æç¨±åæ©æåä¹ç¨æ²æ¾èª æ¿éé¨ç§¤åç¡æåæ± é²å¼é¦³æ¥é½ä¾å°ºèµ¤ç¿æ¥ç¾åæ²è²å´å¯µæ½é¬çèºç¨ æç±ä»ç¶¢çéè­ååºæ«¥å»èºé¤éæ»é¤æ¥ç¤å²çæè§¸èæ£å·ç©¿æ¤½å³è¹åä¸²ç¡çªå¹¢åºéåµå¹çæ¶éåæ¥æ¤¿éåæ·³ç´è ¢æ³ç¶½çµè¨ç£éè¾­æç·è©æ­¤åºè³æ¬¡è°è¥åªåå¾å¢æ¹ç²éç°ä¿èº¥ç¯¡ç«æ§å´å¬èçç²¹æ·¬ç¿ æå­å¯¸ç£æ®ææªæ«é¯æ­éç­ç©æå¤§åæ­¹å£æ´å¸¶æ®ä»£è²¸è¢å¾é®æ è½æä¸¹å®é²æ£è½æ¦æ°®ä½ææ·¡èªå½èç¶æé»¨è©æªåæè¹åå³¶ç¦±å°å°ç¨»æ¼éçå¾·å¾çè¹¬çç»ç­çªå³é§å ¤ä½æ»´è¿ªæµç¬çæ»ç¿å«¡æµåºå°èç¬¬å¸å¼éç· é¡ææ»ç¢é»å¸éå¢é»ä½ç¸åºæ¦å¥ æ¾±æ®¿ç¢å¼ééåæåé£èª¿è·ç¹ç¢è¶å è«çä¸ç¯å®éé é¼é å®è¨ä¸æ±å¬è£æåæ£ä¾æ«åæ´åæé¬¥é¡è±éçé½ç£æ¯ç¢ç¨è®å µç¹è³­æéèåº¦æ¸¡å¦ç«¯ç­éæ®µæ·ç·å åéå°å¢©å¸è¹²æ¦é å¤éç¾éæåå¤å¥ªåèº²æµè·ºèµåæ°å¢®è¾å³¨éµä¿é¡è¨å¨¥æ¡åæ¼ééé¤æ©èåè³ç¾é¤æ´±äºè²³ç¼ç½°ç­ä¼ä¹é¥æ³çºè©å¸çªç¿»æ¨ç¤¬é©ç¹å¡ç©åè¿ç¯è²©ç¯é£¯æ³åè³æ¹èªæ¿é²å¦¨ä»¿è¨ªç´¡æ¾è²éå¡é£è¥åªèª¹å èºå»¢æ²¸è²»è¬éå©æ°åç´å¢³çæ±¾ç²å¥®ä»½å¿¿æ¤ç³è±å°æ¥èå³°éé¢¨çç½é¢é¦®ç¸«è«·å¥é³³ä½å¦å¤«æ·èå­µæ¶æè¼»å¹æ°ç¬¦ä¼ä¿ææµ®æ¶ªç¦è¢±å¼ç«æ«è¼ä¿¯éæ§è¯èåºèèµ´å¯è¦è³¦å¾©åä»éç¶è¹è² å¯è¨éå©¦ç¸åå¶åè©²æ¹æ¦é£èæºå¹¹çæ¡¿æç«¿èè¶æç¨æ¢è´å²¡åé¼ç¼¸èç¶±å´æ¸¯æ ç¯è¯é«èç¾ç³æé¬ç¨¿åå¥æ­æ±æé´¿è³çå²é©èæ ¼è¤é£éé»ååçµ¦æ ¹è·èæ´åºç¾¹åè¿æ¢å·¥æ»åæ­é¾ä¾èº¬å¬å®®å¼éæ±æ±è²¢å±é¤å¾æºèçå¢æ§è³¼å¤ è¾èåç®ä¼°æ²½å­¤å§é¼å¤è ±éª¨è°·è¡æé¡§åºéå®çå®å¯¡æè¤ä¹ææªæ£ºéå®å è§ç®¡é¤¨ç½æ£çè²«åå»£éç°è¦å­ç½æ­¸é¾é¨è»é¬¼è©­ç¸æ¡æ«è·ªè²´åè¼¥æ»¾æ£éé­åæè£¹éåéª¸å­©æµ·æ°¦äº¥å®³é§­é£æ¨é¯éå«æ¶µå¯å½åç½ç¿°æ¼ææ±æ¾æçæ±æ¼¢å¤¯æ­èªå£åè±ªæ¯«éå¥½èèæµ©åµåè·èæ ¸ç¦¾åä½åçè²é¡æ²³æ¶¸èµ«è¤é¶´è³å¿é»çå¾ç æ¨å¼äº¨æ©«è¡¡æè½åçè¹é´»æ´ªå®å¼ç´åä¾¯ç´å¼ååå¾å¼ä¹å¿½çå£ºè«è¡è´çç³æ¹å¼§èå¬è­·äºæ»¬æ¶è±å©è¯ç¾æ»ç«ååè©±æ§å¾æ·æ·®å£æ­¡ç°æ¡éç·©ææ£åçè±¢ç¥æ¸å®¦å¹»èæé»ç£ºèç°§çå°æ¶çæå¹æè¬ç°æ®è¼å¾½æ¢èåæ¯ææ§åæ æ¦è³ç©¢æç´å¯è«±èª¨ç¹ªè·æå©é­æ¸¾æ··è±æ´»å¤¥ç«ç²ææéè²¨ç¦æå¾åºæ©ç¸ç¨½ç©ç®èé¥è·¡æ¿è­éå§¬ç¸¾ç·åæ¥µæ£è¼¯ç±éåæ¥ç¾æ±²å³å«ç´æ å¹¾èå·±èæåå­£ä¼ç¥­åæ¸æ¿å¯å¯è¨è¨æ¢å¿éç¹¼ç´åæ·å¤¾ä½³å®¶å è¢é °è³ç²éåç¨¼å¹æ¶é§å«æ®²ç£å å°ç®éçå¼è©è±å¥¸ç·ç¹­æª¢æ¬å ¿é¹¼ææ¿ç°¡ååªæ¸è¦æª»éè¸è³¤è¦éµç®­ä»¶å¥è¦åé¤æ¼¸æ¿ºæ¾å»ºåµå§å°æ¼¿æ±çè£æ§³çè¬å é¬éèæ¤ç¤ç¦è äº¤éæ¾é©å¬å¼æªé¸ç¯å¥è³ç¡è§é¤ç¹³çµå¿æéµè½è¼å«çªæ­æ¥çç¨­è¡éæªå«ç¯èçæ¶é¯¨äº¬é©ç²¾ç²³ç¶äºè­¦æ¯é ¸éå¢æ¬é¡å¾çéç«ç«¶åç¯çªæªç©¶ç³¾çé­ä¹ç¸ä¹éå»æèè¼èåå°±çé æçç½å±é§èå±åç©èæ²®èææå·¨å·è·è¸é¸ä¿±å¥æ¼ç¬åæéµå¨å¦ç·å·çµ¹ææ«ææåçµæ¡åæ·ç«ç«­æ½çµè§£å§æèè¥çåä»ç¥èª¡å±å·¾ç­æ¤éä»æ´¥è¥ç·é¦åè¬¹é²é³æç¦è¿ç¼æµ¸ç¡åèå¢è¦ºæ±ºè¨£çµåèéè»åå³»ä¿ç«£æµé¡é§¿ååå¡å¯éæ©æ¥·å±æ¨åå ªååç çåº·æ·ç³ ææäº¢çèæ·ç¤é å·èæ¯æ£µç£é¡ç§æ®¼å³å¯æ¸´åå»å®¢èª²è¯åå¢¾æåå­ç©ºæå­æ§æ³å£æ£å¯æ¯å­çªè¦é·åº«è¤²èªå®æè·¨è¯å¡ç­·åå¿«å¯¬æ¬¾å¡ç­çæ¡ç¤¦ç¶æ æ³è§çå·çªºèµå¥é­åé¥æ§æ½°å¤ææå°æ¬æ´å»éåæåè èè¾£å¦èä¾è³´èå©ªæ¬æç±éè­ç¾è®æ¬è¦½æ¶çºçæ¿«ç¯æ¦ç¼å»éææµªæåç¢èä½¬å§¥éªçæ¾åæ¨é·é³è¾ç£ç´¯å¡å£æèé¡æ·æ£±æ¥å·åæ¢¨çé»ç±¬è²é¢æ¼çæè£é¯ç¦®èèåæ éºå²åµç¤«æ­·å©åä¾ä¿ç¢ç«ç²çé¸åçå©åè¯è®é£é®å»ææ¼£ç°¾æèéæçç·´ç³§æ¶¼æ¢ç²±è¯å©è¼éæ¾äº®è«æ©èåççå¯¥é¼æ½¦äºæéå»æåè£çå£çµç³æç£·éè¨é°é±æ·åè³åæç²è±é¶é½¡é´ä¼¶ç¾æ·©ééµå¶ºé å¦ä»¤æºçæ¦´ç¡«é¤¾çåç¤æµæ³å­é¾è¾å¨ç± çª¿éå£æé´æ¨å©æç°æ¼éèç§é¡±å»¬çæé¹µèé­¯éºç¢é²è·¯è³é¹¿æ½ç¥¿éé¸æ®é©¢åéä¾¶æå±¥å±¢ç¸·æ®æ°¯å¾çæ¿¾ç¶ å·æ£å­¿ç¤åµäºæ ç¥æè¼ªå«ä¾æ·ªç¶¸è«è¿èºç¾éé¼ç±®é¨¾è£¸è½æ´é§±çµ¡åª½éº»çªç¢¼èé¦¬ç½µåååè²·éº¥è³£éèçé¥è »æ»¿èæ¼æ¢æ¼«è¬¾èè«ç²æ°å¿è½è²èé¨æ¯çéå¯èåå¸½è²è²¿éº½ç«ææ¢é¶é»´ç¤æ²çåªéæ¯ç¾æ§å¯å¦¹åªéæ¶åèèæª¬çé³çå¤¢å­çéé¡ç³è¿·è¬å½ç±³ç§è¦æ³èå¯åªæ£ç ç¶¿åååå¨©ç·¬é¢èæçèç§æ¸ºå»å¦èæ»æ°æ¿ç¿ææ«é©æèé³´éåå½è¬¬æ¸æ¹èæ¨¡èç£¨æ©é­æ¹æ«è«å¢¨é»æ²«æ¼ å¯éè¬çææç¡çå§æ¯å¢æ®å¹åææ¨ç®ç¦ç§ç©æ¿åªå¶éé£å¨ç´æ°ä¹å¥¶èå¥åç·é£åæè¦æ±é¬§æ·å¢é¤å§å«©è½å¦®éåªæ³¥å°¼æ¬å¦³å¿è©éæººè«æå¹´ç¢¾ææå¿µå¨éé³¥å°¿æè¶å­½åé·é³æ¶æ¨æª¸ç°åå¯§æ°æ¿çæ­éç´è¿æ¿è¾²å¼å¥´åªæå¥³æèç§æªæ¦ç³¯è«¾å¦æ­é·æ¯èåå¶æ¼åªè¶´ç¬å¸æç¶ææçå¾æ¹æ´¾ææ½ç¤ç£ç¼çå¤åä¹é¾æèªèæåå¨ç®è¢è·æ³¡å¸èå¹è£´è³ éªéä½©æ²å´çç °æ¨ç¹æ¾å½­è¬æ£ç¡¼ç¯·è¨æéµ¬æ§ç¢°å¯ç é¹æ¹æ«åçµæ¯å¤è¾ç²ç®å¹çå»å±è­¬ç¯åçé¨é£æ¼ç¢ç¥¨æç¥æ¼é »è²§åèä¹åªèèå¹³æç¶è©å±å¡æ½é å©ç ´é­è¿«ç²åæ²éªä»èè¡è©è²åæ¨¸åæ®æµ¦è­æçææ¬ºæ£²æå¦»ä¸æ·æ¼ææ²å¶æ£å¥æ­§ç¦å´èé½æç¥ç¥é¨èµ·è±ä¹ä¼åå¥ç å¨æ°£è¿æ£æ±½æ³£è¨ææ´½ç½æ¡é¬éåé·ç°½ä»è¬ä¹¾é»é¢éåæ½é£æ·ºè­´å¡¹åµæ¬ æ­æ§åèç¾å¢»èå¼·æ¶æ©é¬æ²ææ©ç§å¬åå·§éæ¬ç¿¹å³­ä¿ç«åèä¸æ¯ç«æ¬½ä¾µè¦ªç§¦ç´å¤è¹æç¦½å¯¢æ²éè¼æ°«å¾å¿æ¸ææ´æ°°æé è«æ¶ççª®ç§ä¸é±çæ±åéæ³è¶¨åèæ²è»å±é©æ¸ åå¨¶é½²è¶£å»åé¡´æ¬éæ³å¨çæ³ç¬å¸å¸ç¼ºçç¸å»éµ²æ¦·ç¢ºéè£ç¾¤ç¶çåæç¤å£¤æå·è®é¥æ¾ç¹æ¹ç±å£¬ä»äººå¿éä»»èªåå¦ç´æä»æ¥æè¸èæ¦®èçæº¶å®¹çµ¨åææèè¹è åå­ºå¦è¾±ä¹³æ±å¥è¤¥è»é®èçé³éæ½¤è¥å¼±æçè©è®é°å¡è³½ä¸ä¸åæ£æ¡ååªæé¨·æå«çè²æ¾æ£®å§èç æ®ºåæ²ç´å»å¥çç¯©æ¬çè«æå±±åªç½è¡«ééæè´è³åæ±æç¹å¢å·åè³æä¸å°è£³æ¢¢æç¨çèåºé¶å°å¨éµç´¹å¥¢è³èèèèµ¦æå°æ¾æ¶ç¤¾è¨­ç ·ç³å»ä¼¸èº«æ·±å¨ ç´³ç¥æ²å¯©å¬¸çèææ»²è²çç¥ç²åç¹©ççå©åèå¸«å¤±çæ½æ¿è©©å±è±åç³æ¾æä»é£èå¯¦è­å²ç¢ä½¿å±é§å§å¼ç¤ºå£«ä¸æ¿äºæ­èªéå¢æ¯åå¬é©ä»ä¾éé£¾æ°å¸æå®¤è¦è©¦æ¶æé¦å®å£½æå®åç¦ç¸è¬æ¨æ¢³æ®æè¼¸åèæ·çæ¸è´å­°çè¯ææç½²èé»é¼ å±¬è¡è¿°æ¨¹ææè±å¢åº¶æ¸æ¼±æå·èæè¡°ç©å¸¥æ æ´ééç½èª°æ°´ç¡ç¨å®ç¬é èèªªç¢©æçæ¯æå¶æç§å¸çµ²æ­»èå¯ºå£åä¼ºä¼¼é£¼å·³æ¾è³æ«é éå®è¨èª¦æèæ»å½èé¥ä¿ç´ éç²å³å¡æº¯å®¿è¨´èé¸èç®ééé¨ç¶é«ç¢æ­²ç©éé§ç¥å­«æç­èæ¢­åç¸®ç£ç´¢éæå¡ä»å®å¥¹å¡çºæ»è¹è¸èèæ¡èºæ³°éå¤ªææ±°åæ¤è²ªç±çå£æªç°æ½­è­è«å¦æ¯¯è¢ç¢³æ¢åç­æ¹¯å¡æªå æ£ èåç³åèººæ·è¶çææ¿¤æ»çµ³èæ¡éæ·é¶è¨å¥ç¹è¤é¨°ç¼è¬æ¢¯åè¸¢é»æé¡è¹å¼é«æ¿åææ¶åå±å¤©æ·»å¡«ç°çæ¬èèææ¢è¿¢çºè·³è²¼éµå¸å»³è½ç´æ±å»·åäº­åº­æºèéæ¡é®ç³åéå½¤ç«¥æ¡¶æç­çµ±çå·æé ­éå¸ç¦¿çªåå¾éå¡å± åååæ¹åæ¨é ¹è¿è»è¤ªéåå±¯èææè«é´éé¦±é§æ©¢å¦¥æå¾æåèçªªå¨ç¦è¥ªæ­ªå¤è±å½ç£ç©é ä¸¸ç·å®ç¢æ½æçæå®å©è¬èæ±ªçäº¡æç¶²å¾æºæå¿å¦å¨å·å¾®å±ééæ¡åå¯æçºæ¿°ç¶­è¦èå§åå½å°¾ç·¯æªèå³çèé¤µé­ä½æ¸­è¬å°æ°è¡çæº«èæèç´å»ç©©ç´åå¡ç¿çæ¾è¸æ¸¦çª©ææ¡è¥æ¡æ²å·«åé¢çæ±èª£å±ç¡èªæ¢§å¾å³æ¯æ­¦äºæåèä¼ä¾®å¡¢æé§æ¤ç©å¿åæèª¤æçæè¥¿ç¡ç½æ°å»å¸é«ç§ç¨æ¯å¸æèå¤æçç¯æºªæ±çæªè¥²å¸­ç¿åª³åéæ´ç³»éæ²ç´°çè¦å£éè½æå³½ä¿ ç¹ä¸å»å¤åæéåä»é®®çºé¹¹è³¢éè·éæ¶å¼¦å«é¡¯éªç¾ç»ç¸£èºé¤¡ç¾¨æ²é·éç·ç¸å»é²é¦ç®±è¥æ¹éç¿ç¥¥è©³æ³é¿äº«é å··æ©¡ååè±¡è­ç¡éåå®åé·æ¶å®µæ·æå°å­æ ¡èå¯ç¬ææ¥äºæ­è éåæ¾æéªæèè«§å¯«æ¢°å¸è¹ææ³çè¬å±èªè¯éæ¬£è¾æ°å¿»å¿ä¿¡éæè¥ç©æºèååå½¢é¢è¡éå¹¸ææ§å§ååè¸åæ´¶éçä¼ä¿®ç¾æ½åé¹ç§è¢ç¹¡å¢æéèåé å¾è¨±èéææ­åºçæ¤çµ®å©¿ç·çºè»å§å®£æ¸æçé¸ç¬ç©çµ¢é´èå­¸ç©´éªè¡åçå¾ªæ¬è©¢å°é¦´å·¡æ®æ±è¨è¨éè¿å£æ¼é´é´¨åä¸«è½çèå´è¡æ¶¯éåäºè¨çå½é¹çæ·¹é¹½å´ç èå·å»¶è¨é¡é»çæ²¿å¥æ©ç¼è¡æ¼è·å °çå­ç¡¯éåå½¥ç°å®´è«ºé©æ®å¤®é´¦ç§§æ¥æä½¯çç¾æ´é½æ°§ä»°ç¢é¤æ¨£æ¼¾éè°å¦ç¤æå ¯éçª¯è¬ å§å¬èè¥è¦èæ¤°åè¶çºéå¶ä¹é ææ¥­èæ³èå¤æ¶²å£¹å£¹é«æé¥ä¾ä¼è¡£é ¤å¤·éºç§»åè°çæ²å®å§¨å½æ¤è»åå·²ä¹ç£ä»¥èææéå±¹åå½¹èé¸èç«äº¦è£ææ¯æ¶ç¾©çæº¢è©£è­°èª¼è­¯ç°ç¿¼ç¿ç¹¹èµè­å æ®·é³é°å§»åéæ·«å¯é£²å°¹å¼é±å°è±æ«»å¬°é·¹æçºç©è¢ççè è¿è´çå½±ç©ç¡¬æ å²æå­èç°åº¸éè¸´è¹è© æ³³æ¹§æ°¸æ¿åç¨å¹½åªæ æå°¤ç±éµé¾ç¶æ²¹ééæåå³ä½éèªåå¹¼è¿æ·¤æ¼çæ¦èæè¼¿ä½ä¿é¾é­ææ¸æ¼éäºå¨é¨èå¶¼ç¦¹å®èªç¾½çåèéç±²éå»å³ªç¦¦ææ¬²çè²è­½æµ´å¯è£é è±«é¦­é´æ·µå¤åå£è¢åæ´è½åå¡åç¿æºç·£é èé¡æ¨é¢æ°ç´è¶èºé°å¶½ç²µææé±èé²éå»éåéèéæé»å­åç ¸éæ ½åç½å®°è¼åå¨å±æ¢æ«è´è´èè¬é­ç³é¿è»æ£æ©æ¾¡è¤èºåªé çç«ç¥è²¬æåæ¾¤è³æå¢ææ¾è´ç´®å³æ¸£åè»ééç¨æµæ¦¨åä¹ç¸è©æé½å®çªåµå¯¨ç»æ°è©¹ç²æ²¾çæ¬è¼¾å¶å±è¸æ£§å æ°ç«æ¹ç¶»æ¨ç« å½°æ¼³å¼µææ¼²æä¸å¸³è³¬ä»è¹ç´éææ­æ¾æ²¼è¶ç§ç½©åèå¬é®æå²èè½èéºèéæµçæççç §è»è²éåµæç¹è¨ºéæ¯é®é£è¸æçå¾çç­ææ´æ¯æ­£æ¿å¹ç¥é­è­èææ¯å±èç¥è¢èæ±ä¹ç¹è·ç´æ¤æ®å·å¼ä¾åææ­¢è¶¾åªæ¨ç´èªæ¯æ²è³è´ç½®å¹å³å¶æºç§©ç¨è³ªççæ»¯æ²»çªä¸­çå¿ éè¡·çµç¨®è«éä»²ç¾èå¨å·æ´²è¬ç²¥è»¸èå¸åçºå®æé©ç æ ªèæ±è±¬è«¸èªéç«¹ç­ç®æçåä¸»èæ±å©èè²¯éç¯ä½è¨»ç¥é§æçªæ½å°ç£è½æ°è³ºç¯æ¨èè£å¦æå£¯çæ¤éè¿½è´å¢ç¶´è«æºææåæ¡ç¢èéåèç¼æ¿è²å¨è³å§¿æ»æ·å­ç´«ä»ç±½æ»å­èªæ¼¬å­é¬æ£è¹¤å®ç¶ç¸½ç¸±éèµ°å¥æç§è¶³åæç¥è©é»çµéçºå´éæç½ªå°éµæ¨å·¦ä½æåä½ååº§éå¯å¬¡ç¦æéè«³é¨éµªåª¼é©é°²éåéé´é½éµ¯è³éè½å¶æ½·éç¯³è¹èç·¶ç±©é©é¢®é£é¢é£é°¾åç¹½æª³æ®¯èéé«é¬¢ç¨é¤é¸éµé½é©é»²æ»é¤åéµåè«è®èæºå¬é©è¦ç¦ªéåèæµé¶é¯§ç¡¨åè«¶æ«¬ç££é½æ£æªé®éºé£­é´éåå¹¬è®è»çµèºé§æ´ç¶é¶è¼é½ªé¶¿è¯é©æ¨è¼³æé¼é¹ºå éé§ç´¿æ®«è³§çç°è®ç¢­è¥ ç¾éç³´è©è«¦ç¶è¦¿éå·é¿ç²éé¯é°éé©å´ é¶ç«çæ«çç¯¤é»·ç±ªæéçèºé¸è«¤å é¼è»é¨éé¶é¡é¡é±·èªééºé´¯é®éé­´ç·é¨é¯¡å¨çé³§é§ç´±ç´¼è³»éº©é®é°éè³å°·æç´ºæçªèª¥ç¸é¯ç´éæ½äºè³¡ç¶é¯è©¬ç·±è¦¯è©è½é·é®é´£éµ é¶»é´°æè©¿æé¸é°¥ç·å­ååª¯æªé®­é±è¢ç·é¯å å¼å¹æ§¨èé¿éçµé ¡çé¡¥è¨¶éè £é»è¨èéé±æ»¸é¶é©æ¨ºéµå¥ç¹¯é°é¯é°è©¼èå¦æ¾®ç¹¢ç¿æè«¢é¤é½é¥éè¨è©°èºå°åé©¥ç£è¦¬é½ç£¯ç¾è èºé½é±­é¯½éæµ¹ééµè¯è««ç¸ææ©ç¼é¶¼ç­§é°¹éçµ³éæå¶ é·¦é®«ç¤é é®å·¹èé¥ç¸è´è¦²åæ¶éå¼³èéé¬®é³©é·²è©å±¨æ«¸é¢¶éé¦çª¶é½éé«éè­ç¨ç¸å´å¡æ¾æ·é§éé¾éé§é¬é¨ç·è»»é³éé ·é½¦éå³é¶å²è¾çªé«èªèªéºå£çºè²ºå±è¢æèµç°£é«éé¯¤è å´å¾ æ·¶ç¨è³çé¸ç©ç±åµæ¬æé­è¥¤é¬éå®å¶é éçé°³èªç¸²å·éå£¢è¶èèºå¦éé©ªç¸­æ«ªæ«è½¢ç¤ªé°é¸çç³²èºéé±ºé±§èå¥©ç²çæ®®è¤³è¥é°±é­ç¹éé·¯èºå»©æªè½èºªç¶¾æ¬è¶é¯ªçé¨®ç¶¹é¦é·è¢ç§çæ«³æ§ç¤±åèåå¶é¤çºè¬è»é«å£æ¼åé­çæ·¥æ«¨æ«è½¤è¼è½æ°èé¸é·ºè«é±¸è å­æ¬é¸é¾åççæ¿¼æ¬è¡éæ«è¤¸éå¸åå¬¤æ¦ªå±ç¸µéé¡é°»éº¼æ«çæ£éç¾è¬ç¼ç¦°æ¾ é¦é»½ç·²ç¹éç·¡è¬¨é©é¥æ­¿éé¬éè¨¥é®é¯¢è¼¦é¯°è¦è£éèåé¡¢èº¡è§åè¹åå¥é§é¹åºè¬³æªçè¹£ç°è½¡ç´ç¾é¹è«é§¢ç¸¹å¬ªéé·é èé¨ç¶ºæ¦¿ç£§é é é°­åèæ³é¨«ç¹¾æ§§éå¬æª£æ§çééé¹ç¾¥è¹èªè­èç¹°ç£½è¹ºæé¥ç¯éæ³é¯ç¢èºå·°è³è£é°è©å¶éè¦·é´è©®ç¶£è¼éééæ¨èå¬æ©é£ªè»å¶¸è ç¸é£é¡°èé¢¯æ¯¿ç³ç¹åé«ç©¡é©é¯éè¨å§é¨¸é¤é±å°æ®¤è§´åçç¬è©µè«çè¬å¡èå¼è»¾è²°é°é°£ç¶¬æç´éé å»é§ç·¦é¶é·¥èªé¤¿é¢¼éªè¬ç©èª¶èç»å©è§é¥éé°¨é¦é®æé­éé å»é¤³éééé±ç·¹éµéç³¶é½ é°·æéé·æ¶é£©ç±é¼åª§èç´ç¶°è¼è«å¹éæºæ½¿çéçé®ªé¿èµé½·éå»¡æ®å«µé¨éµ¡é¶©é¤¼é¬©ç½è¦¡ç¡¤è§èèå³´ç«å«»é·´çè ç§èºèé¤é©¤ç·é¥åµçé©ç¶æ¢ç°«è¤»æ·ç´²çºéæ»é¥éµè©¡é è«¼ééè¬æ¾©é±å¡¤æ½¯é±å¡å©­æ¤æ°¬å´è´å¼åè®æ¨ééé­é¥é¼´ç¬è»ºé·é°©é¨è¬é´æçè©åå¶§é£´æé©ç¸è»¼è²½éé°é¿çè¤é¦ç®å¡é¶¯ç¸é£æå¶çç çé¸ç­é ¦ç½éèéªé­·å´ä¿è«è«­è·å´³é£«é¾å«ç´è¦¦æ­éºéµé·¸é½¬æ«é³¶é»¿ééèæ²æç´éæ®æ°³çè¶²é¨é§è³¾åå¹ç°è­ç¹è­«è©éè¬«è¼é·æ¹ç¸æ¥¨è»«è³ç¦é´è«å´¢é¦éç®é¨­æ«æ¢è»¹è¼è´é·èç¸¶èºèºè§¶é¾ç´ç¸ä½æ«§éåé¥é¡³é¨ç¸è«é²è«®ç·è¼è²²ç¥éé½é¯å¯è«é¨¶é¯«éçºèº¦é±è¨è­¾é¤çæ°¹éªå£å åµå¢æª¾èè¤è§èèæ§æ£å¤åå¢ååæåè¬è¥å¶´èä»¿å¥çéºé¤é¤·é¥é¥¢æ¥æµæç¿æ¼µç©æ··æ¿«ç¦æ·¡å¯§ç³¸çµç·çæ¢æ£¬æ¡æ©°æ««è»²è»¤è³«èèé£ç³çæºæ¹£æ¸ºç¢¸æ»¾çééé£é±é¥é¶é¦é§é©éééééé¿éé¥é¹éç©­é¶é¶¥é¸ç§å±çèè¥ç¹è®é¡¬èéº¯é®é®é®é¯é¯é¯´é±é¯¿é° é°µé±é½éé½";function vfe(e){return sft.charAt(gfe.indexOf(e.charAt(0)))}var COt=new RegExp("[ä¸-é¾¥]+");function yfe(e){return gfe.includes(e)}var cr=class{static GetBytes(e){switch(typeof e){case"string":{let t=new Uint16Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return new Uint8Array(t.buffer)}case"number":return e-Math.floor(e)==0?e>4294967295?((t=new Float64Array(1))[0]=e,new Uint8Array(t.buffer)):function(t){return t[0]=e,new Uint8Array(t.buffer)}(new Int32Array(1)):function(t){return t[0]=e,new Uint8Array(t.buffer)}(new Float64Array(1));case"boolean":return function(t){return t[0]=Number(e),t}(new Uint8Array(1));default:if(e instanceof Array){let t=[];for(let n=0;n<e.length;n++)t.push(cr.GetBytes(e[n]));let n=0;for(let e=0;e<t.length;e++)n+=t[e].length;let r=new Uint8Array(n),i=0;for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++)r[i++]=t[e][n];return r}throw"Can't Convert To Bytes!!"}var t}static Get1Bytes(e){switch(typeof e){case"number":case"boolean":return new Uint8Array([Number(e)]);default:if(e instanceof Array){let t=[];for(let n=0;n<e.length;n++)t.push(this.Get1Bytes(e[n]));let n=0;for(let e=0;e<t.length;e++)n+=t[e].length;let r=new Uint8Array(n),i=0;for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++)r[i++]=t[e][n];return r}throw"Can't Convert To Bytes!!"}}static byteTosbyte(e){return(127&e)-(128&e?128:0)}static ToBoolean(e,t){return!!e[t=t||0]}static ToInt8(e,t){return 128&e[t=t||0]?-(1+(255^e[t])):e[t]}static ToUInt8(e,t){return e[t=t||0]}static ToInt16(e,t){t=t||0;let n=e.slice(t,t+2);return new Int16Array(n.buffer,0,1)[0]}static ToInt32(e,t){t=t||0;let n=e.slice(t,t+4);return new Int32Array(n.buffer,0,1)[0]}static ToUInt16(e,t){t=t||0;let n=e.slice(t,t+2);return new Uint16Array(n.buffer,0,1)[0]}static ToUInt32(e,t){t=t||0;let n=e.slice(t,t+4);return new Uint32Array(n.buffer,0,1)[0]}static ToChar(e,t){t=t||0;let n=e.slice(t,t+2);return String.fromCharCode(new Uint16Array(n.buffer,0,1)[0])}static ToAscii(e,t){return t=t||0,String.fromCharCode(e[t])}static ToAsciiString(e,t,n){t=t||0,(n=n||e.length)+t>e.length&&(n-=t);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(e[t+i]||0);return r}static ToUTF16String(e,t,n){t=t||0,(n=n||e.length)+t>e.length&&(n-=t);let r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e[t+i]||0;return String.fromCharCode.apply(null,Array.from(new Uint16Array(r.buffer,0,n/2)))}static ToFloat32(e,t){t=t||0;let n=e.slice(t,t+4);return new Float32Array(n.buffer,0,1)[0]}static ToFloat64(e,t){t=t||0;let n=e.slice(t,t+8);return new Float64Array(n.buffer,0,1)[0]}},Bh=class{static parserHeader(e,t){let n="",r=!1,i=0;for(;;){let a=e.readInt8(),s=String.fromCharCode(a);if(r)s===t[i]?i++:(r=!1,i=0);else{if(s===t[i]){r=!0,i++;continue}n+=s}if(r&&i===t.length)break}return n}static getCode(e){let t=mfe(e);return t.length<2?t[0]:t.length<4?cr.ToUInt16(t,0):cr.ToUInt32(t,0)}static parserCode(e,t,n){let r=new Te,i=[],a=[],s=[],o=!1;for(let l=0;l<t.length;l++){let h=t[l];switch(h){case 0:break;case 1:o=!0,a.push(r.clone());break;case 2:o=!1,a.length>1?(i.push(a.slice()),a=[]):r.set(0,0);break;case 3:l++,n/=t[l];break;case 4:l++,n*=t[l];break;case 5:if(4===s.length)throw"The position stack is only four locations deep";s.push(r);break;case 6:r=s.pop(),a.length>1&&(i.push(a.slice()),a=[]),o&&a.push(r.clone());break;case 7:{let s,o=0,h=n*e.baseUp,u=r.clone();switch(a.length>1&&(i.push(a.slice()),a=[]),e.fontType){case 0:l++,o=t[l];break;case 1:l++,o=t[l],0==o&&(l++,o=cr.ToUInt16(new Uint8Array([t[l++],t[l++]]),0),u.x=t[l++]*n,u.y=t[l++]*n,h=t[l]*n);break;case 2:l+=2,o=cr.ToUInt16(new Uint8Array([t[l-1],t[l]]),0)}0!==o&&(s=e.getGraphicDataByCodeWithOffset(o,h,u),s&&(i.push(...s.polylines.slice()),r=s.lastPoint.clone()))}break;case 8:{let e=new Te;e.x=cr.byteTosbyte(t[++l]),e.y=cr.byteTosbyte(t[++l]),r.add(e.multiplyScalar(n)),o&&a.push(r.clone())}break;case 9:for(;;){let e=new Te;if(e.x=cr.byteTosbyte(t[++l]),e.y=cr.byteTosbyte(t[++l]),0==e.x&&0==e.y)break;r.add(e.multiplyScalar(n)),o&&a.push(r.clone())}break;case 10:{let e=t[++l]*n,i=cr.byteTosbyte(t[++l]),s=(112&i)>>4,h=7&i;0==h&&(h=8);let u=Math.PI/4,c=u*h,d=Bh.CIRCLE_SPAN;i<0&&(d=-d,c=-c);let p=u*s,f=p+c,m=r.clone().sub(new Te(Math.cos(p)*e,Math.sin(p)*e));if(r=m.clone().add(new Te(Math.cos(f)*e,Math.sin(f)*e)),o){let t=p,n=!0;for(;n&&(t+=d,i>=0&&t<f||i<0&&t>f);)a.push(m.clone().add(new Te(e*Math.cos(t),e*Math.sin(t))));a.push(r.clone())}}break;case 11:{let e=t[++l],i=t[++l],s=(255*t[++l]+t[++l])*n,h=cr.byteTosbyte(t[++l]),u=(112&h)>>4,c=7&h;0==c&&(c=8),0!=i&&c--;let d=Math.PI/4,p=d*c,f=Bh.CIRCLE_SPAN,m=1;h<0&&(f=-f,p=-p,m=-1);let g=d*u,v=g+p;g+=d*e/256*m,v+=d*i/256*m;let y=r.clone().sub(new Te(s*Math.cos(g),s*Math.sin(g)));if(r=y.clone().add(new Te(s*Math.cos(v),s*Math.sin(v))),o){let e=g,t=!0;for(;t&&(e+=f,h>0&&e<v||h<0&&e>v);)a.push(y.clone().add(new Te(s*Math.cos(e),s*Math.sin(e))));a.push(r.clone())}}break;case 12:{let e=new Te;e.x=cr.byteTosbyte(t[++l])*n,e.y=cr.byteTosbyte(t[++l])*n;let i=cr.byteTosbyte(t[++l]);i<-127&&(i=-127),o&&(0==i?a.push(r.clone().add(e)):a.push(Bh.generateArcPoints(r,e,i/127))),r.add(e)}break;case 13:for(;;){let e=new Te;if(e.x=cr.byteTosbyte(t[++l])*n,e.y=cr.byteTosbyte(t[++l])*n,0==e.x&&0==e.y)break;let i=cr.byteTosbyte(t[++l]);i<-127&&(i=-127),o&&(0==i?a.push(r.clone().add(e)):a.push(Bh.generateArcPoints(r.clone(),e,i/127))),r.add(e)}break;case 14:l=Bh.skipCode(e,t,++l);break;default:if(h>15){let e=(240&h)>>4,t=15&h,i=new Te;switch(t){case 0:i.x=1;break;case 1:i.x=1,i.y=.5;break;case 2:i.x=1,i.y=1;break;case 3:i.x=.5,i.y=1;break;case 4:i.y=1;break;case 5:i.x=-.5,i.y=1;break;case 6:i.x=-1,i.y=1;break;case 7:i.x=-1,i.y=.5;break;case 8:i.x=-1;break;case 9:i.x=-1,i.y=-.5;break;case 10:i.x=-1,i.y=-1;break;case 11:i.x=-.5,i.y=-1;break;case 12:i.y=-1;break;case 13:i.x=.5,i.y=-1;break;case 14:i.x=1,i.y=-1;break;case 15:i.x=1,i.y=-.5}r.add(i.multiplyScalar(e*n)),o&&a.push(r.clone())}}}return new pu(r,i)}static skipCode(e,t,n){switch(t[n]){case 0:case 1:case 2:case 5:case 6:case 14:default:break;case 3:case 4:n++;break;case 7:switch(e.fontType){case 0:n++;break;case 1:0==t[++n]&&(n+=6);break;case 2:n+=2}break;case 8:case 10:n+=2;break;case 9:for(;;){let e=t[++n],r=t[++n];if(0==e&&0==r)break}break;case 11:n+=5;break;case 12:n+=3;break;case 13:for(;;){let e=t[++n],r=t[++n];if(0==e&&0==r)break;t[++n]}}return n}static generateArcPoints(e,t,n){let r=e.clone().add(t),i=n<0;n=Math.abs(n);let a=t.length()/2,s=a*n,o=2*Math.atan(1/n),l=new Te(t.y,-t.x);l.normalize(),l.multiplyScalar(s);let h=Math.abs(a/Math.sin(o/2)),u=e.add(t.divideScalar(2));!1!==i?u.add(l):u.sub(l);let c=e.sub(u),d=r.sub(u),p=Math.atan2(c.y,c.x),f=Math.atan2(d.y,d.x),m=Bh.CIRCLE_SPAN;i?(m=-m,p<f&&(p+=2*Math.PI)):p>f&&(p-=2*Math.PI);let g=p;for(;;){if(g+=m,!i&&g<f||i&&g>f)return u.add(new Te(h*Math.cos(g),h*Math.sin(g)));break}return r}},Sl=Bh;Sl.FILE_STOP_FLAG=["\r","\n",""],Sl.CIRCLE_SPAN=Math.PI/18;var Tx=ca(xfe(),1),Uh=class{constructor(e,t){this.endian=t&&"big"===t?"big":"little",this.position=0,this.data=new DataView(e)}readAsciiString(e){if(this.data.byteLength<this.position+e)throw"range error";let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(this.data.getInt8(this.position+n));return this.position+=e,t}readUtf8String(e){let t=this.readBytes(e);return this.decoder||(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(t)}readBytes(e=1){if(this.data.byteLength<this.position+e)throw"range error";let t=new Uint8Array(e);for(let n=0;n<e;n++)t[n]=this.data.getUint8(this.position+n);return this.position+=e,t}readUint8(){if(this.data.byteLength<this.position+1)throw"range error";let e=this.data.getUint8(this.position);return this.position+=1,e}readInt8(){if(this.data.byteLength<this.position+1)throw"range error";let e=this.data.getInt8(this.position);return this.position+=1,e}readUint16(){if(this.data.byteLength<this.position+2)throw"range error";let e=this.data.getUint16(this.position,"little"===this.endian);return this.position+=2,e}readInt16(){if(this.data.byteLength<this.position+2)throw"range error";let e=this.data.getInt16(this.position,"little"===this.endian);return this.position+=2,e}readUint32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getUint32(this.position,"little"===this.endian);return this.position+=4,e}readInt32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getInt32(this.position,"little"===this.endian);return this.position+=4,e}readFloat32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getFloat32(this.position,"little"===this.endian);return this.position+=4,e}readFloat64(){if(this.data.byteLength<this.position+8)throw"range error";let e=this.data.getFloat64(this.position,"little"===this.endian);return this.position+=8,e}readInt64(){if(this.data.byteLength<this.position+8)throw"range error";let e=Tx.default.DataViewGetBigInt64(this.data,this.position,"little"===this.endian);return this.position+=8,Tx.default.toNumber(e)}readUint64(){if(this.data.byteLength<this.position+8)throw"range error";let e=Tx.default.DataViewGetBigUint64(this.data,this.position,"little"===this.endian);return this.position+=8,Tx.default.toNumber(e)}getPosition(){return this.position}setPosition(e){if(this.data.byteLength<e)throw"range error";this.position=e}isEnd(){return this.position===this.data.byteLength-1}},bfe=new Tn,JA=class extends c0{constructor(e,t){if(super(e,t),this.isExtend=!1,this.isUniCode=!0,this.isEmbedded=!1,this.fontType=2,this.textShapesCache=new Map,this.graphicData=new Map,t instanceof ArrayBuffer){let e=new Uh(t),n=Sl.parserHeader(e,Sl.FILE_STOP_FLAG).split(" ");switch(n[1]){case"shapes":this.parseShapeFont(e),this.fontType=0;break;case"bigfont":this.parseBigFont(e),this.fontType=1;break;case"unifont":this.parseUniFont(e),this.fontType=2}this.fileHeader=n[0],this.fileVersion=n[2]}else this.setFontFile(t)}generateShapes(e,t){let n=[],r=0;for(let i=0;i<e.length;i++){let a=e[i];if(" "===a){r+=t;continue}let s=this.getCharShape(a,t);s?(n.push(s.offset(new Te(r,0))),r+=s.width):(r+=t,this.addUnsupportedChar(a))}return n}getCharShape(e,t){yfe(e)&&(e=vfe(e));let n=Sl.getCode(e);0===n&&(n=e.charCodeAt(0));let r=this.getGraphicDataByCode(n,t);return r&&0===r.polylines.length&&(r.width=t),r}getGraphicDataByCode(e,t){let n=`${e}_${t}`;if(this.textShapesCache.has(n))return this.textShapesCache.get(n);if(0===e)return;let r,i=this.data;if(!this.graphicData.has(e))if(i[e]){let t=i[e],n=JA.DEFAULT_SIZE/this.baseUp;r=Sl.parserCode(this,t,n),this.graphicData.set(e,r)}else if(ZA[e]){let t=[];for(let n=0;n<ZA[e].length;n++)t.push(ZA[e][n].map((e=>new Te(e[0],e[1]))));r=new pu(new Te,t),this.graphicData.set(e,r)}if(this.graphicData.has(e)){let n=t/JA.DEFAULT_SIZE;bfe.identity().scale(n,n),r=this.graphicData.get(e).transform(bfe)}return r}getGraphicDataByCodeWithOffset(e,t,n){var r;return null==(r=this.getGraphicDataByCode(e,t))?void 0:r.offset(n)}parseBigFont(e){cr.ToInt16(e.readBytes(2),0);let t=cr.ToInt16(e.readBytes(2),0),n=cr.ToInt16(e.readBytes(2),0);for(let t=0;t<n;t++)e.readBytes(2),e.readBytes(2);let r=[];for(let n=0;n<t;n++){let t=e.readBytes(8),n=cr.ToUInt16(new Uint8Array([t[1],t[0]]),0),i=cr.ToUInt16(t,2),a=cr.ToUInt32(t,4);0===n&&0===i&&0===a||r.push({code:n,length:i,offset:a})}let i={};for(let t of r)e.setPosition(t.offset),i[t.code]=e.readBytes(t.length);let a=i[0],s=(this.info=oft(a)).indexOf("\0")+1;a.length-s==4?(this.baseUp=a[s++],this.baseDown=a[s++],this.orientation=a[s++]):(this.baseUp=a[s++],s++,this.orientation=a[s++],this.baseDown=a[s++],this.isExtend=!0),this.data=i}parseUniFont(e){let t=cr.ToInt32(e.readBytes(4),0),n=cr.ToInt16(e.readBytes(2),0),r=e.readBytes(n),i=(this.info=(new TextDecoder).decode(r)).indexOf("\0");this.baseUp=r[++i],this.baseDown=r[++i],this.orientation=r[++i],this.isUniCode=0==r[++i],this.isEmbedded=0==r[++i];let a={};for(let n=0;n<t-1;n++){let t=cr.ToUInt16(e.readBytes(2),0),n=cr.ToUInt16(e.readBytes(2),0);a[t]=e.readBytes(n)}this.data=a}parseShapeFont(e){e.readBytes(2),e.readBytes(2);let t=cr.ToInt16(e.readBytes(2),0),n=[];for(let r=0;r<t;r++){let t=cr.ToUInt16(e.readBytes(2),0),r=cr.ToUInt16(e.readBytes(2),0);n.push({code:t,length:r})}let r={};for(let t of n)r[t.code]=e.readBytes(t.length);let i=r[0],a=(this.info=(new TextDecoder).decode(i)).indexOf("\0");this.baseUp=i[++a],this.baseDown=i[++a],this.orientation=i[++a],this.data=r}getNotFoundTextShape(e){let t=0;return 1===this.fontType&&(t=Sl.getCode("ï¼")),2===this.fontType&&(t=Sl.getCode("?")),this.getGraphicDataByCode(t,e)}getFontFile(){return{fontType:this.fontType,order:this.order,data:this.data,info:this.info,orientation:this.orientation,baseUp:this.baseUp,baseDown:this.baseDown,fileName:this.fileName,fileHeader:this.fileHeader,fileVersion:this.fileVersion}}setFontFile(e){this.fileName=e.fileName,this.fontType=e.fontType||2,this.data=e.data,this.info=e.info,this.order=e.order,this.orientation=e.orientation,this.baseUp=e.baseUp,this.baseDown=e.baseDown,this.fileHeader=e.fileHeader,this.fileVersion=e.fileVersion}releaseFontData(){super.releaseFontData(),this.graphicData.clear(),this.textShapesCache.clear()}},mu=JA;function oft(e){let t,n,r,i,a;t="";let s=e.length;for(n=0;n<s;)switch(r=e[n++],r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:i=e[n++],t+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=e[n++],a=e[n++],t+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&a)<<0)}return t}mu.DEFAULT_SIZE=12;var Ja=class{constructor(){this.fontMap=new Map,this.unsupportedChars={},this.missingFonts={},this.enableFontCache=!0,this.loader=new Ls}loadFonts(e){return Et(this,null,(function*(){if(e=Array.isArray(e)?e:[e],this.fileNames=e.map((e=>Ja.getFileName(e.toLowerCase()))),!(yield this.checkAllFontsLoaded(e))){for(let t=0;t<e.length;t++){let n,r=e[t],i=Ja.getFileName(r).toLowerCase();if(Ja.isJsonFile(r)){this.loader.setResponseType("json");let e=yield this.loader.loadAsync(r);n=new Nh(i,e)}else if(Ja.isShxFile(r)){this.loader.setResponseType("arraybuffer");let e=yield this.loader.loadAsync(r);n=new mu(i,e)}else if(Ja.isTtfFile(r)){this.loader.setResponseType("arraybuffer");let e=yield this.loader.loadAsync(r);n=new Nh(i,e)}n&&(n.order=t+1,this.fontMap.set(i,n))}this.enableFontCache&&Bn.isBrowser&&(this.fontMap.forEach((e=>Et(this,null,(function*(){yield e.setFontDataToIndexedDb()})))),this.releaseFontData())}}))}getTextShape(e,t,n){if(0===this.fontMap.size)return void fe.warn("[FontManager] no font loaded.");let r=this.fontMap.get(t.toLowerCase());return r||(r=this.fontMap.get(this.fontMap.keys().next().value),this.missingFonts[t]||(this.missingFonts[t]=0),this.missingFonts[t]++),null==r?void 0:r.generateShapes(e,n)}getCharShape(e,t,n){if(0===this.fontMap.size)return void fe.warn("[FontManager] no font loaded.");null==t&&(t="");let r=this.fontMap.get(t.toLowerCase());if(!r){this.missingFonts[t]||(this.missingFonts[t]=0),this.missingFonts[t]++;for(let[t,i]of this.fontMap)if(i.getCharShape(e,n)){r=i;break}}let i=null==r?void 0:r.getCharShape(e,n);if(i){if(r instanceof mu)return i.toThreeGeometry();if(r instanceof Nh)return new DA(e,{font:r,depth:0,size:n||12,curveSegments:3,bevelSegments:3})}}getNotFoundTextShape(e){let t,n;for(let[r,i]of this.fontMap){let r=i.getNotFoundTextShape(e);if(r){t=r,n=i;break}}return n instanceof mu?t.toThreeGeometry():n instanceof Nh?new rs(t.toShapes(!1),{curveSegments:3,bevelSegments:3}):void 0}checkAllFontsLoaded(e){return Et(this,null,(function*(){if(!Bn.isBrowser)return!1;let t=!1;for(let n=0;n<e.length;n++){let r=e[n],i=Ja.getFileName(r.toLowerCase()),a=yield du.instance().query(i);if(!a){t=!1;break}if(t=!0,void 0!==a.codes){t=!1;break}}return t}))}getFontFromIndexeddb(){return Et(this,null,(function*(){if(0!==this.fontMap.size)return;let e=(yield du.instance().queryAll()).sort(((e,t)=>e.order-t.order));for(let t=0;t<e.length;t++){let n,r=e[t],{fileName:i,fontType:a}=r;this.fileNames&&!this.fileNames.includes(i)||(n=a?new mu(i,r):new Nh(i,r),this.fontMap.set(i,n))}fe.debug("[FontManager] Loaded font data from cache.")}))}isShxFont(e){if(0===this.fontMap.size)return void fe.warn("[FontManager] no font loaded.");let t=this.fontMap.get(e);return t||(t=this.fontMap.get(this.fontMap.keys().next().value),this.missingFonts[e]||(this.missingFonts[e]=0),this.missingFonts[e]++),t instanceof mu}getUnsupportedChar(){return this.fontMap.forEach((e=>{Object.assign(this.unsupportedChars,e.unsupportedChars)})),this.unsupportedChars}releaseFontData(){this.fontMap.forEach((e=>{e.releaseFontData()})),this.fontMap.clear()}destroy(){this.releaseFontData(),this.fontMap.clear()}static isShxFile(e){return"shx"===Ct.getExtension(e)}static isTtfFile(e){return["WOFF","OTF","TTF"].includes(Ct.getExtension(e).toUpperCase())}static isJsonFile(e){return"json"===Ct.getExtension(e)}static getFileName(e){let t=e.lastIndexOf("/");return e.substring(t+1)}},u0=class{constructor(){this.TIMEOUT="timeout",this.INTERVAL="interval",this.timeoutMap={},this.intervalMap={}}run(e=this.INTERVAL,t,n=16.7){let r=Date.now,i=r(),a=i,s=Symbol(""),o=()=>{this.setIdMap(s,e,o),a=r(),a-i>=n&&(e===this.intervalMap&&(i=r(),a=i),t(),e===this.TIMEOUT&&this.clearTimeout(s))};return this.setIdMap(s,e,o),s}setIdMap(e,t,n){let r=requestAnimationFrame(n);t===this.INTERVAL?this.intervalMap[e]=r:t===this.TIMEOUT&&(this.timeoutMap[e]=r)}setTimeout(e,t){return this.run(this.TIMEOUT,e,t)}clearTimeout(e){cancelAnimationFrame(this.timeoutMap[e])}setInterval(e,t){return this.run(this.INTERVAL,e,t)}clearInterval(e){cancelAnimationFrame(this.intervalMap[e])}},zde=ca(Nfe(),1),qfe="3.7.5",vft=qfe,yft="function"==typeof atob,xft="function"==typeof btoa,d0="function"==typeof Buffer,Bfe="function"==typeof TextDecoder?new TextDecoder:void 0,Ufe="function"==typeof TextEncoder?new TextEncoder:void 0,bft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Sx=Array.prototype.slice.call(bft),rC=(e=>{let t={};return Sx.forEach(((e,n)=>t[e]=n)),t})(),Eft=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,bs=String.fromCharCode.bind(String),Hfe="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Gfe=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),Wfe=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),jfe=e=>{let t,n,r,i,a="",s=e.length%3;for(let s=0;s<e.length;){if((n=e.charCodeAt(s++))>255||(r=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=n<<16|r<<8|i,a+=Sx[t>>18&63]+Sx[t>>12&63]+Sx[t>>6&63]+Sx[63&t]}return s?a.slice(0,s-3)+"===".substring(s):a},_N=xft?e=>btoa(e):d0?e=>Buffer.from(e,"binary").toString("base64"):jfe,bN=d0?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let n=0,r=e.length;n<r;n+=4096)t.push(bs.apply(null,e.subarray(n,n+4096)));return _N(t.join(""))},iC=(e,t=!1)=>t?Gfe(bN(e)):bN(e),_ft=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?bs(192|t>>>6)+bs(128|63&t):bs(224|t>>>12&15)+bs(128|t>>>6&63)+bs(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return bs(240|t>>>18&7)+bs(128|t>>>12&63)+bs(128|t>>>6&63)+bs(128|63&t)},Tft=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Xfe=e=>e.replace(Tft,_ft),Vfe=d0?e=>Buffer.from(e,"utf8").toString("base64"):Ufe?e=>bN(Ufe.encode(e)):e=>_N(Xfe(e)),f0=(e,t=!1)=>t?Gfe(Vfe(e)):Vfe(e),zfe=e=>f0(e,!0),Sft=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wft=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return bs(55296+(t>>>10))+bs(56320+(1023&t));case 3:return bs((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return bs((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},Yfe=e=>e.replace(Sft,wft),$fe=e=>{if(e=e.replace(/\s+/g,""),!Eft.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,r,i="";for(let a=0;a<e.length;)t=rC[e.charAt(a++)]<<18|rC[e.charAt(a++)]<<12|(n=rC[e.charAt(a++)])<<6|(r=rC[e.charAt(a++)]),i+=64===n?bs(t>>16&255):64===r?bs(t>>16&255,t>>8&255):bs(t>>16&255,t>>8&255,255&t);return i},TN=yft?e=>atob(Wfe(e)):d0?e=>Buffer.from(e,"base64").toString("binary"):$fe,Zfe=d0?e=>Hfe(Buffer.from(e,"base64")):e=>Hfe(TN(e).split("").map((e=>e.charCodeAt(0)))),Kfe=e=>Zfe(Jfe(e)),Mft=d0?e=>Buffer.from(e,"base64").toString("utf8"):Bfe?e=>Bfe.decode(Zfe(e)):e=>Yfe(TN(e)),Jfe=e=>Wfe(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),EN=e=>Mft(Jfe(e)),Aft=e=>{if("string"!=typeof e)return!1;let t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},Qfe=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ede=function(){let e=(e,t)=>Object.defineProperty(String.prototype,e,Qfe(t));e("fromBase64",(function(){return EN(this)})),e("toBase64",(function(e){return f0(this,e)})),e("toBase64URI",(function(){return f0(this,!0)})),e("toBase64URL",(function(){return f0(this,!0)})),e("toUint8Array",(function(){return Kfe(this)}))},tde=function(){let e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,Qfe(t));e("toBase64",(function(e){return iC(this,e)})),e("toBase64URI",(function(){return iC(this,!0)})),e("toBase64URL",(function(){return iC(this,!0)}))},Cft=()=>{ede(),tde()},nde={version:qfe,VERSION:vft,atob:TN,atobPolyfill:$fe,btoa:_N,btoaPolyfill:jfe,fromBase64:EN,toBase64:f0,encode:f0,encodeURI:zfe,encodeURL:zfe,utob:Xfe,btou:Yfe,decode:EN,isValid:Aft,fromUint8Array:iC,toUint8Array:Kfe,extendString:ede,extendUint8Array:tde,extendBuiltins:Cft},Bo=ca(bde(),1),p0="BYLAYER",m0="BYBLOCK",Ede=(e=>(e[e.Mesh=-1]="Mesh",e[e.MeshWithPattern=0]="MeshWithPattern",e[e.LineWithWidth=1]="LineWithWidth",e[e.Line=2]="Line",e[e.LineWithPattern=3]="LineWithPattern",e[e.Point=4]="Point",e[e.Text=5]="Text",e))(Ede||{}),Xd=["INSERT","DIMENSION"],sC=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215],Uft="OriginalHandle",Hft="OriginalType",Vft="Outlines",_de=["PROXY","REGION","INSERT","HATCH"];function Yd(e){return sC[e]}function Tt(e){let t={},n=e.lastReadGroup,r=n.code;if(t.x=n.value,r+=10,n=e.next(),n.code!=r)throw new Error(`Expected code for point value to be ${r} but got ${n.code}`);return t.y=n.value,r+=10,n=e.next(),n.code!=r||(t.z=n.value,e.next()),t}function Tde(e,t){let n=e.lastReadGroup,r=[];for(let i=0;i<16;i++){if(n.code!==t)throw new Error(`Expected code for matrix value to be ${t} but got ${n.code}`);r.push(n.value),n=e.next()}return r}function fn(e,t){switch(t.code){case 0:e.type=t.value;break;case 5:e.handle=t.value;break;case 6:e.lineType=t.value.toUpperCase();break;case 8:e.layer=t.value;break;case 48:e.lineTypeScale=t.value,e.lineTypeScale<=0&&(e.lineTypeScale=1);break;case 60:e.visible=0===t.value;break;case 62:e.isTrueColor||(e.colorIndex=t.value,e.colorIndex<0&&fe.warn("[DxfParser] a negative value of colorIndex indicates that the layer is turned off"),e.color=Yd(Math.abs(t.value)));break;case 67:e.inPaperSpace=0!==t.value;break;case 100:case 1001:break;case 330:e.ownerHandle=t.value;break;case 347:e.materialObjectHandle=t.value;break;case 370:e.lineweight=t.value;break;case 410:e.layoutName=t.value;break;case 420:e.isTrueColor=!0,e.color=t.value;break;case 1e3:if(t.value&&t.value.includes(Uft)){let n=t.value.split(":").map((e=>e.trim()));e.extendedData||(e.extendedData={}),e.extendedData.originalHandle=n[1]}if(e.extendedData&&e.extendedData.outlines)try{e.extendedData.outlines=JSON.parse(t.value||"[]")}catch(t){e.extendedData.outlines=void 0}if(t.value&&t.value.includes(Vft)&&(e.extendedData||(e.extendedData={}),e.extendedData.outlines=[]),t.value&&t.value.includes(Hft)){let n=t.value.split(":").map((e=>e.trim()));e.extendedData||(e.extendedData={}),e.extendedData.originalType=n[1]}break;default:return!1}return!0}function No(e,t){switch(t.code){case 0:e.type=t.value;break;case 5:e.handle=t.value;break;case 330:e.ownerHandle=t.value;break;case 1e3:case 1001:break;default:return!1}return!0}var SN=(e=>(e.Added="Added",e.Removed="Removed",e.Modified="Modified",e.NoChange="NoChange",e))(SN||{}),ia=1,aC=class{constructor(e,t,n){if(this.changes={},this.comparedBlocks=new Map,this.isComparingBlock=!1,this.isComparingDimension=!1,this.enableDetailComparision=!0,this.dxf1=e,this.dxf2=t,this.enableDetailComparision=!n||(null==n?void 0:n.enableDetailComparision),!e||!t)throw new Error("Invalid dxf data to compare!")}getLayerFrozen(e,t){var n,r,i;let a=null==(r=null==(n=e.tables)?void 0:n.layer)?void 0:r.layers;return a&&(null==(i=a[t.layer])?void 0:i.frozen)}compare(e){return Et(this,null,(function*(){this.changes={};let t=[],n=new Map;return this.dxf1.entities.forEach((e=>{if(!0!==e.inPaperSpace){let n=!0===this.getLayerFrozen(this.dxf1,e);!aC.ENTITY_TYPES_TO_IGNORE.includes(e.type)&&!n&&t.push(e)}})),this.dxf2.entities.forEach((e=>{if(!0!==e.inPaperSpace){let t=!0===this.getLayerFrozen(this.dxf2,e);!aC.ENTITY_TYPES_TO_IGNORE.includes(e.type)&&!t&&n.set(e.handle,e)}})),yield this.compareEntities(t,n,e),Promise.resolve(this.changes)}))}isDimensionBlock(e){return e.includes("*D")}compareInsertOrDemensionEntities(e,t,n,r){if(!e.block||!t.block)return;let i,a=e.block;if(this.isComparingBlock=!0,this.isDimensionBlock(a)){let n=this.dxf1.blocks[e.block],r=this.dxf2.blocks[t.block],s=Date.now();this.isComparingDimension=!0,i=this.compareBlock(e,t,n,r),this.isComparingDimension=!1,fe.debug(`[DxfCompare] compare block: ${a} took ${(Date.now()-s)/1e3}s`)}else{if(!this.comparedBlocks.has(a)){let n=this.dxf1.blocks[a],r=this.dxf2.blocks[a],i=Date.now(),s=this.compareBlock(e,t,n,r);this.comparedBlocks.set(a,s),fe.debug(`[DxfCompare] compare block: ${a} took ${(Date.now()-i)/1e3}s`)}i=this.comparedBlocks.get(a)}return null==i||i.forEach((t=>{if(t.parentHandles||(t.parentHandles=[]),n&&r)"Added"===t.type?t.parentHandles.push(r):"Removed"===t.type&&t.parentHandles.push(n);else{let n=[...t.parentHandles,e.handle];("Added"===t.type||"Removed"===t.type)&&(this.changes[ia]=Ki(oi({id:ia},t),{parentHandles:n})),ia++}})),!n&&!r&&(this.isComparingBlock=!1),i}compareBlock(e,t,n,r){var i,a;let s=[],o=[];null==(i=null==n?void 0:n.entities)||i.forEach((e=>{"ATTDEF"!==e.type&&!this.bIgnoreChildEntitiesOriginalType(e)&&s.push(e)})),null==(a=null==r?void 0:r.entities)||a.forEach((e=>{"ATTDEF"!==e.type&&!this.bIgnoreChildEntitiesOriginalType(e)&&o.push(e)}));let l=[],h=[];for(let n=0;n<s.length;n++){let r=s[n],i=!1;0===o.length&&(i=!0),this.isComparingDimension||(this.isComparingDimension="DIMENSION"===r.type);for(let n=0;n<o.length;n++){let a=o[n];if(this.entitiesEqual(r,a,e,t)){if("INSERT"===r.type&&"INSERT"===a.type||"DIMENSION"===r.type&&"DIMENSION"===a.type){let e=this.compareInsertOrDemensionEntities(r,a,r.handle,a.handle);e&&e.length>0&&l.push(...e),i=!1,o.splice(n--,1);break}i=!1,o.splice(n--,1);break}i=!0}i&&(l.push({type:"Removed",handle:r.handle}),h.push(r.handle))}return o.forEach((e=>{h.includes(e.handle)||l.push({type:"Added",handle:e.handle})})),l}compareEntities(e,t,n){return Et(this,null,(function*(){var r,i;let a=Ct.getUpdateProgressFuncForLoop(e.length,n);for(let n=0;n<e.length;n++){let s=e[n].handle;if(t.has(s)){let a=e[n],o=t.get(s),l={};if(this.entitiesEqual(a,o,void 0,void 0,l)){if(Xd.includes(a.type)){if(this.bIgnoreChildEntitiesOriginalType(a)){t.delete(s),fe.warn(`[DxfCompare] We cannot compare insert (handle '${a.handle}') yet, ignored!`);continue}this.compareInsertOrDemensionEntities(a,o)}}else{if(null!=(r=a.extendedData)&&r.originalType&&null!=(i=o.extendedData)&&i.originalType&&a.block!==o.block){t.delete(s);continue}this.changes[ia]={id:ia,type:"Modified",handle:s},this.enableDetailComparision&&Object.keys(l).length>0&&(this.changes[ia].detailChanges=l),ia++}t.delete(s)}else this.changes[ia]={id:ia,type:"Removed",handle:s},ia++;yield a(n)}for(let e of t){let t=e[0];this.changes[ia]={id:ia,type:"Added",handle:t},ia++}}))}bIgnoreChildEntitiesOriginalType(e){var t;return _de.includes(null==(t=e.extendedData)?void 0:t.originalType)}entitiesEqual(e,t,n,r,i){if(!this.baseEntitiesEqual(e,t,n,r,i))return!1;let a=e.type,s=!0;return"CIRCLE"===a||"ARC"===a?s=this.arcsEqual(e,t):"LWPOLYLINE"===a||"LINE"===a?s=this.linesEqual(e,t,i):"POLYLINE"===a?s=this.polylinesEqual(e,t):"TEXT"===a?s=this.textsEqual(e,t):"SOLID"===a?s=this.solidsEqual(e,t):"POINT"===a?s=this.pointEntitiesEqual(e,t):"INSERT"===a?s=this.insertsEqual(e,t):"SPLINE"===a?s=this.splinesEqual(e,t):"MTEXT"===a?s=this.mtextsEqual(e,t):"ELLIPSE"===a?s=this.ellipsesEqual(e,t):"DIMENSION"===a?s=this.dimensionsEqual(e,t):"REGION"===a?s=this.regionsEqual(e,t):"ATTDEF"===a?s=this.attDefsEqual(e,t):"ATTRIB"===a?s=this.attribsEqual(e,t):"HATCH"===a?s=this.hatchesEqual(e,t):"VIEWPORT"===a?s=this.viewportsEqual(e,t):"LEADER"===a?s=this.leadersEqual(e,t):"MULTILEADER"===a?s=this.mleadersEqual(e,t):"OLE2FRAME"===a&&(s=this.ole2framesEqual(e,t)),s}getColor(e,t,n){var r,i,a,s,o,l;if(e.isTrueColor||e.colorIndex>0&&e.colorIndex<256)return e.color;if(0===e.colorIndex)return n?this.getColor(n,t):null==(i=null==(r=t.tables)?void 0:r.layer)?void 0:i.layers[0].color;let h=0;if(256===e.colorIndex){let r=null==(s=null==(a=t.tables)?void 0:a.layer)?void 0:s.layers,i=r&&r[e.layer],u=r&&n&&r[n.layer];h=i&&"0"!==i.name?i.color:u?u.color:i?i.color:null==(l=null==(o=t.tables)?void 0:o.layer)?void 0:l.layers[0].color}return h}getLineType(e,t,n){var r,i;if(n&&"DIMENSION"===n.type)return this.getLineType(n,t);if(e.lineType!==p0&&e.lineType!==m0)return e.lineType;if(e.lineType===m0)return n?this.getLineType(n,t):e.lineType;let a=null==(i=null==(r=t.tables)?void 0:r.layer)?void 0:i.layers;if("0"!==e.layer){let t=a&&a[e.layer];if(t)return t.lineType}else if(n){let e=a&&a[n.layer];if(e)return e.lineType}return"CONTINUOUS"}addModificationItem(e,t,n,r){r&&(r[n]={old:e,new:t})}baseEntitiesEqual(e,t,n,r,i){var a,s;let o=!0,l=this.getColor(e,this.dxf1,n),h=this.getColor(t,this.dxf2,r);if(l!==h){if(o=!1,!this.enableDetailComparision)return o;this.addModificationItem(l,h,"color",i)}let u=this.getLineType(e,this.dxf1,n),c=this.getLineType(t,this.dxf2,r);return u!==c?(o=!1,this.enableDetailComparision?(this.addModificationItem(u,c,"lineType",i),!1):o):!((null==(a=e.extendedData)?void 0:a.originalType)!==(null==(s=t.extendedData)?void 0:s.originalType)||!this.isComparingBlock&&!this.isComparingDimension&&e.handle!==t.handle||!this.isComparingDimension&&e.ownerHandle!==t.ownerHandle||e.type!==t.type)&&o}arcsEqual(e,t){return!!(this.vectorsEqual(e.center,t.center)&&this.numberEqual(e.radius,t.radius)&&this.numberEqual(e.startAngle,t.startAngle)&&this.numberEqual(e.endAngle,t.endAngle))}linesEqual(e,t,n){let r=!0,i=e.constantWidth,a=t.constantWidth;if(i!==a){if(r=!1,!this.enableDetailComparision)return!1;this.addModificationItem(i||0,a||0,"constantWidth",n)}return!(!this.verticesEqual(e.vertices,t.vertices)||e.shape!==t.shape)&&r}polylinesEqual(e,t){return!(!this.vertexEntitiesEqual(e.vertices,t.vertices)||e.shape!==t.shape||e.isPolyfaceMesh!==t.isPolyfaceMesh)}textsEqual(e,t){if(e.halign!==t.halign)return!1;if(3===e.halign||5===e.halign){if(!this.pointsEqual(e.startPoint,t.startPoint))return!1}else if(!this.pointsEqual(e.endPoint,t.endPoint))return!1;return e.text===t.text}solidsEqual(e,t){return!!this.verticesEqual(e.points,t.points)}pointEntitiesEqual(e,t){return!!this.pointsEqual(e.position,t.position)}splinesEqual(e,t){return!(!this.verticesEqual(e.controlPoints,t.controlPoints)||!this.numbersEqual(e.knotValues,t.knotValues)||!this.numberEqual(e.degreeOfSplineCurve,t.degreeOfSplineCurve))}mtextsEqual(e,t){return!(!this.pointsEqual(e.position,t.position)||e.text!==t.text||!this.numberEqual(e.rotation,t.rotation))}ellipsesEqual(e,t){return!!(this.pointsEqual(e.center,t.center)&&this.pointsEqual(e.majorAxisEndPoint,t.majorAxisEndPoint)&&this.numberEqual(e.axisRatio,t.axisRatio)&&this.numberEqual(e.startAngle,t.startAngle)&&this.numberEqual(e.endAngle,t.endAngle))}attDefsEqual(e,t){return!(!this.pointsEqual(e.startPoint,t.startPoint)||!this.pointsEqual(e.endPoint,t.endPoint)||!this.numberEqual(e.xScale,t.xScale)||e.text!==t.text||e.tag!==t.tag||e.prompt!==t.prompt)}attribsEqual(e,t){return this.attDefsEqual(e,t)}hatchesEqual(e,t){let n=e,r=t;return!!(this.numberEqual(n.elevationX,r.elevationX)&&this.numberEqual(n.elevationY,r.elevationY)&&this.numberEqual(n.elevationZ,r.elevationZ)&&this.hatchBoundaryPathArraysEqual(n.boundaryPaths,r.boundaryPaths))}viewportsEqual(e,t){let n=e,r=t;return!!(this.pointsEqual(n.centerPoint,r.centerPoint)&&this.pointsEqual(n.centerPoint_dcs,r.centerPoint_dcs)&&this.pointsEqual(n.viewDirection,r.viewDirection)&&this.numberEqual(n.viewHeight,r.viewHeight)&&n.width_paperSpace===r.width_paperSpace&&n.height_paperSpace===r.height_paperSpace)}leadersEqual(e,t){return!!(this.pointsEqual(e.position,t.position)&&this.verticesEqual(e.vertices,t.vertices)&&e.arrowHeadBlockHandle===t.arrowHeadBlockHandle&&this.numberEqual(e.arrowHeadSize,t.arrowHeadSize)&&this.numberEqual(e.rotation,t.rotation)&&e.block===t.block)}mleadersEqual(e,t){return!(e.arrowHeadId!==t.arrowHeadId||!this.numberEqual(e.arrowHeadSize,t.arrowHeadSize))&&this.mleaderContextEqual(e.contextData,t.contextData)}ole2framesEqual(e,t){return!(e.leftUpX!==t.leftUpX||e.leftUpY!==t.leftUpY||e.leftUpZ!==t.leftUpZ||e.rightDownX!==t.rightDownX||e.rightDownY!==t.rightDownY||e.rightDownZ!==t.rightDownZ)}insertsEqual(e,t){var n,r,i,a;return"INSERT"===(null==(n=e.extendedData)?void 0:n.originalType)&&"INSERT"===(null==(r=t.extendedData)?void 0:r.originalType)?(fe.warn(`[DxfCompare] We cannot compare insert (handle '${e.handle}') yet, ignored!`),!0):!!(this.pointsEqual(e.position,t.position)&&this.numberEqual(void 0===e.xScale?1:e.xScale,void 0===t.xScale?1:t.xScale)&&this.numberEqual(void 0===e.yScale?1:e.yScale,void 0===t.yScale?1:t.yScale)&&this.numberEqual(void 0===e.zScale?1:e.zScale,void 0===t.zScale?1:t.zScale)&&e.block===t.block&&(null==(i=e.entities)?void 0:i.length)===(null==(a=t.entities)?void 0:a.length))}dimensionsEqual(e,t){return!!this.pointsEqual(e.anchorPoint,t.anchorPoint)}regionsEqual(e,t){return fe.warn("Cannot compare region yet!"),!0}vectorsEqual(e,t){return!e&&!t||!(!e||!t)&&(this.numberEqual(e.x,t.x)&&this.numberEqual(e.y,t.y)&&this.numberEqual(e.z,t.z))}pointsEqual(e,t){return!e&&!t||!(!e||!t)&&(this.numberEqual(e.x,t.x)&&this.numberEqual(e.y,t.y)&&this.numberEqual(e.z,t.z)&&this.numberEqual(e.bulge,t.bulge))}vertexEntityEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e,t)||e.polyfaceMeshVertex!==t.polyfaceMeshVertex||e.threeDPolylineMesh!==t.threeDPolylineMesh)}numbersEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.numberEqual(e[n],t[n]))return!1;return!0}return!1}numberEqual(e,t){return null==e&&null==t||null!=e&&null!=t&&Bt.areNumbersEqual(e,t)}vectorArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.vectorsEqual(e[n],t[n]))return!1;return!0}return!1}verticesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.pointsEqual(e[n],t[n]))return!1;return!0}return!1}verticesArrayEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.verticesEqual(e[n],t[n]))return!1;return!0}return!1}vertexEntitiesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.vertexEntityEqual(e[n],t[n]))return!1;return!0}return!1}hatchEdgesEqual(e,t){return!e&&!t||!(!e||!t)&&e.type===t.type}hatchEdgeArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.hatchEdgesEqual(e[n],t[n]))return!1;return!0}return!1}hatchBoundaryPathsEqual(e,t){return!e&&!t||!(!e||!t)&&(e.pathTypeFlag===t.pathTypeFlag&&this.hatchEdgeArraysEqual(e.edges,t.edges))}hatchBoundaryPathArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.hatchBoundaryPathsEqual(e[n],t[n]))return!1;return!0}return!1}mleaderLineEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.verticesArrayEqual(e.vertices,t.vertices)||e.leaderLineIndex!==t.leaderLineIndex)}mleaderLinesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.mleaderLineEqual(e[n],t[n]))return!1;return!0}return!1}mleaderLeaderEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e.lastLeaderLinePoint,t.lastLeaderLinePoint)||!this.pointsEqual(e.doglegVector,t.doglegVector)||!this.mleaderLinesEqual(e.leaderLines,t.leaderLines))}mleaderLeadersEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!this.mleaderLeaderEqual(e[n],t[n]))return!1;return!0}return!1}mleaderContextEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e.contentBasePosition,t.contentBasePosition)||!this.pointsEqual(e.blockContentPosition,t.blockContentPosition)||!this.mleaderLeadersEqual(e.leaders,t.leaders))}compareHexStrings(e,t){return parseInt(e,16)-parseInt(t,16)}},cs=aC;cs.ENTITY_COLOR_ADDED=65280,cs.ENTITY_COLOR_REMOVED=16711680,cs.ENTITY_COLOR_NO_CHANGE=10066329,cs.ENTITY_COLOR_MARKUP=16744231,cs.ENTITY_TYPES_TO_IGNORE=["ATTRIB","SEQEND"];var wN=new Ft,MN=new At,nn=class{constructor(e=0){this.name="",this.type=0,this.matrix=new At,this.children=[],this.layers=new uh,this.renderOrder=0,this.userData={},this.type=e}add(e,...t){for(let e=0;e<t.length;e++)this.add(t[e]);return e===this?(console.error("object can't be added as a child of itself.",e),this):(e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),this)}remove(e,...t){for(let e=0;e<t.length;e++)this.remove(t[e]);let n=this.children.indexOf(e);return-1!==n&&(e.parent=void 0,this.children.splice(n,1)),this}removeFromParent(){let e=this.parent;return e&&e.remove(this),this}clear(){this.material=void 0,this.geometry=void 0;for(let e=0;e<this.children.length;e++){this.children[e].parent=void 0}return this.children.length=0,this}traverse(e){e(this);let t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}clone(e=!0){return(new nn).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.type=e.type,this.matrix.copy(e.matrix),this.layers.mask=e.layers.mask,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),this.material=e.material,this.geometry=e.geometry,!0===t)for(let t=0;t<e.children.length;t++){let n=e.children[t];this.add(n.clone())}return this}convertToThreejsObject(e=!0){let t;switch(this.type){case 0:t=new Cn;break;case 1:if(!this.geometry)return;t=new Ni(this.geometry,this.material);break;case 2:if(!this.geometry)return;t=new ti(this.geometry,this.material);break;case 3:if(!this.geometry)return;t=new ni(this.geometry,this.material);break;case 4:if(!this.geometry)return;t=new Jt(this.geometry,this.material)}if(t){if(t.name=this.name,t.matrixAutoUpdate=!1,t.applyMatrix4(this.matrix),t.layers.mask=this.layers.mask,t.renderOrder=this.renderOrder,t.userData=this.userData,!0===e)for(let n=0;n<this.children.length;n++){let r=this.children[n].convertToThreejsObject(e);r&&t.add(r)}return t}}static getBox(e,t,n){if(e.geometry)e.geometry.boundingBox||e.geometry.computeBoundingBox(),MN.copy(e.matrix),n&&MN.premultiply(n),wN.copy(e.geometry.boundingBox),wN.applyMatrix4(MN),t.union(wN);else if(e.children.length>0){e.matrixWorld||(e.matrixWorld=new At),e.matrixWorld.copy(e.matrix),n&&e.matrixWorld.premultiply(n);let r=e.children;for(let n=0,i=r.length;n<i;n++)this.getBox(r[n],t,e.matrixWorld)}return t}},oC=new At,qft=new At,wl=class{static resetMergeInfo(){this.MergeInfo.removedObjects=0,this.MergeInfo.mergedMeshes=0,this.MergeInfo.mergedLines=0,this.MergeInfo.mergedPoints=0,this.MergeInfo.mergedUnknownTypeObjects=0,this.MergeInfo.elapsedTime=0}static merge(e,t=!0){let n=Date.now();this.mergeInner(e,t),this.MergeInfo.elapsedTime+=Date.now()-n}static mergeInner(e,t=!0){if(!e.children||e.children.length<1)return;let n=e.children.length,r={},i=[];for(let a=0;a<n;++a){let n=e.children[a];if(n.children.length>0){this.mergeInner(n,t);continue}if(n.userData.relativeToCenter||!n.geometry)continue;let s=!1,o=Object.values(r);for(let t=o.length-1;t>=0;--t){let n=o[t].indexes[0];if(s=this.tryHandleMergeableObjects(e,a,n,r,i),s)break}for(let t=i.length-1;!s&&t>=0;--t){let n=i[t];if(s=this.tryHandleMergeableObjects(e,a,n,r,i),s)break}s||i.push(a)}if(Object.keys(r).length<=0)return;let a=[],s=[],o=[],l=[];Object.values(r).forEach((n=>{let r,i=n.indexes,h=e.children[i[0]],u=[],c=0,d=0,p=0,f=[];if(i.forEach((n=>{var r,i,a,s;let o=e.children[n],l=null==(r=o.geometry)?void 0:r.clone();if(l.applyMatrix4(o.matrix),l.userData.isLineSegments=3===o.type,u.push(l),t){let e=null==(a=null==(i=l.attributes)?void 0:i.position)?void 0:a.count,t=(null==(s=l.index)?void 0:s.count)||0;f.push({batchId:c,positionStart:d,positionCount:e,indexStart:p,indexCount:t}),d+=e,p+=t,c++}})),0!==u.length){if(4===h.type){let e=ri(u);if(!e)return;e.userData={},r=new nn(h.type),r.geometry=e,r.material=h.material,a.push(r)}else if(2===h.type||3===h.type){let e=bi.mergeLineGeometries(u,t,h.material instanceof Kl||h.material instanceof fr,f);if(!e)return;r=new nn(3),r.geometry=e,r.material=h.material,s.push(r)}else if(1===h.type){let e=ri(u);if(!e)return;e.userData={},r=new nn(h.type),r.geometry=e,r.material=h.material,o.push(r)}r&&(t?r.userData.batches=f:(r.userData=h.userData,r.userData.batches=void 0),r.userData.layerName=h.userData.layerName,r.name=`[Merged] ${h.name}`,r.renderOrder=h.renderOrder,r.layers.mask=h.layers.mask,l.push(...i)),u.forEach((e=>{e.dispose(),Gt.releaseGeometryManually(e)})),u=[]}})),l.sort(((e,t)=>t-e)),l.forEach((t=>{let n=e.children[t];e.remove(n)})),[...a,...s,...o].forEach((t=>{e.add(t)})),this.MergeInfo.removedObjects+=l.length,this.MergeInfo.mergedMeshes+=a.length,this.MergeInfo.mergedLines+=s.length,this.MergeInfo.mergedPoints+=o.length}static tryHandleMergeableObjects(e,t,n,r,i){let a=!1,s=Array.isArray(e),o=s?e.length:e.children.length;if(t===n||t>=o||n>=o)return a;let l=s?e[t]:e.children[t],h=s?e[n]:e.children[n];return this.areObjectsMergeable(l,h)&&bi.areGeometriesMergeable(l.geometry,h.geometry)&&Fs.materialsEquals(l.material,h.material)&&(r[n]||(r[n]={indexes:[n]},this.removeFromArray(i,n)),r[n].indexes.push(t),a=!0),a}static isFilteredByOtherFactors(e,t){let n=e;if(4===n.type&&n.material&&n.material.isShaderMaterial)return!0;let r=!1,i=e;for(;i&&i!==t;){let e=i.userData;if(e.relativeToCenter||e.spatialFilterHandle){r=!0;break}i=i.parent}return r}static deepMerge(e,t=void 0,n=!0,r=!0,i=!0){let a={added:[],removed:[]};if(e.length<=1)return a;let s=Date.now(),o={},l=[];for(let n=0;n<e.length;++n){if(!e[n].geometry||this.isFilteredByOtherFactors(e[n],t))continue;let r=!1,i=Object.values(o);for(let t=i.length-1;t>=0;--t){let a=i[t].indexes[0];if(r=this.tryHandleMergeableObjects(e,n,a,o,l),r)break}for(let t=l.length-1;!r&&t>=0;--t){let i=l[t];if(r=this.tryHandleMergeableObjects(e,n,i,o,l),r)break}r||l.push(n)}if(Object.keys(o).length<=0)return a;fe.debug(`[Merge] Built merged indexes for ${e.length} objects in ${(Date.now()-s)/1e3}s`),s=Date.now();let h=[],u=[],c=[],d=[];Object.values(o).forEach((n=>{let r=n.indexes;if(r.length<2)return;let a,s=e[r[0]],o=[],l=0,p=0,f=0,m=[];if(r.forEach((n=>{var r,a,h,u,c;let d=e[n],g=null==(r=d.geometry)?void 0:r.clone();if(s.material instanceof gr&&g.deleteAttribute("lineDistance"),this.applyMatrix(g,d,t),g.userData.isLineSegments=3===d.type,o.push(g),i){let e,t=null==(h=null==(a=g.attributes)?void 0:a.position)?void 0:h.count,n=(null==(u=g.index)?void 0:u.count)||0;(2===s.type||3===s.type)&&(g.boundingSphere||g.computeBoundingSphere(),e=null==(c=g.boundingSphere)?void 0:c.clone()),m.push({batchId:l,positionStart:p,positionCount:t,indexStart:f,indexCount:n,boundingSphere:e}),p+=t,f+=n,l++}})),0!==o.length){if(4===s.type){let e=ri(o);if(!e)return;e.userData={},a=new nn(s.type),a.geometry=e,a.material=s.material,h.push(a)}else if(2===s.type||3===s.type){let e=bi.mergeLineGeometries(o,i,s.material instanceof Kl||s.material instanceof fr,m);if(!e)return;a=new nn(3),a.geometry=e,a.material=s.material,u.push(a)}else if(1===s.type){let e=ri(o);if(!e)return;e.userData={},a=new nn(s.type),a.geometry=e,a.material=s.material,c.push(a)}a&&(i?a.userData.batches=m:(a.userData=s.userData,a.userData.batches=void 0),a.userData.layerName=s.userData.layerName,a.name=`[Merged] ${s.name}`,a.renderOrder=s.renderOrder,a.layers.mask=s.layers.mask,r.forEach((e=>d.push(e)))),o.forEach((e=>{e.dispose(),Gt.releaseGeometryManually(e)})),o=[]}})),fe.debug(`[Merge] Ran deepMerge() in ${(Date.now()-s)/1e3}s`);let p=a.removed;d.forEach((t=>{let r=e[t];p.push(r),n&&r.removeFromParent()}));let f=a.added;return[...h,...u,...c].forEach((e=>{f.push(e),n&&t&&t.add(e)})),this.MergeInfo.removedObjects+=d.length,this.MergeInfo.mergedMeshes+=h.length,this.MergeInfo.mergedLines+=u.length,this.MergeInfo.mergedPoints+=c.length,r&&t&&yr.removeEmptyObjects(t),a}static applyMatrix(e,t,n){let r=t;for(oC.identity();r&&r!==n&&(oC.premultiply(r.matrix),r.parent);)r=r.parent;return oC.equals(qft)?e:e.applyMatrix4(oC)}static removeFromArray(e,t){for(let n=e.length-1;n>=0;--n)if(e[n]===t)return void e.splice(n,1)}static areObjectsMergeable(e,t){return e.layers.mask===t.layers.mask&&e.renderOrder===t.renderOrder&&e.userData.layerName===t.userData.layerName&&(e.type===t.type||!(2!==e.type&&3!==e.type||2!==t.type&&3!==t.type))}};function Sde(e,t,n,r,i=0){let a={u_cameraZoom:n,u_patternLines:{value:e},u_patternAngle:{value:t},u_color:{value:r}},s=`\n        uniform mat4 modelMatrix;\n        uniform float u_cameraZoom;\n        uniform vec3 u_color;\n        varying vec3 v_pos;\n\n        struct PatternLine {\n            vec2 origin;\n            vec2 delta;\n            float angle;\n            float pattern[MAX_PATTERN_SEGMENT_COUNT];\n            float patternSum[MAX_PATTERN_SEGMENT_COUNT+1];\n            float patternLength;\n        };\n\n        uniform PatternLine u_patternLines[${e.length}];\n        uniform float u_patternAngle;\n\n        #include <clipping_planes_pars_fragment>\n\n        // Clamp [0..1] range\n        #define saturate(a) clamp(a, 0.0, 1.0)\n\n        const float EPS = 1000.0;\n\n        vec2 getWorldScale() {\n            return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));\n        }\n\n        vec2 rotate(vec2 st, float rotation) {\n            const float PI = 3.1415926;\n            float angle = rotation * PI/180.0;\n            float sine = sin(angle), cosine = cos(angle);\n            return vec2(cosine * st.x - sine * st.y, cosine * st.y + sine * st.x);\n        }\n\n        vec2 translate(vec2 samplePosition, vec2 offset) {\n            //move sample point in the opposite direction that we want to move shapes in\n            return samplePosition - offset;\n        }\n\n        vec2 scale(vec2 samplePosition, float scale) {\n            return samplePosition / scale;\n        }\n\n        float sdfLine(vec2 st, vec2 a, vec2 b) {\n            vec2 ap = st - a;\n            vec2 ab = b - a;\n            return abs(((ap.x * ab.y) - (ab.x * ap.y))) / length(ab);\n        }\n\n        float drawSpaceLine(vec2 st, float distanceBetweenLines, float thick) {\n            float dist = sdfLine(st , vec2(0.0, 0.0) , vec2(1.0, 0.0));\n\n            //vec2 tt = dFdy(st);\n            //float scale = (abs(tt.x)+abs(tt.y))/2.0;\n            //float scale = length(fwidth(st)) * 0.5;\n            // close to a pixel\n            //float thick = 2.0;\n            //thick = (thick * 0.5 - 0.5) * scale;\n\n            float lineDistance = abs(fract(dist / distanceBetweenLines + 0.5) - 0.5) * distanceBetweenLines;\n            //float lineDistance = fract(dist / distanceBetweenLines);\n            //float distanceChange = fwidth(dist) * 0.5;\n            //float threshold = smoothstep(thick - distanceChange, thick + distanceChange, lineDistance);\n            //float threshold = step(thick, lineDistance);\n            // remove gradient\n            //float threshold = step(0.001, lineDistance);\n            float threshold = step(thick, lineDistance);\n\n            return threshold;\n        }\n\n        float drawSolidLine(PatternLine patternLine, float thick) {\n            vec2 origin = patternLine.origin;\n            vec2 delta = patternLine.delta;\n            float distanceBetweenLines = length(delta);\n\n            origin = rotate(origin,u_patternAngle);\n            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));\n\n            return drawSpaceLine(st, distanceBetweenLines , thick);\n        }\n\n        int getPatternIndex(PatternLine patternLine, float u, out float distance ) {\n            //u = mod(u, patternLine.patternLength);\n            float y = floor(u/patternLine.patternLength);\n            u = u - patternLine.patternLength * y;\n            //float distance = 0.0;\n\n            #pragma unroll_loop_start\n            for(int i = 1; i < patternLine.patternSum.length(); i++){\n                if(u <= patternLine.patternSum[i]) {\n                    distance = u - patternLine.patternSum[i-1];\n                    return i - 1;\n                }\n            }\n            #pragma unroll_loop_end\n\n            return -1;\n        }\n\n        float drawDashedLine(PatternLine patternLine, float thick){\n            float threshold = 1.0;\n            vec2 origin = patternLine.origin;\n            vec2 delta = patternLine.delta;        \n            float distanceBetweenLines = abs(delta.y);\n\n            origin = rotate(origin, u_patternAngle);\n            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));\n\n            float offsetX = st.y * delta.x/delta.y;\n            float u = st.x - offsetX;\n            float distance = 0.0;\n            int index = getPatternIndex(patternLine, u, distance);\n            if(index < 0) {\n                return threshold;\n            }\n\n            float size = patternLine.pattern[index];\n            if(size >= 0.0) {\n                threshold = drawSpaceLine(st, distanceBetweenLines , thick);\n                // Try to solve the problem caused by the precision after zooming out by drawing a part of the dashed line\n            } else if (distance < thick) {\n                //threshold = 0.8;\n                threshold = drawSpaceLine(st, distanceBetweenLines , thick);\n            }\n\n            return threshold;\n        }\n\n        float drawLine(PatternLine patternLine, float thick) {\n            float t = 0.0;\n            if(patternLine.patternLength > 0.0) {\n                t = drawDashedLine(patternLine, thick);\n            } else {\n                t = drawSolidLine(patternLine, thick);\n            }\n            return t;\n        }\n\n        void main() {\n            #include <clipping_planes_fragment>\n\n            // Idealy, the thickness of lines in hatch pattern should always be 1 pixel.\n            // In Viewer2d, it uses orthographic camera and always in top view,\n            // so we adjust thickness by cameraZoom (and also consider worldScale).\n            // While 3d view is more complex, it can use perspective camera,\n            // its camera position and direction is flexible. We cannot keep line thickness\n            // in a fixed pixel any more, and there is no proper way to adjust thickness as camera\n            // position changes. So, we need to use a fixed thickness in world coordinates.\n#if ${i} > 0\n            float thick = float(${i});\n#else\n            vec2 worldScale = getWorldScale();\n            float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;\n            // possible size of a pixel \n            float thick = (0.7 / averageScale) / u_cameraZoom;\n#endif\n\n            if(thick > EPS) {\n                gl_FragColor = vec4(u_color, 1.0);\n                #include <colorspace_fragment>\n                return;\n            }\n\n            float total = 0.0;\n\n#if ${e.length} > 1\n            #pragma unroll_loop_start\n            for (int i = 0; i < u_patternLines.length(); i++) {\n                PatternLine pl = u_patternLines[i];\n                float t = drawLine(pl, thick);\n                total += (1.0 - t);\n            }\n            #pragma unroll_loop_end\n#else\n            float t = drawLine(u_patternLines[0], thick);\n            total += (1.0 - t);\n#endif\n\n            total = saturate(total);\n            if (total < 0.001) {\n                discard;\n            }\n\n            gl_FragColor = vec4(u_color * total, 1.0);\n            #include <colorspace_fragment>\n        }\n        `;return new fr({uniforms:a,vertexShader:"\n        varying vec3 v_pos;\n\n        #include <clipping_planes_pars_vertex>\n        void main() {\n            //vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n            v_pos = position;\n\n            #include <begin_vertex>\n            #include <project_vertex>\n            #include <clipping_planes_vertex>\n        }",fragmentShader:s,clipping:!0})}wl.MergeInfo={removedObjects:0,mergedMeshes:0,mergedLines:0,mergedPoints:0,mergedUnknownTypeObjects:0,elapsedTime:0};var lC=class{static createLineShaderMaterial(e,t,n,r,i){let a=0,s=[];for(let t=0;t<e.length;t++)s[t]=e[t],0===s[t]&&(s[t]=.5),s[t]*=n,a+=Math.abs(s[t]);let o=fM.merge([qt.common,{pattern:{value:s},patternLength:{value:a},u_color:{value:new Ot(t)}}]);o.u_viewportScale=r,o.u_cameraZoom=i;let l=`\n            uniform mat4 modelMatrix;\n            uniform vec3 diffuse;\n            uniform vec3 u_color;\n            uniform float opacity;\n            uniform float pattern[${e.length}];\n            uniform float patternLength;\n            uniform float u_viewportScale;\n            uniform float u_cameraZoom;\n            varying float vLineDistance;\n\n            #include <clipping_planes_pars_fragment>\n\n            vec2 getWorldScale() {\n                return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));\n            }\n\n            void main() {\n\n                #include <clipping_planes_fragment>\n\n                // vec2 worldScale = getWorldScale();\n                // float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;\n                // When zoomed out to a certain extent, it is displayed as a solid line.\n                if(patternLength * u_viewportScale * u_cameraZoom/1.5 < 1.0){\n                    gl_FragColor = vec4(u_color, opacity);\n                    #include <colorspace_fragment>\n                    return;\n                }\n\n                float pos = mod(vLineDistance, patternLength * u_viewportScale);\n\n                for ( int i = 0; i < ${e.length}; i++ ) {\n                    pos = pos - abs(pattern[i] * u_viewportScale);\n                    if ( pos < 0.0 ) {\n                        if ( pattern[i] > 0.0 ) {\n                            gl_FragColor = vec4(u_color, opacity);\n                            break;\n                        }\n                        discard;\n                    }\n                }\n                #include <colorspace_fragment>\n            }`;return new fr({uniforms:o,vertexShader:"\n            attribute float lineDistance;\n            varying float vLineDistance;\n\n            #include <clipping_planes_pars_vertex>\n\n            void main() {\n                vLineDistance = lineDistance;\n\n                #include <begin_vertex>\n                #include <project_vertex>\n                #include <clipping_planes_vertex>\n            }",fragmentShader:l,clipping:!0})}},wde=(e,t)=>{if(void 0===t||0==+t)return Math.round(e);let n=+e;if(t=+t,isNaN(n)||"number"!=typeof t||t%1!=0)return NaN;let r=n.toString().split("e");return n=Math.round(+(r[0]+"e"+(r[1]?+r[1]-t:-t))),r=n.toString().split("e"),+(r[0]+"e"+(r[1]?+r[1]+t:t))},Mde=(e,t,n,r,i)=>{let a=n.length,s=n[0].length;if(e<0||e>1)throw new Error("t out of bounds [0,1]: "+e);if(t<1)throw new Error("degree must be at least 1 (linear)");if(t>a-1)throw new Error("degree must be less than or equal to point count - 1");if(r){if(r.length!==a+t+1)throw new Error("bad knot vector length")}else{r=[];for(let e=0;e<a+t+1;e++)r[e]=e}let o,l=[t,r.length-1-t],h=r[l[0]],u=r[l[1]];for(e=e*(u-h)+h,e=Math.max(e,h),e=Math.min(e,u),o=l[0];o<l[1]&&!(e>=r[o]&&e<=r[o+1]);o++);let c,d=[];for(let e=0;e<a;e++){d[e]=[];let t=i?i[e]:1;for(let r=0;r<s;r++)d[e][r]=n[e][r]*t;d[e][s]=t}for(let n=1;n<=t+1;n++)for(let i=o;i>o-t-1+n;i--){c=(e-r[i])/(r[i+t+1-n]-r[i]);for(let e=0;e<s+1;e++)d[i][e]=(1-c)*d[i-1][e]+c*d[i][e]}let p=[];for(let e=0;e<s;e++)p[e]=wde(d[o][e]/d[o][s],-9);return p},Gft={d:"Â°",c:"â",p:"Â±"},cC=(e,t)=>{if(!e)return[];e=e.replace(/%%(.)/g,((e,t)=>Gft[t]||t)).replace(/\^I/g,"    ");let n,r=null==t?void 0:t.encoding,i=r instanceof TextDecoder?r:void 0,a="",s=[],o=e=>{a&&(s.push(a),a=""),s.push(e)};for(let t=0;t<e.length;t++)switch(n=e[t]){default:a+=n;break;case"\\":switch(n=e[++t]){default:a+=n;break;case"p":{let n=e.slice(t,t=e.indexOf(";",t));n.startsWith("pxq")||n.startsWith("pxi")||n.startsWith("pxt")||n.startsWith("pt")||n.startsWith("pi")||(n.startsWith("psm")?o({[n.slice(0,n.length-1)]:n[n.length-1]}):n.startsWith("pq")?o({[n.slice(0,n.length-1)]:n[n.length-1]}):o({[n.slice(0,n.length-1)]:n[n.length-1]}));break}case"P":a+="\n";break;case"f":case"F":{let r="";for(;n=e[++t];){if(";"===n){o({f:r});break}if("|"===n){let n={f:r},i=e.indexOf(";",++t);for(let r of e.slice(t,i).split("|"))n[r[0]]=+r.slice(1);t=i,o(n);break}r+="\\"===n?e[++t]:n}break}case"S":{let r,i="",a="";for(;n=e[++t];){if(";"===n){r&&o("/"===r||"#"===r?i+"/"+a:i+a);break}"\\"===n?r?a+=e[++t]:i+=e[++t]:r?a+=n:"^"===n||"/"===n||"#"===n?r=n:i+=n}break}case"H":case"W":{let r=++t,[,i,a]=e.slice(r,t=e.indexOf(";",t)).match(/^(\d*(?:\.\d+)?)(\D*)$/);o({[n]:[+i,a]})}break;case"Q":case"A":case"C":case"c":case"T":{let r=++t;o({[n]:+e.slice(r,t=e.indexOf(";",t))});break}case"L":case"O":case"K":o({[n]:1});break;case"l":case"o":case"k":o({[n.toUpperCase()]:0});break;case"U":case"u":"+"===e[t+1]?(a+=String.fromCodePoint(parseInt(e.substr(t+2,4),16)),t+=5):a+=n;break;case"M":case"m":r?"+"!==e[t+1]||"0"!==e[t+2]&&"1"!==e[t+2]?a+=n:(a+=(i=i||new TextDecoder(r)).decode(new Uint8Array([parseInt(e.substr(t+3,2),16),parseInt(e.substr(t+5,2),16)])),t+=6):a+="\\"+n}break;case"{":{let r=1,i=t;for(;n=e[++t];)if("{"===n)r++;else if("}"===n){if(0==--r){o(cC(e.slice(i+1,t)));break}}else"\\"===n&&t++;break}}return a&&s.push(a),s},Wft={d:"Â°",c:"â",p:"Â±"},jft=(e,t)=>(e=Xft(e),t?Yft(e,t):e),Xft=e=>e.replace(/\\[uU]\+([0-9a-fA-F]{4})/g,((e,t)=>String.fromCodePoint(parseInt(t,16)))),Yft=(e,t)=>{let n=t instanceof TextDecoder?t:new TextDecoder(t);return e.replace(/\\[mM]\+[0|1]([0-9a-fA-F]{2})([0-9a-fA-F]{2})/g,((e,r,i)=>(n=n||new TextDecoder(t)).decode(new Uint8Array([parseInt(r,16),parseInt(i,16)]))))},uC=(e,t)=>{let n=0,r={text:""},i=[r],a=(e=jft(e,null==t?void 0:t.encoding)).matchAll(/%%(\d\d\d|.)/g);for(let t of a){r.text+=e.slice(n,t.index);let a=t[1].toLowerCase(),s=Wft[a];s?r.text+=s:3===a.length?r.text+=String.fromCodePoint(+a):"k"===a||"o"===a||"u"===a?(r=Ki(oi({},r),{text:""}),r[a]?delete r[a]:r[a]=1,i.push(r)):r.text+=a,n=t.index+t[0].length}return r.text+=e.slice(n),i.filter((e=>e.text))},hC=(e=>(e.Unitless="Unitless",e.Inches="Inches",e.Feet="Feet",e.Millimeters="Millimeters",e.Centimeters="Centimeters",e.Meters="Meters",e))(hC||{}),Ade=e=>"Unitless"===e?1:"Inches"===e?.0254:"Feet"===e?.3048:"Millimeters"===e?.001:"Centimeters"===e?.01:("Meters"===e||console.warn(`[Units] Unsupported unit '${e}', will return 1 for unit scale.`),1),jLt=(e,t)=>Ade(e)/Ade(t),g0=class{constructor(){this.pointer=0,this.eof=!1}},Cde=1e3,Px=class extends g0{constructor(e){super(),this.int8Array=new Int8Array(Cde),this.caches=new Map,this.reader=new Uh(e);let t=this.reader.readBytes(22),n="";for(let e=0;e<18;e++)n+=String.fromCharCode(t[e]);if("AutoCAD Binary DXF"!=n)throw new Error("Invalid DXF file")}next(){if(!this.hasNext())throw this.eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file.");let e={code:this.reader.readInt16()};return e.value=this.parseGroupValue(e.code),0===e.code&&"EOF"===e.value&&(this.eof=!0),this.lastReadGroup=e,e}hasNext(){return!this.eof&&!this.reader.isEnd()}isEOF(){return this.eof}parseGroupValue(e){if(e>=0&&e<=9)return this.readNullTerminatedString();if(e>=10&&e<=59)return this.reader.readFloat64();if(e>=60&&e<=79)return this.reader.readInt16();if(e>=90&&e<=99)return this.reader.readInt32();if(e>=100&&e<=109)return this.readNullTerminatedString();if(e>=110&&e<=149)return this.reader.readFloat64();if(e>=160&&e<=169)return this.reader.readInt64();if(e>=170&&e<=179)return this.reader.readInt16();if(e>=210&&e<=239)return this.reader.readFloat64();if(e>=270&&e<=289)return this.reader.readInt16();if(e>=290&&e<=299)return this.reader.readInt8()>0;if(e>=300&&e<=309)return this.readNullTerminatedString();if(e>=310&&e<=319){return Rde(this.ReadBinaryData())}if(e>=320&&e<=369)return this.readNullTerminatedString();if(e>=370&&e<=389)return this.reader.readInt16();if(e>=390&&e<=399)return this.readNullTerminatedString();if(e>=400&&e<=409)return this.reader.readInt16();if(e>=410&&e<=419)return this.readNullTerminatedString();if(e>=420&&e<=429)return this.reader.readInt32();if(e>=430&&e<=439)return this.readNullTerminatedString();if(e>=440&&e<=459)return this.reader.readInt32();if(e>=460&&e<=469)return this.reader.readFloat64();if(e>=470&&e<=481)return this.readNullTerminatedString();if(999===e)throw new Error("The comment group 999, is not used in binary DXF files at byte address!");if(1004===e){return Rde(this.ReadBinaryData())}return e>=1e3&&e<=1009?this.readNullTerminatedString():e>=1010&&e<=1059?this.reader.readFloat64():e>=1060&&e<=1070?this.reader.readInt16():1071===e?this.reader.readInt32():void fe.warn(`[DxfBinReader] Invalid code '${e}' at byte address ${this.reader.getPosition()}`)}readNullTerminatedString(){var e;this.decoder||(this.decoder=new TextDecoder("utf-8"));let t=0,n=this.reader.readInt8();for(;0!==n;)this.int8Array[t++]=n,n=this.reader.readInt8();if(0===t)return"";if(t>Cde)return fe.warn(`[DxfBinReader] Failed to read string! The number of bytes is ${t} !`),"";let r=this.int8Array.subarray(0,t),i=r.toString();if(this.caches.get(i))return this.caches.get(i);let a=null==(e=this.decoder)?void 0:e.decode(r);return this.caches.set(i,a),a}ReadBinaryData(){let e=this.reader.readUint8();return this.reader.readBytes(e)}};function Rde(e){return Array.prototype.map.call(e,(e=>("00"+e.toString(16)).slice(-2))).join("")}var v0=class extends g0{constructor(e){super(),this.data=e}next(){if(!this.hasNext())throw this.eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this.data[this.pointer]);let e={code:parseInt(this.data[this.pointer])};return this.pointer++,e.value=$ft(e.code,this.data[this.pointer].trim()),this.pointer++,0===e.code&&"EOF"===e.value&&(this.eof=!0),this.lastReadGroup=e,e}hasNext(){return!(this.eof||this.pointer>this.data.length-2)}isEOF(){return this.eof}};function $ft(e,t){return e>=0&&e<=9?t:e>=10&&e<=59?parseFloat(t):e>=60&&e<=99?parseInt(t):e>=100&&e<=109?t:e>=110&&e<=149?parseFloat(t):e>=160&&e<=179?parseInt(t):e>=210&&e<=239?parseFloat(t):e>=270&&e<=289?parseInt(t):e>=290&&e<=299?Zft(t):e>=300&&e<=369?t:e>=370&&e<=389?parseInt(t):e>=390&&e<=399?t:e>=400&&e<=409?parseInt(t):e>=410&&e<=419?t:e>=420&&e<=429?parseInt(t):e>=430&&e<=439?t:e>=440&&e<=459?parseInt(t):e>=460&&e<=469?parseFloat(t):e>=470&&e<=481||999===e||e>=1e3&&e<=1009?t:e>=1010&&e<=1059?parseFloat(t):e>=1060&&e<=1071?parseInt(t):(fe.info("WARNING: Group code does not have a defined type: %j",{code:e,value:t}),t)}function Zft(e){if("0"===e)return!1;if("1"===e)return!0;throw TypeError("String '"+e+"' cannot be cast to Boolean type")}var Kft=e=>{if(null==e)return!0;for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},Ix=class{constructor(){this.ForEntityName="3DFACE"}parseEntity(e,t){let n={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 70:if(0!==t.value){let e=Math.log2(t.value)-1;n.vertices.splice(e,1)}t=e.next();break;case 10:n.vertices=Jft(e,t),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}};function Jft(e,t){let n=[],r=!1,i=!1;for(let a=0;a<=4;a++){let a={};for(;!e.isEOF()&&0!==t.code&&!i;){switch(t.code){case 10:case 11:case 12:case 13:if(r){i=!0;continue}a.x=t.value,r=!0;break;case 20:case 21:case 22:case 23:a.y=t.value;break;case 30:case 31:case 32:case 33:a.z=t.value;break;default:return n}t=e.next()}Kft(a)||n.push(a),r=!1,i=!1}return n}var Dx=class{constructor(){this.ForEntityName="ARC"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.center=Tt(e),t=e.lastReadGroup;break;case 40:n.radius=t.value,t=e.next();break;case 50:n.startAngle=Math.PI/180*t.value,t=e.next();break;case 51:n.endAngle=Math.PI/180*t.value,n.angleLength=n.endAngle-n.startAngle,t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Ox=class{constructor(){this.ForEntityName="ATTDEF"}parseEntity(e,t){let n={type:t.value,xScale:1,textStyle:"STANDARD"};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 1:n.text=t.value,t=e.next();break;case 2:n.tag=t.value,t=e.next();break;case 3:n.prompt=t.value,t=e.next();break;case 7:n.textStyle=t.value,t=e.next();break;case 10:n.startPoint=Tt(e),t=e.lastReadGroup;break;case 11:n.endPoint=Tt(e),t=e.lastReadGroup;break;case 39:n.thickness=t.value,t=e.next();break;case 40:n.textHeight=t.value,t=e.next();break;case 41:n.xScale=t.value,t=e.next();break;case 50:n.rotation=t.value,t=e.next();break;case 51:n.obliqueAngle=t.value,t=e.next();break;case 70:n.invisible=!!(1&t.value),n.constant=!!(2&t.value),n.verificationRequired=!!(4&t.value),n.preset=!!(8&t.value),t=e.next();break;case 71:n.backwards=!!(2&t.value),n.mirrored=!!(4&t.value),t=e.next();break;case 72:n.horizontalJustification=t.value,t=e.next();break;case 73:n.fieldLength=t.value,t=e.next();break;case 74:n.verticalJustification=t.value,t=e.next();break;case 100:t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Lx=class{constructor(){this.ForEntityName="ATTRIB"}parseEntity(e,t){let n={type:t.value,xScale:1,textStyle:"STANDARD"};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 1:n.text=t.value,t=e.next();break;case 2:n.tag=t.value,t=e.next();break;case 3:n.prompt=t.value,t=e.next();break;case 7:n.textStyle=t.value,t=e.next();break;case 10:n.startPoint=Tt(e),t=e.lastReadGroup;break;case 11:n.endPoint=Tt(e),t=e.lastReadGroup;break;case 39:n.thickness=t.value,t=e.next();break;case 40:n.textHeight=t.value,t=e.next();break;case 41:n.xScale=t.value,t=e.next();break;case 50:n.rotation=t.value,t=e.next();break;case 51:n.obliqueAngle=t.value,t=e.next();break;case 70:n.invisible=!!(1&t.value),n.constant=!!(2&t.value),n.verificationRequired=!!(4&t.value),n.preset=!!(8&t.value),t=e.next();break;case 71:n.backwards=!!(2&t.value),n.mirrored=!!(4&t.value),t=e.next();break;case 72:n.horizontalJustification=t.value,t=e.next();break;case 73:n.fieldLength=t.value,t=e.next();break;case 74:n.verticalJustification=t.value,t=e.next();break;case 100:t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},kx=class{constructor(){this.ForEntityName="CIRCLE"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.center=Tt(e),t=e.lastReadGroup;break;case 40:n.radius=t.value,t=e.next();break;case 50:n.startAngle=Math.PI/180*t.value,t=e.next();break;case 51:let r=Math.PI/180*t.value;r<n.startAngle?n.angleLength=r+2*Math.PI-n.startAngle:n.angleLength=r-n.startAngle,n.endAngle=r,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Fx=class{constructor(){this.ForEntityName="DIMENSION"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:n.block=t.value,t=e.next();break;case 3:n.dimStyleName=t.value,t=e.next();break;case 10:n.anchorPoint=Tt(e),t=e.lastReadGroup;break;case 11:n.middleOfText=Tt(e),t=e.lastReadGroup;break;case 12:n.insertionPoint=Tt(e),t=e.lastReadGroup;break;case 13:n.linearOrAngularPoint1=Tt(e),t=e.lastReadGroup;break;case 14:n.linearOrAngularPoint2=Tt(e),t=e.lastReadGroup;break;case 15:n.diameterOrRadiusPoint=Tt(e),t=e.lastReadGroup;break;case 16:n.arcPoint=Tt(e),t=e.lastReadGroup;break;case 70:n.dimensionType=t.value,t=e.next();break;case 71:n.attachmentPoint=t.value,t=e.next();break;case 42:n.actualMeasurement=t.value,t=e.next();break;case 1:n.text=t.value,t=e.next();break;case 50:n.angle=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Nx=class{constructor(){this.ForEntityName="ELLIPSE"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.center=Tt(e),t=e.lastReadGroup;break;case 11:n.majorAxisEndPoint=Tt(e),t=e.lastReadGroup;break;case 40:n.axisRatio=t.value,t=e.next();break;case 41:n.startAngle=t.value,t=e.next();break;case 42:n.endAngle=t.value,t=e.next();break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 2:n.name=t.value,t=e.next();break;default:fn(n,t),t=e.next()}return n}},$d=class{constructor(e){this.type=e,this.startPoint={x:0,y:0,z:0},this.endPoint={x:0,y:0,z:0}}},AN=class extends $d{constructor(){super(0),this.points=[],this.isClosed=!0}},CN=class extends $d{constructor(){super(1)}},RN=class extends $d{constructor(){super(2),this.center={x:0,y:0,z:0},this.radius=0,this.startAngle=0,this.endAngle=0,this.bCounterclockwise=!1}},PN=class extends $d{constructor(){super(3),this.center={x:0,y:0,z:0},this.majorAxisEndPoint={x:0,y:0,z:0},this.minorRatio=0,this.startAngle=0,this.endAngle=0,this.bCounterclockwise=!1}},IN=class extends $d{constructor(){super(4),this.controlPoints=[],this.numControlPoints=0,this.knotValues=[],this.numKnots=0,this.bPeriodic=!1,this.bRational=!1,this.degreeOfSplineCurve=0}},Bx=class{constructor(){this.ForEntityName="HATCH"}parseEntity(e,t){let n={type:t.value,boundaryPaths:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:n.patternName=t.value,t=e.next();break;case 10:n.elevationX=t.value,t=e.next();break;case 20:n.elevationY=t.value,t=e.next();break;case 30:n.elevationZ=t.value,t=e.next();break;case 41:n.patternScale=t.value,t=e.next();break;case 47:n.pixelSize=t.value,t=e.next();break;case 52:n.patternAngle=t.value,t=e.next();break;case 63:n.patternFillColor=t.value,t=e.next();break;case 70:n.solidFill=0!=(1&t.value),t=e.next();break;case 71:n.associativity=0!=(1&t.value),t=e.next();break;case 73:n.annotatedBoundary=0!=(1&t.value),t=e.next();break;case 75:n.style=t.value,t=e.next();break;case 76:n.patternType=t.value,t=e.next();break;case 78:n.patternLines=ndt(t.value,e),t=e.lastReadGroup;break;case 91:n.boundaryPathsCount=t.value,n.boundaryPaths=tdt(n.boundaryPathsCount,e),t=e.lastReadGroup;break;case 98:n.seedPointsCount=t.value,t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 450:n.isGradientColor=1===t.value,t=e.next();break;case 451:case 452:case 460:case 461:case 462:case 463:case 470:t=e.next();break;case 453:n.gradientColorCount=t.value,n.gradientColors=rdt(n.gradientColorCount,e),t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}};function Qft(e){let t=new AN,n=e.next(),r=0!==n.value;n=e.next(),t.isClosed=0!==n.value,n=e.next();let i=n.value;n=e.next();for(let a=0;a<i;a++){let i=Tt(e);n=e.lastReadGroup,r&&(i.bulge=n.value,n=e.next()),t.points.push(i)}n=e.lastReadGroup,console.assert(97===n.code,"The reference count code 97 was expected.");let a=n.value;n=e.next();for(let t=0;t<a;t++)console.assert(330===n.code,"The reference handle code 330 was expected."),n=e.next();return{edges:[t],pathTypeFlag:-1}}function edt(e,t){let n=[],r=t.next();for(;n.length<e;)if(72===r.code)switch(r.value){case 1:{r=t.next();let e=new CN;e.startPoint=Tt(t),e.endPoint=Tt(t),r=t.lastReadGroup,n.push(e);break}case 2:{r=t.next();let e=new RN;e.center=Tt(t),r=t.lastReadGroup,e.radius=r.value,r=t.next(),e.startAngle=r.value,r=t.next(),e.endAngle=r.value,r=t.next(),e.bCounterclockwise=0!==r.value,r=t.next(),n.push(e);break}case 3:{r=t.next();let e=new PN;e.center=Tt(t),e.majorAxisEndPoint=Tt(t),r=t.lastReadGroup,e.minorRatio=r.value,r=t.next(),e.startAngle=r.value,r=t.next(),e.endAngle=r.value,r=t.next(),e.bCounterclockwise=0!==r.value,r=t.next(),n.push(e);break}case 4:{r=t.next();let e=new IN;e.degreeOfSplineCurve=r.value,r=t.next(),e.bRational=0!==r.value,r=t.next(),e.bPeriodic=0!==r.value,r=t.next(),e.numKnots=r.value,r=t.next(),e.numControlPoints=r.value,r=t.next();for(let n=0;n<e.numKnots;n++)e.knotValues.push(r.value),r=t.next();for(let n=0;n<e.numControlPoints;n++){let n=r.value;r=t.next();let i=r.value,a=1;r=t.next(),42===r.code&&(a=r.value,r=t.next()),e.controlPoints.push({x:n,y:i,z:a})}n.push(e);break}default:r=t.next()}else r=t.next();r=t.lastReadGroup,console.assert(97===r.code,"The reference count code 97 was expected.");let i=r.value;r=t.next();for(let e=0;e<i;e++)console.assert(330===r.code,"The reference handle code 330 was expected."),r=t.next();return{edges:n,pathTypeFlag:-1}}function tdt(e,t){let n=[],r=-1,i=t.next();for(;n.length<e;){let e;switch(i.code){case 92:if(r=i.value,2&r){if(e=Qft(t),!e)throw new Error("[Hatch] Failed to parse hatch polyline boundary path !");e.pathTypeFlag=r,n.push(e),i=t.lastReadGroup}else i=t.next();break;case 93:e=edt(i.value,t),e.pathTypeFlag=r,n.push(e),i=t.lastReadGroup;break;default:i=t.next()}}return n}function ndt(e,t){if(e<=0)return void t.next();let n=[],r=t.next();for(let i=0;i<e;i++){let e=0,i={x:0,y:0},a={x:0,y:0},s=-1,o=[];for(;!t.isEOF()&&0!==r.code;){let n=!1;switch(r.code){case 53:e=r.value;break;case 43:i.x=r.value;break;case 44:i.y=r.value;break;case 45:a.x=r.value;break;case 46:a.y=r.value;break;case 79:s=r.value;break;case 49:o.push(r.value);break;default:n=!0}if(r=t.next(),n||o.length===s)break}s>=0&&n.push({angle:e,origin:i,delta:a,dashPattern:o})}return n}function rdt(e,t){let n=[],r=t.next();for(;n.length<e;)switch(r.code){case 63:default:r=t.next();break;case 421:n.push(r.value),r=t.next()}return n}var Ux=class{constructor(){this.ForEntityName="IMAGE"}parseEntity(e,t){let n={type:t.value,clippingBoundaryPath:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.position=Tt(e),t=e.lastReadGroup;break;case 11:n.uPixel=Tt(e),t=e.lastReadGroup;break;case 12:n.vPixel=Tt(e),t=e.lastReadGroup;break;case 13:n.imageSize=Tt(e),t=e.lastReadGroup;break;case 340:n.imageDefHandle=t.value,t=e.next();break;case 70:n.flags=t.value,t=e.next();break;case 280:n.clipping=t.value,t=e.next();break;case 281:n.brightness=t.value,t=e.next();break;case 282:n.contrast=t.value,t=e.next();break;case 283:n.fade=t.value,t=e.next();break;case 360:n.imageDefReactorHandle=t.value,t=e.next();break;case 71:n.clippingBoundaryType=t.value,t=e.next();break;case 91:n.countBoundaryPoints=t.value,t=e.next();break;case 14:n.clippingBoundaryPath.push(Tt(e)),t=e.lastReadGroup;break;case 290:n.clipMode=t.value,t=e.next();default:fn(n,t),t=e.next()}return n}},Hx=class{constructor(){this.ForEntityName="INSERT"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:n.block=t.value,t=e.next();break;case 66:n.attributesFollow=0!=t.value,t=e.next();break;case 41:n.xScale=t.value,t=e.next();break;case 42:n.yScale=t.value,t=e.next();break;case 43:n.zScale=t.value,t=e.next();break;case 10:n.position=Tt(e),t=e.lastReadGroup;break;case 50:n.rotation=t.value,t=e.next();break;case 70:n.columnCount=t.value,t=e.next();break;case 71:n.rowCount=t.value,t=e.next();break;case 44:n.columnSpacing=t.value,t=e.next();break;case 45:n.rowSpacing=t.value,t=e.next();break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Vx=class{constructor(){this.ForEntityName="LEADER"}parseEntity(e,t){let n={type:t.value,arrowFlag:1,vertices:[]};t=e.next();let r=!1;for(;!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.vertices.push(Tt(e)),t=e.lastReadGroup;break;case 3:n.dimensionStyle=t.value,t=e.next();break;case 40:n.textHeight=t.value,t=e.next();break;case 41:n.textWidth=t.value,t=e.next();break;case 71:n.arrowFlag=t.value,t=e.next();break;case 72:n.pathType=t.value,t=e.next();break;case 73:n.creationFlag=t.value,t=e.next();break;case 74:n.direction=t.value,t=e.next();break;case 75:n.hasHookline=1===t.value,t=e.next();break;case 1001:r="ACAD"===t.value,t=e.next();break;case 1070:if(r){let r=idt(t.value);r&&((1005==(t=e.next()).code||1040==t.code||1070==t.code)&&("DIMLDRBLK"===r&&(n.arrowHeadBlockHandle=t.value),"DIMASZ"===r&&(n.arrowHeight=t.value),"DIMSCALE"===r&&(n.arrowHeadScale=t.value),"DIMCLRD"===r&&t.value>0&&(n.colorIndex=t.value,n.color=Yd(Math.abs(t.value)))))}t=e.next();break;default:fn(n,t),t=e.next()}return n}};function idt(e){switch(e){case 40:return"DIMSCALE";case 41:return"DIMASZ";case 42:return"DIMEXO";case 44:return"DIMEXE";case 75:return"DIMSE1";case 76:return"DIMSE2";case 77:return"DIMTAD";case 140:return"DIMTXT";case 144:return"DIMLFAC";case 147:return"DIMGAP";case 176:return"DIMCLRD";case 178:return"DIMCLRT";case 271:return"DIMDEC";case 341:return"DIMLDRBLK";default:return null}}var zx=class{constructor(){this.ForEntityName="LINE"}parseEntity(e,t){let n={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.vertices.unshift(Tt(e)),t=e.lastReadGroup;break;case 11:n.vertices.push(Tt(e)),t=e.lastReadGroup;break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},qx=class{constructor(){this.ForEntityName="LWPOLYLINE"}parseEntity(e,t){let n={type:t.value,vertices:[]},r=0;for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 38:n.elevation=t.value,t=e.next();break;case 39:n.thickness=t.value,t=e.next();break;case 70:n.shape=1==(1&t.value),n.hasContinuousLinetypePattern=128==(128&t.value),t=e.next();break;case 90:r=t.value,t=e.next();break;case 10:n.vertices.push(...sdt(r,e)),t=e.lastReadGroup;break;case 43:0!==t.value&&(n.constantWidth=t.value),t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}};function sdt(e,t){if(!e||e<=0)throw Error("n must be greater than 0 verticies");let n=[],r=!1,i=!1,a=t.lastReadGroup,s={};for(;!t.isEOF()&&0!==a.code&&!i;)switch(a.code){case 10:if(r){i=!0;continue}s.x=a.value,r=!0,a=t.next();break;case 20:s.y=a.value,a=t.next();break;case 30:s.z=a.value,a=t.next();break;case 40:s.startWidth=a.value,a=t.next();break;case 41:s.endWidth=a.value,a=t.next();break;case 42:0!=a.value&&(s.bulge=a.value),a=t.next();break;default:return r&&n.push(s),n}return n.push(s),r=!1,i=!1,n}var Gx=class{constructor(){this.ForEntityName="MULTILEADER"}parseEntity(e,t){let n={type:t.value};function r(){for(;!e.isEOF();)switch(t.code){case 40:n.contextData.contentScale=t.value,t=e.next();break;case 10:n.contextData.contentBasePosition=Tt(e),t=e.lastReadGroup;break;case 145:n.contextData.landingGap=t.value,t=e.next();break;case 290:n.contextData.hasMText=t.value,t=e.next();break;case 304:n.contextData.defaultTextContents=t.value,t=e.next();break;case 11:n.contextData.textNormalDirection=Tt(e),t=e.lastReadGroup;break;case 12:n.contextData.textLocation=Tt(e),t=e.lastReadGroup;break;case 13:n.contextData.textDirection=Tt(e),t=e.lastReadGroup;break;case 140:n.contextData.arrowHeadSize=t.value,t=e.next();break;case 41:n.contextData.textHeight=t.value,t=e.next();break;case 42:n.contextData.textRotation=t.value,t=e.next();break;case 43:n.contextData.textWidth=t.value,t=e.next();break;case 44:default:t=e.next();break;case 45:n.contextData.textLineSpacingFactor=t.value,t=e.next();break;case 90:n.contextData.textColor=t.value,t=e.next();break;case 170:n.contextData.textLineSpacingStyle=t.value,t=e.next();break;case 171:n.contextData.textAttachment=t.value,t=e.next();break;case 172:n.contextData.textFlowDirection=t.value,t=e.next();break;case 141:n.contextData.textBackgroundScaleFactor=t.value,t=e.next();break;case 92:n.contextData.textBackgroundTransparency=t.value,t=e.next();break;case 291:n.contextData.textBackgroundColorOn=t.value,t=e.next();break;case 292:n.contextData.textBackgroundFillOn=t.value,t=e.next();break;case 293:n.contextData.textUseAutoHeight=t.value,t=e.next();break;case 173:n.contextData.textColumnType=t.value,t=e.next();break;case 142:n.contextData.textColumnWidth=t.value,t=e.next();break;case 143:n.contextData.textColumnGutterWidth=t.value,t=e.next();break;case 144:n.contextData.textColumnHeight=t.value,t=e.next();break;case 295:n.contextData.textUseWordBreak=t.value,t=e.next();break;case 296:n.contextData.hasBlock=t.value,t=e.next();break;case 341:n.contextData.blockContentId=t.value,t=e.next();break;case 14:n.contextData.blockContentNormalDirection=Tt(e),t=e.lastReadGroup;break;case 15:n.contextData.blockContentPosition=Tt(e),t=e.lastReadGroup;break;case 16:n.contextData.blockContentScale=t.value,t=e.next();break;case 46:n.contextData.blockContentRotation=t.value,t=e.next();break;case 93:n.contextData.blockContentColor=t.value,t=e.next();break;case 47:n.contextData.blockTransformationMatrix=Tde(e,47),t=e.lastReadGroup;break;case 110:n.contextData.planeOriginPoint=Tt(e),t=e.lastReadGroup;break;case 111:n.contextData.planeXAxisDirection=Tt(e),t=e.lastReadGroup;break;case 112:n.contextData.planeYAxisDirection=Tt(e),t=e.lastReadGroup;break;case 297:n.contextData.planeNormalReversed=t.value,t=e.next();break;case 301:return;case 302:i(),t=e.lastReadGroup}}function i(){let r={leaderLines:[]};for(n.contextData.leaders.push(r);!e.isEOF();)switch(t.code){case 290:r.hasSetLastLeaderLinePoint=t.value,t=e.next();break;case 291:r.hasSetDoglegVector=t.value,t=e.next();break;case 10:r.lastLeaderLinePoint=Tt(e),t=e.lastReadGroup;break;case 11:r.doglegVector=Tt(e),t=e.lastReadGroup;break;case 90:r.leaderBranchIndex=t.value,t=e.next();break;case 40:r.doglegLength=t.value,t=e.next();break;case 303:return;case 304:a(),t=e.lastReadGroup;break;default:t=e.next()}}function a(){let r={vertices:[[]]};for(n.contextData.leaders[n.contextData.leaders.length-1].leaderLines.push(r);!e.isEOF();)switch(t.code){case 10:r.vertices[0].push(Tt(e)),t=e.lastReadGroup;break;case 305:return;default:t=e.next()}}return n.contextData={leaders:[]},t=e.next(),function(){for(;!e.isEOF();)switch(t.code){case 0:return;case 340:n.leaderStyleId=t.value,t=e.next();break;case 170:n.leaderLineType=t.value,t=e.next();break;case 91:n.leaderLineColor=t.value,t=e.next();break;case 341:n.leaderLineTypeId=t.value,t=e.next();break;case 171:n.leaderLineWeight=t.value,t=e.next();break;case 41:n.doglegLength=t.value,t=e.next();break;case 290:n.enableLanding=t.value,t=e.next();break;case 291:n.enableDogLeg=t.value,t=e.next();break;case 342:n.arrowHeadId=t.value,t=e.next();break;case 42:n.arrowHeadSize=t.value,t=e.next();break;case 172:n.contentType=t.value,t=e.next();break;case 173:case 95:n.textLeftAttachmentType=t.value,t=e.next();break;case 174:n.textAngleType=t.value,t=e.next();break;case 175:n.textAlignmentType=t.value,t=e.next();break;case 343:n.textStyleId=t.value,t=e.next();break;case 92:n.textColor=t.value,t=e.next();break;case 292:n.enableFrameText=t.value,t=e.next();break;case 344:n.blockContentId=t.value,t=e.next();break;case 93:n.blockContentColor=t.value,t=e.next();break;case 10:n.blockContentScale=Tt(e),t=e.lastReadGroup;break;case 43:n.blockContentRotation=t.value,t=e.next();break;case 176:n.blockContentConnectionType=t.value,t=e.next();break;case 293:n.enableAnotationScale=t.value,t=e.next();break;case 94:n.arrowHeadIndex=t.value,t=e.next();break;case 177:n.blockAttributeIndex=t.value,t=e.next();break;case 44:n.blockAttributeWidth=t.value,t=e.next();break;case 302:n.blockAttributeTextString=t.value,t=e.next();break;case 294:n.textDirectionNegative=t.value,t=e.next();break;case 178:n.textAlignInIPE=t.value,t=e.next();break;case 179:n.textAttachmentPoint=t.value,t=e.next();break;case 271:n.textAttachmentDirectionMText=t.value,t=e.next();break;case 272:n.textAttachmentDirectionBottom=t.value,t=e.next();break;case 273:n.textAttachmentDirectionTop=t.value,t=e.next();break;case 300:r(),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}}(),n}},Wx=class{constructor(){this.ForEntityName="MTEXT"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 3:case 1:n.text?n.text+=t.value:n.text=t.value,t=e.next();break;case 10:n.position=Tt(e),t=e.lastReadGroup;break;case 7:n.textStyle=t.value,t=e.next();break;case 44:n.lineSpaceFactor=t.value,t=e.next();break;case 11:n.directionVector=Tt(e),n.rotation=void 0,t=e.lastReadGroup;break;case 40:n.height=t.value,t=e.next();break;case 41:n.width=t.value,t=e.next();break;case 50:n.rotation=t.value,n.directionVector=void 0,t=e.next();break;case 71:n.attachmentPoint=t.value,t=e.next();break;case 72:n.drawingDirection=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},jx=class{constructor(){this.ForEntityName="OLE2FRAME"}parseEntity(e,t){let n={type:t.value,binaryData:""};for(t=e.next();"OLE"!==t.value&&0!==t.code;)switch(t.code){case 3:n.documentType=t.value,t=e.next();break;case 70:n.version=t.value,t=e.next();break;case 10:n.leftUpX=t.value,t=e.next();break;case 20:n.leftUpY=t.value,t=e.next();break;case 30:n.leftUpZ=t.value,t=e.next();break;case 11:n.rightDownX=t.value,t=e.next();break;case 21:n.rightDownY=t.value,t=e.next();break;case 31:n.rightDownZ=t.value,t=e.next();break;case 90:n.lengthOfBinaryData=t.value,t=e.next();break;case 310:n.binaryData+=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Xx=class{constructor(){this.ForEntityName="POINT"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.position=Tt(e),t=e.lastReadGroup;break;case 39:n.thickness=t.value,t=e.next();break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Yx=class{constructor(){this.ForEntityName="VERTEX"}parseEntity(e,t){var n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.x=t.value,t=e.next();break;case 20:n.y=t.value,t=e.next();break;case 30:n.z=t.value,t=e.next();break;case 40:case 41:case 50:t=e.next();break;case 42:0!=t.value&&(n.bulge=t.value),t=e.next();break;case 70:n.curveFittingVertex=0!=(1&t.value),n.curveFitTangent=0!=(2&t.value),n.splineVertex=0!=(8&t.value),n.splineControlPoint=0!=(16&t.value),n.threeDPolylineVertex=0!=(32&t.value),n.threeDPolylineMesh=0!=(64&t.value),n.polyfaceMeshVertex=0!=(128&t.value),t=e.next();break;case 71:n.faceA=t.value,t=e.next();break;case 72:n.faceB=t.value,t=e.next();break;case 73:n.faceC=t.value,t=e.next();break;case 74:n.faceD=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},$x=class{constructor(){this.ForEntityName="POLYLINE"}parseEntity(e,t){var n={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:case 20:case 30:case 40:case 41:case 71:case 72:case 73:case 74:case 75:t=e.next();break;case 39:t=e.next(),n.thickness=t.value;break;case 70:n.shape=0!=(1&t.value),n.includesCurveFitVertices=0!=(2&t.value),n.includesSplineFitVertices=0!=(4&t.value),n.is3dPolyline=0!=(8&t.value),n.is3dPolygonMesh=0!=(16&t.value),n.is3dPolygonMeshClosed=0!=(32&t.value),n.isPolyfaceMesh=0!=(64&t.value),n.hasContinuousLinetypePattern=0!=(128&t.value),t=e.next();break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n.vertices=adt(e,t),n}};function adt(e,t){let n=new Yx,r=[];for(;!e.isEOF();)if(0===t.code)if("VERTEX"===t.value)r.push(n.parseEntity(e,t)),t=e.lastReadGroup;else if("SEQEND"===t.value){odt(e,t);break}return r}function odt(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)if(101===t.code)for(;0!=t.code;)t=e.next();else fn(n,t),t=e.next();return n}var Zx=class{constructor(){this.ForEntityName="RAY"}parseEntity(e,t){let n={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.vertices.unshift(Tt(e)),t=e.lastReadGroup;break;case 11:n.directionVector=Tt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Kx=class{constructor(){this.ForEntityName="REGION"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 70:n.modelerVersion=t.value,t=e.next();break;case 1:n.proprietaryData=t.value,t=e.next();break;case 3:n.proprietaryData+=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},Jx=class{constructor(){this.ForEntityName="SEQEND"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)if(-2===t.code);else fn(n,t),t=e.next();return n}},Qx=class{constructor(){this.ForEntityName="SOLID"}parseEntity(e,t){let n={type:t.value,points:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.points[0]=Tt(e),t=e.lastReadGroup;break;case 11:n.points[1]=Tt(e),t=e.lastReadGroup;break;case 12:n.points[2]=Tt(e),t=e.lastReadGroup;break;case 13:n.points[3]=Tt(e),t=e.lastReadGroup;break;case 210:n.extrusionDirection=Tt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},eb=class{constructor(){this.ForEntityName="SPLINE"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.controlPoints||(n.controlPoints=[]),n.controlPoints.push(Tt(e)),t=e.lastReadGroup;break;case 11:n.fitPoints||(n.fitPoints=[]),n.fitPoints.push(Tt(e)),t=e.lastReadGroup;break;case 12:n.startTangent=Tt(e),t=e.lastReadGroup;break;case 13:n.endTangent=Tt(e),t=e.lastReadGroup;break;case 40:n.knotValues||(n.knotValues=[]),n.knotValues.push(t.value),t=e.next();break;case 70:1&t.value&&(n.closed=!0),2&t.value&&(n.periodic=!0),4&t.value&&(n.rational=!0),8&t.value&&(n.planar=!0),16&t.value&&(n.planar=!0,n.linear=!0),t=e.next();break;case 71:n.degreeOfSplineCurve=t.value,t=e.next();break;case 72:n.numberOfKnots=t.value,t=e.next();break;case 73:n.numberOfControlPoints=t.value,t=e.next();break;case 74:n.numberOfFitPoints=t.value,t=e.next();break;case 210:n.normalVector=Tt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},tb=class{constructor(){this.ForEntityName="ACAD_TABLE"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.startPoint=Tt(e),t=e.lastReadGroup;break;case 11:n.directionVector=Tt(e),t=e.lastReadGroup;break;case 90:n.tableValue=t.value,t=e.next();break;case 91:n.rowCount=t.value,t=e.next();break;case 92:n.columnCount=t.value,t=e.next();break;case 93:n.overrideFlag=t.value,t=e.next();break;case 94:n.borderColorOverrideFlag=t.value,t=e.next();break;case 95:n.borderLineWeightOverrideFlag=t.value,t=e.next();break;case 96:n.borderVisibilityOverrideFlag=t.value,t=e.next();break;case 141:n.rowHeightArr?n.rowHeightArr.push(t.value):n.rowHeightArr=[t.value],t=e.next();break;case 142:n.columnWidthArr?n.columnWidthArr.push(t.value):n.columnWidthArr=[t.value],t=e.next();break;case 280:n.version=t.value,t=e.next();break;case 342:n.tableStyleId=t.value,t=e.next();break;case 343:n.blockRecordHandle=t.value,t=e.next();break;case 171:n.cells?n.cells.push(Pde(t,e)):n.cells=[Pde(t,e)],t=e.lastReadGroup;break;default:console.log(t.code,t.value),fn(n,t),t=e.next()}return n}};function Pde(e,t){let n=!1,r=!1,i={};for(;!t.isEOF()&&0!==e.code&&!r;)switch(e.code){case 171:if(n){r=!0;continue}i.cellType=e.value,n=!0,e=t.next();break;case 172:i.flagValue=e.value,e=t.next();break;case 173:i.mergedValue=e.value,e=t.next();break;case 174:i.autoFit=e.value,e=t.next();break;case 175:i.borderWidth=e.value,e=t.next();break;case 176:i.borderHeight=e.value,e=t.next();break;case 91:i.overrideFlag=e.value,e=t.next();break;case 178:i.virtualEdgeFlag=e.value,e=t.next();break;case 145:i.rotation=e.value,e=t.next();break;case 345:i.fieldObjetId=e.value,e=t.next();break;case 340:i.blockTableRecordId=e.value,e=t.next();break;case 146:i.blockScale=e.value,e=t.next();break;case 177:i.blockAttrNum=e.value,e=t.next();break;case 7:i.textStyle=e.value,e=t.next();break;case 140:i.textHeight=e.value,e=t.next();break;case 170:i.attachmentPoint=e.value,e=t.next();break;case 92:i.extendedCellFlags=e.value,e=t.next();break;case 301:ldt(e,i,t),e=t.next();break;default:return i}return n=!1,r=!1,i}function ldt(e,t,n){for(;304!==e.code;)switch(e.code){case 301:case 93:case 90:case 94:e=n.next();break;case 1:t.text=e.value,e=n.next();break;case 300:t.attrText=e.value,e=n.next();break;case 302:t.text=e.value?e.value:t.text,e=n.next();break;default:console.log(`[DXF ACAD_TABLE] ignore code: ${e.code}, value: ${e.value}`),e=n.next()}}var nb=class{constructor(){this.ForEntityName="TEXT"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.startPoint=Tt(e),t=e.lastReadGroup;break;case 11:n.endPoint=Tt(e),t=e.lastReadGroup;break;case 40:n.textHeight=t.value,t=e.next();break;case 41:n.xScale=t.value,t=e.next();break;case 50:n.rotation=t.value,t=e.next();break;case 1:n.text=t.value,t=e.next();break;case 72:n.halign=t.value,t=e.next();break;case 73:n.valign=t.value,t=e.next();break;case 7:n.textStyle=t.value,t=e.next();break;case 71:n.mirrored=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},rb=class{constructor(){this.ForEntityName="VIEWPORT"}parseEntity(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 68:n.viewportStatus=t.value,t=e.next();break;case 40:n.width_paperSpace=t.value,t=e.next();break;case 41:n.height_paperSpace=t.value,t=e.next();break;case 69:n.viewportId=t.value,t=e.next();break;case 10:n.centerPoint=Tt(e),t=e.lastReadGroup;break;case 12:n.centerPoint_dcs=Tt(e),t=e.lastReadGroup;break;case 13:n.snapBasePoint_dcs=Tt(e),t=e.lastReadGroup;break;case 14:n.snapSpacing_dcs=Tt(e),t=e.lastReadGroup;break;case 15:n.gridSpacing_dcs=Tt(e),t=e.lastReadGroup;break;case 16:n.viewDirection=Tt(e),t=e.lastReadGroup;break;case 17:n.viewTarget=Tt(e),t=e.lastReadGroup;break;case 42:n.perspectiveLens=t.value,t=e.next();break;case 43:n.frontClippingPlaneZ=t.value,t=e.next();break;case 44:n.backClippingPlaneZ=t.value,t=e.next();break;case 45:n.viewHeight=t.value,t=e.next();break;case 50:n.snapAngle=t.value,t=e.next();break;case 51:n.viewTwistAngle=t.value,t=e.next();break;case 72:n.circleZoomPercent=t.value,t=e.next();break;case 331:n.frozenLayerHandles=n.frozenLayerHandles||[],n.frozenLayerHandles.push(t.value),t=e.next();break;case 90:n.viewportStatusFlags=t.value,t=e.next();break;case 340:n.viewportClippingBoundaryhandleId=t.value,t=e.next();break;case 1:n.plotStyleSheetName=t.value,t=e.next();break;case 281:n.renderMode=t.value,t=e.next();break;case 71:n.viewportFlag_ucs=t.value,t=e.next();break;case 74:n.ucsIcon=t.value,t=e.next();break;case 110:n.ucsOrigin=Tt(e),t=e.lastReadGroup;break;case 111:n.ucsXAxis=Tt(e),t=e.lastReadGroup;break;case 112:n.ucsYAxis=Tt(e),t=e.lastReadGroup;break;case 345:n.ucsTableRecordHandle=t.value,t=e.next();break;case 346:n.baseUcsTableRecordHandle=t.value,t=e.next();break;case 79:n.orthographicType=t.value,t=e.next();break;case 146:n.elevation=t.value,t=e.next();break;case 170:n.shadePlotMode=t.value,t=e.next();break;case 61:n.frequency=t.value,t=e.next();break;case 292:n.lightingFlag=t.value,t=e.next();break;case 282:n.lightingType=t.value,t=e.next();break;case 141:n.viewBrightness=t.value,t=e.next();break;case 142:n.viewContrast=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},ib=class{constructor(){this.ForEntityName="XLINE"}parseEntity(e,t){let n={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:n.vertices.unshift(Tt(e)),t=e.lastReadGroup;break;case 11:n.directionVector=Tt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:fn(n,t),t=e.next()}return n}},fC=class{constructor(){this.ForObjectName="DICTIONARY"}parseObject(e,t){let n={type:t.value},r=[],i=[];for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 280:n.isHardOwner=1===t.value,t=e.next();break;case 281:n.cloningFlag=t.value,t=e.next();break;case 3:r.push(t.value),t=e.next();break;case 350:case 360:i.push(t.value),t=e.next();break;case 100:case 102:t=e.next();break;default:No(n,t),t=e.next()}if(r.length!==i.length)throw new Error("The number of Dictionary entries does not match !");return n.entries={},r.forEach(((e,t)=>{n.entries[i[t]]=e})),n}},dC=class{constructor(){this.ForObjectName="IMAGEDEF"}parseObject(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 90:n.classVersion=t.value,t=e.next();break;case 1:n.filename=t.value,t=e.next();break;case 10:n.imageSize=Tt(e),t=e.next();break;case 11:n.pixelSize=Tt(e),t=e.next();break;case 280:n.loaded=t.value,t=e.next();break;case 281:n.resolutionUnits=t.value,t=e.next();break;default:No(n,t),t=e.next()}return n}},pC=class{constructor(){this.ForObjectName="LAYOUT"}parseObject(e,t){let n={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 100:t=e.next();break;case 1:n.layoutName=t.value,t=e.next();break;case 70:n.flag=t.value,t=e.next();break;case 71:n.tabOrder=t.value,t=e.next();break;case 76:n.orthographicType=t.value,t=e.next();break;case 10:n.minLimit=Tt(e),t=e.lastReadGroup;break;case 11:n.maxLimit=Tt(e),t=e.lastReadGroup;break;case 12:n.basePoint=Tt(e),t=e.lastReadGroup;break;case 13:n.origin=Tt(e),t=e.lastReadGroup;break;case 14:n.minExtent=Tt(e),t=e.lastReadGroup;break;case 15:n.maxExtent=Tt(e),t=e.lastReadGroup;break;case 16:n.XAxis=Tt(e),t=e.lastReadGroup;break;case 17:n.YAxis=Tt(e),t=e.lastReadGroup;break;case 146:n.elevation=t.value,t=e.next();break;case 331:n.viewportHandle=t.value,t=e.next();break;default:No(n,t),t=e.next()}return n.blockTableHandle=n.ownerHandle,n}},mC=class{constructor(){this.ForObjectName="SORTENTSTABLE"}parseObject(e,t){let n={type:t.value},r=!1;n.sortEntsObject={},n.sortEntsObject.entityHandles=[];let i=[];for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 5:r?(i.push(t.value),n.sortEntsObject.entityHandles.push(i),i=[]):n.handle=t.value,t=e.next();break;case 100:t=e.next(),r=!0;break;case 102:t=e.next();break;case 330:r?n.sortEntsObject.ownerHandle=t.value:n.ownerHandle=t.value,t=e.next();break;case 331:i.push(t.value),t=e.next();break;default:No(n,t),t=e.next()}return n}},gC=class{constructor(){this.ForObjectName="SPATIAL_FILTER"}parseObject(e,t){let n,r,i={type:t.value};for(i.vertices=[],t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 11:i.origin=Tt(e),t=e.lastReadGroup;break;case 70:i.numberOfPointsOnClipBoundary=t.value,2===i.numberOfPointsOnClipBoundary?(t=e.next(),n=Tt(e),t=e.lastReadGroup,r=Tt(e),t=e.lastReadGroup,i.vertices.push(n,{x:r.x,y:n.y},r,{x:n.x,y:r.y},n)):i.numberOfPointsOnClipBoundary>2?(i.vertices=cdt(i.numberOfPointsOnClipBoundary,e),t=e.lastReadGroup):t=e.next();break;case 71:i.clipBoundaryVisible=1===t.value,t=e.next();break;case 72:i.frontClippingPlaneFlag=1===t.value,t=e.next(),i.frontClippingPlaneFlag&&40===t.code&&(i.frontClippingPlaneDistance=t.value,t=e.next());break;case 73:i.backClippingPlaneFlag=1===t.value,t=e.next(),i.backClippingPlaneFlag&&41===t.code&&(i.backClippingPlaneDistance=t.value,t=e.next());break;case 100:case 102:t=e.next();break;case 210:i.extrusionDirectionX=t.value,t=e.next();break;case 220:i.extrusionDirectionY=t.value,t=e.next();break;case 230:i.extrusionDirectionZ=t.value,t=e.next();break;case 40:i.invertBlockMatrix=Ide(e,40),i.matrix=Ide(e,40),t=e.lastReadGroup;break;default:No(i,t),t=e.next()}return i}};function cdt(e,t){t.next();let n=[];for(;n.length<e;)n.push(Tt(t));return n}function Ide(e,t){let n=e.lastReadGroup,r=[];for(let i=0;i<12;i++){if(n.code!==t)throw new Error(`Expected code for matrix value to be ${t} but got ${n.code}`);r.push(n.value),n=e.next()}return r}var vC=class{constructor(){this.ForObjectName="XRECORD"}parseObject(e,t){let n={type:t.value,binaryData:""};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 100:case 311:t=e.next();break;case 280:n.cloningFlag=t.value,t=e.next();break;case 310:n.binaryData+=t.value,t=e.next();break;default:No(n,t),t=e.next()}return n}};function udt(e){e.registerEntityHandler(Ix),e.registerEntityHandler(Dx),e.registerEntityHandler(Ox),e.registerEntityHandler(Lx),e.registerEntityHandler(kx),e.registerEntityHandler(Fx),e.registerEntityHandler(Gx),e.registerEntityHandler(Nx),e.registerEntityHandler(Bx),e.registerEntityHandler(Ux),e.registerEntityHandler(Hx),e.registerEntityHandler(Vx),e.registerEntityHandler(zx),e.registerEntityHandler(qx),e.registerEntityHandler(Wx),e.registerEntityHandler(jx),e.registerEntityHandler(Xx),e.registerEntityHandler($x),e.registerEntityHandler(Kx),e.registerEntityHandler(Zx),e.registerEntityHandler(Jx),e.registerEntityHandler(Qx),e.registerEntityHandler(eb),e.registerEntityHandler(tb),e.registerEntityHandler(nb),e.registerEntityHandler(rb),e.registerEntityHandler(ib)}function hdt(e){e.registerObjectHandler(fC),e.registerObjectHandler(dC),e.registerObjectHandler(pC),e.registerObjectHandler(mC),e.registerObjectHandler(gC),e.registerObjectHandler(vC)}function fdt(e){let t=new Uh(e).readBytes(22),n="";for(let e=0;e<18;e++)n+=String.fromCharCode(t[e]);return"AutoCAD Binary DXF"===n}var Zd=class{constructor(e){this._entityHandlers={},this._objectHandlers={},this._layoutBlocks={},this.unhandledSections={},this.unhandledObjects={},this.unhandledEntities={},this.unsupportedLineTypes={},this.encoding=e,udt(this),hdt(this)}parse(e){if("string"==typeof e){let t=this.splitByLineSeparator(e),n=new v0(t);return this._parse(n)}{let t;if(fdt(e))t=new Px(e);else{let n=new TextDecoder(this.encoding).decode(e),r=Date.now(),i=this.splitByLineSeparator(n);fe.info(`[DxfParser] string.split took ${(Date.now()-r)/1e3}s, it is avoidable by using dxf in binary.`),t=new v0(i)}return this._parse(t)}}registerEntityHandler(e){let t=new e;this._entityHandlers[t.ForEntityName]=t}registerObjectHandler(e){let t=new e;this._objectHandlers[t.ForObjectName]=t}parseSync(e){return this.parse(e)}parseStream(e){let t="",n=this;return new Promise(((r,i)=>{e.on("data",(e=>{t+=e})),e.on("end",(()=>{try{r(n.parse(t))}catch(e){i(e)}})),e.on("error",(e=>{i(e)}))}))}_parse(e){let t={},n=0;if(!e.hasNext())throw Error("Empty file");let r,i=this;function a(){let t=null,n=null,i={};for(r=e.next();;){if(Qa(r,0,"ENDSEC")){t&&(i[t]=n);break}9===r.code?(t&&(i[t]=n),t=r.value):10===r.code?n={x:r.value}:20===r.code?n.y=r.value:30===r.code?n.z=r.value:n=r.value,r=e.next()}return r=e.next(),i}function s(){let t={};for(r=e.next();"EOF"!==r.value&&!Qa(r,0,"ENDSEC");)if(Qa(r,0,"BLOCK")){fe.trace("block {");let e=o();fe.trace("}"),m(e),e.name?t[e.name]=e:fe.error(`[DxfParser] Block with handle '${e.handle}' is missing a name, ignored!`)}else gu(r),r=e.next();return t}function o(){let t={};for(r=e.next();"EOF"!==r.value;){switch(r.code){case 1:t.xrefPath=r.value,r=e.next();break;case 2:t.name=r.value,r=e.next();break;case 3:t.name2=r.value,r=e.next();break;case 4:t.description=r.value,r=e.next();break;case 5:t.handle=r.value,r=e.next();break;case 8:t.layer=r.value,r=e.next();break;case 10:t.position=f(r),r=e.lastReadGroup;break;case 67:t.paperSpace=!(!r.value||1!==r.value),r=e.next();break;case 70:t.blockType=r.value,r=e.next();break;case 100:r=e.next();break;case 330:t.ownerHandle=r.value,r=e.next();break;case 0:if("ENDBLK"==r.value)break;t.entities=d(!0);break;default:gu(r),r=e.next()}if(Qa(r,0,"ENDBLK")){r=e.next();break}}return t}function l(){let t={};for(r=e.next();"EOF"!==r.value&&!Qa(r,0,"ENDSEC");)Qa(r,0,"TABLE")?(r=e.next(),c[r.value]?(fe.trace(r.value+" Table {"),t[c[r.value].tableName]=u(r),fe.trace("}")):fe.trace("Unhandled Table "+r.value)):r=e.next();return r=e.next(),t}let h="ENDTAB";function u(t){let n=c[t.value],i={},a=0;for(r=e.next();!Qa(r,0,h);)switch(r.code){case 5:i.handle=r.value,r=e.next();break;case 330:i.ownerHandle=r.value,r=e.next();break;case 100:"AcDbSymbolTable"===r.value||gu(r),r=e.next();break;case 70:a=r.value,r=e.next();break;case 0:r.value===n.dxfSymbolName?i[n.tableRecordsProperty]=n.parseTableRecords():(gu(r),r=e.next());break;default:gu(r),r=e.next()}let s=i[n.tableRecordsProperty];if(s){let e=s.constructor===Array?s.length:"object"==typeof s?Object.keys(s).length:void 0;a!==e&&fe.warn(`[DxfParser] Parsed ${e} ${n.dxfSymbolName}s but expected ${a}`)}return r=e.next(),i}let c={VPORT:{tableRecordsProperty:"viewports",tableName:"viewport",dxfSymbolName:"VPORT",parseTableRecords:function(){let t=[],n={};for(fe.trace("Viewport {"),r=e.next();!Qa(r,0,h);)switch(r.code){case 2:n.name=r.value,r=e.next();break;case 10:n.lowerLeftCorner=f(r),r=e.lastReadGroup;break;case 11:n.upperRightCorner=f(r),r=e.lastReadGroup;break;case 12:n.center=f(r),r=e.lastReadGroup;break;case 13:n.snapBasePoint=f(r),r=e.lastReadGroup;break;case 14:n.snapSpacing=f(r),r=e.lastReadGroup;break;case 15:n.gridSpacing=f(r),r=e.lastReadGroup;break;case 16:n.viewDirectionFromTarget=f(r),r=e.lastReadGroup;break;case 17:n.viewTarget=f(r),r=e.lastReadGroup;break;case 40:case 45:n.viewHeight=r.value,r=e.next();break;case 41:n.aspectRatio=r.value,r=e.next();break;case 42:n.lensLength=r.value,r=e.next();break;case 43:n.frontClippingPlane=r.value,r=e.next();break;case 44:n.backClippingPlane=r.value,r=e.next();break;case 50:n.snapRotationAngle=r.value,r=e.next();break;case 51:n.viewTwistAngle=r.value,r=e.next();break;case 79:n.orthographicType=r.value,r=e.next();break;case 110:n.ucsOrigin=f(r),r=e.lastReadGroup;break;case 111:n.ucsXAxis=f(r),r=e.lastReadGroup;break;case 112:n.ucsYAxis=f(r),r=e.lastReadGroup;break;case 281:n.renderMode=r.value,r=e.next();break;case 282:n.defaultLightingType=r.value,r=e.next();break;case 292:n.defaultLightingOn=r.value,r=e.next();break;case 330:n.ownerHandle=r.value,r=e.next();break;case 63:case 421:case 431:n.ambientColor=r.value,r=e.next();break;case 0:"VPORT"===r.value&&(fe.trace("}"),t.push(n),fe.trace("Viewport {"),n={},r=e.next());break;default:gu(r),r=e.next()}return fe.trace("}"),t.push(n),t}},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:function(){let t={},n={},a=0,s="",o=!1;for(fe.trace("LType {"),r=e.next();!Qa(r,0,"ENDTAB");)switch(r.code){case 2:n.name=r.value.toUpperCase(),s=n.name,r=e.next();break;case 3:n.description=r.value,r=e.next();break;case 9:case 44:case 45:case 46:case 70:case 75:default:r=e.next();break;case 40:n.patternLength=r.value,r=e.next();break;case 49:let l=r.value;o&&(l=Math.abs(l),o=!1),n.pattern.push(l),r=e.next();break;case 73:a=r.value,a>0&&(n.pattern=[]),r=e.next();break;case 74:0!==r.value&&(o=!0,i.unsupportedLineTypes[n.name]?i.unsupportedLineTypes[n.name]++:i.unsupportedLineTypes[n.name]=1),r=e.next();break;case 0:fe.trace("}"),a>0&&a!==n.pattern.length&&fe.warn("[DxfParser] lengths do not match on LTYPE pattern"),t[s]=n,n={},fe.trace("LType {"),r=e.next()}return fe.trace("}"),t[s]=n,t}},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:function(){let t,n={},i={};for(fe.trace("Layer {"),r=e.next();!Qa(r,0,"ENDTAB");)switch(r.code){case 2:i.name=r.value,t=r.value,r=e.next();break;case 5:i.handle=r.value,r=e.next();break;case 62:i.visible=r.value>=0,i.colorIndex=Math.abs(r.value),i.color=ddt(i.colorIndex),r=e.next();break;case 70:i.flag=r.value,i.frozen=(1&i.flag)>0,r=e.next();break;case 420:i.color=Math.abs(r.value),r=e.next();break;case 6:i.lineType=r.value.toUpperCase(),r=e.next();break;case 370:i.lineweight=r.value,r=e.next();break;case 0:"LAYER"===r.value&&(fe.trace("}"),t&&(n[t]=i),fe.trace("Layer {"),i={},t=void 0,r=e.next());break;default:gu(r),r=e.next()}return fe.trace("}"),t&&(n[t]=i),n}},BLOCK_RECORD:{tableRecordsProperty:"blockRecords",tableName:"blockRecord",dxfSymbolName:"BLOCK_RECORD",parseTableRecords:function(){let t,n={},a={};for(fe.trace("BlockRecord {"),r=e.next();!Qa(r,0,"ENDTAB");)switch(r.code){case 5:a.handle=r.value,r=e.next();break;case 330:a.ownerHandle=r.value,r=e.next();break;case 2:a.blockName=r.value,t=a.blockName,r=e.next();break;case 340:a.layoutHandle=r.value,r=e.next();break;case 70:a.blockInsertUnits=r.value,r=e.next();break;case 280:a.blockExplodability=r.value,r=e.next();break;case 281:a.blockScalability=r.value,r=e.next();break;case 310:a.bitmap=r.value,r=e.next();break;case 0:if("BLOCK_RECORD"===r.value){fe.trace("}"),t&&(n[t]=a);let s=a.layoutHandle;t&&s&&s.length>0&&"0"!==s&&(i._layoutBlocks[s]=a),fe.trace("BlockRecord {"),a={},t=void 0,r=e.next()}else gu(r),r=e.next();break;default:gu(r),r=e.next()}fe.trace("}"),t&&(n[t]=a);let s=a.layoutHandle;return t&&s&&s.length>0&&"0"!==s&&(i._layoutBlocks[s]=a),n}},STYLE:{tableRecordsProperty:"styles",tableName:"style",dxfSymbolName:"STYLE",parseTableRecords:function(){let t,n={},i={};for(fe.trace("Style {"),r=e.next();!Qa(r,0,"ENDTAB");)switch(r.code){case 2:i.styleName=r.value,t=r.value,r=e.next();break;case 3:i.fontFile=r.value,r=e.next();break;case 4:i.bigFontFile=r.value,r=e.next();break;case 5:i.handle=r.value,r=e.next();break;case 40:i.textHeight=r.value,r=e.next();break;case 41:i.xScale=r.value,r=e.next();break;case 42:i.priorTextHeight=r.value,r=e.next();break;case 50:i.rotation=r.value,r=e.next();break;case 70:default:r=e.next();break;case 71:i.mirrorType=r.value,r=e.next();break;case 330:i.ownerHandle=r.value,r=e.next();break;case 0:"STYLE"===r.value&&(fe.trace("}"),t&&(n[t]=i),fe.trace("Style {"),i={},t=void 0,r=e.next())}return fe.trace("}"),t&&(n[t]=i),n}},DIMSTYLE:{tableRecordsProperty:"dimStyles",tableName:"dimStyle",dxfSymbolName:"DIMSTYLE",parseTableRecords:function(){let t,n={},i={};for(fe.trace("DimStyle {"),r=e.next();!Qa(r,0,"ENDTAB");)switch(r.code){case 2:i.styleName=r.value,t=r.value,r=e.next();break;case 40:i.DIMSCALE=r.value,r=e.next();break;case 41:i.DIMASZ=r.value,r=e.next();break;case 42:i.DIMEXO=r.value,r=e.next();break;case 44:i.DIMEXE=r.value,r=e.next();break;case 75:i.DIMSE1=r.value,r=e.next();break;case 76:i.DIMSE2=r.value,r=e.next();break;case 77:i.DIMTAD=r.value,r=e.next();break;case 140:i.DIMTXT=r.value,r=e.next();break;case 144:i.DIMLFAC=r.value,r=e.next();break;case 147:i.DIMGAP=r.value,r=e.next();break;case 176:i.DIMCLRD=r.value,r=e.next();break;case 178:i.DIMCLRT=r.value,r=e.next();break;case 271:i.DIMDEC=r.value,r=e.next();break;case 341:i.DIMLDRBLK=r.value,r=e.next();break;case 70:default:r=e.next();break;case 0:"DIMSTYLE"===r.value&&(fe.trace("}"),t&&(n[t]=i),fe.trace("DimStyle {"),i={},t=void 0,r=e.next())}return fe.trace("}"),t&&(n[t]=i),n}}};function d(t){let n=[],a=t?"ENDBLK":"ENDSEC";for(t||(r=e.next());;)if(0===r.code){if(r.value===a)break;let t=i._entityHandlers[r.value];if(null==t){let t=r.value;i.unhandledEntities[t]||(i.unhandledEntities[t]=0),i.unhandledEntities[t]++,r=e.next();continue}{fe.trace(r.value+" {");let i=t.parseEntity(e,r);i&&(i.layer||(i.layer="0"),void 0===i.colorIndex&&(i.colorIndex=256),i.lineType||(i.lineType=p0)),r=e.lastReadGroup,fe.trace("}"),m(i),n.push(i)}}else r=e.next();return"ENDSEC"==a&&(r=e.next()),n}function p(){let t={};for(r=e.next();"EOF"!==r.value;)if(0===r.code){if("ENDSEC"===r.value)break;let n=i._objectHandlers[r.value];if(null==n){let t=r.value;i.unhandledObjects[t]||(i.unhandledObjects[t]=0),i.unhandledObjects[t]++,r=e.next();continue}{fe.trace(r.value+" {");let i=n.parseObject(e,r),a=r.value;r=e.lastReadGroup,fe.trace("}"),m(i),t[a]||(t[a]=[]),t[a].push(i)}}else r=e.next();return r=e.next(),t.LAYOUT&&(Object.keys(i._layoutBlocks).length!==t.LAYOUT.length&&fe.warn("[DxfParser] The number of layout and block associations does not match!"),t.LAYOUT.forEach((e=>{i._layoutBlocks[e.handle]&&(e.associatedBlockName=i._layoutBlocks[e.handle].blockName)})),t.LAYOUT.sort(((e,t)=>e.tabOrder-t.tabOrder))),t}function f(t){let n={},r=t.code;if(n.x=t.value,r+=10,(t=e.next()).code!=r)throw new Error(`Expected code for point value to be ${r} but got ${t.code}.`);return n.y=t.value,r+=10,(t=e.next()).code!=r||(n.z=t.value,t=e.next()),n}function m(e){if(!e)throw new TypeError("entity cannot be undefined or null");e.handle||(e.handle=(n++).toString())}return function(){for(r=e.next();999===r.code;)r=e.next();for(;!e.isEOF();)if(0===r.code&&"SECTION"===r.value){if(r=e.next(),2!==r.code){fe.error("Unexpected code %s after 0:SECTION",Dde(r)),r=e.next();continue}if("HEADER"===r.value)fe.trace("> HEADER"),t.header=a(),fe.trace("<");else if("TABLES"===r.value)fe.trace("> TABLES"),t.tables=l(),fe.trace("<");else if("BLOCKS"===r.value)fe.trace("> BLOCKS"),t.blocks=s(),fe.trace("<");else if("ENTITIES"===r.value)fe.trace("> ENTITIES"),t.entities=d(!1),fe.trace("<");else if("OBJECTS"===r.value)fe.trace("> OBJECTS"),t.objects=p(),fe.trace("<");else if("EOF"===r.value)fe.trace("EOF");else{let e=r.value;i.unhandledSections[e]?i.unhandledSections[e]++:i.unhandledSections[e]=1}}else r=e.next();i.unhandledSections={},i.unhandledEntities={},i.unhandledObjects={},i.unsupportedLineTypes={}}(),t}splitByLineSeparator(e){let t=[],n=0;for(let r=0,i=e.length;r<i;++r){let i=e[r];if("\r"===i||"\n"===i){let a=e.substring(n,r);t.push(a),"\r"===i&&"\n"===e[r+1]&&r++,n=r+1}}return t.push(e.substring(n,e.length)),t}};function Qa(e,t,n){return e.code===t&&e.value===n}function gu(e){fe.trace("unhandled group "+Dde(e))}function Dde(e){return e.code+":"+e.value}function ddt(e){return sC[e]}var Ml=new q(1,0,0),DN=new q(0,1,0),y0=new q(0,0,1),Ode=new q(0,0,0),qh=16777215,pdt="CONTINUOUS",yC=new Wi({color:qh}),Es=new gr({color:qh}),x0=new mr({color:qh}),Lde=(new Nt).setFromPoints([new q]),kde=new At,Hh=new At,us=new At,un=new q,br=new q,Vh=new q,sb=new Te,Bs=new Ci,xC=new Cn,zh=new Ft,Fde=new Wi({color:65280,size:5,depthTest:!1}),Nde=new Wi({color:65280,depthTest:!1}),Bde=new Wi({color:65280,depthTest:!1}),mdt=e=>void 0!==e.viewDirectionFromTarget,gdt=e=>{if(e){let t=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(t&&t.length>0){let n=t[1],r=e.replace("data:"+n+";","").split(",");if(r&&2===r.length&&"base64"===r[0]){let e=r[1];return nde.decode(e)}}}return null},Ude=(e,t)=>{let n=new Te(e.x,e.y),r=new Te(t.x,t.y);return r.sub(n),r.normalize(),r.y<0?-Math.acos(r.x):Math.acos(r.x)},Hde=(e,t,n)=>({x:e.x+t*Math.cos(n),y:e.y+t*Math.sin(n)}),vdt=(e,t,n,r)=>{let i=e?new Te(e.x,e.y):new Te(0,0),a=t?new Te(t.x,t.y):new Te(1,0);n=n||1;let s=4*Math.atan(n),o=i.distanceTo(a)/2/Math.sin(s/2),l=Hde(e,o,Ude(i,a)+(Math.PI/2-s/2));r=r||Math.max(Math.abs(Math.ceil(s/(Math.PI/18))),6);let h=Ude(l,i),u=s/r,c=[];c.push(new q(i.x,i.y,0));for(let e=1;e<=r-1;e++){let t=Hde(l,Math.abs(o),h+u*e);c.push(new q(t.x,t.y,0))}return c},Vde=(e,t,n,r=2*e.length,i)=>{let a=[],s=e.map((e=>[e.x,e.y]));for(let e=0;e<1;e+=1/r){let r=Mde(e,t,s,n,i);a.push(new q(r[0],r[1],0))}return a},ON=(e,t=!1)=>{let n=[],r=e.length;for(let i=0;i<r;i++){let a=e[i];if(a.bulge&&(i!==r-1||t)){let t=a.bulge,s=i+1<r?e[i+1]:n[0],o=vdt(a,s,t);n.push(...o)}else n.push(new q(a.x,a.y,0))}return n},ydt=e=>{let t=[];return e.faceA&&t.push(e.faceA),e.faceB&&t.push(e.faceB),e.faceC&&t.push(e.faceC),e.faceD&&t.push(e.faceD),t},xdt=e=>{let t=[],n=[];e.forEach((e=>{e.polyfaceMeshVertex&&(e.threeDPolylineMesh?t.push(new q(e.x,e.y,e.z)):n.push(ydt(e)))}));let r=[];for(let e=0;e<n.length;e++){let i=n[e];if(0===i.length)continue;let a=[],s=!0;for(let e=0;e<i.length;e++){let n=i[e]-1;if(n>=t.length||n<0){s=!1;break}a.push(t[n])}!s||0===a.length||(a.push(a[0]),r.push(a))}return r},kn=class extends Ri{constructor(e,t){super(e),this.timer=Date.now(),this.ignorePaperSpace=!1,this.encoding="UTF-8",this.angBase=0,this.angDir=0,this.header=void 0,this.pointsMaterials={},this.lineBasicMaterials={},this.lineShaderMaterials={},this.meshBasicMaterials={},this.meshTextureMaterials={},this.hatchShaderMaterials=[],this.entityCount=0,this.curveCount=0,this.averageCurveSize=0,this.enableRenderOrder=!1,this.enableLocalCache=!0,this.enableReleaseData=!0,this.enableMerge=!0,this.enableRTC=!0,this.enablePlineWidth=!0,this.dxfDataId=void 0,this.compareContext=void 0,this.statsInfo={unsupportedEntity:{},unsupportedEntityTypes:{},unsupportedTextStyles:{},unsupportedHatchPatterns:{},unsupportedPolylineCount:0,invisibleEntities:{},ignoredFrozenLayersAndEntityCount:{},ignoredInserts:{},entityTypesAndMeshCount:{},ignoredPaperSpaceEntityTypesAndCount:{},rebasedEntityCount:0},this.blockReferencesCache={},this.blockRecordsCache=void 0,this.entitiesCache=void 0,this.blocksCache=void 0,this.dictionaryOwnerHandleAndSpatialFilterHandlesCache=void 0,this.spatialFiltersCache=void 0,this.entityThreejsCache=void 0,this.entityTypesAndTimes=void 0,this.nonSnapableTypes=new Set(["ATTDEF","ATTRIB","LEADER","MTEXT","MULTILEADER","OLE2FRAME","TEXT"]),this.layoutsSnapObjectsMap={},this.aborted=!1,this.entityHandlesWithRenderOrder={},this.addViewport=(e,t)=>{if("VIEWPORT"===e.type){t[e.ownerHandle]||(t[e.ownerHandle]=[]);let n=e;t[e.ownerHandle].push(n)}},t&&(this.ignorePaperSpace=!0===t.ignorePaperSpace,this.enableLocalCache=!1!==t.enableLocalCache,this.enableMerge=!1!==t.enableMerge,this.encoding=t.encoding||"UTF-8",null!=t.overrideColor&&(this.overrideColor=cn.rgb2Hex(t.overrideColor)),null!=t.overrideHatchPatternLineThickness&&(this.overrideHatchPatternLineThickness=t.overrideHatchPatternLineThickness)),this.pointsMaterials[qh]=yC,this.lineBasicMaterials[qh]=Es,this.meshBasicMaterials[qh]=x0}setFont(e){this.font=e}download(e,t){return Et(this,null,(function*(){let n=gdt(e);if(!n){let r=Date.now(),i=new Ls(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),n=yield i.loadAsync(e,t),fe.info(`[Dxf] ${e} dxf file downloaded in ${(Date.now()-r)/1e3}s`)}return n}))}loadEx(e,t,n){return Et(this,null,(function*(){return this.enableLocalCache&&t&&(t=t.trim()).length>0&&(this.dxfDataId=t),this.loadAsync(e,n)}))}loadAsync(e,t){return Et(this,null,(function*(){let n=Ct.getUpdateSubProgressFunc(0,50,t),r=Ct.getUpdateSubProgressFunc(50,100,t),i=Ct.getUpdateSubProgressFunc(10,100,t);if(Bn.isBrowser&&this.enableLocalCache&&this.dxfDataId){let e;try{if(this.timer=Date.now(),e=yield this.getDxfDataFromIndexedDb(this.dxfDataId),e){this.tryFixDxfData(e),fe.info(`[Dxf] Loaded DxfData from indexedDb in ${(Date.now()-this.timer)/1e3}s`);let t=yield this.loadEntities(e,i);return Promise.resolve(t)}}catch(e){fe.warn("[Dxf] Failed to parse data from indexedDb",e)}}let a=yield this.parse(e,n);return this.tryFixDxfData(a),yield this.loadEntities(a,r)}))}parse(e,t){return Et(this,null,(function*(){let n=Ct.getUpdateProgressFunc(t),r=Ct.getUpdateSubProgressFunc(0,40,t),i=yield this.download(e,r);if(!i)return Promise.reject(`[Dxf] Failed to download ${e}`);if(this.aborted)return Promise.reject("[Dxf] Job aborted");this.timer=Date.now(),fe.info("[Dxf] Start parsing...");let a=new Zd(this.encoding).parseSync(i);if(this.tryFixDxfData(a),n(80),fe.info(`[Dxf] Parsed in ${(Date.now()-this.timer)/1e3}s, creating entities...`),this.aborted)return Promise.reject("[Dxf] Job aborted");if(a&&Bn.isBrowser&&this.enableLocalCache&&this.dxfDataId){let e=Date.now();try{yield this.setDxfDataToIndexedDb(this.dxfDataId,a),fe.info(`[Dxf] Saved to indexedDb in ${(Date.now()-e)/1e3}s`)}catch(e){fe.warn(`[Dxf] Failed to save '${this.dxfDataId}' to indexedDb!`,e)}}return n(100),a}))}abort(){this.aborted=!0}isAborted(){return this.aborted}parseHeader(e){if(!e)return void fe.error("[Dxf]: Invalid header!");this.header=e;let t=e.$ACADVER.toString();"AC1032"!==t&&fe.warn(`[Dxf] Unexpected version: ${t}. But we'll try to continue.`),this.angBase=e.$ANGBASE||0,this.angDir=e.$ANGDIR||0}tryFixDxfData(e){e&&(e.objects||(fe.warn("[Dxf] No objects found, Will add one."),e.objects={}),e.objects.LAYOUT||(fe.warn("[Dxf] No layout defined! Will add a default 'Model' layout!"),e.objects.LAYOUT=[{layoutName:kn.MODEL_LAYOUT_NAME}]),e.tables||(fe.warn("[Dxf] No tables found, Will add one."),e.tables={}),e.tables.layer||(e.tables.layer={}),e.tables.layer.layers||(e.tables.layer.layers={}))}loadEntities(e,t){return Et(this,null,(function*(){let n=Date.now();this.parseHeader(e.header),this.enableRenderOrder&&(this.initRenderOrderInfo(e),this.enableMerge=!1),this.getFontFilesFromDxf(e);let r=0,i=e.entities.length;this.entityCount=i,Object.keys(e.blocks).forEach((t=>{var n;this.entityCount+=(null==(n=e.blocks[t].entities)?void 0:n.length)||0}));let a=Ct.getUpdateProgressFuncForLoop(i,t),s={},o=e=>{let t=e.userData.layerName,n=s[t];n||(n=[],s[t]=n),n.push(e)},l={},h={},u=new nn;for(let t=0;t<i&&!this.aborted;t++){let n=e.entities[t];this.addViewport(n,l);let i=this.loadEntity(n,e);if(i||(yield a(t)),!i)continue;let s=this.getLayout(e,n).layoutName,c=u.children.find((e=>e.name===s));if(c||(c=new nn,c.name=s,c.userData.isLayoutLevelObject=!0,u.add(c)),i.traverse((e=>{e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[s]||(this.layoutsSnapObjectsMap[s]=[]),this.layoutsSnapObjectsMap[s].push(e))})),this.enableMerge){wl.merge(i,!1),h[s]||(h[s]={object:c,layerObjects:{}});let e=h[s];if(i.geometry){let t=i.userData.layerName;e.layerObjects[t]||(e.layerObjects[t]=[]),e.layerObjects[t].push(i),i.children.forEach((e=>{e.userData.isSnapObject&&o(e)}))}else i.children.length>0&&(c.add(i),i.traverse((e=>{e.geometry&&o(e)})))}else c.add(i),i.traverse((e=>{e.geometry&&o(e)}));r++,yield a(t)}e.objects.LAYOUT.forEach((t=>{let n=t,r=n.layoutName;if(this.ignorePaperSpace&&r!==kn.MODEL_LAYOUT_NAME)return;let i=n.associatedBlockName,a=e.blocks[i];a&&this.loadLayout(a,e,n,u,s,l)})),fe.debug(`[Dxf] Drew entities in ${(Date.now()-n)/1e3}s`);for(let t in this.layoutsSnapObjectsMap){let n=u.children.find((e=>e.name===t)),r=new nn;r.name=kn.SNAP_GROUP_NAME,r.userData.isSnapGroup=!0,n.add(r);let i=this.layoutsSnapObjectsMap[t];for(let t=0;t<i.length;t++){let n=i[t],a=n.userData.layerName;!1===this.getLayerVisible(e,a)&&n.layers.disable(11),kn.SHOW_SNAP_OBJECT&&(n.layers.enableAll(),n.material instanceof Wi?n.material=Fde:n.material instanceof gr?n.material=Nde:n.material instanceof mr&&(n.material=Bde));let s=n,o=us.identity();for(;s&&!0!==s.userData.isLayoutLevelObject;)o.premultiply(s.matrix),s=s.parent;n.matrix.copy(o),r.add(n)}}if(this.enableMerge)for(let e in h){let t=h[e],n=t.object;for(let e in t.layerObjects){let r=t.layerObjects[e],i=wl.deepMerge(r,void 0,!1,!1,!0),a=i.added,s=i.removed;if(s.length!==r.length){let e=s;s.length>=100&&(e=new Set(s));let t=t=>Array.isArray(e)?e.indexOf(t)>=0:e.has(t);for(let e=0,i=r.length;e<i;e++){let i=r[e];t(i)||(n.add(i),o(i))}}for(let e=0;e<a.length;e++){let t=a[e];n.add(t),o(t)}t.layerObjects[e]=[]}}this.printStatsInfo(),this.enableReleaseData&&(this.releaseCachedData(),this.releaseDxfData(e)),this.enableMerge&&kn.mergeDxfObjects({root:u,layersAndObjects:s});let c=u.convertToThreejsObject();u.clear(),s={};let d={};e.objects.LAYOUT.forEach((e=>{let t=e;d[t.layoutName]=t}));let p={};c.children.forEach((t=>{if(yr.setSharedVariablesOfObject(t),!t.userData.isLayoutLevelObject)return;let n,r=t.name;if(r!==kn.MODEL_LAYOUT_NAME){let e=d[r];e.directAssociatedLeafObjectSet||(e.directAssociatedLeafObjectSet=new Set),n=e.directAssociatedLeafObjectSet}t.traverse((t=>{if(yr.setSharedVariablesOfObject(t),t.userData.isSnapGroup&&(t.visible=kn.SHOW_SNAP_OBJECT),t.geometry){let r=t.userData.layerName;!1===this.getLayerVisible(e,r)&&(t.visible=!1,t.userData.layerVisible=!1),(e=>{let t=e.userData.layerName,n=p[t];n||(n=[],p[t]=n),n.push(e)})(t),n&&n.add(t)}}))})),fe.info(`[Dxf] loadEntities() done in ${(Date.now()-n)/1e3}s`);let f=Ki(oi({},e),{threejsObject:c,layersAndThreejsObjects:p,loadedEntityCount:r,layoutViewportsMap:l});return Promise.resolve(f)}))}getFontFilesFromDxf(e){var t,n;let r=new Set,i=null==(n=null==(t=e.tables)?void 0:t.style)?void 0:n.styles;if(i)for(let e in i){let t=i[e],n=t.fontFile,a=t.bigFontFile;n&&r.add(n),a&&r.add(a)}fe.info(`[Dxf] Fonts used by dxf: ${Array.from(r).join()}`)}loadEntitiesForCompare(e,t,n,r=!0,i){return Et(this,null,(function*(){let a=e.entities.length,s=t.entities.length,o=()=>Et(this,null,(function*(){var o;let l=this.compareContext,h=l.isTheFirstFile,u=h?e:t,c=new nn,d=h?a:s,p=u.entities.length;this.entityCount=p,Object.keys(u.blocks).forEach((e=>{var t;this.entityCount+=(null==(t=u.blocks[e].entities)?void 0:t.length)||0}));let f=Math.round(Math.pow(d,.5)),m=Date.now(),g=e=>Et(this,null,(function*(){if(i&&(e%f==0||e===d-1)){let t=e+1;h||(t+=a),i(new ProgressEvent("parseProgress",{loaded:t,total:a+s}));let n=500,r=Date.now();(r-m>n||e===d-1)&&(yield Ct.sleep(0),m=r)}}));this.parseHeader(u.header);let v={};for(let e=0;e<d;e++){if(this.aborted)return;let t=u.entities[e],n=this.getLayout(u,t);if(n.layoutName!==kn.MODEL_LAYOUT_NAME){yield g(e);continue}let r=this.loadEntity(t,u);if(!r){yield g(e);continue}let i=c.children.find((e=>e.name===kn.MODEL_LAYOUT_NAME));i||(i=new nn,i.name=kn.MODEL_LAYOUT_NAME,i.userData.isLayoutLevelObject=!0,c.add(i)),i.add(r),r.traverse((e=>{if(e.geometry){let t=e.userData.layerName,i=this.getLayerVisible(u,t);e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[n.layoutName]||(this.layoutsSnapObjectsMap[n.layoutName]=[]),this.layoutsSnapObjectsMap[n.layoutName].push(e),!1===i&&r.layers.disable(11));let a=v[t];a||(a=[],v[t]=a),a.push(e)}})),yield g(e)}r&&h&&(l.preservedHandles||(l.preservedHandles=new Set));for(let e in n){let t=n[e];h&&("Added"===t.type||"Modified"===t.type)&&(null==(o=l.preservedHandles)||o.add(t.handle),t.parentHandles&&t.parentHandles.forEach((e=>{var t;return null==(t=l.preservedHandles)?void 0:t.add(e)})));let r=this.entityThreejsCache&&this.entityThreejsCache[t.handle];if(t.parentHandles&&(r=this.entityThreejsCache&&this.entityThreejsCache[t.parentHandles[t.parentHandles.length-1]]),r){if(r.parent&&r.parent.userData.originalType){this.setObjectColorByChange(r,{type:"NoChange"});continue}r=this.setObjectColorByChange(r,t)}if("NoChange"!==t.type&&r){let e=r.parent,n=us.identity();for(;e&&!0!==e.userData.isLayoutLevelObject;)n.premultiply(e.matrix),e=e.parent;zh.makeEmpty();let i=nn.getBox(r,zh);i.applyMatrix4(n),"Added"===t.type?!h&&(t.box=(new Ft).copy(i)):"Removed"===t.type?h&&(t.box=(new Ft).copy(i)):"Modified"===t.type&&(t.box?t.box.union(i):t.box=(new Ft).copy(i))}}for(let e in this.layoutsSnapObjectsMap){let t=c.children.find((t=>t.name===e)),n=new nn;n.name=kn.SNAP_GROUP_NAME,t.add(n);let r=this.layoutsSnapObjectsMap[e];for(let e=0;e<r.length;e++){let t=r[e];kn.SHOW_SNAP_OBJECT&&(t.layers.enableAll(),t.material instanceof Wi?t.material=Fde:t.material instanceof gr?t.material=Nde:t.material instanceof mr&&(t.material=Bde));let i=t,a=us.identity();for(;i&&!0!==i.userData.isLayoutLevelObject;)a.premultiply(i.matrix),i=i.parent;t.matrix.copy(a),n.add(t)}}this.enableMerge&&kn.mergeDxfObjects({root:c,layersAndObjects:v});let y=c.convertToThreejsObject();c.clear(),v={};let x={};y.children.forEach((e=>{yr.setSharedVariablesOfObject(e),e.userData.isLayoutLevelObject&&e.traverse((e=>{if(yr.setSharedVariablesOfObject(e),e.userData.isSnapGroup&&(e.visible=kn.SHOW_SNAP_OBJECT),e.geometry){let t=e.userData.layerName;!1===this.getLayerVisible(u,t)&&(e.visible=!1,e.userData.layerVisible=!1),(e=>{let t=e.userData.layerName,n=x[t];n||(n=[],x[t]=n),n.push(e)})(e)}}))}));let b=u;b.threejsObject=y,b.layersAndThreejsObjects=x,b.layoutViewportsMap={}})),l=Date.now();this.compareContext={changes:n,isTheFirstFile:!0},Ct.printMemory("Before loading entities for first dxf"),yield o(),fe.info(`[Dxf] loadEntities for first dxf in ${(Date.now()-l)/1e3}s`),Ct.printMemory("After loading entities for first dxf"),this.releaseCachedData(!1),this.releaseDxfData(e),Ct.printMemory("Before loading entities for second dxf"),l=Date.now(),this.compareContext.isTheFirstFile=!1,yield o(),fe.info(`[Dxf] loadEntities for second dxf in ${(Date.now()-l)/1e3}s`),this.printStatsInfo();for(let e of Object.values(n))e.box||delete n[e.id];this.compareContext.preservedHandles=void 0,this.enableReleaseData&&(this.releaseCachedData(),this.releaseDxfData(t)),Ct.printMemory("After loading entities for second dxf")}))}setObjectColorByChange(e,t){let n=(e,t)=>{e.traverse((e=>{if(e.material)if(e.material instanceof gr)e.material=this.getLineBasicMaterial(t);else if(e.material instanceof mr)e.material=this.getMeshBasicMaterial(t);else if(e.material instanceof Wi)e.material=this.getPointsMaterial(t);else if(e.material instanceof fr){let n=e.material.clone();kn.updateMaterialUniforms(n),n.uniforms.u_color.value.set(t),e.material=n}}))},r=(e=>{var t;let n=cs.ENTITY_COLOR_NO_CHANGE;return"Added"===e.type?n=cs.ENTITY_COLOR_ADDED:"Removed"===e.type?n=cs.ENTITY_COLOR_REMOVED:"Modified"===e.type&&(n=null!=(t=this.compareContext)&&t.isTheFirstFile?cs.ENTITY_COLOR_REMOVED:cs.ENTITY_COLOR_ADDED),n})(t);return e.traverse((i=>{t.parentHandles?i.userData&&i.userData.handle&&i.userData.handle===t.handle&&(n(i,r),e=i):n(i,r)})),e}releaseCachedData(e=!0){e&&(this.pointsMaterials={},this.lineBasicMaterials={},this.lineShaderMaterials={},this.meshBasicMaterials={},this.meshTextureMaterials={},this.hatchShaderMaterials=[]),this.header=void 0,this.blockReferencesCache={},this.blockRecordsCache=void 0,this.blocksCache=void 0,this.entitiesCache=void 0,this.dictionaryOwnerHandleAndSpatialFilterHandlesCache=void 0,this.spatialFiltersCache=void 0,this.entityThreejsCache=void 0,this.entityTypesAndTimes=void 0,this.entityHandlesWithRenderOrder={},this.layoutsSnapObjectsMap={},this.statsInfo={unsupportedEntity:{},unsupportedEntityTypes:{},unsupportedTextStyles:{},unsupportedHatchPatterns:{},unsupportedPolylineCount:0,invisibleEntities:{},ignoredFrozenLayersAndEntityCount:{},ignoredInserts:{},entityTypesAndMeshCount:{},ignoredPaperSpaceEntityTypesAndCount:{},rebasedEntityCount:0}}releaseEntity(e){e.vertices&&(e.vertices=void 0),e.knotValues&&(e.knotValues=void 0),e.controlPoints&&(e.controlPoints=void 0),e.binaryData&&(e.binaryData=void 0),e.text&&(e.text=void 0),e.extendedData&&(e.extendedData=void 0),e.contextData&&(e.contextData=void 0);let t=e;t.boundaryPaths&&(t.boundaryPaths=[]),t.patternLines&&(t.patternLines=void 0)}releaseDxfData(e){delete e.objects.DICTIONARY,delete e.objects.SORTENTSTABLE,delete e.objects.XRECORD,e.tables&&(delete e.tables.dimStyle,delete e.tables.lineType,delete e.tables.style,delete e.tables.blockRecord),e.entities=[],e.blocks={}}loadEntity(e,t,n,r=!1){if(this.compareContext&&this.compareContext.preservedHandles&&this.compareContext.preservedHandles.has(e.handle)&&Xd.includes(e.type)&&(r=!0),!r&&this.compareContext&&this.compareContext.preservedHandles&&!Xd.includes(e.type)&&!this.compareContext.preservedHandles.has(e.handle)&&(!n||n&&!this.compareContext.preservedHandles.has(n.handle)))return;if(!0===this.getLayerFrozen(t,e)){let t=e.layer;return this.statsInfo.ignoredFrozenLayersAndEntityCount[t]||(this.statsInfo.ignoredFrozenLayersAndEntityCount[t]=0),void this.statsInfo.ignoredFrozenLayersAndEntityCount[t]++}if(!1===e.visible||e.invisible)return this.statsInfo.invisibleEntities[e.type]||(this.statsInfo.invisibleEntities[e.type]=0),void this.statsInfo.invisibleEntities[e.type]++;if(this.ignorePaperSpace&&e.inPaperSpace)return this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]||(this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]=0),void this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]++;this.entityThreejsCache||(this.entityThreejsCache={});let i,a=Date.now(),s=!1;if(!this.compareContext&&this.entityThreejsCache[e.handle])i=this.entityThreejsCache[e.handle].clone(),s=!0;else if(!this.statsInfo.unsupportedEntity[e.handle]){if("CIRCLE"===e.type||"ARC"===e.type)i=this.loadArc(e,t,n);else if("LINE"===e.type||"POLYLINE"===e.type)i=this.loadLine(e);else if("XLINE"===e.type)i=this.loadXLine(e);else if("SEQEND"!==e.type)if("RAY"===e.type)i=this.loadRay(e);else if("LWPOLYLINE"===e.type)i=this.loadLWPolyline(e,t,n);else if("3DFACE"===e.type)i=this.load3DFace(e);else if("TEXT"===e.type)i=this.loadText(e,t,n);else if("SOLID"===e.type)i=this.loadSolid(e,t,n);else if("POINT"===e.type)i=this.loadPoint(e,t,n);else if("IMAGE"===e.type)i=this.loadImage(e,t,n);else if("INSERT"===e.type)i=this.loadInsert(e,t,n,r);else if("SPLINE"===e.type)i=this.loadSpline(e,n);else if("MTEXT"===e.type)i=this.loadMText(e,t,n);else if("ELLIPSE"===e.type)i=this.loadEllipse(e,t,n);else if("DIMENSION"===e.type)i=this.loadDimension(e,t);else if("REGION"!==e.type)if("ATTDEF"===e.type)i=this.loadAttDef(e,t,n);else if("ATTRIB"===e.type){if(!n)for(let r=0;r<t.entities.length;r++){let i=t.entities[r];if(e.ownerHandle===i.handle&&(n=i).attributesFollow)break}i=this.loadAttrib(e,t,n)}else"HATCH"===e.type?i=this.loadHatch(e,t,n):"VIEWPORT"===e.type?i=this.loadViewport(e,t,n):"LEADER"===e.type?i=this.loadLeader(e,t,n):"MULTILEADER"===e.type?i=this.loadMLeader(e,t,n):"OLE2FRAME"===e.type?i=this.loadOle2frame(e,t):"ACAD_TABLE"===e.type&&(i=this.loadTable(e,t));i&&(this.entityThreejsCache[e.handle]=i),this.enableReleaseData&&!this.compareContext&&this.releaseEntity(e)}if(i){let r=this.getLayerName(e,t,n);i.userData.handle=e.handle,"INSERT"!==e.type&&"DIMENSION"!==e.type&&i.traverse((i=>{i.geometry&&(i.userData.layerName=r,this.setMaterial(i,e,t,n))})),s||(this.nonSnapableTypes.has(e.type)&&i.traverse((e=>{e.layers.disable(11)})),this.enableRenderOrder&&(this.entityHandlesWithRenderOrder[e.handle]?i.renderOrder=parseInt(this.entityHandlesWithRenderOrder[e.handle],16)+.1:i.renderOrder=parseInt(e.handle,16)))}return Xd.includes(e.type)||(this.entityTypesAndTimes||(this.entityTypesAndTimes={}),this.entityTypesAndTimes[e.type]||(this.entityTypesAndTimes[e.type]={createCount:0,totalTime:0,averageTime:0}),this.entityTypesAndTimes[e.type].createCount++,this.entityTypesAndTimes[e.type].totalTime+=Date.now()-a),i?this.statsInfo.entityTypesAndMeshCount[e.type]?this.statsInfo.entityTypesAndMeshCount[e.type]++:this.statsInfo.entityTypesAndMeshCount[e.type]=1:(this.statsInfo.unsupportedEntityTypes[e.type]?this.statsInfo.unsupportedEntityTypes[e.type]++:this.statsInfo.unsupportedEntityTypes[e.type]=1,Xd.includes(e.type)||(this.statsInfo.unsupportedEntity[e.handle]?this.statsInfo.unsupportedEntity[e.handle]++:this.statsInfo.unsupportedEntity[e.handle]=1)),i}loadEllipse(e,t,n){if(!e.majorAxisEndPoint||!e.center||void 0===e.axisRatio||void 0===e.startAngle||void 0===e.endAngle)return;let r=e.startAngle,i=e.endAngle;if(e.extrusionDirection&&e.extrusionDirection.z<0&&(r=2*Math.PI-e.endAngle,i=2*Math.PI-e.startAngle),Bt.areNumbersEqual(r,i,1e-5))return void fe.warn("[Dxf] Ellipse entity (handle '%s') contains the same start and end angle, ignored!",e.handle);let a=i-r;for(;a>2*Math.PI;)a-=2*Math.PI;Math.abs(a)<=1e-5&&(i=Bt.floorNumber(r+2*Math.PI,5));let s=Math.sqrt(Math.pow(e.majorAxisEndPoint.x,2)+Math.pow(e.majorAxisEndPoint.y,2)),o=s*e.axisRatio,l=Math.atan2(e.majorAxisEndPoint.y,e.majorAxisEndPoint.x),h=new su(e.center.x,e.center.y,s,o,r,i,!1,l),u=1,c=n;null!=c&&c.xScale&&null!=c&&c.yScale&&(u=Math.max(Math.abs(c.xScale),Math.abs(c.yScale)));let d=this.getDivision(r,i,Math.max(s,o)*u),p=h.getPoints(d),f=[],m=p.length;for(let e=0;e<m-1;e++)Bt.areVector2sEqual(p[e],p[e+1],1e-9)||f.push(p[e]);if(f.push(p[m-1]),f.length<2)return void fe.warn("[Dxf] Ellipse entity (handle '%s') contains less than 2 points, ignored!",e.handle);let g=new q,v=!1;this.enableRTC&&(v=Gt.checkAndRebasePositionsOnRTC(f,g));let y=(new Nt).setFromPoints(f),x=new nn(2);x.geometry=y,x.material=Es;let b=new nn(1);return b.geometry=Lde,b.material=yC,b.matrix.setPosition(e.center.x,e.center.y,e.center.z),b.userData.isSnapObject=!0,b.userData.type="CircleCenter",b.layers.set(11),x.add(b),v&&(this.setRTCUserData(x),x.matrix.setPosition(g.x,g.y,0)),x.layers.enableAll(),x}loadMText(e,t,n){if(!e.text)return;if(!this.font)return void fe.info("[Dxf] Font file not set, ignoring text entity.");let r=this.getTextStyle(t,e),i=cC(e.text,{encoding:this.getTextEncoding(r)}),a=this.getMTextGroup(i,e,r,t,n),s=a&&a.object;if(!s)return;s.matrix.decompose(br,Bs,Vh),e.position&&(br.x+=e.position.x,br.y+=e.position.y,s.matrix.compose(br,Bs,Vh)),zh.makeEmpty();let o=nn.getBox(s,zh).getSize(un),l=e.width||o.x,h=e.height||o.y,u=0,c=0;switch(e.attachmentPoint){case 1:u=0,c=0;break;case 2:u-=l/2,c=0;break;case 3:u-=l,c=0;break;case 4:u=0,c+=h/2;break;case 5:u-=l/2,c+=h/2;break;case 6:u-=l,c+=h/2;break;case 7:u=0,c+=h;break;case 8:u-=l/2,c+=h;break;case 9:u-=l,c+=h;break;default:return}s.traverse((e=>{e.geometry&&e.geometry.translate(u,c,0),e.layers.enableAll()}));let d=0;if(e.rotation&&(d=e.rotation*Math.PI/180),e.directionVector){let t=e.directionVector,n=new q(t.x,t.y,t.z),r=n.clone().cross(Ml),i=Ml.angleTo(n);d=r.z>0?-i:i}Gt.shouldRebasePositionOnRTC(br)&&this.setRTCUserData(s),s.matrix.compose(br,Bs,Vh);let p=e.position?br.clone().sub(e.position):br;return Hh.makeTranslation(-p.x,-p.y,0),us.makeRotationZ(d),s.matrix.multiply(Hh),s.matrix.multiply(us),s.matrix.multiply(Hh.invert()),s}getMTextGroup(e,t,n,r,i,a=0,s=0,o=[]){var l,h,u,c;if(0===e.length)return;let d=t.height||t.contextData&&t.contextData.textHeight||0;if(t.textStyle){if(n&&n.fontFile&&n.fontFile.endsWith(".shx")){let e=`${n.fontFile}_${n.styleName}`;this.statsInfo.unsupportedTextStyles[e]||(this.statsInfo.unsupportedTextStyles[e]=0),this.statsInfo.unsupportedTextStyles[e]++}d=d||n.textHeight}let p=t.lineSpaceFactor||1,f="Left";t.width&&t.attachmentPoint&&([1,4,7].includes(t.attachmentPoint)?f="Left":[2,5,8].includes(t.attachmentPoint)?f="Center":[3,6,9].includes(t.attachmentPoint)&&(f="Right"));let m,g=t.width||0,v=new nn,y=n.fontFile,x=1,b=1,_=256,w=p*d*.3,S=w+d;for(let M=0;M<e.length;M++){let T=e[M];if("string"==typeof T){let e,M=[],E=e=>{let t;if(e.forEach(((e,n)=>{e.boundingBox||e.computeBoundingBox(),0===n?t=e.boundingBox:t.union(e.boundingBox)})),t){let n=t.getSize(un);switch(f){case"Left":default:break;case"Center":e.forEach((e=>e.translate((g-n.x)/2,0,0)));break;case"Right":e.forEach((e=>e.translate(g-n.x,0,0)))}}M.push(...e)};for(let t=0;t<T.length;t++){let r=T[t];if("\n"!==r)if(w=p*d*.3,S=w+d,e=null==(l=this.font)?void 0:l.getCharShape(r,y,d),n.bigFontFile&&!e&&(e=null==(h=this.font)?void 0:h.getCharShape(r,n.bigFontFile,d)),e||(e=null==(u=this.font)?void 0:u.getCharShape(r,"",d)),e||(e=null==(c=this.font)?void 0:c.getNotFoundTextShape(d)),e)if(e.translate(a,s,0),e.scale(x,1,1),a>(g||1/0))a=0,s-=S,o.length>0&&E(o),o=[];else{e.boundingBox||e.computeBoundingBox();let t=e.boundingBox.getSize(un).x;" "===r&&(t=d/2),a+=t+b*(d/6),o.push(e)}else a+=d+b*(d/6);else a=0,s-=S,o.length>0&&E(o),o=[]}o.length>0&&(E(o),o=[]);let A=new nn;if(M.length>0){m||(m=t.colorIndex),void 0!==_&&256!==_?(t.color=Yd(_),t.colorIndex=_):t.colorIndex=m;let e=this.getColor(t,r,i),n=M.filter((e=>e instanceof rs)),a=M.filter((e=>!(e instanceof rs)));if(n.length>0){let t=new nn(4);t.geometry=ri(n),t.material=this.getMeshBasicMaterial(e),A.add(t)}if(a.length>0){let t=new nn(3);t.geometry=ri(a),t.material=this.getLineBasicMaterial(e),A.add(t)}}A.matrix.makeTranslation(0,-d,0),v.add(A),x=1,b=1,_=256,p=t.lineSpaceFactor||1}else if(Array.isArray(T)){let e=this.getMTextGroup(T,t,n,r,i,a,s,o);e&&(v.add(e.object),a=e.hOffset,s=e.vOffset)}else"object"==typeof T&&(T.f&&(y=T.f,y&&y.includes(".shx")&&fe.info(`[Dxf] Doesn't support custom fonts: ${y}`)),T.C&&(_=T.C),T.W&&(x="x"===T.W[1]?T.W[0]*t.width:T.W[0]),T.H&&(d="x"===T.H[1]?T.H[0]*t.height:T.H[0]),T.T&&(b=T.T))}return 0!==v.children.length?(wl.merge(v,!1),m&&(t.colorIndex=m),1===v.children.length?{object:v.children[0],hOffset:a,vOffset:s}:{object:v,hOffset:a,vOffset:s}):void 0}mtextContentAndFormattingToTextAndStyle(e,t){let n={horizontalAlignment:"",textHeight:t.height||t.contextData&&t.contextData.textHeight},r={},i=1,a=[];for(let s=0;s<e.length;s++){let o=e[s];if("string"==typeof o){if(o.startsWith("\\pxq")&&o.endsWith(";"))-1!==o.indexOf("c")?n.horizontalAlignment="center":-1!==o.indexOf("l")?n.horizontalAlignment="left":-1!==o.indexOf("r")?n.horizontalAlignment="right":-1!==o.indexOf("j")&&(n.horizontalAlignment="justify");else if(!o.startsWith("pi")&&!o.startsWith("pxt")&&!o.startsWith("pt")){let e=this.getTextLineNum(o);a.push({font:r.f,colorIndex:r.C,text:o,lineNum:i}),i+=e}}else if(Array.isArray(o)){let e=this.mtextContentAndFormattingToTextAndStyle(o,t);e.text.forEach((e=>{a.push(e)})),i=e.lineLength}else if("object"==typeof o)if(o.S&&3===o.S.length){let e=o.S[0]+"/"+o.S[2],t=this.getTextLineNum(e);a.push({text:o.S[0]+"/"+o.S[2],lineNum:i}),i+=t}else void 0!==o.C?r.C=o.C:void 0!==o.W?r.W=o.W:void 0!==o.H?r.H=o.H:void 0!==o.f&&(r.f=o.f)}return{text:a,lineLength:i,style:n}}getTextLineNum(e){let t=e.match(new RegExp("\\n","g"));return t?t.length:0}load3DFace(e){if(!e.vertices||0===e.vertices.length)return void fe.warn("[Dxf] Entity is missing vertices:",e.handle);let t=e.vertices.map((e=>new q(e.x,e.y,e.z)));if(0===t.length)return;Bt.areVector3sEqual(t[0],t[t.length-1])||t.push(t[0]);let n=new q,r=!1;this.enableRTC&&(r=Gt.checkAndRebasePositionsOnRTC(t,n));let i=(new Nt).setFromPoints(t),a=new nn(2);return a.geometry=i,a.material=Es,r&&(this.setRTCUserData(a),a.matrix.setPosition(n.x,n.y,0)),a.layers.enableAll(),a}loadSpline(e,t){if(!e.controlPoints||!e.degreeOfSplineCurve||!e.knotValues)return;let n=1/0,r=1/0,i=-1/0,a=-1/0;for(let t of e.controlPoints)t.x<n&&(n=t.x),t.y<r&&(r=t.y),t.x>i&&(i=t.x),t.y>a&&(a=t.y);let s=1,o=t;null!=o&&o.xScale&&null!=o&&o.yScale&&(s=Math.max(Math.abs(o.xScale),Math.abs(o.yScale)));let l=Math.max(i-n,a-r),h=this.getBSplineInterpolationsPerSplineSegment(e.controlPoints.length,l*s),u=Vde(e.controlPoints,e.degreeOfSplineCurve,e.knotValues,h),c=new q,d=!1;this.enableRTC&&(d=Gt.checkAndRebasePositionsOnRTC(u,c));let p=Gt.getAdjacentNonRepeatPoints(u);if(p.length<2)return void fe.warn("[Dxf] Spline entity (handle '%s') contains less than 2 points, ignored!",e.handle);let f=(new Nt).setFromPoints(p),m=new nn(2);return m.geometry=f,m.material=Es,d&&(this.setRTCUserData(m),m.matrix.setPosition(c.x,c.y,0)),m.layers.enableAll(),m}loadXLine(e){if(!e.vertices||0===e.vertices.length)return void fe.warn("[Dxf] Entity is missing vertices:",e.handle);let t=Ct.arrayOrObjectToVector3(e.directionVector),n=new q(e.vertices[0].x,e.vertices[0].y,0),r=[];if(r.push(t.clone().multiplyScalar(-1e6).add(n)),r.push(t.clone().multiplyScalar(1e6).add(n)),0===r.length)return;let i=new q,a=!1;this.enableRTC&&(a=Gt.checkAndRebasePositionsOnRTC(r,i));let s=(new Nt).setFromPoints(r),o=new nn(2);return o.geometry=s,o.material=Es,a&&(this.setRTCUserData(o),o.matrix.setPosition(i.x,i.y,0)),o.layers.enableAll(),o}loadRay(e){if(!e.vertices||0===e.vertices.length)return void fe.warn("[Dxf] Entity is missing vertices:",e.handle);let t=Ct.arrayOrObjectToVector3(e.directionVector),n=e.vertices.map((e=>new q(e.x,e.y,0)));if(n.push(t.multiplyScalar(1e6).add(n[0])),0===n.length)return;let r=new q,i=!1;this.enableRTC&&(i=Gt.checkAndRebasePositionsOnRTC(n,r));let a=(new Nt).setFromPoints(n),s=new nn(2);return s.geometry=a,s.material=Es,i&&(this.setRTCUserData(s),s.matrix.setPosition(r.x,r.y,0)),s.layers.enableAll(),s}loadLine(e){if(!e.vertices||0===e.vertices.length)return void fe.warn("[Dxf] Entity is missing vertices:",e.handle);let t=[];if(e.isPolyfaceMesh)t=xdt(e.vertices);else{let n=ON(e.vertices,e.shape);e.shape&&n.length>0&&n.push(n[0]),n.length>0&&(t=[n])}if(0===t.length)return;let n=[];for(let e=0;e<t.length;){let[r,i]=t[e];Bt.areVector3sEqual(r,i)&&t[e].length<=2?(n.push(r),t.splice(e,1)):e++}let r,i=new q,a=!1;if(t.length>0){if(this.enableRTC){let e=0;t.forEach((t=>{t.forEach((t=>{i.add(t),e++}))})),i.divideScalar(e),a=Gt.shouldRebasePositionOnRTC(i)}let e=[],n=[],s=0,o=0,l=0,h=0;t.forEach((t=>{for(let r=0;r<t.length;r++)a?(o=t[r].x-i.x,l=t[r].y-i.y,h=t[r].z-i.z,e.push(new q(o,l,h))):e.push(t[r]),r>0&&n.push(s+r-1,s+r);s=t.length}));let u=(new Nt).setFromPoints(e);u.setIndex(n),r=new nn(3),r.geometry=u,r.material=Es}if(n.length>0){this.enableRTC&&(a=Gt.checkAndRebasePositionsOnRTC(n,i));let e=(new Nt).setFromPoints(n);r=new nn(1),r.geometry=e,r.material=yC}return r?(a&&(this.setRTCUserData(r),r.matrix.setPosition(i.x,i.y,0)),r.layers.enableAll(),r):void 0}loadLWPolyline(e,t,n){var r,i,a;if(!e.vertices||e.vertices.length<2)return void fe.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);let s=e;if(void 0!==s.extrusionDirectionX&&void 0!==s.extrusionDirectionY&&void 0!==s.extrusionDirectionZ){un.set(s.extrusionDirectionX,s.extrusionDirectionY,s.extrusionDirectionZ);let e=kn.getOcsMatrix(un).invert(),t=0;void 0!==s.elevation&&s.elevation>0&&(t=s.elevation),s.vertices.forEach((n=>{let r=un.set(n.x,n.y,t).applyMatrix4(e);n.x=r.x,n.y=r.y}))}let o=ON(e.vertices,e.shape);if(e.shape&&o.length>0&&!Bt.areVector3sEqual(o[0],o[o.length-1])&&o.push(o[0]),o.length<2)return void fe.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);let l=new nn;if(null!=(r=e.extendedData)&&r.outlines){let t=e.extendedData.outlines,n=[];t.forEach((e=>{let t=new ki;e.forEach(((e,n)=>{0===n?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])})),t.closePath(),n.push(new Mo(t))}));let r=ri(n),i=new nn(4);i.geometry=r,i.material=x0,i.layers.enableAll(),l.add(i)}let h=new q,u=!1;this.enableRTC&&(u=Gt.checkAndRebasePositionsOnRTC(o,h));let c=Gt.getAdjacentNonRepeatPoints(o);if(c.length<2)return void fe.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);if(this.enablePlineWidth&&void 0!==s.constantWidth&&s.constantWidth>0){let r=null==(a=null==(i=t.tables)?void 0:i.lineType)?void 0:a.lineTypes,o=r&&r[this.getLineType(e,t,n)];if(!o||!o.pattern||0===o.pattern.length){this.statsInfo.unsupportedPolylineCount++;let t=Gt.convertWidthLineToMeshGeometry(c,s.constantWidth);if(t){let e=new nn(4);e.geometry=t,e.material=x0,e.layers.enableAll(),e.layers.disable(11),l.add(e);let n=yr.createOutline(t,Es,e.matrix),r=new nn(3);r.geometry=n.geometry,r.material=n.material,r.matrix=n.matrix,r.layers.enableAll(),r.layers.disable(11),l.add(r)}else fe.warn("[Dxf] Failed to convert line with width to mesh geometry: %s",e.handle)}}let d=new nn(2);return d.geometry=(new Nt).setFromPoints(c),d.material=Es,d.layers.enableAll(),l.children.length>0?l.add(d):l=d,u&&(this.setRTCUserData(l),l.matrix.setPosition(h)),l}loadMLeader(e,t,n){var r,i,a,s,o,l,h;let u=t.tables.dimStyle.dimStyles[e.dimensionStyle]||this.getDefaultDimensionStyle(t),c=null==(r=e.contextData)?void 0:r.defaultTextContents;if(!c)return;let d=new nn,p=cC(c),f=this.getTextStyle(t,e),m=this.getMTextGroup(p,e,f,t,n),g=m&&m.object;if(g){g.matrix.decompose(br,Bs,Vh),null!=(i=e.contextData)&&i.textLocation&&(br.x+=e.contextData.textLocation.x,br.y+=e.contextData.textLocation.y,g.matrix.compose(br,Bs,Vh)),zh.makeEmpty();let t=nn.getBox(g,zh).getSize(un),n=t.x,r=t.y,l=0,h=0;switch(null==(a=e.contextData)?void 0:a.textAttachment){case 1:l=0,h=0;break;case 2:l-=n/2,h=0;break;case 3:l-=n,h=0;break;case 4:l=0,h+=r/2;break;case 5:l-=n/2,h+=r/2;break;case 6:l-=n,h+=r/2;break;case 7:l=0,h+=r;break;case 8:l-=n/2,h+=r;break;case 9:l-=n,h+=r;break;default:return}g.traverse((e=>{e.geometry&&e.geometry.translate(l,h,0)}));let u=0;if(null!=(s=e.contextData)&&s.textRotation&&(u=e.contextData.textRotation*Math.PI/180),null!=(o=e.contextData)&&o.textDirection){let t=e.contextData.textDirection,n=new q(t.x,t.y,t.z),r=n.clone().cross(Ml),i=Ml.angleTo(n);u+=r.z>0?-i:i}Gt.shouldRebasePositionOnRTC(br)&&this.setRTCUserData(g),g.matrix.compose(br,Bs,Vh),e.contextData.textLocation?un.set(e.contextData.textLocation.x,e.contextData.textLocation.y,0):un.set(0,0,0);let c=br.clone().sub(un);Hh.makeTranslation(-c.x,-c.y,0),us.makeRotationZ(u),g.matrix.multiply(Hh),g.matrix.multiply(us),g.matrix.multiply(Hh.invert()),g.renderOrder=5,d.add(g)}if(0===e.leaderLineType)return null==g||g.traverse((e=>{e.layers.enableAll()})),g;{let n=[],r=null==(l=e.contextData)?void 0:l.leaders[0];if(!r)return d;let i=r.lastLeaderLinePoint;if(e.enableDogLeg){let e=new q(i.x,i.y,i.z),t=r.doglegLength,a=new q(r.doglegVector.x,r.doglegVector.y,r.doglegVector.z).multiplyScalar(t),s=e.clone().add(a);n.push(s,e)}let a=(null==(h=e.contextData)?void 0:h.leaders[0].leaderLines)||[];for(let r=0;r<a.length;r++){let s=a[r].vertices[0].reverse().map((e=>new q(e.x,e.y,e.z))),o=new q(i.x,i.y,i.z);for(let e=0;e<s.length;e++)n.push(o,s[e]),o=s[e];let l=un.subVectors(n[0],n[1]).length(),h=(e.arrowHeadSize||u.DIMASZ||2.5)*(e.arrowHeadScale||u.DIMSCALE||1);e.leaderLineType;let c="";if(e.arrowHeadId?c=e.arrowHeadId:u&&u.DIMLDRBLK&&(c=u.DIMLDRBLK),c){let r=this.getBlockByHandle(t.blocks,c);if(r&&r.entities)for(let i=0;i<r.entities.length;i++){let a=this.loadEntity(r.entities[i],t,e);if(a){let e=new q(n[n.length-1].x,n[n.length-1].y,n[n.length-1].z),t=new q(n[n.length-2].x,n[n.length-2].y,n[n.length-2].z),r=Math.atan2(e.y-t.y,e.x-t.x);un.copy(e),br.setScalar(h),Bs.setFromAxisAngle(y0,r),a.matrix.compose(un,Bs,br),d.add(a)}}}else this.loadDefaultLeadArrow(n[n.length-2],n[n.length-1],l/2e3,n)}let s=new q,o=!1;this.enableRTC&&(o=Gt.checkAndRebasePositionsOnRTC(n,s));let c=(new Nt).setFromPoints(n),p=new nn(3);p.geometry=c,p.material=Es,p.renderOrder=2,o&&(this.setRTCUserData(p),p.matrix.setPosition(s.x,s.y,0)),d.add(p)}return wl.merge(d,!1),d.traverse((e=>{e.layers.enableAll()})),1===d.children.length?d.children[0]:d}loadLeader(e,t,n){let r=[];if(!e.vertices)return void fe.warn("[Dxf] Entity is missing vertices:",e.handle);if(e.vertices.length<2)return void fe.warn("leader's  vertices number must be greater than 2");let i=t.tables.dimStyle.dimStyles[e.dimensionStyle]||this.getDefaultDimensionStyle(t),a=e.vertices;if(1===e.pathType&&(a=new fd(e.vertices).getPoints(50)),e.textWidth){let t=e.textWidth,n=new q(a[a.length-1].x,a[a.length-1].y,a[a.length-1].z);if(0===e.direction){let e=new q(1,0,0).multiplyScalar(t);a.push(e.add(n))}else{let e=new q(-1,0,0).multiplyScalar(t);a.push(e.add(n))}}for(let e=0;e<a.length-1;e++){let t=a[e],n=a[e+1];r.push(t,n)}let s=un.subVectors(r[0],r[1]).setZ(0).length(),o=(e.arrowHeight||i.DIMASZ||2.5)*(e.arrowHeadScale||i.DIMSCALE||1),l=new nn;if(1===e.arrowFlag){let n="";e.arrowHeadBlockHandle?n=e.arrowHeadBlockHandle:i&&i.DIMLDRBLK&&(n=i.DIMLDRBLK);let a=this.getBlockByHandle(t.blocks,n);if(a&&a.entities){i&&(e.colorIndex=i.DIMCLRD||256,e.color=Yd(e.colorIndex));for(let n=0;n<a.entities.length;n++){let i=this.loadEntity(a.entities[n],t,e);if(i){let e=new q(r[0].x,r[0].y,r[0].z),t=new q(r[1].x,r[1].y,r[1].z),n=Math.atan2(e.y-t.y,e.x-t.x);un.copy(e),br.setScalar(o),Bs.setFromAxisAngle(y0,n),i.matrix.compose(un,Bs,br),l.add(i)}}}else this.loadDefaultLeadArrow(r[1],r[0],o/s/2,r)}if(0===r.length)return;let h=new q,u=!1;this.enableRTC&&(u=Gt.checkAndRebasePositionsOnRTC(r,h));let c=(new Nt).setFromPoints(r),d=new nn(2);return d.geometry=c,d.material=Es,d.renderOrder=2,u&&(this.setRTCUserData(d),d.matrix.setPosition(h.x,h.y,0)),l.children.length>0?(l.add(d),wl.merge(l,!1),l.traverse((e=>{e.layers.enableAll()})),1===l.children.length?l.children[0]:l):(d.layers.enableAll(),d)}getTableTextOffset(e,t,n){let r=new q;switch(e){case 1:break;case 2:r.setX(t/2);break;case 3:r.setX(t);break;case 4:r.setY(-n/2);break;case 5:r.set(t/2,-n/2,0);break;case 6:r.set(t,-n/2,0);break;case 7:r.setY(-n);break;case 8:r.set(t/2,-n,0);break;case 9:r.set(t,-n,0)}return r}loadTable(e,t,n){if(!e.startPoint)return void fe.warn("[Dxf] Entity is missing startPoint:",e.handle);if(0===e.cells.length)return void fe.warn("[Dxf] Entity is missing cells:",e.handle);if(0===e.rowHeightArr.length)return void fe.warn("[Dxf] Entity is missing rowHeightArr:",e.handle);if(0===e.columnWidthArr.length)return void fe.warn("[Dxf] Entity is missing columnWidthArr:",e.handle);let r=new nn,{cells:i,rowCount:a,columnCount:s,rowHeightArr:o,columnWidthArr:l}=e,h=[],u=0,c=0;for(let e=0;e<=a;e++){u+=e>0?o[e-1]:0,un.set(0,-u,0);let t=[un.clone()];for(let e=0;e<s;e++){br.set(l[e],0,0);let n=un.add(br);t.push(n.clone())}h.push(t)}for(let e=0;e<=s;e++){c+=e>0?l[e-1]:0,un.set(c,0,0);let t=[un.clone()];for(let e=0;e<a;e++){br.set(0,-o[e],0);let n=un.add(br);t.push(n.clone())}h.push(t)}let d=[];h.forEach((e=>{for(let t=0;t<e.length-1;t++)d.push(e[t],e[t+1])}));let p=(new Nt).setFromPoints(d),f=new nn(3);f.geometry=p,f.material=Es,f.layers.enableAll(),r.add(f),c=0;for(let h=0;h<s;h++){let d=l[h];c+=h>0?l[h-1]:0,u=0;for(let l=0;l<a;l++){let a=o[l];u+=l>0?o[l-1]:0,un.set(c,-u,0);let p=i[l*s+h];if(p){p.colorIndex=e.colorIndex,p.height=p.textHeight;let i=this.getTableTextOffset(p.attachmentPoint,d,a);p.position=un.clone().add(i);let s=this.loadMText(p,t,n);s&&r.add(s)}}}if(e.blockRecordHandle){let n=this.getBlockByHandle(t.blocks,e.blockRecordHandle);if(n&&n.entities)for(let i=0;i<n.entities.length;i++){let a=n.entities[i],s=this.loadEntity(a,t,e);s&&r.add(s)}}return r.matrix.decompose(un,Bs,Vh),un.x+=e.startPoint.x,un.y+=e.startPoint.y,r.matrix.compose(un,Bs,Vh),r}loadDefaultLeadArrow(e,t,n,r){let i=n*(e.x-t.x),a=n*(e.y-t.y),s=a,o=-i,l=new q(t.x+i+s/6,t.y+a+o/6,0),h=new q(t.x+i-s/6,t.y+a-o/6,0);r.push(t,l),r.push(t,h),r.push(l,h)}getBlockByHandle(e,t){if(!this.blocksCache){this.blocksCache={};for(let t in e){let n=e[t];this.blocksCache[n.ownerHandle]||(this.blocksCache[n.ownerHandle]=n)}}return this.blocksCache[t]}static updateMaterialUniforms(e){e instanceof fr&&(e.uniforms.u_cameraZoom&&(e.uniforms.u_cameraZoom=kn.CameraZoomUniform),e.uniforms.u_viewportScale&&(e.uniforms.u_viewportScale=kn.ViewportScaleUniform))}static transformAngleByOcsMatrix(e,t){let n=un.set(1*Math.cos(t),1*Math.sin(t),0).applyMatrix4(e);return Math.atan2(n.y,n.x)}static getArcAnglesByOcsMatrix(e,t,n){let r,i=Bt.getArcAngleSpanInRadian(t,n),a=kn.transformAngleByOcsMatrix(e,t),s=kn.transformAngleByOcsMatrix(e,n);if(Bt.areNumbersClose(i,Math.PI)){i=1;let n=kn.transformAngleByOcsMatrix(e,t+i);r=Bt.getArcAngleSpanInRadian(a,n)}else{if(Bt.areNumbersClose(i,2*Math.PI))return[a,a+2*Math.PI];r=Bt.getArcAngleSpanInRadian(a,s)}return Bt.areNumbersClose(i,r,1e-5)?[a,s]:[s,a]}loadArc(e,t,n){var r,i,a;if(!e.radius||e.radius<.001)return void fe.warn(`[Dxf] The radius of arc (handle '${e.handle}') is undefined, ignored!`);if(!e.radius||e.radius<.001)return void fe.warn(`[Dxf] The radius of arc (handle '${e.handle}') is too small, ignored!`);let s=new q(0,0,1);void 0!==e.extrusionDirectionX&&void 0!==e.extrusionDirectionY&&void 0!==e.extrusionDirectionZ&&s.set(e.extrusionDirectionX,e.extrusionDirectionY,e.extrusionDirectionZ);let o,l,h=kn.getOcsMatrix(s);if("CIRCLE"===e.type)o=e.startAngle||0,l=o+2*Math.PI;else{if(null==e.startAngle||null==e.endAngle||(o=e.startAngle,l=e.endAngle,Bt.areNumbersEqual(o,l,1e-6)))return;if(!Bt.areNumbersClose(Bt.getArcAngleSpanInRadian(o,l),2*Math.PI)){let e=kn.getArcAnglesByOcsMatrix(h,o,l);o=e[0],l=e[1]}}let u=new hd(0,0,e.radius,o,l,0!==this.angBase),c=1,d=n;null!=d&&d.xScale&&null!=d&&d.yScale&&(c=Math.max(Math.abs(d.xScale),Math.abs(d.yScale)));let p=this.getDivision(o,l,e.radius*c),f=u.getPoints(p),m=new q,g=!1;this.enableRTC&&(g=Gt.checkAndRebasePositionsOnRTC(f,m));let v=(new Nt).setFromPoints(f),y=new nn(2);y.geometry=v,y.material=Es;let x=new q;e.center&&(x.x=e.center.x,x.y=e.center.y);let b=new q(null==(r=e.center)?void 0:r.x,null==(i=e.center)?void 0:i.y,null==(a=e.center)?void 0:a.z).applyMatrix4(h.invert());x.x=b.x,x.y=b.y;let _=x,w=new nn(1);return w.geometry=Lde,w.material=yC,w.userData.handle=e.handle,w.userData.isSnapObject=!0,w.userData.type="CircleCenter",w.layers.set(11),y.add(w),g?(this.setRTCUserData(y),_.x+=m.x,_.y+=m.y):Gt.shouldRebasePositionOnRTC(_)&&this.setRTCUserData(y),y.matrix.setPosition(_),y.layers.enableAll(),y}addTriangleFacingCamera(e,t,n,r){let i=new q,a=new q;i.subVectors(n,t),a.subVectors(r,t),i.cross(a);let s=new q(t.x,t.y,t.z),o=new q(n.x,n.y,n.z),l=new q(r.x,r.y,r.z);i.z<0?e.push(l,o,s):e.push(s,o,l)}loadSolid(e,t,n){let r=e.points;if(!r||r.length<4)return;if(e.extrusionDirection&&e.extrusionDirection.z){un.set(0,0,e.extrusionDirection.z);let t=kn.getOcsMatrix(un).invert();r.forEach((e=>{let n=un.set(e.x,e.y,0).applyMatrix4(t);e.x=n.x,e.y=n.y}))}let i=[],a=[];this.addTriangleFacingCamera(i,r[0],r[1],r[2]),a.push(0,1,2),this.addTriangleFacingCamera(i,r[1],r[2],r[3]),a.push(3,4,5);let s=new q,o=!1;this.enableRTC&&(o=Gt.checkAndRebasePositionsOnRTC(i,s));let l=(new Nt).setFromPoints(i);l.setIndex(a);let h=new nn(4);return h.geometry=l,h.material=x0,o&&(this.setRTCUserData(h),h.matrix.setPosition(s.x,s.y,0)),h.layers.enableAll(),h}getTextStyle(e,t){var n,r;let i=null==(r=null==(n=e.tables)?void 0:n.style)?void 0:r.styles;return i&&(i[t.textStyle]||i.STANDARD||i.Standard)||{}}getDefaultDimensionStyle(e){return e.tables.dimStyle.dimStyles.STANDARD||e.tables.dimStyle.dimStyles.Standard||{}}getTextEncoding(e){return(null==e?void 0:e.bigFontFile)&&e.bigFontFile.toUpperCase().startsWith("GB")?"gbk":"utf8"}getTextMesh(e,t,n,r){if(!e)return;let i=(null==n?void 0:n.styleName)||"";if(n&&n.fontFile&&n.fontFile.endsWith(".shx")){let e=`${n.fontFile}_${n.styleName}`;this.statsInfo.unsupportedTextStyles[e]||(this.statsInfo.unsupportedTextStyles[e]=0),this.statsInfo.unsupportedTextStyles[e]++}let a=.67,s={_TCH_DIM:1.45,ROMANS:1};i&&s[i]&&(a=s[i]),r.xScale&&(a*=r.xScale),i&&(a*=(null==n?void 0:n.xScale)||1,t=t||(null==n?void 0:n.textHeight)||0),0===t&&(t=i?1:.2);let o=this.createTextMeshByText(e,n,t,0,t/8);return o.traverse((e=>{e.geometry&&e.geometry.scale(a,1,1)})),o}createTextMeshByText(e,t,n=12,r=0,i=0,a=1,s=1/0){var o,l,h;let u=new nn,c=[],d=0,p=0,f=r+n;for(let r=0;r<e.length;r++){let u=e[r];if(" "===u){d+=n;continue}if("\n"===u){d=0,p-=f;continue}let m=null==(o=this.font)?void 0:o.getCharShape(u,t.fontFile,n);if(t.bigFontFile&&!m&&(m=null==(l=this.font)?void 0:l.getCharShape(u,t.bigFontFile,n)),m||(m=null==(h=this.font)?void 0:h.getNotFoundTextShape(n)),m){if(m.translate(d,p,0),m.scale(a,1,1),d>s)d=0,p-=f;else{m.boundingBox||m.computeBoundingBox(),d+=m.boundingBox.getSize(un).x+i}c.push(m)}}if(c.length>0){let e=c.filter((e=>e instanceof rs)),t=c.filter((e=>!(e instanceof rs)));if(e.length>0){let t=new nn(4);t.geometry=ri(e),t.material=x0,u.add(t)}if(t.length>0){let e=new nn(3);e.geometry=ri(t),e.material=Es,u.add(e)}}return u}transformTextMesh(e,t){zh.makeEmpty();let n=nn.getBox(t,zh).getSize(un),{halign:r,valign:i}=e;t.matrix.decompose(xC.position,xC.quaternion,xC.scale);let a=xC,s=e.width||e.textWidth||n.x,o=e.height||e.textHeight||n.y;if(void 0===r&&void 0===i&&e.startPoint||[3,5].includes(r)&&e.startPoint?(a.position.x+=e.startPoint.x,a.position.y+=e.startPoint.y,a.position.z+=e.startPoint.z):e.endPoint&&(a.position.x+=e.endPoint.x,a.position.y+=e.endPoint.y,a.position.z+=e.endPoint.z),3!==r&&5!==r){if(e.rotation){let t=e.rotation*Math.PI/180;a.rotateZ(t)}2===e.mirrored?a.rotateY(Math.PI):4===e.mirrored&&a.rotateX(Math.PI)}switch(r){case 0:default:break;case 1:a.translateX(-s/2);break;case 2:a.translateX(-s);break;case 3:if(e.startPoint&&e.endPoint){let t=new q(e.startPoint.x,e.startPoint.y,e.startPoint.z),n=new q(e.endPoint.x,e.endPoint.y,e.endPoint.z),r=(new q).subVectors(t,n),i=r.length()/s;a.scale.multiplyScalar(i);let o=r.clone().cross(Ml),l=r.angleTo(Ml);a.rotateZ(o.z>0?Math.PI-l:l-Math.PI),(2===e.mirrored||4===e.mirrored)&&a.rotateX(Math.PI)}break;case 4:a.translateX(-s/2),a.translateY(-o/2);break;case 5:if(e.startPoint&&e.endPoint){let t=new q(e.startPoint.x,e.startPoint.y,e.startPoint.z),n=new q(e.endPoint.x,e.endPoint.y,e.endPoint.z),r=(new q).subVectors(t,n),i=r.length()/s;a.scale.setX(i);let o=r.clone().cross(Ml),l=r.angleTo(Ml);a.rotateZ(o.z>0?Math.PI-l:l-Math.PI),(2===e.mirrored||4===e.mirrored)&&a.rotateX(Math.PI)}}switch(i){case 0:case 1:default:break;case 2:a.translateY(-o/2);break;case 3:a.translateY(-o)}return a.position.z=0,a.updateMatrix(),t.matrix.copy(a.matrix),t}loadText(e,t,n){let r=e.text;if(!r)return;if(!this.font)return void fe.info("[Dxf] Font file not set, ignoring text entity.");let i=this.getTextStyle(t,e);r=uC(r,{encoding:this.getTextEncoding(i)}).map((e=>e.text)).join("");let a=this.getTextMesh(r,e.textHeight,i,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),un.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=Gt.shouldRebasePositionOnRTC(un);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Jt&&!t.getIndex()){let e=t.getAttribute("position"),n=[];for(let t=0;t<e.count;t+=3)n.push(t,t+1,t+2);t.setIndex(n)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let n=Gt.caculateGeometryCenter(t);n&&Gt.shouldRebasePositionOnRTC(n)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadAttDef(e,t,n){let r=e.tag||e.text||e.prompt;if(!r||!this.font)return;let i=this.getTextStyle(t,e);r=uC(r).map((e=>e.text)).join();let a=this.getTextMesh(r,e.textHeight,i,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),un.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=Gt.shouldRebasePositionOnRTC(un);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Jt&&!t.getIndex()){let e=t.getAttribute("position"),n=[];for(let t=0;t<e.count;t+=3)n.push(t,t+1,t+2);t.setIndex(n)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let n=Gt.caculateGeometryCenter(t);n&&Gt.shouldRebasePositionOnRTC(n)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadAttrib(e,t,n){let r=e.text;if(!r||!this.font)return;let i=this.getTextStyle(t,e);r=uC(r).map((e=>e.text)).join();let a=this.getTextMesh(r,e.textHeight,i,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),un.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=Gt.shouldRebasePositionOnRTC(un);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Jt&&!t.getIndex()){let e=t.getAttribute("position"),n=[];for(let t=0;t<e.count;t+=3)n.push(t,t+1,t+2);t.setIndex(n)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let n=Gt.caculateGeometryCenter(t);n&&Gt.shouldRebasePositionOnRTC(n)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadPoint(e,t,n){if(!e.position)return;let r=new Nt,i=[new q(e.position.x,e.position.y,e.position.z)];un.set(0,0,0);let a=un,s=!1;this.enableRTC&&(s=Gt.checkAndRebasePositionsOnRTC(i,a)),r.setFromPoints(i);let o=new nn(1);return o.geometry=r,o.material=Es,s&&(this.setRTCUserData(o),o.matrix.setPosition(a.x,a.y,0)),o.layers.enableAll(),o}loadDimension(e,t){if(!e.block)return;let n=t.blocks[e.block];if(!n||!n.entities)return;let r=t.tables.dimStyle.dimStyles[e.dimStyleName]||this.getDefaultDimensionStyle(t);r&&r.DIMCLRD>0&&(e.colorIndex=r.DIMCLRD,e.color=Yd(e.colorIndex));let i=new nn;for(let r=0;r<n.entities.length;r++){let a=this.loadEntity(n.entities[r],t,e);a&&i.add(a)}if(0===i.children.length){let t=e.name||e.block;return this.statsInfo.ignoredInserts[t]||(this.statsInfo.ignoredInserts[t]=0),void this.statsInfo.ignoredInserts[t]++}this.blockReferencesCache[e.block]||(this.blockReferencesCache[e.block]={referenceCount:0}),this.blockReferencesCache[e.block].referenceCount++;i.name=`${e.type}<${n.name}>`,i.userData.entityType=e.type;let a=null==e?void 0:e.insertionPoint;return un.set(0,0,0),a&&un.set(a.x,a.y,0),Gt.shouldRebasePositionOnRTC(un)&&this.setRTCUserData(i),i.matrix.setPosition(un),i}loadImage(e,t,n){var r;if(!e.imageSize||null==(r=t.objects.IMAGEDEF)||!r.length)return;let i=t.objects.IMAGEDEF.filter((t=>t.handle===e.imageDefHandle))[0];if(!i)return;console.log(e,i);let a=e.imageSize.x,s=e.imageSize.y,o=new nn,l=!1;2===e.flags||4===e.flags||8===e.flags||(l=!0);let h=new ys(a,s);if(l){let e=new dh(this.manager).load(i.filename,void 0,void 0,(()=>{console.warn("Please upload the pictures in the same folder, or use url link in the dxf file.")}));e.colorSpace=yi;let t=new mr({transparent:!0,side:Os,map:e}),n=new nn(4);n.geometry=h,n.material=t,o.add(n)}let u=new fh(h),c=this.getColor(e,t,n),d=new nn(2);d.geometry=u,d.material=this.getLineBasicMaterial(c);let p=e.uPixel?new q(e.uPixel.x,e.uPixel.y,e.uPixel.z):new q(i.pixelSize.x,0,0),f=e.vPixel?new q(e.vPixel.x,e.vPixel.y,e.vPixel.z):new q(i.pixelSize.y,0,0);if(o.add(d),br.set(p.x,f.y,1),un.set(0,0,0),e.position){let t=new q(e.position.x,e.position.y,e.position.z);t.add(p.multiplyScalar(a/2)).add(f.multiplyScalar(s/2)),un.copy(t)}return Gt.shouldRebasePositionOnRTC(un)&&this.setRTCUserData(o),Bs.identity(),o.matrix.compose(un,Bs,br),o}loadInsert(e,t,n,r=!1){var i,a;if(!e.block)return;let s=t.blocks[e.block];if(!s.entities)return;n&&"0"===e.layer&&(e.layer=n.layer),e.blockPosition=s.position;let o=new nn;for(let n=0;n<s.entities.length;n++){if("ATTDEF"===s.entities[n].type)continue;let i=this.loadEntity(s.entities[n],t,e,r);i&&o.add(i)}if(0===o.children.length){let t=e.name||e.block;return this.statsInfo.ignoredInserts[t]||(this.statsInfo.ignoredInserts[t]=0),void this.statsInfo.ignoredInserts[t]++}this.blockReferencesCache[e.block]||(this.blockReferencesCache[e.block]={referenceCount:0}),this.blockReferencesCache[e.block].referenceCount++;o.name=`${e.type}<${s.name}>`,o.userData.entityType=e.type,null!=(i=e.extendedData)&&i.originalType&&(o.userData.originalType=null==(a=e.extendedData)?void 0:a.originalType),null!=e&&e.blockPosition&&o.matrix.setPosition(-e.blockPosition.x,-e.blockPosition.y,0);let l=un.set(1,1,1);e.xScale&&(l.x=e.xScale),e.yScale&&(l.y=e.yScale);let h=new Fi;e.rotation&&(h.z=e.rotation*Math.PI/180),Bs.setFromEuler(h,!1);let u=br.set(0,0,0);e.position&&(u.x=e.position.x,u.y=e.position.y),us.compose(u,Bs,l),e.extrusionDirection&&e.extrusionDirection.z<0&&us.premultiply(kde.identity().makeScale(-1,1,1)),Hh.copy(o.matrix),o.matrix.premultiply(us),br.set(o.matrix.elements[12],o.matrix.elements[13],o.matrix.elements[14]),Gt.shouldRebasePositionOnRTC(br)&&this.setRTCUserData(o);let c=this.findSpatialFilterByHandle(e.handle,t);if(c){this.loadSpatialFilter(c);let t=c;t&&t.clipPolylines&&t.clipPolylines.length>0&&(o.userData.spatialFilterHandle=c.handle,this.cloneMaterialsForSpatialFilter(o),fe.debug("[Dxf] Spatial filter:",e.associatedSpatialFilter))}return o}loadSpatialFilter(e){let t=e;if(t.threejsObject)return t.threejsObject.clone();let n=e.invertBlockMatrix;us.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],0,0,0,1);let r=[];e.vertices.forEach((e=>{r.push(new q(e.x,e.y,0))}));let i={polyline:[],bConcave:!1,bReversed:!1};if(2===e.numberOfPointsOnClipBoundary)i.polyline=r;else{let t=e.numberOfPointsOnClipBoundary,n=3;if(t<n)return void fe.warn(`[Dxf] Invalid clipBoundary: ${e.handle} !`);let a=[],s=-1;for(let e=0;e<t;e++){let n=r[e];for(let i=t-1;i>e;i--){let o=r[i];if(Bt.areVector3sEqual(n,o)&&e+1<i-1&&e+1<t-1&&Bt.areVector3sEqual(r[e+1],r[i-1])){a.push(n),s=i;break}}if(s>0)break;a.push(n)}if(s>0)for(let e=s+1;e<t;e++)a.push(r[e]);if(a.length<n)return void fe.warn(`[Dxf] Invalid clipBoundary: ${e.handle}!`);let o=[],l=[];if(a.forEach((e=>{o.push(new Te(e.x,e.y)),l.push([e.x,e.y])})),!Gt.isConvex(o)){fe.warn(`[Dxf] Concave polygon is not supported for spatial filter (handle '${e.handle}'), converting to convex polygon!`);let t=(0,zde.default)(l,1/0);a=[],t.forEach((e=>{a.push(new q(e[0],e[1],0))}))}Bt.areVector3sEqual(a[0],a[a.length-1])||a.push(a[0]),i.polyline=a,i.bReversed=s>0}return this.enableReleaseData&&(e.vertices=[],e.matrix=[],e.invertBlockMatrix=[]),t.localMatrix=us.clone(),t.clipPolylines=[],void t.clipPolylines.push(i)}loadLayout(e,t,n,r,i,a){if(!e.entities)return;let s=new nn;for(let r=0;r<e.entities.length;r++){let o=e.entities[r];this.addViewport(o,a);let l=this.loadEntity(o,t);l&&(this.enableMerge&&wl.merge(l,!1),s.add(l),l.traverse((e=>{if(e.geometry){let t=e.userData.layerName,r=i[t];r||(r=[],i[t]=r),r.push(e),e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[n.layoutName]||(this.layoutsSnapObjectsMap[n.layoutName]=[]),this.layoutsSnapObjectsMap[n.layoutName].push(e))}})))}if(0===s.children.length)return;s.userData.layerName=e.layer;let o=n.layoutName,l=r.children.find((e=>e.name===o));l||(l=new nn,l.name=o,l.userData.isLayoutLevelObject=!0,r.add(l)),l.add(s),e.position&&s.matrix.setPosition(e.position.x,e.position.y,e.position.z||0)}convertEdgeToPoints(e){let t=[];switch(e.type){case 1:{let n=e;t.push(new Te(n.startPoint.x,n.startPoint.y)),t.push(new Te(n.endPoint.x,n.endPoint.y));break}case 2:{let n=e,r=n.startAngle*zr.DEG2RAD,i=n.endAngle*zr.DEG2RAD;n.bCounterclockwise||(r=2*Math.PI-r,i=2*Math.PI-i);let a=new hd(n.center.x,n.center.y,n.radius,r,i,!n.bCounterclockwise),s=this.getDivision(r,i,n.radius),o=a.getPoints(s);e.startPoint=o[0],e.endPoint=o[o.length-1],t.push(...o);break}case 3:{let n=e,r=Math.sqrt(Math.pow(n.majorAxisEndPoint.x,2)+Math.pow(n.majorAxisEndPoint.y,2)),i=r*n.minorRatio,a=Math.atan2(n.majorAxisEndPoint.y,n.majorAxisEndPoint.x),s=n.startAngle*zr.DEG2RAD,o=n.endAngle*zr.DEG2RAD;n.bCounterclockwise||(s=2*Math.PI-s,o=2*Math.PI-o);let l=new su(n.center.x,n.center.y,r,i,s,o,!n.bCounterclockwise,a),h=this.getDivision(s,o,Math.max(r,i)),u=l.getPoints(h);e.startPoint=u[0],e.endPoint=u[u.length-1],t.push(...u);break}case 4:{let n=e,r=Vde(n.controlPoints,n.degreeOfSplineCurve,n.knotValues);e.startPoint=r[0],e.endPoint=r[r.length-1],t.push(...r);break}case 0:{let n=e,r=ON(n.points,n.isClosed);e.startPoint=r[0],e.endPoint=r[r.length-1],t.push(...r);break}}return t}loadHatch(e,t,n){var r,i;let a=e;if(0==a.boundaryPaths.length)return;if(!(a.solidFill||null!=(r=a.patternLines)&&r.length))return void fe.warn(`[Dxf] Hatch entity(handle: '${a.handle}') doesn't have solid fill, nor patternLines, ignored!`);let s=[],o=[],l=[],h=e=>{let t=[],n=[];n.push(...this.convertEdgeToPoints(e[0]));for(let r=1;r<e.length;r++){let i=this.convertEdgeToPoints(e[r]);if(n.push(...i),n.length>2){let a=this.convertEdgeToPoints(e[r-1]);Bt.areVector2sEqual(a[a.length-1],i[0])?Bt.areVector2sEqual(n[0],i[i.length-1],1e-5)&&(t.push(n),n=[]):Bt.areVector2sEqual(a[0],i[i.length-1])?Bt.areVector2sEqual(n[1],i[0],1e-5)&&(t.push(n),n=[]):n=[]}}return t};if(a.boundaryPaths.forEach(((e,t)=>{let n=[];if(this.IsfilteredByPathTypeFlag(e.pathTypeFlag)){let n="[Dxf] The %d path type flag is filtered at the %dth boundrayPath (hatch handle '%s')";return void fe.info(n,e.pathTypeFlag,t,a.handle)}let r=e.edges;if(0===r.length)return;let i=[];for(let e=0;e<r.length;e++){let n=this.convertEdgeToPoints(r[e]);if(n.length<2){let n="[Dxf] The %dth edge of the %dth boundaryPath (hatch handle '%s') has less than 2 points, ignored!";fe.warn(n,e,t,a.handle)}else i.push(...n)}if(i.length<3){let e="[Dxf] The %dth boundaryPath (hatch handle '%s') has less than 3 points, ignored!";fe.warn(e,t,a.handle)}else if(n.push(i),e.pathTypeFlag>31&&(!(e=>{for(let t=1;t<e.length;++t){let n=e[t-1].endPoint,r=e[t].startPoint;if(!n||!r||!Bt.areVector2sEqual(n,r))return!1}return!0})(e.edges)||!a.associativity)&&(n=h(r),n.length<2)){let e="[Dxf] The %dth boundaryPath (hatch handle '%s') has unknown path, ignored!";fe.warn(e,t,a.handle)}else n.forEach((e=>{Bt.areVector2sEqual(e[0],e[e.length-1])||e.push(e[0]);let t=e.map((e=>new Te(Ct.roundNumber(e.x,7),Ct.roundNumber(e.y,7))));if((null==t?void 0:t.length)>0){s.push(t);let e=(new Vr).setFromPoints(t);o.push(e);let n=e.getSize(sb),r=n.x*n.y;l.push({area:r,index:s.length-1})}}))})),0===s.length)return;let u=new Te,c=this.checkAndRebasePolygonsOnRTC(s,u);l.sort(((e,t)=>e.area-t.area));let d=[];l.forEach((e=>{d.push(e.index)}));let p,f=this.buildContainHierarchyTree(s,o,d),m=[];if(this.buildHatchGeometry(s,f,m),m.length>0&&(p=ri(m)),!p||!p.getIndex()||0===(null==(i=p.getIndex())?void 0:i.count))return void fe.warn("[Dxf] Failed to convert hatch boundaries!");let g=new nn(4);g.geometry=p,g.material=x0,this.setHatchMaterial(g,a,t,u,n);let v=g;return c&&(this.setRTCUserData(v),v.matrix.setPosition(u.x,u.y,0)),v.traverse((e=>{e.layers.enableAll(),e.layers.disable(11)})),v}loadOle2frame(e,t){let{leftUpX:n,leftUpY:r,rightDownX:i,rightDownY:a}=e;if(!(n&&r&&i&&a))return;let s=[new Te(n,r),new Te(n,a),new Te(i,a),new Te(i,r),new Te(n,r)],o=new q,l=!1;this.enableRTC&&(l=Gt.checkAndRebasePositionsOnRTC(s,o));let h=(new Nt).setFromPoints(s),u=this.getLineBasicMaterial(16777215),c=new nn(2);c.geometry=h,c.material=u,c.layers.enableAll(),l&&(this.setRTCUserData(c),c.matrix.setPosition(o.x,o.y,0));let d=new nn;d.add(c);let p,f,m=t.objects.DICTIONARY;for(let t of m){let n=t;for(let t in n.entries)if(n.entries[t]===e.handle){p=t;break}}if(p)if(this.meshTextureMaterials[p])f=this.meshTextureMaterials[p];else for(let e=0;e<t.objects.XRECORD.length;e++){let n=t.objects.XRECORD[e];if(n.handle===p){let e=n.binaryData,t="data:image/jpg;base64,"+Ct.hexToBase64(e),r=new dh(this.manager).load(t);r.colorSpace=yi;let i=new mr({transparent:!0,map:r});this.meshTextureMaterials[p]=i,f=i;break}}if(f){let e=(new Vr).setFromPoints(s),t=e.getSize(sb),n=new ys(t.x,t.y),r=new nn(4);r.geometry=n,r.material=f;let i=e.getCenter(sb);un.set(i.x,i.y,0),l&&(this.setRTCUserData(r),un.x+=o.x,un.y+=o.y),r.matrix.setPosition(un),r.layers.enableAll(),d.add(r)}return d.children.length>1?d:c}static getOcsMatrix(e){let t=Ml,n=DN,r=y0,i=new q(0,1,0),a=new q(0,0,1);return Bt.areVectorsClose(e,a)?us.identity():(r=e.clone().normalize(),Bt.areVectorsClose(r,a)||(t=Math.abs(r.x)<1/64&&Math.abs(r.y)<1/64?i.cross(r).normalize():a.cross(r).normalize(),n=r.clone().cross(t).normalize()),us.set(t.x,t.y,t.z,0,n.x,n.y,n.z,0,r.x,r.y,r.z,0,0,0,0,1))}static getDcs2WcsMatrix(e,t){let n;n=mdt(e)?e.viewDirectionFromTarget:e.viewDirection;let r,i,a,s=new q(Bt.roundNumber(n.x,7),Bt.roundNumber(n.y,7),n.z),o=new q(e.viewTarget.x,e.viewTarget.y,e.viewTarget.z),l=e.viewTwistAngle||0;a=s.clone().normalize(),r=y0.clone().cross(s),r.length()>0?(r.normalize(),i=a.clone().cross(r)):a.z<0?(r=Ml.clone().negate(),i=DN,a=y0.clone().negate()):(r=Ml,i=DN,a=y0);let h=new At,u=us.identity();return u.makeBasis(r,i,a),h.premultiply(u),h.premultiply(us.identity().compose(o.clone(),(new Ci).setFromAxisAngle(new q(0,0,1),zr.degToRad(t?l:-l)),new q(1,1,1))),h}getViewportMsToPsMatrix(e){let t=new q(e.centerPoint_dcs.x,e.centerPoint_dcs.y,0),n=new q(e.centerPoint.x,e.centerPoint.y,e.centerPoint.z),r=e.viewHeight/e.height_paperSpace,i=kn.getDcs2WcsMatrix(e,this.angDir),a=new At;a.setPosition(Ode.clone().sub(n));let s=kde.identity();s.scale(un.set(r,r,r));let o=Hh.identity().setPosition(Ode.clone().sub(n));s.premultiply(o.clone().invert()).multiply(o),a.multiply(s);let l=us.identity();l.setPosition(t),i.multiply(l);let h=us.identity();return a.invert().multiply(h).multiply(i.invert())}loadViewport(e,t,n){let r=e;if("1"==r.viewportId)return e.psBBox=new Ft,void(e.msToPsMatrix=new At);let i=[],a=r.centerPoint,s=r.width_paperSpace/2,o=r.height_paperSpace/2;i.push(new q(a.x-s,a.y-o,0)),i.push(new q(a.x-s,a.y+o,0)),i.push(new q(a.x+s,a.y+o,0)),i.push(new q(a.x+s,a.y-o,0)),i.push(i[0]),e.psBBox=new Ft(i[0],i[2]),e.msToPsMatrix=this.getViewportMsToPsMatrix(r);let l=new q,h=!1;this.enableRTC&&(h=Gt.checkAndRebasePositionsOnRTC(i,l));let u=(new Nt).setFromPoints(i),c=new nn(2);c.geometry=u,c.material=Es,h&&(this.setRTCUserData(c),c.matrix.setPosition(l.x,l.y,0)),c.userData.entityType=e.type,c.layers.enableAll();let d=new nn;d.add(c);let p=e.psBBox.clone();p.applyMatrix4(e.msToPsMatrix.clone().invert()),p.min.z=0,p.max.z=0;let f=[];f.push(p.min),f.push(new q(p.min.x,p.max.y,0)),f.push(p.max),f.push(new q(p.max.x,p.min.y,0)),f.push(f[0]);let m=new q,g=!1;this.enableRTC&&(g=Gt.checkAndRebasePositionsOnRTC(f,m));let v=(new Nt).setFromPoints(f),y=new nn(2);return y.geometry=v,y.material=Es,g&&(this.setRTCUserData(y),y.matrix.setPosition(m.x,m.y,0)),y.userData.entityType=e.type,y.userData.inPaperSpace=!0,y.layers.enableAll(),d.add(y),c}getColor(e,t,n){var r,i,a,s;if(this.compareContext)return cs.ENTITY_COLOR_NO_CHANGE;if(null!=this.overrideColor)return this.overrideColor;let o=e;if(o&&o.isGradientColor){let t=o.gradientColors;if(t&&t.length>=2){if(t[0]!==t[1]){let t=`[Dxf] Gradient colors are not supported for hatch '${e.handle}', will use the first color!`;fe.warn(t)}return t[0]}}if(e.isTrueColor||e.colorIndex>0&&e.colorIndex<256)return e.color;if(0===e.colorIndex)return n?this.getColor(n,t):null==(i=null==(r=t.tables)?void 0:r.layer)?void 0:i.layers[0].color;if(256===e.colorIndex){let r=null==(s=null==(a=t.tables)?void 0:a.layer)?void 0:s.layers,i=r&&r[e.layer],o=r&&n&&r[n.layer],l=qh;return i&&"0"!==i.name?l=i.color:o?l=o.color:i?l=i.color:r&&r[0].color&&(l=r[0].color),l}return fe.warn("[Dxf] Unknown colorIndex"),qh}getLineType(e,t,n){var r,i;if(n&&"DIMENSION"===n.type)return this.getLineType(n,t);if(e.lineType!==p0&&e.lineType!==m0)return e.lineType;if(e.lineType===m0)return n?this.getLineType(n,t):e.lineType;let a=null==(i=null==(r=t.tables)?void 0:r.layer)?void 0:i.layers,s=pdt;if("0"!==e.layer){let t=a&&a[e.layer];if(t)return t.lineType}else if(n){let e=a&&a[n.layer];if(e)return e.lineType}return s}getLayerName(e,t,n){var r,i;let a=t=>{s&&t&&!s[e.layer]&&(console.warn(`[Dxf] Failed to find layer object for '${t}', adding a default one.`),s[t]={name:t,handle:"",colorIndex:256,lineType:"",visible:!0})},s=null==(i=null==(r=t.tables)?void 0:r.layer)?void 0:i.layers;a(e.layer);let o=s&&s[e.layer];a(null==n?void 0:n.layer);let l=s&&n&&s[n.layer],h=(null==o?void 0:o.name)||"";return o&&"0"===o.name&&l&&(h=l.name),h}setMaterial(e,t,n,r){var i,a;let s=e;if(!s.geometry||(this.setRenderOrderByObjectType(e),"OLE2FRAME"===t.type))return;if("MTEXT"===t.type)return void(e.renderOrder=5);if("HATCH"===t.type)return sb.set(0,0),void this.setHatchMaterial(e,t,n,sb,r);if("IMAGE"===t.type)return;let o,l=this.getColor(t,n,r);if("LWPOLYLINE"===t.type&&(s.isMesh?(o=this.getMeshBasicMaterial(l),e.renderOrder=1):e.userData.isOutline&&(o=this.getLineBasicMaterial(l),e.renderOrder=3),o))s.material=o;else{if("SOLID"===t.type)o=this.getMeshBasicMaterial(l);else if("TEXT"===t.type||"ATTDEF"===t.type||"ATTRIB"===t.type)o=this.getLineBasicMaterial(l),e.renderOrder=5;else if("LEADER"===t.type||"MULTILEADER"===t.type||"VIEWPORT"===t.type)o=this.getLineBasicMaterial(l);else if("POINT"===t.type)o=this.getPointsMaterial(l);else{if(e.material instanceof Wi)return o=this.getPointsMaterial(l),void(s.material=o);let h=null==(a=null==(i=n.tables)?void 0:i.lineType)?void 0:a.lineTypes,u=h&&h[this.getLineType(t,n,r)];if(u&&u.pattern&&0!==u.pattern.length){let n=t.lineTypeScale||1;o=this.getLineShaderMaterial(u,l,n),e.renderOrder=3}else o=this.getLineBasicMaterial(l)}s.material=o}}setHatchMaterial(e,t,n,r,i){let a=e;if(!a.geometry)return;let s=this.getColor(t,n,i);if(2===a.type||3===a.type)return void(a.material=this.getLineBasicMaterial(s));let o,l=-1;if(t.solidFill)o=this.getMeshBasicMaterial(s);else{if(a.material instanceof fr){o=a.material;let e=new Ot(s);a.material.uniforms.u_color.value.equals(e)||(o=a.material.clone(),kn.updateMaterialUniforms(o),o.uniforms.u_color.value.set(s))}else o=this.getHatchShaderMaterial(t,s,r);l=0}o||(o=this.getMeshBasicMaterial(s),l=-1),a.material=o,a.renderOrder=l}setRenderOrderByObjectType(e){let t=e,n=0;t.isMesh?n=-1:t.isLine?n=2:t.isPoints&&(n=4),e.renderOrder=n}getPointsMaterial(e){return this.pointsMaterials[e]||(this.pointsMaterials[e]=new Wi({size:.2,color:e})),this.pointsMaterials[e]}getLineBasicMaterial(e){return this.lineBasicMaterials[e]||(this.lineBasicMaterials[e]=new gr({color:e})),this.lineBasicMaterials[e]}getLineShaderMaterial(e,t,n){let r=`${e.name}_${t}_${n}`;if(!this.lineShaderMaterials[r]){let i=this.getLineTypeScales(),a=i.ltScale*i.celtScale*n;this.lineShaderMaterials[r]=lC.createLineShaderMaterial(e.pattern,t,a,kn.ViewportScaleUniform,kn.CameraZoomUniform)}return this.lineShaderMaterials[r]}getMeshBasicMaterial(e){return this.meshBasicMaterials[e]||(this.meshBasicMaterials[e]=new mr({color:e})),this.meshBasicMaterials[e]}getHatchShaderMaterial(e,t,n){if(!e.patternLines||e.patternLines.length<1)return;let r=this.findMatchedHatchShaderMaterial(e,t);if(r)return r;let i=2;e.patternLines.forEach((e=>{i=Math.max(e.dashPattern.length,i)}));let a=0,s=[],o=new Te;for(let t of e.patternLines){let r=new Te(t.origin.x,t.origin.y).sub(n).rotateAround(o,-zr.degToRad(e.patternAngle)),l=new Te(t.delta.x,t.delta.y).rotateAround(o,-zr.degToRad(t.angle));if(0===l.y)return void fe.warn("[Dxf] delta.y is equal to zero !");let h=t.dashPattern.length,u=!0,c=0;for(let e=0;e<h;++e){let n=t.dashPattern[e];n>0&&(u=!1),c+=Math.abs(n)}let d=u?.05:.005,p=[],f=[],m=0;f[0]=m;for(let e=0;e<h;++e)p[e]=t.dashPattern[e],0===p[e]&&(p[e]=d*c),m+=Math.abs(p[e]),f[e+1]=m;for(let e=h;e<i;++e)p[e]=0;for(let e=f.length;e<i+1;++e)f[e]=m;let g={origin:r,delta:l,angle:t.angle-e.patternAngle,pattern:p,patternSum:f,patternLength:m};if(a+=4,a+=i,a+=i+1,a>kn.MaxFragmentUniforms){fe.warn("[Dxf] There will be warning in fragment shader when number of uniforms exceeds 1024, so extra hatch line patterns are ignored here!");break}s.push(g)}let l=Sde(s,e.patternAngle,kn.CameraZoomUniform,new Ot(t),this.overrideHatchPatternLineThickness);return l.defines={MAX_PATTERN_SEGMENT_COUNT:i},this.hatchShaderMaterials.push({patternLines:e.patternLines,patternAngle:e.patternAngle,color:t,material:l}),l}getDivision(e,t,n){let r=Math.round(5e4/this.entityCount);r=Math.max(r,2),r=Math.min(r,10);let i=5*r,a=2*r;if(this.averageCurveSize){a*=Math.pow(n/this.averageCurveSize,.5),a=Math.max(a,r),a=Math.min(a,i)}let s=t-e;s<0&&(s+=2*Math.PI),a=Math.ceil(a*(s/Math.PI));let o=8;return s<.087?o=2:s<.174?o=3:s<.52?o=4:s<1.57?o=5:s<3.14?o=6:s<4.71&&(o=7),a=Math.max(a,o),this.averageCurveSize=(this.averageCurveSize*this.curveCount+n)/(this.curveCount+1),this.curveCount++,Math.max(a,12)}getBSplineInterpolationsPerSplineSegment(e,t){let n=1;this.averageCurveSize&&(n=Math.pow(t/this.averageCurveSize,.5),n=Math.max(n,.5),n=Math.min(n,2)),this.averageCurveSize=(this.averageCurveSize*this.curveCount+t)/(this.curveCount+1),this.curveCount++;let r=2*e*n;if(e>20){r/=Math.log10(e)}return r}setDxfDataToIndexedDb(e,t){return Et(this,null,(function*(){let n={dxfDataId:e,dxf:t};return new Promise(((t,r)=>{l0.instance().add(n,(()=>{fe.info(`[Dxf] Saved '${e}' to indexedDb`),t()}),(e=>{r(e)}))}))}))}getDxfDataFromIndexedDb(e){return Et(this,null,(function*(){return new Promise(((t,n)=>{l0.instance().query(e,(e=>{e&&e.length>0&&t(e[0].dxf),t(void 0)}),(()=>n()))}))}))}buildContainHierarchyTree(e,t,n){var r;let i=new Map,a=n.length;for(let e=0;e<a;e++)i.set(n[e],{index:n[e],children:[]});let s={index:-1,children:[]};for(let o=0;o<a;o++){let l=n[o],h=e[l],u=t[l],c=o+1;for(;c<a;c++){let a=n[c],s=e[a];if(t[a].containsBox(u)&&Gt.isPointInPolygon(h[Ct.generateRandomInt(0,h.length-1)],s)){null==(r=i.get(a))||r.children.push(i.get(l));break}}c===a&&s.children.push(i.get(l))}return s}buildHatchGeometry(e,t,n){if(0===t.children.length)return;let r=[],i=new Map;t.children.forEach((e=>{0===e.children.length?r.push(e.index):i.set(e.index,e.children.map((e=>e.index)))}));let a=e=>{try{let t=new Mo(e);t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),n.push(t)}catch(t){fe.warn(`[Dxf] triangulate shape error: ${e.getPoints().map((e=>e.toArray())).toString()}`)}};r.forEach((t=>{let n=e[t];if(0===n.length)return;let r=new ki(n);a(r)}));let s=e=>e.map((e=>e.toArray()));for(let t of i){let n=new ki(e[t[0]]),r={regions:[],inverted:!1},i=this.findIntersectHole(e,t[1]);i.forEach((t=>{let i={regions:[],inverted:!1};try{t.forEach(((t,a)=>{if(Bo.epsilon(Bt.getVector2RelativeEps(e[t][0]),1e-6),0===a)i=Bo.segments({regions:[s(e[t])],inverted:!1});else{let a=Bo.segments({regions:[s(e[t])],inverted:!1}),o=Bo.combine(i,a);r=Bo.polygon(Bo.selectUnion(o)),r.regions.length>0?r.regions.forEach((e=>{if(0===e.length)return;let t=e.map((e=>new Te(e[0],e[1])));n.holes.push(new $l(t))})):fe.warn("[Dxf] mergedHoles.regions is empty")}}))}catch(e){fe.warn(`[Dxf] polybooljs has error: ${e}, epsilon is ${Bo.epsilon()}`)}}));let o=i.flat(2);for(let r=0;r<t[1].length;r++){let i=t[1][r];o.includes(i)||n.holes.push(new $l(e[i]))}a(n)}t.children.forEach((t=>{t.children.forEach((t=>{this.buildHatchGeometry(e,t,n)}))}))}findIntersectHole(e,t){let n=t.length,r=[];for(let i=0;i<n;i++){let a=e[t[i]],s=!1,o=[];for(let r=i+1;r<n;r++){let n=e[t[r]];Gt.arePolygonsIntersect(a,n)&&(s=!0,o.push(t[r]))}s&&(o.push(t[i]),r.push(o))}return r}checkAndRebasePolygonsOnRTC(e,t){if(!this.enableRTC||0===e.length)return!1;let n=0;e.forEach((e=>{e.forEach((e=>{t.add(e),n++}))})),t.divideScalar(n);let r=!1;if(this.enableRTC&&Gt.shouldRebasePositionOnRTC(t)){r=!0;for(let n=0;n<e.length;n++){let r=e[n];for(let e=0;e<r.length;e++){let n=r[e].x-t.x,i=r[e].y-t.y;r[e]=new Te(n,i)}}}else t.set(0,0);return r}setRTCUserData(e){e.userData.relativeToCenter=!0,this.statsInfo.rebasedEntityCount++}IsfilteredByPathTypeFlag(e){return e<0}findSpatialFilterByHandle(e,t){let n=t.objects.DICTIONARY;if(!n)return;if(!this.dictionaryOwnerHandleAndSpatialFilterHandlesCache){this.dictionaryOwnerHandleAndSpatialFilterHandlesCache={};for(let e of n){let t=e,n="";for(let e in t.entries)if("ACAD_FILTER"===t.entries[e]){n=e;break}n&&(this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e.ownerHandle]&&fe.warn("[Dxf] Why this.dictionaryObjectsCache[obj.ownerHandle] already exist?",e.ownerHandle),this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e.ownerHandle]=n)}}let r=this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e];if(r){if(!this.spatialFiltersCache){this.spatialFiltersCache={};let e=t.objects.SPATIAL_FILTER||[];for(let t of e){let e=t;e.numberOfPointsOnClipBoundary<2||(this.spatialFiltersCache[e.ownerHandle]&&fe.warn("[Dxf] Why this.spatialFiltersCache[spatialFilterObj.ownerHandle] already exist?",r),this.spatialFiltersCache[e.ownerHandle]=e)}}return this.spatialFiltersCache[r]}}initRenderOrderInfo(e){let t=new Set,n=e.objects.DICTIONARY;for(let e of n){let n=e;Object.keys(n.entries).forEach((e=>{n.entries[e]&&"ACAD_SORTENTS"===n.entries[e]&&t.add(e)}))}if(0===t.size)return;let r=e.objects.SORTENTSTABLE;if(r)for(let e=0;e<r.length;++e){let n=r[e];if(t.has(n.handle)){for(let e=0;e<n.sortEntsObject.entityHandles.length;++e){let t=n.sortEntsObject.entityHandles[e];2!==t.length||this.entityHandlesWithRenderOrder[t[0]]?fe.warn(`[Dxf] Failed to handle sortEntsTable: ${n.handle}.`):this.entityHandlesWithRenderOrder[t[0]]=t[1]}break}}}findMatchedHatchShaderMaterial(e,t){let n=e.patternLines;if(!n||n.length<1)return;let r=(e,t)=>Math.abs(e-t)<1e-5,i=(e,t)=>r(e.angle,t.angle)&&r(e.delta.x,t.delta.x)&&r(e.delta.y,t.delta.y)&&r(e.origin.x,t.origin.x)&&r(e.origin.y,t.origin.y)&&((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!r(e[n],t[n]))return!1;return!0})(e.dashPattern,t.dashPattern),a=this.hatchShaderMaterials.find((r=>r.color===t&&r.patternAngle===e.patternAngle&&((e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!i(e[n],t[n]))return!1;return!0})(r.patternLines,n)));return null==a?void 0:a.material}getLayout(e,t){var n,r;if(!this.blockRecordsCache){this.blockRecordsCache={};let t=this.blockRecordsCache,i=null==(r=null==(n=e.tables)?void 0:n.blockRecord)?void 0:r.blockRecords;i&&Object.values(i).forEach((e=>{t[e.handle]=e.layoutHandle}))}let i=this.blockRecordsCache[t.ownerHandle];if(i){let t=e.objects.LAYOUT.find((e=>e.handle===i));if(t)return t}if(!this.entitiesCache){this.entitiesCache={};let t=this.entitiesCache;Object.values(e.entities).forEach((e=>{t[e.handle]=e}))}let a=this.entitiesCache[t.ownerHandle];return a?this.getLayout(e,a):(fe.warn("[Dxf] Failed to find layout name for entity:",t),e.objects.LAYOUT.find((e=>e.layoutName===kn.MODEL_LAYOUT_NAME)))}getLayerVisible(e,t){var n,r,i;let a=null==(r=null==(n=e.tables)?void 0:n.layer)?void 0:r.layers;return a&&(null==(i=a[t])?void 0:i.visible)}getLayerFrozen(e,t){var n,r,i;let a=null==(r=null==(n=e.tables)?void 0:n.layer)?void 0:r.layers;return a&&(null==(i=a[t.layer])?void 0:i.frozen)}cloneMaterialsForSpatialFilter(e){let t=new Map;e.traverse((e=>{e.material&&(e.material=(e=>{let n;return Array.isArray(e)?(n=[],e.forEach((e=>{if(t.has(e.id))n.push(t.get(e.id));else{let r=e.clone();kn.updateMaterialUniforms(r),t.set(e.id,r),n.push(r)}}))):e&&(t.has(e.id)?n=t.get(e.id):(n=e.clone(),kn.updateMaterialUniforms(n),t.set(e.id,n))),n})(e.material))}))}getLineTypeScales(){let e={ltScale:1,celtScale:1};return this.header&&(e.ltScale=this.header.$LTSCALE||1,e.celtScale=this.header.$CELTSCALE||1),e}static getDxfUnits(e){switch(e||0){case 0:return"Unitless";case 1:return"Inches";case 2:return"Feet";case 4:return"Millimeters";case 5:return"Centimeters";case 6:return"Meters";default:fe.warn(`[Dxf] Unsupported $INSUNITS '${e}'`)}return"Unitless"}static computeLineDistance(e){let t=!0===e.isLineSegments,n=e.geometry,r=e.matrixWorld;if(n.index&&(fe.debug(`[Dxf] Line with id '${e.id}' contains index buffer, going to convert it to non-indexed.`),n=Gt.convertGeometryWithIndexedToNonIndexed(n),e.userData.batches&&e.userData.batches.length>0)){fe.debug("[Dxf] This line has been merged!");let t=0;e.userData.batches.forEach((e=>{e.positionStart=t,e.positionCount=e.indexCount,e.indexStart=0,e.indexCount=0,t+=e.positionCount}))}if(null===n.index){let i=n.attributes.position;if(!i||0===i.count)return;let a=[];if(t)for(let e=0,t=i.count;e<t;e+=2)un.fromBufferAttribute(i,e).applyMatrix4(r),br.fromBufferAttribute(i,e+1).applyMatrix4(r),a[e]=0===e?0:a[e-1],a[e+1]=a[e]+un.distanceTo(br);else{a[0]=0;for(let e=1,t=i.count;e<t;e++)un.fromBufferAttribute(i,e-1).applyMatrix4(r),br.fromBufferAttribute(i,e).applyMatrix4(r),a[e]=a[e-1],a[e]+=un.distanceTo(br)}n.setAttribute("lineDistance",new Wt(a,1)),e.geometry=n}else fe.warn("[Dxf] computeLineDistances only possible with non-indexed BufferGeometry.")}static computeLineDistances(e){let t=Date.now();e.traverse((e=>{let t=e;t.isLine&&t.material instanceof fr&&kn.computeLineDistance(t)})),fe.debug(`[Dxf] Computed line distances in ${(Date.now()-t)/1e3}s`)}static mergeDxfObjects(e){let t=Date.now(),n={},r={},i=0,a=0,s=()=>{let e=Date.now();for(let e in n){let t=n[e];kn.removeEmptyObjectsFromRemovingMarkedObjects2(t.children,t.object),t.children=[]}i=0,a+=Date.now()-e};for(let t in e.layersAndObjects){let o=e.layersAndObjects[t];if(o.length<=1)continue;let l=Date.now(),h={},u=[];for(let e of o){if(e.userData.isSnapObject){u.push(e);continue}let t,n=e;for(;n;){if(n.userData.isLayoutLevelObject){t=n;break}n=n.parent}if(!t)continue;let r=t.name;h[r]||(h[r]={object:t,children:[]}),h[r].children.push(e)}for(let e in h){let t=h[e],o=wl.deepMerge(t.children,t.object,!1,!1,!0),l=o.added,c=o.removed;n[e]||(n[e]={object:t.object,children:[]}),r[e]||(r[e]={object:t.object,children:[]});let d=c.length>15e3;if(d){let e=Date.now();kn.removeEmptyObjectsFromRemovingMarkedObjects2(c,t.object),a+=Date.now()-e}else i+=c.length;if(c.length===t.children.length)d||c.forEach((t=>{n[e].children.push(t)}));else{let r=c;c.length>=100&&(r=new Set(c));let i=e=>Array.isArray(r)?r.indexOf(e)>=0:r.has(e);for(let r=0;r<t.children.length;r++){let a=t.children[r];i(a)?d||n[e].children.push(a):u.push(a)}}for(let t=0;t<l.length;t++){let n=l[t];u.push(n),r[e].children.push(n)}i>15e3&&s()}e.layersAndObjects[t]=u,fe.debug(`[Dxf] Merged layer '${t}' in ${(Date.now()-l)/1e3}s`)}i>0&&s();for(let t in r){let n=r[t];e.root.children.find((e=>e.name===t))||e.root.add(n.object),n.children.forEach((e=>{n.object.add(e)})),n.children=[]}fe.debug(`[Dxf] MergeUtils.deepMerge took ${bi.MergeInfo.elapsedTime/1e3}s`),fe.debug(`[Dxf] The remove operation of deep merge took ${a/1e3}s`),fe.debug(`[Dxf] Deep merge totally took ${(Date.now()-t)/1e3}s`);let o=bi.MergeInfo;fe.debug(`[Dxf] Totally merged ${o.removedObjects} objects to ${o.mergedMeshes} meshes, ${o.mergedLines} lines, ${o.mergedPoints} points, ${o.mergedUnknownTypeObjects?o.mergedUnknownTypeObjects+" unknown type,":""} `)}static merge(e,t){return Et(this,null,(function*(){let n=Ct.getUpdateProgressFuncAsync(t),r={};e.objects.LAYOUT.forEach((e=>{var t;let n=e;r[n.layoutName]=n,null==(t=n.directAssociatedLeafObjectSet)||t.clear()}));let i=Date.now(),a={},s={},o=0,l=0,h=()=>{let e=Date.now();for(let e in a){let t=a[e];kn.removeEmptyObjectsFromRemovingMarkedObjects(t.children,t.object),t.children=[]}o=0,l+=Date.now()-e},u=Object.keys(e.layersAndThreejsObjects).length,c=0;for(let t in e.layersAndThreejsObjects){let i=e.layersAndThreejsObjects[t];if(i.length<=1){yield n(++c/u*100);continue}let d=Date.now(),p={},f=[];for(let e of i){if(e.userData.isSnapObject){f.push(e);continue}let t,n=e;for(;n;){if(n.userData.isLayoutLevelObject){t=n;break}n=n.parent}if(!t)continue;let r=t.name;p[r]||(p[r]={object:t,children:[]}),p[r].children.push(e)}let m=Object.keys(p).length,g=0;for(let e in p){let t;if(e!==kn.MODEL_LAYOUT_NAME){let n=r[e];n.directAssociatedLeafObjectSet||(n.directAssociatedLeafObjectSet=new Set),t=n.directAssociatedLeafObjectSet}let i=p[e],d=bi.deepMerge(i.children,i.object,!1,!1,!0),v=d.added,y=d.removed;a[e]||(a[e]={object:i.object,children:[]}),s[e]||(s[e]={object:i.object,children:[]});let x=y.length>15e3;if(x){let e=Date.now();kn.removeEmptyObjectsFromRemovingMarkedObjects(y,i.object),l+=Date.now()-e}else o+=y.length;if(y.length===i.children.length)x||y.forEach((t=>{a[e].children.push(t)}));else{let n=y;y.length>=100&&(n=new Set(y));let r=e=>Array.isArray(n)?n.indexOf(e)>=0:n.has(e);for(let n=0;n<i.children.length;n++){let s=i.children[n];r(s)?x||a[e].children.push(s):(f.push(s),t&&t.add(s))}}for(let n=0;n<v.length;n++){let r=v[n];yr.setSharedVariablesOfObject(r),f.push(r),s[e].children.push(r),t&&t.add(r)}o>15e3&&h(),yield n((c+ ++g/m)/u*100)}yield n(++c/u*100),e.layersAndThreejsObjects[t]=f,fe.debug(`[Dxf] Merged layer '${t}' in ${(Date.now()-d)/1e3}s`)}o>0&&h();for(let t in s){let n=s[t],i=e.threejsObject.children.find((e=>e.name===t));if(i){let e=i.children.find((e=>e.name===kn.SNAP_GROUP_NAME));if(e&&t!==kn.MODEL_LAYOUT_NAME){let n=r[t];n.directAssociatedLeafObjectSet||(n.directAssociatedLeafObjectSet=new Set),e.children.forEach((e=>{var t;return null==(t=n.directAssociatedLeafObjectSet)?void 0:t.add(e)}))}}i||e.threejsObject.add(n.object),n.children.forEach((e=>{e.visible||(e.userData.layerVisible=!1),n.object.add(e),e.updateWorldMatrix(!1,!1)})),n.children=[]}fe.debug(`[Dxf] MergeUtils.deepMerge took ${bi.MergeInfo.elapsedTime/1e3}s`),fe.debug(`[Dxf] The remove operation of deep merge took ${l/1e3}s`),fe.debug(`[Dxf] Deep merge totally took ${(Date.now()-i)/1e3}s`);let d=bi.MergeInfo;fe.debug(`[Dxf] Totally merged ${d.removedObjects} objects to ${d.mergedMeshes} meshes, ${d.mergedLines} lines, ${d.mergedPoints} points, ${d.mergedUnknownTypeObjects?d.mergedUnknownTypeObjects+" unknown type,":""} `),n(100)}))}printStatsInfo(){for(let e in this.entityTypesAndTimes)this.entityTypesAndTimes[e].averageTime=this.entityTypesAndTimes[e].totalTime/this.entityTypesAndTimes[e].createCount;fe.debug("[Dxf] Entity types and took how much time in ms:",this.entityTypesAndTimes),fe.debug("[Dxf] Entity types and mesh count:",this.statsInfo.entityTypesAndMeshCount);let e=0;if(Object.values(this.statsInfo.entityTypesAndMeshCount).forEach((t=>{e+=t})),this.enableRTC&&fe.debug(`[Dxf] Totally rebased ${this.statsInfo.rebasedEntityCount}(out of ${e}) entities`),this.enableMerge){let e=bi.MergeInfo;fe.debug(`[Dxf] Inner merged ${e.removedObjects} objects to ${e.mergedMeshes} meshes, ${e.mergedLines} lines, ${e.mergedPoints} points, ${e.mergedUnknownTypeObjects?e.mergedUnknownTypeObjects+" unknown type,":""} in ${e.elapsedTime/1e3}s`)}let t=(e,t,...n)=>{Object.keys(t).length};t(0,this.statsInfo.unsupportedEntityTypes),t(0,this.statsInfo.unsupportedTextStyles),t(0,this.statsInfo.unsupportedHatchPatterns),this.statsInfo.unsupportedPolylineCount&&fe.warn(`[Dxf] Unsupported polyline (with both width and linetype) count: ${this.statsInfo.unsupportedPolylineCount}, linetype will be ignored.`),t(0,this.statsInfo.invisibleEntities),t(0,this.statsInfo.ignoredFrozenLayersAndEntityCount),t(0,this.statsInfo.ignoredInserts),this.ignorePaperSpace&&t(0,this.statsInfo.ignoredPaperSpaceEntityTypesAndCount),this.font&&t(0,this.font.getUnsupportedChar())}static statLayoutAndLayerObjects(e){let t=new WeakSet,n=0;for(let r in e.layersAndThreejsObjects)e.layersAndThreejsObjects[r].forEach((e=>{e.geometry&&(n++,t.has(e)?console.warn(e):t.add(e))}));let r=new WeakSet,i=0;if(e.threejsObject.traverse((e=>{e.geometry&&(i++,r.has(e)?console.warn(e):r.add(e))})),n!=i)for(let t in e.layersAndThreejsObjects)e.layersAndThreejsObjects[t].forEach((e=>{e.geometry&&(r.has(e)||console.warn(e))}));fe.info(`[Dxf] The count of layer objects is ${n},The count of layout objects is ${i} `)}static removeEmptyObjectsFromRemovingMarkedObjects(e,t){if(0===e.length)return;let n=e=>{let r=[];for(let n of e){n.userData.validCount=0;let e=n.parent;e&&e!==t&&(void 0===e.userData.validCount&&(e.userData.validCount=e.children.length),0==--e.userData.validCount&&r.push(e))}r.length>0&&n(r)};n(e),this.removeEmptyObjectsFromMark(t)}static removeEmptyObjectsFromMark(e){if(0===e.userData.validCount||yr.isEmptyObject(e))return e.removeFromParent(),!0;for(let t=0;t<e.children.length;)this.removeEmptyObjectsFromMark(e.children[t])||++t;return!1}static removeEmptyObjectsFromRemovingMarkedObjects2(e,t){if(0===e.length)return;let n=e=>{let r=[];for(let n of e){n.userData.validCount=0;let e=n.parent;e&&e!==t&&(void 0===e.userData.validCount&&(e.userData.validCount=e.children.length),0==--e.userData.validCount&&r.push(e))}r.length>0&&n(r)};n(e),this.removeEmptyObjectsFromMark2(t)}static removeEmptyObjectsFromMark2(e){if(0===e.userData.validCount||0===e.type&&0===e.children.length)return e.removeFromParent(),!0;for(let t=0;t<e.children.length;)this.removeEmptyObjectsFromMark2(e.children[t])||++t;return!1}},bn=kn;bn.MODEL_LAYOUT_NAME="Model",bn.SNAP_GROUP_NAME="InvisibleObjectGroupForOSnap",bn.SHOW_SNAP_OBJECT=!1,bn.CameraZoomUniform={value:1},bn.ViewportScaleUniform={value:1},bn.TransformMatrixUniform={value:new At},bn.ResolutionUniform={value:new Te},bn.MaxFragmentUniforms=1024;var bC=class{constructor(e){this.manager=e}setLoadManager(e){this.manager=e}loadLocalModel(e,t,n){return Et(this,null,(function*(){let r=t.toLowerCase();return r.endsWith("jpg")||r.endsWith("jpeg")||r.endsWith("png")?this.loadImage(e,n):this.loadDxf(e,n)}))}loadModel(e,t,n){return Et(this,null,(function*(){let r=e;if(!r)return Promise.resolve();let i=(null==t?void 0:t.toLowerCase())||"";if(!i){let e=r.split("?")[0].toLowerCase();if(e){let t=e.lastIndexOf(".");-1!==t&&(i=e.slice(t+1))}}return i.endsWith("jpg")||i.endsWith("jpeg")||i.endsWith("png")?this.loadImage(r,n):this.loadDxf(r,n)}))}loadDxf(e,t){return Et(this,null,(function*(){var n;this.font||console.warn("[LoadingHelper] Should set font first!");let r=new bn(this.manager,{ignorePaperSpace:!0,enableLocalCache:!1,overrideHatchPatternLineThickness:2});r.setFont(this.font),yield null==(n=this.font)?void 0:n.getFontFromIndexeddb();try{let n=yield r.loadAsync(e,t);return Promise.resolve(n.threejsObject)}catch(e){let t=new ErrorEvent("");return Promise.reject(t)}}))}loadImage(e,t){return Et(this,null,(function*(){let n=yield new dh(this.manager).loadAsync(e,t);if(!n)return Promise.reject("Failed to load image!");let r=n.image,i=r&&r.height||10,a=r&&r.width||10;i*=10/a,a=10;let s=new mr({map:n,side:Mr,transparent:!0}),o=new ys(a,i),l=new Jt(o,s);return Promise.resolve(l)}))}loadDxfData(e,t,n,r,i){return Et(this,null,(function*(){var a;this.font||console.warn("[LoadingHelper] Should set font first!");let s=new bn(this.manager,i);return s.setFont(this.font),yield null==(a=this.font)?void 0:a.getFontFromIndexeddb(),s.manager.onLoad=()=>{r&&r()},s.loadEx(e,t,n)}))}setFont(e){this.font=e}};function LN(e){let t=new Blob([e],{type:"text/javascript"}),n=URL.createObjectURL(t),r=new Worker(n);return URL.revokeObjectURL(n),r}function kN(){return LN('var Ji=Object.defineProperty,$i=Object.defineProperties;var Ki=Object.getOwnPropertyDescriptors;var ti=Object.getOwnPropertySymbols;var Qi=Object.prototype.hasOwnProperty,ji=Object.prototype.propertyIsEnumerable;var ei=(h,t,e)=>t in h?Ji(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e,de=(h,t)=>{for(var e in t||(t={}))Qi.call(t,e)&&ei(h,e,t[e]);if(ti)for(var e of ti(t))ji.call(t,e)&&ei(h,e,t[e]);return h},en=(h,t)=>$i(h,Ki(t));var Ei="167";var On=0,Ci=1,Ri=2;var Pi=300;var ni=1e3,Re=1001,ii=1002;var ts=1006;var es=1008;var ns=1009;var is=1015;var ss=1023;var ke=2300,yn=2301,nn=2302,si=2400,ri=2401,oi=2402;var Ii="",Ct="srgb",Bn="srgb-linear",rs="display-p3",Li="display-p3-linear",vn="linear",ai="srgb",ci="rec709",li="p3";var hi=35044;var Pe=2e3,ui=2001,ve=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let n=this._listeners[t.type];if(n!==void 0){t.target=this;let i=n.slice(0);for(let s=0,r=i.length;s<r;s++)i[s].call(this,t);t.target=null}}},W=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var Da=Math.PI/180,Na=180/Math.PI;function Ge(){let h=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(W[h&255]+W[h>>8&255]+W[h>>16&255]+W[h>>24&255]+"-"+W[t&255]+W[t>>8&255]+"-"+W[t>>16&15|64]+W[t>>24&255]+"-"+W[e&63|128]+W[e>>8&255]+"-"+W[e>>16&255]+W[e>>24&255]+W[n&255]+W[n>>8&255]+W[n>>16&255]+W[n>>24&255]).toLowerCase()}function Y(h,t,e){return Math.max(t,Math.min(e,h))}function os(h,t){return(h%t+t)%t}function sn(h,t,e){return(1-e)*h+e*t}function pe(h,t){switch(t.constructor){case Float32Array:return h;case Uint32Array:return h/4294967295;case Uint16Array:return h/65535;case Uint8Array:return h/255;case Int32Array:return Math.max(h/2147483647,-1);case Int16Array:return Math.max(h/32767,-1);case Int8Array:return Math.max(h/127,-1);default:throw new Error("Invalid component type.")}}function $(h,t){switch(t.constructor){case Float32Array:return h;case Uint32Array:return Math.round(h*4294967295);case Uint16Array:return Math.round(h*65535);case Uint8Array:return Math.round(h*255);case Int32Array:return Math.round(h*2147483647);case Int16Array:return Math.round(h*32767);case Int8Array:return Math.round(h*127);default:throw new Error("Invalid component type.")}}var O=class{constructor(t=0,e=0){O.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(Y(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),i=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*n-r*i+t.x,this.y=s*i+r*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},L=class{constructor(t,e,n,i,s,r,a,o,l){L.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,r,a,o,l)}set(t,e,n,i,s,r,a,o,l){let c=this.elements;return c[0]=t,c[1]=i,c[2]=a,c[3]=e,c[4]=s,c[5]=o,c[6]=n,c[7]=r,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,i=e.elements,s=this.elements,r=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],f=n[2],d=n[5],p=n[8],g=i[0],_=i[3],m=i[6],v=i[1],x=i[4],S=i[7],M=i[2],b=i[5],w=i[8];return s[0]=r*g+a*v+o*M,s[3]=r*_+a*x+o*b,s[6]=r*m+a*S+o*w,s[1]=l*g+c*v+u*M,s[4]=l*_+c*x+u*b,s[7]=l*m+c*S+u*w,s[2]=f*g+d*v+p*M,s[5]=f*_+d*x+p*b,s[8]=f*m+d*S+p*w,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*r*c-e*a*l-n*s*c+n*a*o+i*s*l-i*r*o}invert(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=c*r-a*l,f=a*o-c*s,d=l*s-r*o,p=e*u+n*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let g=1/p;return t[0]=u*g,t[1]=(i*l-c*n)*g,t[2]=(a*n-i*r)*g,t[3]=f*g,t[4]=(c*e-i*o)*g,t[5]=(i*s-a*e)*g,t[6]=d*g,t[7]=(n*o-l*e)*g,t[8]=(r*e-n*s)*g,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,s,r,a){let o=Math.cos(s),l=Math.sin(s);return this.set(n*o,n*l,-n*(o*r+l*a)+r+t,-i*l,i*o,-i*(-l*r+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(rn.makeScale(t,e)),this}rotate(t){return this.premultiply(rn.makeRotation(-t)),this}translate(t,e){return this.premultiply(rn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}},rn=new L;function as(h){for(let t=h.length-1;t>=0;--t)if(h[t]>=65535)return!0;return!1}function fi(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}var di={};function cs(h){h in di||(di[h]=!0,console.warn(h))}var pi=new L().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),mi=new L().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),me={[Bn]:{transfer:vn,primaries:ci,luminanceCoefficients:[.2126,.7152,.0722],toReference:h=>h,fromReference:h=>h},[Ct]:{transfer:ai,primaries:ci,luminanceCoefficients:[.2126,.7152,.0722],toReference:h=>h.convertSRGBToLinear(),fromReference:h=>h.convertLinearToSRGB()},[Li]:{transfer:vn,primaries:li,luminanceCoefficients:[.2289,.6917,.0793],toReference:h=>h.applyMatrix3(mi),fromReference:h=>h.applyMatrix3(pi)},[rs]:{transfer:ai,primaries:li,luminanceCoefficients:[.2289,.6917,.0793],toReference:h=>h.convertSRGBToLinear().applyMatrix3(mi),fromReference:h=>h.applyMatrix3(pi).convertLinearToSRGB()}},ls=new Set([Bn,Li]),lt={enabled:!0,_workingColorSpace:Bn,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(h){if(!ls.has(h))throw new Error(`Unsupported working color space, "${h}".`);this._workingColorSpace=h},convert:function(h,t,e){if(this.enabled===!1||t===e||!t||!e)return h;let n=me[t].toReference,i=me[e].fromReference;return i(n(h))},fromWorkingColorSpace:function(h,t){return this.convert(h,this._workingColorSpace,t)},toWorkingColorSpace:function(h,t){return this.convert(h,t,this._workingColorSpace)},getPrimaries:function(h){return me[h].primaries},getTransfer:function(h){return h===Ii?vn:me[h].transfer},getLuminanceCoefficients:function(h,t=this._workingColorSpace){return h.fromArray(me[t].luminanceCoefficients)}};function Qt(h){return h<.04045?h*.0773993808:Math.pow(h*.9478672986+.0521327014,2.4)}function on(h){return h<.0031308?h*12.92:1.055*Math.pow(h,.41666)-.055}var Vt,Mn=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement=="undefined")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Vt===void 0&&(Vt=fi("canvas")),Vt.width=t.width,Vt.height=t.height;let n=Vt.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Vt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap){let e=fi("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let i=n.getImageData(0,0,t.width,t.height),s=i.data;for(let r=0;r<s.length;r++)s[r]=Qt(s[r]/255)*255;return n.putImageData(i,0,0),e}else if(t.data){let e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(Qt(e[n]/255)*255):e[n]=Qt(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},hs=0,Sn=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:hs++}),this.uuid=Ge(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let r=0,a=i.length;r<a;r++)i[r].isDataTexture?s.push(an(i[r].image)):s.push(an(i[r]))}else s=an(i);n.url=s}return e||(t.images[this.uuid]=n),n}};function an(h){return typeof HTMLImageElement!="undefined"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&h instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&h instanceof ImageBitmap?Mn.getDataURL(h):h.data?{data:Array.from(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var us=0,Mt=class extends ve{constructor(t=Mt.DEFAULT_IMAGE,e=Mt.DEFAULT_MAPPING,n=Re,i=Re,s=ts,r=es,a=ss,o=ns,l=Mt.DEFAULT_ANISOTROPY,c=Ii){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:us++}),this.uuid=Ge(),this.name="",this.source=new Sn(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new O(0,0),this.repeat=new O(1,1),this.center=new O(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new L,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Pi)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ni:t.x=t.x-Math.floor(t.x);break;case Re:t.x=t.x<0?0:1;break;case ii:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case ni:t.y=t.y-Math.floor(t.y);break;case Re:t.y=t.y<0?0:1;break;case ii:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}};Mt.DEFAULT_IMAGE=null;Mt.DEFAULT_MAPPING=Pi;Mt.DEFAULT_ANISOTROPY=1;var Ve=class{constructor(t=0,e=0,n=0,i=1){Ve.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,i=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i+r[12]*s,this.y=r[1]*e+r[5]*n+r[9]*i+r[13]*s,this.z=r[2]*e+r[6]*n+r[10]*i+r[14]*s,this.w=r[3]*e+r[7]*n+r[11]*i+r[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,s,o=t.elements,l=o[0],c=o[4],u=o[8],f=o[1],d=o[5],p=o[9],g=o[2],_=o[6],m=o[10];if(Math.abs(c-f)<.01&&Math.abs(u-g)<.01&&Math.abs(p-_)<.01){if(Math.abs(c+f)<.1&&Math.abs(u+g)<.1&&Math.abs(p+_)<.1&&Math.abs(l+d+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let x=(l+1)/2,S=(d+1)/2,M=(m+1)/2,b=(c+f)/4,w=(u+g)/4,A=(p+_)/4;return x>S&&x>M?x<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(x),i=b/n,s=w/n):S>M?S<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(S),n=b/i,s=A/i):M<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(M),n=w/s,i=A/s),this.set(n,i,s,e),this}let v=Math.sqrt((_-p)*(_-p)+(u-g)*(u-g)+(f-c)*(f-c));return Math.abs(v)<.001&&(v=1),this.x=(_-p)/v,this.y=(u-g)/v,this.z=(f-c)/v,this.w=Math.acos((l+d+m-1)/2),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};var Rt=class{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,s,r,a){let o=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],f=s[r+0],d=s[r+1],p=s[r+2],g=s[r+3];if(a===0){t[e+0]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u;return}if(a===1){t[e+0]=f,t[e+1]=d,t[e+2]=p,t[e+3]=g;return}if(u!==g||o!==f||l!==d||c!==p){let _=1-a,m=o*f+l*d+c*p+u*g,v=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){let M=Math.sqrt(x),b=Math.atan2(M,m*v);_=Math.sin(_*b)/M,a=Math.sin(a*b)/M}let S=a*v;if(o=o*_+f*S,l=l*_+d*S,c=c*_+p*S,u=u*_+g*S,_===1-a){let M=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=M,l*=M,c*=M,u*=M}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,s,r){let a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],u=s[r],f=s[r+1],d=s[r+2],p=s[r+3];return t[e]=a*p+c*u+o*d-l*f,t[e+1]=o*p+c*f+l*u-a*d,t[e+2]=l*p+c*d+a*f-o*u,t[e+3]=c*p-a*u-o*f-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){let n=t._x,i=t._y,s=t._z,r=t._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),u=a(s/2),f=o(n/2),d=o(i/2),p=o(s/2);switch(r){case"XYZ":this._x=f*c*u+l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u-f*d*p;break;case"YXZ":this._x=f*c*u+l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u+f*d*p;break;case"ZXY":this._x=f*c*u-l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u-f*d*p;break;case"ZYX":this._x=f*c*u-l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u+f*d*p;break;case"YZX":this._x=f*c*u+l*d*p,this._y=l*d*u+f*c*p,this._z=l*c*p-f*d*u,this._w=l*c*u-f*d*p;break;case"XZY":this._x=f*c*u-l*d*p,this._y=l*d*u-f*c*p,this._z=l*c*p+f*d*u,this._w=l*c*u+f*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],i=e[4],s=e[8],r=e[1],a=e[5],o=e[9],l=e[2],c=e[6],u=e[10],f=n+a+u;if(f>0){let d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-o)*d,this._y=(s-l)*d,this._z=(r-i)*d}else if(n>a&&n>u){let d=2*Math.sqrt(1+n-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(i+r)/d,this._z=(s+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-n-u);this._w=(s-l)/d,this._x=(i+r)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-n-a);this._w=(r-i)/d,this._x=(s+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Y(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(n===0)return this;let i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,i=t._y,s=t._z,r=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=n*c+r*a+i*l-s*o,this._y=i*c+r*o+s*a-n*l,this._z=s*c+r*l+n*o-i*a,this._w=r*c-n*a-i*o-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let n=this._x,i=this._y,s=this._z,r=this._w,a=r*t._w+n*t._x+i*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=n,this._y=i,this._z=s,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-e;return this._w=d*r+e*this._w,this._x=d*n+e*this._x,this._y=d*i+e*this._y,this._z=d*s+e*this._z,this.normalize(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-e)*c)/l,f=Math.sin(e*c)/l;return this._w=r*u+this._w*f,this._x=n*u+this._x*f,this._y=i*u+this._y*f,this._z=s*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},y=class{constructor(t=0,e=0,n=0){y.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(gi.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(gi.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*i,this.y=s[1]*e+s[4]*n+s[7]*i,this.z=s[2]*e+s[5]*n+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,i=this.z,s=t.elements,r=1/(s[3]*e+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*i+s[12])*r,this.y=(s[1]*e+s[5]*n+s[9]*i+s[13])*r,this.z=(s[2]*e+s[6]*n+s[10]*i+s[14])*r,this}applyQuaternion(t){let e=this.x,n=this.y,i=this.z,s=t.x,r=t.y,a=t.z,o=t.w,l=2*(r*i-a*n),c=2*(a*e-s*i),u=2*(s*n-r*e);return this.x=e+o*l+r*u-a*c,this.y=n+o*c+a*l-s*u,this.z=i+o*u+s*c-r*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i,this.y=s[1]*e+s[5]*n+s[9]*i,this.z=s[2]*e+s[6]*n+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,i=t.y,s=t.z,r=e.x,a=e.y,o=e.z;return this.x=i*o-s*a,this.y=s*r-n*o,this.z=n*a-i*r,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return cn.copy(this).projectOnVector(t),this.sub(cn)}reflect(t){return this.sub(cn.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(Y(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},cn=new y,gi=new Rt,J=class{constructor(t=new y(1/0,1/0,1/0),e=new y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(ht.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(ht.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=ht.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let n=t.geometry;if(n!==void 0){let s=n.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let r=0,a=s.count;r<a;r++)t.isMesh===!0?t.getVertexPosition(r,ht):ht.fromBufferAttribute(s,r),ht.applyMatrix4(t.matrixWorld),this.expandByPoint(ht);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Ie.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Ie.copy(n.boundingBox)),Ie.applyMatrix4(t.matrixWorld),this.union(Ie)}let i=t.children;for(let s=0,r=i.length;s<r;s++)this.expandByObject(i[s],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,ht),ht.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ge),Le.subVectors(this.max,ge),Ht.subVectors(t.a,ge),Gt.subVectors(t.b,ge),Wt.subVectors(t.c,ge),wt.subVectors(Gt,Ht),At.subVectors(Wt,Gt),Ut.subVectors(Ht,Wt);let e=[0,-wt.z,wt.y,0,-At.z,At.y,0,-Ut.z,Ut.y,wt.z,0,-wt.x,At.z,0,-At.x,Ut.z,0,-Ut.x,-wt.y,wt.x,0,-At.y,At.x,0,-Ut.y,Ut.x,0];return!ln(e,Ht,Gt,Wt,Le)||(e=[1,0,0,0,1,0,0,0,1],!ln(e,Ht,Gt,Wt,Le))?!1:(Ue.crossVectors(wt,At),e=[Ue.x,Ue.y,Ue.z],ln(e,Ht,Gt,Wt,Le))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,ht).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(ht).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_t),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},_t=[new y,new y,new y,new y,new y,new y,new y,new y],ht=new y,Ie=new J,Ht=new y,Gt=new y,Wt=new y,wt=new y,At=new y,Ut=new y,ge=new y,Le=new y,Ue=new y,Dt=new y;function ln(h,t,e,n,i){for(let s=0,r=h.length-3;s<=r;s+=3){Dt.fromArray(h,s);let a=i.x*Math.abs(Dt.x)+i.y*Math.abs(Dt.y)+i.z*Math.abs(Dt.z),o=t.dot(Dt),l=e.dot(Dt),c=n.dot(Dt);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}var fs=new J,_e=new y,hn=new y,Me=class{constructor(t=new y,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;e!==void 0?n.copy(e):fs.setFromPoints(t).getCenter(n);let i=0;for(let s=0,r=t.length;s<r;s++)i=Math.max(i,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;_e.subVectors(t,this.center);let e=_e.lengthSq();if(e>this.radius*this.radius){let n=Math.sqrt(e),i=(n-this.radius)*.5;this.center.addScaledVector(_e,i/n),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(hn.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(_e.copy(t.center).add(hn)),this.expandByPoint(_e.copy(t.center).sub(hn))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}};var k=class{constructor(t,e,n,i,s,r,a,o,l,c,u,f,d,p,g,_){k.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,r,a,o,l,c,u,f,d,p,g,_)}set(t,e,n,i,s,r,a,o,l,c,u,f,d,p,g,_){let m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=i,m[1]=s,m[5]=r,m[9]=a,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=f,m[3]=d,m[7]=p,m[11]=g,m[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new k().fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,i=1/Xt.setFromMatrixColumn(t,0).length(),s=1/Xt.setFromMatrixColumn(t,1).length(),r=1/Xt.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,n=t.x,i=t.y,s=t.z,r=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(s),u=Math.sin(s);if(t.order==="XYZ"){let f=r*c,d=r*u,p=a*c,g=a*u;e[0]=o*c,e[4]=-o*u,e[8]=l,e[1]=d+p*l,e[5]=f-g*l,e[9]=-a*o,e[2]=g-f*l,e[6]=p+d*l,e[10]=r*o}else if(t.order==="YXZ"){let f=o*c,d=o*u,p=l*c,g=l*u;e[0]=f+g*a,e[4]=p*a-d,e[8]=r*l,e[1]=r*u,e[5]=r*c,e[9]=-a,e[2]=d*a-p,e[6]=g+f*a,e[10]=r*o}else if(t.order==="ZXY"){let f=o*c,d=o*u,p=l*c,g=l*u;e[0]=f-g*a,e[4]=-r*u,e[8]=p+d*a,e[1]=d+p*a,e[5]=r*c,e[9]=g-f*a,e[2]=-r*l,e[6]=a,e[10]=r*o}else if(t.order==="ZYX"){let f=r*c,d=r*u,p=a*c,g=a*u;e[0]=o*c,e[4]=p*l-d,e[8]=f*l+g,e[1]=o*u,e[5]=g*l+f,e[9]=d*l-p,e[2]=-l,e[6]=a*o,e[10]=r*o}else if(t.order==="YZX"){let f=r*o,d=r*l,p=a*o,g=a*l;e[0]=o*c,e[4]=g-f*u,e[8]=p*u+d,e[1]=u,e[5]=r*c,e[9]=-a*c,e[2]=-l*c,e[6]=d*u+p,e[10]=f-g*u}else if(t.order==="XZY"){let f=r*o,d=r*l,p=a*o,g=a*l;e[0]=o*c,e[4]=-u,e[8]=l*c,e[1]=f*u+g,e[5]=r*c,e[9]=d*u-p,e[2]=p*u-d,e[6]=a*c,e[10]=g*u+f}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ds,t,ps)}lookAt(t,e,n){let i=this.elements;return it.subVectors(t,e),it.lengthSq()===0&&(it.z=1),it.normalize(),Tt.crossVectors(n,it),Tt.lengthSq()===0&&(Math.abs(n.z)===1?it.x+=1e-4:it.z+=1e-4,it.normalize(),Tt.crossVectors(n,it)),Tt.normalize(),De.crossVectors(it,Tt),i[0]=Tt.x,i[4]=De.x,i[8]=it.x,i[1]=Tt.y,i[5]=De.y,i[9]=it.y,i[2]=Tt.z,i[6]=De.z,i[10]=it.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,i=e.elements,s=this.elements,r=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],f=n[9],d=n[13],p=n[2],g=n[6],_=n[10],m=n[14],v=n[3],x=n[7],S=n[11],M=n[15],b=i[0],w=i[4],A=i[8],T=i[12],C=i[1],R=i[5],P=i[9],I=i[13],U=i[2],F=i[6],H=i[10],B=i[14],q=i[3],nt=i[7],Ee=i[11],Ce=i[15];return s[0]=r*b+a*C+o*U+l*q,s[4]=r*w+a*R+o*F+l*nt,s[8]=r*A+a*P+o*H+l*Ee,s[12]=r*T+a*I+o*B+l*Ce,s[1]=c*b+u*C+f*U+d*q,s[5]=c*w+u*R+f*F+d*nt,s[9]=c*A+u*P+f*H+d*Ee,s[13]=c*T+u*I+f*B+d*Ce,s[2]=p*b+g*C+_*U+m*q,s[6]=p*w+g*R+_*F+m*nt,s[10]=p*A+g*P+_*H+m*Ee,s[14]=p*T+g*I+_*B+m*Ce,s[3]=v*b+x*C+S*U+M*q,s[7]=v*w+x*R+S*F+M*nt,s[11]=v*A+x*P+S*H+M*Ee,s[15]=v*T+x*I+S*B+M*Ce,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],i=t[8],s=t[12],r=t[1],a=t[5],o=t[9],l=t[13],c=t[2],u=t[6],f=t[10],d=t[14],p=t[3],g=t[7],_=t[11],m=t[15];return p*(+s*o*u-i*l*u-s*a*f+n*l*f+i*a*d-n*o*d)+g*(+e*o*d-e*l*f+s*r*f-i*r*d+i*l*c-s*o*c)+_*(+e*l*u-e*a*d-s*r*u+n*r*d+s*a*c-n*l*c)+m*(-i*a*c-e*o*u+e*a*f+i*r*u-n*r*f+n*o*c)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){let i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],r=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],f=t[10],d=t[11],p=t[12],g=t[13],_=t[14],m=t[15],v=u*_*l-g*f*l+g*o*d-a*_*d-u*o*m+a*f*m,x=p*f*l-c*_*l-p*o*d+r*_*d+c*o*m-r*f*m,S=c*g*l-p*u*l+p*a*d-r*g*d-c*a*m+r*u*m,M=p*u*o-c*g*o-p*a*f+r*g*f+c*a*_-r*u*_,b=e*v+n*x+i*S+s*M;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/b;return t[0]=v*w,t[1]=(g*f*s-u*_*s-g*i*d+n*_*d+u*i*m-n*f*m)*w,t[2]=(a*_*s-g*o*s+g*i*l-n*_*l-a*i*m+n*o*m)*w,t[3]=(u*o*s-a*f*s-u*i*l+n*f*l+a*i*d-n*o*d)*w,t[4]=x*w,t[5]=(c*_*s-p*f*s+p*i*d-e*_*d-c*i*m+e*f*m)*w,t[6]=(p*o*s-r*_*s-p*i*l+e*_*l+r*i*m-e*o*m)*w,t[7]=(r*f*s-c*o*s+c*i*l-e*f*l-r*i*d+e*o*d)*w,t[8]=S*w,t[9]=(p*u*s-c*g*s-p*n*d+e*g*d+c*n*m-e*u*m)*w,t[10]=(r*g*s-p*a*s+p*n*l-e*g*l-r*n*m+e*a*m)*w,t[11]=(c*a*s-r*u*s-c*n*l+e*u*l+r*n*d-e*a*d)*w,t[12]=M*w,t[13]=(c*g*i-p*u*i+p*n*f-e*g*f-c*n*_+e*u*_)*w,t[14]=(p*a*i-r*g*i-p*n*o+e*g*o+r*n*_-e*a*_)*w,t[15]=(r*u*i-c*a*i+c*n*o-e*u*o-r*n*f+e*a*f)*w,this}scale(t){let e=this.elements,n=t.x,i=t.y,s=t.z;return e[0]*=n,e[4]*=i,e[8]*=s,e[1]*=n,e[5]*=i,e[9]*=s,e[2]*=n,e[6]*=i,e[10]*=s,e[3]*=n,e[7]*=i,e[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),i=Math.sin(e),s=1-n,r=t.x,a=t.y,o=t.z,l=s*r,c=s*a;return this.set(l*r+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*r,0,l*o-i*a,c*o+i*r,s*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,s,r){return this.set(1,n,s,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){let i=this.elements,s=e._x,r=e._y,a=e._z,o=e._w,l=s+s,c=r+r,u=a+a,f=s*l,d=s*c,p=s*u,g=r*c,_=r*u,m=a*u,v=o*l,x=o*c,S=o*u,M=n.x,b=n.y,w=n.z;return i[0]=(1-(g+m))*M,i[1]=(d+S)*M,i[2]=(p-x)*M,i[3]=0,i[4]=(d-S)*b,i[5]=(1-(f+m))*b,i[6]=(_+v)*b,i[7]=0,i[8]=(p+x)*w,i[9]=(_-v)*w,i[10]=(1-(f+g))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){let i=this.elements,s=Xt.set(i[0],i[1],i[2]).length(),r=Xt.set(i[4],i[5],i[6]).length(),a=Xt.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],ut.copy(this);let l=1/s,c=1/r,u=1/a;return ut.elements[0]*=l,ut.elements[1]*=l,ut.elements[2]*=l,ut.elements[4]*=c,ut.elements[5]*=c,ut.elements[6]*=c,ut.elements[8]*=u,ut.elements[9]*=u,ut.elements[10]*=u,e.setFromRotationMatrix(ut),n.x=s,n.y=r,n.z=a,this}makePerspective(t,e,n,i,s,r,a=Pe){let o=this.elements,l=2*s/(e-t),c=2*s/(n-i),u=(e+t)/(e-t),f=(n+i)/(n-i),d,p;if(a===Pe)d=-(r+s)/(r-s),p=-2*r*s/(r-s);else if(a===ui)d=-r/(r-s),p=-r*s/(r-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=f,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,s,r,a=Pe){let o=this.elements,l=1/(e-t),c=1/(n-i),u=1/(r-s),f=(e+t)*l,d=(n+i)*c,p,g;if(a===Pe)p=(r+s)*u,g=-2*u;else if(a===ui)p=s*u,g=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-f,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=g,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}},Xt=new y,ut=new k,ds=new y(0,0,0),ps=new y(1,1,1),Tt=new y,De=new y,it=new y,_i=new k,xi=new Rt,jt=class{constructor(t=0,e=0,n=0,i=jt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){let i=t.elements,s=i[0],r=i[4],a=i[8],o=i[1],l=i[5],c=i[9],u=i[2],f=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(Y(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Y(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Y(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(o,s));break;case"ZYX":this._y=Math.asin(-Y(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(o,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Y(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Y(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return _i.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_i,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return xi.setFromEuler(this),this.setFromQuaternion(xi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};jt.DEFAULT_ORDER="XYZ";var bn=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},ms=0,yi=new y,qt=new Rt,xt=new k,Ne=new y,xe=new y,gs=new y,_s=new Rt,vi=new y(1,0,0),Mi=new y(0,1,0),Si=new y(0,0,1),bi={type:"added"},xs={type:"removed"},Yt={type:"childadded",child:null},un={type:"childremoved",child:null},pt=class extends ve{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ms++}),this.uuid=Ge(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pt.DEFAULT_UP.clone();let t=new y,e=new jt,n=new Rt,i=new y(1,1,1);function s(){n.setFromEuler(e,!1)}function r(){e.setFromQuaternion(n,void 0,!1)}e._onChange(s),n._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new k},normalMatrix:{value:new L}}),this.matrix=new k,this.matrixWorld=new k,this.matrixAutoUpdate=pt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=pt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new bn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return qt.setFromAxisAngle(t,e),this.quaternion.multiply(qt),this}rotateOnWorldAxis(t,e){return qt.setFromAxisAngle(t,e),this.quaternion.premultiply(qt),this}rotateX(t){return this.rotateOnAxis(vi,t)}rotateY(t){return this.rotateOnAxis(Mi,t)}rotateZ(t){return this.rotateOnAxis(Si,t)}translateOnAxis(t,e){return yi.copy(t).applyQuaternion(this.quaternion),this.position.add(yi.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(vi,t)}translateY(t){return this.translateOnAxis(Mi,t)}translateZ(t){return this.translateOnAxis(Si,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(xt.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ne.copy(t):Ne.set(t,e,n);let i=this.parent;this.updateWorldMatrix(!0,!1),xe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xt.lookAt(xe,Ne,this.up):xt.lookAt(Ne,xe,this.up),this.quaternion.setFromRotationMatrix(xt),i&&(xt.extractRotation(i.matrixWorld),qt.setFromRotationMatrix(xt),this.quaternion.premultiply(qt.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can\'t be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(bi),Yt.child=t,this.dispatchEvent(Yt),Yt.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(xs),un.child=t,this.dispatchEvent(un),un.child=null),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),xt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),xt.multiply(t.parent.matrixWorld)),t.applyMatrix4(xt),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(bi),Yt.child=t,this.dispatchEvent(Yt),Yt.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){let r=this.children[n].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);let i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,t,gs),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,_s,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){let n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){let i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(t){let e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(t.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];s(t.shapes,u)}else s(t.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(s(t.materials,this.material[o]));i.material=a}else i.material=s(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];i.animations.push(s(t.animations,o))}}if(e){let a=r(t.geometries),o=r(t.materials),l=r(t.textures),c=r(t.images),u=r(t.shapes),f=r(t.skeletons),d=r(t.animations),p=r(t.nodes);a.length>0&&(n.geometries=a),o.length>0&&(n.materials=o),l.length>0&&(n.textures=l),c.length>0&&(n.images=c),u.length>0&&(n.shapes=u),f.length>0&&(n.skeletons=f),d.length>0&&(n.animations=d),p.length>0&&(n.nodes=p)}return n.object=i,n;function r(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){let i=t.children[n];this.add(i.clone())}return this}};pt.DEFAULT_UP=new y(0,1,0);pt.DEFAULT_MATRIX_AUTO_UPDATE=!0;pt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var ft=new y,yt=new y,fn=new y,vt=new y,Zt=new y,Jt=new y,wi=new y,dn=new y,pn=new y,mn=new y,rt=class{constructor(t=new y,e=new y,n=new y){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),ft.subVectors(t,e),i.cross(ft);let s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(t,e,n,i,s){ft.subVectors(i,e),yt.subVectors(n,e),fn.subVectors(t,e);let r=ft.dot(ft),a=ft.dot(yt),o=ft.dot(fn),l=yt.dot(yt),c=yt.dot(fn),u=r*l-a*a;if(u===0)return s.set(0,0,0),null;let f=1/u,d=(l*o-a*c)*f,p=(r*c-a*o)*f;return s.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,vt)===null?!1:vt.x>=0&&vt.y>=0&&vt.x+vt.y<=1}static getInterpolation(t,e,n,i,s,r,a,o){return this.getBarycoord(t,e,n,i,vt)===null?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(s,vt.x),o.addScaledVector(r,vt.y),o.addScaledVector(a,vt.z),o)}static isFrontFacing(t,e,n,i){return ft.subVectors(n,e),yt.subVectors(t,e),ft.cross(yt).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ft.subVectors(this.c,this.b),yt.subVectors(this.a,this.b),ft.cross(yt).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return rt.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return rt.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,s){return rt.getInterpolation(t,this.a,this.b,this.c,e,n,i,s)}containsPoint(t){return rt.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return rt.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n=this.a,i=this.b,s=this.c,r,a;Zt.subVectors(i,n),Jt.subVectors(s,n),dn.subVectors(t,n);let o=Zt.dot(dn),l=Jt.dot(dn);if(o<=0&&l<=0)return e.copy(n);pn.subVectors(t,i);let c=Zt.dot(pn),u=Jt.dot(pn);if(c>=0&&u<=c)return e.copy(i);let f=o*u-c*l;if(f<=0&&o>=0&&c<=0)return r=o/(o-c),e.copy(n).addScaledVector(Zt,r);mn.subVectors(t,s);let d=Zt.dot(mn),p=Jt.dot(mn);if(p>=0&&d<=p)return e.copy(s);let g=d*l-o*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector(Jt,a);let _=c*p-d*u;if(_<=0&&u-c>=0&&d-p>=0)return wi.subVectors(s,i),a=(u-c)/(u-c+(d-p)),e.copy(i).addScaledVector(wi,a);let m=1/(_+g+f);return r=g*m,a=f*m,e.copy(n).addScaledVector(Zt,r).addScaledVector(Jt,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},Ui={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Et={h:0,s:0,l:0},Fe={h:0,s:0,l:0};function gn(h,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?h+(t-h)*6*e:e<1/2?t:e<2/3?h+(t-h)*6*(2/3-e):h}var G=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){let i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ct){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,lt.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=lt.workingColorSpace){return this.r=t,this.g=e,this.b=n,lt.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=lt.workingColorSpace){if(t=os(t,1),e=Y(e,0,1),n=Y(n,0,1),e===0)this.r=this.g=this.b=n;else{let s=n<=.5?n*(1+e):n+e-n*e,r=2*n-s;this.r=gn(r,s,t+1/3),this.g=gn(r,s,t),this.b=gn(r,s,t-1/3)}return lt.toWorkingColorSpace(this,i),this}setStyle(t,e=Ct){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\\w+)\\(([^\\)]*)\\)/.exec(t)){let s,r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(s=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\\#([A-Fa-f\\d]+)$/.exec(t)){let s=i[1],r=s.length;if(r===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(r===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Ct){let n=Ui[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Qt(t.r),this.g=Qt(t.g),this.b=Qt(t.b),this}copyLinearToSRGB(t){return this.r=on(t.r),this.g=on(t.g),this.b=on(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ct){return lt.fromWorkingColorSpace(X.copy(this),t),Math.round(Y(X.r*255,0,255))*65536+Math.round(Y(X.g*255,0,255))*256+Math.round(Y(X.b*255,0,255))}getHexString(t=Ct){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=lt.workingColorSpace){lt.fromWorkingColorSpace(X.copy(this),e);let n=X.r,i=X.g,s=X.b,r=Math.max(n,i,s),a=Math.min(n,i,s),o,l,c=(a+r)/2;if(a===r)o=0,l=0;else{let u=r-a;switch(l=c<=.5?u/(r+a):u/(2-r-a),r){case n:o=(i-s)/u+(i<s?6:0);break;case i:o=(s-n)/u+2;break;case s:o=(n-i)/u+4;break}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=lt.workingColorSpace){return lt.fromWorkingColorSpace(X.copy(this),e),t.r=X.r,t.g=X.g,t.b=X.b,t}getStyle(t=Ct){lt.fromWorkingColorSpace(X.copy(this),t);let e=X.r,n=X.g,i=X.b;return t!==Ct?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,e,n){return this.getHSL(Et),this.setHSL(Et.h+t,Et.s+e,Et.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Et),t.getHSL(Fe);let n=sn(Et.h,Fe.h,e),i=sn(Et.s,Fe.s,e),s=sn(Et.l,Fe.l,e);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){let e=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*e+s[3]*n+s[6]*i,this.g=s[1]*e+s[4]*n+s[7]*i,this.b=s[2]*e+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},X=new G;G.NAMES=Ui;var z=new y,Oe=new O,Z=class{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=hi,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=is,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return cs("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Oe.fromBufferAttribute(this,e),Oe.applyMatrix3(t),this.setXY(e,Oe.x,Oe.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)z.fromBufferAttribute(this,e),z.applyMatrix3(t),this.setXYZ(e,z.x,z.y,z.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)z.fromBufferAttribute(this,e),z.applyMatrix4(t),this.setXYZ(e,z.x,z.y,z.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)z.fromBufferAttribute(this,e),z.applyNormalMatrix(t),this.setXYZ(e,z.x,z.y,z.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)z.fromBufferAttribute(this,e),z.transformDirection(t),this.setXYZ(e,z.x,z.y,z.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=pe(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=$(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=pe(e,this.array)),e}setX(t,e){return this.normalized&&(e=$(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=pe(e,this.array)),e}setY(t,e){return this.normalized&&(e=$(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=pe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=$(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=pe(e,this.array)),e}setW(t,e){return this.normalized&&(e=$(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=$(e,this.array),n=$(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=$(e,this.array),n=$(n,this.array),i=$(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,s){return t*=this.itemSize,this.normalized&&(e=$(e,this.array),n=$(n,this.array),i=$(i,this.array),s=$(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==hi&&(t.usage=this.usage),t}};var wn=class extends Z{constructor(t,e,n){super(new Uint16Array(t),e,n)}};var An=class extends Z{constructor(t,e,n){super(new Uint32Array(t),e,n)}};var Tn=class extends Z{constructor(t,e,n){super(new Float32Array(t),e,n)}},ys=0,ot=new k,_n=new pt,$t=new y,st=new J,ye=new J,V=new y,te=class extends ve{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ys++}),this.uuid=Ge(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(as(t)?An:wn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let s=new L().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}let i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ot.makeRotationFromQuaternion(t),this.applyMatrix4(ot),this}rotateX(t){return ot.makeRotationX(t),this.applyMatrix4(ot),this}rotateY(t){return ot.makeRotationY(t),this.applyMatrix4(ot),this}rotateZ(t){return ot.makeRotationZ(t),this.applyMatrix4(ot),this}translate(t,e,n){return ot.makeTranslation(t,e,n),this.applyMatrix4(ot),this}scale(t,e,n){return ot.makeScale(t,e,n),this.applyMatrix4(ot),this}lookAt(t){return _n.lookAt(t),_n.updateMatrix(),this.applyMatrix4(_n.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($t).negate(),this.translate($t.x,$t.y,$t.z),this}setFromPoints(t){let e=[];for(let n=0,i=t.length;n<i;n++){let s=t[n];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Tn(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new J);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new y(-1/0,-1/0,-1/0),new y(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){let s=e[n];st.setFromBufferAttribute(s),this.morphTargetsRelative?(V.addVectors(this.boundingBox.min,st.min),this.boundingBox.expandByPoint(V),V.addVectors(this.boundingBox.max,st.max),this.boundingBox.expandByPoint(V)):(this.boundingBox.expandByPoint(st.min),this.boundingBox.expandByPoint(st.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error(\'THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.\',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Me);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new y,1/0);return}if(t){let n=this.boundingSphere.center;if(st.setFromBufferAttribute(t),e)for(let s=0,r=e.length;s<r;s++){let a=e[s];ye.setFromBufferAttribute(a),this.morphTargetsRelative?(V.addVectors(st.min,ye.min),st.expandByPoint(V),V.addVectors(st.max,ye.max),st.expandByPoint(V)):(st.expandByPoint(ye.min),st.expandByPoint(ye.max))}st.getCenter(n);let i=0;for(let s=0,r=t.count;s<r;s++)V.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(V));if(e)for(let s=0,r=e.length;s<r;s++){let a=e[s],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)V.fromBufferAttribute(a,l),o&&($t.fromBufferAttribute(t,l),V.add($t)),i=Math.max(i,n.distanceToSquared(V))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error(\'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.\',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.position,i=e.normal,s=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Z(new Float32Array(4*n.count),4));let r=this.getAttribute("tangent"),a=[],o=[];for(let A=0;A<n.count;A++)a[A]=new y,o[A]=new y;let l=new y,c=new y,u=new y,f=new O,d=new O,p=new O,g=new y,_=new y;function m(A,T,C){l.fromBufferAttribute(n,A),c.fromBufferAttribute(n,T),u.fromBufferAttribute(n,C),f.fromBufferAttribute(s,A),d.fromBufferAttribute(s,T),p.fromBufferAttribute(s,C),c.sub(l),u.sub(l),d.sub(f),p.sub(f);let R=1/(d.x*p.y-p.x*d.y);isFinite(R)&&(g.copy(c).multiplyScalar(p.y).addScaledVector(u,-d.y).multiplyScalar(R),_.copy(u).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(R),a[A].add(g),a[T].add(g),a[C].add(g),o[A].add(_),o[T].add(_),o[C].add(_))}let v=this.groups;v.length===0&&(v=[{start:0,count:t.count}]);for(let A=0,T=v.length;A<T;++A){let C=v[A],R=C.start,P=C.count;for(let I=R,U=R+P;I<U;I+=3)m(t.getX(I+0),t.getX(I+1),t.getX(I+2))}let x=new y,S=new y,M=new y,b=new y;function w(A){M.fromBufferAttribute(i,A),b.copy(M);let T=a[A];x.copy(T),x.sub(M.multiplyScalar(M.dot(T))).normalize(),S.crossVectors(b,T);let R=S.dot(o[A])<0?-1:1;r.setXYZW(A,x.x,x.y,x.z,R)}for(let A=0,T=v.length;A<T;++A){let C=v[A],R=C.start,P=C.count;for(let I=R,U=R+P;I<U;I+=3)w(t.getX(I+0)),w(t.getX(I+1)),w(t.getX(I+2))}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Z(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let f=0,d=n.count;f<d;f++)n.setXYZ(f,0,0,0);let i=new y,s=new y,r=new y,a=new y,o=new y,l=new y,c=new y,u=new y;if(t)for(let f=0,d=t.count;f<d;f+=3){let p=t.getX(f+0),g=t.getX(f+1),_=t.getX(f+2);i.fromBufferAttribute(e,p),s.fromBufferAttribute(e,g),r.fromBufferAttribute(e,_),c.subVectors(r,s),u.subVectors(i,s),c.cross(u),a.fromBufferAttribute(n,p),o.fromBufferAttribute(n,g),l.fromBufferAttribute(n,_),a.add(c),o.add(c),l.add(c),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,o.x,o.y,o.z),n.setXYZ(_,l.x,l.y,l.z)}else for(let f=0,d=e.count;f<d;f+=3)i.fromBufferAttribute(e,f+0),s.fromBufferAttribute(e,f+1),r.fromBufferAttribute(e,f+2),c.subVectors(r,s),u.subVectors(i,s),c.cross(u),n.setXYZ(f+0,c.x,c.y,c.z),n.setXYZ(f+1,c.x,c.y,c.z),n.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)V.fromBufferAttribute(t,e),V.normalize(),t.setXYZ(e,V.x,V.y,V.z)}toNonIndexed(){function t(a,o){let l=a.array,c=a.itemSize,u=a.normalized,f=new l.constructor(o.length*c),d=0,p=0;for(let g=0,_=o.length;g<_;g++){a.isInterleavedBufferAttribute?d=o[g]*a.data.stride+a.offset:d=o[g]*c;for(let m=0;m<c;m++)f[p++]=l[d++]}return new Z(f,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new te,n=this.index.array,i=this.attributes;for(let a in i){let o=i[a],l=t(o,n);e.setAttribute(a,l)}let s=this.morphAttributes;for(let a in s){let o=[],l=s[a];for(let c=0,u=l.length;c<u;c++){let f=l[c],d=t(f,n);o.push(d)}e.morphAttributes[a]=o}e.morphTargetsRelative=this.morphTargetsRelative;let r=this.groups;for(let a=0,o=r.length;a<o;a++){let l=r[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let o in n){let l=n[o];t.data.attributes[o]=l.toJSON(t.data)}let i={},s=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,f=l.length;u<f;u++){let d=l[u];c.push(d.toJSON(t.data))}c.length>0&&(i[o]=c,s=!0)}s&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);let r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));let a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;n!==null&&this.setIndex(n.clone(e));let i=t.attributes;for(let l in i){let c=i[l];this.setAttribute(l,c.clone(e))}let s=t.morphAttributes;for(let l in s){let c=[],u=s[l];for(let f=0,d=u.length;f<d;f++)c.push(u[f].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;let r=t.groups;for(let l=0,c=r.length;l<c;l++){let u=r[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};function vs(h){let t={};for(let e in h){t[e]={};for(let n in h[e]){let i=h[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=i.clone():Array.isArray(i)?t[e][n]=i.slice():t[e][n]=i}}return t}function K(h){let t={};for(let e=0;e<h.length;e++){let n=vs(h[e]);for(let i in n)t[i]=n[i]}return t}var xn=new y,Ms=new y,Ss=new L,ee=class{constructor(t=new y(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let i=xn.subVectors(n,e).cross(Ms.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){let n=t.delta(xn),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:e.copy(t.start).addScaledVector(n,s)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||Ss.getNormalMatrix(t),i=this.coplanarPoint(xn).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}};var bs=`#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif`,ws=`#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif`,As=`#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif`,Ts=`#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif`,Es=`#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif`,Cs=`#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif`,Rs=`#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif`,Ps=`#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif`,Is=`#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif`,Ls=`#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif`,Us=`vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif`,Ds=`vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif`,Ns=`float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated`,Fs=`#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif`,Os=`#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif`,Bs=`#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif`,zs=`#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif`,ks=`#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif`,Vs=`#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif`,Hs=`#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif`,Gs=`#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif`,Ws=`#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif`,Xs=`#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif`,qs=`#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated`,Ys=`#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif`,Zs=`vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif`,Js=`#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif`,$s=`#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif`,Ks=`#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif`,Qs=`#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif`,js="gl_FragColor = linearToOutputTexel( gl_FragColor );",tr=`\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}`,er=`#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif`,nr=`#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif`,ir=`#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif`,sr=`#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif`,rr=`#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif`,or=`#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif`,ar=`#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif`,cr=`#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif`,lr=`#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif`,hr=`#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}`,ur=`#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif`,fr=`LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;`,dr=`varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert`,pr=`uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif`,mr=`#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif`,gr=`ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;`,_r=`varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon`,xr=`BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;`,yr=`varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong`,vr=`PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif`,Mr=`struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}`,Sr=`\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif`,br=`#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif`,wr=`#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif`,Ar=`#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif`,Tr=`#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif`,Er=`#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif`,Cr=`#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif`,Rr=`#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif`,Pr=`#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif`,Ir=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif`,Lr=`#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif`,Ur=`float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif`,Dr=`#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif`,Nr=`#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif`,Fr=`#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif`,Or=`#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif`,Br=`#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif`,zr=`#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif`,kr=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;`,Vr=`#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif`,Hr=`#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif`,Gr=`#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif`,Wr=`#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif`,Xr=`#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif`,qr=`#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif`,Yr=`#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif`,Zr=`#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif`,Jr=`#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif`,$r=`#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Kr=`vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}`,Qr=`#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif`,jr=`vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;`,to=`#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif`,eo=`#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif`,no=`float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif`,io=`#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif`,so=`#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif`,ro=`#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif`,oo=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif`,ao=`float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}`,co=`#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif`,lo=`#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif`,ho=`#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif`,uo=`#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif`,fo=`float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif`,po=`#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif`,mo=`#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif`,go=`#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }`,_o=`#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif`,xo=`#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif`,yo=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif`,vo=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif`,Mo=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif`,So=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif`,bo=`varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}`,wo=`uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,Ao=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}`,To=`#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,Eo=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}`,Co=`uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,Ro=`#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}`,Po=`#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}`,Io=`#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}`,Lo=`#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}`,Uo=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}`,Do=`uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,No=`uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}`,Fo=`uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}`,Oo=`#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}`,Bo=`uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,zo=`#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,ko=`#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,Vo=`#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}`,Ho=`#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,Go=`#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}`,Wo=`#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}`,Xo=`#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,qo=`#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,Yo=`#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}`,Zo=`#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,Jo=`#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,$o=`#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,Ko=`uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}`,Qo=`uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}`,jo=`#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,ta=`uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}`,ea=`uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}`,na=`uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}`,D={alphahash_fragment:bs,alphahash_pars_fragment:ws,alphamap_fragment:As,alphamap_pars_fragment:Ts,alphatest_fragment:Es,alphatest_pars_fragment:Cs,aomap_fragment:Rs,aomap_pars_fragment:Ps,batching_pars_vertex:Is,batching_vertex:Ls,begin_vertex:Us,beginnormal_vertex:Ds,bsdfs:Ns,iridescence_fragment:Fs,bumpmap_pars_fragment:Os,clipping_planes_fragment:Bs,clipping_planes_pars_fragment:zs,clipping_planes_pars_vertex:ks,clipping_planes_vertex:Vs,color_fragment:Hs,color_pars_fragment:Gs,color_pars_vertex:Ws,color_vertex:Xs,common:qs,cube_uv_reflection_fragment:Ys,defaultnormal_vertex:Zs,displacementmap_pars_vertex:Js,displacementmap_vertex:$s,emissivemap_fragment:Ks,emissivemap_pars_fragment:Qs,colorspace_fragment:js,colorspace_pars_fragment:tr,envmap_fragment:er,envmap_common_pars_fragment:nr,envmap_pars_fragment:ir,envmap_pars_vertex:sr,envmap_physical_pars_fragment:mr,envmap_vertex:rr,fog_vertex:or,fog_pars_vertex:ar,fog_fragment:cr,fog_pars_fragment:lr,gradientmap_pars_fragment:hr,lightmap_pars_fragment:ur,lights_lambert_fragment:fr,lights_lambert_pars_fragment:dr,lights_pars_begin:pr,lights_toon_fragment:gr,lights_toon_pars_fragment:_r,lights_phong_fragment:xr,lights_phong_pars_fragment:yr,lights_physical_fragment:vr,lights_physical_pars_fragment:Mr,lights_fragment_begin:Sr,lights_fragment_maps:br,lights_fragment_end:wr,logdepthbuf_fragment:Ar,logdepthbuf_pars_fragment:Tr,logdepthbuf_pars_vertex:Er,logdepthbuf_vertex:Cr,map_fragment:Rr,map_pars_fragment:Pr,map_particle_fragment:Ir,map_particle_pars_fragment:Lr,metalnessmap_fragment:Ur,metalnessmap_pars_fragment:Dr,morphinstance_vertex:Nr,morphcolor_vertex:Fr,morphnormal_vertex:Or,morphtarget_pars_vertex:Br,morphtarget_vertex:zr,normal_fragment_begin:kr,normal_fragment_maps:Vr,normal_pars_fragment:Hr,normal_pars_vertex:Gr,normal_vertex:Wr,normalmap_pars_fragment:Xr,clearcoat_normal_fragment_begin:qr,clearcoat_normal_fragment_maps:Yr,clearcoat_pars_fragment:Zr,iridescence_pars_fragment:Jr,opaque_fragment:$r,packing:Kr,premultiplied_alpha_fragment:Qr,project_vertex:jr,dithering_fragment:to,dithering_pars_fragment:eo,roughnessmap_fragment:no,roughnessmap_pars_fragment:io,shadowmap_pars_fragment:so,shadowmap_pars_vertex:ro,shadowmap_vertex:oo,shadowmask_pars_fragment:ao,skinbase_vertex:co,skinning_pars_vertex:lo,skinning_vertex:ho,skinnormal_vertex:uo,specularmap_fragment:fo,specularmap_pars_fragment:po,tonemapping_fragment:mo,tonemapping_pars_fragment:go,transmission_fragment:_o,transmission_pars_fragment:xo,uv_pars_fragment:yo,uv_pars_vertex:vo,uv_vertex:Mo,worldpos_vertex:So,background_vert:bo,background_frag:wo,backgroundCube_vert:Ao,backgroundCube_frag:To,cube_vert:Eo,cube_frag:Co,depth_vert:Ro,depth_frag:Po,distanceRGBA_vert:Io,distanceRGBA_frag:Lo,equirect_vert:Uo,equirect_frag:Do,linedashed_vert:No,linedashed_frag:Fo,meshbasic_vert:Oo,meshbasic_frag:Bo,meshlambert_vert:zo,meshlambert_frag:ko,meshmatcap_vert:Vo,meshmatcap_frag:Ho,meshnormal_vert:Go,meshnormal_frag:Wo,meshphong_vert:Xo,meshphong_frag:qo,meshphysical_vert:Yo,meshphysical_frag:Zo,meshtoon_vert:Jo,meshtoon_frag:$o,points_vert:Ko,points_frag:Qo,shadow_vert:jo,shadow_frag:ta,sprite_vert:ea,sprite_frag:na},E={common:{diffuse:{value:new G(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new L},alphaMap:{value:null},alphaMapTransform:{value:new L},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new L}},envmap:{envMap:{value:null},envMapRotation:{value:new L},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new L}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new L}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new L},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new L},normalScale:{value:new O(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new L},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new L}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new L}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new L}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new G(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new G(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new L},alphaTest:{value:0},uvTransform:{value:new L}},sprite:{diffuse:{value:new G(16777215)},opacity:{value:1},center:{value:new O(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new L},alphaMap:{value:null},alphaMapTransform:{value:new L},alphaTest:{value:0}}},Ai={basic:{uniforms:K([E.common,E.specularmap,E.envmap,E.aomap,E.lightmap,E.fog]),vertexShader:D.meshbasic_vert,fragmentShader:D.meshbasic_frag},lambert:{uniforms:K([E.common,E.specularmap,E.envmap,E.aomap,E.lightmap,E.emissivemap,E.bumpmap,E.normalmap,E.displacementmap,E.fog,E.lights,{emissive:{value:new G(0)}}]),vertexShader:D.meshlambert_vert,fragmentShader:D.meshlambert_frag},phong:{uniforms:K([E.common,E.specularmap,E.envmap,E.aomap,E.lightmap,E.emissivemap,E.bumpmap,E.normalmap,E.displacementmap,E.fog,E.lights,{emissive:{value:new G(0)},specular:{value:new G(1118481)},shininess:{value:30}}]),vertexShader:D.meshphong_vert,fragmentShader:D.meshphong_frag},standard:{uniforms:K([E.common,E.envmap,E.aomap,E.lightmap,E.emissivemap,E.bumpmap,E.normalmap,E.displacementmap,E.roughnessmap,E.metalnessmap,E.fog,E.lights,{emissive:{value:new G(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:D.meshphysical_vert,fragmentShader:D.meshphysical_frag},toon:{uniforms:K([E.common,E.aomap,E.lightmap,E.emissivemap,E.bumpmap,E.normalmap,E.displacementmap,E.gradientmap,E.fog,E.lights,{emissive:{value:new G(0)}}]),vertexShader:D.meshtoon_vert,fragmentShader:D.meshtoon_frag},matcap:{uniforms:K([E.common,E.bumpmap,E.normalmap,E.displacementmap,E.fog,{matcap:{value:null}}]),vertexShader:D.meshmatcap_vert,fragmentShader:D.meshmatcap_frag},points:{uniforms:K([E.points,E.fog]),vertexShader:D.points_vert,fragmentShader:D.points_frag},dashed:{uniforms:K([E.common,E.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:D.linedashed_vert,fragmentShader:D.linedashed_frag},depth:{uniforms:K([E.common,E.displacementmap]),vertexShader:D.depth_vert,fragmentShader:D.depth_frag},normal:{uniforms:K([E.common,E.bumpmap,E.normalmap,E.displacementmap,{opacity:{value:1}}]),vertexShader:D.meshnormal_vert,fragmentShader:D.meshnormal_frag},sprite:{uniforms:K([E.sprite,E.fog]),vertexShader:D.sprite_vert,fragmentShader:D.sprite_frag},background:{uniforms:{uvTransform:{value:new L},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:D.background_vert,fragmentShader:D.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new L}},vertexShader:D.backgroundCube_vert,fragmentShader:D.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:D.cube_vert,fragmentShader:D.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:D.equirect_vert,fragmentShader:D.equirect_frag},distanceRGBA:{uniforms:K([E.common,E.displacementmap,{referencePosition:{value:new y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:D.distanceRGBA_vert,fragmentShader:D.distanceRGBA_frag},shadow:{uniforms:K([E.lights,E.fog,{color:{value:new G(0)},opacity:{value:1}}]),vertexShader:D.shadow_vert,fragmentShader:D.shadow_frag}};Ai.physical={uniforms:K([Ai.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new L},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new L},clearcoatNormalScale:{value:new O(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new L},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new L},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new L},sheen:{value:0},sheenColor:{value:new G(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new L},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new L},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new L},transmissionSamplerSize:{value:new O},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new L},attenuationDistance:{value:0},attenuationColor:{value:new G(0)},specularColor:{value:new G(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new L},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new L},anisotropyVector:{value:new O},anisotropyMap:{value:null},anisotropyMapTransform:{value:new L}}]),vertexShader:D.meshphysical_vert,fragmentShader:D.meshphysical_frag};var Nt=(1+Math.sqrt(5))/2,Kt=1/Nt,Fa=[new y(-Nt,Kt,0),new y(Nt,Kt,0),new y(-Kt,0,Nt),new y(Kt,0,Nt),new y(0,Nt,-Kt),new y(0,Nt,Kt),new y(-1,1,-1),new y(1,1,-1),new y(-1,1,1),new y(1,1,1)];var Oa=new Float32Array(16),Ba=new Float32Array(9),za=new Float32Array(4);function Be(h,t,e){return!h||!e&&h.constructor===t?h:typeof t.BYTES_PER_ELEMENT=="number"?new t(h):Array.prototype.slice.call(h)}function ia(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)}var ne=class{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,i=e[n],s=e[n-1];n:{t:{let r;e:{i:if(!(t<i)){for(let a=n+2;;){if(i===void 0){if(t<s)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=i,i=e[++n],t<i)break t}r=e.length;break e}if(!(t>=s)){let a=e[1];t<a&&(n=2,s=a);for(let o=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===o)break;if(i=s,s=e[--n-1],t>=s)break t}r=n,n=0;break e}break n}for(;n<r;){let a=n+r>>>1;t<e[a]?r=a:n=a+1}if(i=e[n],s=e[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=t*i;for(let r=0;r!==i;++r)e[r]=n[s+r];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},En=class extends ne{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:si,endingEnd:si}}intervalChanged_(t,e,n){let i=this.parameterPositions,s=t-2,r=t+1,a=i[s],o=i[r];if(a===void 0)switch(this.getSettings_().endingStart){case ri:s=t,a=2*e-n;break;case oi:s=i.length-2,a=e+i[s]-i[s+1];break;default:s=t,a=n}if(o===void 0)switch(this.getSettings_().endingEnd){case ri:r=t,o=2*n-e;break;case oi:r=1,o=n+i[1]-i[0];break;default:r=t-1,o=e}let l=(n-e)*.5,c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=s*c,this._offsetNext=r*c}interpolate_(t,e,n,i){let s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,f=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),g=p*p,_=g*p,m=-f*_+2*f*g-f*p,v=(1+f)*_+(-1.5-2*f)*g+(-.5+f)*p+1,x=(-1-d)*_+(1.5+d)*g+.5*p,S=d*_-d*g;for(let M=0;M!==a;++M)s[M]=m*r[c+M]+v*r[l+M]+x*r[o+M]+S*r[u+M];return s}},Cn=class extends ne{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){let s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(n-e)/(i-e),u=1-c;for(let f=0;f!==a;++f)s[f]=r[l+f]*u+r[o+f]*c;return s}},Rn=class extends ne{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}},dt=class{constructor(t,e,n,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Be(e,this.TimeBufferType),this.values=Be(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Be(t.times,Array),values:Be(t.values,Array)};let i=t.getInterpolation();i!==t.DefaultInterpolation&&(n.interpolation=i)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Rn(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Cn(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new En(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ke:e=this.InterpolantFactoryMethodDiscrete;break;case yn:e=this.InterpolantFactoryMethodLinear;break;case nn:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ke;case this.InterpolantFactoryMethodLinear:return yn;case this.InterpolantFactoryMethodSmooth:return nn}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){let n=this.times,i=n.length,s=0,r=i-1;for(;s!==i&&n[s]<t;)++s;for(;r!==-1&&n[r]>e;)--r;if(++r,s!==0||r!==i){s>=r&&(r=Math.max(r,1),s=r-1);let a=this.getValueSize();this.times=n.slice(s,r),this.values=this.values.slice(s*a,r*a)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let a=0;a!==s;a++){let o=n[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(r!==null&&r>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,r),t=!1;break}r=o}if(i!==void 0&&ia(i))for(let a=0,o=i.length;a!==o;++a){let l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){let t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===nn,s=t.length-1,r=1;for(let a=1;a<s;++a){let o=!1,l=t[a],c=t[a+1];if(l!==c&&(a!==1||l!==t[0]))if(i)o=!0;else{let u=a*n,f=u-n,d=u+n;for(let p=0;p!==n;++p){let g=e[u+p];if(g!==e[f+p]||g!==e[d+p]){o=!0;break}}}if(o){if(a!==r){t[r]=t[a];let u=a*n,f=r*n;for(let d=0;d!==n;++d)e[f+d]=e[u+d]}++r}}if(s>0){t[r]=t[s];for(let a=s*n,o=r*n,l=0;l!==n;++l)e[o+l]=e[a+l];++r}return r!==t.length?(this.times=t.slice(0,r),this.values=e.slice(0,r*n)):(this.times=t,this.values=e),this}clone(){let t=this.times.slice(),e=this.values.slice(),n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}};dt.prototype.TimeBufferType=Float32Array;dt.prototype.ValueBufferType=Float32Array;dt.prototype.DefaultInterpolation=yn;var Ft=class extends dt{constructor(t,e,n){super(t,e,n)}};Ft.prototype.ValueTypeName="bool";Ft.prototype.ValueBufferType=Array;Ft.prototype.DefaultInterpolation=ke;Ft.prototype.InterpolantFactoryMethodLinear=void 0;Ft.prototype.InterpolantFactoryMethodSmooth=void 0;var Pn=class extends dt{};Pn.prototype.ValueTypeName="color";var In=class extends dt{};In.prototype.ValueTypeName="number";var Ln=class extends ne{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){let s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e),l=t*a;for(let c=l+a;l!==c;l+=4)Rt.slerpFlat(s,0,r,l-a,r,l,o);return s}},He=class extends dt{InterpolantFactoryMethodLinear(t){return new Ln(this.times,this.values,this.getValueSize(),t)}};He.prototype.ValueTypeName="quaternion";He.prototype.InterpolantFactoryMethodSmooth=void 0;var Ot=class extends dt{constructor(t,e,n){super(t,e,n)}};Ot.prototype.ValueTypeName="string";Ot.prototype.ValueBufferType=Array;Ot.prototype.DefaultInterpolation=ke;Ot.prototype.InterpolantFactoryMethodLinear=void 0;Ot.prototype.InterpolantFactoryMethodSmooth=void 0;var Un=class extends dt{};Un.prototype.ValueTypeName="vector";var Dn=class{constructor(t,e,n){let i=this,s=!1,r=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(c){a++,s===!1&&i.onStart!==void 0&&i.onStart(c,r,a),s=!0},this.itemEnd=function(c){r++,i.onProgress!==void 0&&i.onProgress(c,r,a),r===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(c){i.onError!==void 0&&i.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,f=l.length;u<f;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},sa=new Dn,Nn=class{constructor(t){this.manager=t!==void 0?t:sa,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let n=this;return new Promise(function(i,s){n.load(t,i,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};Nn.DEFAULT_MATERIAL_NAME="__DEFAULT";var zn="\\\\[\\\\]\\\\.:\\\\/",ra=new RegExp("["+zn+"]","g"),kn="[^"+zn+"]",oa="[^"+zn.replace("\\\\.","")+"]",aa=/((?:WC+[\\/:])*)/.source.replace("WC",kn),ca=/(WCOD+)?/.source.replace("WCOD",oa),la=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace("WC",kn),ha=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace("WC",kn),ua=new RegExp("^"+aa+ca+la+ha+"$"),fa=["material","materials","bones","map"],Fn=class{constructor(t,e,n){let i=n||N.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},N=class{constructor(t,e,n){this.path=e,this.parsedPath=n||N.parseTrackName(e),this.node=N.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new N.Composite(t,e,n):new N(t,e,n)}static sanitizeNodeName(t){return t.replace(/\\s/g,"_").replace(ra,"")}static parseTrackName(t){let e=ua.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){let s=n.nodeName.substring(i+1);fa.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){let n=function(s){for(let r=0;r<s.length;r++){let a=s[r];if(a.name===e||a.uuid===e)return a;let o=n(a.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,n=e.objectName,i=e.propertyName,s=e.propertyIndex;if(t||(t=N.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let l=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===l){l=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let r=t[i];if(r===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+i+" but it wasn\'t found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}o=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(o=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};N.Composite=Fn;N.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};N.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};N.prototype.GetterByBindingType=[N.prototype._getValue_direct,N.prototype._getValue_array,N.prototype._getValue_arrayElement,N.prototype._getValue_toArray];N.prototype.SetterByBindingTypeAndVersioning=[[N.prototype._setValue_direct,N.prototype._setValue_direct_setNeedsUpdate,N.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[N.prototype._setValue_array,N.prototype._setValue_array_setNeedsUpdate,N.prototype._setValue_array_setMatrixWorldNeedsUpdate],[N.prototype._setValue_arrayElement,N.prototype._setValue_arrayElement_setNeedsUpdate,N.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[N.prototype._setValue_fromArray,N.prototype._setValue_fromArray_setNeedsUpdate,N.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var ka=new Float32Array(1);var Ti=new y,ze=new y,Q=class{constructor(t=new y,e=new y){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Ti.subVectors(t,this.start),ze.subVectors(this.end,this.start);let n=ze.dot(ze),s=ze.dot(Ti)/n;return e&&(s=Y(s,0,1)),s}closestPointToPoint(t,e,n){let i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ei}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ei);var Di=Math.pow(2,-24);var Bt=class{constructor(){}};function at(h,t,e){return e.min.x=t[h],e.min.y=t[h+1],e.min.z=t[h+2],e.max.x=t[h+3],e.max.y=t[h+4],e.max.z=t[h+5],e}function Vn(h){let t=-1,e=-1/0;for(let n=0;n<3;n++){let i=h[n+3]-h[n];i>e&&(e=i,t=n)}return t}function Hn(h,t){t.set(h)}function Gn(h,t,e){let n,i;for(let s=0;s<3;s++){let r=s+3;n=h[s],i=t[s],e[s]=n<i?n:i,n=h[r],i=t[r],e[r]=n>i?n:i}}function Se(h,t,e){for(let n=0;n<3;n++){let i=t[h+2*n],s=t[h+2*n+1],r=i-s,a=i+s;r<e[n]&&(e[n]=r),a>e[n+3]&&(e[n+3]=a)}}function ie(h){let t=h[3]-h[0],e=h[4]-h[1],n=h[5]-h[2];return 2*(t*e+e*n+n*t)}function ma(h,t){if(!h.index){let e=h.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i;e>65535?i=new Uint32Array(new n(4*e)):i=new Uint16Array(new n(2*e)),h.setIndex(new Z(i,1));for(let s=0;s<e;s++)i[s]=s}}function ga(h){if(!h.groups||!h.groups.length)return[{offset:0,count:h.index.count/3}];let t=[],e=new Set;for(let i of h.groups)e.add(i.start),e.add(i.start+i.count);let n=Array.from(e.values()).sort((i,s)=>i-s);for(let i=0;i<n.length-1;i++){let s=n[i],r=n[i+1];t.push({offset:s/3,count:(r-s)/3})}return t}function Xn(h,t,e,n,i=null){let s=1/0,r=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0,u=1/0,f=1/0,d=1/0,p=-1/0,g=-1/0,_=-1/0,m=i!==null;for(let v=t*6,x=(t+e)*6;v<x;v+=6){let S=h[v+0],M=h[v+1],b=S-M,w=S+M;b<s&&(s=b),w>o&&(o=w),m&&S<u&&(u=S),m&&S>p&&(p=S);let A=h[v+2],T=h[v+3],C=A-T,R=A+T;C<r&&(r=C),R>l&&(l=R),m&&A<f&&(f=A),m&&A>g&&(g=A);let P=h[v+4],I=h[v+5],U=P-I,F=P+I;U<a&&(a=U),F>c&&(c=F),m&&P<d&&(d=P),m&&P>_&&(_=P)}n[0]=s,n[1]=r,n[2]=a,n[3]=o,n[4]=l,n[5]=c,m&&(i[0]=u,i[1]=f,i[2]=d,i[3]=p,i[4]=g,i[5]=_)}function _a(h,t,e,n){let i=1/0,s=1/0,r=1/0,a=-1/0,o=-1/0,l=-1/0;for(let c=t*6,u=(t+e)*6;c<u;c+=6){let f=h[c+0];f<i&&(i=f),f>a&&(a=f);let d=h[c+2];d<s&&(s=d),d>o&&(o=d);let p=h[c+4];p<r&&(r=p),p>l&&(l=p)}n[0]=i,n[1]=s,n[2]=r,n[3]=a,n[4]=o,n[5]=l}function xa(h,t,e,n,i){let s=e,r=e+n-1,a=i.pos,o=i.axis*2;for(;;){for(;s<=r&&t[s*6+o]<a;)s++;for(;s<=r&&t[r*6+o]>=a;)r--;if(s<r){for(let l=0;l<3;l++){let c=h[s*3+l];h[s*3+l]=h[r*3+l],h[r*3+l]=c;let u=t[s*6+l*2+0];t[s*6+l*2+0]=t[r*6+l*2+0],t[r*6+l*2+0]=u;let f=t[s*6+l*2+1];t[s*6+l*2+1]=t[r*6+l*2+1],t[r*6+l*2+1]=f}s++,r--}else return s}}var St=32,ya=(h,t)=>h.candidate-t.candidate,Pt=new Array(St).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),We=new Float32Array(6);function va(h,t,e,n,i,s){let r=-1,a=0;if(s===0)r=Vn(t),r!==-1&&(a=(t[r]+t[r+3])/2);else if(s===1)r=Vn(h),r!==-1&&(a=Ma(e,n,i,r));else if(s===2){let o=ie(h),l=1.25*i,c=n*6,u=(n+i)*6;for(let f=0;f<3;f++){let d=t[f],_=(t[f+3]-d)/St;if(i<St/4){let m=[...Pt];m.length=i;let v=0;for(let S=c;S<u;S+=6,v++){let M=m[v];M.candidate=e[S+2*f],M.count=0;let{bounds:b,leftCacheBounds:w,rightCacheBounds:A}=M;for(let T=0;T<3;T++)A[T]=1/0,A[T+3]=-1/0,w[T]=1/0,w[T+3]=-1/0,b[T]=1/0,b[T+3]=-1/0;Se(S,e,b)}m.sort(ya);let x=i;for(let S=0;S<x;S++){let M=m[S];for(;S+1<x&&m[S+1].candidate===M.candidate;)m.splice(S+1,1),x--}for(let S=c;S<u;S+=6){let M=e[S+2*f];for(let b=0;b<x;b++){let w=m[b];M>=w.candidate?Se(S,e,w.rightCacheBounds):(Se(S,e,w.leftCacheBounds),w.count++)}}for(let S=0;S<x;S++){let M=m[S],b=M.count,w=i-M.count,A=M.leftCacheBounds,T=M.rightCacheBounds,C=0;b!==0&&(C=ie(A)/o);let R=0;w!==0&&(R=ie(T)/o);let P=1+1.25*(C*b+R*w);P<l&&(r=f,l=P,a=M.candidate)}}else{for(let x=0;x<St;x++){let S=Pt[x];S.count=0,S.candidate=d+_+x*_;let M=S.bounds;for(let b=0;b<3;b++)M[b]=1/0,M[b+3]=-1/0}for(let x=c;x<u;x+=6){let b=~~((e[x+2*f]-d)/_);b>=St&&(b=St-1);let w=Pt[b];w.count++,Se(x,e,w.bounds)}let m=Pt[St-1];Hn(m.bounds,m.rightCacheBounds);for(let x=St-2;x>=0;x--){let S=Pt[x],M=Pt[x+1];Gn(S.bounds,M.rightCacheBounds,S.rightCacheBounds)}let v=0;for(let x=0;x<St-1;x++){let S=Pt[x],M=S.count,b=S.bounds,A=Pt[x+1].rightCacheBounds;M!==0&&(v===0?Hn(b,We):Gn(b,We,We)),v+=M;let T=0,C=0;v!==0&&(T=ie(We)/o);let R=i-v;R!==0&&(C=ie(A)/o);let P=1+1.25*(T*v+C*R);P<l&&(r=f,l=P,a=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:r,pos:a}}function Ma(h,t,e,n){let i=0;for(let s=t,r=t+e;s<r;s++)i+=h[s*6+n*2];return i/e}function Sa(h,t){let e=h.attributes.position,n=h.index.array,i=n.length/3,s=new Float32Array(i*6),r=e.normalized,a=e.array,o=e.offset||0,l=3;e.isInterleavedBufferAttribute&&(l=e.data.stride);let c=["getX","getY","getZ"];for(let u=0;u<i;u++){let f=u*3,d=u*6,p,g,_;r?(p=n[f+0],g=n[f+1],_=n[f+2]):(p=n[f+0]*l+o,g=n[f+1]*l+o,_=n[f+2]*l+o);for(let m=0;m<3;m++){let v,x,S;r?(v=e[c[m]](p),x=e[c[m]](g),S=e[c[m]](_)):(v=a[p+m],x=a[g+m],S=a[_+m]);let M=v;x<M&&(M=x),S<M&&(M=S);let b=v;x>b&&(b=x),S>b&&(b=S);let w=(b-M)/2,A=m*2;s[d+A+0]=M+w,s[d+A+1]=w+(Math.abs(M)+w)*Di,M<t[m]&&(t[m]=M),b>t[m+3]&&(t[m+3]=b)}}return s}function ba(h,t){function e(m){f&&f(m/d)}function n(m,v,x,S=null,M=0){if(!p&&M>=o&&(p=!0,l&&(console.warn(`MeshBVH: Max depth of ${o} reached when generating BVH. Consider increasing maxDepth.`),console.warn(h))),x<=c||M>=o)return e(v+x),m.offset=v,m.count=x,m;let b=va(m.boundingData,S,r,v,x,u);if(b.axis===-1)return e(v+x),m.offset=v,m.count=x,m;let w=xa(a,r,v,x,b);if(w===v||w===v+x)e(v+x),m.offset=v,m.count=x;else{m.splitAxis=b.axis;let A=new Bt,T=v,C=w-v;m.left=A,A.boundingData=new Float32Array(6),Xn(r,T,C,A.boundingData,s),n(A,T,C,s,M+1);let R=new Bt,P=w,I=x-C;m.right=R,R.boundingData=new Float32Array(6),Xn(r,P,I,R.boundingData,s),n(R,P,I,s,M+1)}return m}ma(h,t);let i=new Float32Array(6),s=new Float32Array(6),r=Sa(h,i),a=h.index.array,o=t.maxDepth,l=t.verbose,c=t.maxLeafTris,u=t.strategy,f=t.onProgress,d=h.index.count/3,p=!1,g=[],_=ga(h);if(_.length===1){let m=_[0],v=new Bt;v.boundingData=i,_a(r,m.offset,m.count,s),n(v,m.offset,m.count,s),g.push(v)}else for(let m of _){let v=new Bt;v.boundingData=new Float32Array(6),Xn(r,m.offset,m.count,v.boundingData,s),n(v,m.offset,m.count,s),g.push(v)}return g}function Oi(h,t){let e=ba(h,t),n,i,s,r=[],a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let c=0;c<e.length;c++){let u=e[c],f=o(u),d=new a(32*f);n=new Float32Array(d),i=new Uint32Array(d),s=new Uint16Array(d),l(0,u),r.push(d)}return r;function o(c){return c.count?1:1+o(c.left)+o(c.right)}function l(c,u){let f=c/4,d=c/2,p=!!u.count,g=u.boundingData;for(let _=0;_<6;_++)n[f+_]=g[_];if(p){let _=u.offset,m=u.count;return i[f+6]=_,s[d+14]=m,s[d+15]=65535,c+32}else{let _=u.left,m=u.right,v=u.splitAxis,x;if(x=l(c+32,_),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[f+6]=x/4,x=l(x,m),i[f+7]=v,x}}}var j=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let s=0,r=t.length;s<r;s++){let o=t[s][e];n=o<n?o:n,i=o>i?o:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let s=0,r=e.length;s<r;s++){let a=e[s],o=t.dot(a);n=o<n?o:n,i=o>i?o:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}};j.prototype.setFromBox=function(){let h=new y;return function(e,n){let i=n.min,s=n.max,r=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){h.x=i.x*o+s.x*(1-o),h.y=i.y*l+s.y*(1-l),h.z=i.z*c+s.z*(1-c);let u=e.dot(h);r=Math.min(u,r),a=Math.max(u,a)}this.min=r,this.max=a}}();var Qa=function(){let h=new j;return function(e,n){let i=e.points,s=e.satAxes,r=e.satBounds,a=n.points,o=n.satAxes,l=n.satBounds;for(let c=0;c<3;c++){let u=r[c],f=s[c];if(h.setFromPoints(f,a),u.isSeparated(h))return!1}for(let c=0;c<3;c++){let u=l[c],f=o[c];if(h.setFromPoints(f,i),u.isSeparated(h))return!1}}}();var wa=function(){let h=new y,t=new y,e=new y;return function(i,s,r){let a=i.start,o=h,l=s.start,c=t;e.subVectors(a,l),h.subVectors(i.end,i.start),t.subVectors(s.end,s.start);let u=e.dot(c),f=c.dot(o),d=c.dot(c),p=e.dot(o),_=o.dot(o)*d-f*f,m,v;_!==0?m=(u*f-p*d)/_:m=0,v=(u+m*f)/d,r.x=m,r.y=v}}(),be=function(){let h=new O,t=new y,e=new y;return function(i,s,r,a){wa(i,s,h);let o=h.x,l=h.y;if(o>=0&&o<=1&&l>=0&&l<=1){i.at(o,r),s.at(l,a);return}else if(o>=0&&o<=1){l<0?s.at(0,a):s.at(1,a),i.closestPointToPoint(a,!0,r);return}else if(l>=0&&l<=1){o<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,a);return}else{let c;o<0?c=i.start:c=i.end;let u;l<0?u=s.start:u=s.end;let f=t,d=e;if(i.closestPointToPoint(u,!0,t),s.closestPointToPoint(c,!0,e),f.distanceToSquared(u)<=d.distanceToSquared(c)){r.copy(f),a.copy(u);return}else{r.copy(c),a.copy(d);return}}}}(),Bi=function(){let h=new y,t=new y,e=new ee,n=new Q;return function(s,r){let{radius:a,center:o}=s,{a:l,b:c,c:u}=r;if(n.start=l,n.end=c,n.closestPointToPoint(o,!0,h).distanceTo(o)<=a||(n.start=l,n.end=u,n.closestPointToPoint(o,!0,h).distanceTo(o)<=a)||(n.start=c,n.end=u,n.closestPointToPoint(o,!0,h).distanceTo(o)<=a))return!0;let g=r.getPlane(e);if(Math.abs(g.distanceToPoint(o))<=a){let m=g.projectPoint(o,t);if(r.containsPoint(m))return!0}return!1}}();var Aa=1e-15;function se(h){return Math.abs(h)<Aa}var tt=class extends rt{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new y),this.satBounds=new Array(4).fill().map(()=>new j),this.points=[this.a,this.b,this.c],this.sphere=new Me,this.plane=new ee,this.needsUpdate=!0}intersectsSphere(t){return Bi(t,this)}update(){let t=this.a,e=this.b,n=this.c,i=this.points,s=this.satAxes,r=this.satBounds,a=s[0],o=r[0];this.getNormal(a),o.setFromPoints(a,i);let l=s[1],c=r[1];l.subVectors(t,e),c.setFromPoints(l,i);let u=s[2],f=r[2];u.subVectors(e,n),f.setFromPoints(u,i);let d=s[3],p=r[3];d.subVectors(n,t),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};tt.prototype.closestPointToSegment=function(){let h=new y,t=new y,e=new Q;return function(i,s=null,r=null){let{start:a,end:o}=i,l=this.points,c,u=1/0;for(let f=0;f<3;f++){let d=(f+1)%3;e.start.copy(l[f]),e.end.copy(l[d]),be(e,i,h,t),c=h.distanceToSquared(t),c<u&&(u=c,s&&s.copy(h),r&&r.copy(t))}return this.closestPointToPoint(a,h),c=a.distanceToSquared(h),c<u&&(u=c,s&&s.copy(h),r&&r.copy(a)),this.closestPointToPoint(o,h),c=o.distanceToSquared(h),c<u&&(u=c,s&&s.copy(h),r&&r.copy(o)),Math.sqrt(u)}}();tt.prototype.intersectsTriangle=function(){let h=new tt,t=new Array(3),e=new Array(3),n=new j,i=new j,s=new y,r=new y,a=new y,o=new y,l=new Q,c=new Q,u=new Q;return function(d,p=null,g=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(h.copy(d),h.update(),d=h);let _=this.plane,m=d.plane;if(Math.abs(_.normal.dot(m.normal))>1-1e-10){let v=this.satBounds,x=this.satAxes;e[0]=d.a,e[1]=d.b,e[2]=d.c;for(let b=0;b<4;b++){let w=v[b],A=x[b];if(n.setFromPoints(A,e),w.isSeparated(n))return!1}let S=d.satBounds,M=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let b=0;b<4;b++){let w=S[b],A=M[b];if(n.setFromPoints(A,t),w.isSeparated(n))return!1}for(let b=0;b<4;b++){let w=x[b];for(let A=0;A<4;A++){let T=M[A];if(s.crossVectors(w,T),n.setFromPoints(s,t),i.setFromPoints(s,e),n.isSeparated(i))return!1}}return p&&(g||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let v=this.points,x=!1,S=0;for(let U=0;U<3;U++){let F=v[U],H=v[(U+1)%3];l.start.copy(F),l.end.copy(H),l.delta(r);let B=x?c.start:c.end,q=se(m.distanceToPoint(F));if(se(m.normal.dot(r))&&q){c.copy(l),S=2;break}if((m.intersectLine(l,B)||q)&&!se(B.distanceTo(H))){if(S++,x)break;x=!0}}if(S===1&&d.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(S!==2)return!1;let M=d.points,b=!1,w=0;for(let U=0;U<3;U++){let F=M[U],H=M[(U+1)%3];l.start.copy(F),l.end.copy(H),l.delta(a);let B=b?u.start:u.end,q=se(_.distanceToPoint(F));if(se(_.normal.dot(a))&&q){u.copy(l),w=2;break}if((_.intersectLine(l,B)||q)&&!se(B.distanceTo(H))){if(w++,b)break;b=!0}}if(w===1&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(w!==2)return!1;if(c.delta(r),u.delta(a),r.dot(a)<0){let U=u.start;u.start=u.end,u.end=U}let A=c.start.dot(r),T=c.end.dot(r),C=u.start.dot(r),R=u.end.dot(r),P=T<C,I=A<R;return A!==R&&C!==T&&P===I?!1:(p&&(o.subVectors(c.start,u.start),o.dot(r)>0?p.start.copy(c.start):p.start.copy(u.start),o.subVectors(c.end,u.end),o.dot(r)<0?p.end.copy(c.end):p.end.copy(u.end)),!0)}}}();tt.prototype.distanceToPoint=function(){let h=new y;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();tt.prototype.distanceToTriangle=function(){let h=new y,t=new y,e=["a","b","c"],n=new Q,i=new Q;return function(r,a=null,o=null){let l=a||o?n:null;if(this.intersectsTriangle(r,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let f,d=e[u],p=r[d];this.closestPointToPoint(p,h),f=p.distanceToSquared(h),f<c&&(c=f,a&&a.copy(h),o&&o.copy(p));let g=this[d];r.closestPointToPoint(g,h),f=g.distanceToSquared(h),f<c&&(c=f,a&&a.copy(g),o&&o.copy(h))}for(let u=0;u<3;u++){let f=e[u],d=e[(u+1)%3];n.set(this[f],this[d]);for(let p=0;p<3;p++){let g=e[p],_=e[(p+1)%3];i.set(r[g],r[_]),be(n,i,h,t);let m=h.distanceToSquared(t);m<c&&(c=m,a&&a.copy(h),o&&o.copy(t))}}return Math.sqrt(c)}}();var et=class{constructor(t,e,n){this.isOrientedBox=!0,this.min=new y,this.max=new y,this.matrix=new k,this.invMatrix=new k,this.points=new Array(8).fill().map(()=>new y),this.satAxes=new Array(3).fill().map(()=>new y),this.satBounds=new Array(3).fill().map(()=>new j),this.alignedSatBounds=new Array(3).fill().map(()=>new j),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};et.prototype.update=function(){return function(){let t=this.matrix,e=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let f=1*l|2*c|4*u,d=i[f];d.x=l?n.x:e.x,d.y=c?n.y:e.y,d.z=u?n.z:e.z,d.applyMatrix4(t)}let s=this.satBounds,r=this.satAxes,a=i[0];for(let l=0;l<3;l++){let c=r[l],u=s[l],f=1<<l,d=i[f];c.subVectors(a,d),u.setFromPoints(c,i)}let o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();et.prototype.intersectsBox=function(){let h=new j;return function(e){this.needsUpdate&&this.update();let n=e.min,i=e.max,s=this.satBounds,r=this.satAxes,a=this.alignedSatBounds;if(h.min=n.x,h.max=i.x,a[0].isSeparated(h)||(h.min=n.y,h.max=i.y,a[1].isSeparated(h))||(h.min=n.z,h.max=i.z,a[2].isSeparated(h)))return!1;for(let o=0;o<3;o++){let l=r[o],c=s[o];if(h.setFromBox(l,e),c.isSeparated(h))return!1}return!0}}();et.prototype.intersectsTriangle=function(){let h=new tt,t=new Array(3),e=new j,n=new j,i=new y;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(h.copy(r),h.update(),r=h);let a=this.satBounds,o=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let f=0;f<3;f++){let d=a[f],p=o[f];if(e.setFromPoints(p,t),d.isSeparated(e))return!1}let l=r.satBounds,c=r.satAxes,u=this.points;for(let f=0;f<3;f++){let d=l[f],p=c[f];if(e.setFromPoints(p,u),d.isSeparated(e))return!1}for(let f=0;f<3;f++){let d=o[f];for(let p=0;p<4;p++){let g=c[p];if(i.crossVectors(d,g),e.setFromPoints(i,t),n.setFromPoints(i,u),e.isSeparated(n))return!1}}return!0}}();et.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();et.prototype.distanceToPoint=function(){let h=new y;return function(e){return this.closestPointToPoint(e,h),e.distanceTo(h)}}();et.prototype.distanceToBox=function(){let h=["x","y","z"],t=new Array(12).fill().map(()=>new Q),e=new Array(12).fill().map(()=>new Q),n=new y,i=new y;return function(r,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(o||l)&&(r.getCenter(i),this.closestPointToPoint(i,n),r.closestPointToPoint(n,i),o&&o.copy(n),l&&l.copy(i)),0;let c=a*a,u=r.min,f=r.max,d=this.points,p=1/0;for(let _=0;_<8;_++){let m=d[_];i.copy(m).clamp(u,f);let v=m.distanceToSquared(i);if(v<p&&(p=v,o&&o.copy(m),l&&l.copy(i),v<c))return Math.sqrt(v)}let g=0;for(let _=0;_<3;_++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){let x=(_+1)%3,S=(_+2)%3,M=m<<x|v<<S,b=1<<_|m<<x|v<<S,w=d[M],A=d[b];t[g].set(w,A);let C=h[_],R=h[x],P=h[S],I=e[g],U=I.start,F=I.end;U[C]=u[C],U[R]=m?u[R]:f[R],U[P]=v?u[P]:f[R],F[C]=f[C],F[R]=m?u[R]:f[R],F[P]=v?u[P]:f[R],g++}for(let _=0;_<=1;_++)for(let m=0;m<=1;m++)for(let v=0;v<=1;v++){i.x=_?f.x:u.x,i.y=m?f.y:u.y,i.z=v?f.z:u.z,this.closestPointToPoint(i,n);let x=i.distanceToSquared(n);if(x<p&&(p=x,o&&o.copy(n),l&&l.copy(i),x<c))return Math.sqrt(x)}for(let _=0;_<12;_++){let m=t[_];for(let v=0;v<12;v++){let x=e[v];be(m,x,n,i);let S=n.distanceToSquared(i);if(S<p&&(p=S,o&&o.copy(n),l&&l.copy(i),S<c))return Math.sqrt(S)}}return Math.sqrt(p)}}();var qe=new y,Ye=new y,Ze=new y,zi=new O,ki=new O,Vi=new O,Hi=new y;function Ta(h,t,e,n,i,s){let r;return s===Ci?r=h.intersectTriangle(n,e,t,!0,i):r=h.intersectTriangle(t,e,n,s!==Ri,i),r===null?null:{distance:h.origin.distanceTo(i),point:i.clone()}}function Ea(h,t,e,n,i,s,r){qe.fromBufferAttribute(t,n),Ye.fromBufferAttribute(t,i),Ze.fromBufferAttribute(t,s);let a=Ta(h,qe,Ye,Ze,Hi,r);if(a){e&&(zi.fromBufferAttribute(e,n),ki.fromBufferAttribute(e,i),Vi.fromBufferAttribute(e,s),a.uv=rt.getUV(Hi,qe,Ye,Ze,zi,ki,Vi,new O));let o={a:n,b:i,c:s,normal:new y,materialIndex:0};rt.getNormal(qe,Ye,Ze,o.normal),a.face=o,a.faceIndex=n}return a}function Yn(h,t,e,n,i){let s=n*3,r=h.index.getX(s),a=h.index.getX(s+1),o=h.index.getX(s+2),l=Ea(e,h.attributes.position,h.attributes.uv,r,a,o,t);return l?(l.faceIndex=n,i&&i.push(l),l):null}function Gi(h,t,e,n,i,s){for(let r=n,a=n+i;r<a;r++)Yn(h,t,e,r,s)}function Wi(h,t,e,n,i){let s=1/0,r=null;for(let a=n,o=n+i;a<o;a++){let l=Yn(h,t,e,a);l&&l.distance<s&&(r=l,s=l.distance)}return r}function ct(h,t,e,n){let i=h.a,s=h.b,r=h.c,a=t,o=t+1,l=t+2;e&&(a=e.getX(t),o=e.getX(t+1),l=e.getX(t+2)),i.x=n.getX(a),i.y=n.getY(a),i.z=n.getZ(a),s.x=n.getX(o),s.y=n.getY(o),s.z=n.getZ(o),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l)}function Zn(h,t,e,n,i,s,r){let a=e.index,o=e.attributes.position;for(let l=h,c=t+h;l<c;l++)if(ct(r,l*3,a,o),r.needsUpdate=!0,n(r,l,i,s))return!0;return!1}var re=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function bt(h,t){return t[h+15]===65535}function zt(h,t){return t[h+6]}function oe(h,t){return t[h+14]}function ae(h){return h+8}function ce(h,t){return t[h+6]}function Xi(h,t){return t[h+7]}var le=new J,$e=new y,Ra=["x","y","z"];function Ke(h,t,e,n,i){let s=h*2,r=he,a=It,o=Lt;if(bt(s,a)){let c=zt(h,o),u=oe(s,a);Gi(t,e,n,c,u,i)}else{let c=ae(h);je(c,r,n,$e)&&Ke(c,t,e,n,i);let u=ce(h,o);je(u,r,n,$e)&&Ke(u,t,e,n,i)}}function Qe(h,t,e,n){let i=h*2,s=he,r=It,a=Lt;if(bt(i,r)){let l=zt(h,a),c=oe(i,r);return Wi(t,e,n,l,c)}else{let l=Xi(h,a),c=Ra[l],f=n.direction[c]>=0,d,p;f?(d=ae(h),p=ce(h,a)):(d=ce(h,a),p=ae(h));let _=je(d,s,n,$e)?Qe(d,t,e,n):null;if(_){let x=_.point[c];if(f?x<=s[p+l]:x>=s[p+l+3])return _}let v=je(p,s,n,$e)?Qe(p,t,e,n):null;return _&&v?_.distance<=v.distance?_:v:_||v||null}}var qi=function(){let h,t,e=[],n=new re(()=>new J);return function(...r){h=n.getPrimitive(),t=n.getPrimitive(),e.push(h,t);let a=i(...r);n.releasePrimitive(h),n.releasePrimitive(t),e.pop(),e.pop();let o=e.length;return o>0&&(t=e[o-1],h=e[o-2]),a};function i(s,r,a,o,l=null,c=0,u=0){function f(x){let S=x*2,M=It,b=Lt;for(;!bt(S,M);)x=ae(x),S=x*2;return zt(x,b)}function d(x){let S=x*2,M=It,b=Lt;for(;!bt(S,M);)x=ce(x,b),S=x*2;return zt(x,b)+oe(S,M)}let p=s*2,g=he,_=It,m=Lt;if(bt(p,_)){let x=zt(s,m),S=oe(p,_);return at(s,g,h),o(x,S,!1,u,c+s,h)}else{let x=ae(s),S=ce(s,m),M=x,b=S,w,A,T,C;if(l&&(T=h,C=t,at(M,g,T),at(b,g,C),w=l(T),A=l(C),A<w)){M=S,b=x;let B=w;w=A,A=B,T=C}T||(T=h,at(M,g,T));let R=bt(M*2,_),P=a(T,R,w,u+1,c+M),I;if(P===2){let B=f(M),nt=d(M)-B;I=o(B,nt,!0,u+1,c+M,T)}else I=P&&i(M,r,a,o,l,c,u+1);if(I)return!0;C=t,at(b,g,C);let U=bt(b*2,_),F=a(C,U,A,u+1,c+b),H;if(F===2){let B=f(b),nt=d(b)-B;H=o(B,nt,!0,u+1,c+b,C)}else H=F&&i(b,r,a,o,l,c,u+1);return!!H}}}(),Yi=function(){let h=new tt,t=new tt,e=new k,n=new et,i=new et;return function s(r,a,o,l,c=null){let u=r*2,f=he,d=It,p=Lt;if(c===null&&(o.boundingBox||o.computeBoundingBox(),n.set(o.boundingBox.min,o.boundingBox.max,l),c=n),bt(u,d)){let _=a,m=_.index,v=_.attributes.position,x=o.index,S=o.attributes.position,M=zt(r,p),b=oe(u,d);if(e.copy(l).invert(),o.boundsTree)return at(r,f,i),i.matrix.copy(e),i.needsUpdate=!0,o.boundsTree.shapecast({intersectsBounds:A=>i.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(l),A.b.applyMatrix4(l),A.c.applyMatrix4(l),A.needsUpdate=!0;for(let T=M*3,C=(b+M)*3;T<C;T+=3)if(ct(t,T,m,v),t.needsUpdate=!0,A.intersectsTriangle(t))return!0;return!1}});for(let w=M*3,A=b+M*3;w<A;w+=3){ct(h,w,m,v),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let T=0,C=x.count;T<C;T+=3)if(ct(t,T,x,S),t.needsUpdate=!0,h.intersectsTriangle(t))return!0}}else{let _=r+8,m=p[r+6];return at(_,f,le),!!(c.intersectsBox(le)&&s(_,a,o,l,c)||(at(m,f,le),c.intersectsBox(le)&&s(m,a,o,l,c)))}}}();function je(h,t,e,n){return at(h,t,le),e.intersectBox(le,n)}var Jn=[],Je,he,It,Lt;function ue(h){Je&&Jn.push(Je),Je=h,he=new Float32Array(h),It=new Uint16Array(h),Lt=new Uint32Array(h)}function we(){Je=null,he=null,It=null,Lt=null,Jn.length&&ue(Jn.pop())}var $n=Symbol("skip tree generation"),Kn=new J,Qn=new J,fe=new k,kt=new et,Ae=new et,Te=new y,tn=new y,Pa=new y,Ia=new y,La=new y,Zi=new J,mt=new re(()=>new tt),gt=class{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),gt.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e=de({cloneBuffers:!0},e);let n=t.geometry,i=t._roots,s=n.getIndex(),r;return e.cloneBuffers?r={roots:i.map(a=>a.slice()),index:s.array.slice()}:r={roots:i,index:s.array},r}static deserialize(t,e,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),gt.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});n=de({setIndex:!0},n);let{index:i,roots:s}=t,r=new gt(e,en(de({},n),{[$n]:!0}));if(r._roots=s,n.setIndex){let a=e.getIndex();if(a===null){let o=new Z(t.index,1,!1);e.setIndex(o)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return r}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[$n]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer=="undefined")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[$n]||(this._roots=Oi(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new J))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,n=e.index.array,i=e.attributes.position,s,r,a,o,l=0,c=this._roots;for(let f=0,d=c.length;f<d;f++)s=c[f],r=new Uint32Array(s),a=new Uint16Array(s),o=new Float32Array(s),u(0,l),l+=s.byteLength;function u(f,d,p=!1){let g=f*2;if(a[g+15]===65535){let m=r[f+6],v=a[g+14],x=1/0,S=1/0,M=1/0,b=-1/0,w=-1/0,A=-1/0;for(let T=3*m,C=3*(m+v);T<C;T++){let R=n[T],P=i.getX(R),I=i.getY(R),U=i.getZ(R);P<x&&(x=P),P>b&&(b=P),I<S&&(S=I),I>w&&(w=I),U<M&&(M=U),U>A&&(A=U)}return o[f+0]!==x||o[f+1]!==S||o[f+2]!==M||o[f+3]!==b||o[f+4]!==w||o[f+5]!==A?(o[f+0]=x,o[f+1]=S,o[f+2]=M,o[f+3]=b,o[f+4]=w,o[f+5]=A,!0):!1}else{let m=f+8,v=r[f+6],x=m+d,S=v+d,M=p,b=!1,w=!1;t?M||(b=t.has(x),w=t.has(S),M=!b&&!w):(b=!0,w=!0);let A=M||b,T=M||w,C=!1;A&&(C=u(m,d,M));let R=!1;T&&(R=u(v,d,M));let P=C||R;if(P)for(let I=0;I<3;I++){let U=m+I,F=v+I,H=o[U],B=o[U+3],q=o[F],nt=o[F+3];o[f+I]=H<q?H:q,o[f+I+3]=B>nt?B:nt}return P}}}traverse(t,e=0){let n=this._roots[e],i=new Uint32Array(n),s=new Uint16Array(n);r(0);function r(a,o=0){let l=a*2,c=s[l+15]===65535;if(c){let u=i[a+6],f=s[l+14];t(o,c,new Float32Array(n,a*4,6),u,f)}else{let u=a+32/4,f=i[a+6],d=i[a+7];t(o,c,new Float32Array(n,a*4,6),d)||(r(u,o+1),r(f,o+1))}}}raycast(t,e=On){let n=this._roots,i=this.geometry,s=[],r=e.isMaterial,a=Array.isArray(e),o=i.groups,l=r?e.side:e;for(let c=0,u=n.length;c<u;c++){let f=a?e[o[c].materialIndex].side:l,d=s.length;if(ue(n[c]),Ke(0,i,f,t,s),we(),a){let p=o[c].materialIndex;for(let g=d,_=s.length;g<_;g++)s[g].face.materialIndex=p}}return s}raycastFirst(t,e=On){let n=this._roots,i=this.geometry,s=e.isMaterial,r=Array.isArray(e),a=null,o=i.groups,l=s?e.side:e;for(let c=0,u=n.length;c<u;c++){let f=r?e[o[c].materialIndex].side:l;ue(n[c]);let d=Qe(0,i,f,t);we(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,r&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(t,e){let n=this.geometry,i=!1;for(let s of this._roots)if(ue(s),i=Yi(0,n,t,e),we(),i)break;return i}shapecast(t,e,n){let i=this.geometry;if(t instanceof Function){if(e){let f=e;e=(d,p,g,_)=>{let m=p*3;return f(d,m,m+1,m+2,g,_)}}t={boundsTraverseOrder:n,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let s=mt.getPrimitive(),{boundsTraverseOrder:r,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let f=o;o=(d,p,g,_,m)=>f(d,p,g,_,m)?!0:Zn(d,p,i,l,g,_,s)}else o||(l?o=(f,d,p,g)=>Zn(f,d,i,l,p,g,s):o=(f,d,p)=>p);let c=!1,u=0;for(let f of this._roots){if(ue(f),c=qi(0,i,a,o,r,u),we(),c)break;u+=f.byteLength}return mt.releasePrimitive(s),c}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:s}=n,r=this.geometry.index,a=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;fe.copy(e).invert();let c=mt.getPrimitive(),u=mt.getPrimitive();if(s){let d=function(p,g,_,m,v,x,S,M){for(let b=_,w=_+m;b<w;b++){ct(u,b*3,o,l),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let A=p,T=p+g;A<T;A++)if(ct(c,A*3,r,a),c.needsUpdate=!0,s(c,u,A,b,v,x,S,M))return!0}return!1};if(i){let p=i;i=function(g,_,m,v,x,S,M,b){return p(g,_,m,v,x,S,M,b)?!0:d(g,_,m,v,x,S,M,b)}}else i=d}t.getBoundingBox(Qn),Qn.applyMatrix4(e);let f=this.shapecast({intersectsBounds:d=>Qn.intersectsBox(d),intersectsRange:(d,p,g,_,m,v)=>(Kn.copy(v),Kn.applyMatrix4(fe),t.shapecast({intersectsBounds:x=>Kn.intersectsBox(x),intersectsRange:(x,S,M,b,w)=>i(d,p,x,S,_,m,b,w)}))});return mt.releasePrimitive(c),mt.releasePrimitive(u),f}intersectsBox(t,e){return kt.set(t.min,t.max,e),kt.needsUpdate=!0,this.shapecast({intersectsBounds:n=>kt.intersectsBox(n),intersectsTriangle:n=>kt.intersectsTriangle(n)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},s=0,r=1/0){t.boundingBox||t.computeBoundingBox(),kt.set(t.boundingBox.min,t.boundingBox.max,e),kt.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=t.attributes.position,u=t.index,f=mt.getPrimitive(),d=mt.getPrimitive(),p=tn,g=Pa,_=null,m=null;i&&(_=Ia,m=La);let v=1/0,x=null,S=null;return fe.copy(e).invert(),Ae.matrix.copy(fe),this.shapecast({boundsTraverseOrder:M=>kt.distanceToBox(M),intersectsBounds:(M,b,w)=>w<v&&w<r?(b&&(Ae.min.copy(M.min),Ae.max.copy(M.max),Ae.needsUpdate=!0),!0):!1,intersectsRange:(M,b)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:w=>Ae.distanceToBox(w),intersectsBounds:(w,A,T)=>T<v&&T<r,intersectsRange:(w,A)=>{for(let T=w*3,C=(w+A)*3;T<C;T+=3){ct(d,T,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let R=M*3,P=(M+b)*3;R<P;R+=3){ct(f,R,l,o),f.needsUpdate=!0;let I=f.distanceToTriangle(d,p,_);if(I<v&&(g.copy(p),m&&m.copy(_),v=I,x=R/3,S=T/3),I<s)return!0}}}});{let w=u?u.count:c.count;for(let A=0,T=w;A<T;A+=3){ct(d,A,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let C=M*3,R=(M+b)*3;C<R;C+=3){ct(f,C,l,o),f.needsUpdate=!0;let P=f.distanceToTriangle(d,p,_);if(P<v&&(g.copy(p),m&&m.copy(_),v=P,x=C/3,S=A/3),P<s)return!0}}}}}),mt.releasePrimitive(f),mt.releasePrimitive(d),v===1/0?null:(n.point?n.point.copy(g):n.point=g.clone(),n.distance=v,n.faceIndex=x,i&&(i.point?i.point.copy(m):i.point=m.clone(),i.point.applyMatrix4(fe),g.applyMatrix4(fe),i.distance=g.sub(i.point).length(),i.faceIndex=S),n)}closestPointToPoint(t,e={},n=0,i=1/0){let s=n*n,r=i*i,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(Te.copy(t).clamp(c.min,c.max),Te.distanceToSquared(t)),intersectsBounds:(c,u,f)=>f<a&&f<r,intersectsTriangle:(c,u)=>{c.closestPointToPoint(t,Te);let f=t.distanceToSquared(Te);return f<a&&(tn.copy(Te),a=f,o=u),f<s}}),a===1/0)return null;let l=Math.sqrt(a);return e.point?e.point.copy(tn):e.point=tn.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(n=>{at(0,new Float32Array(n),Zi),t.union(Zi)}),t}};var jn=self;jn.addEventListener("message",async function({data:h}){let t=performance.now();function e(a){let o=performance.now();(o-t>=10||a===1)&&(postMessage({error:void 0,serialized:void 0,position:void 0,progress:a}),t=o)}let{id:n,index:i,position:s,options:r}=h;try{let a=new te;if(a.setAttribute("position",new Z(s,3,!1)),i&&a.setIndex(new Z(i,1,!1)),r.includedProgressCallback&&(r.onProgress=e),r.groups){let c=r.groups;for(let u in c){let f=c[u];a.addGroup(f.start,f.count,f.materialIndex)}}let o=new gt(a,r),l=gt.serialize(o,{cloneBuffers:!1});jn.postMessage({id:n,error:void 0,serialized:l,position:s,progress:1},[l.index.buffer,s.buffer,...l.roots])}catch(a){jn.postMessage({id:n,error:a,serialized:void 0,position:void 0,progress:1})}});\n/*! Bundled license information:\n\nthree/build/three.module.js:\n  (**\n   * @license\n   * Copyright 2010-2024 Three.js Authors\n   * SPDX-License-Identifier: MIT\n   *)\n*/\n')}var EC=class{constructor(){this.running=!1,this.worker=new kN,this.worker.onerror=e=>{throw e.message?new Error(`[GenerateMeshBVHWorker] Could not create Web Worker with error "${e.message}"`):new Error("[GenerateMeshBVHWorker] Could not create Web Worker.")}}isRunning(){return this.running}generate(e,t={}){if(this.running)return void fe.warn("[GenerateMeshBVHWorker] Already running job.");if(!this.worker)return void fe.warn("[GenerateMeshBVHWorker] Worker has been disposed.");let{worker:n}=this;this.running=!0;let r=new Map;e.forEach((e=>{r.set(e.id,e)}));let i=0;return new Promise(((e,a)=>{let s=()=>{++i===r.size&&(this.running=!1,n.onmessage=null,e())};n.onerror=e=>{fe.warn(`[GenerateMeshBVHWorker] ${e.message}`),a(new Error(`[GenerateMeshBVHWorker] ${e.message}`)),this.running=!1},n.onmessage=e=>{this.running=!1;let{data:n}=e;if(n.error)fe.warn(n.error),s();else if(n.serialized){let{serialized:e,position:i,id:a}=n,o=r.get(a),l=dl.deserialize(e,o,{setIndex:!1}),h=Object.assign({setBoundingBox:!0},t);if(h.transferred&&(o.attributes.position.array=i),o.index)t.saveOriginalIndex&&!o.userData.originalIndex&&(o.userData.originalIndex=o.index.array),fe.debug("before update, index:",o.index.array),o.index.array=e.index;else{let t=new vn(e.index,1,!1);o.setIndex(t)}o.index&&(fe.debug("after update, index:",o.index.array),o.index.needsUpdate=!0),h.setBoundingBox&&!o.boundingBox&&(o.boundingBox=l.getBoundingBox(new Ft)),o.boundsTree=l,s()}else t.onProgress&&t.onProgress(n.progress)};for(let e of r){let r=e[0],i=e[1],a=i.index?i.index.array:void 0,o=i.attributes.position,l=o.array;if(o.isInterleavedBufferAttribute||a&&a.isInterleavedBufferAttribute){fe.warn("[GenerateMeshBVHWorker] InterleavedBufferAttribute are not supported for the geometry attributes."),s();continue}let h=[];t.transferred&&(h.push(l),a&&(h.push(a),t.saveOriginalIndex&&(i.userData.originalIndex=a.slice()))),n.postMessage({id:r,index:a,position:l,options:Ki(oi({},t),{onProgress:null,includedProgressCallback:Boolean(t.onProgress),groups:[...i.groups]})},h.length>0?h.map((e=>e.buffer)):[])}}))}dispose(){this.worker.terminate(),this.worker=void 0}},_C=class{constructor(e){this.running=!1,this.workers=[];let t=1;e?t=e:window.navigator&&(t=Math.max(t,window.navigator.hardwareConcurrency-1));for(let e=0;e<t;e++)this.workers[e]=new EC}isRunning(){return this.running}generate(e){return Et(this,arguments,(function*(e,t={}){if(this.running)fe.warn("[BVHHelper] Already running job.");else{if(0!==this.workers.length)return this.running=!0,new Promise((n=>{let r=this.workers.length,i=e.length,a=[],s=Math.floor(i/r),o=i%r,l=0,h=0;for(let n=0;n<r;n++){let r=this.workers[n];if(n<o?(l=n*s+n,h=l+s+1):(l=n*s+o,h=l+s),l=Math.min(l,i),h=Math.min(h,i),l>=h)break;fe.debug("startIndex: "+l+" endIndex: "+h),a.push(r.generate(e.slice(l,h),t))}Promise.allSettled(a).then((()=>{this.running=!1,n()}))}));fe.warn("[BVHHelper] Worker has been disposed.")}}))}dispose(){for(let e=0;e<this.workers.length;e++)this.workers[e].dispose();this.workers=[]}static createMeshBvhSync(e,t={}){let n=new Set;e.forEach((e=>{e.traverse((e=>{let r=e;if(r.isMesh&&r.geometry&&bi.isMergedMesh(r)&&!(r instanceof wo)){if(n.has(r.geometry.id))return;r.geometry.index&&t.saveOriginalIndex&&(r.geometry.userData.originalIndex=r.geometry.index.array.slice()),r.geometry.boundsTree=new dl(r.geometry,t),n.add(r.geometry.id)}}))}))}static createMeshBvhAsync(e,t={}){let n=new Set,r=[];e.forEach((e=>{e.traverse((e=>{let t=e;if(t.isMesh&&t.geometry&&bi.isMergedMesh(t)&&!(t instanceof wo)){if(n.has(t.geometry.id))return;r.push(t.geometry),n.add(t.geometry.id)}}))}));let i=new _C;return i.generate(r,t).then((()=>{i.dispose()}))}},TC,SC=new Te,wC=new Te,MC=new Te,qde=new Te,bdt=new Te,Edt=new Te,Aa=class extends Ei{constructor(e){super(Ct.guid()),this.needsFrustumCulled=!1,this.renderOrder=1e3,this.snapType="TripleCross",this.snapLineVisible=!1,this.snapType=e,this.drawSnapFunctions={TripleCross:this.drawTripleCorss.bind(this),Square:this.drawSquare.bind(this),Triangle:this.drawTriangle.bind(this),CircleWithCross:this.drawCircleWithCross.bind(this),Cross:this.drawCross.bind(this),Perpendicular:this.drawPerpendicular.bind(this)}}setSnapLineVisible(e){this.snapLineVisible=e}draw(e,t){this.osnapInfo&&(this.snapLineVisible&&this.drawSnapLine(e,t),e.save(),e.fillStyle=Aa.FILL_COLOR_NONE,e.strokeStyle=Aa.lineColor,e.lineWidth=Aa.lineWidth,e.beginPath(),this.drawSnapFunctions[this.snapType](e,t),TC&&this.drawDebug(e,t),e.closePath(),e.fill(),e.stroke(),e.restore())}drawDebug(e,t){null==TC||TC.forEach((n=>{let r=this.transToScreenCoord(n.start,t),i=this.transToScreenCoord(n.end,t);e.moveTo(r.x,r.y),e.lineTo(i.x,i.y)}))}drawSelect(e,t){}isPointInPath(e){return!1}drawSnapLine(e,t){e.save(),e.strokeStyle=Aa.SNAP_LINE_COLOR,e.lineWidth=Aa.lineWidth;let n=this.osnapInfo.line;if(!n)return;let r=this.transToScreenCoord(n.start,t),i=this.transToScreenCoord(n.end,t);e.moveTo(r.x,r.y),e.lineTo(i.x,i.y),e.stroke(),e.restore()}drawTripleCorss(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize/1.6,i=SC.set(n.x,n.y-r),a=wC.set(n.x-.87*r,n.y+r/1.4),s=MC.set(n.x+.87*r,n.y+r/1.4);e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.moveTo(n.x,n.y),e.lineTo(s.x,s.y)}drawSquare(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize,i=Aa.iconSize;e.rect(n.x-r/2,n.y-i/2,r,i)}drawTriangle(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize/1.6,i=SC.set(n.x,n.y-r),a=wC.set(n.x-.87*r,n.y+r/2),s=MC.set(n.x+.87*r,n.y+r/2);e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.lineTo(s.x,s.y)}drawCircleWithCross(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize/2;e.arc(n.x,n.y,r,0,2*Math.PI),e.moveTo(n.x-r/1.8,n.y),e.lineTo(n.x+r/1.8,n.y),e.moveTo(n.x,n.y-r/1.8),e.lineTo(n.x,n.y+r/1.8)}drawCross(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize/2,i=SC.set(n.x-r,n.y-r),a=wC.set(n.x+r,n.y+r),s=MC.set(n.x+r,n.y-r),o=qde.set(n.x-r,n.y+r);e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y)}drawPerpendicular(e,t){let n=this.transToScreenCoord(this.osnapInfo.point,t),r=Aa.iconSize/2,i=SC.set(n.x,n.y),a=wC.set(n.x-r,n.y),s=MC.set(n.x,n.y+r),o=qde.set(n.x-r,n.y-r),l=bdt.set(n.x-r,n.y+r),h=Edt.set(n.x+r,n.y+r);e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.lineTo(s.x,s.y),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.lineTo(h.x,h.y),e.lineTo(o.x,o.y)}update(e){this.osnapInfo=e}getClassType(){return"SnapDrawable"}},Bi=Aa;Bi.lineColor="rgba(255, 119, 0, 1)",Bi.FILL_COLOR_NONE="rgba(0, 0, 0, 0)",Bi.SNAP_LINE_COLOR="rgba(255, 240, 0, 0.3)",Bi.lineWidth=2,Bi.iconSize=14,xn._registerDrawableClass(Bi);var FN=(e=>(e[e.None=0]="None",e[e.Vertex=1]="Vertex",e[e.MiddlePoint=2]="MiddlePoint",e[e.Edge=4]="Edge",e[e.Face=8]="Face",e[e.FootOfPerpendicular=16]="FootOfPerpendicular",e[e.Intersection=32]="Intersection",e[e.CircleCenter=64]="CircleCenter",e))(FN||{}),_dt=1e-5,ii=new q,_s=new q,b0=new q,ab=new q,Kd=new At,ob=new xs;function Tdt(e,t){let n=Number.MAX_VALUE,r=0;for(let i=0;i<e.vertices.length;i++){let a=t.distanceTo(e.vertices[i]);a<n&&(r=i,n=a)}return{vertex:e.vertices[r],distance:n}}function Sdt(e){if(!(e.object instanceof Jt&&e.face))return;let t=e.object,n=t.geometry.attributes.position,r=t.geometry.index;if(n.count<3)return;let i=bi.getBatchByFaceIndex(t,e.faceIndex);t.geometry.boundsTree&&(r=new vn(t.geometry.userData.originalIndex,1,!1)),Kd.identity(),t instanceof wo&&void 0!==e.instanceId&&t.getMatrixAt(e.instanceId,Kd),Kd.premultiply(t.matrixWorld);let a,s=t.geometry.drawRange,o=n.array;if(r){let e=Math.max(0,s.start),t=Math.min(r.count,s.start+s.count);if(a=r.array,i){e=Math.max(e,i.indexStart),t=Math.min(t,i.indexStart+i.indexCount),a=r.array.slice(e,t),o=n.array.slice(3*i.positionStart,3*(i.positionStart+i.positionCount));for(let e=0;e<a.length;e++)a[e]=a[e]-i.positionStart}else(0!==e||t!==r.count)&&(a=r.array.slice(e,t))}else{let e=Math.max(0,s.start),t=Math.min(n.count,s.start+s.count);i?(e=Math.max(e,i.positionStart),t=Math.min(t,i.positionStart+i.positionCount),o=n.array.slice(3*i.positionStart,3*(i.positionStart+i.positionCount))):(0!==e||t!==n.count)&&(o=n.array.slice(3*e,3*t));let r=o.length/3;a=r>65535?new Uint32Array(r):new Uint16Array(r);for(let e=0,t=r;e<t;e++)a[e]=e}let l=WM.buildEdge(o,a,20),h=Number.MAX_VALUE,u=0;for(let t=0;t<l.length;t+=2){let n=l[t],r=l[t+1];ii.set(o[3*n],o[3*n+1],o[3*n+2]),ii.applyMatrix4(Kd),_s.set(o[3*r],o[3*r+1],o[3*r+2]),_s.applyMatrix4(Kd),ob.set(ii,_s),ob.closestPointToPoint(e.point,!0,b0);let i=e.point.distanceTo(b0);i<h&&(u=t,h=i,ab.copy(b0))}let c=l[u],d=l[u+1];return ii.set(o[3*c],o[3*c+1],o[3*c+2]),ii.applyMatrix4(Kd),_s.set(o[3*d],o[3*d+1],o[3*d+2]),_s.applyMatrix4(Kd),{vertices:[ii.clone(),_s.clone()],vertex:ab.clone(),distance:h}}var AC=class{constructor(e){var t;this.drawableList=new $a("snap"),this.markers={},this.activeOSnapType=0,this.snapToleranceInWorldCoord=1,this.intersectionLimit=10,this.osnapTypePriorities={1:0,2:1,64:2,32:3,16:4,4:5,8:6,0:100},this.enabledOSnapTypes=127,this.overlayRender=e,null==(t=this.overlayRender)||t.addDrawableList(this.drawableList),this.initOSnapMarkers()}initOSnapMarkers(){let e=new Bi("TripleCross"),t=new Bi("Square"),n=new Bi("Triangle"),r=new Bi("CircleWithCross"),i=new Bi("Cross"),a=new Bi("Perpendicular");this.markers[1]=t,this.markers[2]=n,this.markers[4]=e,this.markers[32]=i,this.markers[64]=r,this.markers[16]=a,Object.values(this.markers).forEach((e=>{e.visible=!1,this.drawableList.addDrawable(e)}))}isOSnapTypeEnabled(e){return!!(this.enabledOSnapTypes&e)}setOSnapTypeEnabled(e,t){if(t)this.enabledOSnapTypes|=e;else{let t=~e;this.enabledOSnapTypes&=t}}setSnapTolerance(e){this.snapToleranceInWorldCoord=e}getSnapTolerance(){return this.snapToleranceInWorldCoord}setIntersectionLimit(e){this.intersectionLimit=e}getIntersectionLimit(){return this.intersectionLimit}getMarkerLineColor(){return cn.colorStr2Rgba(Bi.lineColor)}setMarkerLineColor(e){Bi.lineColor=cn.rgba2Color(e)}getMarkerLineWidth(){return Bi.lineWidth}setMarkerLineWidth(e){Bi.lineWidth=e}getMarkerIconSize(){return Bi.iconSize}setMarkerIconSize(e){Bi.iconSize=e}getMarker(e){return this.markers[e]}setAllSnapLinesVisible(e){Object.values(this.markers).forEach((t=>{t.setSnapLineVisible(e)}))}deactivate(){var e;this.activeOSnapType&&(this.markers[this.activeOSnapType].visible=!1,null==(e=this.overlayRender)||e.render()),this.activeOSnapType=0}destroy(){}handleSnap(e,t,n){if(!e||e.length<1)return void this.deactivate();fe.debug("[OSnap] intersections before handleSnap:",e);let r,i=[],a=!1;for(let t of e)t.object instanceof Jt?(r||(r=t.point),!a&&"groundPlane"!==t.object.name&&(i.push(t),a=!0)):i.push(t);if(!t&&r){r.setZ(0);for(let e of i)e.point.z=0,e.distance=e.point.distanceTo(r);let e=e=>e instanceof Ni?0:e instanceof ni?2:e instanceof ti?1:3;i.sort(((t,n)=>{let r=e(t.object),i=e(n.object);return r!==i?r-i:t.distance-n.distance}))}r||(fe.warn("[OSnap] Potential to produce erroneous snap results"),r=i[0].point),fe.debug("[OSnap] intersections:",i),fe.debug("[OSnap] mousePosition:",r);let s=this.getSnapPointAndUpdateMarker(r,i,t,n);return(null==s?void 0:s.clone())||r}getSnapPointAndUpdateMarker(e,t,n,r){if(!t.length)return void this.activateMarker(0);let i=this.getSnapInfo(e,t,n,r);if(i&&0!==i.type)return this.activateMarker(i.type,i),i.point;this.activateMarker(0)}activateMarker(e,t){var n;this.activeOSnapType&&(this.markers[this.activeOSnapType].visible=!1),this.activeOSnapType=e;let r=this.markers[e];r&&t&&(r.update(t),r.visible=!0),null==(n=this.overlayRender)||n.render()}getFootOfPerpendicular(e,t,n=_dt){let{start:r,end:i}=t,a=r.x-i.x,s=r.y-i.y,o=r.z-i.z;if(r.distanceTo(i)<n)return r.clone();let l=(e.x-r.x)*(r.x-i.x)+(e.y-r.y)*(r.y-i.y)+(e.z-r.z)*(r.z-i.z);return l/=a*a+s*s+o*o,new q(r.x+l*a,r.y+l*s,r.z+l*o)}getSnapInfo(e,t,n,r){let i=2*this.snapToleranceInWorldCoord;fe.debug("[OSnap] snap radius:",i);let a=[],s={line:void 0},o=this.osnapTypePriorities[0];for(let l=0;l<t.length&&l<this.intersectionLimit;++l){let h,u=t[l],c=u.object;c instanceof Jt?h=this.getOsnapInfoListFromMesh(e,u,i,o):c instanceof ti?h=this.getOsnapInfoListFromLine(e,u,n,i,s,o,r):c instanceof Ni&&(h=this.getOsnapInfoListFromPoint(e,u,n,i,o)),h&&(o=this.osnapTypePriorities[h.type],a.push(h))}if(0!==a.length)return a.sort(((e,t)=>{let n=this.osnapTypePriorities[e.type],r=this.osnapTypePriorities[t.type];return n!==r?n-r:e.distance-t.distance})),a[0]}getOsnapInfoListFromMesh(e,t,n,r){if(r<this.osnapTypePriorities[1])return;let i=Date.now(),a=Sdt(t);if(!a)return void fe.warn("[OSnap] Failed to get edge !");let s=Date.now();fe.debug(`[OSnap] getEdgeSnappingInfo took ${(s-i)/1e3}s `),fe.debug("[OSnap] edge:",a);let o=Tdt(a,e);if(fe.debug("[OSnap] vertex:",o),o.distance<=n&&this.isOSnapTypeEnabled(1))return{distance:o.distance,type:1,point:o.vertex};if(a.distance<=n){if(this.isOSnapTypeEnabled(2)&&r<this.osnapTypePriorities[2])return;ii.copy(a.vertices[0]),ii.add(a.vertices[1]),ii.divideScalar(2);let t=ii.distanceTo(e);return t<=n&&this.isOSnapTypeEnabled(2)?{distance:t,type:2,point:ii.clone()}:!this.isOSnapTypeEnabled(4)||r<this.osnapTypePriorities[4]?void 0:{distance:a.distance,type:4,point:a.vertex,line:{start:a.vertices[0],end:a.vertices[1]}}}fe.debug("[OSnap] Face")}getOsnapInfoFromSegment(e,t,n,r,i,a,s){let o={start:t,end:n};if(s&&a>=this.osnapTypePriorities[16]&&this.isOSnapTypeEnabled(16)){let t=this.getFootOfPerpendicular(s,o,r),n=e.distanceTo(t);if(n<=r)return{distance:Bt.floorNumber(n,7),type:16,point:t.clone()}}if(a<this.osnapTypePriorities[1])return;ob.set(t,n),ob.closestPointToPoint(e,!0,b0);let l=e.distanceTo(b0);if(l>r)return;let h=e.distanceTo(t),u=e.distanceTo(n);if(Math.min(h,u)<=r&&this.isOSnapTypeEnabled(1)){let e=h,r=t;return u<h&&(e=u,r=n),{distance:Bt.floorNumber(e,7),type:1,point:r.clone()}}if(a<this.osnapTypePriorities[2])return;ob.getCenter(ab);let c=e.distanceTo(ab);if(c<r&&this.isOSnapTypeEnabled(2))return{point:ab.clone(),distance:Bt.floorNumber(c,7),type:2};if(!(a<this.osnapTypePriorities[4])){if(i.line&&this.isOSnapTypeEnabled(32)){let t=Gt.getLineSegmentsIntersectingPoint(i.line,o);if(!t)return;let n=e.distanceTo(t)/2;return n<r?(i.line=void 0,{point:t.clone(),distance:Bt.floorNumber(n,7),type:32}):void 0}if(this.isOSnapTypeEnabled(4))return i.line={start:t.clone(),end:n.clone()},{point:b0.clone(),distance:Bt.floorNumber(l,7),type:4,line:{start:t.clone(),end:n.clone()}}}}getOsnapInfoListFromLine(e,t,n,r,i,a,s){let o=[],l=t.object,h=l instanceof ni?2:1,u=l.geometry.index,c=l.geometry.attributes.position,d=l.geometry.drawRange,p=bi.getBatchByLineIndex(l,t.index);if(u){let t=Math.max(0,d.start),f=Math.min(u.count,d.start+d.count);p&&(t=Math.max(t,p.indexStart),f=Math.min(f,p.indexStart+p.indexCount));for(let d=t,p=f;d<p-1;d+=h){let t=u.getX(d),h=u.getX(d+1);ii.fromBufferAttribute(c,t),_s.fromBufferAttribute(c,h),ii.applyMatrix4(l.matrixWorld),_s.applyMatrix4(l.matrixWorld),n||(ii.setZ(0),_s.setZ(0));let p=this.getOsnapInfoFromSegment(e,ii,_s,r,i,a,s);p&&(a=this.osnapTypePriorities[p.type],o.push(p))}}else{let t=Math.max(0,d.start),u=Math.min(c.count,d.start+d.count);p&&(t=Math.max(t,p.positionStart),u=Math.min(u,p.positionStart+p.positionCount));for(let d=t,p=u;d<p-1;d+=h){ii.fromBufferAttribute(c,d),_s.fromBufferAttribute(c,d+1),ii.applyMatrix4(l.matrixWorld),_s.applyMatrix4(l.matrixWorld),n||(ii.setZ(0),_s.setZ(0));let t=this.getOsnapInfoFromSegment(e,ii,_s,r,i,a,s);t&&(a=this.osnapTypePriorities[t.type],o.push(t))}}if(0!==o.length)return o.sort(((e,t)=>{let n=this.osnapTypePriorities[e.type],r=this.osnapTypePriorities[t.type];return n!==r?n-r:e.distance-t.distance})),o[0]}getOsnapInfoListFromPoint(e,t,n,r,i){if(i<this.osnapTypePriorities[1])return;let a=t.object,s=a.geometry.getAttribute("position");ii.fromBufferAttribute(s,t.index),ii.applyMatrix4(a.matrixWorld),_s.copy(e),n||(ii.setZ(0),_s.setZ(0));let o=_s.distanceTo(ii);if(o>r)return;let l={distance:o,point:ii.clone(),type:1};if("CircleCenter"===a.userData.type){if(!this.isOSnapTypeEnabled(64))return;l.type=64}else if(fe.debug("[OSnap] Other types of vertices !"),!this.isOSnapTypeEnabled(1))return;return l}getIntersectsIncludeOutline(e,t){let n=e.slice(),r=[];for(let t=0;t<e.length&&t<this.intersectionLimit;t++){let n=e[t].object;if(n.updateWorldMatrix(!0,!1),n instanceof Jt&&!yr.hasOutline(n,!1)){let e=yr.createOutline(n.geometry);e.visible=!1,n.add(e),e.updateWorldMatrix(!0,!1),r.push(e)}}let i=[];return r.length>0&&(i=t.intersectObjects(r)||[],fe.debug("[OSnap] Intersected with newly created edges: ",i),i.length>0&&n.push(...i)),n.sort(((e,t)=>e.distance-t.distance)),n}},pc=class{constructor(e,t,n){this.follow=e=>{this.node.style.left=e.offsetX+15+"px",this.node.style.top=e.offsetY-30+"px"},this.show=()=>this.node.hasAttribute("hidden")&&this.node.removeAttribute("hidden"),this.hide=()=>!this.node.hasAttribute("hidden")&&this.node.setAttribute("hidden",""),this.destroy=()=>{this.target?this.target.removeEventListener("mousemove",this.follow):document.removeEventListener("mousemove",this.follow),this.parentNode.removeChild(this.node)},this.node=document.createElement("div"),this.node.id=e,t&&this.node.append(t),this.childNode=document.createElement("div"),this.target=null==n?void 0:n.target,this.parentNode=(null==n?void 0:n.parentNode)||document.body,null!=n&&n.followPointer&&(this.node.classList.add("follow-tooltip"),this.target?this.target.addEventListener("mousemove",this.follow):document.addEventListener("mousemove",this.follow)),this.parentNode.appendChild(this.node),(null==n||!n.showOnCreate)&&this.node.setAttribute("hidden","")}setContent(e){this.node.textContent&&(this.node.textContent=null);for(let e=0;e<this.node.children.length;++e){let t=this.node.children[e];this.node.removeChild(t)}this.node.append(e),this.node.appendChild(this.childNode)}updateChildContent(e){this.childNode.textContent&&(this.childNode.textContent=null);for(let e=0;e<this.node.children.length;++e){let t=this.node.children[e];this.node.removeChild(t)}this.childNode.append(e)}},CC=class{constructor(e){this.active=!1,this.isResolvedOrRejected=!1,this.mouseClicked=e=>{if(e.markupData){let t=e.markupData.id,n=this.viewer.getOverlayRender().getDrawableById(t);if(n){let e=n.getBounds();e=e.clone().expandByScalar(20*this.viewer.getPixelSizeInWorldCoord());let t=mn.world2NormalizedScreen(e.min,this.camera,this.viewerContainer),r=mn.world2NormalizedScreen(e.max,this.camera,this.viewerContainer),i=new Vr(new Te(Math.min(t.x,r.x),Math.min(t.y,r.y)),new Te(Math.max(t.x,r.x),Math.max(t.y,r.y)));i.min.x=Math.max(i.min.x,0)*this.viewerContainer.clientWidth,i.min.y=Math.max(i.min.y,0)*this.viewerContainer.clientHeight,i.max.x=Math.min(i.max.x,1)*this.viewerContainer.clientWidth,i.max.y=Math.min(i.max.y,1)*this.viewerContainer.clientHeight,this.resolve&&(this.resolve(i),this.isResolvedOrRejected=!0),this.deactivate();let a=this.viewer;"function"==typeof a.clearSelection&&a.clearSelection()}}},this.keydown=e=>{"Escape"===e.code&&this.deactivate()},this.viewer=e}get viewerContainer(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}isActive(){return this.active}activate(){var e,t;if(this.isActive())return void(this.reject&&(this.deactivate(),this.reject("PickMarkupHelper is already actived!"),this.isResolvedOrRejected=!0));this.active=!0,this.viewer.addEventListener("mouseclick",this.mouseClicked),null==(e=this.viewer.getInputManager())||e.addEventListener("keydown",this.keydown),this.tooltip=new pc("pick-markup-tooltip",Gr("Tooltip.pickMarkup"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewerContainer});let n=document.getElementById("pick-markup-tooltip");n&&(n.style.pointerEvents="none");let r=Gr("Tooltip.pickMarkup");r&&this.tooltip&&(null==(t=this.tooltip)||t.setContent(r)),this.viewer.dispatchEvent("pickmarkupactivate")}deactivate(){var e,t,n;this.active=!1,this.viewer.removeEventListener("mouseclick",this.mouseClicked),null==(e=this.viewer.getInputManager())||e.removeEventListener("keydown",this.keydown),null==(t=this.tooltip)||t.hide(),null==(n=this.tooltip)||n.destroy(),this.tooltip=void 0,this.viewer.dispatchEvent("pickmarkupdeactivate"),this.resolve&&!this.isResolvedOrRejected&&(this.resolve(void 0),this.isResolvedOrRejected=!0)}pick(){return Et(this,null,(function*(){return new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.activate()}))}))}destroy(){this.deactivate(),this.isResolvedOrRejected||this.reject&&this.reject("PickMarkupHelper is not done for some reason!")}},RC=class{constructor(e){this.mouseDown=!1,this.mouseMove=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.tempEnableRotate=!1,this.active=!1,this.isResolvedOrRejected=!1,this.mousedown=e=>{var t,n;if(0===e.button){this.mouseDown=!0;let r=new Te(e.x,e.y);this.mouseDownPositionX=r.x,this.mouseDownPositionY=r.y,null==(t=this.tooltip)||t.hide(),null==(n=this.tooltip)||n.destroy(),this.tooltip=void 0}},this.mousemove=e=>{if(!this.mouseDown)return;let t=new Te(e.x,e.y);if(this.mouseDownPositionX>=0&&this.mouseDownPositionY>=0&&(Math.abs(t.x-this.mouseDownPositionX)>=5||Math.abs(t.y-this.mouseDownPositionY)>=5)){this.mouseMove=!0;let e=new Te(Math.min(this.mouseDownPositionX,t.x),Math.min(this.mouseDownPositionY,t.y)),n=new Te(Math.max(this.mouseDownPositionX,t.x),Math.max(this.mouseDownPositionY,t.y));this.drawRect(e,n)}},this.mouseup=e=>{if(this.mouseDown&&this.mouseMove){let t=new Te(e.x,e.y),n=new Te(Math.min(this.mouseDownPositionX,t.x),Math.min(this.mouseDownPositionY,t.y)),r=new Te(Math.max(this.mouseDownPositionX,t.x),Math.max(this.mouseDownPositionY,t.y)),i=new Vr(n,r);this.resolve&&(this.resolve(i),this.isResolvedOrRejected=!0),this.deactivate(),this.setRectDomVisible(!1)}this.mouseDown=!1,this.mouseMove=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1},this.keydown=e=>{"Escape"===e.code&&this.deactivate()},this.viewer=e,this.input=e.getInputManager()}get viewerContainer(){return this.viewer.viewerContainer}isActive(){return this.active}activate(){var e;if(this.isActive())return void(this.reject&&(this.deactivate(),this.reject("BoxSelectHelper is already actived!"),this.isResolvedOrRejected=!0));this.active=!0,this.input.addEventListener("pointerdown",this.mousedown),this.input.addEventListener("pointermove",this.mousemove),this.input.addEventListener("pointerup",this.mouseup),this.input.addEventListener("keydown",this.keydown),this.viewer.getCameraManager().enableMouseLeft(!1),this.tooltip=new pc("box-select-tooltip",Gr("Tooltip.boxSelect"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewerContainer});let t=document.getElementById("box-select-tooltip");t&&(t.style.pointerEvents="none");let n=Gr("Tooltip.boxSelect");n&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(n)),this.viewer.dispatchEvent("boxselectactivate")}deactivate(){var e,t;this.active=!1,this.input.removeEventListener("pointerdown",this.mousedown),this.input.removeEventListener("pointermove",this.mousemove),this.input.removeEventListener("pointerup",this.mouseup),this.input.removeEventListener("keydown",this.keydown),null==(e=this.tooltip)||e.hide(),null==(t=this.tooltip)||t.destroy(),this.tooltip=void 0,this.viewer.getCameraManager().enableMouseLeft(!0),this.viewer.dispatchEvent("boxselectdeactivate"),this.resolve&&!this.isResolvedOrRejected&&(this.resolve(void 0),this.isResolvedOrRejected=!0)}drawRect(e,t){this.rectDom||(this.rectDom=document.createElement("div"),this.rectDom.style.cssText=`position: absolute;border: ${RC.BORDER_WIDTH} solid ${RC.BORDER_COLOR};`,this.viewerContainer.appendChild(this.rectDom)),this.setRectDomVisible(!0),this.rectDom.style.left=`${e.x}px`,this.rectDom.style.top=`${e.y}px`;let n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);this.rectDom.style.width=`${n}px`,this.rectDom.style.height=`${r}px`}setRectDomVisible(e){this.rectDom&&(this.rectDom.style.display=e?"inline-block":"none")}select(){return Et(this,null,(function*(){return new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.activate()}))}))}destroy(){var e;this.deactivate(),null==(e=this.rectDom)||e.remove(),this.rectDom=void 0,this.isResolvedOrRejected||this.reject&&this.reject("BoxSelectHelper is not done for some reason!")}},Gh=RC;Gh.BORDER_COLOR="#fff000",Gh.BORDER_WIDTH="2px";var PC=class{constructor(e){this.active=!1,this.viewer=e,this.boxSelectHelper=new Gh(e)}get viewerContainer(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}isActive(){return this.active}activate(){var e;this.active=!0,null==(e=this.boxSelectHelper)||e.select().then((e=>{e&&this.handleZoomToRect(e.min,e.max)}))}deactivate(){var e;this.active=!1,null==(e=this.boxSelectHelper)||e.deactivate()}pickPositionByScreenPoint(e){var t;return null==(t=this.viewer.pickObject(e))?void 0:t.point}handleZoomToRect(e,t){let n=this.pickPositionByScreenPoint(e),r=this.pickPositionByScreenPoint(t);if(n&&r){let e=new q(Math.min(n.x,r.x),Math.min(n.y,r.y),Math.min(n.z,r.z)),t=new q(Math.max(n.x,r.x),Math.max(n.y,r.y),Math.max(n.z,r.z)),i=new Ft(e,t);this.viewer.zoomToBBox(i)}}destroy(){var e;null==(e=this.boxSelectHelper)||e.destroy(),this.boxSelectHelper=void 0}},IC=class extends Ei{constructor(e){super("MobileHelper"),this.needsFrustumCulled=!1,this.renderOrder=1e3,this.position=e}setPosition(e){this.position=e}isPointInPath(e,t){return!1}draw(e,t){this.drawInnerCircle(e),this.drawOuterRing(e),this.drawSnapTriangle(e)}drawInnerCircle(e){let{x:t,y:n}=this.position;e.save(),e.fillStyle="rgba(137, 137, 138, 0.8)",e.beginPath(),e.arc(t,n,25,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}drawOuterRing(e){let{x:t,y:n}=this.position;e.save(),e.strokeStyle="rgba(17, 17, 19, 0.8)",e.lineWidth=10,e.beginPath(),e.arc(t,n,30,0,2*Math.PI),e.closePath(),e.stroke(),e.restore(),e.save(),e.strokeStyle="rgba(173, 173, 174, 0.8)",e.lineWidth=3,e.beginPath(),e.arc(t,n,35,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}drawSnapTriangle(e){let{x:t,y:n}=this.position;e.save(),e.fillStyle="rgba(17, 17, 19, 0.8)",e.strokeStyle="rgba(137, 137, 138, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(t-35,n-35),e.lineTo(t-35+12,n-35),e.lineTo(t-35,n-35+12),e.closePath(),e.fill(),e.stroke(),e.restore()}translate(e,t){this.position.add(new Te(e,t))}getTouchPoint(){return{x:this.position.x-35,y:this.position.y-35}}isIntersect(e){return this.position.x-35<e.x&&this.position.y-35<e.y&&this.position.x+35>e.x&&this.position.y+35>e.y}drawSelect(e,t){}getClassType(){return"MobileTouchHelperDrawable"}},Jd=class extends as{constructor(e){super(),this.enabled=!0,this.keyboardEnabled=!0,this.mouseDownPositionX=0,this.mouseDownPositionY=0,this.lastLeftPointerUpTime=0,this.pointers=[],this.handleClick=e=>{if(!this.enabled)return;let t=this.getBaseEvent(e);this.dispatchEvent("click",t)},this.handlePointerDown=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);this.isDoubleClick(t)?(this.lastLeftPointerUpTime=0,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.dispatchEvent("dblclick",t)):(this.mouseDownPositionX=t.x,this.mouseDownPositionY=t.y),this.dispatchEvent("pointerdown",t),"touch"===e.pointerType?(this.pointers.push(t),t.pointers=this.pointers,this.dispatchEvent("touchstart",t)):this.dispatchEvent("mousedown",t)},this.handlePointerMove=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);this.isCloseToLastPosition(t)||(this.dispatchEvent("pointermove",t),"touch"===e.pointerType?(this.updatePointers(t),t.pointers=this.pointers,this.dispatchEvent("touchmove",t)):this.dispatchEvent("mousemove",t))},this.handlePointerUp=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);0===t.button&&(this.lastLeftPointerUpTime=t.timestamp),this.dispatchEvent("pointerup",t),"touch"===e.pointerType?(this.removePointers(t),t.pointers=this.pointers,this.dispatchEvent("touchend",t)):this.dispatchEvent("mouseup",t)},this.handlePointerCancel=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointercancel",this.getBaseEvent(e)))},this.handleMouseWheel=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("wheel",this.getBaseEvent(e)))},this.handleContextMenu=e=>{if(this.enabled)return this.stop(e),this.dispatchEvent("contextmenu",this.getBaseEvent(e)),!1},this.handlePointerEnter=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointerenter",this.getBaseEvent(e)))},this.handlePointerLeave=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointerleave",this.getBaseEvent(e)))},this.handleResize=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("resize",this.getBaseEvent(e)))},this.handleKeydown=e=>{!this.enabled||!this.keyboardEnabled||this.dispatchEvent("keydown",this.getBaseEvent(e))},this.handleKeyup=e=>{!this.enabled||!this.keyboardEnabled||this.dispatchEvent("keyup",this.getBaseEvent(e))},this.style={},this.element=e,this.bindEvents()}getEnabled(){return this.enabled}setEnabled(e){this.enabled=e}getkKeyboardEnabled(){return this.keyboardEnabled}setkKeyboardEnabled(e){this.keyboardEnabled=e}setCursor(e){this.element.style&&(this.element.style.cursor=e||"default")}bindEvents(){this.element.style.touchAction="none",this.element.style.userSelect="none",this.element.style.webkitUserSelect="none",this.element.addEventListener("click",this.handleClick),this.element.addEventListener("pointerdown",this.handlePointerDown),this.element.addEventListener("pointermove",this.handlePointerMove),this.element.addEventListener("pointerup",this.handlePointerUp),this.element.addEventListener("pointercancel",this.handlePointerCancel),this.element.addEventListener("pointerenter",this.handlePointerEnter),this.element.addEventListener("pointerleave",this.handlePointerLeave),this.element.addEventListener("contextmenu",this.handleContextMenu),this.element.addEventListener("wheel",this.handleMouseWheel),window.addEventListener("resize",this.handleResize),window.addEventListener("keydown",this.handleKeydown),window.addEventListener("keyup",this.handleKeyup)}unBindEvents(){this.element.removeEventListener("pointerdown",this.handlePointerDown),this.element.removeEventListener("pointermove",this.handlePointerMove),this.element.removeEventListener("pointerup",this.handlePointerUp),this.element.removeEventListener("pointerenter",this.handlePointerEnter),this.element.removeEventListener("pointerleave",this.handlePointerLeave),this.element.removeEventListener("contextmenu",this.handleContextMenu),this.element.removeEventListener("wheel",this.handleMouseWheel),window.removeEventListener("resize",this.handleResize),window.removeEventListener("keydown",this.handleKeydown),window.removeEventListener("keyup",this.handleKeyup),this.element.style.touchAction="",this.element.style.userSelect="",this.element.style.webkitUserSelect=""}getBaseEvent(e){let t={x:0,y:0,pageX:0,pageY:0,clientX:0,clientY:0,deltaX:0,deltaY:0,movementX:0,movementY:0,deltaMode:0,pointerId:0,timestamp:0,buttons:0,pointerType:"mouse",altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,originalEvent:e};if(t.timestamp=e.timeStamp,DC(e,"clientX"))if(t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.button=e.button,DC(e,"pointerId")){t.pointerType=e.pointerType,t.buttons=e.buttons,t.pageX=e.pageX,t.pageY=e.pageY,t.pointerId=e.pointerId;let n=mn.getScreenCoordinateByEvent(e,this.element);t.x=n.x,t.y=n.y,t.movementX=e.movementX,t.movementY=e.movementY}else DC(e,"deltaX")&&(t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY);else DC(e,"code")&&(t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.code=e.code);return t}stop(e){e.preventDefault()}updatePointers(e){for(let t=0;t<this.pointers.length;t++)if(e.pointerId==this.pointers[t].pointerId){this.pointers[t]=e;break}}removePointers(e){for(let t=0;t<this.pointers.length;t++)if(this.pointers[t].pointerId==e.pointerId){this.pointers.splice(t,1);break}}getBoundingClientRect(){return this.element.getBoundingClientRect()}isCloseToLastPosition(e){return-1!==this.mouseDownPositionX&&-1!==this.mouseDownPositionY&&(Math.abs(e.x-this.mouseDownPositionX)<5&&Math.abs(e.y-this.mouseDownPositionY)<5)}isDoubleClick(e){let t=e.timestamp-this.lastLeftPointerUpTime;return!!(0===e.button&&t<300&&this.isCloseToLastPosition(e))}};function DC(e,t){return void 0!==e[t]}var OC=class{constructor(e){this.CLEAR_COLOR=(new Ot).setRGB(1,1,1),this.CLEAR_COLOR_ALPHA=1,this.EMPTY_MODEL_ID=255,this.viewer=e,this.raycaster=new Sd,this.pickingTexture=new Qs(1,1)}get scene(){return this.viewer.scene}get camera(){return this.viewer.camera}get renderer(){return this.viewer.renderer}get overlayRender(){return this.viewer.getOverlayRender()}get viewerContainer(){return this.viewer.viewerContainer}getRaycaster(){return this.raycaster}pickObjectsByNdc(e,t,n){return t&&0!==t.length?(this.raycaster.setFromCamera(e,this.camera),this.setLayerChannels(n),this.raycaster.intersectObjects(t,!0)||[]):[]}pickObject(e,t,n){let r=this.pickObjects(e,t,n);if(0!==r.length)return r[0]}pickObjects(e,t,n){let r=mn.screen2Ndc(e,this.camera,this.viewerContainer);return this.pickObjectsByNdc(r,t,n)}pickDrawable(e){return this.overlayRender.getDrawablesByPosition(e)}pick(e,t){}setLayerChannels(e){e&&e.length>0?(this.raycaster.layers.disableAll(),e.forEach((e=>{this.raycaster.layers.enable(e)}))):this.raycaster.layers.enableAll()}pickBuffer(e,t,n=1,r=1){let{pickingTexture:i,renderer:a,camera:s}=this;i.setSize(n,r);let o=a.getPixelRatio(),l=a.getContext().drawingBufferWidth,h=a.getContext().drawingBufferHeight,u=e.x*o|0,c=e.y*o|0;s.setViewOffset(l,h,u,c,n,r),a.setRenderTarget(i);let d=new Ot;a.getClearColor(d);let p=a.getClearAlpha();a.setClearColor(this.CLEAR_COLOR,this.CLEAR_COLOR_ALPHA),a.render(t,s);let f=new Uint8Array(4*n*r);return a.readRenderTargetPixels(i,0,0,n,r,f),a.setRenderTarget(null),s.clearViewOffset(),a.setClearColor(d,p),f}},Gde=new q,LC=class{constructor(e){this.viewer=e;let t=new ea;t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,this.scene=t,this.modelGroup=new Ai,this.modelGroup.name="models",this.scene.add(this.modelGroup);let{width:n,height:r,viewerContainer:i}=e.container,a=new hl({antialias:!0,preserveDrawingBuffer:!0});a.setPixelRatio(window.devicePixelRatio),a.setSize(n,r),a.outputColorSpace=yi,a.toneMappingExposure=1,a.localClippingEnabled=!0,a.shadowMap.enabled=!1,a.shadowMap.type=nM,a.shadowMap.autoUpdate=!1,a.domElement.style.outlineWidth="0",null==i||i.appendChild(a.domElement),this.renderer=a,Ct.printGpuInfo(a.getContext())}initLights(){let e=new Ai;e.name="lights";let t=16777215,n=new gg(t,1.5);n.name="sun",n.castShadow=!0,n.position.set(-2,2,4),n.shadow.autoUpdate=!1,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024;let r=new vg(t);r.name="ambient";let i=new mg(t,14540253,.2);i.name="hemisphere",i.position.set(0,300,0);let a=new Ai;a.name="lightHelpers",a.visible=!1;let s=new xg(n),o=new bg(n.shadow.camera);return a.add(s),a.add(o),e.add(n),e.add(n.target),e.add(r),e.add(i),e.add(a),this.scene.add(e),this.lights=e,e}initPMREMGenerator(){this.pmremGenerator=new ld(this.renderer),this.pmremGenerator.compileEquirectangularShader()}get maxFragmentUniforms(){return this.renderer.capabilities.maxFragmentUniforms-20}addModel(e){this.modelGroup.add(e.getModelObject())}enableShadow(e){this.renderer.shadowMap.enabled=e,this.directionalLight.castShadow=e,e&&(this.tryAdjustDirectionalLight(),this.updateDirectionalLightShadow()),this.modelGroup.traverse((t=>{t.isMesh&&(t.castShadow=e,t.receiveShadow=e)}))}enableClipping(e){this.renderer.localClippingEnabled=e}setClipPlanes(e){this.renderer.clippingPlanes=e}enableLights(e){let t=this.lights;t||(t=this.initLights()),t.visible=e}debugLights(e){!this.lights||!this.lightHelpers||(this.lightHelpers.visible=e)}setBackground(e){this.scene.background=e}get directionalLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("sun")}get ambientLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("ambient")}get hemisphereLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("hemisphere")}get lightHelpers(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("lightHelpers")}get directionalLightHelper(){var e;let t;for(let n=0;this.lightHelpers&&n<(null==(e=this.lightHelpers)?void 0:e.children.length);++n){let e=this.lightHelpers.children[n];if(e instanceof xg){t=e;break}}return t}get cameraHelper(){var e;let t;for(let n=0;this.lightHelpers&&n<(null==(e=this.lightHelpers)?void 0:e.children.length);++n){let e=this.lightHelpers.children[n];e instanceof bg&&(t=e)}return t}setEnvironmentFromData(e){return Et(this,null,(function*(){this.pmremGenerator||this.initPMREMGenerator();let t=yield qg.createEnvTextureFromDataArray(this.pmremGenerator,e);this.scene.environment=t}))}setEnvironment(e){return Et(this,null,(function*(){this.pmremGenerator||this.initPMREMGenerator();let t=yield qg.createEnvTexture(this.pmremGenerator,e);this.scene.environment&&this.scene.environment.dispose(),this.scene.environment=t}))}resize(){let{width:e,height:t}=this.viewer.container;this.renderer.setSize(e,t)}getRaycastableObjects(){let e=[];return this.modelGroup.traverse((t=>{e.push(t)})),e}tryAdjustDirectionalLight(){let e=this.directionalLight;if(!e)return;let t=this.viewer.getBBox(),n=new ir;t.getBoundingSphere(n);let r=n.center,i=n.radius,a=e.shadow.camera;a.zoom=1,a.top=i,a.bottom=-i,a.right=i,a.left=-i,a.near=.1,a.far=2*i,a.updateProjectionMatrix();let s=new q(-1,-.5,1);s.normalize().multiplyScalar(i),e.position.copy(r).addScaledVector(s,-1),e.target.position.copy(r),fe.debug("[Scene] directionalLight.position",e.position),fe.debug("[Scene] directionalLight.target.position",e.target.position),this.updateDirectionalLight(),this.viewer.enableRender()}updateDirectionalLight(){var e,t;let n=this.directionalLight;if(n&&(n.updateMatrixWorld(),n.target.updateMatrixWorld(),this.directionalLightHelper&&(this.directionalLightHelper.update(),!(null!=(e=this.scene)&&e.matrixAutoUpdate)&&this.directionalLightHelper.updateWorldMatrix(!1,!0)),n.shadow.needsUpdate=!0,n.shadow.camera.updateProjectionMatrix(),this.cameraHelper&&(this.cameraHelper.update(),null==(t=this.scene)||!t.matrixAutoUpdate))){let e=n.shadow.camera;e.position.setFromMatrixPosition(n.matrixWorld),Gde.setFromMatrixPosition(n.target.matrixWorld),e.lookAt(Gde),e.updateMatrixWorld(),this.cameraHelper.updateWorldMatrix(!1,!0)}}updateDirectionalLightShadow(){this.directionalLight&&(this.directionalLight.shadow.needsUpdate=!0)}showDirectionalLightHelper(e){this.directionalLightHelper&&(this.directionalLightHelper.visible=e),this.cameraHelper&&(this.cameraHelper.visible=e)}destroy(){var e,t,n,r,i,a,s;null==(e=this.lightHelpers)||e.clear(),null==(t=this.lightHelpers)||t.removeFromParent(),null==(n=this.lightHelpers)||n.traverse((e=>{var t;null==(t=e.dispose)||t.call(e)})),null==(r=this.lights)||r.clear(),null==(i=this.lights)||i.removeFromParent(),null==(a=this.lights)||a.traverse((e=>{var t;null==(t=e.dispose)||t.call(e)})),this.lights=void 0,null==(s=this.pmremGenerator)||s.dispose(),this.renderer.domElement.remove(),this.renderer.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.scene.clear()}},kC=class{constructor(e){this.history=[],this.step=0,this.maxCount=50,this.isBatchCommand=!1,this.batchCommands=[],this.maxCount=e||this.maxCount}addCommand(e){this.isBatchCommand?this.batchCommands.push(e):(this.history.length===this.maxCount&&this.history.shift(),this.step!==this.history.length&&this.history.splice(this.step),this.history.push(e),this.step++)}startTransaction(){this.isBatchCommand=!0}endTransaction(){this.history.length===this.maxCount&&this.history.shift(),this.step!==this.history.length&&this.history.splice(this.step),this.batchCommands.length>0&&(this.history.push(this.batchCommands.slice()),this.step++),this.isBatchCommand=!1,this.batchCommands=[]}undo(){if(this.canUndo())return!1;this.step--;let e=this.history[this.step];return e&&(Array.isArray(e)?e.forEach((e=>e.undo())):e.undo()),!0}redo(){if(this.canRedo())return!1;this.step++;let e=this.history[this.step-1];return e&&(Array.isArray(e)?e.forEach((e=>e.redo())):e.redo()),!0}getCommands(){return this.history}canUndo(){return this.step<=0}canRedo(){return this.step>=this.history.length}clear(){this.history=[],this.step=0}destroy(){this.clear(),this.maxCount=0}},lb=class extends Io{constructor(e,t){super("AddMeasurement"),this.manager=e,this.data=t}undo(){let e=this.manager.getById(this.data.id);return!!e&&(this.manager.remove(e),!0)}redo(){let e=this.manager.create(this.data);return!!e&&(this.manager.add(e),!0)}},FC=class extends Io{constructor(e,t){super("RemoveMeasurement"),this.manager=e,this.data=t}undo(){let e=this.manager.create(this.data);return!!e&&(this.manager.add(e),!0)}redo(){let e=this.manager.getById(this.data.id);return!!e&&(this.manager.remove(e),!0)}},NC=class extends as{constructor(e){super(),this.name="BaseViewer",this.clock=new ph,this.targetMaxFps=60,this.timeStamp=0,this.renderEnabled=!0,this.plugins=[],this.loadedModels=[],this.raf=new u0,this._enableSelection=!0,this.enableRender=(e=1e3)=>{this.renderEnabled=!0,this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.timeoutSymbol=this.raf.setTimeout((()=>{this.renderEnabled=!1}),e))},this.viewerCfg=e,this.initLogLevel(),this.initLocalization(),this.container=new Xg(e.containerId),e.enableProgressBar&&(this.progressBar=new Yg(this.container)),this.spinner=new _A(this.container),this.sceneManager=new LC(this),this.pickManager=new OC(this),this.overlayRender=new xn(this),this.css2dRenderer=this.initCSS2DRenderer(),this.inputManager=new Jd(this.viewerContainer),this.cameraManager=new IA(this),this.loaderHelper=new bC,this.undoManager=new kC,this.resize(),this.clock.start(),this.animate()}initLogLevel(){let e=this.viewerCfg.logLevel;e&&Lle(e)}initLocalization(){var e;let t=(null==(e=this.viewerCfg)?void 0:e.language)||"en";return Bd.init({lng:t,debug:!1,resources:{en:{translation:vce},cn:{translation:yce}}}),Bd.t}get viewerContainer(){return this.container.viewerContainer}get widgetContainer(){return this.container.widgetContainer}getUndoManager(){return this.undoManager}getInputManager(){return this.inputManager}getCameraManager(){return this.cameraManager}getOverlayRender(){return this.overlayRender}get renderer(){return this.sceneManager.renderer}get camera(){return this.cameraManager.camera}get scene(){return this.sceneManager.scene}getRaycaster(){return this.pickManager.getRaycaster()}getViewerConfig(){return this.viewerCfg}getSpinner(){return this.spinner}getFontManager(){return this.fontManager}initCSS2DRenderer(){var e;let t=new Bg,{width:n,height:r}=this.viewerContainer.getBoundingClientRect();return t.setSize(n,r),t.domElement.style.height="0",t.domElement.style.width="0",t.domElement.style.position="absolute",t.domElement.style.top="0",t.domElement.style.left="0",t.domElement.style.overflow="visible",t.domElement.classList.add("css2d-renderer"),null==(e=this.viewerContainer)||e.appendChild(t.domElement),t}animate(){if(Date.now()-this.timeStamp<1/this.targetMaxFps)return void(this.requestAnimationFrameHandle=requestAnimationFrame(this.animate.bind(this)));let e=this.cameraManager.update(this.clock.getDelta());this.container.needResize&&(this.resize(),this.renderEnabled=!0),(this.renderEnabled||e)&&(this.dispatchEvent("beforerender"),this.renderer.render(this.scene,this.camera),this.css2dRenderer.render(this.scene,this.camera),this.dispatchEvent("afterrender"),this.renderEnabled=!1),this.requestAnimationFrameHandle=requestAnimationFrame(this.animate.bind(this)),this.timeStamp=Date.now(),this.dispatchEvent("onanimate")}resize(){this.sceneManager.resize(),this.cameraManager.updateAspect();let{clientWidth:e,clientHeight:t}=this.viewerContainer;this.css2dRenderer.setSize(e,t),this.overlayRender.setSize(e,t)}addModel(e){let t=e.getModelObject();t.name=e.modelId,this.sceneManager.addModel(e),t.matrixAutoUpdate=!1,t.updateMatrix(),t.updateMatrixWorld(!0),this.loadedModels.push(e),this.enableRender(0)}setFont(e){return Et(this,null,(function*(){this.fontManager||(this.fontManager=new Ja),yield this.fontManager.loadFonts(e)}))}is3d(){return!1}getPixelSizeInWorldCoord(){let e=this.camera,{clientWidth:t,clientHeight:n}=this.viewerContainer,r=1;if("OrthographicCamera"===e.type){let i=e;r=Math.max(i.right-i.left,i.top-i.bottom)/i.zoom/Math.max(t,n)}else if("PerspectiveCamera"===e.type){let t=e,i=new q;e.getWorldPosition(i);let a=this.cameraManager.getTarget();i&&a&&(r=i.distanceTo(a)*Math.tan(t.fov/2*Math.PI/180)*2/n)}return r}zoomToRect(){this.zoomToRectHelper||(this.zoomToRectHelper=new PC(this)),this.zoomToRectHelper.activate()}deactivateZoomRect(){var e;null==(e=this.zoomToRectHelper)||e.deactivate()}getUniqueModelId(e){let t=e,n=e=>!!this.loadedModels.find((t=>t.modelId===e));if(n(t)){let e=1;for(;n(`${t}_${e}`);)e++;t=`${t}_${e}`,fe.warn(`[Viewer] Model '${t}' is loaded more than once!`)}return t}getBBox(){let e=new Ft;return this.loadedModels.forEach((t=>{e.union(t.getBBox())})),e}flyToObject(e){this.cameraManager.flyToObject(e)}flyToObjects(e){let t=new Ft;e.forEach((e=>{let n=(new Ft).setFromObject(e);t.union(n)}));let n=new ir;t.getBoundingSphere(n),this.cameraManager.fitToSphere(n)}flyTo(e,t){let n=this.camera;if(e.equals(t))return void fe.error("[Viewer] camera position and lookAt cannot be the same!");if(!Ct.isVectorValid(e)||!Ct.isVectorValid(t))return void fe.error("[Viewer] invalid position or lookAt!");let r=e.distanceTo(t);r<n.near?(e=e.clone().sub(t).normalize().multiplyScalar(1.1*n.near),fe.warn("[Viewer] camera could be too close to see the object!")):r>n.far&&(e=e.clone().sub(t).normalize().multiplyScalar(.9*n.far),fe.warn("[Viewer] camera could be too far to see the object!")),this.cameraManager.flyTo(e,t)}flyToDirection(e){let t=this.getBBox(),n=t.getSize(new q),r=Math.max(n.x,n.y,n.z)/2;0===r&&(r=1);let i=this.cameraManager.getDistanceToFitSphere(r),a=new q;t.getCenter(a);let s=a.clone().add(e.clone().multiplyScalar(i));this.flyTo(s,a)}goToHomeView(){if(this.homeView)this.cameraManager.flyToViewpoint(this.homeView);else{let e=new q(1,.5,1);this.flyToDirection(e)}}viewFitAll(){let e=this.getBBox(),t=new ir;e.getBoundingSphere(t),this.cameraManager.fitToSphere(t)}zoomToBBox(e){this.cameraManager.flyToBox(e)}pickObject(e,t){var n;let r=this.pickManager.pickObject(e,this.getRaycastableObjects(),t);return this.renderer&&this.renderer.clippingPlanes.length>0&&null!=(n=this.renderer)&&n.clippingPlanes.every((e=>{r&&e.distanceToPoint(r.point)}))&&(r=void 0),r}pickObjects(e,t){let n=this.pickManager.pickObjects(e,this.getRaycastableObjects(),t);return n&&this.renderer.clippingPlanes.length>0&&(n=n.filter((e=>this.renderer.clippingPlanes.every((function(t){return t.distanceToPoint(e.point)>0}))))),n}getRaycastableObjects(){return this.sceneManager.getRaycastableObjects()}setBackgroundColor(e,t,n){if(this.scene.background||(this.scene.background=new Ot(e,t,n)),this.scene.background instanceof Ot){let r=new Ot;r.setRGB(e,t,n,this.renderer.outputColorSpace),this.scene.background.copy(r)}this.enableRender()}setGlobalClipPlanes(e){}getCameraProjection(){return this.cameraManager.getProjection()}setCameraProjection(e){this.cameraManager.setProjection(e)}enableControl(e){this.cameraManager.enableControl(e)}enableRotate(e){this.cameraManager.enableRotate=e}enableZoom(e){this.cameraManager.enableZoom(e)}enablePan(e){this.cameraManager.enablePan(e)}getHomeView(){return this.homeView}setHomeView(e){this.homeView=e}getCameraConfig(){return this.cameraManager.getCameraConfig()}setCameraConfig(e){return this.cameraManager.setCameraConfig(e)}getCameraDirection(){return this.cameraManager.getCameraDirection()}getRenderInfo(){var e;let t=this.renderer.info;return{drawCalls:t.render.calls,lines:t.render.lines,points:t.render.points,triangles:t.render.triangles,geometries:t.memory.geometries,textures:t.memory.textures,materials:(null==(e=t.programs)?void 0:e.length)||0}}destroy(){var e;this.requestAnimationFrameHandle&&cancelAnimationFrame(this.requestAnimationFrameHandle),this.css2dRenderer.domElement.remove(),this.container.destroy(),this.sceneManager.destroy(),this.cameraManager.destroy(),this.overlayRender.destroy(),this.spinner.destroy(),null==(e=this.progressBar)||e.destroy(),this.undoManager.destroy()}addPlugin(e){this.plugins.find((t=>t.id===e.id))?fe.warn(`[Viewer] Plugin already exist: ${e.id}`):(this.plugins.push(e),fe.debug(`[Viewer] Added plugin: ${e.id}`))}removePlugin(e){for(let t=0,n=this.plugins.length;t<n;t++)if(this.plugins[t]===e)return void this.plugins.splice(t,1)}clearPlugins(){this.plugins=[]}findPlugin(e){return this.plugins.find((t=>t.id===e))}};function E0(e){return{all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}}}var BC=class{constructor(e){this.viewer=e,this.itemList={},this.handleMouseWheel=e=>{e.preventDefault(),this.element&&(this.element.scrollLeft+=e.deltaY)},e.addEventListener("modelload",(()=>{this.init()}))}init(){var e;let t=document.createElement("div");t.classList.add("model-layout-switch-bar");let n=document.createElement("div");n.classList.add("model-layout-switch-bar-content"),n.addEventListener("wheel",this.handleMouseWheel),this.viewer.getLayoutNames().forEach(((e,t)=>{let r=this.createItem(e,t);this.itemList[e]=r,r.resetActivate=()=>{for(let e in this.itemList)this.itemList[e].resetActive()},null==n||n.appendChild(r.element)})),this.element=t,this.content=n,this.element.appendChild(this.content),null==(e=this.viewer.widgetContainer)||e.appendChild(this.element)}createItem(e,t){let n=new NN(this.viewer,e);return 0===t&&n.setActive(!0),n}destroy(){var e,t;for(let t in this.itemList){let n=this.itemList[t];n.destroy(),null==(e=this.content)||e.removeChild(n.element)}this.itemList={},this.element&&this.content&&(this.element.removeChild(this.content),this.element.removeEventListener("wheel",this.handleMouseWheel),null==(t=this.viewer.widgetContainer)||t.removeChild(this.element),this.element=void 0)}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}},NN=class{constructor(e,t){this.viewer=e,this.eventBus=E0(),this.active=!1,this.element=this.createItem(t),this.eventBus.on("activechange",(e=>{this.resetActivate&&this.resetActivate(),e?(this.element.classList.add("activate"),this.viewer.activateLayout(t)):this.element.classList.remove("activate")}))}createItem(e){let t=document.createElement("div"),n=document.createElement("span");return t.classList.add("model-layout-switch-item"),t.onclick=()=>{this.active=!this.active,this.eventBus.emit("activechange",this.active)},n.innerText=e,t.appendChild(n),t}setActive(e){this.active!==e&&(this.active=e,this.eventBus.emit("activechange",e))}resetActive(){this.active=!1,this.element.classList.remove("activate")}destroy(){this.eventBus.off("activechange")}},UC=class{},_0=new At,BN=new Ft,Uo=class extends UC{constructor(e){var t,n;super(),this.modelData=e,this.modelId=e.modelId,this.modelObject=(null==(t=e.dxfData)?void 0:t.threejsObject)||(null==(n=e.pdfData)?void 0:n.threejsObject),this.modelObject.name=this.modelId,this.modelObject.userData.modelId=this.modelId}get pdfData(){return this.modelData.pdfData}get dxfData(){return this.modelData.dxfData}get msTransformMatrix(){return this.modelData.msTransformMatrix}set msTransformMatrix(e){this.modelData.msTransformMatrix=e}get loadedEntityCount(){var e,t;return(null==(e=this.dxfData)?void 0:e.loadedEntityCount)||(null==(t=this.pdfData)?void 0:t.loadedEntityCount)||0}get header(){var e;return null==(e=this.dxfData)?void 0:e.header}get viewports(){var e;return null==(e=this.dxfData)?void 0:e.tables.viewport.viewports}get layers(){var e;let t=this.dxfData||this.pdfData;return(null==(e=t.tables)?void 0:e.layer.layers)||t.layers}get layoutViewportsMap(){var e;return null==(e=this.dxfData)?void 0:e.layoutViewportsMap}getModelObject(){let e=this.dxfData||this.pdfData;if(!e)throw new Error(`Failed to find model by modelId '${this.modelId}'!`);return e.threejsObject}getBBox(){if(!this.bbox){let e=new Ft,t=this.getModelObject();e.setFromObject(t),this.bbox=e}return this.bbox}getUnits(){if(!this.dxfData)return"Unitless";let e=this.dxfData.header;if(!e)return fe.warn("DxfData or its header is undefined!"),"Unitless";let t=e.$INSUNITS;return bn.getDxfUnits(t)}getModelSpaceExtent(){let e=this.header,t=new q,n=new q;if(!e)return void fe.error(`Header is undefined in ${this.modelId}!`);let r=this.viewports,i=e.$EXTMIN,a=e.$EXTMAX,s=e.$ANGDIR;if(r&&r.length>0)for(let e=0;e<r.length;e++){let t=r[e];if("*ACTIVE"===t.name.toLocaleUpperCase()){let{center:e,viewHeight:n,aspectRatio:r}=t,o=n*r,l=bn.getDcs2WcsMatrix(t,s),h=new q(e.x,e.y,0);h.applyMatrix4(l),i={x:h.x-o/2,y:h.y-n/2,z:0},a={x:h.x+o/2,y:h.y+n/2,z:0};break}}return t.set(i.x,i.y,i.z),n.set(a.x,a.y,a.z),new Ft(t,n)}getLayer(e){if(this.layers)return this.layers[e]}getObjectsByLayer(e){let t=this.dxfData||this.pdfData;return(null==t?void 0:t.layersAndThreejsObjects)&&t.layersAndThreejsObjects[e]}getLayouts(){let e=[],t=this.dxfData,n=null==t?void 0:t.objects.LAYOUT;return null==n||n.forEach((t=>{e.push(t)})),e}getLayoutByName(e){let t,n=this.getLayouts();for(let r of n)if(r.layoutName===e){t=r;break}return t}getLayoutExtent(e){let t=this.header,n=new q,r=new q;if(!t)throw new Error(`Header is undefined in ${this.modelId}!`);let i=this.getLayoutViewports(e),a=t.$PEXTMIN,s=t.$PEXTMAX,o=t.$ANGDIR;if(i&&i.length>0){let e,t=i.filter((e=>1===parseInt(e.viewportId)));e=t.length>0?t[0]:i[0];let{centerPoint:n,width_paperSpace:r,height_paperSpace:l}=e,h=bn.getDcs2WcsMatrix(e,o),u=new q(n.x,n.y,0);u.applyMatrix4(h),a={x:u.x-r/2,y:u.y-l/2,z:0},s={x:u.x+r/2,y:u.y+l/2,z:0}}return n.set(a.x,a.y,a.z),r.set(s.x,s.y,s.z),new Ft(n,r)}getLayoutViewports(e){return this.layoutViewportsMap[e.ownerHandle]||[]}getLayoutLevelObject(e){let t=this.getModelObject();return null==t?void 0:t.children.find((t=>t.name===e))}setVisible(e){this.getModelObject().visible=e}setLayerVisible(e,t,n,r){let i=this.getLayer(e);i?i.visible=t:fe.warn(`[Viewer] Layer '${e}' not found from modelData!`);let a=this.getObjectsByLayer(e);if(a)for(let e=0;e<a.length;e++){let i=a[e];n&&t&&r&&i.userData.visibleMinZoom&&r<i.userData.visibleMinZoom||(i.visible=t),(!1===t||null!=i.userData.layerVisible)&&(i.userData.layerVisible=t),i.userData.isSnapObject&&(i.visible?bn.SHOW_SNAP_OBJECT?i.layers.enableAll():i.layers.set(11):bn.SHOW_SNAP_OBJECT?i.layers.disableAll():i.layers.disable(11))}else fe.info(`[Viewer] No object found for layer '${e}'`)}setLayerOpacity(e,t){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let n=this.getObjectsByLayer(e);n?n.forEach((e=>{let n=e;if(n.material){n.userData.originalMaterial||(n.userData.originalMaterial=Fs.cloneMaterial(n.material));let e=Fs.cloneMaterial(n.material);Fs.setMaterialOpacity(e,t),bn.updateMaterialUniforms(e),n.material=e}})):fe.info(`[Viewer] No object found for layer '${e}'`)}setLayerColor(e,t){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let n=this.getObjectsByLayer(e);n?n.forEach((e=>{let n=e;if(n.material){n.userData.originalMaterial||(n.userData.originalMaterial=Fs.cloneMaterial(n.material));let e=Fs.cloneMaterial(n.material);Fs.setMaterialColor(e,new Ot(t)),bn.updateMaterialUniforms(e),n.material=e}})):fe.info(`[Viewer] No object found for layer '${e}'`)}resetLayerColor(e){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let t=this.getObjectsByLayer(e);t?t.forEach((e=>{let t=e;t.material&&t.userData.originalMaterial&&(t.material.dispose(),t.material=t.userData.originalMaterial,delete t.userData.originalMaterial)})):fe.info(`[Viewer] No object found for layer '${e}'`)}switchTransformMs(e){let t=this.msTransformMatrix;if(_0.identity(),!t||!Ct.isMatrixValid(t)||t.equals(_0))return;let n=this.getLayoutLevelObject(bn.MODEL_LAYOUT_NAME);n&&(e===bn.MODEL_LAYOUT_NAME?n.applyMatrix4(t):n.applyMatrix4(t.clone().invert()),n.updateMatrixWorld(!0))}activateLayout(e=bn.MODEL_LAYOUT_NAME,t){this.switchTransformMs(e);let n=this.getLayoutByName(e);if(n){if(!t){let t=this.getLayoutViewports(n),r=[];t.length>0&&(r=t[0].frozenLayerHandles);let i=e!==bn.MODEL_LAYOUT_NAME,a=this.getLayoutLevelObject(e);if(a){let t=[];a.traverse((n=>{this.addSpatialFilterSection(n,this.dxfData);let a=n;if(i&&a.material&&a.geometry){let n=a.userData.layerName;if(!this.isLayerFrozenForViewport(n,r))return;t.push(a);let i=-1,s=this.getObjectsByLayer(n);s&&(i=s.indexOf(a),i>=0&&s.splice(i,1)),i<0&&fe.warn(`[Viewer] Failed to find object for modelId '${this.modelId}', layer '${n}', layout '${e}'`)}})),t.forEach((e=>{e.removeFromParent()}))}let s=this.getFilteredViewports(n);fe.debug("[Viewer] Active layout:",e,", viewports:",s);let o=Date.now();s.forEach((t=>{this.generateObjectsByViewport(e,t,this)})),fe.info(`[Viewer] generateObjectsByViewport in ${(Date.now()-o)/1e3}s`)}this.showLayoutObjects(e)}}getFilteredViewports(e){let t=this.getLayoutViewports(e),n=t.filter((e=>"1"!==e.viewportId));return n.length===t.length&&(n=t.filter(((e,t)=>0!==t))),n}generateObjectsByViewport(e,t,n,r=[]){let i=t;if("1"==t.viewportId)return;if(!i.psBBox||!i.msToPsMatrix)throw new Error("The bbox or matrix is invalid in the viewport!");bn.TransformMatrixUniform={value:i.msToPsMatrix},bn.ViewportScaleUniform={value:t.viewHeight/t.height_paperSpace};let a=i.psBBox.clone();a.applyMatrix4(i.msToPsMatrix.clone().invert()),a.min.setZ(-1),a.max.setZ(1);let s=this.getObjectsByBoundingBox(a);if(0===s.length)return;let o,l=i.psBBox.min,h=i.psBBox.max,u=new Vr(new Te(l.x,l.y),new Te(h.x,h.y)),c=rc.generateSectionPlanesByBox(u),d=[],p=e=>(d[e.id]||(d[e.id]=e.clone(),this.setMaterialUniforms(d[e.id],n.dxfData),rc.setMaterialSection(d[e.id],c)),d[e.id]),f=[...r,...t.frozenLayerHandles||[]];if(e!==bn.MODEL_LAYOUT_NAME){let e=t;e.associatedLeafObjectSet||(e.associatedLeafObjectSet=new Set),o=e.associatedLeafObjectSet}let m=new Ai;m.name=t.viewportId;let g=[];if(s.forEach((t=>{let r=t.clone();r.traverse((t=>{if(t.material&&t.geometry){let r=t.userData.layerName;if(this.isLayerFrozenForViewport(r,f))return void g.push(t);!1!==t.userData.layerVisible&&(t.visible=!0),t.material=(e=>{if(Array.isArray(e)){let t=[];return e.forEach((e=>{let n=p(e);t.push(n)})),t}return p(e)})(t.material),null==o||o.add(t);let i=n.getObjectsByLayer(r);i?i.push(t):fe.warn(`[Viewer] Failed to find object for modelId '${this.modelId}', layer '${r}', layout '${e}'`)}})),m.add(r)})),o&&0===o.size)return;let v=n.getModelObject(),y=n.getLayoutLevelObject(e);y||(y=new Ai,yr.setSharedVariablesOfObject(y),y.name=e,null==v||v.add(y)),y.add(m),m.applyMatrix4(i.msToPsMatrix),m.updateMatrixWorld(!0);let x=y.children.find((e=>e.name===bn.SNAP_GROUP_NAME));x||(x=new Ai,x.visible=bn.SHOW_SNAP_OBJECT,x.name=bn.SNAP_GROUP_NAME,y.add(x));let b=n.getLayoutLevelObject(bn.MODEL_LAYOUT_NAME),_=null==b?void 0:b.children.find((e=>e.name===bn.SNAP_GROUP_NAME));_&&_.traverse((e=>{if(!e.geometry)return;let t=e.userData.layerName;if(this.isLayerFrozenForViewport(t,f)||(BN.makeEmpty(),BN.expandByObject(e),!a.intersectsBox(BN)))return;let r=e.clone();yr.setSharedVariablesOfObject(r);let s=r.parent,l=_0.identity();for(;s&&!0!==s.userData.isLayoutLevelObject;)l.premultiply(s.matrix),s=s.parent;l.premultiply(i.msToPsMatrix),r.applyMatrix4(l),null==x||x.add(r),null==o||o.add(r);let h=n.getObjectsByLayer(t);h&&h.push(r)})),g.length>0&&yr.removeEmptyObjectsFromRemovingObjects(g,m),m.traverse((e=>{yr.setSharedVariablesOfObject(e),this.addSpatialFilterSection(e,n.dxfData,!0)}))}setMaterialUniforms(e,t){e instanceof fr&&(e.uniforms.u_cameraZoom&&(e.uniforms.u_cameraZoom=bn.CameraZoomUniform),e.uniforms.u_viewportScale&&1===(null==t?void 0:t.header.$PSLTSCALE)&&(e.uniforms.u_viewportScale=bn.ViewportScaleUniform))}getObjectsByBoundingBox(e){let t=[];if(e.isEmpty())return fe.warn("[Viewer] bbox is empty !"),t;let n=this.getLayoutLevelObject(bn.MODEL_LAYOUT_NAME);return n&&n.children.forEach((n=>{n.name!==bn.SNAP_GROUP_NAME&&(n=>{let r=nc.getBoundingBox(n,!1);e.intersectsBox(r)&&t.push(n)})(n)})),t}showLayoutObjects(e){let t=0,n=0,r=this.getModelObject();r.children.forEach((r=>{let i=r.name===e;r.visible=i,i?t++:n++})),fe.debug(`[Viewer] showLayoutObjects('${e}') sets ${t} layout level object(s) to visible and ${n} to hidden for model '${null==r?void 0:r.name}'`)}isLayerFrozenForViewport(e,t){let n=this.getLayer(e);return!!(n&&(1&n.flag)>0)||!(!t||t.length<=0)&&(n&&t.indexOf(n.handle)>=0)}addSpatialFilterSection(e,t,n=!1){if("INSERT"!==e.userData.entityType||!e.userData.spatialFilterHandle)return;let r=this.findSpatialFilter(e.userData.spatialFilterHandle,t);if(r){let t=n,i=!1,a=this.getAnyMaterial(e);if(a&&(a.clippingPlanes&&(t=a.clippingPlanes.length>0),i=a.clipIntersection),t&&i!==r.clipPolylines[0].bReversed)return void fe.warn("[Viewer] Material cannot set clipIntersection to different values at the same time. clipIntersection needs to be set to true here!");i=r.clipPolylines[0].bReversed;let s=this.generateSectionsBySpatialFilter(r,e.matrixWorld);if(s){let n=e=>{let t=0;return e.clippingPlanes&&(t=e.clippingPlanes.length),t+s.length>bn.MaxFragmentUniforms},r=new Set,a=e=>{r.has(e.id)||(r.add(e.id),n(e)||rc.setMaterialSection(e,s,t,i))};e.traverse((e=>{let t=e.material;Array.isArray(t)?t.forEach((e=>{a(e)})):t&&a(t)}))}}}findSpatialFilter(e,t){let n,r=t.objects.SPATIAL_FILTER;if(r){for(let t of r)if(t.handle===e){n=t;break}return n}}getAnyMaterial(e){let t,n=e;if(n.material)return Array.isArray(n.material)?n.material[0]:n.material;for(let n=0;n<e.children.length&&(t=this.getAnyMaterial(e.children[n]),!t);n++);return t}generateSectionsBySpatialFilter(e,t){let n=e.clipPolylines[0];if(n.bConcave)return void fe.warn("[Viewer] clipPolyline.bConcave = true is not supported yet in spatialFilter !");_0.copy(t),e.localMatrix&&_0.multiply(e.localMatrix);let r=n.polyline,i=[];r.forEach((e=>{let t=e.clone().applyMatrix4(_0);i.push(new Te(t.x,t.y))}));let a=Ds.isClockWise(i),s=!a&&!n.bReversed||a&&n.bReversed;return rc.generateSectionPlanesByPoints(i,s)}hasObject(e){return!!this.modelObject.getObjectById(e.id)}hasObjectWithId(e){return!!this.modelObject.getObjectById(e)}highlightObject(e){if(!this.hasObject(e))return;let t=Fs.clonedHighlightMaterials(e,{depthTest:!1});t&&(e.userData.originalMaterial=e.material,e.material=t)}unHighlightObject(e){if(!this.hasObject(e))return;let t=e.material;e.material=e.userData.originalMaterial,delete e.userData.originalMaterial,Array.isArray(t)?t.forEach((e=>e.dispose())):t instanceof Ir&&t.dispose()}clearHighlight(){}},Ho=(e=>(e.Distance="Distance",e.Area="Area",e.Angle="Angle",e.Coordinate="Coordinate",e))(Ho||{}),mc=class extends as{constructor(e,t,n,r,i){super(),this.actived=!1,this.mouseMoved=!1,this.mouseDowned=!1,this.touchDowned=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.snapPoint=void 0,this.touchstart=e=>{this.mobileTouchHelper&&this.mobileTouchHelper.isIntersect(e)&&!this.touchDowned&&(this.clearClickedDrawable(),this.viewer.getCameraManager().enableControl(!1),this.touchDowned=!0,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y)},this.touchmove=e=>{if(e.pointers&&e.pointers.length>1)return;let{width:t,height:n}=this.viewer.viewerContainer.getBoundingClientRect();if(!(e.x>t-15||e.x<35||e.y<15||e.y>n-35)&&this.touchDowned&&this.mobileTouchHelper){let t=e.x-this.mouseDownPositionX,n=e.y-this.mouseDownPositionY;this.mobileTouchHelper.translate(t,n),this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y;let r=this.mobileTouchHelper.getTouchPoint(),i=this.getIntersections(r);if(!i.length)return void this.osnapHelper.deactivate();let a=Date.now();if(this.snapPoint=this.osnapHelper.handleSnap(i,this.viewer.is3d(),this.lastMouseDownPosition),fe.debug(`[Measure] handleSnap took ${(Date.now()-a)/1e3}s`),!this.snapPoint)return void console.warn("[Measure] Failed to find a snap point!");this.onMouseMove(this.snapPoint)}},this.touchend=e=>{var t;if(this.viewer.getCameraManager().enableControl(!0),!(e.pointers&&e.pointers.length>1)){if(this.touchDowned){this.touchDowned=!1;let e=null==(t=this.mobileTouchHelper)?void 0:t.getTouchPoint();this.onMouseClick(e)}else this.selectMeasurementByEvent(e);Bn.isMobile&&(this.osnapHelper.deactivate(),this.dispatchEvent("update"))}},this.mousedown=e=>{this.mouseMoved=!1,this.mouseDowned=!0,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y},this.mousemove=e=>{if(this.lastMoveEvent=e,this.mouseDownPositionX>=0&&this.mouseDownPositionY>=0&&(Math.abs(e.x-this.mouseDownPositionX)>5||Math.abs(e.y-this.mouseDownPositionY)>5)&&(this.mouseMoved=!0),this.mouseDowned)return;let t=Date.now(),n=this.getIntersections(e);if(fe.debug(`[Measure] getIntersections took ${(Date.now()-t)/1e3}s`),!n.length)return void this.osnapHelper.deactivate();let r=Date.now();this.snapPoint=this.osnapHelper.handleSnap(n,this.viewer.is3d(),this.lastMouseDownPosition),fe.debug(`[Measure] OSnapHelper.handleSnap took ${(Date.now()-r)/1e3}s`),this.snapPoint?this.onMouseMove(this.snapPoint):console.warn("[Measure] Failed to find a snap point!")},this.mouseup=e=>{this.mouseDowned=!1,this.mouseMoved||this.onMouseClick(e)},this.dblclick=()=>{fe.info("[Measure] Double clicked")},this.keydown=e=>{if("Enter"===e.code){let e={x:0,y:0,pageX:0,pageY:0,clientX:0,clientY:0,deltaX:0,deltaY:0,button:2,movementX:0,movementY:0,deltaMode:0,pointerId:0,timestamp:0,buttons:0,pointerType:"mouse",altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1};this.onMouseClick(e)}else"Escape"===e.code&&this.cancel()},this.getIntersections=e=>{let t=new Te(e.x,e.y);return this.viewer.pickObjects(t)},this.type=e,this.viewer=t,this.inputManager=n,this.drawList=r,this.osnapHelper=i}get overlayRender(){return this.viewer.getOverlayRender()}get renderer(){return this.viewer.renderer}get isActive(){return this.actived}get isMeasuring(){return!1===this.completed}setTouchHelper(e){this.mobileTouchHelper=e}createMobileExitButton(){let e=this.viewer.widgetContainer,t=document.createElement("button");return t.innerText="X",t.style.cssText="position: absolute;right: 5%; top: 5%;background-color: #000000;color: #ffffff;padding: 3px 10px;font-weight: bolder;",null==e||e.appendChild(t),this.exitButton=t,this.exitButton.style.display="none",t.addEventListener("touchstart",(()=>{this.exitDrawing(),this.exitButton&&(this.exitButton.style.display="none")})),this.addEventListener("firstpointpicked",this.firstPickedListener=()=>{this.exitButton&&(this.exitButton.style.display="inline-block")}),this.addEventListener("complete",this.completedListener=()=>{this.exitButton&&(this.exitButton.style.display="none")}),this.exitButton}activate(){if(this.actived=!0,Bn.isMobile)this.inputManager.addEventListener("touchstart",this.touchstart),this.inputManager.addEventListener("touchmove",this.touchmove),this.inputManager.addEventListener("touchend",this.touchend);else{this.inputManager.addEventListener("pointerdown",this.mousedown),this.inputManager.addEventListener("pointermove",this.mousemove),this.inputManager.addEventListener("pointerup",this.mouseup),this.tooltip=new pc("measure-tooltip",Gr("Tooltip.measure"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewer.viewerContainer});let e=document.getElementById("measure-tooltip");e&&(e.style.pointerEvents="none"),this.setTooltipContent()}this.inputManager.addEventListener("dblclick",this.dblclick),this.inputManager.addEventListener("keydown",this.keydown)}deactivate(){var e,t;this.actived=!1,Bn.isMobile?(this.inputManager.removeEventListener("touchstart",this.touchstart),this.inputManager.removeEventListener("touchmove",this.touchmove),this.inputManager.removeEventListener("touchend",this.touchend)):(this.inputManager.removeEventListener("pointerdown",this.mousedown),this.inputManager.removeEventListener("pointermove",this.mousemove),this.inputManager.removeEventListener("pointerup",this.mouseup)),this.inputManager.removeEventListener("dblclick",this.dblclick),this.inputManager.removeEventListener("keydown",this.keydown),null==(e=this.tooltip)||e.hide(),null==(t=this.tooltip)||t.destroy(),this.tooltip=void 0,this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable),this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}removeDrawable(e){this.dispatchEvent("beforeremove",e)}clearClickedDrawable(){this.clickedOnMeasurementDrawable&&(this.clickedOnMeasurementDrawable.selected=!1,this.clickedOnMeasurementDrawable=void 0)}onMouseClick(e){if(Bn.isMobile)return;let t=Date.now();this.lastClickTime&&t-this.lastClickTime<500||(this.lastClickTime=t,this.selectMeasurementByEvent(e))}selectMeasurementByEvent(e){if(this.clickedOnMeasurementDrawable&&(this.clickedOnMeasurementDrawable.selected=!1,this.clickedOnMeasurementDrawable=void 0),null==this.completed||!0===this.completed){let t=this.getIntersections(e)[0];if(t){let e=this.overlayRender.getDrawablesByDrawableListAndPosition(this.drawList,t.point);e&&(this.dispatchEvent("onclick",e),this.clickedOnMeasurementDrawable=e)}}}onMouseMove(e){this.createOrUpdateMeasureDrawable(e)}createOrUpdateMeasureDrawable(e){if(!this.drawingPoints||this.drawingPoints&&this.drawingPoints.length<1)return;let t=[...this.drawingPoints];if(!this.currentMeasureDrawable)return this.currentMeasureDrawable=this.createMeasureDrawable(),this.currentMeasureDrawable&&(this.currentMeasureDrawable.selected=!0),void this.dispatchEvent("beforeadd",this.currentMeasureDrawable);e&&t.push(e),this.currentMeasureDrawable.selected=!0,this.currentMeasureDrawable.update(t),this.currentMeasureDrawable.setDrawingState(!0),this.dispatchEvent("update")}},Us=class extends Ei{constructor(e,t){super(e),this.type="Distance",this.labelBounds=new Vr,this.drawing=!1,this.update(t)}setDrawingState(e){this.drawing=e}drawSelect(e,t){let n=this.getVertexes();this.drawPoints(e,t,n)}drawPoints(e,t,n){e.save(),e.fillStyle=Us.MAJOR_COLOR,e.strokeStyle=Us.MINOR_COLOR,e.lineWidth=Us.LINE_WIDTH,e.beginPath(),(this.drawing?n.slice(0,n.length-1):n).forEach((n=>{let r=this.transToScreenCoord(n,t);e.moveTo(r.x+Us.POINT_RADIUS,r.y),e.arc(r.x,r.y,Us.POINT_RADIUS,0,2*Math.PI)})),e.closePath(),e.fill(),e.stroke(),e.restore()}drawText(e,t){if(!this.label||!this.labelPositon)return;e.font=`${Us.LABEL_FONT_SIZE}px Arial`;let n=1.2*e.measureText(this.label).width,r=1.5*Us.LABEL_FONT_SIZE;this.labelBounds.setFromCenterAndSize(this.labelPositon,new Te(n,r)),this.drawRoundRect(e,this.labelPositon.x-n/2,this.labelPositon.y-r/2,n,r,4),e.save(),e.fillStyle=Us.MINOR_COLOR,e.textBaseline="middle",e.textAlign="center",e.fillText(this.label,this.labelPositon.x,this.labelPositon.y),e.restore()}drawRoundRect(e,t,n,r,i,a){r<2*a&&(a=r/2),i<2*a&&(a=i/2),e.save(),e.fillStyle=Us.MAJOR_COLOR,e.strokeStyle=Us.MINOR_COLOR,e.lineWidth=Us.LINE_WIDTH,e.beginPath(),e.moveTo(t+a,n),e.arcTo(t+r,n,t+r,n+i,a),e.arcTo(t+r,n+i,t,n+i,a),e.arcTo(t,n+i,t,n,a),e.arcTo(t,n,t+r,n,a),e.closePath(),e.fill(),this.selected&&e.stroke(),e.restore()}getVertexes(){return this.points}update(e){let{min:t,max:n}=(new Ft).setFromPoints(e);return this.x=t.x,this.y=t.y,this.width=Math.abs(n.x-t.x),this.height=Math.abs(n.y-t.y),this.points=e,this}getBounds(){let e=this.getVertexes();return(new Ft).setFromPoints(e)}getData(){return{id:this.id,type:this.type,points:this.points.map((e=>[e.x,e.y,e.z]))}}setData(e){super.setData(e),this.setLineColor(cn.colorStr2Rgba(Us.MAJOR_COLOR)),this.setFillColor(cn.colorStr2Rgba(Us.AREA_FILL_COLOR)),this.setLineWidth(Us.LINE_WIDTH)}isPointInPath(e,t){let n=null==t?void 0:t.ray;if(!n)return!1;let r=3*this.tolerance,i=this.transToScreenCoord(e,t.camera);if(this.labelBounds.containsPoint(i))return!0;let a=new q,s=new q,o=this.points;for(let e=0;e<o.length-1;e++){let t=o[e],i=o[e+1]||o[0];if(n.distanceSqToSegment(t,i,s,a)<r*r)return!0}return!1}getUnitString(){return"Distance"===this.type?ex("mm"):"Area"===this.type?`${ex("m",2)}`:"Angle"===this.type?"Â°":""}},sr=Us;sr.MAJOR_COLOR="rgba(249, 157, 11, 0.9)",sr.MINOR_COLOR="rgb(255, 255, 255)",sr.AREA_FILL_COLOR="rgba(249, 157, 11, 0.3)",sr.LINE_WIDTH=2,sr.POINT_RADIUS=5,sr.LABEL_FONT_SIZE=14;var cb=class extends sr{constructor(e,t){super(e,t),this.type="Angle",this.update(t)}draw(e,t){e.save(),e.lineWidth=sr.LINE_WIDTH,e.strokeStyle=sr.MAJOR_COLOR;let n=this.points;if(e.beginPath(),n.forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),3===this.points.length){let[n,r,i]=this.points.map((e=>this.transToScreenCoord(e,t))),a=(new Te).subVectors(n,r).normalize(),s=(new Te).subVectors(i,r).normalize(),o=Math.min(n.distanceTo(r),i.distanceTo(r)),l=a.angle(),h=s.angle();e.moveTo(r.x,r.y),e.arc(r.x,r.y,o/5,l,h,a.cross(s)<0)}if(e.stroke(),e.restore(),this.drawing){let n=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,n)}this.drawText(e,t)}drawText(e,t){if(this.points.length<3)return;let[n,r,i]=this.points,a=this.getAngleBisector(n,r,i),s=this.calculateAngle(n,r,i);this.label=`${tc(s,2)} ${this.getUnitString()}`;let o=.3*Math.min(n.distanceTo(r),i.distanceTo(r));this.labelPositon=this.transToScreenCoord(r.clone().add(new q(a.x*o,a.y*o,a.z*o)),t),super.drawText(e,t)}getAngleBisector(e,t,n){let r=e,i=t,a=n,s=new q(r.x-i.x,r.y-i.y,r.z-i.z).normalize(),o=new q(a.x-i.x,a.y-i.y,a.z-i.z).normalize();return new q(s.x+o.x,s.y+o.y,s.z+o.z).normalize()}calculateAngle(e,t,n){let r=e,i=t,a=n,s=new q(r.x-i.x,r.y-i.y,r.z-i.z),o=new q(a.x-i.x,a.y-i.y,a.z-i.z);return 180*s.angleTo(o)/Math.PI}getClassType(){return"Angle"}};xn._registerDrawableClass(cb);var HC=class extends mc{constructor(e,t,n,r){super("Angle",e,t,n,r)}createMeasureDrawable(){if(this.drawingPoints)return new cb(Ct.guid(),this.drawingPoints)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let n=this.getIntersections(e)[0];if(!n)return;let r=null!=(t=this.snapPoint)?t:null==n?void 0:n.point;if(this.drawingPoints[0]&&Bt.areVector3sEqual(this.drawingPoints[0],r))return;let i=this.drawingPoints;i.push(r),this.lastMouseDownPosition=r,1===i.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(),i.length>=3&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.currentMeasureDrawable=void 0,this.drawingPoints=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.lastMouseDownPosition=void 0}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)}setTooltipContent(){var e;let t=Gr("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}},Wh=class extends sr{constructor(e,t,n){super(e,t),this.type="Area",this.scale=n,this.update(t)}draw(e,t){let n=this.points;if(e.save(),e.lineWidth=sr.LINE_WIDTH,e.strokeStyle=sr.MAJOR_COLOR,e.fillStyle=sr.AREA_FILL_COLOR,e.beginPath(),n.forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),e.closePath(),e.fill(),e.stroke(),e.restore(),this.drawing){let n=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,n)}this.drawText(e,t)}drawText(e,t){if(this.points.length<3)return;let n=this.points,r=this.calculateArea(n);this.scale&&(r*=Math.pow(this.scale,2)),this.label=`${tc(r,2)}`,this.labelPositon=this.transToScreenCoord(this.getBarycenter(n),t),super.drawText(e,t)}calculateArea(e){let t=0,n=Ld.getFaces(e);for(let r=0;r<n.length/3;r++){let i=e[n[3*r]],a=e[n[3*r+1]],s=e[n[3*r+2]],o=a.clone().sub(i),l=s.clone().sub(i);t+=o.cross(l).length()/2}return t}getBarycenter(e){let t=e.length,n=0,r=0,i=0;return e.forEach((e=>{n+=e.x,r+=e.y,i+=e.z})),new q(n/t,r/t,i/t)}isPointInPath(e,t){let n=null==t?void 0:t.ray;if(!n)return!1;let r=this.transToScreenCoord(e,t.camera);if(this.labelBounds.containsPoint(r))return!0;let i=3*this.tolerance,a=new q,s=new q,o=this.points;for(let e=0;e<o.length;e++){let t=o[e],r=o[e+1]||o[0];if(n.distanceSqToSegment(t,r,s,a)<i*i)return!0}let l=Ld.getFaces(this.points);for(let t=0;t<l.length/3;t++){let r=this.points[l[3*t]],i=this.points[l[3*t+1]],a=this.points[l[3*t+2]];if(n.intersectTriangle(r,i,a,!1,e))return!0}return!1}getClassType(){return"Area"}};xn._registerDrawableClass(Wh);var Wde=new q,VC=class extends mc{constructor(e,t,n,r){super("Area",e,t,n,r)}activate(){super.activate()}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable),this.exitButton&&(this.exitButton.style.display="none")}createMeasureDrawable(){if(this.drawingPoints)return new Wh(Ct.guid(),this.drawingPoints,this.scale)}onMouseMove(e){if(super.onMouseMove(e),this.drawingPoints&&this.drawingPoints.length>2&&this.drawingPoints[0]){let t=this.drawingPoints[0];Wde.subVectors(e,t).length()<3*this.viewer.getPixelSizeInWorldCoord()&&(this.osnapHelper.activateMarker(1,{point:t,type:1,distance:0}),fe.info("[Measure] auto close area measurement."))}}onMouseClick(e){var t,n;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;this.drawingPoints||(this.drawingPoints=[]);let r=this.drawingPoints;if(2===e.button)return void this.exitDrawing();let i=this.getIntersections(e)[0];if(!i)return void fe.warn("[Measure] No intersection found!");let a=null!=(n=null==(t=this.snapPoint)?void 0:t.clone())?n:null==i?void 0:i.point.clone();if(this.drawingPoints&&this.drawingPoints.length>2&&this.drawingPoints[0]){let e=this.drawingPoints[0];if(Wde.subVectors(a,e).length()<3*this.viewer.getPixelSizeInWorldCoord())return fe.info("[Measure] auto close area measurement."),this.touchDowned=!1,void this.exitDrawing()}this.drawingPoints[0]&&Bt.areVector3sEqual(this.drawingPoints[0],a)||(r.push(a),this.lastMouseDownPosition=a,1===r.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable())}exitDrawing(){let e=this.drawingPoints||[],t=!0;if(e.length<3&&(fe.warn("[Measure] If the number of points is less than 3, the measurement area cannot be formed !"),t=!1),t&&Ld.isSelfIntersecting(e)&&(fe.warn("[Measure] The area formed by these points intersects itself, so the correct measurement cannot be obtained !"),t=!1),!t)return this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,void(this.lastMouseDownPosition=void 0);this.createOrUpdateMeasureDrawable(),this.complete()}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.lastMouseDownPosition=void 0}setTooltipContent(){var e;let t=Gr("Tooltip.areaMeasurement");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}getScale(){return this.scale}setScale(e){this.scale=e;let t=this.drawList.getDrawables();for(let n of t){let t=n[1];t instanceof Wh&&(t.scale=e)}}},ub=class extends sr{constructor(e,t){super(e,t),this.type="Coordinate",this.update(t)}draw(e,t){this.drawText(e,t),e.save(),e.lineWidth=sr.LINE_WIDTH,e.strokeStyle=sr.MAJOR_COLOR,e.fillStyle=sr.AREA_FILL_COLOR;let n=this.points;e.beginPath(),n.forEach((n=>{let r=this.transToScreenCoord(n,t);e.arc(r.x,r.y,sr.POINT_RADIUS,0,2*Math.PI)})),e.fill(),e.stroke(),e.restore()}drawText(e,t){let n=this.points[0];Bt.areNumbersEqual(n.x,0);let r=Bt.areNumbersEqual(n.x,0)?0:n.x,i=Bt.areNumbersEqual(n.y,0)?0:n.y,a=Bt.areNumbersEqual(n.z,0)?0:n.z;this.label=`${tc(r,2)}, ${tc(i,2)}, ${tc(a,2)}`,e.font=`${sr.LABEL_FONT_SIZE}px Arial`;let s=1.2*e.measureText(this.label).width,o=1.5*sr.LABEL_FONT_SIZE;this.labelPositon=this.transToScreenCoord(n,t),this.labelPositon.y-=o/2,this.labelBounds.setFromCenterAndSize(this.labelPositon,new Te(s,o)),this.drawRoundRect(e,this.labelPositon.x-s/2,this.labelPositon.y-o/2,s,o,4),e.save(),e.fillStyle=sr.MINOR_COLOR,e.textBaseline="middle",e.textAlign="center",e.fillText(this.label,this.labelPositon.x,this.labelPositon.y),e.restore()}getClassType(){return"Coordinate"}};xn._registerDrawableClass(ub);var zC=class extends mc{constructor(e,t,n,r){super("Coordinate",e,t,n,r)}createMeasureDrawable(){if(this.drawingPoints)return new ub(Ct.guid(),this.drawingPoints)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let n=this.getIntersections(e)[0];if(!n)return;let r=null!=(t=this.snapPoint)?t:null==n?void 0:n.point,i=this.drawingPoints;i.push(r),this.lastMouseDownPosition=r,1===i.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(r),i.length>=1&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){!0!==this.completed&&(this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}setTooltipContent(){var e;let t=Gr("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}},UN=class extends sr{constructor(e,t,n){super(e,t),this.type="Distance",this.scale=n,this.update(t)}draw(e,t){let n=this.points;if(e.save(),e.lineWidth=sr.LINE_WIDTH,e.strokeStyle=sr.MAJOR_COLOR,e.beginPath(),n.forEach(((n,r)=>{let i=this.transToScreenCoord(n,t);0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)})),e.closePath(),e.stroke(),e.restore(),this.drawing){let n=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,n)}else this.selected||this.drawVerticalLine(e,t);this.drawText(e,t)}drawText(e,t){if(this.points.length<2)return;let[n,r]=this.points,i=n.distanceTo(r);this.scale&&(i*=this.scale),this.label=`${tc(i,2)}`,this.labelPositon=this.transToScreenCoord((new q).lerpVectors(n,r,.5),t),super.drawText(e,t)}drawVerticalLine(e,t){if(this.points.length<2)return;let[n,r]=this.points.map((e=>this.transToScreenCoord(e,t))),[i,a]=this.getShortLineBySegments(n,r),[s,o]=this.getShortLineBySegments(r,n);e.save(),e.lineWidth=sr.LINE_WIDTH,e.strokeStyle=sr.MAJOR_COLOR,e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.restore()}getShortLineBySegments(e,t){let n=(new Te).subVectors(t,e).normalize(),r=UN.SHORT_LINE_LENGTH/2,i=Math.PI/2;return[n.clone().rotateAround(new Te,i).normalize().multiplyScalar(r).add(e),n.clone().rotateAround(new Te,-i).normalize().multiplyScalar(r).add(e)]}getClassType(){return"Distance"}setScale(e){this.scale=e}},Qd=UN;Qd.SHORT_LINE_LENGTH=12,xn._registerDrawableClass(Qd);var qC=class extends mc{constructor(e,t,n,r){super("Distance",e,t,n,r)}createMeasureDrawable(){if(this.drawingPoints)return new Qd(Ct.guid(),this.drawingPoints,this.scale)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let n=this.getIntersections(e)[0];if(!n)return;let r=null!=(t=this.snapPoint)?t:null==n?void 0:n.point;if(this.drawingPoints[0]&&Bt.areVector3sEqual(this.drawingPoints[0],r))return;let i=this.drawingPoints;i.length<2&&i.push(r),this.lastMouseDownPosition=r,1===i.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(),i.length>=2&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;e&&e.length>0&&(e.pop(),0===e.length&&(this.completed=!0),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)),this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)}setTooltipContent(){var e;let t=Gr("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}getScale(){return this.scale}setScale(e){this.scale=e;let t=this.drawList.getDrawables();for(let n of t){let t=n[1];(t instanceof Qd||t instanceof Wh)&&(t.scale=e)}}},si=class extends as{constructor(e,t){if(!t.id)throw new Error("[Plugin] Missing plugin id!");super(),this.id=t.id,this.viewer=e,e.addPlugin(this)}destroy(){this.viewer.removePlugin(this)}},HN=class extends si{constructor(e){var t,n;super(e,{id:HN.DEFAULT_ID}),this.selectedDrawable=void 0,this.drawableList=new $a("measure"),this.drawableHelperList=new $a("touchHelper"),this.snapToleranceInPixel=3,this.measurements={},this.activeMeasurementType=void 0,this.keydown=e=>{var t;let n,r=this.getActiveMeasurementType();r&&(n=this.measurements[r]);let i=this.selectedDrawable;i&&"Delete"===e.code&&(this.remove(i),null==(t=this.viewer.undoManager)||t.addCommand(new FC(this,i.getData())),this.activeMeasurementType&&this.measurements[this.activeMeasurementType].clearClickedDrawable()),e.ctrlKey&&"KeyZ"===e.code&&null!=n&&n.isMeasuring&&n.cancel(),e.ctrlKey&&"KeyY"===e.code&&null!=n&&n.isMeasuring};let r=e.getInputManager();if(!r)throw"InputManager init error";this.inputManager=r,this.overlayRender=this.viewer.overlayRender,null==(t=this.overlayRender)||t.addDrawableList(this.drawableHelperList),null==(n=this.overlayRender)||n.addDrawableList(this.drawableList);let i=new AC(this.overlayRender);e.is3d()&&(i.setOSnapTypeEnabled(32,!1),i.setOSnapTypeEnabled(64,!1)),this.measurements.Distance=new qC(e,r,this.drawableList,i),this.measurements.Area=new VC(e,r,this.drawableList,i),this.measurements.Angle=new HC(e,r,this.drawableList,i),this.measurements.Coordinate=new zC(e,r,this.drawableList,i),this.osnapHelper=i,this.inputManager.addEventListener("wheel",(()=>{this.updateSnapTolerance()})),this.viewer.addEventListener("layoutchange",(()=>{this.updateSnapTolerance()})),this.initEvents()}initEvents(){Object.values(this.measurements).forEach((e=>{e.addEventListener("complete",(e=>{var t;this.viewer.dispatchEvent("measurementadd",e.getData()),null==(t=this.viewer.undoManager)||t.addCommand(new lb(this,e.getData())),this.select(e)})),e.addEventListener("beforeadd",(e=>{this.add(e,!1)})),e.addEventListener("update",(()=>{this.render()})),e.addEventListener("beforeremove",(e=>{this.remove(e,!1)})),e.addEventListener("deactivate",(()=>{this.osnapHelper.deactivate(),this.viewer.deactivateMeasurement()})),e.addEventListener("firstpointpicked",(()=>{this.unselect()})),e.addEventListener("onclick",(e=>{this.select(e)}))}))}get canvas(){var e;return null==(e=this.viewer.renderer)?void 0:e.domElement}get raycaster(){return this.viewer.getRaycaster()}add(e,t=!0){this.drawableList.addDrawable(e),this.selectedDrawable=e,this.render(),t&&this.viewer.dispatchEvent("measurementadd",e.getData())}create(e){return xn.createDrawable(e)}remove(e,t=!0){this.drawableList.removeDrawable(e),this.render(),t&&this.viewer.dispatchEvent("measurementremove",e.getData())}setSnapTolerance(e){this.snapToleranceInPixel=e,this.updateSnapTolerance()}updateSnapTolerance(){let e=this.viewer.getPixelSizeInWorldCoord()*this.snapToleranceInPixel;this.osnapHelper.setSnapTolerance(e)}activate(e){this.activeMeasurementType&&this.deactivate(),this.measurements[e]?(this.measurements[e].activate(),this.activeMeasurementType=e,this.updateSnapTolerance()):(this.activeMeasurementType=void 0,fe.error("[Measure] Failed to activate measurement, type:",e));let{width:t,height:n}=this.canvas.getBoundingClientRect();Bn.isMobile&&this.canvas&&!this.mobileTouchHelper&&(this.mobileTouchHelper=new IC(new Te(t/2,n/2)),this.drawableHelperList.addDrawable(this.mobileTouchHelper)),this.mobileTouchHelper&&(this.mobileTouchHelper.setPosition(new Te(t/2,n/2)),this.measurements[e].setTouchHelper(this.mobileTouchHelper),this.mobileTouchHelper.visible=!0,this.render()),this.enableSelection=this.viewer.enableSelection,this.viewer.enableSelection=!1,this.inputManager.addEventListener("keydown",this.keydown)}deactivate(){this.unselect();let e=this.activeMeasurementType;e&&this.measurements[e].deactivate(),this.activeMeasurementType=void 0,this.mobileTouchHelper&&(this.mobileTouchHelper.visible=!1,this.render()),null!=this.enableSelection&&(this.viewer.enableSelection=this.enableSelection),this.enableSelection=void 0,this.inputManager.removeEventListener("keydown",this.keydown)}getActiveMeasurementType(){return this.activeMeasurementType}isActive(){let e=this.activeMeasurementType;return e?this.measurements[e].isActive:!!this.getActiveMeasurementType()}isMeasuring(){let e=this.activeMeasurementType;return!!e&&this.measurements[e].isMeasuring}getData(){return this.drawableList.getDrawableDatas()}cancel(){let e=this.activeMeasurementType;e&&this.measurements[e].exitDrawing()}setData(e){var t,n;null==(t=this.viewer.undoManager)||t.startTransaction(),e.forEach((e=>{var t;this.measurements[e.type]?e.points.length>=2?(this.add(xn.createDrawable(e)),null==(t=this.viewer.undoManager)||t.addCommand(new lb(this,e))):fe.info("[Measure] Invalid points found in MeasurementData:",e):fe.warn("[Measure] Failed to add measurement data for",e)})),null==(n=this.viewer.undoManager)||n.endTransaction()}setVisibleById(e,t){let n=this.drawableList.getDrawables().get(e);return!!n&&(n.visible!==t&&(n.visible=t,this.render()),!0)}setVisibilities(e){let t=!1;this.drawableList.getDrawables().forEach((n=>{n.visible!==e&&(n.visible=e,t=!0)})),t&&this.render()}clear(){let e=this.activeMeasurementType;e&&this.measurements[e].exitDrawing(),this.drawableList.clear(),this.render()}getById(e){return this.drawableList.getDrawableById(e)}removeById(e){let t=this.drawableList.getDrawableById(e);t?this.remove(t):fe.warn("[Measure] Failed to find measurement by id:",e)}selectById(e){let t=this.drawableList.getDrawableById(e);t&&this.select(t)}select(e){this.unselect(!1),e.selected=!0,this.selectedDrawable=e,this.render()}unselect(e=!0){this.selectedDrawable&&(this.selectedDrawable.selected=!1,e&&this.render()),this.selectedDrawable=void 0}getScale(){return this.measurements.Distance.getScale()}setScale(e){if(!e||e<=0)return void fe.error("[Measure] Invalid scale value:",e);let t=this.measurements.Distance,n=this.measurements.Area;t.setScale(e),n.setScale(e)}destroy(){super.destroy(),this.deactivate(),this.clear(),this.drawableHelperList.clear(),this.measurements={},this.osnapHelper.destroy(),this.render()}render(e=!1){var t;e?this.viewer.enableRender():null==(t=this.overlayRender)||t.render()}},ep=HN;ep.DEFAULT_ID="MeasurementPlugin";var wdt=-1e3,GC=new q,jde=new At,Xde=new ul,VN=new Ft,jh=class extends NC{constructor(e){super(e),this.name="Viewer2d",this.loadedModels=[],this.masterModelId="",this.activeLayoutName="",this.layoutInfos={},this.units=void 0,this.enableHideVisuallySmallObjects=!0,this.sortedHidableObjects={},this.lastCameraZoom=1/0,this.loadingDxfCount=0,e.enableLayoutBar&&(this.dxfLayoutBar=new BC(this)),this.cameraManager.setProjection("Orthographic"),this.cameraManager.setNavigationMode(2);let t=new q(0,0,100),n=new q(0,0,0);this.cameraManager.setCameraConfig({eye:t,look:n}),this.resize(),this.setupDefaultEvents(),this.setDefaultBackground(),this.addEventListener("beforerender",(()=>{this.updateRaycasterThreshold(),this.updateCameraZoomUniform(this.camera.zoom),this.updateHidableObjectsVisibility()}))}get camera(){return this.cameraManager.camera}setupDefaultEvents(){let e=!1,t=!1;this.inputManager.addEventListener("pointerdown",(n=>{var r;t=!1,e=!0,1===n.button&&(null==(r=this.inputManager)||r.setCursor("move"))})),this.inputManager.addEventListener("pointermove",(()=>{var n;e&&(t=!0,null==(n=this.inputManager)||n.setCursor("move"))})),this.inputManager.addEventListener("pointerup",(n=>{var r;if(e=!1,null==(r=this.inputManager)||r.setCursor("default"),t)return void(t=!1);this.handleMouseClick(n);let i={event:n};if(this.selectedObject&&this.selectedObject instanceof qr&&(i.markupData=this.selectedObject.getData()),this.selectedObject&&this.selectedObject instanceof sr&&(i.measureData=this.selectedObject.getData()),this.selectedObject&&this.selectedObject instanceof Cn){let e=t=>!t.userData.modelId&&t.parent?e(t.parent):t.userData.modelId;i.entityData={modelId:e(this.selectedObject),layerName:this.selectedObject.userData.layerName}}this.dispatchEvent("mouseclick",i)}))}handleMouseClick(e){if(!this.enableSelection)return;let t=new Te(e.x,e.y),n=this.getWorldPositionByMousePick(t);if(!n)return;let r=this.overlayRender.getDrawablesByPosition(n)[0];if(r)return this.selectedObject===r?(this.selectedObject.selected=!1,this.selectedObject=void 0):(this.selectedObject&&this.clearSelection(),this.selectedObject=r,this.selectedObject.selected=!0),void this.enableRender();let i=this.pickObject(t,[12]);if(i)return this.selectedObject===(null==i?void 0:i.object)?(this.setObjectUnHighlight(this.selectedObject),this.selectedObject=void 0):(this.selectedObject&&this.clearSelection(),this.selectedObject=null==i?void 0:i.object,this.setObjectHighlight(this.selectedObject)),void this.enableRender();this.clearSelection(),this.enableRender()}setDefaultBackground(){this.setBackgroundColor(.0295,.0212,.0152)}loadModel(e,t){return Et(this,null,(function*(){var n,r;let i=this.getUniqueModelId(e.modelId||e.src);this.spinner.increaseJobCount(),this.loaderHelper.setFont(this.fontManager),this.masterModelId||(this.masterModelId=i);let a=i,s=Gr("ProgressBar.Loading"),o=e=>{var n;null==(n=this.progressBar)||n.updateProgress(a,s,e),t&&t(new ProgressEvent("LoadProgress",{loaded:e,total:100}))},l=(e,n,r)=>{var i;let o=100*e.loaded/e.total;o=o*(r-n)/100+n,null==(i=this.progressBar)||i.updateProgress(a,s,o),t&&t(new ProgressEvent("LoadProgress",{loaded:o,total:100}))};null==(n=this.progressBar)||n.addProgressItem(a),o(0);let h=this.viewerCfg,u=yield this.loaderHelper.loadDxfData(e.src,e.modelId,(e=>l(e,0,90)),void 0,{ignorePaperSpace:e.ignorePaperSpace,enableLocalCache:h.enableLocalCache,enableMerge:e.merge,encoding:e.encoding,overrideColor:e.overrideColor}).finally((()=>{this.loadingDxfCount--,0===this.loadingDxfCount&&this.fontManager&&this.fontManager.releaseFontData()})),c=u.threejsObject;if(e.matrix&&16===e.matrix.length){let t=new At;t.elements=e.matrix,c.applyMatrix4(t)}let d=new Uo({modelId:i,dxfData:u});this.addModel(d),this.spinner.decreaseJobCount(),o(100),null==(r=this.progressBar)||r.delayRemoveProgressItem(a),this.dispatchEvent("modelload")}))}addModel(e){super.addModel(e);let t=e.modelId;if(e.dxfData){this.masterModelId===t?this.activateLayout(bn.MODEL_LAYOUT_NAME):this.handleOverlayDxf(t);let n=e.getBBox(),r=new q;n.getCenter(r),this.cameraManager.adjustCameraByBBox(n);let i=this.getDxfUnits(e);this.masterModelId===t&&(this.units=i)}else{let t=e.getModelObject();this.activeLayoutName=bn.MODEL_LAYOUT_NAME;let n=(new Ft).setFromObject(t);this.layoutInfos[this.activeLayoutName]={homeViewExtent:n,extent:n},t.matrixAutoUpdate=!1,this.scene.add(t);let r=n.max.z;r>this.camera.position.z&&(this.camera.position.z=r,this.camera.updateProjectionMatrix()),this.flyToObject(t)}this.updateGroundPlane()}getDxfUnits(e){return!e&&this.loadedModels.length>0&&(e=this.loadedModels.find((e=>this.masterModelId===e.modelId))),e?e.getUnits():"Unitless"}handleOverlayDxf(e){let t=this.loadedModels.find((t=>e===t.modelId));if(!t)return void fe.warn(`[Viewer] Can't find model for modelId '${e}'!`);t.switchTransformMs(bn.MODEL_LAYOUT_NAME);let n=t.getLayoutLevelObject(bn.MODEL_LAYOUT_NAME);n&&n.traverse((e=>{t.addSpatialFilterSection(e,t.dxfData)})),t.showLayoutObjects(bn.MODEL_LAYOUT_NAME)}setObjectHighlight(e){this.loadedModels.forEach((t=>t.highlightObject(e))),this.enableRender()}setObjectUnHighlight(e){this.loadedModels.forEach((t=>t.unHighlightObject(e))),this.enableRender()}clearHighlight(){this.loadedModels.forEach((e=>e.clearHighlight())),this.enableRender()}clearSelection(){this.selectedObject instanceof Cn&&this.setObjectUnHighlight(this.selectedObject),this.selectedObject instanceof Ei&&(this.selectedObject.selected=!1),this.selectedObject=void 0}get enableSelection(){return this._enableSelection}set enableSelection(e){e||this.clearSelection(),this._enableSelection=e}updateGroundPlane(){let e=this.getActiveLayoutInfo();if(!e.homeViewExtent)return;let t=e.homeViewExtent.clone(),n=[],r=(e,t,r)=>{n.push(new q(e,t,r))},i=t.getSize(new q),a=t.getCenter(new q);if(r(-i.x/2,-i.y/2,0),r(i.x/2,-i.y/2,0),r(i.x/2,i.y/2,0),r(-i.x/2,i.y/2,0),this.groundPlane)this.groundPlane.position.set(a.x,a.y,-i.z),this.groundPlane.geometry.setFromPoints(n),this.groundPlane.geometry.computeBoundingSphere(),this.groundPlane.geometry.computeBoundingBox();else{let e=new Nt;e.setFromPoints(n),e.setIndex([0,3,2,0,2,1]);let t=new mr({color:"#888",side:Mr});this.groundPlane=new Jt(e,t),this.groundPlane.visible=!1,this.groundPlane.position.set(a.x,a.y,-i.z),this.groundPlane.scale.set(1e5,1e5,1),this.groundPlane.name="groundPlane",this.groundPlane.renderOrder=wdt,this.groundPlane.layers.enableAll(),yr.disableLayerChannels(this.groundPlane,[12]),this.scene.add(this.groundPlane)}this.groundPlane.updateMatrix(),this.groundPlane.updateMatrixWorld(!0)}getRaycastableObjects(){var e,t,n;let r=[],i=Date.now();if(this.activeLayoutName===bn.MODEL_LAYOUT_NAME){if(this.raycastableObjects)return this.raycastableObjects;if(null!=(e=this.renderer)&&e.renderLists){let e=null==(t=this.renderer)?void 0:t.renderLists.get(this.scene,0);e&&(e.opaque.forEach((e=>{e.object&&e.object.geometry&&r.push(e.object)})),e.transparent.forEach((e=>{e.object&&e.object.geometry&&r.push(e.object)})))}jde.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),Xde.setFromProjectionMatrix(jde);for(let e of this.loadedModels){let t=e.getModelObject().children.find((e=>e.name===this.activeLayoutName));if(t){let e=t.children.find((e=>e.name===bn.SNAP_GROUP_NAME));null==e||e.traverse((e=>{if(yr.isLeafObject(e)){if(VN.makeEmpty(),VN.expandByObject(e),!Xde.intersectsBox(VN))return;r.push(e)}}))}}this.groundPlane&&r.push(this.groundPlane),fe.debug("[Viewer] getRaycastableObjectsByMouse() from modelSpace"),this.raycastableObjects=r}else{let e=new WeakSet,t=this.getLayoutByName(this.activeLayoutName);if(t){let n=t.directAssociatedLeafObjectSet;n&&n.forEach((t=>{t.visible&&!e.has(t)&&(r.push(t),e.add(t))}))}let i=this.getViewportByPoint(this.pickManager.getRaycaster().ray.origin);i&&i.associatedLeafObjectSet?(null==(n=i.associatedLeafObjectSet)||n.forEach((t=>{!e.has(t)&&(t.visible||t.userData.isSnapObject)&&(r.push(t),e.add(t))})),fe.debug("[Viewer] getRaycastableObjectsByMouse() from inside of viewport:",i.viewportId)):fe.debug("[Viewer] getRaycastableObjectsByMouse() from out of viewport"),this.groundPlane&&r.push(this.groundPlane)}return fe.debug(`[Viewer] getRaycastableObjectsByMouse() took ${(Date.now()-i)/1e3} s`),r}getViewportByPoint(e){if(0===this.activeLayoutName.length||this.activeLayoutName===bn.MODEL_LAYOUT_NAME)return;let t=this.getLayoutByName(this.activeLayoutName);if(!t)return;let n=t=>e.x<t.min.x||e.x>t.max.x||e.y<t.min.y||e.y>t.max.y,r=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!r)return;let i=r.getFilteredViewports(t);for(let e=0,t=i.length;e<t;e++){let t=i[e];if(!n(t.psBBox))return t}}getWorldPositionByMousePick(e){var t;let n=[];return this.groundPlane&&n.push(this.groundPlane),null==(t=this.pickManager.pickObject(e,n))?void 0:t.point}activateLayout(e=bn.MODEL_LAYOUT_NAME){if(this.activeLayoutName===e||!this.masterModelId)return;let t=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!t)return;let n=t.getLayoutByName(e);if(!n)return;let r=this.getActiveLayoutInfo();if(this.groundPlane){let e=this.getCurrentViewExtent(),t=this.camera.position.z;r.lastViewExtent=new Ft(new q(e.min.x,e.min.y,0),new q(e.max.x,e.max.y,t))}let i=(e=>{let t=this.layoutInfos[e];return!(null==t||!t.lastViewExtent)})(e);null==t||t.activateLayout(e,i),this.activeLayoutName=e;let a=t.getFilteredViewports(n);if(fe.debug("[Viewer] Active layout:",e,", viewports:",a),!i){let e=this.camera.position.z,t=0;a.forEach((e=>{var n;let r=null==(n=null==e?void 0:e.msToPsMatrix)?void 0:n.elements[14];r&&r>t&&(t=r)}));let n=this.cameraManager.getPosition();if(t>n.z+e){let r=Math.ceil(t+e);n.z=r,fe.info(`[Viewer] Changing camera's z value from ${n.z} to ${r}`),this.cameraManager.setCameraPosition(n)}}let s=this.getActiveLayoutInfo();if(s.lastViewExtent)this.zoomToBBox(s.lastViewExtent);else{s.extent=this.getBBox();let e=this.getLayoutExtentEx(n);if(e){let t=e.max.x-e.min.x,n=e.max.y-e.min.y;(t<1e-16||n<1e-16||t>1e16||n>1e16)&&(fe.warn(`[Viewer] Got wired bbox, max: ${e.max.toArray()}, min: ${e.min.toArray()}, going to use the calculated one...`),e=s.extent)}else fe.warn("[Viewer] Failed to get layout extent, going to use the calculated one..."),e=s.extent;s.homeViewExtent=e,this.zoomToBBox(e)}let o=t.getLayoutLevelObject(e);o&&this.setLayoutHidableObjectArray(o),this.enableRender()}getLayoutExtentEx(e){let t=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(t)return e.layoutName===bn.MODEL_LAYOUT_NAME?t.getModelSpaceExtent():t.getLayoutExtent(e)}getActiveLayoutInfo(){return this.getLayoutInfo(this.activeLayoutName)}getLayoutByName(e){let t,n=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!n)return;let r=n.getLayouts();for(let n of r)if(n.layoutName===e){t=n;break}return t}getEntityCount(){let e=0;return this.loadedModels.forEach((t=>{e+=t.loadedEntityCount})),e}getLayoutNames(){let e=[],t=this.loadedModels.find((e=>this.masterModelId===e.modelId));return((null==t?void 0:t.getLayouts())||[]).forEach((t=>{e.push(t.layoutName)})),e}getLayoutInfo(e){return this.layoutInfos[e]||(this.layoutInfos[e]={}),this.layoutInfos[e]}goToHomeView(){let e=this.getActiveLayoutInfo();e.homeViewExtent?this.zoomToBBox(e.homeViewExtent):fe.error(`[Viewer] Failed to find extent for ${this.activeLayoutName}`)}zoomToBBox(e){let t=e.getCenter(GC),n=e.max.x-e.min.x,r=e.max.y-e.min.y,i=this.camera.right-this.camera.left,a=this.camera.top-this.camera.bottom,s=Math.min(i/n,a/r);s/=1.1,this.cameraManager.cameraControls.moveTo(t.x,t.y,t.z),this.cameraManager.cameraControls.zoomTo(s)}getCurrentViewExtent(){let e=this.getHitResultByNdcCoordinate(new Te(-1,-1)),t=this.getHitResultByNdcCoordinate(new Te(1,1));return new Vr(e,t)}getHitResultByNdcCoordinate(e){let t=[];this.groundPlane&&t.push(this.groundPlane);let n=this.pickManager.pickObjectsByNdc(e,t);if(n.length>0){let e=n[0].point;return new Te(e.x,e.y)}}getHitResult(e){let t=this.viewerContainer,n=mn.getScreenCoordinateByEvent(e,t),r=mn.screen2Ndc(n,this.camera,t);return this.getHitResultByNdcCoordinate(r)}getActiveLayoutName(){return this.activeLayoutName}zoomIn(e=.01){this.cameraManager.cameraControls.zoom(e)}zoomOut(e=.01){this.cameraManager.cameraControls.zoom(-e)}getLayers(){let e=[];if(this.masterModelId){let t=this.loadedModels.find((e=>this.masterModelId===e.modelId)),n=null==t?void 0:t.layers;n&&e.push({modelId:this.masterModelId,layers:n})}for(let t of this.loadedModels){let n=t.modelId;if(n===this.masterModelId)continue;let r=t.layers;r&&e.push({modelId:n,layers:r})}return e}setModelVisibility(e,t){let n=this.loadedModels.find((t=>e===t.modelId));if(!n)throw new Error(`Failed to find model by modelId '${e}'!`);n.setVisible(t),this.enableRender()}setLayerVisibility(e,t,n){let r=this.camera;n=n||this.masterModelId;let i=this.loadedModels.find((e=>n===e.modelId));if(!i)throw new Error(`Failed to find layer by modelId '${n}'!`);i.setLayerVisible(e,t,this.enableHideVisuallySmallObjects,r.zoom),this.raycastableObjects=void 0,this.enableRender()}setLayerOpacity(e,t,n){n=n||this.masterModelId;let r=this.loadedModels.find((e=>n===e.modelId));if(!r)throw new Error(`Failed to find layer by modelId '${n}'!`);r.setLayerOpacity(e,t),this.enableRender()}setLayerColor(e,t,n){n=n||this.masterModelId;let r=this.loadedModels.find((e=>n===e.modelId));if(!r)throw new Error(`Failed to find layer by modelId '${n}'!`);this.clearSelection(),r.setLayerColor(e,t),this.enableRender()}resetLayerColor(e,t){t=t||this.masterModelId;let n=this.loadedModels.find((e=>t===e.modelId));if(!n)throw new Error(`Failed to find model by modelId '${t}'!`);this.clearSelection(),n.resetLayerColor(e),this.enableRender()}getVisiblePixelSize(e){let t=6.5*zr.smoothstep(e,1e4,3e4)+.5;return fe.debug("[Viewer] visiblePixelSize:",t),t}setLayoutHidableObjectArray(e){let t=this.camera;if(!this.enableHideVisuallySmallObjects||!t)return;let n=Date.now(),r=e.name;this.sortedHidableObjects[r]||(this.sortedHidableObjects[r]=[]);let i=this.sortedHidableObjects[r];this.cameraManager.update(0);let a=t.zoom;this.lastCameraZoom=a;let s=1;e.traverse((e=>{if(e.userData.isSnapObject||!yr.isLeafObject(e))return;let t=e.geometry;t.boundingBox||t.computeBoundingBox();let n=t.boundingBox.clone();if(!n||!Ct.isBoxValid(n))return;n.applyMatrix4(e.matrixWorld),n.getSize(GC);let r=Math.max(GC.x,GC.y),a=s/r;a<1/0?i.push({visibleMinZoom:a,object:e}):e instanceof Ni?i.push({visibleMinZoom:s,object:e}):fe.warn("[Viewer] The size of bbox is 0 ! ",e)})),s=this.getVisiblePixelSize(i.length);let o=0;i.forEach((e=>{let t=e.visibleMinZoom*s;e.visibleMinZoom=t,e.object.userData.visibleMinZoom=t,t>a&&(e.object.visible=!1,o++)})),i.sort(((e,t)=>e.visibleMinZoom-t.visibleMinZoom)),fe.debug(`[Viewer] setLayoutHidableObjectArray took: ${(Date.now()-n)/1e3}s,             ${o} objects changed to hidden`)}updateRaycasterThreshold(){let e=3*this.getPixelSizeInWorldCoord(),t=this.getRaycaster().params;t.Line?t.Line.threshold=e:t.Line={threshold:e},t.Points?t.Points.threshold=e:t.Points={threshold:e}}updateHidableObjectsVisibility(){let e=this.camera,t=Date.now();this.cameraManager.update(0);let n=e.zoom;if(Math.abs(n-this.lastCameraZoom)<1e-5||(this.updateRaycasterThreshold(),this.updateCameraZoomUniform(n),this.raycastableObjects=void 0,!this.sortedHidableObjects[this.activeLayoutName]))return;let r=this.sortedHidableObjects[this.activeLayoutName];if(0===r.length)return;let i=n>this.lastCameraZoom,a=Math.min(n,this.lastCameraZoom),s=Math.max(n,this.lastCameraZoom),o=[],l=0;for(let e=0;e<r.length;++e)if(!1!==r[e].object.userData.layerVisible){if(r[e].visibleMinZoom<a){o.push(r[e].object);continue}if(r[e].visibleMinZoom>s)break;r[e].object.visible=i,i&&o.push(r[e].object),l++}this.lastCameraZoom=n,fe.debug(`[Viewer] updateHidableObjectsVisibility took: ${(Date.now()-t)/1e3}s,             ${l}(out of ${r.length}) objects changed to ${i?"visible":"hidden"}`)}updateCameraZoomUniform(e){bn.CameraZoomUniform.value=e*this.container.height/50}},Yde=new q,Mdt=(e=>(e.StartDraw="StartDraw",e.EndDraw="EndDraw",e.EndEdit="EndEdit",e))(Mdt||{}),zN=class extends si{constructor(e){super(e,{id:zN.DEFAULT_ID}),this.drawableList=new $a("markup"),this.lineWidth=2,this.lineColor=[1,0,0,1],this.fillColor=[1,0,0,.3],this.fontSize=20,this.mouseDown=!1,this.mouseDownPositionX=void 0,this.mouseDownPositionY=void 0,this.isSelectLeaderText=!1,this.isDrawing=!1,this.tempPoints=[],this.activated=!1,this.handleDbClick=()=>{},this.handleInputMousemove=e=>{if(!this.mouseDown&&"CloudRectWithTextMarkup"===this.type&&this.isDrawing&&this.creatingShape){let t=mn.getScreenCoordinateByEvent(e,this.viewerCanvas);this.creatingShape.updateInputPosition(this.mousedownPoint,t),this.render()}},this.mousedown=e=>{var t;if(e.pointers&&e.pointers.length>1)return;let n=new Te(e.x,e.y),r=this.pickPositionByScreenPoint(n);if(r){if(r.z=0,this.mouseDownPositionX=r.x,this.mouseDownPositionY=r.y,this.mousedownPoint=new Te(e.x,e.y),0===e.button&&(this.mouseDown=!0),2===e.button)return void(this.isDrawing&&this.endDraw(this.creatingShape));if(this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0,this.render()),!this.isDrawing){let e=this.drawableList.getDrawableByPosition(r);e&&(this.selectedShape=e,e.selected=!0,e instanceof Fd&&(this.isSelectLeaderText=e.isLeaderTextSelected(r)),this.render())}if(this.isCreateTextMode()&&this.mouseDown&&!this.selectedShape){this.creatingShape||(this.creatingShape=this.drawText(r,""));let t=this.creatingShape;0===t.text.length?(t.setTolerance(this.viewer.getPixelSizeInWorldCoord()),t.update([r]),t.addInput(this,e.x,e.y)):(t.exitEditing(),this.addMarkup(t,!1),this.endDraw(t)),this.render()}if(this.isCreateLineMode()&&this.mouseDown&&!this.selectedShape){if(this.tempPoints.length>0){let e=this.tempPoints[0];if(Yde.subVectors(e,r).length()<5*this.viewer.getPixelSizeInWorldCoord())return r=this.tempPoints[0].clone(),this.tempPoints.push(r),void this.endDraw(this.creatingShape)}if(this.isDrawing=!0,this.tempPoints.push(r),!this.creatingShape){let e=this.creatingShape=this.drawLine([...this.tempPoints,r]);e&&this.addMarkup(e,!1)}this.creatingShape&&(this.creatingShape.update([...this.tempPoints,r]),this.render()),this.dispatchEvent("StartDraw",this.creatingShape)}if(this.isCreateDotMode()&&this.mouseDown&&!this.selectedShape){if(!this.creatingShape){let e=this.creatingShape=this.drawShape(r);e&&this.addMarkup(e,!1)}this.isDrawing=!0,this.render()}null==(t=this.creatingShape)||t.setTolerance(this.viewer.getPixelSizeInWorldCoord())}},this.mousemove=e=>{if(e.pointers&&e.pointers.length>1)return;let t=new Te(e.x,e.y),n=this.pickPositionByScreenPoint(t);if(n)if(this.selectedShape){if(this.mouseDown&&void 0!==this.mouseDownPositionX&&void 0!==this.mouseDownPositionY){this.isEditing()||(this.initialDataForEditing=this.selectedShape.getData());let e=n.x-this.mouseDownPositionX,t=n.y-this.mouseDownPositionY;this.selectedShape instanceof Fd&&this.isSelectLeaderText?this.selectedShape.translateLeaderText(e,t):this.selectedShape.translate(e,t),this.render(),this.mouseDownPositionX=n.x,this.mouseDownPositionY=n.y}}else{if(this.isCreateDotMode())return;if(this.mouseDown&&this.isCreateShapeMode()&&void 0!==this.mouseDownPositionX&&void 0!==this.mouseDownPositionY){let e=new q(this.mouseDownPositionX,this.mouseDownPositionY,0);if(!this.creatingShape){let t=this.creatingShape=this.drawShape(e,n);t&&this.addMarkup(t,!1)}this.creatingShape.update([e,n]),this.isDrawing=!0,this.render()}if(this.isCreateLineMode()&&this.tempPoints.length>0&&this.isDrawing){let e=this.tempPoints[0];Yde.subVectors(e,n).length()<5*this.viewer.getPixelSizeInWorldCoord()&&(n=this.tempPoints[0].clone()),this.creatingShape.update([...this.tempPoints,n]),this.render()}}},this.mouseup=e=>{if(this.mouseDown=!1,this.selectedShape&&this.isEditing()&&this.endEdit(this.selectedShape),this.isCreateShapeMode()&&this.isDrawing&&this.creatingShape)if("LeaderLineMarkup"===this.type){let t=this.creatingShape;t.isEditing?t.exitEditing():(t.setFontSize(this.fontSize*this.viewer.getPixelSizeInWorldCoord()),t.addInput(this,e.x,e.y)),t.addEventListener("exitediting",(()=>{this.isDrawing=!1,this.endDraw(this.creatingShape)}))}else if("CloudRectWithTextMarkup"===this.type){let t=this.creatingShape;t.setFontSize(this.fontSize*this.viewer.getPixelSizeInWorldCoord()),t.addInput(this,e.x,e.y),t.addEventListener("exitediting",(()=>{this.isDrawing=!1,this.endDraw(this.creatingShape)}))}else this.endDraw(this.creatingShape)},this.keydown=e=>{"Delete"===e.code?this.selectedShape&&(this.viewer.hasEventListener("beforeremovemarkup")?this.viewer.dispatchEvent("beforeremovemarkup",this.confirmToRemove.bind(this)):(this.removeMarkup(this.selectedShape),this.undoMgr.addCommand(new rx(this,this.selectedShape.getData())),this.selectedShape=void 0)):"Escape"===e.code&&this.cancelDraw(this.creatingShape)},this.viewer=e,this.inputManager=e.getInputManager(),this.overlayRender=this.viewer.getOverlayRender(),this.overlayRender.addDrawableList(this.drawableList)}get viewerCanvas(){return this.overlayRender.getCanvas()}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}get undoMgr(){return this.viewer.getUndoManager()}setMarkupVisibility(e,t){let n=this.drawableList.getDrawables().get(e);return!!n&&(n.visible!==t&&(n.visible=t,this.render()),!0)}setMarkupsVisibility(e){let t=!1;this.drawableList.getDrawables().forEach((n=>{n.visible!==e&&(n.visible=e,t=!0)})),t&&this.render()}clear(){this.drawableList.clear(),this.isDrawing&&this.reset(),this.render()}isActive(){return this.activated}activate(){this.activated=!0,Bn.isMobile?(this.inputManager.addEventListener("touchstart",this.mousedown),this.inputManager.addEventListener("touchmove",this.mousemove),this.inputManager.addEventListener("touchend",this.mouseup)):(this.inputManager.addEventListener("mousedown",this.mousedown),this.inputManager.addEventListener("mousemove",this.mousemove),this.inputManager.addEventListener("mouseup",this.mouseup),this.inputManager.addEventListener("dblclick",this.handleDbClick)),this.inputManager.addEventListener("keydown",this.keydown),window.addEventListener("mousemove",this.handleInputMousemove),this.viewer.getCameraManager().enableMouseLeft(!1),this.viewer.getCameraManager().enableKeyControl(!1),this.render()}deactivate(){this.activated=!1,Bn.isMobile?(this.inputManager.removeEventListener("touchstart",this.mousedown),this.inputManager.removeEventListener("touchmove",this.mousemove),this.inputManager.removeEventListener("touchend",this.mouseup)):(this.inputManager.removeEventListener("mousedown",this.mousedown),this.inputManager.removeEventListener("mousemove",this.mousemove),this.inputManager.removeEventListener("mouseup",this.mouseup),this.inputManager.removeEventListener("dblclick",this.handleDbClick)),this.inputManager.removeEventListener("keydown",this.keydown),window.removeEventListener("mousemove",this.handleInputMousemove),this.viewer.getCameraManager().enableMouseLeft(!0),this.viewer.getCameraManager().enableKeyControl(!0),this.mouseDown=!1,this.tempPoints=[],this.isDrawing=!1,this.creatingShape=void 0,this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0),this.render()}getActiveMarkupType(){return this.type}setDrawType(e){this.type=e,this.reset()}setLineWidth(e){this.lineWidth=e}getLineWidth(){return this.lineWidth}setLineColor(e){this.lineColor=e}getLineColor(){return this.lineColor}setFillColor(e){this.fillColor=e}getFillColor(){return this.fillColor}setFontSize(e){this.fontSize=e}getFontSize(){return this.fontSize}pickPositionByScreenPoint(e){var t;return null==(t=this.viewer.pickObject(e))?void 0:t.point}confirmToRemove(e){this.selectedShape&&e&&(this.removeMarkup(this.selectedShape),this.undoMgr.addCommand(new rx(this,this.selectedShape.getData())),this.selectedShape=void 0)}isEditing(){return!!this.initialDataForEditing}endEdit(e){if(!this.initialDataForEditing)return;let t=e.getData();this.viewer.dispatchEvent("markupupdate",{oldData:this.initialDataForEditing,newData:t}),this.dispatchEvent("EndEdit",e),this.undoMgr.addCommand(new mA(this,this.initialDataForEditing,t)),this.initialDataForEditing=void 0,this.isSelectLeaderText=!1}endDraw(e){if("PolylineMarkup"===this.type&&this.creatingShape&&(this.tempPoints.length<2?(this.removeMarkup(this.creatingShape,!1),this.creatingShape=void 0):this.creatingShape.update(this.tempPoints)),e){let t=e.getData();this.viewer.dispatchEvent("markupadd",t),this.undoMgr.addCommand(new nx(this,t))}this.dispatchEvent("EndDraw",e),this.reset()}cancelDraw(e){e&&this.removeMarkup(e,!1),this.reset()}reset(){this.tempPoints=[],this.isDrawing=!1,this.creatingShape=void 0,this.mouseDownPositionX=void 0,this.mouseDownPositionY=void 0,this.mousedownPoint=void 0,this.isSelectLeaderText=!1,this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0),this.render()}render(){var e;null==(e=this.overlayRender)||e.render()}addMarkup(e,t=!0){this.drawableList.addDrawable(e),this.render(),t&&this.viewer.dispatchEvent("markupadd",e.getData())}updateMarkup(e,t,n=!0){this.drawableList.updateDrawable(e,t),this.render(),n&&this.viewer.dispatchEvent("markupupdate",{oldData:e.getData(),newData:t})}removeMarkup(e,t=!0){this.drawableList.removeDrawable(e),this.render(),t&&this.viewer.dispatchEvent("markupremove",e.getData())}removeMarkupById(e){let t=this.getMarkupById(e);return!!t&&(this.removeMarkup(t,!1),!0)}createMarkup(e){return xn.createDrawable(e)}getMarkupById(e){return this.drawableList.getDrawableById(e)}getData(){return this.drawableList.getDrawableDatas()}setData(e){this.undoMgr.startTransaction(),e.forEach((e=>{this.addMarkup(this.createMarkup(e)),this.undoMgr.addCommand(new nx(this,e))})),this.undoMgr.endTransaction(),this.render()}isCreateLineMode(){return["PolylineMarkup","CloudLineMarkup"].includes(this.type)}isCreateDotMode(){return["DotMarkup"].includes(this.type)}isCreateTextMode(){return["TextMarkup"].includes(this.type)}isCreateShapeMode(){return["XMarkup","RectMarkup","CloudRectMarkup","CircleMarkup","EllipseMarkup","ArrowMarkup","LeaderLineMarkup","CloudRectWithTextMarkup","DotMarkup"].includes(this.type)}drawShape(e,t){let n=[[e.x,e.y]];return t&&n.push([t.x,t.y]),xn.createDrawable({id:Ct.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.type,points:n})}drawLine(e){return xn.createDrawable({id:Ct.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.type,points:e.map((e=>[e.x,e.y]))})}drawText(e,t){return xn.createDrawable({id:Ct.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize*this.viewer.getPixelSizeInWorldCoord(),type:this.type,text:t,points:[[e.x,e.y]]})}destroy(){this.deactivate(),this.clear()}},vu=zN;vu.DEFAULT_ID="MarkupPlugin";var $de=new q,tp=class extends Ei{constructor(e,t){super(e),this.lineSegments=[],this.boxes=t,this.lineColor=[1,0,0,1],this.lineWidth=2,this.calculateCloudLineSegments(t)}calculateCloudLineSegments(e){var t;for(let n=0;n<e.length;n++){let r=e[n],i=[new q(r.min.x,r.min.y),new q(r.max.x,r.min.y),new q(r.max.x,r.max.y),new q(r.min.x,r.max.y),new q(r.min.x,r.min.y)],a=$de.subVectors(i[0],i[2]).length()/10||1e-4,s=[];for(let e=0;e<i.length-1;e++){let t=i[e],n=i[e+1],r=$de.subVectors(n,t),o=r.length(),l=r.normalize(),h=Math.ceil(o/a);for(let e=0;e<h;e++)s.push(t.clone().add(l.clone().multiplyScalar(a*e)))}s.push(s[0]),null==(t=this.lineSegments)||t.push(s)}}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),e.fillStyle=cn.rgba2Color(this.fillColor);for(let n=0;n<this.lineSegments.length;n++){let r=this.lineSegments[n];this.drawBox(e,t,r)}}drawBox(e,t,n){e.beginPath();for(let r=0;r<n.length-1;r++){let i=this.transToScreenCoord(n[r],t),a=this.transToScreenCoord(n[r+1],t),s=ml.getControlPointByTwoPoints(a,i);0===r&&e.moveTo(i.x,i.y),e.quadraticCurveTo(s.x,s.y,a.x,a.y)}e.stroke()}drawSelect(e,t){throw new Error("Method not implemented.")}isPointInPath(e){return!1}getBounds(){let e=new Ft;for(let t=0;t<this.boxes.length;t++){let n=this.boxes[t];e.union(n)}return e}getClassType(){return"CompareDrawable"}};xn._registerDrawableClass(tp);var Zde=class extends as{constructor(e){var t;super(),this.drawableList=new $a("compare"),this.viewer=e,this.overlayRender=this.viewer.getOverlayRender(),null==(t=this.overlayRender)||t.addDrawableList(this.drawableList)}drawCompareDrawable(e){let t=[],n=[],r=[];for(let i of Object.values(e)){let e=i.box;e&&("Added"===i.type?t.push(e):"Removed"===i.type?n.push(e):r.push(e))}let i=Gt.mergeBBoxes(t),a=Gt.mergeBBoxes(n),s=Gt.mergeBBoxes(r);this.drawableList.addDrawable(new tp(Ct.guid(),i)),this.drawableList.addDrawable(new tp(Ct.guid(),a)),this.drawableList.addDrawable(new tp(Ct.guid(),s)),this.viewer.enableRender()}setCompareDrawableVisible(e){this.drawableList.getDrawables().forEach((t=>t.visible=e)),this.viewer.enableRender()}},WC=class{constructor(e){this.jobCount=0,this.viewer=new jh(e);let t=document.getElementById(e.containerId);this.container=(null==t?void 0:t.parentElement)||document.body;let n=new Xg(e.containerId);this.loadingProgressBar=new Yg(n);this.loader=new bn(this.loadingManager,{ignorePaperSpace:!0}),this.initSpinner()}initSpinner(){let e=document.createElement("div");e.classList.add("x-spinner"),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),this.container.appendChild(e),this.spinner=e,this.setSpinnerVisibility(this.jobCount>0)}setFont(e){return Et(this,null,(function*(){let t=Date.now();this.fontManager||(this.fontManager=new Ja),yield this.fontManager.loadFonts(e),fe.info(`[DxfCompareHelper] Font file(s) load time in ${(Date.now()-t)/1e3}s`)}))}compare(e,t,n,r){return Et(this,null,(function*(){var i,a,s,o,l;let{src:h,modelId:u}=e,{src:c}=t;this.viewer.masterModelId=u||h;let d=Date.now();if(this.increaseJobCount(),!this.fontManager)return Promise.reject("[DxfCompareHelper] Should set font first!");this.loader.setFont(this.fontManager),yield this.fontManager.getFontFromIndexeddb();let p=h+c,f=Bd.t("ProgressBar.Comparing"),m=e=>{var t;null==(t=this.loadingProgressBar)||t.updateProgress(p,f,e),r&&r(new ProgressEvent("CompareProgress",{loaded:e,total:100}))},g=(e,t,n)=>{var i;let a=100*e.loaded/e.total;a=a*(n-t)/100+t,null==(i=this.loadingProgressBar)||i.updateProgress(p,f,a),r&&r(new ProgressEvent("CompareProgress",{loaded:a,total:100}))};Ct.printMemory("Before comparing"),null==(i=this.loadingProgressBar)||i.addProgressItem(p),m(0);let v=Date.now(),y=yield this.loader.parse(h,(e=>g(e,0,15))),x=yield this.loader.parse(c,(e=>g(e,15,30))),[b,_]=yield Promise.allSettled([y,x]);if("rejected"===b.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${h}`);if("rejected"===_.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${c}`);if(fe.info(`[DxfCompareHelper] loadFiles in ${(Date.now()-v)/1e3}s`),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare loadFile aborted");let w=b.value,S=_.value;v=Date.now();let M=yield new cs(w,S,n).compare((e=>g(e,30,60)));if(fe.info(`[DxfCompareHelper] Compared in ${(Date.now()-v)/1e3}s`),fe.debug("[DxfCompareHelper] Compared results:",M),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare change aborted");Ct.printMemory("After getting the comparison results"),v=Date.now(),yield this.loader.loadEntitiesForCompare(w,S,M,!0,(e=>g(e,60,95))),Ct.printMemory("After Creating threejs objects based on comparison result"),null==(a=this.fontManager)||a.releaseFontData(),this.changes=M,fe.info(`[DxfCompareHelper] Creates threejs objects based on comparison result in ${(Date.now()-v)/1e3}s`);let T=w,E=S;if(this.decreaseJobCount(),Object.keys(M).length||fe.info("[DxfCompareHelper] No change found"),0===(null==(s=T.threejsObject)?void 0:s.children.length)&&0===(null==(o=E.threejsObject)?void 0:o.children.length)){let e=`[DxfCompareHelper] Nothing was loaded from ${h} and ${c}`;return fe.warn(e),Promise.reject(e)}let A=T.threejsObject,C=E.threejsObject;return A.name=h,C.name=c,v=Date.now(),this.viewer.addModel(new Uo({modelId:e.modelId||e.src,dxfData:T})),this.viewer.flyToObject(A),Ct.printMemory("After adding first loaded Model to scene"),m(95),this.viewer.addModel(new Uo({modelId:t.modelId||t.src,dxfData:E})),Ct.printMemory("After adding second loaded Model to scene"),fe.info(`[DxfCompareHelper] Added compared objects to scene in ${(Date.now()-v)/1e3}s`),fe.info(`[DxfCompareHelper] The comparison between ${h}' and '${c}' is completed in ${(Date.now()-d)/1e3}s !`),m(100),null==(l=this.loadingProgressBar)||l.delayRemoveProgressItem(p),Promise.resolve()}))}getChanges(){return this.changes}zoomToChange(e){if(this.changes){let t=this.changes[e];if(!t)return;let n=t.box;n&&this.viewer.zoomToBBox(n.clone().expandByScalar(1.2))}}setSpinnerVisibility(e){this.spinner&&(e?this.spinner.classList.remove("hidden"):this.spinner.classList.add("hidden"))}increaseJobCount(){this.setSpinnerVisibility(++this.jobCount>0)}decreaseJobCount(){this.setSpinnerVisibility(--this.jobCount>0)}},Kde=class extends WC{constructor(e,t){super(e),this.syncCamera=!1,this.syncCameraControls=(e,t,n)=>{let r=new q,i=new q,a=new q;e.getPosition(i),e.getTarget(a),e.getFocalOffset(r),t.setLookAt(i.x,i.y,i.z,a.x,a.y,a.z),t.zoomTo(n),t.dispatchEvent({type:"control"})},this.viewer2=new jh(t),this.initSyncCameraEvent()}initSyncCameraEvent(){let e=this.viewer.getCameraManager().cameraControls,t=this.viewer2.getCameraManager().cameraControls,n=!1;e.addEventListener("control",(()=>{n=!1})),e.addEventListener("update",(()=>{!this.syncCamera||n||this.syncCameraControls(e,t,this.viewer.camera.zoom)})),t.addEventListener("control",(()=>{n=!0})),t.addEventListener("update",(()=>{!this.syncCamera||!n||this.syncCameraControls(t,e,this.viewer2.camera.zoom)}))}enableSyncCamera(e){if(this.syncCamera=e,e){let e=this.viewer.getCameraManager().cameraControls,t=this.viewer2.getCameraManager().cameraControls;this.syncCameraControls(e,t,this.viewer.camera.zoom)}}compare(e,t,n,r){return Et(this,null,(function*(){var i,a,s,o,l;let{src:h,modelId:u}=e,{src:c,modelId:d}=t;this.viewer.masterModelId=u||h,this.viewer2.masterModelId=d||c;let p=Date.now();if(this.increaseJobCount(),!this.fontManager)return Promise.reject("[DxfCompareHelper] Should set font first!");this.loader.setFont(this.fontManager),yield this.fontManager.getFontFromIndexeddb();let f=h+c,m=Bd.t("ProgressBar.Comparing"),g=e=>{var t;null==(t=this.loadingProgressBar)||t.updateProgress(f,m,e),r&&r(new ProgressEvent("CompareProgress",{loaded:e,total:100}))},v=(e,t,n)=>{var i;let a=100*e.loaded/e.total;a=a*(n-t)/100+t,null==(i=this.loadingProgressBar)||i.updateProgress(f,m,a),r&&r(new ProgressEvent("CompareProgress",{loaded:a,total:100}))};Ct.printMemory("Before comparing"),null==(i=this.loadingProgressBar)||i.addProgressItem(f),g(0);let y=Date.now(),x=yield this.loader.parse(h,(e=>v(e,0,15))),b=yield this.loader.parse(c,(e=>v(e,15,30))),[_,w]=yield Promise.allSettled([x,b]);if("rejected"===_.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${h}`);if("rejected"===w.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${c}`);if(fe.info(`[DxfCompareHelper] loadFiles in ${(Date.now()-y)/1e3}s`),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare loadFile aborted");let S=_.value,M=w.value;y=Date.now();let T=yield new cs(S,M,n).compare((e=>v(e,30,60)));if(fe.info(`[DxfCompareHelper] Compared in ${(Date.now()-y)/1e3}s`),fe.debug("Compared results:",T),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare change aborted");Ct.printMemory("After getting the comparison results"),y=Date.now(),yield this.loader.loadEntitiesForCompare(S,M,T,!1,(e=>v(e,60,95))),Ct.printMemory("After Creating threejs objects based on comparison result"),null==(a=this.fontManager)||a.releaseFontData(),this.changes=T,fe.info(`[DxfCompareHelper] Creates threejs objects based on comparison result in ${(Date.now()-y)/1e3}s`);let E=S,A=M;if(this.decreaseJobCount(),Object.keys(T).length||fe.info("[DxfCompareHelper] No change found"),0===(null==(s=E.threejsObject)?void 0:s.children.length)&&0===(null==(o=A.threejsObject)?void 0:o.children.length)){let e=`[DxfCompareHelper] Nothing was loaded from ${h} and ${c}`;return fe.warn(e),Promise.reject(e)}let C=E.threejsObject,P=A.threejsObject;return C.name=h,P.name=c,y=Date.now(),this.viewer.addModel(new Uo({modelId:e.modelId||e.src,dxfData:E})),Ct.printMemory("After adding first loaded Model to scene"),g(95),this.viewer2.addModel(new Uo({modelId:t.modelId||t.src,dxfData:A})),Ct.printMemory("After adding second loaded Model to scene"),fe.info(`[DxfCompareHelper] Added compared objects to scene in ${(Date.now()-y)/1e3}s`),fe.info(`[DxfCompareHelper] The comparison between ${h}' and '${c}' is completed in ${(Date.now()-p)/1e3}s !`),g(100),null==(l=this.loadingProgressBar)||l.delayRemoveProgressItem(f),Promise.resolve()}))}zoomToChange(e){if(this.changes){let t=this.changes[e];if(!t)return;let n=t.box;n&&(this.viewer.zoomToBBox(n.clone().expandByScalar(1.2)),this.viewer2.zoomToBBox(n.clone().expandByScalar(1.2)))}}},np=ca(Jde(),1),yu=class{constructor(e,t){this.current=e,this.next=t,this.inNormal=this.inwardsNormal(),this.outNormal=this.outwardsNormal()}outwardsNormal(){let e=this.inwardsNormal();return[-e[0],-e[1]]}inwardsNormal(){let e=this.next[0]-this.current[0],t=this.next[1]-this.current[1],n=Math.sqrt(e*e+t*t);if(0===n)throw new Error("Vertices overlap");return[-t/n,e/n]}offset(e,t){return yu.offsetEdge(this.current,this.next,e,t)}inverseOffset(e,t){return yu.offsetEdge(this.next,this.current,e,t)}inverse(){return new yu(this.next,this.current)}static offsetEdge(e,t,n,r){return new yu([e[0]+n,e[1]+r],[t[0]+n,t[1]+r])}},hb=Array.isArray,Qde=(e,t)=>e[0]===t[0]&&e[1]===t[1],WN=e=>Array.isArray(e)&&e.length,tpe=(e,t=0,n=!1)=>{let r,i;if(WN(e)&&"number"==typeof e[0][0]){let t=0,a=e;for(r=0,i=a.length;r<i;r++){let e=a[r],n=a[(r+1)%i];t+=e[0]*n[1],t-=n[0]*e[1]}(!n&&t>0||n&&t<0)&&a.reverse()}else for(r=0,i=e.length;r<i;r++)tpe(e[r],t+1,r>0);if(0===t&&WN(e)&&WN(e[0])&&"number"==typeof e[0][0][0]){let t=e[0].slice(0,1)[0];e[0].pop(),e[0].push([t[0],t[1]])}return e},epe=class{constructor(e,t=5){if(this.distance=0,this.arcSegments=t,!hb(e))throw new Error("Offset requires at least one coodinate to work with");this.edges=[],hb(e)&&"number"==typeof e[0]?this.vertices=e:(this.vertices=tpe(e),this.processContour(this.vertices,this.edges))}processContour(e,t){let n,r;if(hb(e[0])&&"number"==typeof e[0][0])for(r=e.length,Qde(e[0],e[r-1])&&(r-=1),n=0;n<r;n++)t.push(new yu(e[n],e[(n+1)%r]));else for(n=0,r=e.length;n<r;n++)t.push([]),this.processContour(e[n],t[t.length-1])}setArcSegments(e){return this.arcSegments=e,this}createArc(e,t,n,r,i,a,s){let o=2*Math.PI,l=Math.atan2(r[1]-t[1],r[0]-t[0]),h=Math.atan2(i[1]-t[1],i[0]-t[0]);a%2==0&&(a-=1),l<0&&(l+=o),h<0&&(h+=o);let u=l>h?l-h:l+o-h,c=(s?-u:o-u)/a;e.push(r);for(let r=1;r<a;++r)u=l+c*r,e.push([t[0]+Math.cos(u)*n,t[1]+Math.sin(u)*n]);return e.push(i),e}setDistance(e){return this.distance=e,this}ensureLastPoint(e){return Qde(e[0],e[e.length-1])||e.push([e[0][0],e[0][1]]),e}offset(e){return this.setDistance(e),0===this.distance?this.vertices:this.distance>0?this.margin(this.distance):this.padding(-this.distance)}offsetSegment(e,t,n,r){let i=[n.offset(n.inNormal[0]*r,n.inNormal[1]*r),n.inverseOffset(n.outNormal[0]*r,n.outNormal[1]*r)],a=[];for(let n=0,s=2;n<s;n++){let o=i[n],l=i[(n+s-1)%s];this.createArc(a,0===n?e:t,r,l.next,o.current,this.arcSegments,!0)}return a}margin(e){if(this.setDistance(e),"number"==typeof this.vertices[0])return this.offsetPoint(this.distance);if(0===e)return this.vertices;let t=this.offsetLines(this.distance);return t=(0,np.union)(this.vertices,t),t}padding(e){if(this.setDistance(e),0===this.distance)return this.vertices;if(2===this.vertices.length&&"number"==typeof this.vertices[0])return this.vertices;let t=this.offsetLines(this.distance);return(0,np.difference)(this.vertices,t)}offsetLine(e){return 0===e?this.vertices:this.offsetLines(e)}offsetLines(e){if(e<0)throw new Error("Cannot apply negative margin to the line");this.setDistance(e);let t=[];if(hb(this.vertices[0])&&"number"!=typeof this.vertices[0][0]){let e=[];for(let t=0,n=this.edges.length;t<n;t++){let n=this.offsetContour(this.vertices[t],this.edges[t]);n.length>0&&e.push(n)}e.length>0&&(t=1===e.length?e[0]:(0,np.union)(e[0],...e.slice(1)))}else t=1===this.vertices.length?this.offsetPoint(e):this.offsetContour(this.vertices,this.edges);return t}offsetContour(e,t){let n=[],r=0,i=0;if(hb(e[0])&&"number"==typeof e[0][0]){for(r=0,i=e.length-1;r<i;r++){let i=[this.ensureLastPoint(this.offsetSegment(e[r],e[r+1],t[r],this.distance))];n.push(i)}n.length>0&&(n=1===n.length?[n[0]]:(0,np.union)(n[0],n.slice(1)))}else{let a=[];for(r=0,i=t.length;r<i;r++){let n=this.offsetContour(e[r],t[r]);n.length>0&&a.push(n)}a.length>0&&(n=1===a.length?a[0]:(0,np.union)(a[0],...a.slice(1)))}return n}offsetPoint(e){this.setDistance(e);let t=2*this.arcSegments,n=[],r=this.vertices,i=this.distance,a=0;t%2==0&&t++;for(let e=0;e<t;e++)a+=2*Math.PI/t,n.push([r[0]+i*Math.cos(a),r[1]+i*Math.sin(a)]);return[[this.ensureLastPoint(n)]]}},jC=class extends Cn{constructor(e=!0,t=!1){super(),this.name="COORDINATE_AXES",this.AXIS_LENGTH=1,this.AXIS_COLOR_X=16711680,this.AXIS_COLOR_Y=65280,this.AXIS_COLOR_Z=255;let n=new q(0,0,0),r=new q(1,0,0),i=new q(0,1,0),a=new wd(r,n,this.AXIS_LENGTH,this.AXIS_COLOR_X,0,0),s=new wd(i,n,this.AXIS_LENGTH,this.AXIS_COLOR_Y,0,0);if(this.add(a,s),!t){let e=new q(0,0,1),t=new wd(e,n,this.AXIS_LENGTH,this.AXIS_COLOR_Z,0,0);this.add(t)}e&&this.addTexts(t)}addTexts(e=!1){let t=this.createText("X","#ff0000"),n=this.createText("Y","#00ff00");if(t.position.set(this.AXIS_LENGTH+.1,0,0),n.position.set(.1,this.AXIS_LENGTH,.1),this.add(t,n),!e){let e=this.createText("Z","#0000ff");e.position.set(0,0,this.AXIS_LENGTH+.1),this.add(e)}}createText(e,t,n=14){let r=document.createElement("div");r.innerHTML=e;let i=r.style;return i.color=t,i.width=`${n}px`,i.height=`${n}px`,i.textAlign="center",i.top="0px",i.left="0px",new Ng(r)}},XN=class extends si{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||XN.DEFAULT_ID}),this.ignoreZAxis=!1,this.cfg=t||{},this.ignoreZAxis=!(null==t||!t.ignoreZAxis),this.hostCamera=e.camera,this.init()}init(){this.initRenderer(),this.initScene(),this.animate(),this.viewer.addEventListener("camerachange",(()=>{this.hostCamera=this.viewer.camera}))}initRenderer(){var e;let t,n=100,r=100;if(this.cfg.containerId&&(t=document.getElementById(this.cfg.containerId),t&&(n=t.clientWidth,r=t.clientHeight)),!t){let n="axisGizmo";t=document.createElement("div"),t.id=n,null==(e=this.viewer.widgetContainer)||e.appendChild(t)}this.renderer=new hl({antialias:!0,alpha:!0}),this.renderer.setSize(n,r),t.appendChild(this.renderer.domElement),this.css2dRenderer=new Bg,this.css2dRenderer.setSize(n,r),this.css2dRenderer.domElement.style.height="0",this.css2dRenderer.domElement.style.width="0",t.appendChild(this.css2dRenderer.domElement)}initScene(){this.scene=new ea,this.camera=new To(-1,1,1,-1,.1,100),this.scene.add(this.camera),this.coordinateAxes=new jC(!0,this.ignoreZAxis),this.scene.add(this.coordinateAxes)}setHostCamera(e){this.hostCamera=e}render(){var e;!this.scene||!this.camera||(this.renderer&&(this.update(),this.renderer.render(this.scene,this.camera)),null==(e=this.css2dRenderer)||e.render(this.scene,this.camera))}animate(){requestAnimationFrame(this.animate.bind(this)),this.render()}update(){if(!this.hostCamera)return;let e=this.hostCamera;if(e){let t=new q;e.getWorldDirection(t);let n=e.up;this.updateCameraDirection(t,n)}}updateCameraDirection(e,t){if(!this.camera||!e)return;e.normalize();let n=.3;this.camera.position.set(2*-e.x+n,2*-e.y+n,2*-e.z+n),this.camera.lookAt(n,n,n),this.camera.up=t}destroy(){var e,t;super.destroy(),this.scene&&this.camera&&this.coordinateAxes&&(this.scene.clear(),this.scene=void 0,this.css2dRenderer&&(null==(e=this.container)||e.removeChild(this.css2dRenderer.domElement),this.css2dRenderer=void 0),this.renderer&&(null==(t=this.container)||t.removeChild(this.renderer.domElement),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=void 0),this.hostCamera=void 0,this.camera=void 0,this.coordinateAxes=void 0)}},jN=XN;jN.DEFAULT_ID="AxisGizmoPlugin";var $N=ca(XC(),1),Adt="bottomBar",npe=e=>{let t=document.createElement("span"),n=e.viewer.getRenderInfo(),r=(e,n)=>{t.innerHTML+=`<p><span>${e}:</span>${n}</p>`};t.innerHTML="<p>-- Renderer Info --</p>";let i=` (${(e=>{var t;let n=null==(t=e.renderer)?void 0:t.domElement;return null==n?void 0:n.dataset.engine})(e.viewer)})`;if(r("Version",`${_x}${i}`),r("DrawCalls",n.drawCalls),r("Points",n.points),r("Lines",n.lines),r("Triangles",n.triangles),r("Materials",n.materials),r("Textures",n.textures),r("Geometries",n.geometries),"Viewer2d"===e.viewer.name){r("Entities",e.viewer.getEntityCount())}return t},rpe=e=>{let t=document.createElement("span"),n=e.viewer.getCameraConfig(),r=(e,n)=>{t.innerHTML+=`<p><span>${e}:</span>${n}</p>`};t.innerHTML="";let i=e=>Ct.numberToString(e),a=e=>Ct.vectorToString(e);return r("Camera type",e.viewer.getCameraProjection()),r("Camera position",a(n.eye)),r("Camera target",a(n.look)),r("Camera up",a(n.up)),r("Camera near",i(n.near||0)),r("Camera far",i(n.far||0)),t},Cdt={"dxf-viewer-threejs-statistics":{icon:{default:"icon-info",active:"icon-info-filled",iconFont:Th},mutexIds:["dxf-viewer-threejs-cameraCfg","dxf-viewer-threejs-tips"],onActive:e=>{let t=npe(e);e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()},onUpdate:e=>{let t=npe(e);e.tooltip.setContent(t)}},"dxf-viewer-threejs-cameraCfg":{icon:{default:"icon-view",active:"icon-view-filled",iconFont:Th},mutexIds:["dxf-viewer-threejs-statistics","dxf-viewer-threejs-tips"],onActive:e=>{let t=rpe(e);e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()},onUpdate:e=>{let t=rpe(e);e.tooltip.setContent(t)}},"dxf-viewer-threejs-tips":{icon:{default:"icon-more",iconFont:Th},mutexIds:["dxf-viewer-threejs-cameraCfg","dxf-viewer-threejs-cameraCfg"],onActive:e=>{let t=document.createElement("span");"Viewer2d"===e.viewer.name?t.innerHTML="\n                <p><span>â: </span>Move up</p>\n                <p><span>â: </span>Move down</p>\n                <p><span>â: </span>Move to left</p>\n                <p><span>â: </span>Move to right</p>\n                ":t.innerHTML="\n                <p>Nothing to show</p>\n                ",e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()}}},ipe=class extends si{constructor(e){super(e,{id:"BottomBarPlugin"}),this.itemList=new Map,this.init()}update(){this.itemList.forEach((e=>{e.update()}))}init(){var e;let t=document.createElement("div");t.id=Adt,t.classList.add("bottom-bar"),(0,$N.forEach)(Cdt,((e,n)=>{let r=this.createItem(this.viewer,n,e);t.appendChild(r.element)})),this.element=t,null==(e=this.viewer.widgetContainer)||e.appendChild(this.element),this.viewer.addEventListener("afterrender",(()=>{this.update()}))}createItem(e,t,n){let r=new YN(e,this,t,n);return this.itemList.set(t,r),r}},YN=class{constructor(e,t,n,r){this.viewer=e,this.bottomBar=t,this.menuId=n,this.cfg=r,this.eventBus=E0(),this.active=!1,this.itemconfig=r,this.element=this.createButton(this.menuId,r),this.tooltip=new pc(n+"-tooltip",null,{parentNode:e.widgetContainer}),this.eventBus.on("activitychange",(e=>{e?(this.element.classList.add("active"),(0,$N.forEach)(r.mutexIds,(e=>{var t;let n=null==(t=this.bottomBar)?void 0:t.itemList.get(e);n&&n.active&&n.setActive(!1)})),r.onActive&&r.onActive(this)):(this.element.classList.remove("active"),r.onDeactive&&r.onDeactive(this)),this.element instanceof HTMLElement&&BM(this.element.classList,r.icon,this.active)}))}createButton(e,t){let n=document.createElement("i");n.id=e;let{default:r="icon-new",iconFont:i=qM}=t.icon;return n.classList.add("icon"),n.classList.add(i),n.classList.add(r),n.onclick=()=>{this.active=!this.active,t.onClick&&t.onClick(this),this.eventBus.emit("activitychange",this.active)},n}setActive(e){this.active=e,this.eventBus.emit("activitychange",this.active)}update(){this.active&&this.itemconfig.onUpdate&&this.itemconfig.onUpdate(this)}},KN=class extends si{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||KN.DEFAULT_ID}),this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.onPointerDown=e=>{let t=e.target;null!=t&&t.classList.contains("draggable")&&0===e.button&&(this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y,document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp))},this.onPointerMove=e=>{let t=this.layerMgrRoot,n=this.viewer.viewerContainer;if(!t||!n)return;let r=n.clientLeft+n.clientWidth,i=n.clientTop+n.clientHeight,a=e.x-this.mouseDownPositionX,s=e.y-this.mouseDownPositionY,o=t.offsetLeft+a,l=t.offsetTop+s;o<0&&(o=0),o>0&&o+t.clientWidth>r&&a>0&&(o=t.offsetLeft),l<0&&(l=0),l>0&&l+t.clientHeight>i&&s>0&&(l=t.offsetTop),t.style.left=`${o}px`,t.style.top=`${l}px`,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y},this.onPointerUp=()=>{document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp)},this.cfg=t||{},!1!==this.cfg.visible&&this.init()}init(){let e=this.viewer;this.cfg.containerId&&(this.container=document.getElementById(this.cfg.containerId)),this.container||(this.container=e.widgetContainer),this.dxfLayersArray=e.getLayers(),this.buildPage(),this.addContent(),this.addEventHandlers()}setVisible(e){e&&!this.container&&this.init();let t=this.layerMgrRoot;"none"!==t.style.display!==e&&(e?(this.updatePage(),t.style.display=""):t.style.display="none",this.dispatchEvent("visibilitychange",e))}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}destroy(){var e,t,n;super.destroy(),null==(e=this.closeBtn)||e.removeEventListener("click",this.closePanel),null==(t=this.checkboxes)||t.forEach((e=>{e.removeEventListener("change",(()=>{this.checkboxHandler(e)}))})),null==(n=this.layerMgrRoot)||n.remove()}buildPage(){var e;this.layerMgrRoot=document.createElement("div"),this.layerMgrRoot.classList.add("layer-manager");let t=document.createElement("div");t.classList.add("header","draggable"),this.headerText=document.createElement("span"),this.headerText.innerHTML="Layers",this.headerText.classList.add("draggable"),this.closeBtn=document.createElement("span"),this.closeBtn.classList.add("close"),this.closeBtn.innerHTML="X",t.appendChild(this.headerText),t.appendChild(this.closeBtn),this.layerMgrRoot.appendChild(t),this.layerList=document.createElement("div"),this.layerList.classList.add("layer-list"),this.layerMgrRoot.appendChild(this.layerList),null==(e=this.container)||e.appendChild(this.layerMgrRoot),this.updateHeaderText()}addContent(){var e;let t='\n        <div class="layer-list-item">\n            <input type="checkbox" id="toggleAllLayers" checked class="checkbox"></input>\n            <span class="popup-layer-color">Color</span>\n            <span class="item-layer-name">&nbsp;&nbsp;Layer name</span>\n        </div>\n        ';if(this.dxfLayersArray){let e=this.dxfLayersArray.length>1;for(let n=0;n<this.dxfLayersArray.length;++n){let r=this.dxfLayersArray[n].layers,i=Object.keys(r);i=i.sort(((e,t)=>{let n=/[a-zA-Z0-9]/,r=e.toString(),i=t.toString();return n.test(r[0])||n.test(i[0])?r>i?1:r<i?-1:0:r.localeCompare(i)}));for(let a of i){let i=r[a],s=e?`&lt;${this.dxfLayersArray[n].modelId}&gt; ${a}`:a,o=this.convertDecimalToHex(i.color);t+=this.generateListItem(s,i.visible,o)}}}this.layerList&&(this.layerList.innerHTML=t);let n=null==(e=this.layerMgrRoot)?void 0:e.querySelectorAll("input[type=checkbox]");this.checkboxes=[].slice.call(n,0),this.checkboxes.forEach((e=>{e.addEventListener("change",(()=>{this.checkboxHandler(e)}))}))}generateListItem(e,t,n){return`\n            <div class="layer-list-item">\n                <input type="checkbox" value="${e}" ${t?"checked":""} class="checkbox">\n                <div class="item-color" style="${n?`background-color: ${n}`:"opacity: 0.1"}"></div>\n                <span class="item-layer-name" title="${e}">${e}</span>\n            </div>\n            `}closePanel(){this.hide()}addEventHandlers(){var e,t;null==(e=this.closeBtn)||e.addEventListener("click",this.closePanel.bind(this)),null==(t=this.layerMgrRoot)||t.addEventListener("pointerdown",this.onPointerDown)}checkboxHandler(e){var t;if(!this.dxfLayersArray||!this.checkboxes)return;let n=this.viewer;if("toggleAllLayers"===e.id){for(let t=0;t<this.dxfLayersArray.length;++t){let r=this.dxfLayersArray[t].modelId,i=this.dxfLayersArray[t].layers;Object.keys(i).forEach((t=>{n.setLayerVisibility(t,e.checked,r)}))}return void(null==(t=this.checkboxes)||t.forEach((t=>t.checked=e.checked)))}let r="",i=e.value,a=i.indexOf(">");-1!==a&&(r=i.slice(1,a),i=i.slice(a+2)),r||(r=this.dxfLayersArray[0].modelId),n.setLayerVisibility(i,e.checked,r)}updatePage(){if(!this.dxfLayersArray)return;let e=this.viewer.getLayers();e.length!==this.dxfLayersArray.length&&(this.dxfLayersArray=e,this.addContent(),this.updateHeaderText())}updateHeaderText(){if(!this.dxfLayersArray||!this.headerText)return;let e=0;for(let t=0;t<this.dxfLayersArray.length;++t){let n=this.dxfLayersArray[t].layers;e+=Object.keys(n).length}this.headerText.innerHTML=`Layers (count: ${e})`}convertDecimalToHex(e){return void 0===e?void 0:`#${e.toString(16).padStart(6,"0")}`}},ZN=KN;ZN.DEFAULT_ID="LayerManagerPlugin";var spe=class extends si{constructor(e){super(e,{id:"HotpointPlugin"}),this.onAfterRender=()=>{var e;let t=this.viewer.scene,n=this.viewer.camera;!t||!n||!this.hotpointRoot||0===this.hotpointRoot.children.length||null==(e=this.css2dRenderer)||e.render(t,n)},this.css2dRenderer=this.viewer.css2dRenderer,this.viewer.addEventListener("afterrender",this.onAfterRender)}add(e){var t;if(this.has(e.hotpointId))return void fe.warn(`[Hotpoint] Hotpoint with id '${e.hotpointId}' already exist!`);let n=e.anchorPosition,r=UM.createHotpoint(e.html);r.position.set(n[0]||0,n[1]||0,n[2]||0),r.visible=!1!==e.visible,r.userData.hotpoint=e,this.hotpointRoot||(this.hotpointRoot=new Ai,this.hotpointRoot.matrixAutoUpdate=!1,this.hotpointRoot.matrixWorldAutoUpdate=!1,this.hotpointRoot.name="HotpointRoot",null==(t=this.viewer.scene)||t.add(this.hotpointRoot)),this.hotpointRoot.add(r),r.updateWorldMatrix(!1,!1),this.viewer.enableRender()}remove(e){var t,n;let r=(null==(t=this.hotpointRoot)?void 0:t.children)||[];for(let t=0;t<r.length;++t){let i=r[t];(null==(n=i.userData.hotpoint)?void 0:n.hotpointId)===e&&i.removeFromParent()}}clear(){var e;null==(e=this.hotpointRoot)||e.clear()}has(e){return!!this.findHotpointObject(e)}move(e,t){let n=this.findHotpointObject(e);if(n){let e=t.z||0;n.position.set(t.x,t.y,e),n.updateWorldMatrix(!1,!1),this.viewer.enableRender()}}setVisible(e,t){let n=this.findHotpointObject(e);n&&(n.visible=t)}findHotpointObject(e){var t;return((null==(t=this.hotpointRoot)?void 0:t.children)||[]).find((t=>{var n;return(null==(n=t.userData.hotpoint)?void 0:n.hotpointId)===e}))}flyToHotpoint(e,t=this.viewer.camera.zoom){let n=this.findHotpointObject(e);if(!n)return;n.updateWorldMatrix(!1,!1);let r=n.position,i=this.viewer.camera.position,a=new q(r.x,r.y,i.z),s=new q(r.x,r.y,0);this.viewer.flyTo(a,s,t)}destroy(){super.destroy(),this.clear()}},YC=class{constructor(e="uploadModelFile"){this.input=document.createElement("input"),this.input.id=e,this.input.type="file",this.input.multiple=!0,this.input.accept=this.formats().map((e=>"."+e)).join(","),this.input.style.display="none",this.input.onchange=e=>{let t=e.target.files;!t||t.length<=0?fe.error("[Uploader] No files to be uploaded!"):this.uploadFiles(t)}}formats(){return fe.warn("[Uploader]: Should call derived class instead!"),[]}uploadFiles(e){fe.warn(`[Uploader]: Should call derived class instead! files: ${e}`)}openFileBrowserToUpload(){this.input.click()}},Yi=ca(ape(),1),Er=ca(Hpe(),1),SB={Fill:"Fill",Stroke:"Stroke",Shading:"Shading"},zo={Fill:0,Stroke:1,FillStroke:2,Invisible:3,FillAddToPath:4,StrokeAddToPath:5,FillStrokeAddToPath:6,AddToPath:7,FillStrokeMask:3,AddToPathFlag:4},Vpe=16,zpe=100,MB=[1,0,0,1,0,0],AB=[.001,0,0,.001,0,0],Rdt={},qpe={},Gpe=new Ot,iR=new At,wB=0,Pdt=.01,CB=class extends Ri{constructor(e){if(super(),this.contentVisible=!0,this.markedContentStack=[],this.stateStack=[],this.current=new sR(1,1),this.tempSMask=null,this.pendingEOFill=!1,this.activeLayoutName="Model",this.defaultLayerId="0",this.currentLayerId="0",this.layers={0:{name:"0",id:"0",index:"0",visible:!0}},this.loadedEntityCount=0,this.viewportScale=1,this.baseTransform=new At,this.currentTransform=new At,this.transformStack=[],this.clipType=Yi.PolyFillType.pftNonZero,this.paths=[],this.pointsMaterials={},this.lineBasicMaterials={},this.meshBasicMaterials={},this.lineWithWidthCount=0,void 0===Er)throw"[PdfLoader] need load pdf.js first";"3.8.162"!==Er.version&&fe.warn("[PdfLoader] The pdf.js version we are using now is 3.8.162,if not maybe wrong."),this.fontManager=e.font,Er.GlobalWorkerOptions.workerSrc=e.pdfWorker}load(e,t,n,r){this.loadAsync(e,n).then((e=>{t(e)})).catch((e=>{r(e)}))}loadAsync(e,t){return Et(this,null,(function*(){var n,r,i;let a=Ct.getUpdateProgressFunc(t),s=Ct.getUpdateSubProgressFunc(0,10,t);a(0);let{src:o}=e;this.modelCfg=e;let l=e.modelId||o,h=Date.now(),u=Er.getDocument(o);u.onProgress=s;let c=yield u.promise;return this.pdf=c,fe.info(`[PdfLoader] Pdf document loaded in ${(Date.now()-h)/1e3}s`),h=Date.now(),fe.log(c),this.pdfDocumentGroup=new Ai,this.pdfDocumentGroup.name=`PdfDocument-${l}`,this.optionalContentConfig=yield c.getOptionalContentConfig(),yield null==(n=this.fontManager)?void 0:n.getFontFromIndexeddb(),fe.log("[PdfLoader] Font loaded."),c.numPages>1&&fe.info("[PdfLoader] Only the first page can be render others will be ignore."),yield this.loadPage(1,t),null!=(r=this.fontManager)&&r.missingFonts&&fe.warn("[PdfLoader] Missing fonts and reference count:",null==(i=this.fontManager)?void 0:i.missingFonts,", used other fonts instead."),this.lineWithWidthCount>0&&fe.warn(`[PdfLoader] Found ${this.lineWithWidthCount} line(s) with width, line width is not supported and was ignored.`),this.progressiveLoadCallback||(a(100),fe.info(`[PdfLoader] Loaded '${e.src}' in ${(Date.now()-h)/1e3}s, adding to scene...`)),{modelId:l,pdfData:{threejsObject:this.pdfDocumentGroup,layers:this.layers||[],layersAndThreejsObjects:this.layersAndThreejsObjects,loadedEntityCount:this.loadedEntityCount}}}))}loadPage(e,t){return Et(this,null,(function*(){var n,r,i,a,s;if(!this.pdf||e>this.pdf.numPages)return Promise.reject("load pdf page failed");this.pdfPage&&this.pdfPageGroup&&(null==(n=this.pdfPageGroup)||n.removeFromParent(),null==(r=this.pdfPageGroup)||r.traverse((e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})),null==(i=this.pdfPageGroup)||i.clear(),this.pdfPageGroup=void 0,this.tryCleanup(),this.pdfPage.objs.clear(),this.pdfPage.cleanup(),this.objs=void 0,this.pdfPage=void 0,null==(a=this.viewportMesh)||a.removeFromParent(),this.viewportMesh=void 0,this.layersAndThreejsObjects=void 0);let o=Ct.getUpdateProgressFunc(t),l=Ct.getUpdateSubProgressFunc(30,90,t),h=Date.now(),u=yield this.pdf.getPage(e);o(20),fe.info(`[PdfLoader] Pdf page loaded in ${(Date.now()-h)/1e3}s`),h=Date.now(),fe.log(u),this.pdfPage=u,this.pdfPageGroup=new Ai,this.pdfPageGroup.name=CB.MODEL_LAYOUT_NAME,null==(s=this.pdfDocumentGroup)||s.add(this.pdfPageGroup),this.commonObjs=this.pdf._transport.commonObjs,this.objs=u.objs;let c=u.view,d=8192/Math.max(c[2]-c[0],c[3]-c[1]),p=Math.min(300/72,d),f=u.getViewport({scale:p});this.beginDrawing(f),this.current=new sR(f.width,f.height),yield this.buildLayers(u),o(30),yield this.getOperatorList(l)}))}getPageCount(){if(this.pdf)return this.pdf.numPages}getOperatorList(e){return Et(this,null,(function*(){let t=this.pdfPage;if(!t)return;let n,r=Er.AnnotationMode.ENABLE,i=t._transport.getRenderingIntent("display",r,null,!0),a=t._intentStates.get(i.cacheKey);return a||(a=Object.create(null),t._intentStates.set(i.cacheKey,a)),a.opListReadCapability||(n=Object.create(null),n.operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(n))},a.opListReadCapability=new Er.PromiseCapability,(a.renderTasks||(a.renderTasks=new Set)).add(n),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null}),yield this._pumpOperatorList(i,e)}))}_pumpOperatorList(e,t){return Et(this,null,(function*(){let n=this.pdfPage;if(!n)return;let{renderingIntent:r,cacheKey:i,annotationStorageSerializable:a}=e,{map:s,transfers:o}=a,l=n._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:n._pageIndex,intent:r,cacheKey:i,annotationStorage:s},o).getReader(),h=n._intentStates.get(i);h.streamReader=l;let u=h.operatorList.argsArray.length,c=u<3e3;fe.info(`[PdfLoader] Operation count: ${u}, isVerboseProgress: ${c}`);let d=0,p=Ct.getUpdateProgressFunc(t);p(0);let f=()=>Et(this,null,(function*(){var e;try{let{value:r,done:i}=yield l.read();if(i)return h.streamReader=null,void(this.progressiveLoadCallback||p(100));if(n._transport.destroyed)return;let a=r,s=a.argsArray.length,o=100*d/u,m=100*(d+s)/u;if(c){let e=Ct.getUpdateSubProgressFunc(o,m,t);yield this.executeOperatorList(a,e)}else yield this.executeOperatorList(a),p(m);let g=this.progressiveLoadCallback,v=a.lastChunk;g?window.requestAnimationFrame((()=>{var e,t;null!=(e=this.modelCfg)&&e.merge&&this.mergePdfObjects(),g(wB,v),null==(t=this.pdfPageGroup)||t.updateMatrixWorld(!0)})):null!=(e=this.modelCfg)&&e.merge&&this.mergePdfObjects(),a.lastChunk&&this.endDrawing(),d+=s,g?f():yield f()}catch(e){if(h.streamReader=null,n._transport.destroyed)return;if(h.operatorList){h.operatorList.lastChunk=!0;for(let e of h.renderTasks)e.operatorListChanged();this.tryCleanup()}if(h.displayReadyCapability)h.displayReadyCapability.reject(e);else{if(!h.opListReadCapability)throw e;h.opListReadCapability.reject(e)}}}));yield f()}))}tryCleanup(){let e=this.pdfPage;e&&e._intentStates.clear()}mergePdfObjects(){for(let e in this.layersAndThreejsObjects){let t=this.layersAndThreejsObjects[e];if(t.length<=1)continue;let n=bi.deepMerge(t,this.pdfPageGroup,!1,!1,!1),r=n.added,i=n.removed;i.forEach((e=>{var t,n;null==(t=this.pdfPageGroup)||t.remove(e);let r=e;r.geometry.dispose(),r.material.dispose(),null==(n=r.material.map)||n.dispose()})),r.forEach((e=>{var t;null==(t=this.pdfPageGroup)||t.add(e)}));let a=t.filter((e=>!i.includes(e)));a.push(...r),this.layersAndThreejsObjects[e]=a}}getPointsMaterial(e,t=1){return this.pointsMaterials[`${e}-${t}`]||(this.pointsMaterials[`${e}-${t}`]=new Wi({color:e,transparent:!0,opacity:t})),this.pointsMaterials[`${e}-${t}`]}getLineBasicMaterial(e,t=1){return this.lineBasicMaterials[`${e}-${t}`]||(this.lineBasicMaterials[`${e}-${t}`]=new gr({color:e,transparent:!0,opacity:t})),this.lineBasicMaterials[`${e}-${t}`]}getMeshBasicMaterial(e,t=1){return this.meshBasicMaterials[`${e}-${t}`]||(this.meshBasicMaterials[`${e}-${t}`]=new mr({color:e,transparent:!0,opacity:t,side:Mr})),this.meshBasicMaterials[`${e}-${t}`]}getTransformByMatrix4(e){return[e.elements[0],e.elements[1],e.elements[4],e.elements[5],e.elements[12],e.elements[13]]}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing(e){var t,n,r,i;fe.log("beginDrawing",e),this.viewportScale=e.scale;let[a,s,o,l,h,u]=e.transform;this.baseTransform.set(a,o,0,h,s,l,0,u,0,0,1,0,0,0,0,1),this.currentTransform.copy(this.baseTransform),null==(t=this.pdfPageGroup)||t.applyMatrix4(this.baseTransform),null==(n=this.pdfPageGroup)||n.rotateZ(zr.degToRad(-e.rotation)),null==(r=this.pdfPageGroup)||r.updateMatrix();let{width:c,height:d}=e,p=(new Nt).setFromPoints([new q(0,0,0),new q(c,0,0),new q(c,d,0),new q(0,0,0),new q(c,d,0),new q(0,d,0)]),f=new mr({color:16777215}),m=new Jt(p,f);m.name="PDF-viewport",m.renderOrder=-999,m.layers.disable(10),this.viewportMesh=m,null==(i=this.pdfPageGroup)||i.add(m)}endDrawing(){var e;null==(e=this.pdfPageGroup)||e.updateMatrixWorld(!0)}releaseData(){var e;null==(e=this.fontManager)||e.releaseFontData(),this.operatorList=void 0,this.optionalContentConfig=void 0,this.commonObjs=void 0,this.objs=void 0,this.pdfPage=void 0,this.pdf=void 0}buildLayers(e){return Et(this,null,(function*(){if(!this.pdf)return;let t=yield e.getOperatorList(),n=t.fnArray,r=t.argsArray,i={},a=1;for(let e=0;n&&e<n.length;e++)if(n[e]===Er.OPS.beginMarkedContentProps&&r[e]&&"OC"==r[e][0]&&null!==r[e][1]){let t;t="object"==typeof r[e][1]?r[e][1].id:r[e][1],void 0===i[t]&&(i[t]=a++)}let s=this.optionalContentConfig,o={0:{name:"0",id:"0",index:"0",visible:!0}},l=1;for(let e in i){let t=s.getGroup(e);t?(l++,o[t.name]={name:t.name,id:e,index:i[e],visible:t.visible}):i[e]=0}return fe.log("buildLayers",o),this.layers=o,{layerCount:l,layersMap:o,layers:i}}))}addObjectToModel(e){var t,n;this.layersAndThreejsObjects||(this.layersAndThreejsObjects={});let r=this.layers[this.currentLayerId],i=(null==r?void 0:r.name)||this.defaultLayerId;this.layersAndThreejsObjects[i]||(this.layersAndThreejsObjects[i]=[]),e.userData.layerName=i,this.layersAndThreejsObjects[i].push(e),this.loadedEntityCount++,e.layers.enableAll();let a=e;a.geometry&&a.geometry.hasAttribute("normal")&&a.geometry.deleteAttribute("normal"),a.material&&!a.material.map&&a.geometry&&a.geometry.hasAttribute("uv")&&a.geometry.deleteAttribute("uv"),null!=(t=this.modelCfg)&&t.merge&&a.geometry&&(a.geometry.translate(0,0,wB),wB+=Pdt),null==(n=this.pdfPageGroup)||n.add(e)}executeOperatorList(e,t){return Et(this,null,(function*(){var n;let r=e.argsArray,i=e.fnArray,a=r.length,s=Ct.getUpdateProgressFuncForLoop(a,t),o=this.commonObjs,l=this.objs,h=0;for(;h<a;){let e=i[h];if(e!==Er.OPS.dependency)null==(n=this[e])||n.apply(this,r[h]);else for(let e of r[h])(e.startsWith("g_")?o:l).has(e)||console.warn("Why it runs here?!");h++,yield s(h)}}))}setLineWidth(e){this.current.lineWidth=e,e>1&&this.lineWithWidthCount++}setLineCap(e){this.current.lineCap=e}setLineJoin(e){this.current.lineJoin=e}setMiterLimit(e){this.current.miterLimit=e}setDash(e,t){}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n;break;case"BM":case"TR":break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null}}save(){let e=this.current;this.transformStack.push(this.currentTransform.clone()),this.stateStack.push(e),this.current=e.clone()}restore(){0!==this.stateStack.length&&(this.current=this.stateStack.pop()),0!==this.transformStack.length&&this.currentTransform.copy(this.transformStack.pop()),this.pendingClip=null,this.paths=[]}transform(e,t,n,r,i,a){let s=iR.set(e,n,0,i,t,r,0,a,0,0,1,0,0,0,0,1);this.currentTransform.multiply(s)}moveTo(){}lineTo(){}curveTo(){}curveTo2(){}curveTo3(){}closePath(){this.currentPath&&this.currentPath.curves.length>0&&(this.currentPath.closePath(),this.paths.push(this.currentPath.clone()),this.currentPath=void 0)}rectangle(){}stroke(e=!0){if(this.contentVisible){let e=this.current.strokeColor,t=this.current.strokeAlpha,n=[],r=[];for(let e=0;e<this.paths.length;e++){let t=this.paths[e],i=1===t.getPoints().length,a=(new Nt).setFromPoints(t.getPoints());a.applyMatrix4(this.currentTransform),i?n.push(a):r.push(a)}if(n.length>0){let r=ri(n),i=new Ni(r,this.getPointsMaterial(e,t));this.addObjectToModel(i)}if(r.length>0){let n=ri(r),i=new ti(n,this.getLineBasicMaterial(e,t));this.addObjectToModel(i)}}e&&this.consumePath(this.current.getClippedPathBoundingBox())}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){if(0===this.paths.length)return;this.current.patternFill&&fe.warn("[PdfLoader] fill pattern not supported now.");let t=this.current.getClippedPathBoundingBox();if(this.contentVisible&&null!==t){let e,t=[];if(this.clipPaths){let e=new Yi.PolyTree,n=new Yi.Clipper,r=this.paths.map((e=>e.getPoints().map((e=>({X:e.x,Y:e.y}))))),i=this.clipPaths.map((e=>e.getPoints().map((e=>({X:e.x,Y:e.y}))))),a=100;Yi.JS.ScaleUpPaths(r,a),Yi.JS.ScaleUpPaths(i,a),n.AddPaths(r,Yi.PolyType.ptSubject,!0),n.AddPaths(i,Yi.PolyType.ptClip,!0),n.Execute(Yi.ClipType.ctIntersection,e,this.pendingEOFill?Yi.PolyFillType.pftEvenOdd:Yi.PolyFillType.pftNonZero,this.clipType);let s=Yi.JS.PolyTreeToExPolygons(e);for(let e=0;e<s.length;e++){let{outer:n,holes:r}=s[e],i=new ki;i.setFromPoints(n.map((e=>new Te(e.X/a,e.Y/a)))),r.length>0&&r.forEach((e=>{let t=new ki;t.setFromPoints(e.map((e=>new Te(e.X/a,e.Y/a)))),i.holes.push(t)})),t.push(i)}this.clipPaths=void 0}if(t.length>0)e=new Mo(t);else{e=ri(this.paths.map((e=>new Mo(e))))}e.applyMatrix4(this.currentTransform);let n=this.current.fillColor,r=this.current.fillAlpha,i=new Jt(e,this.getMeshBasicMaterial(n,r));this.addObjectToModel(i),this.pendingEOFill=!1}e&&this.consumePath(t)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Rdt}eoClip(){this.pendingClip=qpe}beginText(){this.current.textMatrix=MB,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){this.currentPath=new ki}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let n=this.commonObjs.get(e),r=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=n.fontMatrix||AB,(0===r.fontMatrix[0]||0===r.fontMatrix[3])&&fe.warn("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;let i=t;t<Vpe?i=Vpe:t>zpe&&(i=zpe),this.current.fontSizeScale=t/i,this.current.browserFontSize=i}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(){}setTextMatrix(e,t,n,r,i,a){this.current.textMatrix=[e,t,n,r,i,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n){var r,i,a,s;let o,l,h=this.current,u=h.font,c=h.textRenderingMode,d=h.fontSize/h.fontSizeScale,p=c&zo.FillStrokeMask,f=!!(c&zo.AddToPathFlag),m=h.patternFill&&!u.missingFile;return(u.disableFontFace||f||m)&&(o=u.getPathGenerator(this.commonObjs,e)),u.disableFontFace||m?fe.log("paintChar path:",o,d,p):((p===zo.Fill||p===zo.FillStroke)&&(l=null==(i=this.fontManager)?void 0:i.getCharShape(e,null==(r=this.current.font)?void 0:r.name,.8*this.current.browserFontSize)),(p===zo.Stroke||p===zo.FillStroke)&&(l=null==(s=this.fontManager)?void 0:s.getCharShape(e,null==(a=this.current.font)?void 0:a.name,.8*this.current.browserFontSize))),l}showText(e){var t,n;let r=this.current,i=r.font;if(i.isType3Font)return this.showType3Text(e);let a=r.fontSize;if(0===a)return;let s=r.fontSizeScale,o=r.charSpacing,l=r.wordSpacing,h=r.fontDirection,u=r.textHScale*h,c=e.length,d=i.vertical,p=d?1:-1,f=i.defaultVMetrics,m=a*r.fontMatrix[0],g=r.textRenderingMode===zo.Fill&&!i.disableFontFace&&!r.patternFill,[v,y,x,b,_,w]=r.textMatrix,S=this.currentTransform.clone();S.multiply(iR.set(v,x,0,_,y,b,0,w,0,0,1,0,0,0,0,1)),S.multiply(iR.makeTranslation(r.x,r.y+r.textRise,0)),h>0?S.scale(new q(u,1,1)):S.scale(new q(u,-1,1));let M=r.lineWidth,T=r.textMatrixScale;if(0===T||0===M){(r.textRenderingMode&zo.FillStrokeMask)===zo.Stroke||zo.FillStroke}else M/=T;1!==s&&(S.scale(new q(s,s,1)),M/=s);let E,A=0,C=[];for(E=0;E<c;++E){let r=e[E];if("number"==typeof r){A+=p*r*a/1e3;continue}let u,c,v,y=(r.isSpace?l:0)+o,x=r.unicode,b=r.accent,_=r.width;if(d){let e=r.vmetric||f,t=-(r.vmetric?e[1]:.5*_)*m,n=e[2]*m;_=e?-e[0]:_,u=t/s,c=(A+n)/s}else u=A/s,c=0;if(i.remeasure,this.contentVisible&&(r.isInFont||i.missingFile))if(g&&!b){let e=null==(n=this.fontManager)?void 0:n.getCharShape(x,null==(t=this.current.font)?void 0:t.name,this.current.browserFontSize);e&&(e.translate(u,c,0),e.applyMatrix4(S),C.push(e))}else{let e=this.paintChar(x,u,c);e&&(e.translate(u,c,0),e.applyMatrix4(S),C.push(e))}v=d?_*m-y*h:_*m+y*h,A+=v}if(C.length>0){let e=C.filter((e=>e instanceof rs)),t=C.filter((e=>!(e instanceof rs)));if(e.length>0){let t=e.length>1?ri(e):e[0],n=new Jt(t,this.getMeshBasicMaterial(this.current.fillColor));this.addObjectToModel(n),n.layers.disable(11)}if(t.length>0){let e=t.length>1?ri(t):t[0],n=new ni(e,this.getLineBasicMaterial(this.current.fillColor));this.addObjectToModel(n),n.layers.disable(11)}}d?r.y-=A:r.x+=A*u}showType3Text(e){}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,r,i,a){}setStrokeColor(){}setStrokeColorN(){}setFillColorN(){this.current.patternFill=!0}setStrokeRGBColor(e,t,n){this.current.strokeColor=Gpe.setRGB(e/255,t/255,n/255).convertSRGBToLinear().getHex()}setFillRGBColor(e,t,n){this.current.fillColor=Gpe.setRGB(e/255,t/255,n/255).convertSRGBToLinear().getHex(),this.current.patternFill=!1}shadingFill(){}beginInlineImage(){}beginImageData(){}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){fe.log("beginMarkedContent",e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){if("OC"===e){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)});let e=this.optionalContentConfig.getGroup(null==t?void 0:t.id);this.currentLayerId=(null==e?void 0:e.name)||this.defaultLayerId}else this.markedContentStack.push({visible:!0});this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip,this.pendingClip&&(t||(this.pendingClip===qpe?this.clipType=Yi.PolyFillType.pftEvenOdd:this.clipType=Yi.PolyFillType.pftNonZero,this.clipPaths=this.paths.slice()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),this.paths=[],this.currentPath=void 0}paintFormXObjectBegin(e,t){fe.log("paintFormXObjectBegin",e,t)}paintFormXObjectEnd(){}beginGroup(){}endGroup(){}beginAnnotation(){}endAnnotation(){}paintImageMaskXObject(){}paintImageMaskXObjectGroup(){}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);t?this.paintInlineImageXObject(t):fe.warn("Dependent image isn't ready yet")}paintInlineImageXObject(e){if(!this.contentVisible)return;fe.log("paintInlineImageXObject",e),this.save();let{bitmap:t,width:n,height:r}=e;this.currentTransform.multiply(iR.makeScale(1/n,-1/r,1));let i=new ud(t),a=new mr({map:i,transparent:!0}),s=new ys(n,r),o=new Jt(s,a);o.translateX(n/2),o.translateY(-r/2),o.applyMatrix4(this.currentTransform),this.addObjectToModel(o),this.restore()}paintInlineImageXObjectGroup(){}paintImageXObjectRepeat(){}paintImageMaskXObjectRepeat(){}paintSolidColorImageMask(){}_scaleImage(e,t){let n=e.width,r=e.height,i=Math.max(Math.hypot(t.elements[0],t.elements[4]),1),a=Math.max(Math.hypot(t.elements[1],t.elements[5]),1),s=n,o=r,l=s,h=o;for(;i>2&&s>1||a>2&&o>1;)i>2&&s>1&&(l=s>=16384?Math.floor(s/2)-1||1:Math.ceil(s/2),i/=s/l),a>2&&o>1&&(h=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,a/=o/h),s=l,o=h;return{paintWidth:s,paintHeight:o}}constructPath(e,t,n){let r,i,a=this.current,s=a.x,o=a.y,l=[this.currentTransform.elements[0],this.currentTransform.elements[1],this.currentTransform.elements[4],this.currentTransform.elements[5],this.currentTransform.elements[12],this.currentTransform.elements[13]],h=0===l[0]&&0===l[3]||0===l[1]&&0===l[2],u=h?n.slice(0):null;for(let n=0,c=0,d=e.length;n<d;n++)switch(this.currentPath||(this.currentPath=new ki),0|e[n]){case Er.OPS.rectangle:{s=t[c++],o=t[c++];let e=t[c++],n=t[c++],r=s+e,i=o+n;this.currentPath.moveTo(s,o),0===e||0===n?this.currentPath.lineTo(r,i):(this.currentPath.lineTo(r,o),this.currentPath.lineTo(r,i),this.currentPath.lineTo(s,i)),h||a.updateRectMinMax(l,[s,o,r,i]),this.currentPath.closePath(),this.paths.push(this.currentPath.clone()),this.currentPath=void 0}break;case Er.OPS.moveTo:s=t[c++],o=t[c++],this.currentPath.moveTo(s,o),h||a.updatePathMinMax(l,s,o);break;case Er.OPS.lineTo:s=t[c++],o=t[c++],this.currentPath.lineTo(s,o),h||a.updatePathMinMax(l,s,o);break;case Er.OPS.curveTo:r=s,i=o,s=t[c+4],o=t[c+5],this.currentPath.bezierCurveTo(t[c],t[c+1],t[c+2],t[c+3],s,o),a.updateCurvePathMinMax(l,r,i,t[c],t[c+1],t[c+2],t[c+3],s,o,u),c+=6;break;case Er.OPS.curveTo2:r=s,i=o,this.currentPath.bezierCurveTo(s,o,t[c],t[c+1],t[c+2],t[c+3]),a.updateCurvePathMinMax(l,r,i,s,o,t[c],t[c+1],t[c+2],t[c+3],u),s=t[c+2],o=t[c+3],c+=4;break;case Er.OPS.curveTo3:r=s,i=o,s=t[c+2],o=t[c+3],this.currentPath.bezierCurveTo(t[c],t[c+1],s,o,s,o),a.updateCurvePathMinMax(l,r,i,t[c],t[c+1],s,o,s,o,u),c+=4;break;case Er.OPS.closePath:this.paths.push(this.currentPath.clone()),this.currentPath=void 0}this.currentPath&&this.paths.push(this.currentPath.clone()),h&&a.updateScalingPathMinMax(l,u),this.current.setCurrentPoint(s,o)}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},Xh=CB;Xh.MODEL_LAYOUT_NAME="Model";for(let e in Er.OPS)void 0!==Xh.prototype[e]&&(Xh.prototype[Er.OPS[e]]=Xh.prototype[e]);var sR=class{constructor(e,t){this.textMatrix=MB,this.fontMatrix=AB,this.textRenderingMode=zo.Fill,this.fillColor=0,this.strokeColor=0,this.activeSMask=null,this.lineCap=0,this.lineJoin=0,this.miterLimit=0,this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.browserFontSize=1,this.textMatrix=MB,this.textMatrixScale=1,this.fontMatrix=AB,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=zo.Fill,this.textRise=0,this.fillColor=0,this.strokeColor=0,this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.ctxMatrix=new Tn,this.clipBox=[0,0,e,t],this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}updatePathMinMax(e,t,n){[t,n]=Er.Util.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}getPathBoundingBox(e=SB.Fill,t=null){let n=[this.minX,this.minY,this.maxX,this.maxY];if(e===SB.Stroke){if(!t)throw new Error("Stroke bounding box must include transform.");let e=Er.Util.singularValueDecompose2dScale(t),r=e[0]*this.lineWidth/2,i=e[1]*this.lineWidth/2;n[0]-=r,n[1]-=i,n[2]+=r,n[3]+=i}return n}updateRectMinMax(e,t){let n=Er.Util.applyTransform(t,e),r=Er.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,n[0],r[0]),this.minY=Math.min(this.minY,n[1],r[1]),this.maxX=Math.max(this.maxX,n[0],r[0]),this.maxY=Math.max(this.maxY,n[1],r[1])}updateScalingPathMinMax(e,t){Er.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,r,i,a,s,o,l,h){let u=Er.Util.bezierBoundingBox(t,n,r,i,a,s,o,l);if(h)return h[0]=Math.min(h[0],u[0],u[2]),h[1]=Math.max(h[1],u[0],u[2]),h[2]=Math.min(h[2],u[1],u[3]),void(h[3]=Math.max(h[3],u[1],u[3]));this.updateRectMinMax(e,u)}updateClipFromPath(){let e=Er.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}getClippedPathBoundingBox(e=SB.Fill,t=null){return Er.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))||[]}},RB=class extends si{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||RB.DEFAULT_ID}),this.cfg=t||{},null==this.cfg.enableProgressiveLoad&&(this.cfg.enableProgressiveLoad=!0)}loadAsync(e,t){return Et(this,null,(function*(){let n=this.viewer;n.getSpinner().increaseJobCount();let r=Date.now(),i=n.getFontManager(),a=this.cfg.pdfWorker;this.loader||(this.loader=new Xh({font:i,pdfWorker:a})),this.cfg.enableProgressiveLoad&&(this.loader.progressiveLoadCallback=(i,a)=>{let s=n.camera.position;i&&s.z<i&&n.getCameraManager().setCameraPosition(new q(s.x,s.y,i)),a&&(Ct.getUpdateProgressFunc(t)(100),fe.info(`[PdfLoader] Progressively loaded '${e.src}' in ${(Date.now()-r)/1e3}s`),n.getSpinner().decreaseJobCount()),n.enableRender()});let s=yield this.loader.loadAsync(e,t);return this.cfg.enableProgressiveLoad||n.getSpinner().decreaseJobCount(),new Uo(s)}))}loadPage(e,t){return Et(this,null,(function*(){var n;return null==(n=this.loader)?void 0:n.loadPage(e,t)}))}getPageCount(){var e;return(null==(e=this.loader)?void 0:e.getPageCount())||0}getPdfViewport(){var e;let t=null==(e=this.loader)?void 0:e.viewportMesh;return t?(new Ft).setFromObject(t):void 0}worldPosition2PdfPoint(e){let t=this.getPdfViewport(),n=(null==t?void 0:t.min)||new q,r=new q;null==t||t.getSize(r);let i=r.x,a=r.y,s=e.x-n.x,o=e.y-n.y;return new Te(s/i,o/a)}pdfPoint2WorldPosition(e){let t=this.getPdfViewport(),n=(null==t?void 0:t.min)||new q,r=new q;null==t||t.getSize(r);let i=r.x,a=r.y;return new Te(e.x*i+n.x,e.y*a+n.y)}},yb=RB;yb.DEFAULT_ID="PdfLoaderPlugin";var Wpe=class extends YC{constructor(e,t){super(t),this.pdfWorker="",this.defaultModelConfig={src:"",merge:!0},this.viewer=e}setPdfWorker(e){this.pdfWorker=e}formats(){return["dxf","pdf"]}uploadFiles(e){for(let t=0;t<e.length;t++){let n=e[t];n.name.match(/\.(dxf)$/)?this.uploadSingleDxf(n):n.name.match(/\.(pdf)$/)&&this.uploadSinglePdf(n)}}uploadSingleDxf(e){return Et(this,null,(function*(){let t=Ki(oi({},this.defaultModelConfig),{src:URL.createObjectURL(e),modelId:e.name});yield this.viewer.loadModel(t,(t=>{let n=Math.floor(100*t.loaded/t.total);fe.info(`[Uploader] Loading ${null==e?void 0:e.name}, ${n}%`)}))}))}uploadSinglePdf(e){return Et(this,null,(function*(){let t=t=>{let n=Math.floor(100*t.loaded/t.total);fe.info(`[Uploader] Loading ${null==e?void 0:e.name}, ${n}%`)};try{let n=this.viewer,r={font:n.fontManager,pdfWorker:this.pdfWorker,enableProgressiveLoad:!0},i={merge:!0,src:URL.createObjectURL(e),modelId:e.name};new yb(n,r).loadAsync(i,t).then((e=>{this.viewer.addModel(e),this.onSuccess&&this.onSuccess({})}))}catch(e){fe.info(e)}}))}},Idt=(e=>(e.Default="Default",e.BoxSelection="BoxSelection",e.PickMarkup="PickMarkup",e))(Idt||{}),PB=class extends si{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||PB.DEFAULT_ID}),this.originalBackground=void 0,this.originalClearAlpha=1,this.cfg=t||{},this.cfg.type=this.cfg.type||"image/png",this.cfg.quality=this.cfg.quality||.8,this.cfg.setBackgroundTransparent=this.cfg.setBackgroundTransparent||!1}getScreenshot(){var e;let t=null==(e=this.viewer.renderer)?void 0:e.domElement;if(!t)return;this.setBackgroundTransparent();let n=t.toDataURL(this.cfg.type,this.cfg.quality);return this.recoverBackgroundTransparency(),n}getScreenshotByScreenBBox(e){return Et(this,null,(function*(){let t=this.viewer.renderer.domElement,n=t.width,r=t.height,i=e.min.x,a=e.min.y,s=e.max.x,o=e.max.y;if(i=Math.max(i,0),i=Math.min(i,n),a=Math.max(a,0),a=Math.min(a,r),s=Math.min(s||n,n),s=Math.max(s,0),o=Math.min(o||r,r),o=Math.max(o,0),0===Math.abs(s-i)||0===Math.abs(o-a))return void fe.error(`[Screenshot] Invalid input, minX: ${i}, minY: ${a}, maxX: ${s}, maxY: ${o}`);let l=new Vr;l.expandByPoint(new Te(i,a)),l.expandByPoint(new Te(s,o)),this.setBackgroundTransparent();let h=yield Ct.canvasToImage(t);this.recoverBackgroundTransparency();let u=document.createElement("canvas");u.width=t.width,u.height=t.height;let c=window.devicePixelRatio,d=u.getContext("2d");return d.drawImage(h,0,0,h.width/c,h.height/c),Ct.renderingContextToImage(d,l,this.cfg.type,this.cfg.quality)}))}getScreenshotByWorldBBox(e){return Et(this,null,(function*(){let t=this.viewer.camera,n=this.viewer.container.viewerContainer,r=mn.worldBBox2Screen(e,t,n);return this.getScreenshotByScreenBBox(r)}))}getScreenshotAsync(){return Et(this,arguments,(function*(e="BoxSelection"){this.cancel();let t,n=this.viewer,r=n.renderer.domElement;if("PickMarkup"===e?(this.pickMarkupHelper||(this.pickMarkupHelper=new CC(n)),t=yield this.pickMarkupHelper.pick()):"BoxSelection"===e&&(this.boxSelectHelper||(this.boxSelectHelper=new Gh(n)),t=yield this.boxSelectHelper.select()),"Default"!==e&&!t)return;this.setBackgroundTransparent();let i=yield Ct.canvasToImage(r);this.recoverBackgroundTransparency();let a=document.createElement("canvas"),s=window.devicePixelRatio;a.width=r.width/s,a.height=r.height/s;let o=a.getContext("2d");if(o.drawImage(i,0,0,i.width/s,i.height/s),n.overlayRender){let e=yield n.overlayRender.getImage((e=>e instanceof sr||e instanceof qr));o.drawImage(e,0,0,e.width/s,e.height/s)}let l=this.cfg.type,h=this.cfg.quality,u=Ct.renderingContextToImage(o,t,l,h);if(n instanceof jh){return{base64Image:u,viewExtent:n.getCurrentViewExtent(),imageType:l}}return{base64Image:u,imageType:l}}))}isActive(){var e,t;return(null==(e=this.boxSelectHelper)?void 0:e.isActive)||(null==(t=this.pickMarkupHelper)?void 0:t.isActive)}cancel(){var e,t;null!=(e=this.boxSelectHelper)&&e.isActive&&this.boxSelectHelper.deactivate(),null!=(t=this.pickMarkupHelper)&&t.isActive&&this.pickMarkupHelper.deactivate()}setBackgroundTransparent(){if(!this.cfg.setBackgroundTransparent)return;let e=this.viewer,t=e.scene,n=e.renderer,r=this.viewer.camera;this.originalBackground=t.background,this.originalClearAlpha=n.getClearAlpha(),t.background=null,n.setClearAlpha(0),n.render(t,r)}recoverBackgroundTransparency(){if(!this.cfg.setBackgroundTransparent)return;let e=this.viewer,t=e.scene,n=e.renderer,r=this.viewer.camera;t.background=this.originalBackground,n.setClearAlpha(this.originalClearAlpha),n.render(t,r),this.originalBackground=void 0,this.originalClearAlpha=1}},xb=PB;xb.DEFAULT_ID="ScreenshotPlugin";var bb=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var i=(performance||Date).now(),a=i,s=0,o=n(new bb.Panel("FPS","#0ff","#002")),l=n(new bb.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=n(new bb.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(l.update(e-i,200),e>=a+1e3&&(o.update(1e3*s/(e-a),100),a=e,s=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};bb.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,s=a(window.devicePixelRatio||1),o=80*s,l=48*s,h=3*s,u=2*s,c=3*s,d=15*s,p=74*s,f=30*s,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=n,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,h,u),g.fillRect(c,d,p,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(c,d,p,f),{dom:m,update:function(l,v){r=Math.min(r,l),i=Math.max(i,l),g.fillStyle=n,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(i)+")",h,u),g.drawImage(m,c+s,d,p-s,f,c,d,p-s,f),g.fillRect(c+p-s,d,s,f),g.fillStyle=n,g.globalAlpha=.9,g.fillRect(c+p-s,d,s,a((1-l/v)*f))}}};var jpe=bb,Xpe=class extends si{constructor(e){super(e,{id:"StatsPlugin"}),this.init()}init(){var e;let t=new jpe;t.setMode(0);let n=document.createElement("div");n.classList.add("statsOutput"),n.appendChild(t.domElement),null==(e=this.viewer.widgetContainer)||e.append(n),this.stats=t,this.viewer.addEventListener("onanimate",(()=>{var e;null==(e=this.stats)||e.update()}))}show(){var e;null==(e=this.stats)||e.showPanel(0)}hide(){var e;null==(e=this.stats)||e.showPanel(-1)}destroy(){super.destroy(),this.stats=void 0}},Eb=ca(XC(),1),Ti=ca(XC(),1),aR=(e=>(e[e.ClickEvent=1]="ClickEvent",e[e.Popup=2]="Popup",e[e.SubMenu=3]="SubMenu",e[e.Switch=4]="Switch",e))(aR||{}),IB=(e=>(e.HomeView="HomeView",e.OrthoMode="OrthoMode",e.Measure="Measure",e.MeasureDistance="MeasureDistance",e.MeasureArea="MeasureArea",e.MeasureAngle="MeasureAngle",e.MeasureCoordinate="MeasureCoordinate",e.MeasureClear="MeasureClear",e.MarkupVisibility="MarkupVisibility",e.Markup="Markup",e.MarkupArrow="Arrow",e.MarkupRect="Rect",e.MarkupCloudRect="CloudRect",e.MarkupPolyLine="PolyLine",e.MarkupCloudLine="CloudLine",e.MarkupEllipse="Ellipse",e.MarkupCircle="Circle",e.MarkupDot="Dot",e.MarkupText="Text",e.MarkupX="X",e.MarkupStrokeStyle="StrokeStyle",e.MarkupLineWidth="LineWidth",e.MarkupLineWidth2="LineWidth2",e.MarkupLineWidth5="LineWidth5",e.MarkupLineWidth10="LineWidth10",e.MarkupFontSize="FontSize",e.MarkupFontSize14="FontSize14",e.MarkupFontSize18="FontSize18",e.MarkupFontSize24="FontSize24",e.MarkupClear="MarkupClear",e.MarkupQuit="MarkupQuit",e.Section="Section",e.SectionBox="SectionBox",e.SectionPlane="SectionPlane",e.SectionAxis="SectionAxis",e.BimTree="BimTree",e.Viewpoint="Viewpoint",e.Annotation="Annotation",e.Property="Property",e.Settings="Settings",e.Compared="Compared",e.QuitCompare="QuitCompare",e.Fullscreen="FullScreen",e.SceneClear="SceneClear",e.Layers="Layers",e.ZoomToRectangle="ZoomToRectangle",e.Screenshot="GetScreenshot",e))(IB||{}),Ype=[["HomeView","OrthoMode","FullScreen","ZoomToRectangle","GetScreenshot"],["Measure","Markup","MarkupVisibility","Section"],["BimTree","Viewpoint","Annotation","Property","Compared","QuitCompare","Layers"],["Settings"]],P0=class{constructor(e,t,n=[]){this.visible=!0,this.menuList=new Map,this.keydown=e=>{if(this.visible&&"Escape"===e.code){let e=this.viewer.findPlugin(ep.DEFAULT_ID),t=this.viewer.findPlugin(vu.DEFAULT_ID);if(null!=e&&e.isMeasuring()||null!=t&&t.isActive())return;this.clearActive()}},this.viewer=e,this.menuCfg=t,this.groupCfg=n,this.init(),window.addEventListener("keydown",this.keydown,!1)}init(){var e;let t=document.createElement("div");t.classList.add("toolbar");let n=this.menuCfg;this.groupCfg.forEach(((e,r)=>{let i=document.createElement("div");i.classList.add("toolbar-group");let a=document.createElement("div");a.classList.add("toolbar-group-division"),e.forEach((e=>{let t=(0,Ti.get)(n,e);if(t&&!1!==t.visible){let n=this.createToolbarMenu(this.viewer,e,t);i.appendChild(n.element)}})),i.hasChildNodes()&&(r&&t.appendChild(a),t.appendChild(i))})),this.element=t,null==(e=this.viewer.widgetContainer)||e.appendChild(t),t.oncontextmenu=e=>{e.preventDefault()}}clearActive(){if(this.activateMenuId){let e=this.menuList.get(this.activateMenuId);null==e||e.setActive(!1),this.activateMenuId=void 0}}setActive(e,t){let n=this.menuList.get(e);null==n||n.setActive(t),this.activateMenuId=t?e:void 0}createToolbarMenu(e,t,n,r){let i=new DB(e,this,t,n,r);if(this.menuList.set(t,i),n.children){let t=document.createElement("div");t.classList.add("toolbar-sub-menu");let r=document.createElement("div");r.classList.add("toolbar-sub-menu-list"),t.appendChild(r),(0,Ti.forIn)(n.children,((t,n)=>{if(t&&!1!==t.visible){let a=this.createToolbarMenu(e,n,t,i);r.appendChild(a.element)}})),i.element.appendChild(t)}return i}updateMenu(e,t){(0,Ti.assign)(this.menuCfg[e],t),this.refresh()}updateMenus(e){(0,Ti.forEach)(e,(({menuId:e,config:t})=>{(0,Ti.assign)(this.menuCfg[e],t)})),this.refresh()}addMenu(e,t,n){if((0,Ti.keys)(this.menuCfg).includes(e))fe.error("[Toolbar]",e,"exists.");else{if((0,Ti.assign)(this.menuCfg,{[e]:t}),n){let[t,r]=n;if(t>this.groupCfg.length-1)this.groupCfg=(0,Ti.concat)(this.groupCfg,[[e]]);else{let n=this.groupCfg[t];this.groupCfg[t]=r>n.length-1?(0,Ti.concat)(n,e):(0,Ti.concat)((0,Ti.take)(n,r),e,(0,Ti.takeRight)(n,n.length-r))}}else this.groupCfg=(0,Ti.concat)(this.groupCfg,[[e]]);this.refresh()}}refresh(){this.element&&this.element.remove(),this.element=void 0,this.menuList.clear(),this.init()}show(){this.element&&(this.element.style.display=""),this.visible=!0}hide(){this.element&&(this.element.style.display="none"),this.visible=!1}destroy(){this.element&&this.element.remove(),this.element=void 0,this.menuList.clear(),window.removeEventListener("keydown",this.keydown,!1)}},DB=class{constructor(e,t,n,r,i){this.eventBus=E0(),this.toolbar=t,this.menuId=n,this.active=r.defaultActive||!1,this.element=r.customElement&&r.customElement(e,this.menuId,r)||this.createButton(e,this.menuId,r),this.eventBus.on("activitychange",(t=>{t?(this.element.classList.add("active"),(0,Ti.forEach)(r.mutexIds,(e=>{var t;let n=null==(t=this.toolbar)?void 0:t.menuList.get(e);n&&n.active&&n.setActive(!1)})),r.onActive&&r.onActive(e)):(this.element.classList.remove("active"),r.onDeactive&&r.onDeactive(e)),this.element.firstChild instanceof HTMLElement&&BM(this.element.firstChild.classList,r.icon,this.active),i&&i.setActive(t)})),Bn.isMobile?(this.element.ontouchstart=t=>{switch(this.element.classList.toggle("toolbar-parent-menu-active"),this.element.classList.toggle("toolbar-menu-active"),t.stopPropagation(),r.type){case 1:r.onClick&&r.onClick(e,this.toolbar,t);break;case 4:r.onClick&&r.onClick(e,this.toolbar,t),this.active=!this.active,this.toolbar.activateMenuId=this.menuId,this.eventBus.emit("activitychange",this.active)}},this.element.addEventListener("touchend",(()=>{i&&i.element.classList.remove("toolbar-parent-menu-active")}))):(this.element.onclick=t=>{switch(t.stopPropagation(),r.type){case 1:r.onClick&&r.onClick(e,this.toolbar,t);break;case 4:r.onClick&&r.onClick(e,this.toolbar,t),this.active=!this.active,this.toolbar.activateMenuId=this.menuId,this.eventBus.emit("activitychange",this.active)}i&&i.element.classList.remove("toolbar-parent-menu-active")},this.element.addEventListener("mouseover",(()=>{this.element.classList.toggle("toolbar-parent-menu-active"),this.element.classList.add("toolbar-menu-active")})),this.element.addEventListener("mouseout",(()=>{this.element.classList.contains("toolbar-parent-menu-active")&&this.element.classList.remove("toolbar-parent-menu-active"),this.element.classList.remove("toolbar-menu-active")})))}createButton(e,t,n){let r=document.createElement("div");r.id=t,r.classList.add("toolbar-menu"),n.defaultActive&&r.classList.add("active"),n.children&&r.classList.add("toolbar-parent-menu");let{default:i="icon-new",iconFont:a=qM}=n.icon;return r.innerHTML=`<div class="icon ${a} ${i}"></div>`,r.title=Gr(n.menuName),r.innerHTML+=`<span>${r.title}</span>`,r}setActive(e){this.active=e,e?this.element.classList.add("toolbar-menu-active"):this.element.classList.remove("toolbar-menu-active"),this.eventBus.emit("activitychange",this.active)}},Al=e=>e.findPlugin(vu.DEFAULT_ID),gc=(e,t)=>{let n=Al(e);n&&(n.isActive()||n.activate(),n.setDrawType(t))},vc=e=>{let t=Al(e);null==t||t.deactivate()},$pe={Arrow:{menuName:"Toolbar.markupArrow",icon:{default:"icon-arrow"},type:4,onActive:e=>{gc(e,"ArrowMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},Rect:{defaultActive:!1,menuName:"Toolbar.markupRect",icon:{default:"icon-rectangle"},type:4,onActive:e=>{gc(e,"RectMarkup")},onDeactive(e){vc(e)},mutexIds:["Arrow","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},CloudRect:{defaultActive:!0,menuName:"Toolbar.markupCloudRect",icon:{default:"icon-cloud"},type:4,onActive:e=>{gc(e,"CloudRectWithTextMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","Arrow","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},PolyLine:{menuName:"Toolbar.markupPolyLine",icon:{default:"icon-polyline"},type:4,onActive:e=>{gc(e,"PolylineMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","Arrow","CloudRect","CloudLine","Ellipse","Circle","Dot","Text","X"]},CloudLine:{menuName:"Toolbar.markupCloudLine",icon:{default:"icon-cloud-segment"},type:4,onActive:e=>{gc(e,"CloudLineMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","Arrow","Ellipse","Circle","Dot","Text","X"]},Ellipse:{menuName:"Toolbar.markupEllipse",icon:{default:"icon-oval"},type:4,onActive:e=>{gc(e,"EllipseMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Arrow","Circle","Dot","Text","X"]},Circle:{menuName:"Toolbar.markupCircle",icon:{default:"icon-round"},type:4,onActive:e=>{gc(e,"CircleMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Arrow","Dot","Text","X"]},Dot:{menuName:"Toolbar.markupDot",icon:{default:"icon-round"},type:4,onActive:e=>{gc(e,"DotMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Arrow","Circle","Text","X"]},X:{menuName:"Toolbar.markupX",icon:{default:"icon-cross"},type:4,onActive:e=>{gc(e,"XMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Arrow","Text"]},Text:{menuName:"Toolbar.markupText",icon:{default:"icon-text"},type:4,onActive:e=>{gc(e,"TextMarkup")},onDeactive(e){vc(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Arrow","X"]},StrokeStyle:{menuName:"Toolbar.markupStroke",icon:{default:"icon-color-red"},type:1,onClick:(e,t,n)=>{let r=Al(e),i=n.target.parentElement,a=null==i?void 0:i.firstElementChild,s=document.createElement("input");s.setAttribute("type","color"),s.value=cn.rgba2Color(null==r?void 0:r.getLineColor()),s.click(),s.oninput=e=>{let t=e.target.value;null==r||r.setLineColor(cn.color2rgba(t)),a.style.color=t}}},LineWidth:{menuName:"Toolbar.markupLineWidth",icon:{default:"icon-line"},customElement(e,t,n){let r=document.createElement("div");return r.id=t,r.classList.add("toolbar-menu"),n.children&&r.classList.add("toolbar-parent-menu"),r.title=Gr(n.menuName),r.innerHTML+=`<span>${r.title}</span>`,r},type:3,children:{LineWidth2:{defaultActive:!0,icon:{default:"icon-line-2"},onClick:e=>{let t=Al(e);null==t||t.setLineWidth(2)},type:4,menuName:"Toolbar.markupLineWidth2",mutexIds:["LineWidth5","LineWidth10"]},LineWidth5:{icon:{default:"icon-line-3"},onClick:e=>{let t=Al(e);null==t||t.setLineWidth(3)},type:4,menuName:"Toolbar.markupLineWidth5",mutexIds:["LineWidth2","LineWidth10"]},LineWidth10:{icon:{default:"icon-line-4"},onClick:e=>{let t=Al(e);null==t||t.setLineWidth(4)},type:4,menuName:"Toolbar.markupLineWidth10",mutexIds:["LineWidth2","LineWidth5"]}}},FontSize:{menuName:"Toolbar.markupFontSize",icon:{default:"icon-font"},customElement(e,t,n){let r=document.createElement("div");return r.id=t,r.classList.add("toolbar-menu"),n.children&&r.classList.add("toolbar-parent-menu"),r.title=Gr(n.menuName),r.innerHTML+=`<span>${r.title}</span>`,r},type:3,children:{FontSize14:{icon:{default:"icon-font14"},onClick:e=>{let t=Al(e);null==t||t.setFontSize(14)},type:4,menuName:"",mutexIds:["FontSize18","FontSize24"]},FontSize18:{defaultActive:!0,icon:{default:"icon-font18"},onClick:e=>{let t=Al(e);null==t||t.setFontSize(18)},type:4,menuName:"",mutexIds:["FontSize14","FontSize24"]},FontSize24:{icon:{default:"icon-font24"},onClick:e=>{let t=Al(e);null==t||t.setFontSize(24)},type:4,menuName:"",mutexIds:["FontSize14","FontSize18"]}}},MarkupClear:{icon:{default:"icon-eraser"},onClick:e=>{fe.info("[Toolbar]","Clear Markup",e);let t=Al(e);null==t||t.clear()},type:1,menuName:"Toolbar.clearMarkup"},MarkupQuit:{icon:{default:""},customElement(e,t,n){let r=document.createElement("div");return r.id=t,r.classList.add("toolbar-menu"),n.children&&r.classList.add("toolbar-parent-menu"),r.title=Gr(n.menuName),r.innerHTML+=`<span>${r.title}</span>`,r},onClick:e=>{let t=Al(e);null==t||t.deactivate(),e.dispatchEvent("markupdeactivate")},type:1,menuName:"Toolbar.quitMarkup"}},Zpe=[["Arrow","Rect","CloudRect","PolyLine","Ellipse","Circle","Text","StrokeStyle","FontSize","MarkupClear","MarkupQuit"]],oR=class extends P0{constructor(e,t,n=[]){super(e,t,n),this.keydown=()=>{}}},OB=e=>e.findPlugin(vu.DEFAULT_ID),yc=e=>e.findPlugin(ep.DEFAULT_ID),Ddt=e=>e.findPlugin(xb.DEFAULT_ID),Odt=e=>{let t=yc(e);null==t||t.deactivate()},Kpe={HomeView:{icon:{default:"icon-zhushitu",active:"icon-zhushitu"},menuName:"Toolbar.homeView",type:1,onClick:e=>{e.goToHomeView()}},ZoomToRectangle:{icon:{default:"icon-kuangxuanfangda",active:"icon-kuangxuanfangda"},menuName:"Toolbar.zoomToRectangle",type:4,onClick:(e,t)=>{let n=e;n.removeEventListener("boxselectdeactivate"),n.addEventListener("boxselectdeactivate",(()=>{null==t||t.setActive("ZoomToRectangle",!1)})),n.zoomToRect()},mutexIds:["GetScreenshot"]},GetScreenshot:{icon:{default:"icon-frame-clipping",active:"icon-frame-clipping"},menuName:"Toolbar.screenshot",type:4,onClick:(e,t)=>{let n=e;n.removeEventListener("boxselectdeactivate"),n.addEventListener("boxselectdeactivate",(()=>{null==t||t.setActive("GetScreenshot",!1)}));let r=Ddt(e);null==r||r.getScreenshotAsync().then((e=>{if(fe.info("[Toolbar] getScreenshot() returns:",null==e?void 0:e.base64Image),null==e||!e.base64Image)throw"[Toolbar] Image data is empty!";let t=document.createElement("a");t.href=null==e?void 0:e.base64Image,t.download="",t.click()})).catch((e=>{fe.error("[Toolbar] Failed to get screenshot, reason:",e),null==t||t.setActive("GetScreenshot",!1)}))},mutexIds:["ZoomToRectangle"]},Measure:{icon:{default:"icon-celiang1",active:"icon-celiang1"},menuName:"Toolbar.measurement",type:3,children:{MeasureDistance:{icon:{default:"icon-measure-distance"},menuName:"Toolbar.distanceMeasurement",onActive:e=>{let t=yc(e);null==t||t.activate("Distance")},onDeactive:e=>{let t=yc(e);null==t||t.deactivate()},type:4,mutexIds:["MeasureArea","MeasureAngle","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureArea:{icon:{default:"icon-measure-area-color"},onActive:e=>{let t=yc(e);null==t||t.activate("Area")},onDeactive:e=>{let t=yc(e);null==t||t.deactivate()},type:4,menuName:"Toolbar.areaMeasurement",mutexIds:["MeasureDistance","MeasureAngle","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureAngle:{menuName:"Toolbar.angleMeasurement",icon:{default:"icon-angle-measure"},type:4,onActive:e=>{let t=yc(e);null==t||t.activate("Angle")},onDeactive:e=>{let t=yc(e);null==t||t.deactivate()},mutexIds:["MeasureDistance","MeasureArea","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureCoordinate:{menuName:"Toolbar.coordinateMeasurement",icon:{default:"icon-distancemeasure",iconFont:Th},type:4,onActive:e=>{let t=yc(e);null==t||t.activate("Coordinate")},onDeactive:e=>{let t=yc(e);null==t||t.deactivate()},visible:!1,mutexIds:["MeasureDistance","MeasureArea","MeasureAngle","ZoomToRectangle","GetScreenshot"]},MeasureClear:{icon:{default:"icon-clear",active:"icon-clear-filled",iconFont:Th},onClick:e=>{let t=yc(e);null==t||t.clear()},type:1,menuName:"Toolbar.clearMeasurement"}}},Markup:{icon:{default:"icon-annotation"},menuName:"Toolbar.markup",type:1,onClick:(e,t)=>{Odt(e),null==t||t.updateMenu("Measure",{defaultActive:!1}),null==t||t.setActive("ZoomToRectangle",!1);let n=OB(e);n?(n.getData().forEach((e=>n.setMarkupVisibility(e.id,!0))),null==t||t.setActive("MarkupVisibility",!1),n.activate(),n.setDrawType("CloudRectWithTextMarkup"),e.dispatchEvent("markupactivate")):fe.warn("[Toolbar] MarkupPlugin is not installed!")}},MarkupVisibility:{icon:{default:"icon-annotation-show",active:"icon-annotation-hide"},menuName:"Toolbar.markupVisibility",type:4,onActive:e=>{let t=OB(e);t?t.getData().forEach((e=>t.setMarkupVisibility(e.id,!1))):fe.warn("[Toolbar] MarkupPlugin is not installed!")},onDeactive:e=>{let t=OB(e);t?t.getData().forEach((e=>t.setMarkupVisibility(e.id,!0))):fe.warn("[Toolbar] MarkupPlugin is not installed!")},visible:!0},Settings:{icon:{default:"icon-settings",active:"icon-settings-filled",iconFont:Th},menuName:"Toolbar.settings",type:4,onActive:()=>{fe.info("[Toolbar]","Activate Settings")},onDeactive:()=>{fe.info("[Toolbar]","Deactivate Settings")},visible:!0},Compared:{icon:{default:"icon-compared"},menuName:"Toolbar.compared",type:4,onActive:()=>{fe.info("[Toolbar]","Activate Compare")},onDeactive:()=>{fe.info("[Toolbar]","Deactivate Compare")},visible:!1},QuitCompare:{icon:{default:"icon-compared"},menuName:"Toolbar.quitCompare",type:4,onActive:()=>{fe.info("[Toolbar]","Activate Compare")},onDeactive:()=>{fe.info("[Toolbar]","Deactivate Compare")},visible:!1},Layers:{icon:{default:"icon-tucengkongzhi",active:"icon-tucengkongzhi"},menuName:"Toolbar.layers",type:4,onClick:()=>{}},FullScreen:{icon:{default:"icon-quanping",active:"icon-quanping"},menuName:"Toolbar.fullscreen",type:4,onClick:(e,t)=>{var n;let r=()=>{let e=null==t?void 0:t.menuList.get("FullScreen");e&&e.setActive(Ct.isFullScreen())};Ct.isFullScreen()?(Ct.exitFullscreen(),window.removeEventListener("resize",r)):Ct.fullScreen(null==(n=e.viewerContainer)?void 0:n.parentElement),window.addEventListener("resize",r)}}},kB=class extends si{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||kB.DEFAULT_ID}),this.onMarkupActivated=()=>{if(!this.markupToolbar){let e=(0,Eb.merge)(this.cfg.markupMenuCfg||[],$pe),t=(0,Eb.merge)(this.cfg.markupGroupCfg||[],Zpe);this.markupToolbar=new oR(this.viewer,e,t),this.markupToolbar.hide()}this.toolbar.hide(),this.markupToolbar.show()},this.onMarkupDeactivated=()=>{var e;null==(e=this.markupToolbar)||e.hide(),this.toolbar.show()},this.cfg=t||{};let n=(0,Eb.merge)({},Kpe,this.cfg.menuConfig),r=(0,Eb.merge)(this.cfg.groupConfig||[],Ype);this.toolbar=new P0(e,n,r),this.viewer.addEventListener("markupactivate",this.onMarkupActivated),this.viewer.addEventListener("markupdeactivate",this.onMarkupDeactivated)}getToolbar(){return this.toolbar}getMarkupToolbar(){return this.markupToolbar}setActive(e,t){this.toolbar.setActive(e,t)}destroy(){var e;super.destroy(),null==(e=this.markupToolbar)||e.destroy(),this.toolbar.destroy()}},LB=kB;LB.DEFAULT_ID="Viewer2dToolbarPlugin";var lR=class extends Ei{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.image=t.image,this.min=t.min,this.max=t.max,this.radius=t.radius,this.renderOrder=t.renderOrder||-1e3}getClassType(){return"OverviewMapDrawable"}getImageScreenSize(e,t,n){let r=this.transToScreenCoord(e,n),i=this.transToScreenCoord(t,n);return{width:Math.floor(Math.abs(r.x-i.x)),height:Math.floor(Math.abs(r.y-i.y))}}draw(e,t){let n=this.getImageScreenSize(this.max,this.min,t),r=new q;r.addVectors(this.max,this.min).multiplyScalar(.5);let i=this.transToScreenCoord(r,t),a=this.transToScreenCoord(t.position,t);e.save(),e.beginPath(),this.radius&&(e.arc(a.x,a.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()),e.drawImage(this.image,i.x-this.width/2,i.y-this.height/2,this.width,this.height),e.closePath(),e.restore(),this.width=n.width,this.height=n.height}drawSelect(){}isPointInPath(){return!1}getBBox(){return new Ft(this.min,this.max)}},_b=class extends Ei{constructor(e,t){super(e),this.hover=!1,this.needsFrustumCulled=!1,this.image=t.image,this.hoverImage=t.hoverImage,this.translate=t.translate,this.scale=t.scale||1,this.position=t.position,this.direction=t.direction,this.radius=t.radius,this.displayRadius=t.displayRadius||1/0,this.rotation=t.rotation,this.enabledHover=!!t.enabledHover,this.renderOrder=t.renderOrder||-997}direction2Rotation(e){return new Te(e.x,e.z).angle()+Math.PI}getRotation(){let e=this.direction?this.direction2Rotation(this.direction):0,t=this.rotation?this.rotation:0;return t+=e,t}drawImage(e,t,n){let r=new Te(1,1);this.translate&&r.set(this.translate.x,this.translate.y);let i=t.width*this.scale,a=t.height*this.scale,s=this.getRotation();s?(e.translate(n.x,n.y),e.rotate(s),e.drawImage(t,r.x*i,r.y*a,i,a),e.translate(-n.x,-n.y)):e.drawImage(t,n.x+r.x*i,n.y+r.y*a,i,a),this.width=i*this.tolerance,this.height=a*this.tolerance}draw(e,t){let n=this.position.clone(),r=!1;if(this.radius){let e=new Te(n.x,n.z),i=new Te(t.position.x,t.position.z),a=e.distanceTo(i);a>this.radius&&a<this.displayRadius?n.lerp(t.position,1-this.radius/a):r=!0}let i=this.transToScreenCoord(n,t),a=this.hover&&this.hoverImage?this.hoverImage:this.image;if(e.save(),e.beginPath(),this.radius&&r){let n=this.transToScreenCoord(t.position,t);e.arc(n.x,n.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()}this.drawImage(e,a,i),e.closePath(),e.restore()}drawSelect(){}getClassType(){return"ImageDrawable"}isPointInPath(e,t){var n,r;if(null==t||!t.camera||!this.ctx||!this.enabledHover)return!1;let i=this.transToScreenCoord(this.position,t.camera),a=this.transToScreenCoord(e,t.camera);this.ctx.save(),this.ctx.clearRect(0,0,null==(n=this.ctx)?void 0:n.canvas.width,null==(r=this.ctx)?void 0:r.canvas.height),this.drawImage(this.ctx,this.image,i);let s=Math.max(devicePixelRatio,1),o=this.ctx.getImageData(a.x*s,a.y*s,1,1);return this.ctx.restore(),!!(o&&o.data[3]>0)}getBBox(){let e=this.position,t=new Te(e.x,e.z),n=new Ft,r=new Te(1,1);this.translate&&r.set(this.translate.x,this.translate.y);let i=[],a=r.x*this.width,s=r.y*this.height,o=(t,n)=>i.push(new Te(e.x+t,e.z+n));o(a,s),o(a,s+this.height),o(a+this.width,s+this.height),o(a+this.width,s);let l=i.map((n=>{let r=this.getRotation();return r&&n.rotateAround(t,r),new q(n.x,e.y,n.y)}));return n.setFromPoints(l),n}},Jpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABgCAMAAACuYkXGAAAAulBMVEUAAABJSV9pdntRWmdeaHZMW21ZYnJqcH9PV2dSWmtTXmtXX3Jka3tfZ3daY3NXYHBbZHNbZHJaYXNWX3D9/f5cZnT+/v6xs7zKzdKusbr6+vvs7e/Z29/s7e/09faPlaCVmaX6+vz6+vv5+fnw8fP3+Pjh4+Xu7/Da2+Dp6uz+/v719vjz9PX09PRfYXP///+vsLlpa3vDxMv19ffr6+7r6+2lprCHiJZ9fo1zdITNzdObnKeRkp9zdYQN9RLUAAAALnRSTlMAAwQICgYSBwsPDRUMDxcZHRsjH+Mg8TwvIMZ+UpGIMizVtqael3VrZ1zTuq2q+zBSvwAABtBJREFUaN7tmXlD00AQxSW7yeYsPaktKJcgeBRbbsHv/7V8b3ZjTOiRrfylTnoIpD+eb2dmD978j789dtzrjry8HrYWIL8u91Xx+HxgOYG88FHGK2gNbOxUb+7720It2BFNiAh4BXw66bjPMwlKA4gJTWiMUsrgUoZflrL9ra4sMCo0mlilldb4lxY6hQvbU7HDUipQiFjrPLYXvlKiXdAU7a03JCCWyNM8jfFM81znuRI0fmtovW7vr1ANpIGbpmmBSHglSZEiAIcr8JyOtLbDyoUarSGO2MnB/umn4RViOD3ZP0iKIi1yjQDY2EFsiUVwtHLITSaX072rWuydfIwgnG4rzWFsQxYsEkppcPGfn7wH9WUMT99Cth3HINysmQYzceECvU2IXRXv3yYp0YZFA3Abe0PYAG5xWWKvF3fPj/PZbPZ4f7e4KVV/TAr6oQwSb0PWkWsQzIVicuao3+5ntXgo2WcT2JHHSm3Q/Ct5NdI2efvJYam0GU8WPYQdcaxlBNc1DnIN0zcGd3jFAHZ5fHPkqKAbBK8mUzGqCeNWRJZ78zBbGT9unGaIps9rzEB5SmdIU8ddQO7qmH+v3IBm2ryKC3AIg4tiItxvFWSNHZ8mURLbQoGy5U6w3nRaJNGZ47Yin8HmnPnM/r3cYQMw8iz6yPu/z1rEgndeQnKs7AAuFwwfWMdi8M28DXh+Q5snEcbPlsnOipRQcV5E7ynjcdYqHqS6owRmhMsTQ+Y2ZAQyraXBlc17E9hMMwh+KTikExi5Uxoxaxvza5Ec5bDZvHRZ5mM6nBYZHX5qDXaSUSZQDEqzGUlXU2gRTAkK9pN8ic5PyS8Vsw2rGNzohCXnARbJ0wjj5yTXGzxTQhOcsQc/+IDv3fClOeoaAhsWg6vQfLIDPycY9OIgklxmw3jR4JWmE/ueTrjy288wnWhKRtSsMHboMlp85we+w0dOsyhx4GaHDy14irvu/cDP+MgxwbnSMvnVyxn9J0mizlDK2St+sF9kyAu2ZWj8XTPqmf0nirIrxMwv5vxMlqGsCa5lBZNCoeyiqOMLZpRgKnZeVE7I1BFlW4M7NFk18o1r0RDlUYLnW4B3Ac6RyBRcnz2M1N3WgwfFUcq5Lwga2YZZH2O3e4y7nv3ArOmpWKHZ7UVx1TSNyUXx1+0K5DPBhWazB7jeKix425ImmOlmalbYiTQnmE3o2g98yybkrDC1PHbpVhB8tOdb0w9sm71OmcdBo7sBzHTLelNOpb5OnAgYrb7RN6mYiYy06F3Qi7mnE+e9TOYQExqIrE9MRkki78ILL8lPzOIu6yPR0ukbM17AZTHBvXd+kin4C8GsD9PwGF64GSTr9Pwky7pw3KNigMEluV4hkm9Rp9el5KuHtuWMeNft2R7UXLKQLOCCXnSP2C9u2y0KacRwTCeK1K0461aUK0Ka3L24alt+sqg/7zonYhO8OHeBNdKRE3ox+OCz8P4w6O52skTWyA3BCPwq2X4kIvnouP1WYXjkBNvyaFj8a8mSsEZ6g/FQFvXrNzcL4Y4H4Eo962qD01wU0guRPLLk28c1LeLWcmkEBAOslu7WA9lDx1gCZB3aDPI6O+awwXEpmHs9dqA1WwWZ+KC578i3T0ux1/LD4/HICU4xQLUkbnY4DckkdwejQ+YG0YtGsdwTK/lwSL2Sw9wpALsCHMi+n82TZoz65xDt2Hf3j1T6+Hy3IFVsuOgPrF4Wh+aybcV+LJB2n8tEAnJ31B+julfE3rvD/qhLLo3gCtZW3XIwybG1mT4P+v3xl+FK7ACJ1ukIV8HgFVzaI6cKKpdZFT7TaLDPP+81qNMLwVZcdolVYGHLLh0tg/tpS4bTiIP9z1NRPjz+sn9wiO8MaK/4m3CRaeBwE9yskoAHFgBD9C7sABrsRozgbm/X+Ztq1Jw9ytpwOKboM8k0moMosivqgNiexRZJzoQwELzxEEt2qCQDDTbRZLsYIIC1XIDlWM9uzzeRgdaaI1iADD8QhDMGeBKKQetEkdgQIx/K7fkmdKioGXawCEs2ebwE6tSmItcm8MaTQueGNrKxLiy6YwNQJhipxNo0Y2W0PzWlaHEaqsXsKoSawIVcM89U24NvJzpkd1bidUG0C1KZClCLHyoFrPcBckgy0XGaJ0mBB4US6rxltTm5vkf0CkE20FCe5kVKKAtC8TIV1/OUHuMCWWTHuQZf57o8+scglNQd/7+DSLsj2GjrKJGa2NBiPeU6uKAlDM/5AeMbs8vIgUeD62kH4S4ok0IBbVC3RANUxU5FrcDbiy5pVMu3BnQ7dJl+AnZCeeHx5yE0C9us1R8uz//xD8RPQ80FqUsWMbIAAAAASUVORK5CYII=",Qpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACqCAMAAAAKqCSwAAAAh1BMVEUAAABfTP9eTP9fTP9eTP9fTP9fTP9fTf9fTf9fTP9fTP9fTP9fTf9fTP9eTf9eTP9fTP9fTP9eTP9eTP9eTP9fTf9fTf9fTf9fTf9fTf9fTf9eTP9fTf9cSP9dS/9eTP9fTf9fTf9fTP9fTf9cSv9fTf9fTf9fTf9fTf9fTf9fTf9fTf9fTf/hY9QXAAAALXRSTlMARjRhS0HMZ1M5PVgva1wrTyYbFyJwlnx0gaATeAUPH4mmjYUKm5Gvv7m0q8X/SpWnAAAGcklEQVR42tXcCXriMAwFYEFhBsqeQIEGB2jTjc79zzdmFaDEjgmyhU/wf6+yvIUCxxhE8CBj3Kw9iHXZbNYew7p81tSHsEbPe2pDvDVuH6nSrVkdqcMlCB6q2z6jtgRb1aB+pGrpsCXYOq4jdZuqXGtcR2ptl2qrI9Oadi+oO2unMwZ5Q43OqY0DVaR11L2kDvfUfl+cNRl0SQHsqU/CrNmAUlsHqiyrGg+KU316GoGcEY+M1L9yrOnojNo8dQCkirGq5ciSqhhrMkYq6at7aq8nwqrGhEoKQFsHEH5EudThOVVLe5Pw1nSJ1PbFduUy1Ulwq4o01TStkDoLbE1s1P6ROpvNuhBiYKj51GFOqrNFkFwxVHuqSF2EyzWLojK1itRpMGsckVSbeLbKo4ayZoRqTXU6D2NN4tidGsSaxXGMtWrcA5xT3+vgfaTxRQF0Tc0KqSGsKjmnDooKgKb6vvJtzZBarq8i1bc10VRDX20ZUl29ebVmSeLQASZXVK/WVEtdlgCk7qyf/qxqR7Wn2iepznepfn62wdPIMNXRsQO0Cw4sdFqtNPXFk1WlJNWucVrRVF88WbMtNTF2ALK1XpxNK2194bcilU4rWgB92qxOqb58eLCqLDVMK3oMLKKyWpGaklSte4Apob4+A/PITqlGBiqdVpTKbVUHqvPWmlKJlY8a3URdnVHXfFakJnkLK1LNBYDUdRPOh+ACWK8Zc1VFBeCwsL6dqNr6i7kyUXEPYE8Vm9X8ulY1Fa081L0Vqe7NCqlfJ6uQApjmU381Fa1M1Pg+02pL3aCVmWpP9WpnRaibGofUdQnoFXYALIANi7UClRbAWg8t1dSfnxprqsvbDtdb6yFVpGorF1Vbb6PSDnCgftfCpkoP1/nTaqOp2spCNd4EUuqisFlhqt/fDa5U3W5XpjmbQKzVzY76r8GUqlMBWPrqz56KVg8FQKeVvQAwVbT6KABaqxNDB8BmdaD+abBQ3Y+Bc9qsrqlo5acW7AGmZQrgrlZSq873q6vcJQBTRWtVae4xsGvtAJZUkYpW/iWAvgXQZkX7KlLR6nsJ6BmpNFW08lC7tpvAhW21QipaWVarrjFVWqufhlTvZdVSMq0sBUCalbkDoNX/gcWxA9zNqhhOrISK1oAdYJ5XAGRaoZX1wEKpDqlSayWq6dLS7Wz1YWhWaPW6tZ5cXa+ZlwBi5aTSFxaknlarDwsVrR7PVo4LK7VyUOm3K/bV6pfUKrXemdq+U1+l1q+IoQNYD9e0AOiBhUoZa1VL899YaQd4JVQq5TxcD7FWXU8BxLqJgJPqXqs4raiUmdqq3qzwrx+0r+LCSvcARHo36qh6ql+kVomUcwlwfws4UkmdyplWhIqZ+r8Ictta/yNS1mlF+ursQLWfWFHq89KyU+EYiNLKVHwOrlYAtAOglDXVpuGTsPKpolTc4ZrsV4k0yGo1t6a6k0qgYqpFZyuUVh7GWjVRp+WWACKtmmpa4lvrjvuVxVYq5XsAPFznp/qLUuZmVfUiCKX8BYCrFVLJC0vhErCO4TCE9tVTqlr6INR1LOrTBcMS8EqljFtrOq3+kmn1XrCwotRjquQxyH62QilvB3B/Y6UF8IFSP99ZNfN/c23fWaGUi7q8z2MQkxSwAGK6Wu1jHTo2qxci9bSzajhuAtmkANW2KzTVT5QyUqu/W11IxVCneZtAVilStdXxLYDeWrNKARy/te4ZvrN6S4B1ZOV+GmansktBOfw0zNhXVwlwD4dNoGm1eueUIlVbb0sVO4APKSjrtGrZfhuIUuZhP7BYC2DuRwrZjT8MwYXVlxSU6YWlYf/KAqX8w+k5mL6wTP1JIavw20BmKY21wv3qwqsUspuvLHxLAW7+txvepZA5XQUjdZaC76HofpW+W1FqAClAesu0moSQgnL7zGaxpXqWYqzOtdoLJAXl2qxCSDFWSj1KabP6m0K4UXoTqKWzoFJIS/+DiNBSgPIXQaGlkJ2oXfPvrZ5SCD3icqkKkIJa7qgD00WQDClAWuI1sC9CChBZP7ORIgV1ubDSJaAjRQqQmKeVICnAspgqTApqVExtZSBqpIU3gdKkAFF+qgKlAKPcL9iHAqWgclKVKQXI6C8uGzKlAPHVw6VcKcDysgBqcqUAg7MCkC0F1UWqbKm21o8F0BQuBcjae6p8KUCqqY8hBYg19fkhpFvro0gBEhbpfwjbOY5gXmpMAAAAAElFTkSuQmCC",eme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABgCAMAAACuYkXGAAAAt1BMVEUAAABRUmRVYHFcZHBRWWZia3plb39aYnFeZnVYYXNZYnJPWGdZYnJRWWtZYnJZY3JWYG9eZnVcY3RXXnH+/v7+/v78/P2xs7zKzdKusbr6+vv4+frz9PXn6evs7e/09faPlaCVmaX6+vz09PX5+fns7fDa2+Dp6uzS1Nni4+X+/v7l5+rx8vL9/f1fTf////+vpv9pWP/DvP/19P9zY//r6f/r6P+lm/+Hef99bv/Nx/+bkP+RhP+tEDdkAAAALnRSTlMAAQMGCAsIDQ8UEgsXEB0gGhojJOLx5DwvIMa4m3CRiDIs1aymfWdcV03ShXjTY8FN1QAABtZJREFUaN7tmWlb2kAUhS1knSFAXFBArFtduoAgbtX//7t67gITEsCM+rFHwNZHXs9z5t6bybDzX376hi/5Bx5fxsSTeIBD8qPPUxUndP6f0+fITo0GngUs/ZEPMl0ADVAbKgf3J+siLaxWpOY1HV8yIQvQZlOeJeNedaJWHLhZlrJ94/imKkCjZhAEUYDXSMjCVtN14c4tM/GIAA3CILRhRPyo6HunJrhoVuwCGQIZxqF8t4TH3xK0rqEPmJiwZ4UXx7GN6ZX+AtwHTTYOMkf9DlkqV1MAFO9nZKLK8Iwh0C24hG7UQmv5arphBHcgJf3b35c/9yfQ/mD4+5bxFIx6hriZ6q0arVZsbZL1rwcHkxUdDEcZ0KFkzZ5JW/2qXc6B7fa/g1rV/uUR0FhGVCEHLdo6y5gb0YLFjN2k70dZHGNlIwl6KxdSbmCBTa4X2PvZ09t8Oh6P589Ps8eFawSCqB1586hecqPQIoVjpd49j1f0smAf9xEH6iMQ8nospaBlBm4cZ0c/FQunFb0Kev8oS6Q6dHBU2cAqOEC+KIYjlBek2KrulGyEvCVm4WoORrgPL+ONmj+qZ8QRcdWtn3WLhUOvLbkz2N2s6V8lI+dA04DWcRnM68bcOwfZEsefvkls4EbSGjD3G7oiM8fKrUU+NlR1FIakUSkJDSJOzGgC/R3X0GwCXWeJDXkgrUkCaOLS2JGCeJjWAU8fKea+iS1bXkvmimDD38nGfFxLL9zdJkPNsWWozG1C4KKCawbsYj7oI2Ys4DrLmjCCMJcUxLiupvdkOUXNWYArMS97LklSSvi1Nlgto02WA3SlKggcseGRGPazfG2SxFrpkp2y4ygirhlSy3mA2fLAGFh289MVW4OXDuCUZvCLD/hZlw9kBrsW4Qsdd12SpbeeSUCUxa0xMVfct6JjvoCKYfPDMwltvx8pli8ky4C5peMoaEyYlCJ+8gM/4S2Xqcli6mvFqnSuJYh4gN969gO/4S3nBI65rXcaxdEGLkfc2ud29tKc5kXL0CjSEVdYPFk7Y1oTaOyn6QRqpdzWAJf6GVw4VrCnFAzHq+NCRzFd6tJPgBGFXlRXJ0WEokgFPP0QOEVZVBZPGxqOex9dvJRaJGByybG1Bo7P8VtvHlTt6QE5FrBm7EZQzI4vPtYgw5Z0SECtt2pYo/hoSzvHxcVjMEYFGuSG9mt+YLqg3pBjrWOXBNzTdZQdnx349vQLjc2c6xjgJsAlyzyDWl0aFne+SQxzqmOOuNR6dC8TMviKsph6JjHqEjjWXYsrYwYHvHo5svCy/Ipf77UZHHKDAOjAHEVoMSta+Qlb9jJ80c6pPyw7Lu1X5MpEWfhY1n3hYQ5wRhu4BuSi0ClkefXyNlmevNRtZ+iEkjC8swC2UdmvhGy52z7r+W0Ke4ftnKdxZcuiyxdowbWvJnXbjzf1o3YuY94Cu7qvwFWvyWMoyQjc8dt4d6QmLDtGwkWw7oSk+fL22Xn9W4XeWbvbJcOxcNWwWz2qi8Dy8nXbhz3e1G+/uZkx9xB+5boUuYSd5M6cLbcQhpIf5ltGxKNwOQgj29gq190yUcoIowPytjimiMFxOeEI4DIZKWtbWw1jSX54XYu9n5DOwVXDga3eKrgmCSJYlvVrd06PJ4KelZrlGVjW8Sn8Sm9QETdk31YFO8uoOZA7I5hW9tPznJzO355moEoMV7sdCRhgWbl1jvGQlOXSx553D08mm3RwcrrLOWhv8Cnf+jMnhCyW44TJOci7hxe9TVji5i2pCHc2VKGS9OY/pphTJnc6u3uj4UGJOriCW2DbLeLKfSn8rgW7YzE6akuSTMjIY29vd+/m13DAznvnF79uTvEj4nYxIpZcvRXbdsKCyqA+UTK7hvacQAWWY0izLNFjIT30rapwhEUdyFWHpLk8CA4gqSNYVJnYxcKBSwkTY/OpMU+5gD0jjZTIXbINuqpNWOVyAUdR4eht8znh8tgtzhLDprtd2HbKc1AhYzgGq+eQ2w/tGYwGFNOJVAeUgw7lOR6gils5dVNuCbux6Li56QiSAhE4VXZLoIJN5CxIRwT0DlhLA2i4RhtCJmUByVAJwfIJtY40UY1TaTnpDijqhBJZSKkUQhDyialy3/9wwZ1383k5H54SHDgg8SpHpUrV02OttBrkRRNGajvGQxXGQo0W3KLbWqZ1EZWNpyX7eOGT/yVWPzurx5X+dlk3iQ4envRFlaBYpZa575aHsiMMPXoqdJmtygPr6oO19gMhNcxcL8NVdqMELcwzL8/uY4ay8DPH9ZW+UcQwkeAqHwT5w6va+aLPTPW1QJXTni+QYuW7gr9SHO5/eesfYdwFkua/O6kAAAAASUVORK5CYII=",tme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACqCAMAAAAKqCSwAAAB0VBMVEUAAAB5d55fTP9fTf9fTP9eTf9eTP9fTP9fTf5fTf9aYnFfTP9fTP9RV2hfTP9fTf9fTP9fTP9eTP9eTf9eTf9eTP9fTv5fTf9fTP9fTf9fTf9fTP9fTf9fTf9eTP9eTP9fTP9fTf9YX3BaYnRfTf9fTf9fTP9fTP9QVmZeTf9eTf9fTf9fTf9fTP9fTf9fTf9fTf9eTP9fTf9eTf9jantgTv1fTP9fTf9fTf9fTf9fTP9fTf9eTP9eTftfTf9fTf9eTf9fTP9fTf9fTf9gTvxfTf9aY3RaYnJfTf9fTf9fTf9eTf9aYnNZYXJeTP9fTf9eTuxbYnRfTv1cTuBfTvJfTf9eTP1fUPhfUuVcVsJbT91cT9tbWKtcWLFbXpNdVM5ZX3ReTvtcUsxbVMRcU8heUOb8/P5cWLlcVMheTPxZWZ79/v7+/v63ucpcXJvw8fSvs7r29vmVmarp6e7NztNWU7j7+/vR0eH7+/zh4uTy8/Tr7O2wsbr39/z3+Pj3+Pjl5+rKytSnptWpqsqKisD5+vro6PLs7PTa2ulfTf////9zY//r6P/19P9pWP/DvP+Hef+bkP/r6f+vpv/X0v+5sf/h3v/Nx/+lm/+RhP99bv89/FqOAAAAiXRSTlMABMw/RS9kbCdWB092BUIslzo8U180Ko9Zh5syI4RbNjh9DRBxaUd5CWdRrXNhXaNLSYpvCyBNgIGxjHtMG76UkqG6nh60JhnIqKbEExWqtyciFh4jwRkTIR0mGx0iISAdDycZFRjkKCQKGeLxOSeNP6ksby4QxVnUT5yAHsnJuF9HREI213iiZ4OOOrcAAA/ESURBVHja1NhPj5pAGAbwIYrr4gLVXf9lqavJFi3RZtHFblpJe/ATcIAzR7JNeuhemjTp3U/deWccRxjsSTLjYzTG0y9P3nkBURXpxehC4lj1EF1EAsuqX4Z1W6tZdde9AOu204FWfX+LFE/U7tQw1fX9jeLWrIupNdyq+7RpKW3V9DGlukD1AqRsNPuBUmFW1y3vVl2r02VU14dWvWtVrfF9l7f6BK1eK2pNdULlx6qFqQMVrVpTL7Ta8jB14CDl0tSPqO6BOvqknDWyCbW9p9IBINQ7xaxZj1L5rMKxuiXUhVJWzQFqYQBYq4tGE6mTuNmzbeFYsVYbClnTJqbqeeoG9iqjflTFqgWcyvfqGmaVUT8oYo2cIhVuAumsDvbUKyWsmiNQ6wfqiFGvekh+wgLVosdq7eWpK/nWNAjKWl23itRH2VYt5FTeqnu8Vxd76txGUpNsxVaBKrY6n99ItWrhNnDEDYCpa3YJuGuwVm+kWhNKFVsVNgChTnUkK1mMqUFJq/4GNkCx1en0qzRrFOap7fILK6dOJpKsWZRvtctaFQeAtTr5fI9kJGFUYa9SqnCsgPoiw5pFhHriwup5+3uARb7Vl/cSrGkUc6pd2KvlG2AC1IqtGrzJi/+URFF4guoL1Eeg0laHwy6qMsCEcG2WlA6AxfaqB9RR8VhBq8Mlt1ahNIGJvxw6TkQqf7Zie3VU2uryC7NWUadpsk+T9poxaumdFW2VD8Bqlaf2H1AFASIIDfIiZOCnSVRKtWir/OFaPFbD5bJfiZW2aRrG20/DMGmzCBkpH4CSVhl1dNzq9KjV/vfx+aEmxMB5/fGGrRCMT4EqbIDTDyz5AVhi6rfxuaEadc5mv3a7v7MZfAdt+r9WXfL/qjgAvFWgvmuf30qkf153u93v5+cZsWaEGpdT3dJba5H6j1Vz+00iCsJ4vDz4Um8x3qIxYdUYjalGaqJ4ibb1UkFbwQhCiwK1TcHUFrFatfEW4w5QWrHV+tc6c85ujzA7sCDzwusv337nm5lzQNYei0qgweAs/KjDa0RVrCWGymcApipDPdxbVg0aeAVQXq7AN2RF2GAp95hQ3SGQN1bKVSEBCPWyRkXWHgVqn/r6QSQNzEHNtjeg8D4QOBU8VSo9e5x7OImoQre6iA7gjTUUcsNKoSLr4N4eiYqkWtPAR6iWbdv+CbOWhbAlUpVQhxpQ93jNAGebDXDUGGBw8MbenoiqfEqklpWHuo21AoVXiBpA1Nwk1tWrA8LC0sarlzdRkbUHRaQIiqRF+GGrWoPXlqVIc48nUVU5AQiV71amW2mvDt7o79/WA1kJVZG+ysOqRl2uwlvLylFNEqqUAHKuEqo5Vqhq/8i2HpAqp1qWNQe/bKfqkA9bM0Sape8vtAC9BQiqGgPsVqqO3N3WC6cqo1JQ2W5V4F1kZmYml82RqkOCqsIW0JQAhx3U+zt7Ean4/cMUVLr0yZqfwcpOJpNJQdWmyeqERiVSMwMYAyDqmZ3/Q6qTKoikeKaMqBRYi0SazRLqkHysnNF6n6BqI6ph7fZUBUlUdaZMlQE+Sah8smpADXkcq36Nemnn/3x/R1Rs/obTCayURo1Gh3xNVuZYyahds24hqxIqBdWGwXQCayGVUqioasxzt8K+6qdbGQNcGh7e3jWrJrXoTDXVb3g+n0JSpWpMVLVVAhzgqg4/2N5tVOlOpYKqudZhNpVNtDCAeQ6WGytHvdmdrq5V30CdkarASiSS0WR0aCAWGxXerXyijjgGQNRuWGl7Uk21CNWVMq91mEslElFUNU4G2O+FeloMK1HVm9dOdmNVJWogD1ItJJLEGv/XAMfYDCCpyr06rFC7YHXOfzGv6rlHzSWUWQdadSt+FcznVST9F/XR+c7nP2KlBhC5/fTp2NjYLafGsJ5OTKTw+6eTJOpArAF1r2sAM6+ae4CQVlVIAI1671zn3x9RkTR8+zaxGlSqCWRNKK/G0QA7PEdrX8dqsMkAhHqvM111VhFqRKvawDqhUdPRNKLGRkfbvwbyIVBW9d6dc51d/ehNhb6/a4CvL1/Ob6Km0AHpdDoajcViXl41j+z7vK/XjKoc9c6VzkTto+9vRTTq/LulAlAtLS5o1nGSVanKDaA31u5VvbP1ov9DpRuAi7qwRJTVSqVKv/kikiLreFqjxvgLix6teViFzE2gV1g92ERlrHJX1VmlrTq/iJi11bKaVFZqFYDnL4mUDBAnVOZVWq5ZAvA18LpCRVKG2gErTYBoVYus+iIP1fqybWq1AoXvWtW4QkVSn+NKqH0L0KpiXfEpq5uqkcinAqw3zSvlGsDsOKFqVY/sN6iiAeRuNeKBylhlVHSq/v44rdaMpGZthaJinUZSMoD8xCajyqoqVp8e6NNZhah5vVZz1sKX8fHp6bg3aoOqZ8U7Kz1aC6oyXcVYRVH1skKa8qrBB0RF1iejox7HSj9biAnADWCO1SNC5azyAqBQww1zNVtaNCqy8ptAfr963MwA4hBowsqti+3XakJtvADgS8sHQn2iUXfxboVDIHtiI1U5qmQAzipvgOE8iSrL6qJSAnADiI9Bh5rWwLsc1T+rE1VvYd0Waw1mpzKOqgxVJwC/s/Kbq/5YTauyFmFNRl2BD1PTGUJFWduH1XF5ub7LjxVnlXcVGlXCr2FDRl2GwlQmk9Gouzz+ECIYwNe44p+VVEXUN/DHlqsKX6ccVO7V5o31gnC9JqByVpkUUfWpkqsCnxXqE6Oq2QLwhUXIVd5YDSozAGflBqBW1R41g4WkfAZgLyzcq/xYyagya5+zq7Q2AMCUqyrPVWe3OthqsrouG4CzSq//zq76t5oz/5EhCuJ4T4hr3UcciXMY1yJYZwhCTCJGXBnERGYdw65da9Z93yTNYtz8tar6Tc3r6W/XPNpMtpX1C798Ultdd72qX9NJf9FndVm0alCXLA61LP4is3Kj7tithYB6Wv2glbOq+Y8ElYeBOGSH1QXdVrEKQFK9BGTUe/6IjvrBfw2ocsIQGVyuwNWFFiGAWJFU/6wMav6u/xEQbe/6ua5VQZ2Hg0vMrLTA6ib1uLFmUIf8L7pSq5cJVUIAtte6lK41ahWdFZKqapVqdXjA/6ErVVBBq2QAzu6KAxVI9S4wOStWq5kCo9C4/Q2RXuHfv/WreMSEy0t6IwhQkRSFbFU6a1UeBKF89ysvL4e06t4IwhDgLliQFB1rowmYH74bw/r+i195ce0ao15BAzCoEq2c4+B9WhKIpCiCmuXOCrGOROz14zsmZdTz1lanYWptDQCc1U7HZ4WkurGaKpAbltxc+VQLgX7x/VdMyvUKpNaupiW2gvdpgRVJUSQISBvwRoVgP9RoJvCr9pX6QANDB68xap31ZAN1TthWuyJ+tVvRqqBCtHKTZpjVNFdZrWViZVgRAqXWZUAalIEnw1qd0XQcyqiLkjaCkFQfBBnXKi3rZw+ePK5UXj0ZunOQhEkF9SRWrDmpWPUqwJFaI6meBYpaiVUmAVaov8qopr92VJqWjrlVNwTWPWofAEgdxir+qhxhNQ12aa9RIwgKFj2wLv3TaIWkeieQm5YyCmBWS2pRSaBnNXMqNIJcVQB+VkDqrq+tWoX1WAO11GhaKmMLrK1WulBFq0iq+4AQqrCGx1YkJaPV2FZwzlYBLT2AZqtri3+5DMQW8PDmzUGW600yGEhjbAFazTVWF+bBCQOgYmB1k2LbgqfBqlQFVfEAYqvKhEX3AEeKyXYsbvNgBWXErwzawSUagCSBCfyqQuo01uy9+IT1nT9Ec0uaXKJW7asL2F2J3bNq7lkdAlKnVqVxVY2rWWp+pSRDVmV7LXQXsBpsVdWqQuqw1bpaHw5gKfj2nX9DULcog8uuuBDgHFxuKCZcCOoxu0vfYkpAnrGePasYgKQrjpYFFiwbjidaspB5AK2D/4AScJBQeXmFd1ccu9aOEBDOV/cRaWLWeuPifaSwqhrSs7wOoG0EMaq+ZwWfFaHu10jdxioF1m3/a+SbCpRqtHpasVVtxqr3V5ORZmTPKkivnzWPhOibOlcytkqs4WuLOTBi+4uu9QIHqXt2zZXA/bDD+uxXyv1MatYXTzt2AiEHUFAdpO702gyvh0MO6+2I/7RMrGdKsr0GBjBVdq1VZ4Wp9fSkpDJnk+z6Ac0vraPKl/sJtW6rFFhlywK6K4CqBtbkpOICBLVM63bWUeXzbAAXAls9razaKkuhSma1959ITbySQuAOOSwJ/mVC7S+ZVdtAq3FPGVjU2c7UWkiTokrZakpBcVjkqIbz+UI/CbEWT8C1haQreMaof1YJSbFoMYXAYPBlvSdHVTaoFwK1FpWlUO00LG5uNTcRKXYDpMI2XWE6CmDSw4cD0kvFS81anaPvBG5W/erOU225s2RUo1Z2WD/NN1UoHM5eZFb92iLnyletVhOTYoG1TFjJYVHwzwdKzd66GJww7FbPGNmvYisYndUmIE0YsEyB1fiy/IG6UpdlgyOWs0yK91birCBdwbHFfCBNHAWkxGa93qOVpUKBdZpd1sOkJKBVJbVW+qsLT7XzLtSwsg0Unlwl0EKWSXtuMSsfXOLJbWPE5spXgTS5mHu7VYaVd66eskYZla4DDWrLk1vX9tr2tpFmjF5XkbkaVgZllZJMmnTrFN2GFdmv6q8ugFabbFUhTewEmJXbLCQBJwufh07h1wGsreKQHSYs0XRlWxtIMRcUWCbtWUUq5TtxPg62L4SoBYt2GbS03aTm3ppIA9oeEjkPntLHatUOmR0b7G0ixQwrYxRLP/TXHF1nSPg6VD8N29pSqyuBtF32ynhMazQ6ie/uGw9EKI9EbW3lV9tEipkAsxKtEaKkH/vsBh4yu/dXJwNpu58ImGJISYwr65P3AVquhc8GrXb3eh2RDP8hMbyk4UDMf4EBwLK9bQVbZ9UBUnzPQlQq0otJoHsfYDmQtlOtQsuk8g8smegDETPw4jL6QgiRdliaEK1a40NADt9eEwMYD6SdACWRD0oko9iqbAXDazYdIkVelF5Exf6qrQJWdJYUYfGZOKwCcMTW3c2koyi9ylsWsGZDqKuJdDSlqLxlgQXLuFEm9fqU54y2hi/Z2VmtI9JRluNKdyViq7NHn9TLxNlqtL2WClL6stBWoWBZnwpSz9utPLthN4IWpYSU3rUVA1BCwLy0kHreqVa11ew0kXreAfAAoWg1MU2k9K49ttdEq7P6vFRJL+wDiK2mjZTia0wnkFHXpI7U8yZEcgBjAF0pJPUy02Ie4d+aRlLKW9Cv7konKZmroMr+6sa0knrelqY1m65cekk9bxqvL0ojaGyaSclcra2mm5RY54gBTE05KbEuMS2LMaknpQjLIeC/IKVSi7T6f5CSe5068z8hpUS7I6S/ARbzgdCIDH2vAAAAAElFTkSuQmCC";cc.install({THREE:$t});var cR=class extends cc{constructor(e,t){super(e,t),this.minZoom=0,this.draggingSmoothTime=0,this.keyTruckSpeed=7,this.keys={left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",bottom:"ArrowDown"},this.onKeyDown=e=>{if(this.enabled){switch(e.code){case this.keys.up:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(0,1),this._isUserControllingRotate=!0):(this._truckInternal(0,this.keyTruckSpeed,!1),this._isUserControllingTruck=!0);break;case this.keys.bottom:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(0,-1),this._isUserControllingRotate=!0):(this._truckInternal(0,-this.keyTruckSpeed,!1),this._isUserControllingTruck=!0);break;case this.keys.left:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(1,0),this._isUserControllingRotate=!0):(this._truckInternal(this.keyTruckSpeed,0,!1),this._isUserControllingTruck=!0);break;case this.keys.right:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(-1,0),this._isUserControllingRotate=!0):(this._truckInternal(-this.keyTruckSpeed,0,!1),this._isUserControllingTruck=!0)}this.dispatchEvent({type:"control"})}},this.onKeyUp=e=>{this.dispatchEvent({type:"controlend"})},this._getClientRect(this._elementRect),this.dollySpeedBackup=this.dollySpeed,this.azimuthRotateSpeedBackup=this.azimuthRotateSpeed,this.polarRotateSpeedBackup=this.polarRotateSpeed,this.truckSpeedBackup=this.truckSpeed}get enableZoom(){return!!this.dollySpeed}set enableZoom(e){e?this.dollySpeed=this.dollySpeedBackup:(this.dollySpeedBackup=this.dollySpeed,this.dollySpeed=0)}get enableRotate(){return!!this.azimuthRotateSpeed||!!this.polarRotateSpeed}set enableRotate(e){e?(this.azimuthRotateSpeed=this.azimuthRotateSpeedBackup,this.polarRotateSpeed=this.polarRotateSpeedBackup):(this.azimuthRotateSpeedBackup=this.azimuthRotateSpeed,this.polarRotateSpeedBackup=this.polarRotateSpeed,this.azimuthRotateSpeed=0,this.polarRotateSpeed=0)}get enableTruck(){return!!this.truckSpeed}set enableTruck(e){e?this.truckSpeed=this.truckSpeedBackup:(this.truckSpeedBackup=this.truckSpeed,this.truckSpeed=0)}listenToKeyEvents(){var e,t;null==(e=this._domElement)||e.addEventListener("keydown",this.onKeyDown),null==(t=this._domElement)||t.addEventListener("keyup",this.onKeyUp)}stopListenToKeyEvents(){var e,t;null==(e=this._domElement)||e.removeEventListener("keydown",this.onKeyDown),null==(t=this._domElement)||t.removeEventListener("keyup",this.onKeyUp)}dispose(){super.dispose(),this.stopListenToKeyEvents()}},Bdt=(e=>(e.ZoomChange="zoomchange",e.SyncCamera="synccamera",e.CameraChange="camerachanged",e))(Bdt||{}),NB=class extends si{constructor(e,t){var n,r,i;super(e,{id:(null==t?void 0:t.id)||NB.DEFAULT_ID}),this.CAMERA_Z_POSITION=100,this.width=0,this.height=0,this.frustumSize=this.width,this.renderEnabled=!1,this.drawableList=new $a("overviewMap"),this.clock=new ph,this.raf=new u0,this.raycaster=new Sd,this.translateStart=new Te,this.rotateStart=new Te,this.markerRotateState=!1,this.markerTranslateState=!1,this.isMarkerRotating=!1,this.isMarkerTranslating=!1,this.isUpdateWhenPawnMove=!0,this.allMarkersBBox=new Ft,this.tolerance=5,this.enableLookToAllMarkers=!1,this.handlePointerDown=e=>{let t=this.cameraDrawable,n=this.cameraDirDrawable;if(!(t&&n&&this.viewerContainer&&this.camera&&this.controls))return;let r=this.getDrawableByEvent(e),i=mn.getScreenCoordinateByEvent(e,this.viewerContainer),a=this.lockCameraInViewCenter?this.camera.position:mn.world2Screen(t.position,this.camera,this.viewerContainer);r&&r===n&&(this.isMarkerRotating=!0,this.rotateStart.set(i.x-a.x,i.y-a.y),this.controls.enabled=!1),r&&r===t&&(this.isMarkerTranslating=!0,this.translateStart.set(i.x,i.y),this.controls.enabled=!1)},this.onCameraMove=e=>{var t,n;let r=this.cameraDrawable,i=this.cameraDirDrawable;if(!(r&&i&&this.camera&&this.viewerContainer))return;let a=mn.getScreenCoordinateByEvent(e,this.viewerContainer),s=this.lockCameraInViewCenter?this.camera.position:mn.world2Screen(r.position,this.camera,this.viewerContainer);if(this.isMarkerRotating){let e=new Te(a.x-s.x,a.y-s.y),n=(new Te).subVectors(e,this.rotateStart);if(Math.abs(n.x)>this.tolerance||Math.abs(n.y)>this.tolerance){let n=e.angle()-this.rotateStart.angle();n=(n+2*Math.PI)%(2*Math.PI),null==(t=i.direction)||t.applyAxisAngle(this.camera.up,-n),this.rotateStart.copy(e)}}if(this.isMarkerTranslating){let e=new Te(a.x,a.y),t=(new Te).subVectors(e,this.translateStart);if(Math.abs(t.x)>this.tolerance||Math.abs(t.y)>this.tolerance){let t=mn.screen2World(this.translateStart,this.camera,this.viewerContainer),i=mn.screen2World(e,this.camera,this.viewerContainer),a=(new q).subVectors(i,t);a.setY(0),this.lockCameraInViewCenter?null==(n=this.controls)||n.truck(a.x,a.z):r.position.add(a),this.translateStart.copy(e)}}if(this.isMarkerRotating||this.isMarkerTranslating){let e=this.lockCameraInViewCenter?this.camera.position.clone():r.position.clone(),t=i.direction.clone();this.syncCamera(e,t)}},this.handlePointerUp=()=>{this.isMarkerTranslating=!1,this.isMarkerRotating=!1,this.markerRotateState=!1,this.markerTranslateState=!1,this.controls.enabled=!0},this.handlePointerLeave=()=>{this.markerRotateState=this.isMarkerRotating,this.markerTranslateState=this.isMarkerTranslating,this.isMarkerTranslating=!1,this.isMarkerRotating=!1,this.controls.enabled=!0},this.handlePointerEnter=e=>{1&e.buttons?(this.isMarkerTranslating=this.markerTranslateState,this.isMarkerRotating=this.markerRotateState,this.controls.enabled=!1):(this.markerRotateState=!1,this.markerTranslateState=!1)},this.handleDblClick=e=>{var t;let n=this.cameraDrawable,r=this.cameraDirDrawable;if(this.animationId&&window.cancelAnimationFrame(this.animationId),!(n&&r&&this.camera&&this.viewerContainer))return;let i=mn.getScreenCoordinateByEvent(e,this.viewerContainer),a=mn.screen2World(i,this.camera,this.viewerContainer);this.lockCameraInViewCenter?(a.setY(this.camera.position.y),null==(t=this.controls)||t.setLookAt(a.x,a.y,a.z,a.x,0,a.z)):(a.setY(n.position.y),n.position.copy(a));let s=r.direction.clone();this.syncCamera(a,s)},this.handlePointerMove=e=>{this.onCameraHover(e),this.onCameraMove(e),this.enableRender()},this.enableRender=(e=1e3)=>{this.renderEnabled=!0,this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.timeoutSymbol=this.raf.setTimeout((()=>{this.renderEnabled=!1}),e))},this.isPointInBoundary=e=>{var t;if(null==(t=this.boundaries)||!t.size)return;let n,r=new Te(e.x,e.y);return this.boundaries.forEach((e=>{e.polygon.length<3||Gt.isPointInPolygon(r,e.polygon)&&(n={id:e.id,name:e.name})})),n},this.animate=()=>{var e,t,n;this.requestAnimationFrameHandle=requestAnimationFrame(this.animate);let r=this.clock.getDelta(),i=null==(e=this.controls)?void 0:e.update(r);if(this.scene&&this.camera){if(this.viewerContainer&&this.viewerContainer){let{width:e,height:t}=this.viewerContainer.getBoundingClientRect();(this.width!==e||this.height!==t)&&(i=!0,this.resize(e,t))}if(this.renderEnabled||i){if(null==(t=this.renderer)||t.render(this.scene,this.camera),!Bn.isBrowser){let e=null==(n=this.renderer)?void 0:n.getContext();e&&e.endFrameEXP&&(e.flush(),e.endFrameEXP())}this.enableLookToAllMarkers&&this.lookToAllMarkers(),this.dispatchEvent("afterrender")}}},this.cfg=t||{},this.enabled=null==(n=this.cfg.enabled)||n,this.lockCameraInViewCenter=!!this.cfg.lockCameraInViewCenter,this.radius=this.cfg.radius,this.size=this.cfg.size,this.minZoomFactor=null!=(r=this.cfg.minZoomFactor)?r:.3,this.maxZoomFactor=null!=(i=this.cfg.maxZoomFactor)?i:5,this.init(),this.animate(),this.enableRender()}get cameraDrawable(){return this.getMarker("cameraDrawable")}get cameraDirDrawable(){return this.getMarker("cameraDirDrawable")}get overviewMapDrawable(){return this.getMarker("overviewMap")}init(){Bn.isBrowser&&!this.cfg.context&&this.initDom(),this.initScene(),this.initRenderer(),this.initCamera(),this.initInputManager(),this.initEvents(),this.initControls()}initDom(){let e=this.cfg.containerId?document.getElementById(this.cfg.containerId):void 0,t=document.createElement("div");if(e)t.style.cssText="width: 100%; height: 100%;display: inline-block;position: relative; overflow: hidden;",e.appendChild(t);else{let e="dxf-viewer-overview-map";t.id=e,this.cfg.containerId=e,document.body.appendChild(t)}this.width=t.clientWidth,this.height=t.clientHeight,this.viewerContainer=t}initInputManager(){this.viewerContainer&&(this.inputManager=new Jd(this.viewerContainer))}initScene(){let e=new ea;e.background=null,e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,this.scene=e}initCamera(){if(!this.scene)return;let e=new To(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,1e5);e.position.set(0,0,this.CAMERA_Z_POSITION),e.zoom=10,e.updateProjectionMatrix(),this.scene.add(e),this.camera=e,this.frustumSize=this.width}initRenderer(){var e;let{context:t}=this.cfg,n={context:t,antialias:!0,preserveDrawingBuffer:!0,alpha:!1,stencil:!1};!Bn.isBrowser&&t&&Object.assign(n,{context:t,canvas:Bn.creatReactNativeCanvas(t)}),t&&(this.width=t.drawingBufferWidth,this.height=t.drawingBufferHeight),this.renderer=new hl(n),this.renderer.setClearColor(11119017,1),this.renderer.setClearAlpha(0),Bn.isBrowser&&(!t&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.classList.add("webgl-renderer"),null==(e=this.viewerContainer)||e.appendChild(this.renderer.domElement)),this.renderer.setSize(this.width,this.height),this.overlayRender=new xn(this),this.overlayRender.addDrawableList(this.drawableList)}initControls(){let e=this.camera;if(!this.inputManager||!e)return;let t=new cR(e,this.inputManager);t.enableRotate=!1,t.enabled=this.enabled,t.keyTruckSpeed=10,t.dollyToCursor=!0,t.dollySpeed=.1,t.truckSpeed=1,t.mouseButtons={left:yt.TRUCK,middle:yt.TRUCK,wheel:yt.ZOOM,right:yt.TRUCK},t.touches={one:yt.TOUCH_TRUCK,two:yt.TOUCH_ZOOM_TRUCK,three:yt.NONE},t.update(0),this.controls=t,t.addEventListener("control",this.onControlsChange()),t.addEventListener("update",this.onControlsUpdate())}onControlsChange(){return()=>{this.enableRender()}}onControlsUpdate(){return()=>{if(!this.camera||!this.cameraZoom||!this.initialZoom)return;let e=this.camera.zoom;Bt.areNumbersEqual(e,this.cameraZoom)||(this.cameraZoom=e,this.dispatchEvent("zoomchange",(e/this.initialZoom).toFixed(2)))}}initEvents(){var e,t,n,r,i,a;!this.enabled||this.lockCameraInViewCenter||(null==(e=this.inputManager)||e.addEventListener("pointermove",this.handlePointerMove),null==(t=this.inputManager)||t.addEventListener("pointerdown",this.handlePointerDown),null==(n=this.inputManager)||n.addEventListener("pointerup",this.handlePointerUp),null==(r=this.inputManager)||r.addEventListener("dblclick",this.handleDblClick),null==(i=this.inputManager)||i.addEventListener("pointerleave",this.handlePointerLeave),null==(a=this.inputManager)||a.addEventListener("pointerenter",this.handlePointerEnter))}getDrawableByEvent(e){var t;if(!this.camera||!this.groundPlane||!this.viewerContainer)return;let n=this.raycaster;if(!n)return;let r=mn.getScreenCoordinateByEvent(e,this.viewerContainer),i=mn.screen2Ndc(r,this.camera,this.viewerContainer);n.setFromCamera(i,this.camera);let a=n.intersectObject(this.groundPlane);if(0===a.length||!a[0].point)return;let s=null==(t=this.overlayRender)?void 0:t.getDrawablesByPosition(a[0].point);return s&&s.length>0?s[0]:void 0}onCameraHover(e){let t=this.cameraDrawable,n=this.cameraDirDrawable;if(!t||!n)return;t.hover=!1,n.hover=!1;let r=this.getDrawableByEvent(e);r&&r===n&&(n.hover=!0),r&&r===t&&(t.hover=!0),this.enableRender()}syncCamera(e,t){this.timeout&&clearTimeout(this.timeout),this.isUpdateWhenPawnMove=!1,this.dispatchEvent("synccamera",{location:e,direction:t}),this.dispatchEvent("camerachanged",e),this.timeout=setTimeout((()=>{this.timeout&&clearTimeout(this.timeout),this.isUpdateWhenPawnMove=!0}),500)}updateZoomFromRadius(){if(!this.camera||!this.radius||!this.controls)return;let e=this.controls;e.minZoom=0,e.maxZoom=1/0,e.update(0);let t=this.getContainerRadius(),n=this.camera.zoom*Number((t/this.radius).toFixed(2));this.controls.zoomTo(n)}getContainerRadius(){if(!this.viewerContainer)return;let e=this.viewerContainer,{width:t,height:n}=e.getBoundingClientRect();return this.size&&(t=this.size.width,n=this.size.height),this.screenDistance2WorldDistance(Math.min(t,n)/2)}screenDistance2WorldDistance(e){let t=this.camera,n=this.viewerContainer,r=mn.screen2World(new Te(e,0),t,n),i=mn.screen2World(new Te(0,0),t,n);return Math.abs(new Te(r.x,r.z).distanceTo(new Te(i.x,i.z)))}initGroundPlane(e){var t;Ct.expandBoxByScale(e,3);let n=e.min,r=e.max,i=r.x-n.x+r.y-n.y+r.z-n.z;Ct.expandBoxByMinSize(e,i);let a=[],s=(e,t,n)=>{a.push(new q(e,t,n))},o=e.getSize(new q),l=e.getCenter(new q);if(s(-o.x/2,0,-o.z/2),s(o.x/2,0,-o.z/2),s(o.x/2,0,o.z/2),s(-o.x/2,0,o.z/2),this.groundPlane)this.groundPlane.geometry.setFromPoints(a),this.groundPlane.geometry.computeBoundingSphere(),this.groundPlane.geometry.computeBoundingBox(),this.groundPlane.geometry.computeVertexNormals();else{let e=new Nt;e.setFromPoints(a),e.setIndex([0,3,2,0,2,1]),e.computeVertexNormals();let n=new mr({color:"#888",transparent:!0,opacity:0,side:Mr});this.groundPlane=new Jt(e,n),this.groundPlane.frustumCulled=!1,this.groundPlane.position.copy(l),this.groundPlane.scale.set(1e5,1e5,1),this.groundPlane.name="groundPlane",this.groundPlane.userData.selectable=!1,this.groundPlane.renderOrder=-1e3,this.groundPlane.layers.enableAll(),yr.disableLayerChannels(this.groundPlane,[12]),null==(t=this.scene)||t.add(this.groundPlane)}this.groundPlane.updateMatrixWorld()}initMaxAndMinZoom(){if(!this.controls)return;this.controls.update(0);let e=this.camera.zoom;this.controls.minZoom=e*this.minZoomFactor,this.controls.maxZoom=e*this.maxZoomFactor,this.initialZoom=e,this.cameraZoom=e}getImageElementFromUrl(e){let t=new Image;return t.src=e,new Promise(((e,n)=>{t.onload=()=>{e(t)},t.onerror=e=>{n(e)}}))}updateOverviewMap(e){return Et(this,null,(function*(){let t=new q,n=new q;t.set(e.min.x,e.min.y,e.min.z),n.set(e.max.x,e.max.y,e.max.z);let r=yield this.getImageElementFromUrl(e.image),i=new q(Math.min(t.x,n.x),0,Math.min(t.z,n.z)),a=new q(Math.max(t.x,n.x),0,Math.max(t.z,n.z)),s=new Ft(i,a);this.initGroundPlane(s.clone());let o=this.overviewMapDrawable;o?(o.image=r,o.radius=this.radius,o.max.copy(n),o.min.copy(t)):(this.zoomToBBox(s),this.updateZoomFromRadius(),this.initMaxAndMinZoom(),this.addMarker(new lR("overviewMap",{image:r,min:t,max:n,radius:this.radius}))),this.imgBBox=s,this.enableRender()}))}createCameraMarkers(e,t){return Et(this,null,(function*(){var n,r;if(!this.camera||!this.viewerContainer)return;let i=this.cameraDrawable,a=this.cameraDirDrawable;if(i)i.position.copy(e),null==(n=i.direction)||n.copy(t);else{let n=yield this.getImageElementFromUrl(Qpe),r=yield this.getImageElementFromUrl(tme);this.addMarker(new _b("cameraDirDrawable",{image:n,hoverImage:r,translate:new Te(-1,-.5),scale:.25,position:e,direction:t,enabledHover:this.enabled}))}if(a)a.position.copy(e),null==(r=a.direction)||r.copy(t);else{let n=yield this.getImageElementFromUrl(Jpe),r=yield this.getImageElementFromUrl(eme);this.addMarker(new _b("cameraDrawable",{image:n,hoverImage:r,translate:new Te(-.5,-.5),scale:.25,position:e,direction:t,enabledHover:this.enabled,renderOrder:-996}))}this.enableRender()}))}initCameraMarkers(e,t){return Et(this,null,(function*(){var n;let r=new q(e.x,e.y,e.z),i=new q(t.x,t.y,t.z);if(this.lockCameraInViewCenter){let e=this.camera;yield this.createCameraMarkers(e.position,i),r.setY(e.position.y),null==(n=this.controls)||n.setLookAt(r.x,r.y,r.z,r.x,0,r.z)}else yield this.createCameraMarkers(r,i)}))}updateOverviewMapCameraAnimation(){var e,t;let n=this.animationParam;if(!n)return void(this.animationId&&cancelAnimationFrame(this.animationId));let{startTime:r,positionStart:i,positionEnd:a,directionStart:s,directionEnd:o}=n,l=Math.min(1,(Date.now()-r)/500),h=i.lerp(a,l),u=null==s?void 0:s.lerp(o,l),c=this.cameraDrawable,d=this.cameraDirDrawable;if(u&&(null==(e=null==d?void 0:d.direction)||e.copy(u)),this.lockCameraInViewCenter?null==(t=this.controls)||t.setLookAt(h.x,h.y,h.z,h.x,0,h.z):(null==c||c.position.copy(h),null==d||d.position.copy(h)),this.enableRender(),1===l)return this.animationParam=void 0,void(this.animationId&&cancelAnimationFrame(this.animationId));this.animationId=requestAnimationFrame(this.updateOverviewMapCameraAnimation.bind(this))}updateOverviewMapCamera(e,t){var n;let r=this.cameraDrawable,i=this.cameraDirDrawable;if(!(this.camera&&this.viewerContainer&&r&&this.isUpdateWhenPawnMove))return;this.animationId&&cancelAnimationFrame(this.animationId);let a,s=new q(e.x,e.y,e.z),o=new q(t.x,t.y,t.z);this.lockCameraInViewCenter?(a=this.camera.position.clone(),s.setY(a.y)):a=r.position.clone();let l=Date.now(),h=null==(n=null==i?void 0:i.direction)?void 0:n.clone();this.animationParam={startTime:l,positionStart:a,positionEnd:s,directionStart:h,directionEnd:o},this.updateOverviewMapCameraAnimation(),this.dispatchEvent("camerachanged",s)}zoomToBBox(e){if(!this.scene||!this.camera||!this.controls)return;let t=this.camera,n=e.max.x-e.min.x,r=e.max.z-e.min.z,i=t.right-t.left,a=t.top-t.bottom,s=Math.min(i/n,a/r);this.controls.zoomTo(s);let o=new q;e.getCenter(o);let l=o.clone().setY(e.max.y+2);l.equals(o)||this.controls.setLookAt(l.x,l.y,l.z,o.x,o.y,o.z)}addMarker(e){this.drawableList.addDrawable(e),this.enableRender()}getMarker(e){return this.drawableList.getDrawableById(e)}removeMarker(e){this.drawableList.removeDrawable(e),this.enableRender()}dollyIn(e=.2){let t=this.camera;if(!t||!this.controls||!this.initialZoom)return;let n=t.zoom,r=Math.min(n+e*this.initialZoom,this.controls.maxZoom);this.controls.zoomTo(r)}dollyOut(e=.2){let t=this.camera;if(!t||!this.controls||!this.initialZoom)return;let n=t.zoom,r=Math.max(n-e*this.initialZoom,this.controls.minZoom);this.controls.zoomTo(r)}goToHomeView(){this.imgBBox&&this.zoomToBBox(this.imgBBox)}setRadius(e){this.radius=e;let t=this.overviewMapDrawable;t&&(t.radius=e),this.updateZoomFromRadius()}registerBoundaries(e){this.boundaries||(this.boundaries=new Map),e.forEach((e=>{var t;let n=e.points.map((e=>new Te(e.x,e.y)));null==(t=this.boundaries)||t.set(e.id,{id:e.id,name:e.name,polygon:n})}))}screenShot(){return Et(this,null,(function*(){var e;try{let t=yield null==(e=this.overlayRender)?void 0:e.getImage((()=>!0));return null==t?void 0:t.src}catch(e){return void fe.error(e)}}))}getViewerConfig(){return this.cfg}is3d(){return!0}getRaycaster(){return this.raycaster}getPixelSizeInWorldCoord(){let e=this.camera,{clientWidth:t,clientHeight:n}=this.viewerContainer;return Math.max(e.right-e.left,e.top-e.bottom)/e.zoom/Math.max(t,n)}lookToAllMarkers(){var e,t;let n=new Ft;this.drawableList.getDrawables().forEach((e=>{if("overviewMap"===e.id||"cameraDrawable"===e.id||"cameraDirDrawable"===e.id||!this.camera||!this.viewerContainer)return;let t=e;n.union(t.getBBox())})),n.min.setY(0),n.max.setY(0);let r=n.min.distanceTo(n.max);n.expandByVector(new q(.01*r,0,.01*r)),Bt.areVector3sEqual(null==(e=this.allMarkersBBox)?void 0:e.min,n.min)&&Bt.areVector3sEqual(null==(t=this.allMarkersBBox)?void 0:t.max,n.max)?this.enableLookToAllMarkers=!1:(this.allMarkersBBox=n,this.zoomToBBox(n))}resize(e,t){let n=this.camera;if(n&&t>0){let r=e/t;n.left=-this.frustumSize/2,n.right=this.frustumSize/2,n.top=this.frustumSize/r/2,n.bottom=-this.frustumSize/r/2,n.updateProjectionMatrix(),this.renderer&&this.renderer.setSize(e,t,!0),this.overlayRender&&this.overlayRender.setSize(e,t)}this.width=e,this.height=t,this.enableRender()}destroy(){var e,t,n;this.raycaster=void 0,null==(e=this.inputManager)||e.removeEventListener(),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.drawableList.clear(),null==(t=this.viewerContainer)||t.remove(),this.viewerContainer=void 0,null==(n=this.scene)||n.clear(),this.scene=void 0,this.requestAnimationFrameHandle&&(cancelAnimationFrame(this.requestAnimationFrameHandle),this.requestAnimationFrameHandle=void 0),this.renderer&&(this.renderer.domElement.remove(),this.renderer.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=void 0),this.overlayRender&&(this.overlayRender.destroy(),this.overlayRender=void 0),this.camera=void 0,this.controls&&(this.controls.dispose(),this.controls=void 0),this.groundPlane&&(this.groundPlane.geometry.dispose(),this.groundPlane.clear(),this.groundPlane=void 0),this.removeEventListener()}},FB=NB;FB.DEFAULT_ID="OverviewMapPlugin";var nme=class extends Ei{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.text=t.text,this.position=t.position,this.offset=t.offset||new Te,this.textStyle=t.textStyle||{},this.radius=t.radius,this.displayRadius=t.displayRadius||1/0,this.size=t.size||{width:0,height:0},this.renderOrder=t.renderOrder||-998}getFont(){let e=this.textStyle,t="";return t+=(e.fontSize?e.fontSize:12)+"px ",t+=e.fontWeight?e.fontWeight+" ":"",t+=e.fontFamily?e.fontFamily:"Arial",t}drawRoundRect(e,t,n,r,i,a,s){let o=this.textStyle,l=Math.min(o.borderRadius||0,r/2,i/2);e.save(),o.backgroundColor&&(e.fillStyle=o.backgroundColor),o.borderColor&&(e.strokeStyle=o.borderColor),o.borderWidth&&(e.lineWidth=o.borderWidth),this.radius&&s&&(e.beginPath(),e.arc(a.x,a.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip(),e.closePath()),e.beginPath(),e.moveTo(t+l,n),e.arcTo(t+r,n,t+r,n+i,l),e.arcTo(t+r,n+i,t,n+i,l),e.arcTo(t,n+i,t,n,l),e.arcTo(t,n,t+r,n,l),o.borderWidth&&e.stroke(),o.backgroundColor&&e.fill(),e.closePath(),e.restore()}draw(e,t){let n=this.textStyle,r=new q(this.position.x,this.position.y,this.position.z),i=!1;if(this.radius){let e=new Te(r.x,r.z),n=new Te(t.position.x,t.position.z),a=e.distanceTo(n);a>this.radius&&a<this.displayRadius?r.lerp(t.position,1-this.radius/a):i=!0}let a=this.transToScreenCoord(r,t),s=this.getFont(),o=n.fontSize?n.fontSize:12;e.font=s,e.textAlign="center",e.textBaseline="middle";let l=e.measureText(this.text).width,h=o;n.outlineWidth&&(e.lineWidth=n.outlineWidth,e.strokeStyle=n.outlineColor||"black");let u=new Te(this.offset.x,this.offset.y),c=this.transToScreenCoord(t.position,t);(n.borderWidth||n.backgroundColor)&&(l=1.2*l<this.size.width?this.size.width:1.2*l,h=1.5*h<this.size.height?this.size.height:1.5*h,this.drawRoundRect(e,a.x+(u.x-.5)*l,a.y+(u.y-.5)*h,l,h,c,i)),e.save(),e.beginPath(),this.radius&&i&&(e.arc(c.x,c.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()),n.outlineWidth&&e.strokeText(this.text,a.x+u.x*l,a.y+u.y*h),e.fillStyle=n.fontColor||"white",e.fillText(this.text,a.x+u.x*l,a.y+u.y*h),e.restore(),this.width=l*this.tolerance,this.height=h*this.tolerance}drawSelect(){}getClassType(){return"TextMarker"}isPointInPath(){return!1}getBBox(){let e=new q(this.position.x,this.position.y,this.position.z),t=new Ft;return t.min.x=e.x+(this.offset.x-.5)*this.width,t.min.y=e.y,t.min.z=e.z+(this.offset.y-.5)*this.height,t.max.x=e.x+(this.offset.x+.5)*this.width,t.max.y=e.y,t.max.z=e.z+(this.offset.y+.5)*this.height,t}},rme=class extends Ei{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.positions=t.positions,this.lineWidth=t.lineWidth||1,this.lineColor=t.lineColor||[0,0,0,1],this.renderOrder=t.renderOrder||-999}draw(e,t){let n=this.positions.map((e=>{let n=new q(e.x,e.y,e.z);return this.transToScreenCoord(n,t)}));e.save(),e.beginPath(),e.lineWidth=this.lineWidth,e.strokeStyle=cn.rgba2Color(this.lineColor),n.forEach(((t,n)=>{0===n?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.restore()}drawSelect(){}getClassType(){return"LineDrawable"}isPointInPath(){return!1}getBBox(){let e=this.positions.map((e=>new q(e.x,e.y,e.z)));return(new Ft).setFromPoints(e)}};window.THREE=$t;export{aF as ArrowMarkup,jN as AxisGizmoPlugin,WC as BaseDxfCompareHelper,sr as BaseMeasureDrawable,mc as BaseMeasurement,NC as BaseViewer,Uh as BinaryReader,ipe as BottomBarPlugin,Gh as BoxSelectHelper,m0 as ByBlock,p0 as ByLayer,UM as CSS2DObjectUtils,MF as CameraProjection,Ile as CancelablePromise,xn as CanvasRender,oF as CircleMarkup,ml as CloudLineMarkup,lF as CloudRectMarkup,cn as ColorUtils,Ct as CommonUtils,tp as CompareDrawable,Xg as Container,ux as ControlsMode,mn as CoordinateUtils,zM as DefaultCameraFar,Vle as DefaultCameraFov,VM as DefaultCameraNear,$pe as DefaultMarkupToolbarConfig,GCt as DefaultOpacity,Kpe as DefaultViewer2dToolbarConfig,Bn as DeviceUtils,cF as DotMarkup,Ei as Drawable,$a as DrawableList,SN as DxfChangeType,cs as DxfCompare,Kde as DxfCompareHelper,Zde as DxfCompareMarkupManager,bn as DxfLoader,Zd as DxfParser,Ede as DxfRenderOrder,wl as DxfUtils,WM as EdgeUtils,uF as EllipseMarkup,as as Event,Sh as ExportUtils,Ja as FontManager,ece as FpsUtils,EC as GenerateMeshBvhWorker,Gt as GeometryUtils,wdt as GroundPlaneRenderOrder,Ype as GroupConfig,Hle as HighlightColor,zCt as HighlightColorRgba,spe as HotpointPlugin,qM as IconfontClass,Th as IconfontClass2,_b as ImageDrawable,Jd as InputManager,HM as LayerForHitableObjects,_h as LayerForSelectableObjects,ss as LayerForSnapableObjects,ZN as LayerManagerPlugin,hF as LeaderLineMarkup,ti as Line,rme as LineDrawable,lC as LinePatternShaders,bC as LoadingHelper,Wpe as LocalDxfUploader,Zpe as MarkupGroupConfig,vu as MarkupPlugin,Mdt as MarkupPluginEvent,oR as MarkupToolbar,ta as MarkupType,Fs as MaterialUtils,Bt as MathUtils,is as MatrixAutoUpdate,ep as MeasurementPlugin,Ho as MeasurementType,aR as MenuTypeEnums,bi as MergeUtils,Jt as Mesh,_C as MeshBvhHelper,IC as MobileTouchHelperDrawable,UC as Model,Uo as Model2d,Xd as NestedCompareTypes,AC as OSnapHelper,c3t as OSnapIconSize,Jce as OSnapMarkerType,FN as OSnapType,yr as ObjectUtils,epe as Offset,RA as OrbitControls,qCt as OutlineColorRgba,lR as OverviewMapDrawable,FB as OverviewMapPlugin,Bdt as OverviewMapPluginEvent,Xh as PdfLoader,yb as PdfLoaderPlugin,CC as PickMarkupHelper,PA as PlanControls,si as Plugin,Ni as Points,Ld as PolygonUtils,fF as PolylineMarkup,Yg as ProgressBar,u0 as RafHelper,dF as RectMarkup,Kce as SVGObjectUtils,nc as SceneUtils,Idt as ScreenshotMode,xb as ScreenshotPlugin,rc as SectionUtils,Zce as SimplifyUtils,Bi as SnapDrawable,_A as Spinner,Xpe as StatsPlugin,nme as TextDrawable,Po as TextMarkup,iue as TextMarkupEvent,qg as TextureUtils,GM as ThresholdAngleForEdge,P0 as Toolbar,DB as ToolbarMenu,IB as ToolbarMenuId,Qce as UnitConversionByMeter,Qat as UnitLabels,jLt as UnitScaleConversion,Ade as UnitScaleToMeter,hC as Units,jh as Viewer2d,LB as Viewer2dToolbarPlugin,os as ViewerEvent,ix as ViewerName,pF as XMarkup,PC as ZoomToRectHelper,Mde as bspline,dfe as checkIsNewVersion,yce as cn,Sde as createHatchPatternShaderMaterial,jft as decodeDxfTextCharacterCodes,Yft as decodeDxfTextMbcsCharacterCodes,Xft as decodeDxfTextUnicodeCodePoints,vce as en,v3t as getLengthValueByUnit,ex as getUnitStr,eft as getVersionFromLocalStorage,fe as log,cC as parseDxfMTextContent,uC as parseDxfTextContent,wde as round10,BM as setIcon,Lle as setLogLevel,tft as setVersionToLocalStorage,tc as showPrecisionValue};